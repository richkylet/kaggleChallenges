/*!
 * jQuery JavaScript Library v1.12.4
 * http://jquery.com/
 *
 * Includes Sizzle.js
 * http://sizzlejs.com/
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license
 * http://jquery.org/license
 *
 * Date: 2016-05-20T17:17Z
 */
(function(global,factory){if(typeof module==="object"&&typeof module.exports==="object"){module.exports=global.document?factory(global,true):function(w){if(!w.document){throw new Error("jQuery requires a window with a document");
}return factory(w);};}else{factory(global);}}(typeof window!=="undefined"?window:this,function(window,noGlobal){var deletedIds=[];
var document=window.document;var slice=deletedIds.slice;var concat=deletedIds.concat;var push=deletedIds.push;
var indexOf=deletedIds.indexOf;var class2type={};var toString=class2type.toString;var hasOwn=class2type.hasOwnProperty;
var support={};var version="1.12.4",jQuery=function(selector,context){return new jQuery.fn.init(selector,context);
},rtrim=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,rmsPrefix=/^-ms-/,rdashAlpha=/-([\da-z])/gi,fcamelCase=function(all,letter){return letter.toUpperCase();
};jQuery.fn=jQuery.prototype={jquery:version,constructor:jQuery,selector:"",length:0,toArray:function(){return slice.call(this);
},get:function(num){return num!=null?(num<0?this[num+this.length]:this[num]):slice.call(this);},pushStack:function(elems){var ret=jQuery.merge(this.constructor(),elems);
ret.prevObject=this;ret.context=this.context;return ret;},each:function(callback){return jQuery.each(this,callback);
},map:function(callback){return this.pushStack(jQuery.map(this,function(elem,i){return callback.call(elem,i,elem);
}));},slice:function(){return this.pushStack(slice.apply(this,arguments));},first:function(){return this.eq(0);
},last:function(){return this.eq(-1);},eq:function(i){var len=this.length,j=+i+(i<0?len:0);return this.pushStack(j>=0&&j<len?[this[j]]:[]);
},end:function(){return this.prevObject||this.constructor();},push:push,sort:deletedIds.sort,splice:deletedIds.splice};
jQuery.extend=jQuery.fn.extend=function(){var src,copyIsArray,copy,name,options,clone,target=arguments[0]||{},i=1,length=arguments.length,deep=false;
if(typeof target==="boolean"){deep=target;target=arguments[i]||{};i++;}if(typeof target!=="object"&&!jQuery.isFunction(target)){target={};
}if(i===length){target=this;i--;}for(;i<length;i++){if((options=arguments[i])!=null){for(name in options){src=target[name];
copy=options[name];if(target===copy){continue;}if(deep&&copy&&(jQuery.isPlainObject(copy)||(copyIsArray=jQuery.isArray(copy)))){if(copyIsArray){copyIsArray=false;
clone=src&&jQuery.isArray(src)?src:[];}else{clone=src&&jQuery.isPlainObject(src)?src:{};}target[name]=jQuery.extend(deep,clone,copy);
}else{if(copy!==undefined){target[name]=copy;}}}}}return target;};jQuery.extend({expando:"jQuery"+(version+Math.random()).replace(/\D/g,""),isReady:true,error:function(msg){throw new Error(msg);
},noop:function(){},isFunction:function(obj){return jQuery.type(obj)==="function";},isArray:Array.isArray||function(obj){return jQuery.type(obj)==="array";
},isWindow:function(obj){return obj!=null&&obj==obj.window;},isNumeric:function(obj){var realStringObj=obj&&obj.toString();
return !jQuery.isArray(obj)&&(realStringObj-parseFloat(realStringObj)+1)>=0;},isEmptyObject:function(obj){var name;
for(name in obj){return false;}return true;},isPlainObject:function(obj){var key;if(!obj||jQuery.type(obj)!=="object"||obj.nodeType||jQuery.isWindow(obj)){return false;
}try{if(obj.constructor&&!hasOwn.call(obj,"constructor")&&!hasOwn.call(obj.constructor.prototype,"isPrototypeOf")){return false;
}}catch(e){return false;}if(!support.ownFirst){for(key in obj){return hasOwn.call(obj,key);}}for(key in obj){}return key===undefined||hasOwn.call(obj,key);
},type:function(obj){if(obj==null){return obj+"";}return typeof obj==="object"||typeof obj==="function"?class2type[toString.call(obj)]||"object":typeof obj;
},globalEval:function(data){if(data&&jQuery.trim(data)){(window.execScript||function(data){window["eval"].call(window,data);
})(data);}},camelCase:function(string){return string.replace(rmsPrefix,"ms-").replace(rdashAlpha,fcamelCase);
},nodeName:function(elem,name){return elem.nodeName&&elem.nodeName.toLowerCase()===name.toLowerCase();
},each:function(obj,callback){var length,i=0;if(isArrayLike(obj)){length=obj.length;for(;i<length;i++){if(callback.call(obj[i],i,obj[i])===false){break;
}}}else{for(i in obj){if(callback.call(obj[i],i,obj[i])===false){break;}}}return obj;},trim:function(text){return text==null?"":(text+"").replace(rtrim,"");
},makeArray:function(arr,results){var ret=results||[];if(arr!=null){if(isArrayLike(Object(arr))){jQuery.merge(ret,typeof arr==="string"?[arr]:arr);
}else{push.call(ret,arr);}}return ret;},inArray:function(elem,arr,i){var len;if(arr){if(indexOf){return indexOf.call(arr,elem,i);
}len=arr.length;i=i?i<0?Math.max(0,len+i):i:0;for(;i<len;i++){if(i in arr&&arr[i]===elem){return i;}}}return -1;
},merge:function(first,second){var len=+second.length,j=0,i=first.length;while(j<len){first[i++]=second[j++];
}if(len!==len){while(second[j]!==undefined){first[i++]=second[j++];}}first.length=i;return first;},grep:function(elems,callback,invert){var callbackInverse,matches=[],i=0,length=elems.length,callbackExpect=!invert;
for(;i<length;i++){callbackInverse=!callback(elems[i],i);if(callbackInverse!==callbackExpect){matches.push(elems[i]);
}}return matches;},map:function(elems,callback,arg){var length,value,i=0,ret=[];if(isArrayLike(elems)){length=elems.length;
for(;i<length;i++){value=callback(elems[i],i,arg);if(value!=null){ret.push(value);}}}else{for(i in elems){value=callback(elems[i],i,arg);
if(value!=null){ret.push(value);}}}return concat.apply([],ret);},guid:1,proxy:function(fn,context){var args,proxy,tmp;
if(typeof context==="string"){tmp=fn[context];context=fn;fn=tmp;}if(!jQuery.isFunction(fn)){return undefined;
}args=slice.call(arguments,2);proxy=function(){return fn.apply(context||this,args.concat(slice.call(arguments)));
};proxy.guid=fn.guid=fn.guid||jQuery.guid++;return proxy;},now:function(){return +(new Date());},support:support});
if(typeof Symbol==="function"){jQuery.fn[Symbol.iterator]=deletedIds[Symbol.iterator];}jQuery.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(i,name){class2type["[object "+name+"]"]=name.toLowerCase();
});function isArrayLike(obj){var length=!!obj&&"length" in obj&&obj.length,type=jQuery.type(obj);if(type==="function"||jQuery.isWindow(obj)){return false;
}return type==="array"||length===0||typeof length==="number"&&length>0&&(length-1) in obj;}var Sizzle=
/*!
 * Sizzle CSS Selector Engine v2.2.1
 * http://sizzlejs.com/
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license
 * http://jquery.org/license
 *
 * Date: 2015-10-17
 */
(function(window){var i,support,Expr,getText,isXML,tokenize,compile,select,outermostContext,sortInput,hasDuplicate,setDocument,document,docElem,documentIsHTML,rbuggyQSA,rbuggyMatches,matches,contains,expando="sizzle"+1*new Date(),preferredDoc=window.document,dirruns=0,done=0,classCache=createCache(),tokenCache=createCache(),compilerCache=createCache(),sortOrder=function(a,b){if(a===b){hasDuplicate=true;
}return 0;},MAX_NEGATIVE=1<<31,hasOwn=({}).hasOwnProperty,arr=[],pop=arr.pop,push_native=arr.push,push=arr.push,slice=arr.slice,indexOf=function(list,elem){var i=0,len=list.length;
for(;i<len;i++){if(list[i]===elem){return i;}}return -1;},booleans="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",whitespace="[\\x20\\t\\r\\n\\f]",identifier="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",attributes="\\["+whitespace+"*("+identifier+")(?:"+whitespace+"*([*^$|!~]?=)"+whitespace+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+identifier+"))|)"+whitespace+"*\\]",pseudos=":("+identifier+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+attributes+")*)|.*)\\)|)",rwhitespace=new RegExp(whitespace+"+","g"),rtrim=new RegExp("^"+whitespace+"+|((?:^|[^\\\\])(?:\\\\.)*)"+whitespace+"+$","g"),rcomma=new RegExp("^"+whitespace+"*,"+whitespace+"*"),rcombinators=new RegExp("^"+whitespace+"*([>+~]|"+whitespace+")"+whitespace+"*"),rattributeQuotes=new RegExp("="+whitespace+"*([^\\]'\"]*?)"+whitespace+"*\\]","g"),rpseudo=new RegExp(pseudos),ridentifier=new RegExp("^"+identifier+"$"),matchExpr={ID:new RegExp("^#("+identifier+")"),CLASS:new RegExp("^\\.("+identifier+")"),TAG:new RegExp("^("+identifier+"|[*])"),ATTR:new RegExp("^"+attributes),PSEUDO:new RegExp("^"+pseudos),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+whitespace+"*(even|odd|(([+-]|)(\\d*)n|)"+whitespace+"*(?:([+-]|)"+whitespace+"*(\\d+)|))"+whitespace+"*\\)|)","i"),bool:new RegExp("^(?:"+booleans+")$","i"),needsContext:new RegExp("^"+whitespace+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+whitespace+"*((?:-\\d)?\\d*)"+whitespace+"*\\)|)(?=[^-]|$)","i")},rinputs=/^(?:input|select|textarea|button)$/i,rheader=/^h\d$/i,rnative=/^[^{]+\{\s*\[native \w/,rquickExpr=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,rsibling=/[+~]/,rescape=/'|\\/g,runescape=new RegExp("\\\\([\\da-f]{1,6}"+whitespace+"?|("+whitespace+")|.)","ig"),funescape=function(_,escaped,escapedWhitespace){var high="0x"+escaped-65536;
return high!==high||escapedWhitespace?escaped:high<0?String.fromCharCode(high+65536):String.fromCharCode(high>>10|55296,high&1023|56320);
},unloadHandler=function(){setDocument();};try{push.apply((arr=slice.call(preferredDoc.childNodes)),preferredDoc.childNodes);
arr[preferredDoc.childNodes.length].nodeType;}catch(e){push={apply:arr.length?function(target,els){push_native.apply(target,slice.call(els));
}:function(target,els){var j=target.length,i=0;while((target[j++]=els[i++])){}target.length=j-1;}};}function Sizzle(selector,context,results,seed){var m,i,elem,nid,nidselect,match,groups,newSelector,newContext=context&&context.ownerDocument,nodeType=context?context.nodeType:9;
results=results||[];if(typeof selector!=="string"||!selector||nodeType!==1&&nodeType!==9&&nodeType!==11){return results;
}if(!seed){if((context?context.ownerDocument||context:preferredDoc)!==document){setDocument(context);
}context=context||document;if(documentIsHTML){if(nodeType!==11&&(match=rquickExpr.exec(selector))){if((m=match[1])){if(nodeType===9){if((elem=context.getElementById(m))){if(elem.id===m){results.push(elem);
return results;}}else{return results;}}else{if(newContext&&(elem=newContext.getElementById(m))&&contains(context,elem)&&elem.id===m){results.push(elem);
return results;}}}else{if(match[2]){push.apply(results,context.getElementsByTagName(selector));return results;
}else{if((m=match[3])&&support.getElementsByClassName&&context.getElementsByClassName){push.apply(results,context.getElementsByClassName(m));
return results;}}}}if(support.qsa&&!compilerCache[selector+" "]&&(!rbuggyQSA||!rbuggyQSA.test(selector))){if(nodeType!==1){newContext=context;
newSelector=selector;}else{if(context.nodeName.toLowerCase()!=="object"){if((nid=context.getAttribute("id"))){nid=nid.replace(rescape,"\\$&");
}else{context.setAttribute("id",(nid=expando));}groups=tokenize(selector);i=groups.length;nidselect=ridentifier.test(nid)?"#"+nid:"[id='"+nid+"']";
while(i--){groups[i]=nidselect+" "+toSelector(groups[i]);}newSelector=groups.join(",");newContext=rsibling.test(selector)&&testContext(context.parentNode)||context;
}}if(newSelector){try{push.apply(results,newContext.querySelectorAll(newSelector));return results;}catch(qsaError){}finally{if(nid===expando){context.removeAttribute("id");
}}}}}}return select(selector.replace(rtrim,"$1"),context,results,seed);}function createCache(){var keys=[];
function cache(key,value){if(keys.push(key+" ")>Expr.cacheLength){delete cache[keys.shift()];}return(cache[key+" "]=value);
}return cache;}function markFunction(fn){fn[expando]=true;return fn;}function assert(fn){var div=document.createElement("div");
try{return !!fn(div);}catch(e){return false;}finally{if(div.parentNode){div.parentNode.removeChild(div);
}div=null;}}function addHandle(attrs,handler){var arr=attrs.split("|"),i=arr.length;while(i--){Expr.attrHandle[arr[i]]=handler;
}}function siblingCheck(a,b){var cur=b&&a,diff=cur&&a.nodeType===1&&b.nodeType===1&&(~b.sourceIndex||MAX_NEGATIVE)-(~a.sourceIndex||MAX_NEGATIVE);
if(diff){return diff;}if(cur){while((cur=cur.nextSibling)){if(cur===b){return -1;}}}return a?1:-1;}function createInputPseudo(type){return function(elem){var name=elem.nodeName.toLowerCase();
return name==="input"&&elem.type===type;};}function createButtonPseudo(type){return function(elem){var name=elem.nodeName.toLowerCase();
return(name==="input"||name==="button")&&elem.type===type;};}function createPositionalPseudo(fn){return markFunction(function(argument){argument=+argument;
return markFunction(function(seed,matches){var j,matchIndexes=fn([],seed.length,argument),i=matchIndexes.length;
while(i--){if(seed[(j=matchIndexes[i])]){seed[j]=!(matches[j]=seed[j]);}}});});}function testContext(context){return context&&typeof context.getElementsByTagName!=="undefined"&&context;
}support=Sizzle.support={};isXML=Sizzle.isXML=function(elem){var documentElement=elem&&(elem.ownerDocument||elem).documentElement;
return documentElement?documentElement.nodeName!=="HTML":false;};setDocument=Sizzle.setDocument=function(node){var hasCompare,parent,doc=node?node.ownerDocument||node:preferredDoc;
if(doc===document||doc.nodeType!==9||!doc.documentElement){return document;}document=doc;docElem=document.documentElement;
documentIsHTML=!isXML(document);if((parent=document.defaultView)&&parent.top!==parent){if(parent.addEventListener){parent.addEventListener("unload",unloadHandler,false);
}else{if(parent.attachEvent){parent.attachEvent("onunload",unloadHandler);}}}support.attributes=assert(function(div){div.className="i";
return !div.getAttribute("className");});support.getElementsByTagName=assert(function(div){div.appendChild(document.createComment(""));
return !div.getElementsByTagName("*").length;});support.getElementsByClassName=rnative.test(document.getElementsByClassName);
support.getById=assert(function(div){docElem.appendChild(div).id=expando;return !document.getElementsByName||!document.getElementsByName(expando).length;
});if(support.getById){Expr.find.ID=function(id,context){if(typeof context.getElementById!=="undefined"&&documentIsHTML){var m=context.getElementById(id);
return m?[m]:[];}};Expr.filter.ID=function(id){var attrId=id.replace(runescape,funescape);return function(elem){return elem.getAttribute("id")===attrId;
};};}else{delete Expr.find.ID;Expr.filter.ID=function(id){var attrId=id.replace(runescape,funescape);
return function(elem){var node=typeof elem.getAttributeNode!=="undefined"&&elem.getAttributeNode("id");
return node&&node.value===attrId;};};}Expr.find.TAG=support.getElementsByTagName?function(tag,context){if(typeof context.getElementsByTagName!=="undefined"){return context.getElementsByTagName(tag);
}else{if(support.qsa){return context.querySelectorAll(tag);}}}:function(tag,context){var elem,tmp=[],i=0,results=context.getElementsByTagName(tag);
if(tag==="*"){while((elem=results[i++])){if(elem.nodeType===1){tmp.push(elem);}}return tmp;}return results;
};Expr.find.CLASS=support.getElementsByClassName&&function(className,context){if(typeof context.getElementsByClassName!=="undefined"&&documentIsHTML){return context.getElementsByClassName(className);
}};rbuggyMatches=[];rbuggyQSA=[];if((support.qsa=rnative.test(document.querySelectorAll))){assert(function(div){docElem.appendChild(div).innerHTML="<a id='"+expando+"'></a><select id='"+expando+"-\r\\' msallowcapture=''><option selected=''></option></select>";
if(div.querySelectorAll("[msallowcapture^='']").length){rbuggyQSA.push("[*^$]="+whitespace+"*(?:''|\"\")");
}if(!div.querySelectorAll("[selected]").length){rbuggyQSA.push("\\["+whitespace+"*(?:value|"+booleans+")");
}if(!div.querySelectorAll("[id~="+expando+"-]").length){rbuggyQSA.push("~=");}if(!div.querySelectorAll(":checked").length){rbuggyQSA.push(":checked");
}if(!div.querySelectorAll("a#"+expando+"+*").length){rbuggyQSA.push(".#.+[+~]");}});assert(function(div){var input=document.createElement("input");
input.setAttribute("type","hidden");div.appendChild(input).setAttribute("name","D");if(div.querySelectorAll("[name=d]").length){rbuggyQSA.push("name"+whitespace+"*[*^$|!~]?=");
}if(!div.querySelectorAll(":enabled").length){rbuggyQSA.push(":enabled",":disabled");}div.querySelectorAll("*,:x");
rbuggyQSA.push(",.*:");});}if((support.matchesSelector=rnative.test((matches=docElem.matches||docElem.webkitMatchesSelector||docElem.mozMatchesSelector||docElem.oMatchesSelector||docElem.msMatchesSelector)))){assert(function(div){support.disconnectedMatch=matches.call(div,"div");
matches.call(div,"[s!='']:x");rbuggyMatches.push("!=",pseudos);});}rbuggyQSA=rbuggyQSA.length&&new RegExp(rbuggyQSA.join("|"));
rbuggyMatches=rbuggyMatches.length&&new RegExp(rbuggyMatches.join("|"));hasCompare=rnative.test(docElem.compareDocumentPosition);
contains=hasCompare||rnative.test(docElem.contains)?function(a,b){var adown=a.nodeType===9?a.documentElement:a,bup=b&&b.parentNode;
return a===bup||!!(bup&&bup.nodeType===1&&(adown.contains?adown.contains(bup):a.compareDocumentPosition&&a.compareDocumentPosition(bup)&16));
}:function(a,b){if(b){while((b=b.parentNode)){if(b===a){return true;}}}return false;};sortOrder=hasCompare?function(a,b){if(a===b){hasDuplicate=true;
return 0;}var compare=!a.compareDocumentPosition-!b.compareDocumentPosition;if(compare){return compare;
}compare=(a.ownerDocument||a)===(b.ownerDocument||b)?a.compareDocumentPosition(b):1;if(compare&1||(!support.sortDetached&&b.compareDocumentPosition(a)===compare)){if(a===document||a.ownerDocument===preferredDoc&&contains(preferredDoc,a)){return -1;
}if(b===document||b.ownerDocument===preferredDoc&&contains(preferredDoc,b)){return 1;}return sortInput?(indexOf(sortInput,a)-indexOf(sortInput,b)):0;
}return compare&4?-1:1;}:function(a,b){if(a===b){hasDuplicate=true;return 0;}var cur,i=0,aup=a.parentNode,bup=b.parentNode,ap=[a],bp=[b];
if(!aup||!bup){return a===document?-1:b===document?1:aup?-1:bup?1:sortInput?(indexOf(sortInput,a)-indexOf(sortInput,b)):0;
}else{if(aup===bup){return siblingCheck(a,b);}}cur=a;while((cur=cur.parentNode)){ap.unshift(cur);}cur=b;
while((cur=cur.parentNode)){bp.unshift(cur);}while(ap[i]===bp[i]){i++;}return i?siblingCheck(ap[i],bp[i]):ap[i]===preferredDoc?-1:bp[i]===preferredDoc?1:0;
};return document;};Sizzle.matches=function(expr,elements){return Sizzle(expr,null,null,elements);};Sizzle.matchesSelector=function(elem,expr){if((elem.ownerDocument||elem)!==document){setDocument(elem);
}expr=expr.replace(rattributeQuotes,"='$1']");if(support.matchesSelector&&documentIsHTML&&!compilerCache[expr+" "]&&(!rbuggyMatches||!rbuggyMatches.test(expr))&&(!rbuggyQSA||!rbuggyQSA.test(expr))){try{var ret=matches.call(elem,expr);
if(ret||support.disconnectedMatch||elem.document&&elem.document.nodeType!==11){return ret;}}catch(e){}}return Sizzle(expr,document,null,[elem]).length>0;
};Sizzle.contains=function(context,elem){if((context.ownerDocument||context)!==document){setDocument(context);
}return contains(context,elem);};Sizzle.attr=function(elem,name){if((elem.ownerDocument||elem)!==document){setDocument(elem);
}var fn=Expr.attrHandle[name.toLowerCase()],val=fn&&hasOwn.call(Expr.attrHandle,name.toLowerCase())?fn(elem,name,!documentIsHTML):undefined;
return val!==undefined?val:support.attributes||!documentIsHTML?elem.getAttribute(name):(val=elem.getAttributeNode(name))&&val.specified?val.value:null;
};Sizzle.error=function(msg){throw new Error("Syntax error, unrecognized expression: "+msg);};Sizzle.uniqueSort=function(results){var elem,duplicates=[],j=0,i=0;
hasDuplicate=!support.detectDuplicates;sortInput=!support.sortStable&&results.slice(0);results.sort(sortOrder);
if(hasDuplicate){while((elem=results[i++])){if(elem===results[i]){j=duplicates.push(i);}}while(j--){results.splice(duplicates[j],1);
}}sortInput=null;return results;};getText=Sizzle.getText=function(elem){var node,ret="",i=0,nodeType=elem.nodeType;
if(!nodeType){while((node=elem[i++])){ret+=getText(node);}}else{if(nodeType===1||nodeType===9||nodeType===11){if(typeof elem.textContent==="string"){return elem.textContent;
}else{for(elem=elem.firstChild;elem;elem=elem.nextSibling){ret+=getText(elem);}}}else{if(nodeType===3||nodeType===4){return elem.nodeValue;
}}}return ret;};Expr=Sizzle.selectors={cacheLength:50,createPseudo:markFunction,match:matchExpr,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:true}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:true},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(match){match[1]=match[1].replace(runescape,funescape);
match[3]=(match[3]||match[4]||match[5]||"").replace(runescape,funescape);if(match[2]==="~="){match[3]=" "+match[3]+" ";
}return match.slice(0,4);},CHILD:function(match){match[1]=match[1].toLowerCase();if(match[1].slice(0,3)==="nth"){if(!match[3]){Sizzle.error(match[0]);
}match[4]=+(match[4]?match[5]+(match[6]||1):2*(match[3]==="even"||match[3]==="odd"));match[5]=+((match[7]+match[8])||match[3]==="odd");
}else{if(match[3]){Sizzle.error(match[0]);}}return match;},PSEUDO:function(match){var excess,unquoted=!match[6]&&match[2];
if(matchExpr.CHILD.test(match[0])){return null;}if(match[3]){match[2]=match[4]||match[5]||"";}else{if(unquoted&&rpseudo.test(unquoted)&&(excess=tokenize(unquoted,true))&&(excess=unquoted.indexOf(")",unquoted.length-excess)-unquoted.length)){match[0]=match[0].slice(0,excess);
match[2]=unquoted.slice(0,excess);}}return match.slice(0,3);}},filter:{TAG:function(nodeNameSelector){var nodeName=nodeNameSelector.replace(runescape,funescape).toLowerCase();
return nodeNameSelector==="*"?function(){return true;}:function(elem){return elem.nodeName&&elem.nodeName.toLowerCase()===nodeName;
};},CLASS:function(className){var pattern=classCache[className+" "];return pattern||(pattern=new RegExp("(^|"+whitespace+")"+className+"("+whitespace+"|$)"))&&classCache(className,function(elem){return pattern.test(typeof elem.className==="string"&&elem.className||typeof elem.getAttribute!=="undefined"&&elem.getAttribute("class")||"");
});},ATTR:function(name,operator,check){return function(elem){var result=Sizzle.attr(elem,name);if(result==null){return operator==="!=";
}if(!operator){return true;}result+="";return operator==="="?result===check:operator==="!="?result!==check:operator==="^="?check&&result.indexOf(check)===0:operator==="*="?check&&result.indexOf(check)>-1:operator==="$="?check&&result.slice(-check.length)===check:operator==="~="?(" "+result.replace(rwhitespace," ")+" ").indexOf(check)>-1:operator==="|="?result===check||result.slice(0,check.length+1)===check+"-":false;
};},CHILD:function(type,what,argument,first,last){var simple=type.slice(0,3)!=="nth",forward=type.slice(-4)!=="last",ofType=what==="of-type";
return first===1&&last===0?function(elem){return !!elem.parentNode;}:function(elem,context,xml){var cache,uniqueCache,outerCache,node,nodeIndex,start,dir=simple!==forward?"nextSibling":"previousSibling",parent=elem.parentNode,name=ofType&&elem.nodeName.toLowerCase(),useCache=!xml&&!ofType,diff=false;
if(parent){if(simple){while(dir){node=elem;while((node=node[dir])){if(ofType?node.nodeName.toLowerCase()===name:node.nodeType===1){return false;
}}start=dir=type==="only"&&!start&&"nextSibling";}return true;}start=[forward?parent.firstChild:parent.lastChild];
if(forward&&useCache){node=parent;outerCache=node[expando]||(node[expando]={});uniqueCache=outerCache[node.uniqueID]||(outerCache[node.uniqueID]={});
cache=uniqueCache[type]||[];nodeIndex=cache[0]===dirruns&&cache[1];diff=nodeIndex&&cache[2];node=nodeIndex&&parent.childNodes[nodeIndex];
while((node=++nodeIndex&&node&&node[dir]||(diff=nodeIndex=0)||start.pop())){if(node.nodeType===1&&++diff&&node===elem){uniqueCache[type]=[dirruns,nodeIndex,diff];
break;}}}else{if(useCache){node=elem;outerCache=node[expando]||(node[expando]={});uniqueCache=outerCache[node.uniqueID]||(outerCache[node.uniqueID]={});
cache=uniqueCache[type]||[];nodeIndex=cache[0]===dirruns&&cache[1];diff=nodeIndex;}if(diff===false){while((node=++nodeIndex&&node&&node[dir]||(diff=nodeIndex=0)||start.pop())){if((ofType?node.nodeName.toLowerCase()===name:node.nodeType===1)&&++diff){if(useCache){outerCache=node[expando]||(node[expando]={});
uniqueCache=outerCache[node.uniqueID]||(outerCache[node.uniqueID]={});uniqueCache[type]=[dirruns,diff];
}if(node===elem){break;}}}}}diff-=last;return diff===first||(diff%first===0&&diff/first>=0);}};},PSEUDO:function(pseudo,argument){var args,fn=Expr.pseudos[pseudo]||Expr.setFilters[pseudo.toLowerCase()]||Sizzle.error("unsupported pseudo: "+pseudo);
if(fn[expando]){return fn(argument);}if(fn.length>1){args=[pseudo,pseudo,"",argument];return Expr.setFilters.hasOwnProperty(pseudo.toLowerCase())?markFunction(function(seed,matches){var idx,matched=fn(seed,argument),i=matched.length;
while(i--){idx=indexOf(seed,matched[i]);seed[idx]=!(matches[idx]=matched[i]);}}):function(elem){return fn(elem,0,args);
};}return fn;}},pseudos:{not:markFunction(function(selector){var input=[],results=[],matcher=compile(selector.replace(rtrim,"$1"));
return matcher[expando]?markFunction(function(seed,matches,context,xml){var elem,unmatched=matcher(seed,null,xml,[]),i=seed.length;
while(i--){if((elem=unmatched[i])){seed[i]=!(matches[i]=elem);}}}):function(elem,context,xml){input[0]=elem;
matcher(input,null,xml,results);input[0]=null;return !results.pop();};}),has:markFunction(function(selector){return function(elem){return Sizzle(selector,elem).length>0;
};}),contains:markFunction(function(text){text=text.replace(runescape,funescape);return function(elem){return(elem.textContent||elem.innerText||getText(elem)).indexOf(text)>-1;
};}),lang:markFunction(function(lang){if(!ridentifier.test(lang||"")){Sizzle.error("unsupported lang: "+lang);
}lang=lang.replace(runescape,funescape).toLowerCase();return function(elem){var elemLang;do{if((elemLang=documentIsHTML?elem.lang:elem.getAttribute("xml:lang")||elem.getAttribute("lang"))){elemLang=elemLang.toLowerCase();
return elemLang===lang||elemLang.indexOf(lang+"-")===0;}}while((elem=elem.parentNode)&&elem.nodeType===1);
return false;};}),target:function(elem){var hash=window.location&&window.location.hash;return hash&&hash.slice(1)===elem.id;
},root:function(elem){return elem===docElem;},focus:function(elem){return elem===document.activeElement&&(!document.hasFocus||document.hasFocus())&&!!(elem.type||elem.href||~elem.tabIndex);
},enabled:function(elem){return elem.disabled===false;},disabled:function(elem){return elem.disabled===true;
},checked:function(elem){var nodeName=elem.nodeName.toLowerCase();return(nodeName==="input"&&!!elem.checked)||(nodeName==="option"&&!!elem.selected);
},selected:function(elem){if(elem.parentNode){elem.parentNode.selectedIndex;}return elem.selected===true;
},empty:function(elem){for(elem=elem.firstChild;elem;elem=elem.nextSibling){if(elem.nodeType<6){return false;
}}return true;},parent:function(elem){return !Expr.pseudos.empty(elem);},header:function(elem){return rheader.test(elem.nodeName);
},input:function(elem){return rinputs.test(elem.nodeName);},button:function(elem){var name=elem.nodeName.toLowerCase();
return name==="input"&&elem.type==="button"||name==="button";},text:function(elem){var attr;return elem.nodeName.toLowerCase()==="input"&&elem.type==="text"&&((attr=elem.getAttribute("type"))==null||attr.toLowerCase()==="text");
},first:createPositionalPseudo(function(){return[0];}),last:createPositionalPseudo(function(matchIndexes,length){return[length-1];
}),eq:createPositionalPseudo(function(matchIndexes,length,argument){return[argument<0?argument+length:argument];
}),even:createPositionalPseudo(function(matchIndexes,length){var i=0;for(;i<length;i+=2){matchIndexes.push(i);
}return matchIndexes;}),odd:createPositionalPseudo(function(matchIndexes,length){var i=1;for(;i<length;
i+=2){matchIndexes.push(i);}return matchIndexes;}),lt:createPositionalPseudo(function(matchIndexes,length,argument){var i=argument<0?argument+length:argument;
for(;--i>=0;){matchIndexes.push(i);}return matchIndexes;}),gt:createPositionalPseudo(function(matchIndexes,length,argument){var i=argument<0?argument+length:argument;
for(;++i<length;){matchIndexes.push(i);}return matchIndexes;})}};Expr.pseudos.nth=Expr.pseudos.eq;for(i in {radio:true,checkbox:true,file:true,password:true,image:true}){Expr.pseudos[i]=createInputPseudo(i);
}for(i in {submit:true,reset:true}){Expr.pseudos[i]=createButtonPseudo(i);}function setFilters(){}setFilters.prototype=Expr.filters=Expr.pseudos;
Expr.setFilters=new setFilters();tokenize=Sizzle.tokenize=function(selector,parseOnly){var matched,match,tokens,type,soFar,groups,preFilters,cached=tokenCache[selector+" "];
if(cached){return parseOnly?0:cached.slice(0);}soFar=selector;groups=[];preFilters=Expr.preFilter;while(soFar){if(!matched||(match=rcomma.exec(soFar))){if(match){soFar=soFar.slice(match[0].length)||soFar;
}groups.push((tokens=[]));}matched=false;if((match=rcombinators.exec(soFar))){matched=match.shift();tokens.push({value:matched,type:match[0].replace(rtrim," ")});
soFar=soFar.slice(matched.length);}for(type in Expr.filter){if((match=matchExpr[type].exec(soFar))&&(!preFilters[type]||(match=preFilters[type](match)))){matched=match.shift();
tokens.push({value:matched,type:type,matches:match});soFar=soFar.slice(matched.length);}}if(!matched){break;
}}return parseOnly?soFar.length:soFar?Sizzle.error(selector):tokenCache(selector,groups).slice(0);};function toSelector(tokens){var i=0,len=tokens.length,selector="";
for(;i<len;i++){selector+=tokens[i].value;}return selector;}function addCombinator(matcher,combinator,base){var dir=combinator.dir,checkNonElements=base&&dir==="parentNode",doneName=done++;
return combinator.first?function(elem,context,xml){while((elem=elem[dir])){if(elem.nodeType===1||checkNonElements){return matcher(elem,context,xml);
}}}:function(elem,context,xml){var oldCache,uniqueCache,outerCache,newCache=[dirruns,doneName];if(xml){while((elem=elem[dir])){if(elem.nodeType===1||checkNonElements){if(matcher(elem,context,xml)){return true;
}}}}else{while((elem=elem[dir])){if(elem.nodeType===1||checkNonElements){outerCache=elem[expando]||(elem[expando]={});
uniqueCache=outerCache[elem.uniqueID]||(outerCache[elem.uniqueID]={});if((oldCache=uniqueCache[dir])&&oldCache[0]===dirruns&&oldCache[1]===doneName){return(newCache[2]=oldCache[2]);
}else{uniqueCache[dir]=newCache;if((newCache[2]=matcher(elem,context,xml))){return true;}}}}}};}function elementMatcher(matchers){return matchers.length>1?function(elem,context,xml){var i=matchers.length;
while(i--){if(!matchers[i](elem,context,xml)){return false;}}return true;}:matchers[0];}function multipleContexts(selector,contexts,results){var i=0,len=contexts.length;
for(;i<len;i++){Sizzle(selector,contexts[i],results);}return results;}function condense(unmatched,map,filter,context,xml){var elem,newUnmatched=[],i=0,len=unmatched.length,mapped=map!=null;
for(;i<len;i++){if((elem=unmatched[i])){if(!filter||filter(elem,context,xml)){newUnmatched.push(elem);
if(mapped){map.push(i);}}}}return newUnmatched;}function setMatcher(preFilter,selector,matcher,postFilter,postFinder,postSelector){if(postFilter&&!postFilter[expando]){postFilter=setMatcher(postFilter);
}if(postFinder&&!postFinder[expando]){postFinder=setMatcher(postFinder,postSelector);}return markFunction(function(seed,results,context,xml){var temp,i,elem,preMap=[],postMap=[],preexisting=results.length,elems=seed||multipleContexts(selector||"*",context.nodeType?[context]:context,[]),matcherIn=preFilter&&(seed||!selector)?condense(elems,preMap,preFilter,context,xml):elems,matcherOut=matcher?postFinder||(seed?preFilter:preexisting||postFilter)?[]:results:matcherIn;
if(matcher){matcher(matcherIn,matcherOut,context,xml);}if(postFilter){temp=condense(matcherOut,postMap);
postFilter(temp,[],context,xml);i=temp.length;while(i--){if((elem=temp[i])){matcherOut[postMap[i]]=!(matcherIn[postMap[i]]=elem);
}}}if(seed){if(postFinder||preFilter){if(postFinder){temp=[];i=matcherOut.length;while(i--){if((elem=matcherOut[i])){temp.push((matcherIn[i]=elem));
}}postFinder(null,(matcherOut=[]),temp,xml);}i=matcherOut.length;while(i--){if((elem=matcherOut[i])&&(temp=postFinder?indexOf(seed,elem):preMap[i])>-1){seed[temp]=!(results[temp]=elem);
}}}}else{matcherOut=condense(matcherOut===results?matcherOut.splice(preexisting,matcherOut.length):matcherOut);
if(postFinder){postFinder(null,results,matcherOut,xml);}else{push.apply(results,matcherOut);}}});}function matcherFromTokens(tokens){var checkContext,matcher,j,len=tokens.length,leadingRelative=Expr.relative[tokens[0].type],implicitRelative=leadingRelative||Expr.relative[" "],i=leadingRelative?1:0,matchContext=addCombinator(function(elem){return elem===checkContext;
},implicitRelative,true),matchAnyContext=addCombinator(function(elem){return indexOf(checkContext,elem)>-1;
},implicitRelative,true),matchers=[function(elem,context,xml){var ret=(!leadingRelative&&(xml||context!==outermostContext))||((checkContext=context).nodeType?matchContext(elem,context,xml):matchAnyContext(elem,context,xml));
checkContext=null;return ret;}];for(;i<len;i++){if((matcher=Expr.relative[tokens[i].type])){matchers=[addCombinator(elementMatcher(matchers),matcher)];
}else{matcher=Expr.filter[tokens[i].type].apply(null,tokens[i].matches);if(matcher[expando]){j=++i;for(;
j<len;j++){if(Expr.relative[tokens[j].type]){break;}}return setMatcher(i>1&&elementMatcher(matchers),i>1&&toSelector(tokens.slice(0,i-1).concat({value:tokens[i-2].type===" "?"*":""})).replace(rtrim,"$1"),matcher,i<j&&matcherFromTokens(tokens.slice(i,j)),j<len&&matcherFromTokens((tokens=tokens.slice(j))),j<len&&toSelector(tokens));
}matchers.push(matcher);}}return elementMatcher(matchers);}function matcherFromGroupMatchers(elementMatchers,setMatchers){var bySet=setMatchers.length>0,byElement=elementMatchers.length>0,superMatcher=function(seed,context,xml,results,outermost){var elem,j,matcher,matchedCount=0,i="0",unmatched=seed&&[],setMatched=[],contextBackup=outermostContext,elems=seed||byElement&&Expr.find.TAG("*",outermost),dirrunsUnique=(dirruns+=contextBackup==null?1:Math.random()||0.1),len=elems.length;
if(outermost){outermostContext=context===document||context||outermost;}for(;i!==len&&(elem=elems[i])!=null;
i++){if(byElement&&elem){j=0;if(!context&&elem.ownerDocument!==document){setDocument(elem);xml=!documentIsHTML;
}while((matcher=elementMatchers[j++])){if(matcher(elem,context||document,xml)){results.push(elem);break;
}}if(outermost){dirruns=dirrunsUnique;}}if(bySet){if((elem=!matcher&&elem)){matchedCount--;}if(seed){unmatched.push(elem);
}}}matchedCount+=i;if(bySet&&i!==matchedCount){j=0;while((matcher=setMatchers[j++])){matcher(unmatched,setMatched,context,xml);
}if(seed){if(matchedCount>0){while(i--){if(!(unmatched[i]||setMatched[i])){setMatched[i]=pop.call(results);
}}}setMatched=condense(setMatched);}push.apply(results,setMatched);if(outermost&&!seed&&setMatched.length>0&&(matchedCount+setMatchers.length)>1){Sizzle.uniqueSort(results);
}}if(outermost){dirruns=dirrunsUnique;outermostContext=contextBackup;}return unmatched;};return bySet?markFunction(superMatcher):superMatcher;
}compile=Sizzle.compile=function(selector,match){var i,setMatchers=[],elementMatchers=[],cached=compilerCache[selector+" "];
if(!cached){if(!match){match=tokenize(selector);}i=match.length;while(i--){cached=matcherFromTokens(match[i]);
if(cached[expando]){setMatchers.push(cached);}else{elementMatchers.push(cached);}}cached=compilerCache(selector,matcherFromGroupMatchers(elementMatchers,setMatchers));
cached.selector=selector;}return cached;};select=Sizzle.select=function(selector,context,results,seed){var i,tokens,token,type,find,compiled=typeof selector==="function"&&selector,match=!seed&&tokenize((selector=compiled.selector||selector));
results=results||[];if(match.length===1){tokens=match[0]=match[0].slice(0);if(tokens.length>2&&(token=tokens[0]).type==="ID"&&support.getById&&context.nodeType===9&&documentIsHTML&&Expr.relative[tokens[1].type]){context=(Expr.find.ID(token.matches[0].replace(runescape,funescape),context)||[])[0];
if(!context){return results;}else{if(compiled){context=context.parentNode;}}selector=selector.slice(tokens.shift().value.length);
}i=matchExpr.needsContext.test(selector)?0:tokens.length;while(i--){token=tokens[i];if(Expr.relative[(type=token.type)]){break;
}if((find=Expr.find[type])){if((seed=find(token.matches[0].replace(runescape,funescape),rsibling.test(tokens[0].type)&&testContext(context.parentNode)||context))){tokens.splice(i,1);
selector=seed.length&&toSelector(tokens);if(!selector){push.apply(results,seed);return results;}break;
}}}}(compiled||compile(selector,match))(seed,context,!documentIsHTML,results,!context||rsibling.test(selector)&&testContext(context.parentNode)||context);
return results;};support.sortStable=expando.split("").sort(sortOrder).join("")===expando;support.detectDuplicates=!!hasDuplicate;
setDocument();support.sortDetached=assert(function(div1){return div1.compareDocumentPosition(document.createElement("div"))&1;
});if(!assert(function(div){div.innerHTML="<a href='#'></a>";return div.firstChild.getAttribute("href")==="#";
})){addHandle("type|href|height|width",function(elem,name,isXML){if(!isXML){return elem.getAttribute(name,name.toLowerCase()==="type"?1:2);
}});}if(!support.attributes||!assert(function(div){div.innerHTML="<input/>";div.firstChild.setAttribute("value","");
return div.firstChild.getAttribute("value")==="";})){addHandle("value",function(elem,name,isXML){if(!isXML&&elem.nodeName.toLowerCase()==="input"){return elem.defaultValue;
}});}if(!assert(function(div){return div.getAttribute("disabled")==null;})){addHandle(booleans,function(elem,name,isXML){var val;
if(!isXML){return elem[name]===true?name.toLowerCase():(val=elem.getAttributeNode(name))&&val.specified?val.value:null;
}});}return Sizzle;})(window);jQuery.find=Sizzle;jQuery.expr=Sizzle.selectors;jQuery.expr[":"]=jQuery.expr.pseudos;
jQuery.uniqueSort=jQuery.unique=Sizzle.uniqueSort;jQuery.text=Sizzle.getText;jQuery.isXMLDoc=Sizzle.isXML;
jQuery.contains=Sizzle.contains;var dir=function(elem,dir,until){var matched=[],truncate=until!==undefined;
while((elem=elem[dir])&&elem.nodeType!==9){if(elem.nodeType===1){if(truncate&&jQuery(elem).is(until)){break;
}matched.push(elem);}}return matched;};var siblings=function(n,elem){var matched=[];for(;n;n=n.nextSibling){if(n.nodeType===1&&n!==elem){matched.push(n);
}}return matched;};var rneedsContext=jQuery.expr.match.needsContext;var rsingleTag=(/^<([\w-]+)\s*\/?>(?:<\/\1>|)$/);
var risSimple=/^.[^:#\[\.,]*$/;function winnow(elements,qualifier,not){if(jQuery.isFunction(qualifier)){return jQuery.grep(elements,function(elem,i){return !!qualifier.call(elem,i,elem)!==not;
});}if(qualifier.nodeType){return jQuery.grep(elements,function(elem){return(elem===qualifier)!==not;
});}if(typeof qualifier==="string"){if(risSimple.test(qualifier)){return jQuery.filter(qualifier,elements,not);
}qualifier=jQuery.filter(qualifier,elements);}return jQuery.grep(elements,function(elem){return(jQuery.inArray(elem,qualifier)>-1)!==not;
});}jQuery.filter=function(expr,elems,not){var elem=elems[0];if(not){expr=":not("+expr+")";}return elems.length===1&&elem.nodeType===1?jQuery.find.matchesSelector(elem,expr)?[elem]:[]:jQuery.find.matches(expr,jQuery.grep(elems,function(elem){return elem.nodeType===1;
}));};jQuery.fn.extend({find:function(selector){var i,ret=[],self=this,len=self.length;if(typeof selector!=="string"){return this.pushStack(jQuery(selector).filter(function(){for(i=0;
i<len;i++){if(jQuery.contains(self[i],this)){return true;}}}));}for(i=0;i<len;i++){jQuery.find(selector,self[i],ret);
}ret=this.pushStack(len>1?jQuery.unique(ret):ret);ret.selector=this.selector?this.selector+" "+selector:selector;
return ret;},filter:function(selector){return this.pushStack(winnow(this,selector||[],false));},not:function(selector){return this.pushStack(winnow(this,selector||[],true));
},is:function(selector){return !!winnow(this,typeof selector==="string"&&rneedsContext.test(selector)?jQuery(selector):selector||[],false).length;
}});var rootjQuery,rquickExpr=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,init=jQuery.fn.init=function(selector,context,root){var match,elem;
if(!selector){return this;}root=root||rootjQuery;if(typeof selector==="string"){if(selector.charAt(0)==="<"&&selector.charAt(selector.length-1)===">"&&selector.length>=3){match=[null,selector,null];
}else{match=rquickExpr.exec(selector);}if(match&&(match[1]||!context)){if(match[1]){context=context instanceof jQuery?context[0]:context;
jQuery.merge(this,jQuery.parseHTML(match[1],context&&context.nodeType?context.ownerDocument||context:document,true));
if(rsingleTag.test(match[1])&&jQuery.isPlainObject(context)){for(match in context){if(jQuery.isFunction(this[match])){this[match](context[match]);
}else{this.attr(match,context[match]);}}}return this;}else{elem=document.getElementById(match[2]);if(elem&&elem.parentNode){if(elem.id!==match[2]){return rootjQuery.find(selector);
}this.length=1;this[0]=elem;}this.context=document;this.selector=selector;return this;}}else{if(!context||context.jquery){return(context||root).find(selector);
}else{return this.constructor(context).find(selector);}}}else{if(selector.nodeType){this.context=this[0]=selector;
this.length=1;return this;}else{if(jQuery.isFunction(selector)){return typeof root.ready!=="undefined"?root.ready(selector):selector(jQuery);
}}}if(selector.selector!==undefined){this.selector=selector.selector;this.context=selector.context;}return jQuery.makeArray(selector,this);
};init.prototype=jQuery.fn;rootjQuery=jQuery(document);var rparentsprev=/^(?:parents|prev(?:Until|All))/,guaranteedUnique={children:true,contents:true,next:true,prev:true};
jQuery.fn.extend({has:function(target){var i,targets=jQuery(target,this),len=targets.length;return this.filter(function(){for(i=0;
i<len;i++){if(jQuery.contains(this,targets[i])){return true;}}});},closest:function(selectors,context){var cur,i=0,l=this.length,matched=[],pos=rneedsContext.test(selectors)||typeof selectors!=="string"?jQuery(selectors,context||this.context):0;
for(;i<l;i++){for(cur=this[i];cur&&cur!==context;cur=cur.parentNode){if(cur.nodeType<11&&(pos?pos.index(cur)>-1:cur.nodeType===1&&jQuery.find.matchesSelector(cur,selectors))){matched.push(cur);
break;}}}return this.pushStack(matched.length>1?jQuery.uniqueSort(matched):matched);},index:function(elem){if(!elem){return(this[0]&&this[0].parentNode)?this.first().prevAll().length:-1;
}if(typeof elem==="string"){return jQuery.inArray(this[0],jQuery(elem));}return jQuery.inArray(elem.jquery?elem[0]:elem,this);
},add:function(selector,context){return this.pushStack(jQuery.uniqueSort(jQuery.merge(this.get(),jQuery(selector,context))));
},addBack:function(selector){return this.add(selector==null?this.prevObject:this.prevObject.filter(selector));
}});function sibling(cur,dir){do{cur=cur[dir];}while(cur&&cur.nodeType!==1);return cur;}jQuery.each({parent:function(elem){var parent=elem.parentNode;
return parent&&parent.nodeType!==11?parent:null;},parents:function(elem){return dir(elem,"parentNode");
},parentsUntil:function(elem,i,until){return dir(elem,"parentNode",until);},next:function(elem){return sibling(elem,"nextSibling");
},prev:function(elem){return sibling(elem,"previousSibling");},nextAll:function(elem){return dir(elem,"nextSibling");
},prevAll:function(elem){return dir(elem,"previousSibling");},nextUntil:function(elem,i,until){return dir(elem,"nextSibling",until);
},prevUntil:function(elem,i,until){return dir(elem,"previousSibling",until);},siblings:function(elem){return siblings((elem.parentNode||{}).firstChild,elem);
},children:function(elem){return siblings(elem.firstChild);},contents:function(elem){return jQuery.nodeName(elem,"iframe")?elem.contentDocument||elem.contentWindow.document:jQuery.merge([],elem.childNodes);
}},function(name,fn){jQuery.fn[name]=function(until,selector){var ret=jQuery.map(this,fn,until);if(name.slice(-5)!=="Until"){selector=until;
}if(selector&&typeof selector==="string"){ret=jQuery.filter(selector,ret);}if(this.length>1){if(!guaranteedUnique[name]){ret=jQuery.uniqueSort(ret);
}if(rparentsprev.test(name)){ret=ret.reverse();}}return this.pushStack(ret);};});var rnotwhite=(/\S+/g);
function createOptions(options){var object={};jQuery.each(options.match(rnotwhite)||[],function(_,flag){object[flag]=true;
});return object;}jQuery.Callbacks=function(options){options=typeof options==="string"?createOptions(options):jQuery.extend({},options);
var firing,memory,fired,locked,list=[],queue=[],firingIndex=-1,fire=function(){locked=options.once;fired=firing=true;
for(;queue.length;firingIndex=-1){memory=queue.shift();while(++firingIndex<list.length){if(list[firingIndex].apply(memory[0],memory[1])===false&&options.stopOnFalse){firingIndex=list.length;
memory=false;}}}if(!options.memory){memory=false;}firing=false;if(locked){if(memory){list=[];}else{list="";
}}},self={add:function(){if(list){if(memory&&!firing){firingIndex=list.length-1;queue.push(memory);}(function add(args){jQuery.each(args,function(_,arg){if(jQuery.isFunction(arg)){if(!options.unique||!self.has(arg)){list.push(arg);
}}else{if(arg&&arg.length&&jQuery.type(arg)!=="string"){add(arg);}}});})(arguments);if(memory&&!firing){fire();
}}return this;},remove:function(){jQuery.each(arguments,function(_,arg){var index;while((index=jQuery.inArray(arg,list,index))>-1){list.splice(index,1);
if(index<=firingIndex){firingIndex--;}}});return this;},has:function(fn){return fn?jQuery.inArray(fn,list)>-1:list.length>0;
},empty:function(){if(list){list=[];}return this;},disable:function(){locked=queue=[];list=memory="";
return this;},disabled:function(){return !list;},lock:function(){locked=true;if(!memory){self.disable();
}return this;},locked:function(){return !!locked;},fireWith:function(context,args){if(!locked){args=args||[];
args=[context,args.slice?args.slice():args];queue.push(args);if(!firing){fire();}}return this;},fire:function(){self.fireWith(this,arguments);
return this;},fired:function(){return !!fired;}};return self;};jQuery.extend({Deferred:function(func){var tuples=[["resolve","done",jQuery.Callbacks("once memory"),"resolved"],["reject","fail",jQuery.Callbacks("once memory"),"rejected"],["notify","progress",jQuery.Callbacks("memory")]],state="pending",promise={state:function(){return state;
},always:function(){deferred.done(arguments).fail(arguments);return this;},then:function(){var fns=arguments;
return jQuery.Deferred(function(newDefer){jQuery.each(tuples,function(i,tuple){var fn=jQuery.isFunction(fns[i])&&fns[i];
deferred[tuple[1]](function(){var returned=fn&&fn.apply(this,arguments);if(returned&&jQuery.isFunction(returned.promise)){returned.promise().progress(newDefer.notify).done(newDefer.resolve).fail(newDefer.reject);
}else{newDefer[tuple[0]+"With"](this===promise?newDefer.promise():this,fn?[returned]:arguments);}});});
fns=null;}).promise();},promise:function(obj){return obj!=null?jQuery.extend(obj,promise):promise;}},deferred={};
promise.pipe=promise.then;jQuery.each(tuples,function(i,tuple){var list=tuple[2],stateString=tuple[3];
promise[tuple[1]]=list.add;if(stateString){list.add(function(){state=stateString;},tuples[i^1][2].disable,tuples[2][2].lock);
}deferred[tuple[0]]=function(){deferred[tuple[0]+"With"](this===deferred?promise:this,arguments);return this;
};deferred[tuple[0]+"With"]=list.fireWith;});promise.promise(deferred);if(func){func.call(deferred,deferred);
}return deferred;},when:function(subordinate){var i=0,resolveValues=slice.call(arguments),length=resolveValues.length,remaining=length!==1||(subordinate&&jQuery.isFunction(subordinate.promise))?length:0,deferred=remaining===1?subordinate:jQuery.Deferred(),updateFunc=function(i,contexts,values){return function(value){contexts[i]=this;
values[i]=arguments.length>1?slice.call(arguments):value;if(values===progressValues){deferred.notifyWith(contexts,values);
}else{if(!(--remaining)){deferred.resolveWith(contexts,values);}}};},progressValues,progressContexts,resolveContexts;
if(length>1){progressValues=new Array(length);progressContexts=new Array(length);resolveContexts=new Array(length);
for(;i<length;i++){if(resolveValues[i]&&jQuery.isFunction(resolveValues[i].promise)){resolveValues[i].promise().progress(updateFunc(i,progressContexts,progressValues)).done(updateFunc(i,resolveContexts,resolveValues)).fail(deferred.reject);
}else{--remaining;}}}if(!remaining){deferred.resolveWith(resolveContexts,resolveValues);}return deferred.promise();
}});var readyList;jQuery.fn.ready=function(fn){jQuery.ready.promise().done(fn);return this;};jQuery.extend({isReady:false,readyWait:1,holdReady:function(hold){if(hold){jQuery.readyWait++;
}else{jQuery.ready(true);}},ready:function(wait){if(wait===true?--jQuery.readyWait:jQuery.isReady){return;
}jQuery.isReady=true;if(wait!==true&&--jQuery.readyWait>0){return;}readyList.resolveWith(document,[jQuery]);
if(jQuery.fn.triggerHandler){jQuery(document).triggerHandler("ready");jQuery(document).off("ready");}}});
function detach(){if(document.addEventListener){document.removeEventListener("DOMContentLoaded",completed);
window.removeEventListener("load",completed);}else{document.detachEvent("onreadystatechange",completed);
window.detachEvent("onload",completed);}}function completed(){if(document.addEventListener||window.event.type==="load"||document.readyState==="complete"){detach();
jQuery.ready();}}jQuery.ready.promise=function(obj){if(!readyList){readyList=jQuery.Deferred();if(document.readyState==="complete"||(document.readyState!=="loading"&&!document.documentElement.doScroll)){window.setTimeout(jQuery.ready);
}else{if(document.addEventListener){document.addEventListener("DOMContentLoaded",completed);window.addEventListener("load",completed);
}else{document.attachEvent("onreadystatechange",completed);window.attachEvent("onload",completed);var top=false;
try{top=window.frameElement==null&&document.documentElement;}catch(e){}if(top&&top.doScroll){(function doScrollCheck(){if(!jQuery.isReady){try{top.doScroll("left");
}catch(e){return window.setTimeout(doScrollCheck,50);}detach();jQuery.ready();}})();}}}}return readyList.promise(obj);
};jQuery.ready.promise();var i;for(i in jQuery(support)){break;}support.ownFirst=i==="0";support.inlineBlockNeedsLayout=false;
jQuery(function(){var val,div,body,container;body=document.getElementsByTagName("body")[0];if(!body||!body.style){return;
}div=document.createElement("div");container=document.createElement("div");container.style.cssText="position:absolute;border:0;width:0;height:0;top:0;left:-9999px";
body.appendChild(container).appendChild(div);if(typeof div.style.zoom!=="undefined"){div.style.cssText="display:inline;margin:0;border:0;padding:1px;width:1px;zoom:1";
support.inlineBlockNeedsLayout=val=div.offsetWidth===3;if(val){body.style.zoom=1;}}body.removeChild(container);
});(function(){var div=document.createElement("div");support.deleteExpando=true;try{delete div.test;}catch(e){support.deleteExpando=false;
}div=null;})();var acceptData=function(elem){var noData=jQuery.noData[(elem.nodeName+" ").toLowerCase()],nodeType=+elem.nodeType||1;
return nodeType!==1&&nodeType!==9?false:!noData||noData!==true&&elem.getAttribute("classid")===noData;
};var rbrace=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,rmultiDash=/([A-Z])/g;function dataAttr(elem,key,data){if(data===undefined&&elem.nodeType===1){var name="data-"+key.replace(rmultiDash,"-$1").toLowerCase();
data=elem.getAttribute(name);if(typeof data==="string"){try{data=data==="true"?true:data==="false"?false:data==="null"?null:+data+""===data?+data:rbrace.test(data)?jQuery.parseJSON(data):data;
}catch(e){}jQuery.data(elem,key,data);}else{data=undefined;}}return data;}function isEmptyDataObject(obj){var name;
for(name in obj){if(name==="data"&&jQuery.isEmptyObject(obj[name])){continue;}if(name!=="toJSON"){return false;
}}return true;}function internalData(elem,name,data,pvt){if(!acceptData(elem)){return;}var ret,thisCache,internalKey=jQuery.expando,isNode=elem.nodeType,cache=isNode?jQuery.cache:elem,id=isNode?elem[internalKey]:elem[internalKey]&&internalKey;
if((!id||!cache[id]||(!pvt&&!cache[id].data))&&data===undefined&&typeof name==="string"){return;}if(!id){if(isNode){id=elem[internalKey]=deletedIds.pop()||jQuery.guid++;
}else{id=internalKey;}}if(!cache[id]){cache[id]=isNode?{}:{toJSON:jQuery.noop};}if(typeof name==="object"||typeof name==="function"){if(pvt){cache[id]=jQuery.extend(cache[id],name);
}else{cache[id].data=jQuery.extend(cache[id].data,name);}}thisCache=cache[id];if(!pvt){if(!thisCache.data){thisCache.data={};
}thisCache=thisCache.data;}if(data!==undefined){thisCache[jQuery.camelCase(name)]=data;}if(typeof name==="string"){ret=thisCache[name];
if(ret==null){ret=thisCache[jQuery.camelCase(name)];}}else{ret=thisCache;}return ret;}function internalRemoveData(elem,name,pvt){if(!acceptData(elem)){return;
}var thisCache,i,isNode=elem.nodeType,cache=isNode?jQuery.cache:elem,id=isNode?elem[jQuery.expando]:jQuery.expando;
if(!cache[id]){return;}if(name){thisCache=pvt?cache[id]:cache[id].data;if(thisCache){if(!jQuery.isArray(name)){if(name in thisCache){name=[name];
}else{name=jQuery.camelCase(name);if(name in thisCache){name=[name];}else{name=name.split(" ");}}}else{name=name.concat(jQuery.map(name,jQuery.camelCase));
}i=name.length;while(i--){delete thisCache[name[i]];}if(pvt?!isEmptyDataObject(thisCache):!jQuery.isEmptyObject(thisCache)){return;
}}}if(!pvt){delete cache[id].data;if(!isEmptyDataObject(cache[id])){return;}}if(isNode){jQuery.cleanData([elem],true);
}else{if(support.deleteExpando||cache!=cache.window){delete cache[id];}else{cache[id]=undefined;}}}jQuery.extend({cache:{},noData:{"applet ":true,"embed ":true,"object ":"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"},hasData:function(elem){elem=elem.nodeType?jQuery.cache[elem[jQuery.expando]]:elem[jQuery.expando];
return !!elem&&!isEmptyDataObject(elem);},data:function(elem,name,data){return internalData(elem,name,data);
},removeData:function(elem,name){return internalRemoveData(elem,name);},_data:function(elem,name,data){return internalData(elem,name,data,true);
},_removeData:function(elem,name){return internalRemoveData(elem,name,true);}});jQuery.fn.extend({data:function(key,value){var i,name,data,elem=this[0],attrs=elem&&elem.attributes;
if(key===undefined){if(this.length){data=jQuery.data(elem);if(elem.nodeType===1&&!jQuery._data(elem,"parsedAttrs")){i=attrs.length;
while(i--){if(attrs[i]){name=attrs[i].name;if(name.indexOf("data-")===0){name=jQuery.camelCase(name.slice(5));
dataAttr(elem,name,data[name]);}}}jQuery._data(elem,"parsedAttrs",true);}}return data;}if(typeof key==="object"){return this.each(function(){jQuery.data(this,key);
});}return arguments.length>1?this.each(function(){jQuery.data(this,key,value);}):elem?dataAttr(elem,key,jQuery.data(elem,key)):undefined;
},removeData:function(key){return this.each(function(){jQuery.removeData(this,key);});}});jQuery.extend({queue:function(elem,type,data){var queue;
if(elem){type=(type||"fx")+"queue";queue=jQuery._data(elem,type);if(data){if(!queue||jQuery.isArray(data)){queue=jQuery._data(elem,type,jQuery.makeArray(data));
}else{queue.push(data);}}return queue||[];}},dequeue:function(elem,type){type=type||"fx";var queue=jQuery.queue(elem,type),startLength=queue.length,fn=queue.shift(),hooks=jQuery._queueHooks(elem,type),next=function(){jQuery.dequeue(elem,type);
};if(fn==="inprogress"){fn=queue.shift();startLength--;}if(fn){if(type==="fx"){queue.unshift("inprogress");
}delete hooks.stop;fn.call(elem,next,hooks);}if(!startLength&&hooks){hooks.empty.fire();}},_queueHooks:function(elem,type){var key=type+"queueHooks";
return jQuery._data(elem,key)||jQuery._data(elem,key,{empty:jQuery.Callbacks("once memory").add(function(){jQuery._removeData(elem,type+"queue");
jQuery._removeData(elem,key);})});}});jQuery.fn.extend({queue:function(type,data){var setter=2;if(typeof type!=="string"){data=type;
type="fx";setter--;}if(arguments.length<setter){return jQuery.queue(this[0],type);}return data===undefined?this:this.each(function(){var queue=jQuery.queue(this,type,data);
jQuery._queueHooks(this,type);if(type==="fx"&&queue[0]!=="inprogress"){jQuery.dequeue(this,type);}});
},dequeue:function(type){return this.each(function(){jQuery.dequeue(this,type);});},clearQueue:function(type){return this.queue(type||"fx",[]);
},promise:function(type,obj){var tmp,count=1,defer=jQuery.Deferred(),elements=this,i=this.length,resolve=function(){if(!(--count)){defer.resolveWith(elements,[elements]);
}};if(typeof type!=="string"){obj=type;type=undefined;}type=type||"fx";while(i--){tmp=jQuery._data(elements[i],type+"queueHooks");
if(tmp&&tmp.empty){count++;tmp.empty.add(resolve);}}resolve();return defer.promise(obj);}});(function(){var shrinkWrapBlocksVal;
support.shrinkWrapBlocks=function(){if(shrinkWrapBlocksVal!=null){return shrinkWrapBlocksVal;}shrinkWrapBlocksVal=false;
var div,body,container;body=document.getElementsByTagName("body")[0];if(!body||!body.style){return;}div=document.createElement("div");
container=document.createElement("div");container.style.cssText="position:absolute;border:0;width:0;height:0;top:0;left:-9999px";
body.appendChild(container).appendChild(div);if(typeof div.style.zoom!=="undefined"){div.style.cssText="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:1px;width:1px;zoom:1";
div.appendChild(document.createElement("div")).style.width="5px";shrinkWrapBlocksVal=div.offsetWidth!==3;
}body.removeChild(container);return shrinkWrapBlocksVal;};})();var pnum=(/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/).source;
var rcssNum=new RegExp("^(?:([+-])=|)("+pnum+")([a-z%]*)$","i");var cssExpand=["Top","Right","Bottom","Left"];
var isHidden=function(elem,el){elem=el||elem;return jQuery.css(elem,"display")==="none"||!jQuery.contains(elem.ownerDocument,elem);
};function adjustCSS(elem,prop,valueParts,tween){var adjusted,scale=1,maxIterations=20,currentValue=tween?function(){return tween.cur();
}:function(){return jQuery.css(elem,prop,"");},initial=currentValue(),unit=valueParts&&valueParts[3]||(jQuery.cssNumber[prop]?"":"px"),initialInUnit=(jQuery.cssNumber[prop]||unit!=="px"&&+initial)&&rcssNum.exec(jQuery.css(elem,prop));
if(initialInUnit&&initialInUnit[3]!==unit){unit=unit||initialInUnit[3];valueParts=valueParts||[];initialInUnit=+initial||1;
do{scale=scale||".5";initialInUnit=initialInUnit/scale;jQuery.style(elem,prop,initialInUnit+unit);}while(scale!==(scale=currentValue()/initial)&&scale!==1&&--maxIterations);
}if(valueParts){initialInUnit=+initialInUnit||+initial||0;adjusted=valueParts[1]?initialInUnit+(valueParts[1]+1)*valueParts[2]:+valueParts[2];
if(tween){tween.unit=unit;tween.start=initialInUnit;tween.end=adjusted;}}return adjusted;}var access=function(elems,fn,key,value,chainable,emptyGet,raw){var i=0,length=elems.length,bulk=key==null;
if(jQuery.type(key)==="object"){chainable=true;for(i in key){access(elems,fn,i,key[i],true,emptyGet,raw);
}}else{if(value!==undefined){chainable=true;if(!jQuery.isFunction(value)){raw=true;}if(bulk){if(raw){fn.call(elems,value);
fn=null;}else{bulk=fn;fn=function(elem,key,value){return bulk.call(jQuery(elem),value);};}}if(fn){for(;
i<length;i++){fn(elems[i],key,raw?value:value.call(elems[i],i,fn(elems[i],key)));}}}}return chainable?elems:bulk?fn.call(elems):length?fn(elems[0],key):emptyGet;
};var rcheckableType=(/^(?:checkbox|radio)$/i);var rtagName=(/<([\w:-]+)/);var rscriptType=(/^$|\/(?:java|ecma)script/i);
var rleadingWhitespace=(/^\s+/);var nodeNames="abbr|article|aside|audio|bdi|canvas|data|datalist|details|dialog|figcaption|figure|footer|header|hgroup|main|mark|meter|nav|output|picture|progress|section|summary|template|time|video";
function createSafeFragment(document){var list=nodeNames.split("|"),safeFrag=document.createDocumentFragment();
if(safeFrag.createElement){while(list.length){safeFrag.createElement(list.pop());}}return safeFrag;}(function(){var div=document.createElement("div"),fragment=document.createDocumentFragment(),input=document.createElement("input");
div.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>";support.leadingWhitespace=div.firstChild.nodeType===3;
support.tbody=!div.getElementsByTagName("tbody").length;support.htmlSerialize=!!div.getElementsByTagName("link").length;
support.html5Clone=document.createElement("nav").cloneNode(true).outerHTML!=="<:nav></:nav>";input.type="checkbox";
input.checked=true;fragment.appendChild(input);support.appendChecked=input.checked;div.innerHTML="<textarea>x</textarea>";
support.noCloneChecked=!!div.cloneNode(true).lastChild.defaultValue;fragment.appendChild(div);input=document.createElement("input");
input.setAttribute("type","radio");input.setAttribute("checked","checked");input.setAttribute("name","t");
div.appendChild(input);support.checkClone=div.cloneNode(true).cloneNode(true).lastChild.checked;support.noCloneEvent=!!div.addEventListener;
div[jQuery.expando]=1;support.attributes=!div.getAttribute(jQuery.expando);})();var wrapMap={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:support.htmlSerialize?[0,"",""]:[1,"X<div>","</div>"]};
wrapMap.optgroup=wrapMap.option;wrapMap.tbody=wrapMap.tfoot=wrapMap.colgroup=wrapMap.caption=wrapMap.thead;
wrapMap.th=wrapMap.td;function getAll(context,tag){var elems,elem,i=0,found=typeof context.getElementsByTagName!=="undefined"?context.getElementsByTagName(tag||"*"):typeof context.querySelectorAll!=="undefined"?context.querySelectorAll(tag||"*"):undefined;
if(!found){for(found=[],elems=context.childNodes||context;(elem=elems[i])!=null;i++){if(!tag||jQuery.nodeName(elem,tag)){found.push(elem);
}else{jQuery.merge(found,getAll(elem,tag));}}}return tag===undefined||tag&&jQuery.nodeName(context,tag)?jQuery.merge([context],found):found;
}function setGlobalEval(elems,refElements){var elem,i=0;for(;(elem=elems[i])!=null;i++){jQuery._data(elem,"globalEval",!refElements||jQuery._data(refElements[i],"globalEval"));
}}var rhtml=/<|&#?\w+;/,rtbody=/<tbody/i;function fixDefaultChecked(elem){if(rcheckableType.test(elem.type)){elem.defaultChecked=elem.checked;
}}function buildFragment(elems,context,scripts,selection,ignored){var j,elem,contains,tmp,tag,tbody,wrap,l=elems.length,safe=createSafeFragment(context),nodes=[],i=0;
for(;i<l;i++){elem=elems[i];if(elem||elem===0){if(jQuery.type(elem)==="object"){jQuery.merge(nodes,elem.nodeType?[elem]:elem);
}else{if(!rhtml.test(elem)){nodes.push(context.createTextNode(elem));}else{tmp=tmp||safe.appendChild(context.createElement("div"));
tag=(rtagName.exec(elem)||["",""])[1].toLowerCase();wrap=wrapMap[tag]||wrapMap._default;tmp.innerHTML=wrap[1]+jQuery.htmlPrefilter(elem)+wrap[2];
j=wrap[0];while(j--){tmp=tmp.lastChild;}if(!support.leadingWhitespace&&rleadingWhitespace.test(elem)){nodes.push(context.createTextNode(rleadingWhitespace.exec(elem)[0]));
}if(!support.tbody){elem=tag==="table"&&!rtbody.test(elem)?tmp.firstChild:wrap[1]==="<table>"&&!rtbody.test(elem)?tmp:0;
j=elem&&elem.childNodes.length;while(j--){if(jQuery.nodeName((tbody=elem.childNodes[j]),"tbody")&&!tbody.childNodes.length){elem.removeChild(tbody);
}}}jQuery.merge(nodes,tmp.childNodes);tmp.textContent="";while(tmp.firstChild){tmp.removeChild(tmp.firstChild);
}tmp=safe.lastChild;}}}}if(tmp){safe.removeChild(tmp);}if(!support.appendChecked){jQuery.grep(getAll(nodes,"input"),fixDefaultChecked);
}i=0;while((elem=nodes[i++])){if(selection&&jQuery.inArray(elem,selection)>-1){if(ignored){ignored.push(elem);
}continue;}contains=jQuery.contains(elem.ownerDocument,elem);tmp=getAll(safe.appendChild(elem),"script");
if(contains){setGlobalEval(tmp);}if(scripts){j=0;while((elem=tmp[j++])){if(rscriptType.test(elem.type||"")){scripts.push(elem);
}}}}tmp=null;return safe;}(function(){var i,eventName,div=document.createElement("div");for(i in {submit:true,change:true,focusin:true}){eventName="on"+i;
if(!(support[i]=eventName in window)){div.setAttribute(eventName,"t");support[i]=div.attributes[eventName].expando===false;
}}div=null;})();var rformElems=/^(?:input|select|textarea)$/i,rkeyEvent=/^key/,rmouseEvent=/^(?:mouse|pointer|contextmenu|drag|drop)|click/,rfocusMorph=/^(?:focusinfocus|focusoutblur)$/,rtypenamespace=/^([^.]*)(?:\.(.+)|)/;
function returnTrue(){return true;}function returnFalse(){return false;}function safeActiveElement(){try{return document.activeElement;
}catch(err){}}function on(elem,types,selector,data,fn,one){var origFn,type;if(typeof types==="object"){if(typeof selector!=="string"){data=data||selector;
selector=undefined;}for(type in types){on(elem,type,selector,data,types[type],one);}return elem;}if(data==null&&fn==null){fn=selector;
data=selector=undefined;}else{if(fn==null){if(typeof selector==="string"){fn=data;data=undefined;}else{fn=data;
data=selector;selector=undefined;}}}if(fn===false){fn=returnFalse;}else{if(!fn){return elem;}}if(one===1){origFn=fn;
fn=function(event){jQuery().off(event);return origFn.apply(this,arguments);};fn.guid=origFn.guid||(origFn.guid=jQuery.guid++);
}return elem.each(function(){jQuery.event.add(this,types,fn,data,selector);});}jQuery.event={global:{},add:function(elem,types,handler,data,selector){var tmp,events,t,handleObjIn,special,eventHandle,handleObj,handlers,type,namespaces,origType,elemData=jQuery._data(elem);
if(!elemData){return;}if(handler.handler){handleObjIn=handler;handler=handleObjIn.handler;selector=handleObjIn.selector;
}if(!handler.guid){handler.guid=jQuery.guid++;}if(!(events=elemData.events)){events=elemData.events={};
}if(!(eventHandle=elemData.handle)){eventHandle=elemData.handle=function(e){return typeof jQuery!=="undefined"&&(!e||jQuery.event.triggered!==e.type)?jQuery.event.dispatch.apply(eventHandle.elem,arguments):undefined;
};eventHandle.elem=elem;}types=(types||"").match(rnotwhite)||[""];t=types.length;while(t--){tmp=rtypenamespace.exec(types[t])||[];
type=origType=tmp[1];namespaces=(tmp[2]||"").split(".").sort();if(!type){continue;}special=jQuery.event.special[type]||{};
type=(selector?special.delegateType:special.bindType)||type;special=jQuery.event.special[type]||{};handleObj=jQuery.extend({type:type,origType:origType,data:data,handler:handler,guid:handler.guid,selector:selector,needsContext:selector&&jQuery.expr.match.needsContext.test(selector),namespace:namespaces.join(".")},handleObjIn);
if(!(handlers=events[type])){handlers=events[type]=[];handlers.delegateCount=0;if(!special.setup||special.setup.call(elem,data,namespaces,eventHandle)===false){if(elem.addEventListener){elem.addEventListener(type,eventHandle,false);
}else{if(elem.attachEvent){elem.attachEvent("on"+type,eventHandle);}}}}if(special.add){special.add.call(elem,handleObj);
if(!handleObj.handler.guid){handleObj.handler.guid=handler.guid;}}if(selector){handlers.splice(handlers.delegateCount++,0,handleObj);
}else{handlers.push(handleObj);}jQuery.event.global[type]=true;}elem=null;},remove:function(elem,types,handler,selector,mappedTypes){var j,handleObj,tmp,origCount,t,events,special,handlers,type,namespaces,origType,elemData=jQuery.hasData(elem)&&jQuery._data(elem);
if(!elemData||!(events=elemData.events)){return;}types=(types||"").match(rnotwhite)||[""];t=types.length;
while(t--){tmp=rtypenamespace.exec(types[t])||[];type=origType=tmp[1];namespaces=(tmp[2]||"").split(".").sort();
if(!type){for(type in events){jQuery.event.remove(elem,type+types[t],handler,selector,true);}continue;
}special=jQuery.event.special[type]||{};type=(selector?special.delegateType:special.bindType)||type;handlers=events[type]||[];
tmp=tmp[2]&&new RegExp("(^|\\.)"+namespaces.join("\\.(?:.*\\.|)")+"(\\.|$)");origCount=j=handlers.length;
while(j--){handleObj=handlers[j];if((mappedTypes||origType===handleObj.origType)&&(!handler||handler.guid===handleObj.guid)&&(!tmp||tmp.test(handleObj.namespace))&&(!selector||selector===handleObj.selector||selector==="**"&&handleObj.selector)){handlers.splice(j,1);
if(handleObj.selector){handlers.delegateCount--;}if(special.remove){special.remove.call(elem,handleObj);
}}}if(origCount&&!handlers.length){if(!special.teardown||special.teardown.call(elem,namespaces,elemData.handle)===false){jQuery.removeEvent(elem,type,elemData.handle);
}delete events[type];}}if(jQuery.isEmptyObject(events)){delete elemData.handle;jQuery._removeData(elem,"events");
}},trigger:function(event,data,elem,onlyHandlers){var handle,ontype,cur,bubbleType,special,tmp,i,eventPath=[elem||document],type=hasOwn.call(event,"type")?event.type:event,namespaces=hasOwn.call(event,"namespace")?event.namespace.split("."):[];
cur=tmp=elem=elem||document;if(elem.nodeType===3||elem.nodeType===8){return;}if(rfocusMorph.test(type+jQuery.event.triggered)){return;
}if(type.indexOf(".")>-1){namespaces=type.split(".");type=namespaces.shift();namespaces.sort();}ontype=type.indexOf(":")<0&&"on"+type;
event=event[jQuery.expando]?event:new jQuery.Event(type,typeof event==="object"&&event);event.isTrigger=onlyHandlers?2:3;
event.namespace=namespaces.join(".");event.rnamespace=event.namespace?new RegExp("(^|\\.)"+namespaces.join("\\.(?:.*\\.|)")+"(\\.|$)"):null;
event.result=undefined;if(!event.target){event.target=elem;}data=data==null?[event]:jQuery.makeArray(data,[event]);
special=jQuery.event.special[type]||{};if(!onlyHandlers&&special.trigger&&special.trigger.apply(elem,data)===false){return;
}if(!onlyHandlers&&!special.noBubble&&!jQuery.isWindow(elem)){bubbleType=special.delegateType||type;if(!rfocusMorph.test(bubbleType+type)){cur=cur.parentNode;
}for(;cur;cur=cur.parentNode){eventPath.push(cur);tmp=cur;}if(tmp===(elem.ownerDocument||document)){eventPath.push(tmp.defaultView||tmp.parentWindow||window);
}}i=0;while((cur=eventPath[i++])&&!event.isPropagationStopped()){event.type=i>1?bubbleType:special.bindType||type;
handle=(jQuery._data(cur,"events")||{})[event.type]&&jQuery._data(cur,"handle");if(handle){handle.apply(cur,data);
}handle=ontype&&cur[ontype];if(handle&&handle.apply&&acceptData(cur)){event.result=handle.apply(cur,data);
if(event.result===false){event.preventDefault();}}}event.type=type;if(!onlyHandlers&&!event.isDefaultPrevented()){if((!special._default||special._default.apply(eventPath.pop(),data)===false)&&acceptData(elem)){if(ontype&&elem[type]&&!jQuery.isWindow(elem)){tmp=elem[ontype];
if(tmp){elem[ontype]=null;}jQuery.event.triggered=type;try{elem[type]();}catch(e){}jQuery.event.triggered=undefined;
if(tmp){elem[ontype]=tmp;}}}}return event.result;},dispatch:function(event){event=jQuery.event.fix(event);
var i,j,ret,matched,handleObj,handlerQueue=[],args=slice.call(arguments),handlers=(jQuery._data(this,"events")||{})[event.type]||[],special=jQuery.event.special[event.type]||{};
args[0]=event;event.delegateTarget=this;if(special.preDispatch&&special.preDispatch.call(this,event)===false){return;
}handlerQueue=jQuery.event.handlers.call(this,event,handlers);i=0;while((matched=handlerQueue[i++])&&!event.isPropagationStopped()){event.currentTarget=matched.elem;
j=0;while((handleObj=matched.handlers[j++])&&!event.isImmediatePropagationStopped()){if(!event.rnamespace||event.rnamespace.test(handleObj.namespace)){event.handleObj=handleObj;
event.data=handleObj.data;ret=((jQuery.event.special[handleObj.origType]||{}).handle||handleObj.handler).apply(matched.elem,args);
if(ret!==undefined){if((event.result=ret)===false){event.preventDefault();event.stopPropagation();}}}}}if(special.postDispatch){special.postDispatch.call(this,event);
}return event.result;},handlers:function(event,handlers){var i,matches,sel,handleObj,handlerQueue=[],delegateCount=handlers.delegateCount,cur=event.target;
if(delegateCount&&cur.nodeType&&(event.type!=="click"||isNaN(event.button)||event.button<1)){for(;cur!=this;
cur=cur.parentNode||this){if(cur.nodeType===1&&(cur.disabled!==true||event.type!=="click")){matches=[];
for(i=0;i<delegateCount;i++){handleObj=handlers[i];sel=handleObj.selector+" ";if(matches[sel]===undefined){matches[sel]=handleObj.needsContext?jQuery(sel,this).index(cur)>-1:jQuery.find(sel,this,null,[cur]).length;
}if(matches[sel]){matches.push(handleObj);}}if(matches.length){handlerQueue.push({elem:cur,handlers:matches});
}}}}if(delegateCount<handlers.length){handlerQueue.push({elem:this,handlers:handlers.slice(delegateCount)});
}return handlerQueue;},fix:function(event){if(event[jQuery.expando]){return event;}var i,prop,copy,type=event.type,originalEvent=event,fixHook=this.fixHooks[type];
if(!fixHook){this.fixHooks[type]=fixHook=rmouseEvent.test(type)?this.mouseHooks:rkeyEvent.test(type)?this.keyHooks:{};
}copy=fixHook.props?this.props.concat(fixHook.props):this.props;event=new jQuery.Event(originalEvent);
i=copy.length;while(i--){prop=copy[i];event[prop]=originalEvent[prop];}if(!event.target){event.target=originalEvent.srcElement||document;
}if(event.target.nodeType===3){event.target=event.target.parentNode;}event.metaKey=!!event.metaKey;return fixHook.filter?fixHook.filter(event,originalEvent):event;
},props:("altKey bubbles cancelable ctrlKey currentTarget detail eventPhase metaKey relatedTarget shiftKey target timeStamp view which").split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(event,original){if(event.which==null){event.which=original.charCode!=null?original.charCode:original.keyCode;
}return event;}},mouseHooks:{props:("button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement").split(" "),filter:function(event,original){var body,eventDoc,doc,button=original.button,fromElement=original.fromElement;
if(event.pageX==null&&original.clientX!=null){eventDoc=event.target.ownerDocument||document;doc=eventDoc.documentElement;
body=eventDoc.body;event.pageX=original.clientX+(doc&&doc.scrollLeft||body&&body.scrollLeft||0)-(doc&&doc.clientLeft||body&&body.clientLeft||0);
event.pageY=original.clientY+(doc&&doc.scrollTop||body&&body.scrollTop||0)-(doc&&doc.clientTop||body&&body.clientTop||0);
}if(!event.relatedTarget&&fromElement){event.relatedTarget=fromElement===event.target?original.toElement:fromElement;
}if(!event.which&&button!==undefined){event.which=(button&1?1:(button&2?3:(button&4?2:0)));}return event;
}},special:{load:{noBubble:true},focus:{trigger:function(){if(this!==safeActiveElement()&&this.focus){try{this.focus();
return false;}catch(e){}}},delegateType:"focusin"},blur:{trigger:function(){if(this===safeActiveElement()&&this.blur){this.blur();
return false;}},delegateType:"focusout"},click:{trigger:function(){if(jQuery.nodeName(this,"input")&&this.type==="checkbox"&&this.click){this.click();
return false;}},_default:function(event){return jQuery.nodeName(event.target,"a");}},beforeunload:{postDispatch:function(event){if(event.result!==undefined&&event.originalEvent){event.originalEvent.returnValue=event.result;
}}}},simulate:function(type,elem,event){var e=jQuery.extend(new jQuery.Event(),event,{type:type,isSimulated:true});
jQuery.event.trigger(e,null,elem);if(e.isDefaultPrevented()){event.preventDefault();}}};jQuery.removeEvent=document.removeEventListener?function(elem,type,handle){if(elem.removeEventListener){elem.removeEventListener(type,handle);
}}:function(elem,type,handle){var name="on"+type;if(elem.detachEvent){if(typeof elem[name]==="undefined"){elem[name]=null;
}elem.detachEvent(name,handle);}};jQuery.Event=function(src,props){if(!(this instanceof jQuery.Event)){return new jQuery.Event(src,props);
}if(src&&src.type){this.originalEvent=src;this.type=src.type;this.isDefaultPrevented=src.defaultPrevented||src.defaultPrevented===undefined&&src.returnValue===false?returnTrue:returnFalse;
}else{this.type=src;}if(props){jQuery.extend(this,props);}this.timeStamp=src&&src.timeStamp||jQuery.now();
this[jQuery.expando]=true;};jQuery.Event.prototype={constructor:jQuery.Event,isDefaultPrevented:returnFalse,isPropagationStopped:returnFalse,isImmediatePropagationStopped:returnFalse,preventDefault:function(){var e=this.originalEvent;
this.isDefaultPrevented=returnTrue;if(!e){return;}if(e.preventDefault){e.preventDefault();}else{e.returnValue=false;
}},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=returnTrue;if(!e||this.isSimulated){return;
}if(e.stopPropagation){e.stopPropagation();}e.cancelBubble=true;},stopImmediatePropagation:function(){var e=this.originalEvent;
this.isImmediatePropagationStopped=returnTrue;if(e&&e.stopImmediatePropagation){e.stopImmediatePropagation();
}this.stopPropagation();}};jQuery.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(orig,fix){jQuery.event.special[orig]={delegateType:fix,bindType:fix,handle:function(event){var ret,target=this,related=event.relatedTarget,handleObj=event.handleObj;
if(!related||(related!==target&&!jQuery.contains(target,related))){event.type=handleObj.origType;ret=handleObj.handler.apply(this,arguments);
event.type=fix;}return ret;}};});if(!support.submit){jQuery.event.special.submit={setup:function(){if(jQuery.nodeName(this,"form")){return false;
}jQuery.event.add(this,"click._submit keypress._submit",function(e){var elem=e.target,form=jQuery.nodeName(elem,"input")||jQuery.nodeName(elem,"button")?jQuery.prop(elem,"form"):undefined;
if(form&&!jQuery._data(form,"submit")){jQuery.event.add(form,"submit._submit",function(event){event._submitBubble=true;
});jQuery._data(form,"submit",true);}});},postDispatch:function(event){if(event._submitBubble){delete event._submitBubble;
if(this.parentNode&&!event.isTrigger){jQuery.event.simulate("submit",this.parentNode,event);}}},teardown:function(){if(jQuery.nodeName(this,"form")){return false;
}jQuery.event.remove(this,"._submit");}};}if(!support.change){jQuery.event.special.change={setup:function(){if(rformElems.test(this.nodeName)){if(this.type==="checkbox"||this.type==="radio"){jQuery.event.add(this,"propertychange._change",function(event){if(event.originalEvent.propertyName==="checked"){this._justChanged=true;
}});jQuery.event.add(this,"click._change",function(event){if(this._justChanged&&!event.isTrigger){this._justChanged=false;
}jQuery.event.simulate("change",this,event);});}return false;}jQuery.event.add(this,"beforeactivate._change",function(e){var elem=e.target;
if(rformElems.test(elem.nodeName)&&!jQuery._data(elem,"change")){jQuery.event.add(elem,"change._change",function(event){if(this.parentNode&&!event.isSimulated&&!event.isTrigger){jQuery.event.simulate("change",this.parentNode,event);
}});jQuery._data(elem,"change",true);}});},handle:function(event){var elem=event.target;if(this!==elem||event.isSimulated||event.isTrigger||(elem.type!=="radio"&&elem.type!=="checkbox")){return event.handleObj.handler.apply(this,arguments);
}},teardown:function(){jQuery.event.remove(this,"._change");return !rformElems.test(this.nodeName);}};
}if(!support.focusin){jQuery.each({focus:"focusin",blur:"focusout"},function(orig,fix){var handler=function(event){jQuery.event.simulate(fix,event.target,jQuery.event.fix(event));
};jQuery.event.special[fix]={setup:function(){var doc=this.ownerDocument||this,attaches=jQuery._data(doc,fix);
if(!attaches){doc.addEventListener(orig,handler,true);}jQuery._data(doc,fix,(attaches||0)+1);},teardown:function(){var doc=this.ownerDocument||this,attaches=jQuery._data(doc,fix)-1;
if(!attaches){doc.removeEventListener(orig,handler,true);jQuery._removeData(doc,fix);}else{jQuery._data(doc,fix,attaches);
}}};});}jQuery.fn.extend({on:function(types,selector,data,fn){return on(this,types,selector,data,fn);
},one:function(types,selector,data,fn){return on(this,types,selector,data,fn,1);},off:function(types,selector,fn){var handleObj,type;
if(types&&types.preventDefault&&types.handleObj){handleObj=types.handleObj;jQuery(types.delegateTarget).off(handleObj.namespace?handleObj.origType+"."+handleObj.namespace:handleObj.origType,handleObj.selector,handleObj.handler);
return this;}if(typeof types==="object"){for(type in types){this.off(type,selector,types[type]);}return this;
}if(selector===false||typeof selector==="function"){fn=selector;selector=undefined;}if(fn===false){fn=returnFalse;
}return this.each(function(){jQuery.event.remove(this,types,fn,selector);});},trigger:function(type,data){return this.each(function(){jQuery.event.trigger(type,data,this);
});},triggerHandler:function(type,data){var elem=this[0];if(elem){return jQuery.event.trigger(type,data,elem,true);
}}});var rinlinejQuery=/ jQuery\d+="(?:null|\d+)"/g,rnoshimcache=new RegExp("<(?:"+nodeNames+")[\\s/>]","i"),rxhtmlTag=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:-]+)[^>]*)\/>/gi,rnoInnerhtml=/<script|<style|<link/i,rchecked=/checked\s*(?:[^=]|=\s*.checked.)/i,rscriptTypeMasked=/^true\/(.*)/,rcleanScript=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,safeFragment=createSafeFragment(document),fragmentDiv=safeFragment.appendChild(document.createElement("div"));
function manipulationTarget(elem,content){return jQuery.nodeName(elem,"table")&&jQuery.nodeName(content.nodeType!==11?content:content.firstChild,"tr")?elem.getElementsByTagName("tbody")[0]||elem.appendChild(elem.ownerDocument.createElement("tbody")):elem;
}function disableScript(elem){elem.type=(jQuery.find.attr(elem,"type")!==null)+"/"+elem.type;return elem;
}function restoreScript(elem){var match=rscriptTypeMasked.exec(elem.type);if(match){elem.type=match[1];
}else{elem.removeAttribute("type");}return elem;}function cloneCopyEvent(src,dest){if(dest.nodeType!==1||!jQuery.hasData(src)){return;
}var type,i,l,oldData=jQuery._data(src),curData=jQuery._data(dest,oldData),events=oldData.events;if(events){delete curData.handle;
curData.events={};for(type in events){for(i=0,l=events[type].length;i<l;i++){jQuery.event.add(dest,type,events[type][i]);
}}}if(curData.data){curData.data=jQuery.extend({},curData.data);}}function fixCloneNodeIssues(src,dest){var nodeName,e,data;
if(dest.nodeType!==1){return;}nodeName=dest.nodeName.toLowerCase();if(!support.noCloneEvent&&dest[jQuery.expando]){data=jQuery._data(dest);
for(e in data.events){jQuery.removeEvent(dest,e,data.handle);}dest.removeAttribute(jQuery.expando);}if(nodeName==="script"&&dest.text!==src.text){disableScript(dest).text=src.text;
restoreScript(dest);}else{if(nodeName==="object"){if(dest.parentNode){dest.outerHTML=src.outerHTML;}if(support.html5Clone&&(src.innerHTML&&!jQuery.trim(dest.innerHTML))){dest.innerHTML=src.innerHTML;
}}else{if(nodeName==="input"&&rcheckableType.test(src.type)){dest.defaultChecked=dest.checked=src.checked;
if(dest.value!==src.value){dest.value=src.value;}}else{if(nodeName==="option"){dest.defaultSelected=dest.selected=src.defaultSelected;
}else{if(nodeName==="input"||nodeName==="textarea"){dest.defaultValue=src.defaultValue;}}}}}}function domManip(collection,args,callback,ignored){args=concat.apply([],args);
var first,node,hasScripts,scripts,doc,fragment,i=0,l=collection.length,iNoClone=l-1,value=args[0],isFunction=jQuery.isFunction(value);
if(isFunction||(l>1&&typeof value==="string"&&!support.checkClone&&rchecked.test(value))){return collection.each(function(index){var self=collection.eq(index);
if(isFunction){args[0]=value.call(this,index,self.html());}domManip(self,args,callback,ignored);});}if(l){fragment=buildFragment(args,collection[0].ownerDocument,false,collection,ignored);
first=fragment.firstChild;if(fragment.childNodes.length===1){fragment=first;}if(first||ignored){scripts=jQuery.map(getAll(fragment,"script"),disableScript);
hasScripts=scripts.length;for(;i<l;i++){node=fragment;if(i!==iNoClone){node=jQuery.clone(node,true,true);
if(hasScripts){jQuery.merge(scripts,getAll(node,"script"));}}callback.call(collection[i],node,i);}if(hasScripts){doc=scripts[scripts.length-1].ownerDocument;
jQuery.map(scripts,restoreScript);for(i=0;i<hasScripts;i++){node=scripts[i];if(rscriptType.test(node.type||"")&&!jQuery._data(node,"globalEval")&&jQuery.contains(doc,node)){if(node.src){if(jQuery._evalUrl){jQuery._evalUrl(node.src);
}}else{jQuery.globalEval((node.text||node.textContent||node.innerHTML||"").replace(rcleanScript,""));
}}}}fragment=first=null;}}return collection;}function remove(elem,selector,keepData){var node,elems=selector?jQuery.filter(selector,elem):elem,i=0;
for(;(node=elems[i])!=null;i++){if(!keepData&&node.nodeType===1){jQuery.cleanData(getAll(node));}if(node.parentNode){if(keepData&&jQuery.contains(node.ownerDocument,node)){setGlobalEval(getAll(node,"script"));
}node.parentNode.removeChild(node);}}return elem;}jQuery.extend({htmlPrefilter:function(html){return html.replace(rxhtmlTag,"<$1></$2>");
},clone:function(elem,dataAndEvents,deepDataAndEvents){var destElements,node,clone,i,srcElements,inPage=jQuery.contains(elem.ownerDocument,elem);
if(support.html5Clone||jQuery.isXMLDoc(elem)||!rnoshimcache.test("<"+elem.nodeName+">")){clone=elem.cloneNode(true);
}else{fragmentDiv.innerHTML=elem.outerHTML;fragmentDiv.removeChild(clone=fragmentDiv.firstChild);}if((!support.noCloneEvent||!support.noCloneChecked)&&(elem.nodeType===1||elem.nodeType===11)&&!jQuery.isXMLDoc(elem)){destElements=getAll(clone);
srcElements=getAll(elem);for(i=0;(node=srcElements[i])!=null;++i){if(destElements[i]){fixCloneNodeIssues(node,destElements[i]);
}}}if(dataAndEvents){if(deepDataAndEvents){srcElements=srcElements||getAll(elem);destElements=destElements||getAll(clone);
for(i=0;(node=srcElements[i])!=null;i++){cloneCopyEvent(node,destElements[i]);}}else{cloneCopyEvent(elem,clone);
}}destElements=getAll(clone,"script");if(destElements.length>0){setGlobalEval(destElements,!inPage&&getAll(elem,"script"));
}destElements=srcElements=node=null;return clone;},cleanData:function(elems,forceAcceptData){var elem,type,id,data,i=0,internalKey=jQuery.expando,cache=jQuery.cache,attributes=support.attributes,special=jQuery.event.special;
for(;(elem=elems[i])!=null;i++){if(forceAcceptData||acceptData(elem)){id=elem[internalKey];data=id&&cache[id];
if(data){if(data.events){for(type in data.events){if(special[type]){jQuery.event.remove(elem,type);}else{jQuery.removeEvent(elem,type,data.handle);
}}}if(cache[id]){delete cache[id];if(!attributes&&typeof elem.removeAttribute!=="undefined"){elem.removeAttribute(internalKey);
}else{elem[internalKey]=undefined;}deletedIds.push(id);}}}}}});jQuery.fn.extend({domManip:domManip,detach:function(selector){return remove(this,selector,true);
},remove:function(selector){return remove(this,selector);},text:function(value){return access(this,function(value){return value===undefined?jQuery.text(this):this.empty().append((this[0]&&this[0].ownerDocument||document).createTextNode(value));
},null,value,arguments.length);},append:function(){return domManip(this,arguments,function(elem){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){var target=manipulationTarget(this,elem);
target.appendChild(elem);}});},prepend:function(){return domManip(this,arguments,function(elem){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){var target=manipulationTarget(this,elem);
target.insertBefore(elem,target.firstChild);}});},before:function(){return domManip(this,arguments,function(elem){if(this.parentNode){this.parentNode.insertBefore(elem,this);
}});},after:function(){return domManip(this,arguments,function(elem){if(this.parentNode){this.parentNode.insertBefore(elem,this.nextSibling);
}});},empty:function(){var elem,i=0;for(;(elem=this[i])!=null;i++){if(elem.nodeType===1){jQuery.cleanData(getAll(elem,false));
}while(elem.firstChild){elem.removeChild(elem.firstChild);}if(elem.options&&jQuery.nodeName(elem,"select")){elem.options.length=0;
}}return this;},clone:function(dataAndEvents,deepDataAndEvents){dataAndEvents=dataAndEvents==null?false:dataAndEvents;
deepDataAndEvents=deepDataAndEvents==null?dataAndEvents:deepDataAndEvents;return this.map(function(){return jQuery.clone(this,dataAndEvents,deepDataAndEvents);
});},html:function(value){return access(this,function(value){var elem=this[0]||{},i=0,l=this.length;if(value===undefined){return elem.nodeType===1?elem.innerHTML.replace(rinlinejQuery,""):undefined;
}if(typeof value==="string"&&!rnoInnerhtml.test(value)&&(support.htmlSerialize||!rnoshimcache.test(value))&&(support.leadingWhitespace||!rleadingWhitespace.test(value))&&!wrapMap[(rtagName.exec(value)||["",""])[1].toLowerCase()]){value=jQuery.htmlPrefilter(value);
try{for(;i<l;i++){elem=this[i]||{};if(elem.nodeType===1){jQuery.cleanData(getAll(elem,false));elem.innerHTML=value;
}}elem=0;}catch(e){}}if(elem){this.empty().append(value);}},null,value,arguments.length);},replaceWith:function(){var ignored=[];
return domManip(this,arguments,function(elem){var parent=this.parentNode;if(jQuery.inArray(this,ignored)<0){jQuery.cleanData(getAll(this));
if(parent){parent.replaceChild(elem,this);}}},ignored);}});jQuery.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(name,original){jQuery.fn[name]=function(selector){var elems,i=0,ret=[],insert=jQuery(selector),last=insert.length-1;
for(;i<=last;i++){elems=i===last?this:this.clone(true);jQuery(insert[i])[original](elems);push.apply(ret,elems.get());
}return this.pushStack(ret);};});var iframe,elemdisplay={HTML:"block",BODY:"block"};function actualDisplay(name,doc){var elem=jQuery(doc.createElement(name)).appendTo(doc.body),display=jQuery.css(elem[0],"display");
elem.detach();return display;}function defaultDisplay(nodeName){var doc=document,display=elemdisplay[nodeName];
if(!display){display=actualDisplay(nodeName,doc);if(display==="none"||!display){iframe=(iframe||jQuery("<iframe frameborder='0' width='0' height='0'/>")).appendTo(doc.documentElement);
doc=(iframe[0].contentWindow||iframe[0].contentDocument).document;doc.write();doc.close();display=actualDisplay(nodeName,doc);
iframe.detach();}elemdisplay[nodeName]=display;}return display;}var rmargin=(/^margin/);var rnumnonpx=new RegExp("^("+pnum+")(?!px)[a-z%]+$","i");
var swap=function(elem,options,callback,args){var ret,name,old={};for(name in options){old[name]=elem.style[name];
elem.style[name]=options[name];}ret=callback.apply(elem,args||[]);for(name in options){elem.style[name]=old[name];
}return ret;};var documentElement=document.documentElement;(function(){var pixelPositionVal,pixelMarginRightVal,boxSizingReliableVal,reliableHiddenOffsetsVal,reliableMarginRightVal,reliableMarginLeftVal,container=document.createElement("div"),div=document.createElement("div");
if(!div.style){return;}div.style.cssText="float:left;opacity:.5";support.opacity=div.style.opacity==="0.5";
support.cssFloat=!!div.style.cssFloat;div.style.backgroundClip="content-box";div.cloneNode(true).style.backgroundClip="";
support.clearCloneStyle=div.style.backgroundClip==="content-box";container=document.createElement("div");
container.style.cssText="border:0;width:8px;height:0;top:0;left:-9999px;padding:0;margin-top:1px;position:absolute";
div.innerHTML="";container.appendChild(div);support.boxSizing=div.style.boxSizing===""||div.style.MozBoxSizing===""||div.style.WebkitBoxSizing==="";
jQuery.extend(support,{reliableHiddenOffsets:function(){if(pixelPositionVal==null){computeStyleTests();
}return reliableHiddenOffsetsVal;},boxSizingReliable:function(){if(pixelPositionVal==null){computeStyleTests();
}return boxSizingReliableVal;},pixelMarginRight:function(){if(pixelPositionVal==null){computeStyleTests();
}return pixelMarginRightVal;},pixelPosition:function(){if(pixelPositionVal==null){computeStyleTests();
}return pixelPositionVal;},reliableMarginRight:function(){if(pixelPositionVal==null){computeStyleTests();
}return reliableMarginRightVal;},reliableMarginLeft:function(){if(pixelPositionVal==null){computeStyleTests();
}return reliableMarginLeftVal;}});function computeStyleTests(){var contents,divStyle,documentElement=document.documentElement;
documentElement.appendChild(container);div.style.cssText="-webkit-box-sizing:border-box;box-sizing:border-box;position:relative;display:block;margin:auto;border:1px;padding:1px;top:1%;width:50%";
pixelPositionVal=boxSizingReliableVal=reliableMarginLeftVal=false;pixelMarginRightVal=reliableMarginRightVal=true;
if(window.getComputedStyle){divStyle=window.getComputedStyle(div);pixelPositionVal=(divStyle||{}).top!=="1%";
reliableMarginLeftVal=(divStyle||{}).marginLeft==="2px";boxSizingReliableVal=(divStyle||{width:"4px"}).width==="4px";
div.style.marginRight="50%";pixelMarginRightVal=(divStyle||{marginRight:"4px"}).marginRight==="4px";contents=div.appendChild(document.createElement("div"));
contents.style.cssText=div.style.cssText="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:0";
contents.style.marginRight=contents.style.width="0";div.style.width="1px";reliableMarginRightVal=!parseFloat((window.getComputedStyle(contents)||{}).marginRight);
div.removeChild(contents);}div.style.display="none";reliableHiddenOffsetsVal=div.getClientRects().length===0;
if(reliableHiddenOffsetsVal){div.style.display="";div.innerHTML="<table><tr><td></td><td>t</td></tr></table>";
div.childNodes[0].style.borderCollapse="separate";contents=div.getElementsByTagName("td");contents[0].style.cssText="margin:0;border:0;padding:0;display:none";
reliableHiddenOffsetsVal=contents[0].offsetHeight===0;if(reliableHiddenOffsetsVal){contents[0].style.display="";
contents[1].style.display="none";reliableHiddenOffsetsVal=contents[0].offsetHeight===0;}}documentElement.removeChild(container);
}})();var getStyles,curCSS,rposition=/^(top|right|bottom|left)$/;if(window.getComputedStyle){getStyles=function(elem){var view=elem.ownerDocument.defaultView;
if(!view||!view.opener){view=window;}return view.getComputedStyle(elem);};curCSS=function(elem,name,computed){var width,minWidth,maxWidth,ret,style=elem.style;
computed=computed||getStyles(elem);ret=computed?computed.getPropertyValue(name)||computed[name]:undefined;
if((ret===""||ret===undefined)&&!jQuery.contains(elem.ownerDocument,elem)){ret=jQuery.style(elem,name);
}if(computed){if(!support.pixelMarginRight()&&rnumnonpx.test(ret)&&rmargin.test(name)){width=style.width;
minWidth=style.minWidth;maxWidth=style.maxWidth;style.minWidth=style.maxWidth=style.width=ret;ret=computed.width;
style.width=width;style.minWidth=minWidth;style.maxWidth=maxWidth;}}return ret===undefined?ret:ret+"";
};}else{if(documentElement.currentStyle){getStyles=function(elem){return elem.currentStyle;};curCSS=function(elem,name,computed){var left,rs,rsLeft,ret,style=elem.style;
computed=computed||getStyles(elem);ret=computed?computed[name]:undefined;if(ret==null&&style&&style[name]){ret=style[name];
}if(rnumnonpx.test(ret)&&!rposition.test(name)){left=style.left;rs=elem.runtimeStyle;rsLeft=rs&&rs.left;
if(rsLeft){rs.left=elem.currentStyle.left;}style.left=name==="fontSize"?"1em":ret;ret=style.pixelLeft+"px";
style.left=left;if(rsLeft){rs.left=rsLeft;}}return ret===undefined?ret:ret+""||"auto";};}}function addGetHookIf(conditionFn,hookFn){return{get:function(){if(conditionFn()){delete this.get;
return;}return(this.get=hookFn).apply(this,arguments);}};}var ralpha=/alpha\([^)]*\)/i,ropacity=/opacity\s*=\s*([^)]*)/i,rdisplayswap=/^(none|table(?!-c[ea]).+)/,rnumsplit=new RegExp("^("+pnum+")(.*)$","i"),cssShow={position:"absolute",visibility:"hidden",display:"block"},cssNormalTransform={letterSpacing:"0",fontWeight:"400"},cssPrefixes=["Webkit","O","Moz","ms"],emptyStyle=document.createElement("div").style;
function vendorPropName(name){if(name in emptyStyle){return name;}var capName=name.charAt(0).toUpperCase()+name.slice(1),i=cssPrefixes.length;
while(i--){name=cssPrefixes[i]+capName;if(name in emptyStyle){return name;}}}function showHide(elements,show){var display,elem,hidden,values=[],index=0,length=elements.length;
for(;index<length;index++){elem=elements[index];if(!elem.style){continue;}values[index]=jQuery._data(elem,"olddisplay");
display=elem.style.display;if(show){if(!values[index]&&display==="none"){elem.style.display="";}if(elem.style.display===""&&isHidden(elem)){values[index]=jQuery._data(elem,"olddisplay",defaultDisplay(elem.nodeName));
}}else{hidden=isHidden(elem);if(display&&display!=="none"||!hidden){jQuery._data(elem,"olddisplay",hidden?display:jQuery.css(elem,"display"));
}}}for(index=0;index<length;index++){elem=elements[index];if(!elem.style){continue;}if(!show||elem.style.display==="none"||elem.style.display===""){elem.style.display=show?values[index]||"":"none";
}}return elements;}function setPositiveNumber(elem,value,subtract){var matches=rnumsplit.exec(value);
return matches?Math.max(0,matches[1]-(subtract||0))+(matches[2]||"px"):value;}function augmentWidthOrHeight(elem,name,extra,isBorderBox,styles){var i=extra===(isBorderBox?"border":"content")?4:name==="width"?1:0,val=0;
for(;i<4;i+=2){if(extra==="margin"){val+=jQuery.css(elem,extra+cssExpand[i],true,styles);}if(isBorderBox){if(extra==="content"){val-=jQuery.css(elem,"padding"+cssExpand[i],true,styles);
}if(extra!=="margin"){val-=jQuery.css(elem,"border"+cssExpand[i]+"Width",true,styles);}}else{val+=jQuery.css(elem,"padding"+cssExpand[i],true,styles);
if(extra!=="padding"){val+=jQuery.css(elem,"border"+cssExpand[i]+"Width",true,styles);}}}return val;}function getWidthOrHeight(elem,name,extra){var valueIsBorderBox=true,val=name==="width"?elem.offsetWidth:elem.offsetHeight,styles=getStyles(elem),isBorderBox=support.boxSizing&&jQuery.css(elem,"boxSizing",false,styles)==="border-box";
if(val<=0||val==null){val=curCSS(elem,name,styles);if(val<0||val==null){val=elem.style[name];}if(rnumnonpx.test(val)){return val;
}valueIsBorderBox=isBorderBox&&(support.boxSizingReliable()||val===elem.style[name]);val=parseFloat(val)||0;
}return(val+augmentWidthOrHeight(elem,name,extra||(isBorderBox?"border":"content"),valueIsBorderBox,styles))+"px";
}jQuery.extend({cssHooks:{opacity:{get:function(elem,computed){if(computed){var ret=curCSS(elem,"opacity");
return ret===""?"1":ret;}}}},cssNumber:{animationIterationCount:true,columnCount:true,fillOpacity:true,flexGrow:true,flexShrink:true,fontWeight:true,lineHeight:true,opacity:true,order:true,orphans:true,widows:true,zIndex:true,zoom:true},cssProps:{"float":support.cssFloat?"cssFloat":"styleFloat"},style:function(elem,name,value,extra){if(!elem||elem.nodeType===3||elem.nodeType===8||!elem.style){return;
}var ret,type,hooks,origName=jQuery.camelCase(name),style=elem.style;name=jQuery.cssProps[origName]||(jQuery.cssProps[origName]=vendorPropName(origName)||origName);
hooks=jQuery.cssHooks[name]||jQuery.cssHooks[origName];if(value!==undefined){type=typeof value;if(type==="string"&&(ret=rcssNum.exec(value))&&ret[1]){value=adjustCSS(elem,name,ret);
type="number";}if(value==null||value!==value){return;}if(type==="number"){value+=ret&&ret[3]||(jQuery.cssNumber[origName]?"":"px");
}if(!support.clearCloneStyle&&value===""&&name.indexOf("background")===0){style[name]="inherit";}if(!hooks||!("set" in hooks)||(value=hooks.set(elem,value,extra))!==undefined){try{style[name]=value;
}catch(e){}}}else{if(hooks&&"get" in hooks&&(ret=hooks.get(elem,false,extra))!==undefined){return ret;
}return style[name];}},css:function(elem,name,extra,styles){var num,val,hooks,origName=jQuery.camelCase(name);
name=jQuery.cssProps[origName]||(jQuery.cssProps[origName]=vendorPropName(origName)||origName);hooks=jQuery.cssHooks[name]||jQuery.cssHooks[origName];
if(hooks&&"get" in hooks){val=hooks.get(elem,true,extra);}if(val===undefined){val=curCSS(elem,name,styles);
}if(val==="normal"&&name in cssNormalTransform){val=cssNormalTransform[name];}if(extra===""||extra){num=parseFloat(val);
return extra===true||isFinite(num)?num||0:val;}return val;}});jQuery.each(["height","width"],function(i,name){jQuery.cssHooks[name]={get:function(elem,computed,extra){if(computed){return rdisplayswap.test(jQuery.css(elem,"display"))&&elem.offsetWidth===0?swap(elem,cssShow,function(){return getWidthOrHeight(elem,name,extra);
}):getWidthOrHeight(elem,name,extra);}},set:function(elem,value,extra){var styles=extra&&getStyles(elem);
return setPositiveNumber(elem,value,extra?augmentWidthOrHeight(elem,name,extra,support.boxSizing&&jQuery.css(elem,"boxSizing",false,styles)==="border-box",styles):0);
}};});if(!support.opacity){jQuery.cssHooks.opacity={get:function(elem,computed){return ropacity.test((computed&&elem.currentStyle?elem.currentStyle.filter:elem.style.filter)||"")?(0.01*parseFloat(RegExp.$1))+"":computed?"1":"";
},set:function(elem,value){var style=elem.style,currentStyle=elem.currentStyle,opacity=jQuery.isNumeric(value)?"alpha(opacity="+value*100+")":"",filter=currentStyle&&currentStyle.filter||style.filter||"";
style.zoom=1;if((value>=1||value==="")&&jQuery.trim(filter.replace(ralpha,""))===""&&style.removeAttribute){style.removeAttribute("filter");
if(value===""||currentStyle&&!currentStyle.filter){return;}}style.filter=ralpha.test(filter)?filter.replace(ralpha,opacity):filter+" "+opacity;
}};}jQuery.cssHooks.marginRight=addGetHookIf(support.reliableMarginRight,function(elem,computed){if(computed){return swap(elem,{display:"inline-block"},curCSS,[elem,"marginRight"]);
}});jQuery.cssHooks.marginLeft=addGetHookIf(support.reliableMarginLeft,function(elem,computed){if(computed){return(parseFloat(curCSS(elem,"marginLeft"))||(jQuery.contains(elem.ownerDocument,elem)?elem.getBoundingClientRect().left-swap(elem,{marginLeft:0},function(){return elem.getBoundingClientRect().left;
}):0))+"px";}});jQuery.each({margin:"",padding:"",border:"Width"},function(prefix,suffix){jQuery.cssHooks[prefix+suffix]={expand:function(value){var i=0,expanded={},parts=typeof value==="string"?value.split(" "):[value];
for(;i<4;i++){expanded[prefix+cssExpand[i]+suffix]=parts[i]||parts[i-2]||parts[0];}return expanded;}};
if(!rmargin.test(prefix)){jQuery.cssHooks[prefix+suffix].set=setPositiveNumber;}});jQuery.fn.extend({css:function(name,value){return access(this,function(elem,name,value){var styles,len,map={},i=0;
if(jQuery.isArray(name)){styles=getStyles(elem);len=name.length;for(;i<len;i++){map[name[i]]=jQuery.css(elem,name[i],false,styles);
}return map;}return value!==undefined?jQuery.style(elem,name,value):jQuery.css(elem,name);},name,value,arguments.length>1);
},show:function(){return showHide(this,true);},hide:function(){return showHide(this);},toggle:function(state){if(typeof state==="boolean"){return state?this.show():this.hide();
}return this.each(function(){if(isHidden(this)){jQuery(this).show();}else{jQuery(this).hide();}});}});
function Tween(elem,options,prop,end,easing){return new Tween.prototype.init(elem,options,prop,end,easing);
}jQuery.Tween=Tween;Tween.prototype={constructor:Tween,init:function(elem,options,prop,end,easing,unit){this.elem=elem;
this.prop=prop;this.easing=easing||jQuery.easing._default;this.options=options;this.start=this.now=this.cur();
this.end=end;this.unit=unit||(jQuery.cssNumber[prop]?"":"px");},cur:function(){var hooks=Tween.propHooks[this.prop];
return hooks&&hooks.get?hooks.get(this):Tween.propHooks._default.get(this);},run:function(percent){var eased,hooks=Tween.propHooks[this.prop];
if(this.options.duration){this.pos=eased=jQuery.easing[this.easing](percent,this.options.duration*percent,0,1,this.options.duration);
}else{this.pos=eased=percent;}this.now=(this.end-this.start)*eased+this.start;if(this.options.step){this.options.step.call(this.elem,this.now,this);
}if(hooks&&hooks.set){hooks.set(this);}else{Tween.propHooks._default.set(this);}return this;}};Tween.prototype.init.prototype=Tween.prototype;
Tween.propHooks={_default:{get:function(tween){var result;if(tween.elem.nodeType!==1||tween.elem[tween.prop]!=null&&tween.elem.style[tween.prop]==null){return tween.elem[tween.prop];
}result=jQuery.css(tween.elem,tween.prop,"");return !result||result==="auto"?0:result;},set:function(tween){if(jQuery.fx.step[tween.prop]){jQuery.fx.step[tween.prop](tween);
}else{if(tween.elem.nodeType===1&&(tween.elem.style[jQuery.cssProps[tween.prop]]!=null||jQuery.cssHooks[tween.prop])){jQuery.style(tween.elem,tween.prop,tween.now+tween.unit);
}else{tween.elem[tween.prop]=tween.now;}}}}};Tween.propHooks.scrollTop=Tween.propHooks.scrollLeft={set:function(tween){if(tween.elem.nodeType&&tween.elem.parentNode){tween.elem[tween.prop]=tween.now;
}}};jQuery.easing={linear:function(p){return p;},swing:function(p){return 0.5-Math.cos(p*Math.PI)/2;},_default:"swing"};
jQuery.fx=Tween.prototype.init;jQuery.fx.step={};var fxNow,timerId,rfxtypes=/^(?:toggle|show|hide)$/,rrun=/queueHooks$/;
function createFxNow(){window.setTimeout(function(){fxNow=undefined;});return(fxNow=jQuery.now());}function genFx(type,includeWidth){var which,attrs={height:type},i=0;
includeWidth=includeWidth?1:0;for(;i<4;i+=2-includeWidth){which=cssExpand[i];attrs["margin"+which]=attrs["padding"+which]=type;
}if(includeWidth){attrs.opacity=attrs.width=type;}return attrs;}function createTween(value,prop,animation){var tween,collection=(Animation.tweeners[prop]||[]).concat(Animation.tweeners["*"]),index=0,length=collection.length;
for(;index<length;index++){if((tween=collection[index].call(animation,prop,value))){return tween;}}}function defaultPrefilter(elem,props,opts){var prop,value,toggle,tween,hooks,oldfire,display,checkDisplay,anim=this,orig={},style=elem.style,hidden=elem.nodeType&&isHidden(elem),dataShow=jQuery._data(elem,"fxshow");
if(!opts.queue){hooks=jQuery._queueHooks(elem,"fx");if(hooks.unqueued==null){hooks.unqueued=0;oldfire=hooks.empty.fire;
hooks.empty.fire=function(){if(!hooks.unqueued){oldfire();}};}hooks.unqueued++;anim.always(function(){anim.always(function(){hooks.unqueued--;
if(!jQuery.queue(elem,"fx").length){hooks.empty.fire();}});});}if(elem.nodeType===1&&("height" in props||"width" in props)){opts.overflow=[style.overflow,style.overflowX,style.overflowY];
display=jQuery.css(elem,"display");checkDisplay=display==="none"?jQuery._data(elem,"olddisplay")||defaultDisplay(elem.nodeName):display;
if(checkDisplay==="inline"&&jQuery.css(elem,"float")==="none"){if(!support.inlineBlockNeedsLayout||defaultDisplay(elem.nodeName)==="inline"){style.display="inline-block";
}else{style.zoom=1;}}}if(opts.overflow){style.overflow="hidden";if(!support.shrinkWrapBlocks()){anim.always(function(){style.overflow=opts.overflow[0];
style.overflowX=opts.overflow[1];style.overflowY=opts.overflow[2];});}}for(prop in props){value=props[prop];
if(rfxtypes.exec(value)){delete props[prop];toggle=toggle||value==="toggle";if(value===(hidden?"hide":"show")){if(value==="show"&&dataShow&&dataShow[prop]!==undefined){hidden=true;
}else{continue;}}orig[prop]=dataShow&&dataShow[prop]||jQuery.style(elem,prop);}else{display=undefined;
}}if(!jQuery.isEmptyObject(orig)){if(dataShow){if("hidden" in dataShow){hidden=dataShow.hidden;}}else{dataShow=jQuery._data(elem,"fxshow",{});
}if(toggle){dataShow.hidden=!hidden;}if(hidden){jQuery(elem).show();}else{anim.done(function(){jQuery(elem).hide();
});}anim.done(function(){var prop;jQuery._removeData(elem,"fxshow");for(prop in orig){jQuery.style(elem,prop,orig[prop]);
}});for(prop in orig){tween=createTween(hidden?dataShow[prop]:0,prop,anim);if(!(prop in dataShow)){dataShow[prop]=tween.start;
if(hidden){tween.end=tween.start;tween.start=prop==="width"||prop==="height"?1:0;}}}}else{if((display==="none"?defaultDisplay(elem.nodeName):display)==="inline"){style.display=display;
}}}function propFilter(props,specialEasing){var index,name,easing,value,hooks;for(index in props){name=jQuery.camelCase(index);
easing=specialEasing[name];value=props[index];if(jQuery.isArray(value)){easing=value[1];value=props[index]=value[0];
}if(index!==name){props[name]=value;delete props[index];}hooks=jQuery.cssHooks[name];if(hooks&&"expand" in hooks){value=hooks.expand(value);
delete props[name];for(index in value){if(!(index in props)){props[index]=value[index];specialEasing[index]=easing;
}}}else{specialEasing[name]=easing;}}}function Animation(elem,properties,options){var result,stopped,index=0,length=Animation.prefilters.length,deferred=jQuery.Deferred().always(function(){delete tick.elem;
}),tick=function(){if(stopped){return false;}var currentTime=fxNow||createFxNow(),remaining=Math.max(0,animation.startTime+animation.duration-currentTime),temp=remaining/animation.duration||0,percent=1-temp,index=0,length=animation.tweens.length;
for(;index<length;index++){animation.tweens[index].run(percent);}deferred.notifyWith(elem,[animation,percent,remaining]);
if(percent<1&&length){return remaining;}else{deferred.resolveWith(elem,[animation]);return false;}},animation=deferred.promise({elem:elem,props:jQuery.extend({},properties),opts:jQuery.extend(true,{specialEasing:{},easing:jQuery.easing._default},options),originalProperties:properties,originalOptions:options,startTime:fxNow||createFxNow(),duration:options.duration,tweens:[],createTween:function(prop,end){var tween=jQuery.Tween(elem,animation.opts,prop,end,animation.opts.specialEasing[prop]||animation.opts.easing);
animation.tweens.push(tween);return tween;},stop:function(gotoEnd){var index=0,length=gotoEnd?animation.tweens.length:0;
if(stopped){return this;}stopped=true;for(;index<length;index++){animation.tweens[index].run(1);}if(gotoEnd){deferred.notifyWith(elem,[animation,1,0]);
deferred.resolveWith(elem,[animation,gotoEnd]);}else{deferred.rejectWith(elem,[animation,gotoEnd]);}return this;
}}),props=animation.props;propFilter(props,animation.opts.specialEasing);for(;index<length;index++){result=Animation.prefilters[index].call(animation,elem,props,animation.opts);
if(result){if(jQuery.isFunction(result.stop)){jQuery._queueHooks(animation.elem,animation.opts.queue).stop=jQuery.proxy(result.stop,result);
}return result;}}jQuery.map(props,createTween,animation);if(jQuery.isFunction(animation.opts.start)){animation.opts.start.call(elem,animation);
}jQuery.fx.timer(jQuery.extend(tick,{elem:elem,anim:animation,queue:animation.opts.queue}));return animation.progress(animation.opts.progress).done(animation.opts.done,animation.opts.complete).fail(animation.opts.fail).always(animation.opts.always);
}jQuery.Animation=jQuery.extend(Animation,{tweeners:{"*":[function(prop,value){var tween=this.createTween(prop,value);
adjustCSS(tween.elem,prop,rcssNum.exec(value),tween);return tween;}]},tweener:function(props,callback){if(jQuery.isFunction(props)){callback=props;
props=["*"];}else{props=props.match(rnotwhite);}var prop,index=0,length=props.length;for(;index<length;
index++){prop=props[index];Animation.tweeners[prop]=Animation.tweeners[prop]||[];Animation.tweeners[prop].unshift(callback);
}},prefilters:[defaultPrefilter],prefilter:function(callback,prepend){if(prepend){Animation.prefilters.unshift(callback);
}else{Animation.prefilters.push(callback);}}});jQuery.speed=function(speed,easing,fn){var opt=speed&&typeof speed==="object"?jQuery.extend({},speed):{complete:fn||!fn&&easing||jQuery.isFunction(speed)&&speed,duration:speed,easing:fn&&easing||easing&&!jQuery.isFunction(easing)&&easing};
opt.duration=jQuery.fx.off?0:typeof opt.duration==="number"?opt.duration:opt.duration in jQuery.fx.speeds?jQuery.fx.speeds[opt.duration]:jQuery.fx.speeds._default;
if(opt.queue==null||opt.queue===true){opt.queue="fx";}opt.old=opt.complete;opt.complete=function(){if(jQuery.isFunction(opt.old)){opt.old.call(this);
}if(opt.queue){jQuery.dequeue(this,opt.queue);}};return opt;};jQuery.fn.extend({fadeTo:function(speed,to,easing,callback){return this.filter(isHidden).css("opacity",0).show().end().animate({opacity:to},speed,easing,callback);
},animate:function(prop,speed,easing,callback){var empty=jQuery.isEmptyObject(prop),optall=jQuery.speed(speed,easing,callback),doAnimation=function(){var anim=Animation(this,jQuery.extend({},prop),optall);
if(empty||jQuery._data(this,"finish")){anim.stop(true);}};doAnimation.finish=doAnimation;return empty||optall.queue===false?this.each(doAnimation):this.queue(optall.queue,doAnimation);
},stop:function(type,clearQueue,gotoEnd){var stopQueue=function(hooks){var stop=hooks.stop;delete hooks.stop;
stop(gotoEnd);};if(typeof type!=="string"){gotoEnd=clearQueue;clearQueue=type;type=undefined;}if(clearQueue&&type!==false){this.queue(type||"fx",[]);
}return this.each(function(){var dequeue=true,index=type!=null&&type+"queueHooks",timers=jQuery.timers,data=jQuery._data(this);
if(index){if(data[index]&&data[index].stop){stopQueue(data[index]);}}else{for(index in data){if(data[index]&&data[index].stop&&rrun.test(index)){stopQueue(data[index]);
}}}for(index=timers.length;index--;){if(timers[index].elem===this&&(type==null||timers[index].queue===type)){timers[index].anim.stop(gotoEnd);
dequeue=false;timers.splice(index,1);}}if(dequeue||!gotoEnd){jQuery.dequeue(this,type);}});},finish:function(type){if(type!==false){type=type||"fx";
}return this.each(function(){var index,data=jQuery._data(this),queue=data[type+"queue"],hooks=data[type+"queueHooks"],timers=jQuery.timers,length=queue?queue.length:0;
data.finish=true;jQuery.queue(this,type,[]);if(hooks&&hooks.stop){hooks.stop.call(this,true);}for(index=timers.length;
index--;){if(timers[index].elem===this&&timers[index].queue===type){timers[index].anim.stop(true);timers.splice(index,1);
}}for(index=0;index<length;index++){if(queue[index]&&queue[index].finish){queue[index].finish.call(this);
}}delete data.finish;});}});jQuery.each(["toggle","show","hide"],function(i,name){var cssFn=jQuery.fn[name];
jQuery.fn[name]=function(speed,easing,callback){return speed==null||typeof speed==="boolean"?cssFn.apply(this,arguments):this.animate(genFx(name,true),speed,easing,callback);
};});jQuery.each({slideDown:genFx("show"),slideUp:genFx("hide"),slideToggle:genFx("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(name,props){jQuery.fn[name]=function(speed,easing,callback){return this.animate(props,speed,easing,callback);
};});jQuery.timers=[];jQuery.fx.tick=function(){var timer,timers=jQuery.timers,i=0;fxNow=jQuery.now();
for(;i<timers.length;i++){timer=timers[i];if(!timer()&&timers[i]===timer){timers.splice(i--,1);}}if(!timers.length){jQuery.fx.stop();
}fxNow=undefined;};jQuery.fx.timer=function(timer){jQuery.timers.push(timer);if(timer()){jQuery.fx.start();
}else{jQuery.timers.pop();}};jQuery.fx.interval=13;jQuery.fx.start=function(){if(!timerId){timerId=window.setInterval(jQuery.fx.tick,jQuery.fx.interval);
}};jQuery.fx.stop=function(){window.clearInterval(timerId);timerId=null;};jQuery.fx.speeds={slow:600,fast:200,_default:400};
jQuery.fn.delay=function(time,type){time=jQuery.fx?jQuery.fx.speeds[time]||time:time;type=type||"fx";
return this.queue(type,function(next,hooks){var timeout=window.setTimeout(next,time);hooks.stop=function(){window.clearTimeout(timeout);
};});};(function(){var a,input=document.createElement("input"),div=document.createElement("div"),select=document.createElement("select"),opt=select.appendChild(document.createElement("option"));
div=document.createElement("div");div.setAttribute("className","t");div.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>";
a=div.getElementsByTagName("a")[0];input.setAttribute("type","checkbox");div.appendChild(input);a=div.getElementsByTagName("a")[0];
a.style.cssText="top:1px";support.getSetAttribute=div.className!=="t";support.style=/top/.test(a.getAttribute("style"));
support.hrefNormalized=a.getAttribute("href")==="/a";support.checkOn=!!input.value;support.optSelected=opt.selected;
support.enctype=!!document.createElement("form").enctype;select.disabled=true;support.optDisabled=!opt.disabled;
input=document.createElement("input");input.setAttribute("value","");support.input=input.getAttribute("value")==="";
input.value="t";input.setAttribute("type","radio");support.radioValue=input.value==="t";})();var rreturn=/\r/g,rspaces=/[\x20\t\r\n\f]+/g;
jQuery.fn.extend({val:function(value){var hooks,ret,isFunction,elem=this[0];if(!arguments.length){if(elem){hooks=jQuery.valHooks[elem.type]||jQuery.valHooks[elem.nodeName.toLowerCase()];
if(hooks&&"get" in hooks&&(ret=hooks.get(elem,"value"))!==undefined){return ret;}ret=elem.value;return typeof ret==="string"?ret.replace(rreturn,""):ret==null?"":ret;
}return;}isFunction=jQuery.isFunction(value);return this.each(function(i){var val;if(this.nodeType!==1){return;
}if(isFunction){val=value.call(this,i,jQuery(this).val());}else{val=value;}if(val==null){val="";}else{if(typeof val==="number"){val+="";
}else{if(jQuery.isArray(val)){val=jQuery.map(val,function(value){return value==null?"":value+"";});}}}hooks=jQuery.valHooks[this.type]||jQuery.valHooks[this.nodeName.toLowerCase()];
if(!hooks||!("set" in hooks)||hooks.set(this,val,"value")===undefined){this.value=val;}});}});jQuery.extend({valHooks:{option:{get:function(elem){var val=jQuery.find.attr(elem,"value");
return val!=null?val:jQuery.trim(jQuery.text(elem)).replace(rspaces," ");}},select:{get:function(elem){var value,option,options=elem.options,index=elem.selectedIndex,one=elem.type==="select-one"||index<0,values=one?null:[],max=one?index+1:options.length,i=index<0?max:one?index:0;
for(;i<max;i++){option=options[i];if((option.selected||i===index)&&(support.optDisabled?!option.disabled:option.getAttribute("disabled")===null)&&(!option.parentNode.disabled||!jQuery.nodeName(option.parentNode,"optgroup"))){value=jQuery(option).val();
if(one){return value;}values.push(value);}}return values;},set:function(elem,value){var optionSet,option,options=elem.options,values=jQuery.makeArray(value),i=options.length;
while(i--){option=options[i];if(jQuery.inArray(jQuery.valHooks.option.get(option),values)>-1){try{option.selected=optionSet=true;
}catch(_){option.scrollHeight;}}else{option.selected=false;}}if(!optionSet){elem.selectedIndex=-1;}return options;
}}}});jQuery.each(["radio","checkbox"],function(){jQuery.valHooks[this]={set:function(elem,value){if(jQuery.isArray(value)){return(elem.checked=jQuery.inArray(jQuery(elem).val(),value)>-1);
}}};if(!support.checkOn){jQuery.valHooks[this].get=function(elem){return elem.getAttribute("value")===null?"on":elem.value;
};}});var nodeHook,boolHook,attrHandle=jQuery.expr.attrHandle,ruseDefault=/^(?:checked|selected)$/i,getSetAttribute=support.getSetAttribute,getSetInput=support.input;
jQuery.fn.extend({attr:function(name,value){return access(this,jQuery.attr,name,value,arguments.length>1);
},removeAttr:function(name){return this.each(function(){jQuery.removeAttr(this,name);});}});jQuery.extend({attr:function(elem,name,value){var ret,hooks,nType=elem.nodeType;
if(nType===3||nType===8||nType===2){return;}if(typeof elem.getAttribute==="undefined"){return jQuery.prop(elem,name,value);
}if(nType!==1||!jQuery.isXMLDoc(elem)){name=name.toLowerCase();hooks=jQuery.attrHooks[name]||(jQuery.expr.match.bool.test(name)?boolHook:nodeHook);
}if(value!==undefined){if(value===null){jQuery.removeAttr(elem,name);return;}if(hooks&&"set" in hooks&&(ret=hooks.set(elem,value,name))!==undefined){return ret;
}elem.setAttribute(name,value+"");return value;}if(hooks&&"get" in hooks&&(ret=hooks.get(elem,name))!==null){return ret;
}ret=jQuery.find.attr(elem,name);return ret==null?undefined:ret;},attrHooks:{type:{set:function(elem,value){if(!support.radioValue&&value==="radio"&&jQuery.nodeName(elem,"input")){var val=elem.value;
elem.setAttribute("type",value);if(val){elem.value=val;}return value;}}}},removeAttr:function(elem,value){var name,propName,i=0,attrNames=value&&value.match(rnotwhite);
if(attrNames&&elem.nodeType===1){while((name=attrNames[i++])){propName=jQuery.propFix[name]||name;if(jQuery.expr.match.bool.test(name)){if(getSetInput&&getSetAttribute||!ruseDefault.test(name)){elem[propName]=false;
}else{elem[jQuery.camelCase("default-"+name)]=elem[propName]=false;}}else{jQuery.attr(elem,name,"");}elem.removeAttribute(getSetAttribute?name:propName);
}}}});boolHook={set:function(elem,value,name){if(value===false){jQuery.removeAttr(elem,name);}else{if(getSetInput&&getSetAttribute||!ruseDefault.test(name)){elem.setAttribute(!getSetAttribute&&jQuery.propFix[name]||name,name);
}else{elem[jQuery.camelCase("default-"+name)]=elem[name]=true;}}return name;}};jQuery.each(jQuery.expr.match.bool.source.match(/\w+/g),function(i,name){var getter=attrHandle[name]||jQuery.find.attr;
if(getSetInput&&getSetAttribute||!ruseDefault.test(name)){attrHandle[name]=function(elem,name,isXML){var ret,handle;
if(!isXML){handle=attrHandle[name];attrHandle[name]=ret;ret=getter(elem,name,isXML)!=null?name.toLowerCase():null;
attrHandle[name]=handle;}return ret;};}else{attrHandle[name]=function(elem,name,isXML){if(!isXML){return elem[jQuery.camelCase("default-"+name)]?name.toLowerCase():null;
}};}});if(!getSetInput||!getSetAttribute){jQuery.attrHooks.value={set:function(elem,value,name){if(jQuery.nodeName(elem,"input")){elem.defaultValue=value;
}else{return nodeHook&&nodeHook.set(elem,value,name);}}};}if(!getSetAttribute){nodeHook={set:function(elem,value,name){var ret=elem.getAttributeNode(name);
if(!ret){elem.setAttributeNode((ret=elem.ownerDocument.createAttribute(name)));}ret.value=value+="";if(name==="value"||value===elem.getAttribute(name)){return value;
}}};attrHandle.id=attrHandle.name=attrHandle.coords=function(elem,name,isXML){var ret;if(!isXML){return(ret=elem.getAttributeNode(name))&&ret.value!==""?ret.value:null;
}};jQuery.valHooks.button={get:function(elem,name){var ret=elem.getAttributeNode(name);if(ret&&ret.specified){return ret.value;
}},set:nodeHook.set};jQuery.attrHooks.contenteditable={set:function(elem,value,name){nodeHook.set(elem,value===""?false:value,name);
}};jQuery.each(["width","height"],function(i,name){jQuery.attrHooks[name]={set:function(elem,value){if(value===""){elem.setAttribute(name,"auto");
return value;}}};});}if(!support.style){jQuery.attrHooks.style={get:function(elem){return elem.style.cssText||undefined;
},set:function(elem,value){return(elem.style.cssText=value+"");}};}var rfocusable=/^(?:input|select|textarea|button|object)$/i,rclickable=/^(?:a|area)$/i;
jQuery.fn.extend({prop:function(name,value){return access(this,jQuery.prop,name,value,arguments.length>1);
},removeProp:function(name){name=jQuery.propFix[name]||name;return this.each(function(){try{this[name]=undefined;
delete this[name];}catch(e){}});}});jQuery.extend({prop:function(elem,name,value){var ret,hooks,nType=elem.nodeType;
if(nType===3||nType===8||nType===2){return;}if(nType!==1||!jQuery.isXMLDoc(elem)){name=jQuery.propFix[name]||name;
hooks=jQuery.propHooks[name];}if(value!==undefined){if(hooks&&"set" in hooks&&(ret=hooks.set(elem,value,name))!==undefined){return ret;
}return(elem[name]=value);}if(hooks&&"get" in hooks&&(ret=hooks.get(elem,name))!==null){return ret;}return elem[name];
},propHooks:{tabIndex:{get:function(elem){var tabindex=jQuery.find.attr(elem,"tabindex");return tabindex?parseInt(tabindex,10):rfocusable.test(elem.nodeName)||rclickable.test(elem.nodeName)&&elem.href?0:-1;
}}},propFix:{"for":"htmlFor","class":"className"}});if(!support.hrefNormalized){jQuery.each(["href","src"],function(i,name){jQuery.propHooks[name]={get:function(elem){return elem.getAttribute(name,4);
}};});}if(!support.optSelected){jQuery.propHooks.selected={get:function(elem){var parent=elem.parentNode;
if(parent){parent.selectedIndex;if(parent.parentNode){parent.parentNode.selectedIndex;}}return null;},set:function(elem){var parent=elem.parentNode;
if(parent){parent.selectedIndex;if(parent.parentNode){parent.parentNode.selectedIndex;}}}};}jQuery.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){jQuery.propFix[this.toLowerCase()]=this;
});if(!support.enctype){jQuery.propFix.enctype="encoding";}var rclass=/[\t\r\n\f]/g;function getClass(elem){return jQuery.attr(elem,"class")||"";
}jQuery.fn.extend({addClass:function(value){var classes,elem,cur,curValue,clazz,j,finalValue,i=0;if(jQuery.isFunction(value)){return this.each(function(j){jQuery(this).addClass(value.call(this,j,getClass(this)));
});}if(typeof value==="string"&&value){classes=value.match(rnotwhite)||[];while((elem=this[i++])){curValue=getClass(elem);
cur=elem.nodeType===1&&(" "+curValue+" ").replace(rclass," ");if(cur){j=0;while((clazz=classes[j++])){if(cur.indexOf(" "+clazz+" ")<0){cur+=clazz+" ";
}}finalValue=jQuery.trim(cur);if(curValue!==finalValue){jQuery.attr(elem,"class",finalValue);}}}}return this;
},removeClass:function(value){var classes,elem,cur,curValue,clazz,j,finalValue,i=0;if(jQuery.isFunction(value)){return this.each(function(j){jQuery(this).removeClass(value.call(this,j,getClass(this)));
});}if(!arguments.length){return this.attr("class","");}if(typeof value==="string"&&value){classes=value.match(rnotwhite)||[];
while((elem=this[i++])){curValue=getClass(elem);cur=elem.nodeType===1&&(" "+curValue+" ").replace(rclass," ");
if(cur){j=0;while((clazz=classes[j++])){while(cur.indexOf(" "+clazz+" ")>-1){cur=cur.replace(" "+clazz+" "," ");
}}finalValue=jQuery.trim(cur);if(curValue!==finalValue){jQuery.attr(elem,"class",finalValue);}}}}return this;
},toggleClass:function(value,stateVal){var type=typeof value;if(typeof stateVal==="boolean"&&type==="string"){return stateVal?this.addClass(value):this.removeClass(value);
}if(jQuery.isFunction(value)){return this.each(function(i){jQuery(this).toggleClass(value.call(this,i,getClass(this),stateVal),stateVal);
});}return this.each(function(){var className,i,self,classNames;if(type==="string"){i=0;self=jQuery(this);
classNames=value.match(rnotwhite)||[];while((className=classNames[i++])){if(self.hasClass(className)){self.removeClass(className);
}else{self.addClass(className);}}}else{if(value===undefined||type==="boolean"){className=getClass(this);
if(className){jQuery._data(this,"__className__",className);}jQuery.attr(this,"class",className||value===false?"":jQuery._data(this,"__className__")||"");
}}});},hasClass:function(selector){var className,elem,i=0;className=" "+selector+" ";while((elem=this[i++])){if(elem.nodeType===1&&(" "+getClass(elem)+" ").replace(rclass," ").indexOf(className)>-1){return true;
}}return false;}});jQuery.each(("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu").split(" "),function(i,name){jQuery.fn[name]=function(data,fn){return arguments.length>0?this.on(name,null,data,fn):this.trigger(name);
};});jQuery.fn.extend({hover:function(fnOver,fnOut){return this.mouseenter(fnOver).mouseleave(fnOut||fnOver);
}});var location=window.location;var nonce=jQuery.now();var rquery=(/\?/);var rvalidtokens=/(,)|(\[|{)|(}|])|"(?:[^"\\\r\n]|\\["\\\/bfnrt]|\\u[\da-fA-F]{4})*"\s*:?|true|false|null|-?(?!0\d)\d+(?:\.\d+|)(?:[eE][+-]?\d+|)/g;
jQuery.parseJSON=function(data){if(window.JSON&&window.JSON.parse){return window.JSON.parse(data+"");
}var requireNonComma,depth=null,str=jQuery.trim(data+"");return str&&!jQuery.trim(str.replace(rvalidtokens,function(token,comma,open,close){if(requireNonComma&&comma){depth=0;
}if(depth===0){return token;}requireNonComma=open||comma;depth+=!close-!open;return"";}))?(Function("return "+str))():jQuery.error("Invalid JSON: "+data);
};jQuery.parseXML=function(data){var xml,tmp;if(!data||typeof data!=="string"){return null;}try{if(window.DOMParser){tmp=new window.DOMParser();
xml=tmp.parseFromString(data,"text/xml");}else{xml=new window.ActiveXObject("Microsoft.XMLDOM");xml.async="false";
xml.loadXML(data);}}catch(e){xml=undefined;}if(!xml||!xml.documentElement||xml.getElementsByTagName("parsererror").length){jQuery.error("Invalid XML: "+data);
}return xml;};var rhash=/#.*$/,rts=/([?&])_=[^&]*/,rheaders=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg,rlocalProtocol=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,rnoContent=/^(?:GET|HEAD)$/,rprotocol=/^\/\//,rurl=/^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/,prefilters={},transports={},allTypes="*/".concat("*"),ajaxLocation=location.href,ajaxLocParts=rurl.exec(ajaxLocation.toLowerCase())||[];
function addToPrefiltersOrTransports(structure){return function(dataTypeExpression,func){if(typeof dataTypeExpression!=="string"){func=dataTypeExpression;
dataTypeExpression="*";}var dataType,i=0,dataTypes=dataTypeExpression.toLowerCase().match(rnotwhite)||[];
if(jQuery.isFunction(func)){while((dataType=dataTypes[i++])){if(dataType.charAt(0)==="+"){dataType=dataType.slice(1)||"*";
(structure[dataType]=structure[dataType]||[]).unshift(func);}else{(structure[dataType]=structure[dataType]||[]).push(func);
}}}};}function inspectPrefiltersOrTransports(structure,options,originalOptions,jqXHR){var inspected={},seekingTransport=(structure===transports);
function inspect(dataType){var selected;inspected[dataType]=true;jQuery.each(structure[dataType]||[],function(_,prefilterOrFactory){var dataTypeOrTransport=prefilterOrFactory(options,originalOptions,jqXHR);
if(typeof dataTypeOrTransport==="string"&&!seekingTransport&&!inspected[dataTypeOrTransport]){options.dataTypes.unshift(dataTypeOrTransport);
inspect(dataTypeOrTransport);return false;}else{if(seekingTransport){return !(selected=dataTypeOrTransport);
}}});return selected;}return inspect(options.dataTypes[0])||!inspected["*"]&&inspect("*");}function ajaxExtend(target,src){var deep,key,flatOptions=jQuery.ajaxSettings.flatOptions||{};
for(key in src){if(src[key]!==undefined){(flatOptions[key]?target:(deep||(deep={})))[key]=src[key];}}if(deep){jQuery.extend(true,target,deep);
}return target;}function ajaxHandleResponses(s,jqXHR,responses){var firstDataType,ct,finalDataType,type,contents=s.contents,dataTypes=s.dataTypes;
while(dataTypes[0]==="*"){dataTypes.shift();if(ct===undefined){ct=s.mimeType||jqXHR.getResponseHeader("Content-Type");
}}if(ct){for(type in contents){if(contents[type]&&contents[type].test(ct)){dataTypes.unshift(type);break;
}}}if(dataTypes[0] in responses){finalDataType=dataTypes[0];}else{for(type in responses){if(!dataTypes[0]||s.converters[type+" "+dataTypes[0]]){finalDataType=type;
break;}if(!firstDataType){firstDataType=type;}}finalDataType=finalDataType||firstDataType;}if(finalDataType){if(finalDataType!==dataTypes[0]){dataTypes.unshift(finalDataType);
}return responses[finalDataType];}}function ajaxConvert(s,response,jqXHR,isSuccess){var conv2,current,conv,tmp,prev,converters={},dataTypes=s.dataTypes.slice();
if(dataTypes[1]){for(conv in s.converters){converters[conv.toLowerCase()]=s.converters[conv];}}current=dataTypes.shift();
while(current){if(s.responseFields[current]){jqXHR[s.responseFields[current]]=response;}if(!prev&&isSuccess&&s.dataFilter){response=s.dataFilter(response,s.dataType);
}prev=current;current=dataTypes.shift();if(current){if(current==="*"){current=prev;}else{if(prev!=="*"&&prev!==current){conv=converters[prev+" "+current]||converters["* "+current];
if(!conv){for(conv2 in converters){tmp=conv2.split(" ");if(tmp[1]===current){conv=converters[prev+" "+tmp[0]]||converters["* "+tmp[0]];
if(conv){if(conv===true){conv=converters[conv2];}else{if(converters[conv2]!==true){current=tmp[0];dataTypes.unshift(tmp[1]);
}}break;}}}}if(conv!==true){if(conv&&s["throws"]){response=conv(response);}else{try{response=conv(response);
}catch(e){return{state:"parsererror",error:conv?e:"No conversion from "+prev+" to "+current};}}}}}}}return{state:"success",data:response};
}jQuery.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:ajaxLocation,type:"GET",isLocal:rlocalProtocol.test(ajaxLocParts[1]),global:true,processData:true,async:true,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":allTypes,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":true,"text json":jQuery.parseJSON,"text xml":jQuery.parseXML},flatOptions:{url:true,context:true}},ajaxSetup:function(target,settings){return settings?ajaxExtend(ajaxExtend(target,jQuery.ajaxSettings),settings):ajaxExtend(jQuery.ajaxSettings,target);
},ajaxPrefilter:addToPrefiltersOrTransports(prefilters),ajaxTransport:addToPrefiltersOrTransports(transports),ajax:function(url,options){if(typeof url==="object"){options=url;
url=undefined;}options=options||{};var parts,i,cacheURL,responseHeadersString,timeoutTimer,fireGlobals,transport,responseHeaders,s=jQuery.ajaxSetup({},options),callbackContext=s.context||s,globalEventContext=s.context&&(callbackContext.nodeType||callbackContext.jquery)?jQuery(callbackContext):jQuery.event,deferred=jQuery.Deferred(),completeDeferred=jQuery.Callbacks("once memory"),statusCode=s.statusCode||{},requestHeaders={},requestHeadersNames={},state=0,strAbort="canceled",jqXHR={readyState:0,getResponseHeader:function(key){var match;
if(state===2){if(!responseHeaders){responseHeaders={};while((match=rheaders.exec(responseHeadersString))){responseHeaders[match[1].toLowerCase()]=match[2];
}}match=responseHeaders[key.toLowerCase()];}return match==null?null:match;},getAllResponseHeaders:function(){return state===2?responseHeadersString:null;
},setRequestHeader:function(name,value){var lname=name.toLowerCase();if(!state){name=requestHeadersNames[lname]=requestHeadersNames[lname]||name;
requestHeaders[name]=value;}return this;},overrideMimeType:function(type){if(!state){s.mimeType=type;
}return this;},statusCode:function(map){var code;if(map){if(state<2){for(code in map){statusCode[code]=[statusCode[code],map[code]];
}}else{jqXHR.always(map[jqXHR.status]);}}return this;},abort:function(statusText){var finalText=statusText||strAbort;
if(transport){transport.abort(finalText);}done(0,finalText);return this;}};deferred.promise(jqXHR).complete=completeDeferred.add;
jqXHR.success=jqXHR.done;jqXHR.error=jqXHR.fail;s.url=((url||s.url||ajaxLocation)+"").replace(rhash,"").replace(rprotocol,ajaxLocParts[1]+"//");
s.type=options.method||options.type||s.method||s.type;s.dataTypes=jQuery.trim(s.dataType||"*").toLowerCase().match(rnotwhite)||[""];
if(s.crossDomain==null){parts=rurl.exec(s.url.toLowerCase());s.crossDomain=!!(parts&&(parts[1]!==ajaxLocParts[1]||parts[2]!==ajaxLocParts[2]||(parts[3]||(parts[1]==="http:"?"80":"443"))!==(ajaxLocParts[3]||(ajaxLocParts[1]==="http:"?"80":"443"))));
}if(s.data&&s.processData&&typeof s.data!=="string"){s.data=jQuery.param(s.data,s.traditional);}inspectPrefiltersOrTransports(prefilters,s,options,jqXHR);
if(state===2){return jqXHR;}fireGlobals=jQuery.event&&s.global;if(fireGlobals&&jQuery.active++===0){jQuery.event.trigger("ajaxStart");
}s.type=s.type.toUpperCase();s.hasContent=!rnoContent.test(s.type);cacheURL=s.url;if(!s.hasContent){if(s.data){cacheURL=(s.url+=(rquery.test(cacheURL)?"&":"?")+s.data);
delete s.data;}if(s.cache===false){s.url=rts.test(cacheURL)?cacheURL.replace(rts,"$1_="+nonce++):cacheURL+(rquery.test(cacheURL)?"&":"?")+"_="+nonce++;
}}if(s.ifModified){if(jQuery.lastModified[cacheURL]){jqXHR.setRequestHeader("If-Modified-Since",jQuery.lastModified[cacheURL]);
}if(jQuery.etag[cacheURL]){jqXHR.setRequestHeader("If-None-Match",jQuery.etag[cacheURL]);}}if(s.data&&s.hasContent&&s.contentType!==false||options.contentType){jqXHR.setRequestHeader("Content-Type",s.contentType);
}jqXHR.setRequestHeader("Accept",s.dataTypes[0]&&s.accepts[s.dataTypes[0]]?s.accepts[s.dataTypes[0]]+(s.dataTypes[0]!=="*"?", "+allTypes+"; q=0.01":""):s.accepts["*"]);
for(i in s.headers){jqXHR.setRequestHeader(i,s.headers[i]);}if(s.beforeSend&&(s.beforeSend.call(callbackContext,jqXHR,s)===false||state===2)){return jqXHR.abort();
}strAbort="abort";for(i in {success:1,error:1,complete:1}){jqXHR[i](s[i]);}transport=inspectPrefiltersOrTransports(transports,s,options,jqXHR);
if(!transport){done(-1,"No Transport");}else{jqXHR.readyState=1;if(fireGlobals){globalEventContext.trigger("ajaxSend",[jqXHR,s]);
}if(state===2){return jqXHR;}if(s.async&&s.timeout>0){timeoutTimer=window.setTimeout(function(){jqXHR.abort("timeout");
},s.timeout);}try{state=1;transport.send(requestHeaders,done);}catch(e){if(state<2){done(-1,e);}else{throw e;
}}}function done(status,nativeStatusText,responses,headers){var isSuccess,success,error,response,modified,statusText=nativeStatusText;
if(state===2){return;}state=2;if(timeoutTimer){window.clearTimeout(timeoutTimer);}transport=undefined;
responseHeadersString=headers||"";jqXHR.readyState=status>0?4:0;isSuccess=status>=200&&status<300||status===304;
if(responses){response=ajaxHandleResponses(s,jqXHR,responses);}response=ajaxConvert(s,response,jqXHR,isSuccess);
if(isSuccess){if(s.ifModified){modified=jqXHR.getResponseHeader("Last-Modified");if(modified){jQuery.lastModified[cacheURL]=modified;
}modified=jqXHR.getResponseHeader("etag");if(modified){jQuery.etag[cacheURL]=modified;}}if(status===204||s.type==="HEAD"){statusText="nocontent";
}else{if(status===304){statusText="notmodified";}else{statusText=response.state;success=response.data;
error=response.error;isSuccess=!error;}}}else{error=statusText;if(status||!statusText){statusText="error";
if(status<0){status=0;}}}jqXHR.status=status;jqXHR.statusText=(nativeStatusText||statusText)+"";if(isSuccess){deferred.resolveWith(callbackContext,[success,statusText,jqXHR]);
}else{deferred.rejectWith(callbackContext,[jqXHR,statusText,error]);}jqXHR.statusCode(statusCode);statusCode=undefined;
if(fireGlobals){globalEventContext.trigger(isSuccess?"ajaxSuccess":"ajaxError",[jqXHR,s,isSuccess?success:error]);
}completeDeferred.fireWith(callbackContext,[jqXHR,statusText]);if(fireGlobals){globalEventContext.trigger("ajaxComplete",[jqXHR,s]);
if(!(--jQuery.active)){jQuery.event.trigger("ajaxStop");}}}return jqXHR;},getJSON:function(url,data,callback){return jQuery.get(url,data,callback,"json");
},getScript:function(url,callback){return jQuery.get(url,undefined,callback,"script");}});jQuery.each(["get","post"],function(i,method){jQuery[method]=function(url,data,callback,type){if(jQuery.isFunction(data)){type=type||callback;
callback=data;data=undefined;}return jQuery.ajax(jQuery.extend({url:url,type:method,dataType:type,data:data,success:callback},jQuery.isPlainObject(url)&&url));
};});jQuery._evalUrl=function(url){return jQuery.ajax({url:url,type:"GET",dataType:"script",cache:true,async:false,global:false,"throws":true});
};jQuery.fn.extend({wrapAll:function(html){if(jQuery.isFunction(html)){return this.each(function(i){jQuery(this).wrapAll(html.call(this,i));
});}if(this[0]){var wrap=jQuery(html,this[0].ownerDocument).eq(0).clone(true);if(this[0].parentNode){wrap.insertBefore(this[0]);
}wrap.map(function(){var elem=this;while(elem.firstChild&&elem.firstChild.nodeType===1){elem=elem.firstChild;
}return elem;}).append(this);}return this;},wrapInner:function(html){if(jQuery.isFunction(html)){return this.each(function(i){jQuery(this).wrapInner(html.call(this,i));
});}return this.each(function(){var self=jQuery(this),contents=self.contents();if(contents.length){contents.wrapAll(html);
}else{self.append(html);}});},wrap:function(html){var isFunction=jQuery.isFunction(html);return this.each(function(i){jQuery(this).wrapAll(isFunction?html.call(this,i):html);
});},unwrap:function(){return this.parent().each(function(){if(!jQuery.nodeName(this,"body")){jQuery(this).replaceWith(this.childNodes);
}}).end();}});function getDisplay(elem){return elem.style&&elem.style.display||jQuery.css(elem,"display");
}function filterHidden(elem){if(!jQuery.contains(elem.ownerDocument||document,elem)){return true;}while(elem&&elem.nodeType===1){if(getDisplay(elem)==="none"||elem.type==="hidden"){return true;
}elem=elem.parentNode;}return false;}jQuery.expr.filters.hidden=function(elem){return support.reliableHiddenOffsets()?(elem.offsetWidth<=0&&elem.offsetHeight<=0&&!elem.getClientRects().length):filterHidden(elem);
};jQuery.expr.filters.visible=function(elem){return !jQuery.expr.filters.hidden(elem);};var r20=/%20/g,rbracket=/\[\]$/,rCRLF=/\r?\n/g,rsubmitterTypes=/^(?:submit|button|image|reset|file)$/i,rsubmittable=/^(?:input|select|textarea|keygen)/i;
function buildParams(prefix,obj,traditional,add){var name;if(jQuery.isArray(obj)){jQuery.each(obj,function(i,v){if(traditional||rbracket.test(prefix)){add(prefix,v);
}else{buildParams(prefix+"["+(typeof v==="object"&&v!=null?i:"")+"]",v,traditional,add);}});}else{if(!traditional&&jQuery.type(obj)==="object"){for(name in obj){buildParams(prefix+"["+name+"]",obj[name],traditional,add);
}}else{add(prefix,obj);}}}jQuery.param=function(a,traditional){var prefix,s=[],add=function(key,value){value=jQuery.isFunction(value)?value():(value==null?"":value);
s[s.length]=encodeURIComponent(key)+"="+encodeURIComponent(value);};if(traditional===undefined){traditional=jQuery.ajaxSettings&&jQuery.ajaxSettings.traditional;
}if(jQuery.isArray(a)||(a.jquery&&!jQuery.isPlainObject(a))){jQuery.each(a,function(){add(this.name,this.value);
});}else{for(prefix in a){buildParams(prefix,a[prefix],traditional,add);}}return s.join("&").replace(r20,"+");
};jQuery.fn.extend({serialize:function(){return jQuery.param(this.serializeArray());},serializeArray:function(){return this.map(function(){var elements=jQuery.prop(this,"elements");
return elements?jQuery.makeArray(elements):this;}).filter(function(){var type=this.type;return this.name&&!jQuery(this).is(":disabled")&&rsubmittable.test(this.nodeName)&&!rsubmitterTypes.test(type)&&(this.checked||!rcheckableType.test(type));
}).map(function(i,elem){var val=jQuery(this).val();return val==null?null:jQuery.isArray(val)?jQuery.map(val,function(val){return{name:elem.name,value:val.replace(rCRLF,"\r\n")};
}):{name:elem.name,value:val.replace(rCRLF,"\r\n")};}).get();}});jQuery.ajaxSettings.xhr=window.ActiveXObject!==undefined?function(){if(this.isLocal){return createActiveXHR();
}if(document.documentMode>8){return createStandardXHR();}return/^(get|post|head|put|delete|options)$/i.test(this.type)&&createStandardXHR()||createActiveXHR();
}:createStandardXHR;var xhrId=0,xhrCallbacks={},xhrSupported=jQuery.ajaxSettings.xhr();if(window.attachEvent){window.attachEvent("onunload",function(){for(var key in xhrCallbacks){xhrCallbacks[key](undefined,true);
}});}support.cors=!!xhrSupported&&("withCredentials" in xhrSupported);xhrSupported=support.ajax=!!xhrSupported;
if(xhrSupported){jQuery.ajaxTransport(function(options){if(!options.crossDomain||support.cors){var callback;
return{send:function(headers,complete){var i,xhr=options.xhr(),id=++xhrId;xhr.open(options.type,options.url,options.async,options.username,options.password);
if(options.xhrFields){for(i in options.xhrFields){xhr[i]=options.xhrFields[i];}}if(options.mimeType&&xhr.overrideMimeType){xhr.overrideMimeType(options.mimeType);
}if(!options.crossDomain&&!headers["X-Requested-With"]){headers["X-Requested-With"]="XMLHttpRequest";
}for(i in headers){if(headers[i]!==undefined){xhr.setRequestHeader(i,headers[i]+"");}}xhr.send((options.hasContent&&options.data)||null);
callback=function(_,isAbort){var status,statusText,responses;if(callback&&(isAbort||xhr.readyState===4)){delete xhrCallbacks[id];
callback=undefined;xhr.onreadystatechange=jQuery.noop;if(isAbort){if(xhr.readyState!==4){xhr.abort();
}}else{responses={};status=xhr.status;if(typeof xhr.responseText==="string"){responses.text=xhr.responseText;
}try{statusText=xhr.statusText;}catch(e){statusText="";}if(!status&&options.isLocal&&!options.crossDomain){status=responses.text?200:404;
}else{if(status===1223){status=204;}}}}if(responses){complete(status,statusText,responses,xhr.getAllResponseHeaders());
}};if(!options.async){callback();}else{if(xhr.readyState===4){window.setTimeout(callback);}else{xhr.onreadystatechange=xhrCallbacks[id]=callback;
}}},abort:function(){if(callback){callback(undefined,true);}}};}});}function createStandardXHR(){try{return new window.XMLHttpRequest();
}catch(e){}}function createActiveXHR(){try{return new window.ActiveXObject("Microsoft.XMLHTTP");}catch(e){}}jQuery.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(text){jQuery.globalEval(text);
return text;}}});jQuery.ajaxPrefilter("script",function(s){if(s.cache===undefined){s.cache=false;}if(s.crossDomain){s.type="GET";
s.global=false;}});jQuery.ajaxTransport("script",function(s){if(s.crossDomain){var script,head=document.head||jQuery("head")[0]||document.documentElement;
return{send:function(_,callback){script=document.createElement("script");script.async=true;if(s.scriptCharset){script.charset=s.scriptCharset;
}script.src=s.url;script.onload=script.onreadystatechange=function(_,isAbort){if(isAbort||!script.readyState||/loaded|complete/.test(script.readyState)){script.onload=script.onreadystatechange=null;
if(script.parentNode){script.parentNode.removeChild(script);}script=null;if(!isAbort){callback(200,"success");
}}};head.insertBefore(script,head.firstChild);},abort:function(){if(script){script.onload(undefined,true);
}}};}});var oldCallbacks=[],rjsonp=/(=)\?(?=&|$)|\?\?/;jQuery.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var callback=oldCallbacks.pop()||(jQuery.expando+"_"+(nonce++));
this[callback]=true;return callback;}});jQuery.ajaxPrefilter("json jsonp",function(s,originalSettings,jqXHR){var callbackName,overwritten,responseContainer,jsonProp=s.jsonp!==false&&(rjsonp.test(s.url)?"url":typeof s.data==="string"&&(s.contentType||"").indexOf("application/x-www-form-urlencoded")===0&&rjsonp.test(s.data)&&"data");
if(jsonProp||s.dataTypes[0]==="jsonp"){callbackName=s.jsonpCallback=jQuery.isFunction(s.jsonpCallback)?s.jsonpCallback():s.jsonpCallback;
if(jsonProp){s[jsonProp]=s[jsonProp].replace(rjsonp,"$1"+callbackName);}else{if(s.jsonp!==false){s.url+=(rquery.test(s.url)?"&":"?")+s.jsonp+"="+callbackName;
}}s.converters["script json"]=function(){if(!responseContainer){jQuery.error(callbackName+" was not called");
}return responseContainer[0];};s.dataTypes[0]="json";overwritten=window[callbackName];window[callbackName]=function(){responseContainer=arguments;
};jqXHR.always(function(){if(overwritten===undefined){jQuery(window).removeProp(callbackName);}else{window[callbackName]=overwritten;
}if(s[callbackName]){s.jsonpCallback=originalSettings.jsonpCallback;oldCallbacks.push(callbackName);}if(responseContainer&&jQuery.isFunction(overwritten)){overwritten(responseContainer[0]);
}responseContainer=overwritten=undefined;});return"script";}});jQuery.parseHTML=function(data,context,keepScripts){if(!data||typeof data!=="string"){return null;
}if(typeof context==="boolean"){keepScripts=context;context=false;}context=context||document;var parsed=rsingleTag.exec(data),scripts=!keepScripts&&[];
if(parsed){return[context.createElement(parsed[1])];}parsed=buildFragment([data],context,scripts);if(scripts&&scripts.length){jQuery(scripts).remove();
}return jQuery.merge([],parsed.childNodes);};var _load=jQuery.fn.load;jQuery.fn.load=function(url,params,callback){if(typeof url!=="string"&&_load){return _load.apply(this,arguments);
}var selector,type,response,self=this,off=url.indexOf(" ");if(off>-1){selector=jQuery.trim(url.slice(off,url.length));
url=url.slice(0,off);}if(jQuery.isFunction(params)){callback=params;params=undefined;}else{if(params&&typeof params==="object"){type="POST";
}}if(self.length>0){jQuery.ajax({url:url,type:type||"GET",dataType:"html",data:params}).done(function(responseText){response=arguments;
self.html(selector?jQuery("<div>").append(jQuery.parseHTML(responseText)).find(selector):responseText);
}).always(callback&&function(jqXHR,status){self.each(function(){callback.apply(this,response||[jqXHR.responseText,status,jqXHR]);
});});}return this;};jQuery.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(i,type){jQuery.fn[type]=function(fn){return this.on(type,fn);
};});jQuery.expr.filters.animated=function(elem){return jQuery.grep(jQuery.timers,function(fn){return elem===fn.elem;
}).length;};function getWindow(elem){return jQuery.isWindow(elem)?elem:elem.nodeType===9?elem.defaultView||elem.parentWindow:false;
}jQuery.offset={setOffset:function(elem,options,i){var curPosition,curLeft,curCSSTop,curTop,curOffset,curCSSLeft,calculatePosition,position=jQuery.css(elem,"position"),curElem=jQuery(elem),props={};
if(position==="static"){elem.style.position="relative";}curOffset=curElem.offset();curCSSTop=jQuery.css(elem,"top");
curCSSLeft=jQuery.css(elem,"left");calculatePosition=(position==="absolute"||position==="fixed")&&jQuery.inArray("auto",[curCSSTop,curCSSLeft])>-1;
if(calculatePosition){curPosition=curElem.position();curTop=curPosition.top;curLeft=curPosition.left;
}else{curTop=parseFloat(curCSSTop)||0;curLeft=parseFloat(curCSSLeft)||0;}if(jQuery.isFunction(options)){options=options.call(elem,i,jQuery.extend({},curOffset));
}if(options.top!=null){props.top=(options.top-curOffset.top)+curTop;}if(options.left!=null){props.left=(options.left-curOffset.left)+curLeft;
}if("using" in options){options.using.call(elem,props);}else{curElem.css(props);}}};jQuery.fn.extend({offset:function(options){if(arguments.length){return options===undefined?this:this.each(function(i){jQuery.offset.setOffset(this,options,i);
});}var docElem,win,box={top:0,left:0},elem=this[0],doc=elem&&elem.ownerDocument;if(!doc){return;}docElem=doc.documentElement;
if(!jQuery.contains(docElem,elem)){return box;}if(typeof elem.getBoundingClientRect!=="undefined"){box=elem.getBoundingClientRect();
}win=getWindow(doc);return{top:box.top+(win.pageYOffset||docElem.scrollTop)-(docElem.clientTop||0),left:box.left+(win.pageXOffset||docElem.scrollLeft)-(docElem.clientLeft||0)};
},position:function(){if(!this[0]){return;}var offsetParent,offset,parentOffset={top:0,left:0},elem=this[0];
if(jQuery.css(elem,"position")==="fixed"){offset=elem.getBoundingClientRect();}else{offsetParent=this.offsetParent();
offset=this.offset();if(!jQuery.nodeName(offsetParent[0],"html")){parentOffset=offsetParent.offset();
}parentOffset.top+=jQuery.css(offsetParent[0],"borderTopWidth",true);parentOffset.left+=jQuery.css(offsetParent[0],"borderLeftWidth",true);
}return{top:offset.top-parentOffset.top-jQuery.css(elem,"marginTop",true),left:offset.left-parentOffset.left-jQuery.css(elem,"marginLeft",true)};
},offsetParent:function(){return this.map(function(){var offsetParent=this.offsetParent;while(offsetParent&&(!jQuery.nodeName(offsetParent,"html")&&jQuery.css(offsetParent,"position")==="static")){offsetParent=offsetParent.offsetParent;
}return offsetParent||documentElement;});}});jQuery.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(method,prop){var top=/Y/.test(prop);
jQuery.fn[method]=function(val){return access(this,function(elem,method,val){var win=getWindow(elem);
if(val===undefined){return win?(prop in win)?win[prop]:win.document.documentElement[method]:elem[method];
}if(win){win.scrollTo(!top?val:jQuery(win).scrollLeft(),top?val:jQuery(win).scrollTop());}else{elem[method]=val;
}},method,val,arguments.length,null);};});jQuery.each(["top","left"],function(i,prop){jQuery.cssHooks[prop]=addGetHookIf(support.pixelPosition,function(elem,computed){if(computed){computed=curCSS(elem,prop);
return rnumnonpx.test(computed)?jQuery(elem).position()[prop]+"px":computed;}});});jQuery.each({Height:"height",Width:"width"},function(name,type){jQuery.each({padding:"inner"+name,content:type,"":"outer"+name},function(defaultExtra,funcName){jQuery.fn[funcName]=function(margin,value){var chainable=arguments.length&&(defaultExtra||typeof margin!=="boolean"),extra=defaultExtra||(margin===true||value===true?"margin":"border");
return access(this,function(elem,type,value){var doc;if(jQuery.isWindow(elem)){return elem.document.documentElement["client"+name];
}if(elem.nodeType===9){doc=elem.documentElement;return Math.max(elem.body["scroll"+name],doc["scroll"+name],elem.body["offset"+name],doc["offset"+name],doc["client"+name]);
}return value===undefined?jQuery.css(elem,type,extra):jQuery.style(elem,type,value,extra);},type,chainable?margin:undefined,chainable,null);
};});});jQuery.fn.extend({bind:function(types,data,fn){return this.on(types,null,data,fn);},unbind:function(types,fn){return this.off(types,null,fn);
},delegate:function(selector,types,data,fn){return this.on(types,selector,data,fn);},undelegate:function(selector,types,fn){return arguments.length===1?this.off(selector,"**"):this.off(types,selector||"**",fn);
}});jQuery.fn.size=function(){return this.length;};jQuery.fn.andSelf=jQuery.fn.addBack;if(typeof define==="function"&&define.amd){define("jquery",[],function(){return jQuery;
});}var _jQuery=window.jQuery,_$=window.$;jQuery.noConflict=function(deep){if(window.$===jQuery){window.$=_$;
}if(deep&&window.jQuery===jQuery){window.jQuery=_jQuery;}return jQuery;};if(!noGlobal){window.jQuery=window.$=jQuery;
}return jQuery;}));(function(){function n(n){function t(t,r,e,u,i,o){for(;i>=0&&o>i;i+=n){var a=u?u[i]:i;
e=r(e,t[a],a,t);}return e;}return function(r,e,u,i){e=b(e,i,4);var o=!k(r)&&m.keys(r),a=(o||r).length,c=n>0?0:a-1;
return arguments.length<3&&(u=r[o?o[c]:c],c+=n),t(r,e,u,o,c,a);};}function t(n){return function(t,r,e){r=x(r,e);
for(var u=O(t),i=n>0?0:u-1;i>=0&&u>i;i+=n){if(r(t[i],i,t)){return i;}}return -1;};}function r(n,t,r){return function(e,u,i){var o=0,a=O(e);
if("number"==typeof i){n>0?o=i>=0?i:Math.max(i+a,o):a=i>=0?Math.min(i+1,a):i+a+1;}else{if(r&&i&&a){return i=r(e,u),e[i]===u?i:-1;
}}if(u!==u){return i=t(l.call(e,o,a),m.isNaN),i>=0?i+o:-1;}for(i=n>0?o:a-1;i>=0&&a>i;i+=n){if(e[i]===u){return i;
}}return -1;};}function e(n,t){var r=I.length,e=n.constructor,u=m.isFunction(e)&&e.prototype||a,i="constructor";
for(m.has(n,i)&&!m.contains(t,i)&&t.push(i);r--;){i=I[r],i in n&&n[i]!==u[i]&&!m.contains(t,i)&&t.push(i);
}}var u=this,i=u._,o=Array.prototype,a=Object.prototype,c=Function.prototype,f=o.push,l=o.slice,s=a.toString,p=a.hasOwnProperty,h=Array.isArray,v=Object.keys,g=c.bind,y=Object.create,d=function(){},m=function(n){return n instanceof m?n:this instanceof m?void (this._wrapped=n):new m(n);
};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=m),exports._=m):u._=m,m.VERSION="1.8.3";
var b=function(n,t,r){if(t===void 0){return n;}switch(null==r?3:r){case 1:return function(r){return n.call(t,r);
};case 2:return function(r,e){return n.call(t,r,e);};case 3:return function(r,e,u){return n.call(t,r,e,u);
};case 4:return function(r,e,u,i){return n.call(t,r,e,u,i);};}return function(){return n.apply(t,arguments);
};},x=function(n,t,r){return null==n?m.identity:m.isFunction(n)?b(n,t,r):m.isObject(n)?m.matcher(n):m.property(n);
};m.iteratee=function(n,t){return x(n,t,1/0);};var _=function(n,t){return function(r){var e=arguments.length;
if(2>e||null==r){return r;}for(var u=1;e>u;u++){for(var i=arguments[u],o=n(i),a=o.length,c=0;a>c;c++){var f=o[c];
t&&r[f]!==void 0||(r[f]=i[f]);}}return r;};},j=function(n){if(!m.isObject(n)){return{};}if(y){return y(n);
}d.prototype=n;var t=new d;return d.prototype=null,t;},w=function(n){return function(t){return null==t?void 0:t[n];
};},A=Math.pow(2,53)-1,O=w("length"),k=function(n){var t=O(n);return"number"==typeof t&&t>=0&&A>=t;};
m.each=m.forEach=function(n,t,r){t=b(t,r);var e,u;if(k(n)){for(e=0,u=n.length;u>e;e++){t(n[e],e,n);}}else{var i=m.keys(n);
for(e=0,u=i.length;u>e;e++){t(n[i[e]],i[e],n);}}return n;},m.map=m.collect=function(n,t,r){t=x(t,r);for(var e=!k(n)&&m.keys(n),u=(e||n).length,i=Array(u),o=0;
u>o;o++){var a=e?e[o]:o;i[o]=t(n[a],a,n);}return i;},m.reduce=m.foldl=m.inject=n(1),m.reduceRight=m.foldr=n(-1),m.find=m.detect=function(n,t,r){var e;
return e=k(n)?m.findIndex(n,t,r):m.findKey(n,t,r),e!==void 0&&e!==-1?n[e]:void 0;},m.filter=m.select=function(n,t,r){var e=[];
return t=x(t,r),m.each(n,function(n,r,u){t(n,r,u)&&e.push(n);}),e;},m.reject=function(n,t,r){return m.filter(n,m.negate(x(t)),r);
},m.every=m.all=function(n,t,r){t=x(t,r);for(var e=!k(n)&&m.keys(n),u=(e||n).length,i=0;u>i;i++){var o=e?e[i]:i;
if(!t(n[o],o,n)){return !1;}}return !0;},m.some=m.any=function(n,t,r){t=x(t,r);for(var e=!k(n)&&m.keys(n),u=(e||n).length,i=0;
u>i;i++){var o=e?e[i]:i;if(t(n[o],o,n)){return !0;}}return !1;},m.contains=m.includes=m.include=function(n,t,r,e){return k(n)||(n=m.values(n)),("number"!=typeof r||e)&&(r=0),m.indexOf(n,t,r)>=0;
},m.invoke=function(n,t){var r=l.call(arguments,2),e=m.isFunction(t);return m.map(n,function(n){var u=e?t:n[t];
return null==u?u:u.apply(n,r);});},m.pluck=function(n,t){return m.map(n,m.property(t));},m.where=function(n,t){return m.filter(n,m.matcher(t));
},m.findWhere=function(n,t){return m.find(n,m.matcher(t));},m.max=function(n,t,r){var e,u,i=-1/0,o=-1/0;
if(null==t&&null!=n){n=k(n)?n:m.values(n);for(var a=0,c=n.length;c>a;a++){e=n[a],e>i&&(i=e);}}else{t=x(t,r),m.each(n,function(n,r,e){u=t(n,r,e),(u>o||u===-1/0&&i===-1/0)&&(i=n,o=u);
});}return i;},m.min=function(n,t,r){var e,u,i=1/0,o=1/0;if(null==t&&null!=n){n=k(n)?n:m.values(n);for(var a=0,c=n.length;
c>a;a++){e=n[a],i>e&&(i=e);}}else{t=x(t,r),m.each(n,function(n,r,e){u=t(n,r,e),(o>u||1/0===u&&1/0===i)&&(i=n,o=u);
});}return i;},m.shuffle=function(n){for(var t,r=k(n)?n:m.values(n),e=r.length,u=Array(e),i=0;e>i;i++){t=m.random(0,i),t!==i&&(u[i]=u[t]),u[t]=r[i];
}return u;},m.sample=function(n,t,r){return null==t||r?(k(n)||(n=m.values(n)),n[m.random(n.length-1)]):m.shuffle(n).slice(0,Math.max(0,t));
},m.sortBy=function(n,t,r){return t=x(t,r),m.pluck(m.map(n,function(n,r,e){return{value:n,index:r,criteria:t(n,r,e)};
}).sort(function(n,t){var r=n.criteria,e=t.criteria;if(r!==e){if(r>e||r===void 0){return 1;}if(e>r||e===void 0){return -1;
}}return n.index-t.index;}),"value");};var F=function(n){return function(t,r,e){var u={};return r=x(r,e),m.each(t,function(e,i){var o=r(e,i,t);
n(u,e,o);}),u;};};m.groupBy=F(function(n,t,r){m.has(n,r)?n[r].push(t):n[r]=[t];}),m.indexBy=F(function(n,t,r){n[r]=t;
}),m.countBy=F(function(n,t,r){m.has(n,r)?n[r]++:n[r]=1;}),m.toArray=function(n){return n?m.isArray(n)?l.call(n):k(n)?m.map(n,m.identity):m.values(n):[];
},m.size=function(n){return null==n?0:k(n)?n.length:m.keys(n).length;},m.partition=function(n,t,r){t=x(t,r);
var e=[],u=[];return m.each(n,function(n,r,i){(t(n,r,i)?e:u).push(n);}),[e,u];},m.first=m.head=m.take=function(n,t,r){return null==n?void 0:null==t||r?n[0]:m.initial(n,n.length-t);
},m.initial=function(n,t,r){return l.call(n,0,Math.max(0,n.length-(null==t||r?1:t)));},m.last=function(n,t,r){return null==n?void 0:null==t||r?n[n.length-1]:m.rest(n,Math.max(0,n.length-t));
},m.rest=m.tail=m.drop=function(n,t,r){return l.call(n,null==t||r?1:t);},m.compact=function(n){return m.filter(n,m.identity);
};var S=function(n,t,r,e){for(var u=[],i=0,o=e||0,a=O(n);a>o;o++){var c=n[o];if(k(c)&&(m.isArray(c)||m.isArguments(c))){t||(c=S(c,t,r));
var f=0,l=c.length;for(u.length+=l;l>f;){u[i++]=c[f++];}}else{r||(u[i++]=c);}}return u;};m.flatten=function(n,t){return S(n,t,!1);
},m.without=function(n){return m.difference(n,l.call(arguments,1));},m.uniq=m.unique=function(n,t,r,e){m.isBoolean(t)||(e=r,r=t,t=!1),null!=r&&(r=x(r,e));
for(var u=[],i=[],o=0,a=O(n);a>o;o++){var c=n[o],f=r?r(c,o,n):c;t?(o&&i===f||u.push(c),i=f):r?m.contains(i,f)||(i.push(f),u.push(c)):m.contains(u,c)||u.push(c);
}return u;},m.union=function(){return m.uniq(S(arguments,!0,!0));},m.intersection=function(n){for(var t=[],r=arguments.length,e=0,u=O(n);
u>e;e++){var i=n[e];if(!m.contains(t,i)){for(var o=1;r>o&&m.contains(arguments[o],i);o++){}o===r&&t.push(i);
}}return t;},m.difference=function(n){var t=S(arguments,!0,!0,1);return m.filter(n,function(n){return !m.contains(t,n);
});},m.zip=function(){return m.unzip(arguments);},m.unzip=function(n){for(var t=n&&m.max(n,O).length||0,r=Array(t),e=0;
t>e;e++){r[e]=m.pluck(n,e);}return r;},m.object=function(n,t){for(var r={},e=0,u=O(n);u>e;e++){t?r[n[e]]=t[e]:r[n[e][0]]=n[e][1];
}return r;},m.findIndex=t(1),m.findLastIndex=t(-1),m.sortedIndex=function(n,t,r,e){r=x(r,e,1);for(var u=r(t),i=0,o=O(n);
o>i;){var a=Math.floor((i+o)/2);r(n[a])<u?i=a+1:o=a;}return i;},m.indexOf=r(1,m.findIndex,m.sortedIndex),m.lastIndexOf=r(-1,m.findLastIndex),m.range=function(n,t,r){null==t&&(t=n||0,n=0),r=r||1;
for(var e=Math.max(Math.ceil((t-n)/r),0),u=Array(e),i=0;e>i;i++,n+=r){u[i]=n;}return u;};var E=function(n,t,r,e,u){if(!(e instanceof t)){return n.apply(r,u);
}var i=j(n.prototype),o=n.apply(i,u);return m.isObject(o)?o:i;};m.bind=function(n,t){if(g&&n.bind===g){return g.apply(n,l.call(arguments,1));
}if(!m.isFunction(n)){throw new TypeError("Bind must be called on a function");}var r=l.call(arguments,2),e=function(){return E(n,e,t,this,r.concat(l.call(arguments)));
};return e;},m.partial=function(n){var t=l.call(arguments,1),r=function(){for(var e=0,u=t.length,i=Array(u),o=0;
u>o;o++){i[o]=t[o]===m?arguments[e++]:t[o];}for(;e<arguments.length;){i.push(arguments[e++]);}return E(n,r,this,this,i);
};return r;},m.bindAll=function(n){var t,r,e=arguments.length;if(1>=e){throw new Error("bindAll must be passed function names");
}for(t=1;e>t;t++){r=arguments[t],n[r]=m.bind(n[r],n);}return n;},m.memoize=function(n,t){var r=function(e){var u=r.cache,i=""+(t?t.apply(this,arguments):e);
return m.has(u,i)||(u[i]=n.apply(this,arguments)),u[i];};return r.cache={},r;},m.delay=function(n,t){var r=l.call(arguments,2);
return setTimeout(function(){return n.apply(null,r);},t);},m.defer=m.partial(m.delay,m,1),m.throttle=function(n,t,r){var e,u,i,o=null,a=0;
r||(r={});var c=function(){a=r.leading===!1?0:m.now(),o=null,i=n.apply(e,u),o||(e=u=null);};return function(){var f=m.now();
a||r.leading!==!1||(a=f);var l=t-(f-a);return e=this,u=arguments,0>=l||l>t?(o&&(clearTimeout(o),o=null),a=f,i=n.apply(e,u),o||(e=u=null)):o||r.trailing===!1||(o=setTimeout(c,l)),i;
};},m.debounce=function(n,t,r){var e,u,i,o,a,c=function(){var f=m.now()-o;t>f&&f>=0?e=setTimeout(c,t-f):(e=null,r||(a=n.apply(i,u),e||(i=u=null)));
};return function(){i=this,u=arguments,o=m.now();var f=r&&!e;return e||(e=setTimeout(c,t)),f&&(a=n.apply(i,u),i=u=null),a;
};},m.wrap=function(n,t){return m.partial(t,n);},m.negate=function(n){return function(){return !n.apply(this,arguments);
};},m.compose=function(){var n=arguments,t=n.length-1;return function(){for(var r=t,e=n[t].apply(this,arguments);
r--;){e=n[r].call(this,e);}return e;};},m.after=function(n,t){return function(){return --n<1?t.apply(this,arguments):void 0;
};},m.before=function(n,t){var r;return function(){return --n>0&&(r=t.apply(this,arguments)),1>=n&&(t=null),r;
};},m.once=m.partial(m.before,2);var M=!{toString:null}.propertyIsEnumerable("toString"),I=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];
m.keys=function(n){if(!m.isObject(n)){return[];}if(v){return v(n);}var t=[];for(var r in n){m.has(n,r)&&t.push(r);
}return M&&e(n,t),t;},m.allKeys=function(n){if(!m.isObject(n)){return[];}var t=[];for(var r in n){t.push(r);
}return M&&e(n,t),t;},m.values=function(n){for(var t=m.keys(n),r=t.length,e=Array(r),u=0;r>u;u++){e[u]=n[t[u]];
}return e;},m.mapObject=function(n,t,r){t=x(t,r);for(var e,u=m.keys(n),i=u.length,o={},a=0;i>a;a++){e=u[a],o[e]=t(n[e],e,n);
}return o;},m.pairs=function(n){for(var t=m.keys(n),r=t.length,e=Array(r),u=0;r>u;u++){e[u]=[t[u],n[t[u]]];
}return e;},m.invert=function(n){for(var t={},r=m.keys(n),e=0,u=r.length;u>e;e++){t[n[r[e]]]=r[e];}return t;
},m.functions=m.methods=function(n){var t=[];for(var r in n){m.isFunction(n[r])&&t.push(r);}return t.sort();
},m.extend=_(m.allKeys),m.extendOwn=m.assign=_(m.keys),m.findKey=function(n,t,r){t=x(t,r);for(var e,u=m.keys(n),i=0,o=u.length;
o>i;i++){if(e=u[i],t(n[e],e,n)){return e;}}},m.pick=function(n,t,r){var e,u,i={},o=n;if(null==o){return i;
}m.isFunction(t)?(u=m.allKeys(o),e=b(t,r)):(u=S(arguments,!1,!1,1),e=function(n,t,r){return t in r;},o=Object(o));
for(var a=0,c=u.length;c>a;a++){var f=u[a],l=o[f];e(l,f,o)&&(i[f]=l);}return i;},m.omit=function(n,t,r){if(m.isFunction(t)){t=m.negate(t);
}else{var e=m.map(S(arguments,!1,!1,1),String);t=function(n,t){return !m.contains(e,t);};}return m.pick(n,t,r);
},m.defaults=_(m.allKeys,!0),m.create=function(n,t){var r=j(n);return t&&m.extendOwn(r,t),r;},m.clone=function(n){return m.isObject(n)?m.isArray(n)?n.slice():m.extend({},n):n;
},m.tap=function(n,t){return t(n),n;},m.isMatch=function(n,t){var r=m.keys(t),e=r.length;if(null==n){return !e;
}for(var u=Object(n),i=0;e>i;i++){var o=r[i];if(t[o]!==u[o]||!(o in u)){return !1;}}return !0;};var N=function(n,t,r,e){if(n===t){return 0!==n||1/n===1/t;
}if(null==n||null==t){return n===t;}n instanceof m&&(n=n._wrapped),t instanceof m&&(t=t._wrapped);var u=s.call(n);
if(u!==s.call(t)){return !1;}switch(u){case"[object RegExp]":case"[object String]":return""+n==""+t;case"[object Number]":return +n!==+n?+t!==+t:0===+n?1/+n===1/t:+n===+t;
case"[object Date]":case"[object Boolean]":return +n===+t;}var i="[object Array]"===u;if(!i){if("object"!=typeof n||"object"!=typeof t){return !1;
}var o=n.constructor,a=t.constructor;if(o!==a&&!(m.isFunction(o)&&o instanceof o&&m.isFunction(a)&&a instanceof a)&&"constructor" in n&&"constructor" in t){return !1;
}}r=r||[],e=e||[];for(var c=r.length;c--;){if(r[c]===n){return e[c]===t;}}if(r.push(n),e.push(t),i){if(c=n.length,c!==t.length){return !1;
}for(;c--;){if(!N(n[c],t[c],r,e)){return !1;}}}else{var f,l=m.keys(n);if(c=l.length,m.keys(t).length!==c){return !1;
}for(;c--;){if(f=l[c],!m.has(t,f)||!N(n[f],t[f],r,e)){return !1;}}}return r.pop(),e.pop(),!0;};m.isEqual=function(n,t){return N(n,t);
},m.isEmpty=function(n){return null==n?!0:k(n)&&(m.isArray(n)||m.isString(n)||m.isArguments(n))?0===n.length:0===m.keys(n).length;
},m.isElement=function(n){return !(!n||1!==n.nodeType);},m.isArray=h||function(n){return"[object Array]"===s.call(n);
},m.isObject=function(n){var t=typeof n;return"function"===t||"object"===t&&!!n;},m.each(["Arguments","Function","String","Number","Date","RegExp","Error"],function(n){m["is"+n]=function(t){return s.call(t)==="[object "+n+"]";
};}),m.isArguments(arguments)||(m.isArguments=function(n){return m.has(n,"callee");}),"function"!=typeof/./&&"object"!=typeof Int8Array&&(m.isFunction=function(n){return"function"==typeof n||!1;
}),m.isFinite=function(n){return isFinite(n)&&!isNaN(parseFloat(n));},m.isNaN=function(n){return m.isNumber(n)&&n!==+n;
},m.isBoolean=function(n){return n===!0||n===!1||"[object Boolean]"===s.call(n);},m.isNull=function(n){return null===n;
},m.isUndefined=function(n){return n===void 0;},m.has=function(n,t){return null!=n&&p.call(n,t);},m.noConflict=function(){return u._=i,this;
},m.identity=function(n){return n;},m.constant=function(n){return function(){return n;};},m.noop=function(){},m.property=w,m.propertyOf=function(n){return null==n?function(){}:function(t){return n[t];
};},m.matcher=m.matches=function(n){return n=m.extendOwn({},n),function(t){return m.isMatch(t,n);};},m.times=function(n,t,r){var e=Array(Math.max(0,n));
t=b(t,r,1);for(var u=0;n>u;u++){e[u]=t(u);}return e;},m.random=function(n,t){return null==t&&(t=n,n=0),n+Math.floor(Math.random()*(t-n+1));
},m.now=Date.now||function(){return(new Date).getTime();};var B={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},T=m.invert(B),R=function(n){var t=function(t){return n[t];
},r="(?:"+m.keys(n).join("|")+")",e=RegExp(r),u=RegExp(r,"g");return function(n){return n=null==n?"":""+n,e.test(n)?n.replace(u,t):n;
};};m.escape=R(B),m.unescape=R(T),m.result=function(n,t,r){var e=null==n?void 0:n[t];return e===void 0&&(e=r),m.isFunction(e)?e.call(n):e;
};var q=0;m.uniqueId=function(n){var t=++q+"";return n?n+t:t;},m.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};
var K=/(.)^/,z={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},D=/\\|'|\r|\n|\u2028|\u2029/g,L=function(n){return"\\"+z[n];
};m.template=function(n,t,r){!t&&r&&(t=r),t=m.defaults({},t,m.templateSettings);var e=RegExp([(t.escape||K).source,(t.interpolate||K).source,(t.evaluate||K).source].join("|")+"|$","g"),u=0,i="__p+='";
n.replace(e,function(t,r,e,o,a){return i+=n.slice(u,a).replace(D,L),u=a+t.length,r?i+="'+\n((__t=("+r+"))==null?'':_.escape(__t))+\n'":e?i+="'+\n((__t=("+e+"))==null?'':__t)+\n'":o&&(i+="';\n"+o+"\n__p+='"),t;
}),i+="';\n",t.variable||(i="with(obj||{}){\n"+i+"}\n"),i="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+i+"return __p;\n";
try{var o=new Function(t.variable||"obj","_",i);}catch(a){throw a.source=i,a;}var c=function(n){return o.call(this,n,m);
},f=t.variable||"obj";return c.source="function("+f+"){\n"+i+"}",c;},m.chain=function(n){var t=m(n);return t._chain=!0,t;
};var P=function(n,t){return n._chain?m(t).chain():t;};m.mixin=function(n){m.each(m.functions(n),function(t){var r=m[t]=n[t];
m.prototype[t]=function(){var n=[this._wrapped];return f.apply(n,arguments),P(this,r.apply(m,n));};});
},m.mixin(m),m.each(["pop","push","reverse","shift","sort","splice","unshift"],function(n){var t=o[n];
m.prototype[n]=function(){var r=this._wrapped;return t.apply(r,arguments),"shift"!==n&&"splice"!==n||0!==r.length||delete r[0],P(this,r);
};}),m.each(["concat","join","slice"],function(n){var t=o[n];m.prototype[n]=function(){return P(this,t.apply(this._wrapped,arguments));
};}),m.prototype.value=function(){return this._wrapped;},m.prototype.valueOf=m.prototype.toJSON=m.prototype.value,m.prototype.toString=function(){return""+this._wrapped;
},"function"==typeof define&&define.amd&&define("underscore",[],function(){return m;});}).call(this);
/*! jQuery UI - v1.9.2 - 2013-01-22
* http://jqueryui.com
* Includes: jquery.ui.core.js, jquery.ui.widget.js, jquery.ui.mouse.js, jquery.ui.position.js, jquery.ui.draggable.js, jquery.ui.droppable.js, jquery.ui.resizable.js, jquery.ui.selectable.js, jquery.ui.sortable.js, jquery.ui.accordion.js, jquery.ui.autocomplete.js, jquery.ui.button.js, jquery.ui.datepicker.js, jquery.ui.dialog.js, jquery.ui.menu.js, jquery.ui.progressbar.js, jquery.ui.slider.js, jquery.ui.spinner.js, jquery.ui.tabs.js, jquery.ui.effect.js, jquery.ui.effect-blind.js, jquery.ui.effect-bounce.js, jquery.ui.effect-clip.js, jquery.ui.effect-drop.js, jquery.ui.effect-explode.js, jquery.ui.effect-fade.js, jquery.ui.effect-fold.js, jquery.ui.effect-highlight.js, jquery.ui.effect-pulsate.js, jquery.ui.effect-scale.js, jquery.ui.effect-shake.js, jquery.ui.effect-slide.js, jquery.ui.effect-transfer.js
* Copyright (c) 2013 jQuery Foundation and other contributors Licensed MIT */
(function(e,t){function i(t,n){var r,i,o,u=t.nodeName.toLowerCase();
return"area"===u?(r=t.parentNode,i=r.name,!t.href||!i||r.nodeName.toLowerCase()!=="map"?!1:(o=e("img[usemap=#"+i+"]")[0],!!o&&s(o))):(/input|select|textarea|button|object/.test(u)?!t.disabled:"a"===u?t.href||n:n)&&s(t);
}function s(t){return e.expr.filters.visible(t)&&!e(t).parents().andSelf().filter(function(){return e.css(this,"visibility")==="hidden";
}).length;}var n=0,r=/^ui-id-\d+$/;e.ui=e.ui||{};if(e.ui.version){return;}e.extend(e.ui,{version:"1.9.2",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}}),e.fn.extend({_focus:e.fn.focus,focus:function(t,n){return typeof t=="number"?this.each(function(){var r=this;
setTimeout(function(){e(r).focus(),n&&n.call(r);},t);}):this._focus.apply(this,arguments);},scrollParent:function(){var t;
return e.ui.ie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?t=this.parents().filter(function(){return/(relative|absolute|fixed)/.test(e.css(this,"position"))&&/(auto|scroll)/.test(e.css(this,"overflow")+e.css(this,"overflow-y")+e.css(this,"overflow-x"));
}).eq(0):t=this.parents().filter(function(){return/(auto|scroll)/.test(e.css(this,"overflow")+e.css(this,"overflow-y")+e.css(this,"overflow-x"));
}).eq(0),/fixed/.test(this.css("position"))||!t.length?e(document):t;},zIndex:function(n){if(n!==t){return this.css("zIndex",n);
}if(this.length){var r=e(this[0]),i,s;while(r.length&&r[0]!==document){i=r.css("position");if(i==="absolute"||i==="relative"||i==="fixed"){s=parseInt(r.css("zIndex"),10);
if(!isNaN(s)&&s!==0){return s;}}r=r.parent();}}return 0;},uniqueId:function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++n);
});},removeUniqueId:function(){return this.each(function(){r.test(this.id)&&e(this).removeAttr("id");
});}}),e.extend(e.expr[":"],{data:e.expr.createPseudo?e.expr.createPseudo(function(t){return function(n){return !!e.data(n,t);
};}):function(t,n,r){return !!e.data(t,r[3]);},focusable:function(t){return i(t,!isNaN(e.attr(t,"tabindex")));
},tabbable:function(t){var n=e.attr(t,"tabindex"),r=isNaN(n);return(r||n>=0)&&i(t,!r);}}),e(function(){var t=document.body,n=t.appendChild(n=document.createElement("div"));
n.offsetHeight,e.extend(n.style,{minHeight:"100px",height:"auto",padding:0,borderWidth:0}),e.support.minHeight=n.offsetHeight===100,e.support.selectstart="onselectstart" in n,t.removeChild(n).style.display="none";
}),e("<a>").outerWidth(1).jquery||e.each(["Width","Height"],function(n,r){function u(t,n,r,s){return e.each(i,function(){n-=parseFloat(e.css(t,"padding"+this))||0,r&&(n-=parseFloat(e.css(t,"border"+this+"Width"))||0),s&&(n-=parseFloat(e.css(t,"margin"+this))||0);
}),n;}var i=r==="Width"?["Left","Right"]:["Top","Bottom"],s=r.toLowerCase(),o={innerWidth:e.fn.innerWidth,innerHeight:e.fn.innerHeight,outerWidth:e.fn.outerWidth,outerHeight:e.fn.outerHeight};
e.fn["inner"+r]=function(n){return n===t?o["inner"+r].call(this):this.each(function(){e(this).css(s,u(this,n)+"px");
});},e.fn["outer"+r]=function(t,n){return typeof t!="number"?o["outer"+r].call(this,t):this.each(function(){e(this).css(s,u(this,t,!0,n)+"px");
});};}),e("<a>").data("a-b","a").removeData("a-b").data("a-b")&&(e.fn.removeData=function(t){return function(n){return arguments.length?t.call(this,e.camelCase(n)):t.call(this);
};}(e.fn.removeData)),function(){var t=/msie ([\w.]+)/.exec(navigator.userAgent.toLowerCase())||[];e.ui.ie=t.length?!0:!1,e.ui.ie6=parseFloat(t[1],10)===6;
}(),e.fn.extend({disableSelection:function(){return this.bind((e.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(e){e.preventDefault();
});},enableSelection:function(){return this.unbind(".ui-disableSelection");}}),e.extend(e.ui,{plugin:{add:function(t,n,r){var i,s=e.ui[t].prototype;
for(i in r){s.plugins[i]=s.plugins[i]||[],s.plugins[i].push([n,r[i]]);}},call:function(e,t,n){var r,i=e.plugins[t];
if(!i||!e.element[0].parentNode||e.element[0].parentNode.nodeType===11){return;}for(r=0;r<i.length;r++){e.options[i[r][0]]&&i[r][1].apply(e.element,n);
}}},contains:e.contains,hasScroll:function(t,n){if(e(t).css("overflow")==="hidden"){return !1;}var r=n&&n==="left"?"scrollLeft":"scrollTop",i=!1;
return t[r]>0?!0:(t[r]=1,i=t[r]>0,t[r]=0,i);},isOverAxis:function(e,t,n){return e>t&&e<t+n;},isOver:function(t,n,r,i,s,o){return e.ui.isOverAxis(t,r,s)&&e.ui.isOverAxis(n,i,o);
}});})(jQuery);(function(e,t){var n=0,r=Array.prototype.slice,i=e.cleanData;e.cleanData=function(t){for(var n=0,r;
(r=t[n])!=null;n++){try{e(r).triggerHandler("remove");}catch(s){}}i(t);},e.widget=function(t,n,r){var i,s,o,u,a=t.split(".")[0];
t=t.split(".")[1],i=a+"-"+t,r||(r=n,n=e.Widget),e.expr[":"][i.toLowerCase()]=function(t){return !!e.data(t,i);
},e[a]=e[a]||{},s=e[a][t],o=e[a][t]=function(e,t){if(!this._createWidget){return new o(e,t);}arguments.length&&this._createWidget(e,t);
},e.extend(o,s,{version:r.version,_proto:e.extend({},r),_childConstructors:[]}),u=new n,u.options=e.widget.extend({},u.options),e.each(r,function(t,i){e.isFunction(i)&&(r[t]=function(){var e=function(){return n.prototype[t].apply(this,arguments);
},r=function(e){return n.prototype[t].apply(this,e);};return function(){var t=this._super,n=this._superApply,s;
return this._super=e,this._superApply=r,s=i.apply(this,arguments),this._super=t,this._superApply=n,s;
};}());}),o.prototype=e.widget.extend(u,{widgetEventPrefix:s?u.widgetEventPrefix:t},r,{constructor:o,namespace:a,widgetName:t,widgetBaseClass:i,widgetFullName:i}),s?(e.each(s._childConstructors,function(t,n){var r=n.prototype;
e.widget(r.namespace+"."+r.widgetName,o,n._proto);}),delete s._childConstructors):n._childConstructors.push(o),e.widget.bridge(t,o);
},e.widget.extend=function(n){var i=r.call(arguments,1),s=0,o=i.length,u,a;for(;s<o;s++){for(u in i[s]){a=i[s][u],i[s].hasOwnProperty(u)&&a!==t&&(e.isPlainObject(a)?n[u]=e.isPlainObject(n[u])?e.widget.extend({},n[u],a):e.widget.extend({},a):n[u]=a);
}}return n;},e.widget.bridge=function(n,i){var s=i.prototype.widgetFullName||n;e.fn[n]=function(o){var u=typeof o=="string",a=r.call(arguments,1),f=this;
return o=!u&&a.length?e.widget.extend.apply(null,[o].concat(a)):o,u?this.each(function(){var r,i=e.data(this,s);
if(!i){return e.error("cannot call methods on "+n+" prior to initialization; attempted to call method '"+o+"'");
}if(!e.isFunction(i[o])||o.charAt(0)==="_"){return e.error("no such method '"+o+"' for "+n+" widget instance");
}r=i[o].apply(i,a);if(r!==i&&r!==t){return f=r&&r.jquery?f.pushStack(r.get()):r,!1;}}):this.each(function(){var t=e.data(this,s);
t?t.option(o||{})._init():e.data(this,s,new i(o,this));}),f;};},e.Widget=function(){},e.Widget._childConstructors=[],e.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(t,r){r=e(r||this.defaultElement||this)[0],this.element=e(r),this.uuid=n++,this.eventNamespace="."+this.widgetName+this.uuid,this.options=e.widget.extend({},this.options,this._getCreateOptions(),t),this.bindings=e(),this.hoverable=e(),this.focusable=e(),r!==this&&(e.data(r,this.widgetName,this),e.data(r,this.widgetFullName,this),this._on(!0,this.element,{remove:function(e){e.target===r&&this.destroy();
}}),this.document=e(r.style?r.ownerDocument:r.document||r),this.window=e(this.document[0].defaultView||this.document[0].parentWindow)),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init();
},_getCreateOptions:e.noop,_getCreateEventData:e.noop,_create:e.noop,_init:e.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetName).removeData(this.widgetFullName).removeData(e.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus");
},_destroy:e.noop,widget:function(){return this.element;},option:function(n,r){var i=n,s,o,u;if(arguments.length===0){return e.widget.extend({},this.options);
}if(typeof n=="string"){i={},s=n.split("."),n=s.shift();if(s.length){o=i[n]=e.widget.extend({},this.options[n]);
for(u=0;u<s.length-1;u++){o[s[u]]=o[s[u]]||{},o=o[s[u]];}n=s.pop();if(r===t){return o[n]===t?null:o[n];
}o[n]=r;}else{if(r===t){return this.options[n]===t?null:this.options[n];}i[n]=r;}}return this._setOptions(i),this;
},_setOptions:function(e){var t;for(t in e){this._setOption(t,e[t]);}return this;},_setOption:function(e,t){return this.options[e]=t,e==="disabled"&&(this.widget().toggleClass(this.widgetFullName+"-disabled ui-state-disabled",!!t).attr("aria-disabled",t),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")),this;
},enable:function(){return this._setOption("disabled",!1);},disable:function(){return this._setOption("disabled",!0);
},_on:function(t,n,r){var i,s=this;typeof t!="boolean"&&(r=n,n=t,t=!1),r?(n=i=e(n),this.bindings=this.bindings.add(n)):(r=n,n=this.element,i=this.widget()),e.each(r,function(r,o){function u(){if(!t&&(s.options.disabled===!0||e(this).hasClass("ui-state-disabled"))){return;
}return(typeof o=="string"?s[o]:o).apply(s,arguments);}typeof o!="string"&&(u.guid=o.guid=o.guid||u.guid||e.guid++);
var a=r.match(/^(\w+)\s*(.*)$/),f=a[1]+s.eventNamespace,l=a[2];l?i.delegate(l,f,u):n.bind(f,u);});},_off:function(e,t){t=(t||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,e.unbind(t).undelegate(t);
},_delay:function(e,t){function n(){return(typeof e=="string"?r[e]:e).apply(r,arguments);}var r=this;
return setTimeout(n,t||0);},_hoverable:function(t){this.hoverable=this.hoverable.add(t),this._on(t,{mouseenter:function(t){e(t.currentTarget).addClass("ui-state-hover");
},mouseleave:function(t){e(t.currentTarget).removeClass("ui-state-hover");}});},_focusable:function(t){this.focusable=this.focusable.add(t),this._on(t,{focusin:function(t){e(t.currentTarget).addClass("ui-state-focus");
},focusout:function(t){e(t.currentTarget).removeClass("ui-state-focus");}});},_trigger:function(t,n,r){var i,s,o=this.options[t];
r=r||{},n=e.Event(n),n.type=(t===this.widgetEventPrefix?t:this.widgetEventPrefix+t).toLowerCase(),n.target=this.element[0],s=n.originalEvent;
if(s){for(i in s){i in n||(n[i]=s[i]);}}return this.element.trigger(n,r),!(e.isFunction(o)&&o.apply(this.element[0],[n].concat(r))===!1||n.isDefaultPrevented());
}},e.each({show:"fadeIn",hide:"fadeOut"},function(t,n){e.Widget.prototype["_"+t]=function(r,i,s){typeof i=="string"&&(i={effect:i});
var o,u=i?i===!0||typeof i=="number"?n:i.effect||n:t;i=i||{},typeof i=="number"&&(i={duration:i}),o=!e.isEmptyObject(i),i.complete=s,i.delay&&r.delay(i.delay),o&&e.effects&&(e.effects.effect[u]||e.uiBackCompat!==!1&&e.effects[u])?r[t](i):u!==t&&r[u]?r[u](i.duration,i.easing,s):r.queue(function(n){e(this)[t](),s&&s.call(r[0]),n();
});};}),e.uiBackCompat!==!1&&(e.Widget.prototype._getCreateOptions=function(){return e.metadata&&e.metadata.get(this.element[0])[this.widgetName];
});})(jQuery);(function(e,t){var n=!1;e(document).mouseup(function(e){n=!1;}),e.widget("ui.mouse",{version:"1.9.2",options:{cancel:"input,textarea,button,select,option",distance:1,delay:0},_mouseInit:function(){var t=this;
this.element.bind("mousedown."+this.widgetName,function(e){return t._mouseDown(e);}).bind("click."+this.widgetName,function(n){if(!0===e.data(n.target,t.widgetName+".preventClickEvent")){return e.removeData(n.target,t.widgetName+".preventClickEvent"),n.stopImmediatePropagation(),!1;
}}),this.started=!1;},_mouseDestroy:function(){this.element.unbind("."+this.widgetName),this._mouseMoveDelegate&&e(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate);
},_mouseDown:function(t){if(n){return;}this._mouseStarted&&this._mouseUp(t),this._mouseDownEvent=t;var r=this,i=t.which===1,s=typeof this.options.cancel=="string"&&t.target.nodeName?e(t.target).closest(this.options.cancel).length:!1;
if(!i||s||!this._mouseCapture(t)){return !0;}this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){r.mouseDelayMet=!0;
},this.options.delay));if(this._mouseDistanceMet(t)&&this._mouseDelayMet(t)){this._mouseStarted=this._mouseStart(t)!==!1;
if(!this._mouseStarted){return t.preventDefault(),!0;}}return !0===e.data(t.target,this.widgetName+".preventClickEvent")&&e.removeData(t.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(e){return r._mouseMove(e);
},this._mouseUpDelegate=function(e){return r._mouseUp(e);},e(document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),t.preventDefault(),n=!0,!0;
},_mouseMove:function(t){return !e.ui.ie||document.documentMode>=9||!!t.button?this._mouseStarted?(this._mouseDrag(t),t.preventDefault()):(this._mouseDistanceMet(t)&&this._mouseDelayMet(t)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,t)!==!1,this._mouseStarted?this._mouseDrag(t):this._mouseUp(t)),!this._mouseStarted):this._mouseUp(t);
},_mouseUp:function(t){return e(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,t.target===this._mouseDownEvent.target&&e.data(t.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(t)),!1;
},_mouseDistanceMet:function(e){return Math.max(Math.abs(this._mouseDownEvent.pageX-e.pageX),Math.abs(this._mouseDownEvent.pageY-e.pageY))>=this.options.distance;
},_mouseDelayMet:function(e){return this.mouseDelayMet;},_mouseStart:function(e){},_mouseDrag:function(e){},_mouseStop:function(e){},_mouseCapture:function(e){return !0;
}});})(jQuery);(function(e,t){function h(e,t,n){return[parseInt(e[0],10)*(l.test(e[0])?t/100:1),parseInt(e[1],10)*(l.test(e[1])?n/100:1)];
}function p(t,n){return parseInt(e.css(t,n),10)||0;}e.ui=e.ui||{};var n,r=Math.max,i=Math.abs,s=Math.round,o=/left|center|right/,u=/top|center|bottom/,a=/[\+\-]\d+%?/,f=/^\w+/,l=/%$/,c=e.fn.position;
e.position={scrollbarWidth:function(){if(n!==t){return n;}var r,i,s=e("<div style='display:block;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>"),o=s.children()[0];
return e("body").append(s),r=o.offsetWidth,s.css("overflow","scroll"),i=o.offsetWidth,r===i&&(i=s[0].clientWidth),s.remove(),n=r-i;
},getScrollInfo:function(t){var n=t.isWindow?"":t.element.css("overflow-x"),r=t.isWindow?"":t.element.css("overflow-y"),i=n==="scroll"||n==="auto"&&t.width<t.element[0].scrollWidth,s=r==="scroll"||r==="auto"&&t.height<t.element[0].scrollHeight;
return{width:i?e.position.scrollbarWidth():0,height:s?e.position.scrollbarWidth():0};},getWithinInfo:function(t){var n=e(t||window),r=e.isWindow(n[0]);
return{element:n,isWindow:r,offset:n.offset()||{left:0,top:0},scrollLeft:n.scrollLeft(),scrollTop:n.scrollTop(),width:r?n.width():n.outerWidth(),height:r?n.height():n.outerHeight()};
}},e.fn.position=function(t){if(!t||!t.of){return c.apply(this,arguments);}t=e.extend({},t);var n,l,d,v,m,g=e(t.of),y=e.position.getWithinInfo(t.within),b=e.position.getScrollInfo(y),w=g[0],E=(t.collision||"flip").split(" "),S={};
return w.nodeType===9?(l=g.width(),d=g.height(),v={top:0,left:0}):e.isWindow(w)?(l=g.width(),d=g.height(),v={top:g.scrollTop(),left:g.scrollLeft()}):w.preventDefault?(t.at="left top",l=d=0,v={top:w.pageY,left:w.pageX}):(l=g.outerWidth(),d=g.outerHeight(),v=g.offset()),m=e.extend({},v),e.each(["my","at"],function(){var e=(t[this]||"").split(" "),n,r;
e.length===1&&(e=o.test(e[0])?e.concat(["center"]):u.test(e[0])?["center"].concat(e):["center","center"]),e[0]=o.test(e[0])?e[0]:"center",e[1]=u.test(e[1])?e[1]:"center",n=a.exec(e[0]),r=a.exec(e[1]),S[this]=[n?n[0]:0,r?r[0]:0],t[this]=[f.exec(e[0])[0],f.exec(e[1])[0]];
}),E.length===1&&(E[1]=E[0]),t.at[0]==="right"?m.left+=l:t.at[0]==="center"&&(m.left+=l/2),t.at[1]==="bottom"?m.top+=d:t.at[1]==="center"&&(m.top+=d/2),n=h(S.at,l,d),m.left+=n[0],m.top+=n[1],this.each(function(){var o,u,a=e(this),f=a.outerWidth(),c=a.outerHeight(),w=p(this,"marginLeft"),x=p(this,"marginTop"),T=f+w+p(this,"marginRight")+b.width,N=c+x+p(this,"marginBottom")+b.height,C=e.extend({},m),k=h(S.my,a.outerWidth(),a.outerHeight());
t.my[0]==="right"?C.left-=f:t.my[0]==="center"&&(C.left-=f/2),t.my[1]==="bottom"?C.top-=c:t.my[1]==="center"&&(C.top-=c/2),C.left+=k[0],C.top+=k[1],e.support.offsetFractions||(C.left=s(C.left),C.top=s(C.top)),o={marginLeft:w,marginTop:x},e.each(["left","top"],function(r,i){e.ui.position[E[r]]&&e.ui.position[E[r]][i](C,{targetWidth:l,targetHeight:d,elemWidth:f,elemHeight:c,collisionPosition:o,collisionWidth:T,collisionHeight:N,offset:[n[0]+k[0],n[1]+k[1]],my:t.my,at:t.at,within:y,elem:a});
}),e.fn.bgiframe&&a.bgiframe(),t.using&&(u=function(e){var n=v.left-C.left,s=n+l-f,o=v.top-C.top,u=o+d-c,h={target:{element:g,left:v.left,top:v.top,width:l,height:d},element:{element:a,left:C.left,top:C.top,width:f,height:c},horizontal:s<0?"left":n>0?"right":"center",vertical:u<0?"top":o>0?"bottom":"middle"};
l<f&&i(n+s)<l&&(h.horizontal="center"),d<c&&i(o+u)<d&&(h.vertical="middle"),r(i(n),i(s))>r(i(o),i(u))?h.important="horizontal":h.important="vertical",t.using.call(this,e,h);
}),a.offset(e.extend(C,{using:u}));});},e.ui.position={fit:{left:function(e,t){var n=t.within,i=n.isWindow?n.scrollLeft:n.offset.left,s=n.width,o=e.left-t.collisionPosition.marginLeft,u=i-o,a=o+t.collisionWidth-s-i,f;
t.collisionWidth>s?u>0&&a<=0?(f=e.left+u+t.collisionWidth-s-i,e.left+=u-f):a>0&&u<=0?e.left=i:u>a?e.left=i+s-t.collisionWidth:e.left=i:u>0?e.left+=u:a>0?e.left-=a:e.left=r(e.left-o,e.left);
},top:function(e,t){var n=t.within,i=n.isWindow?n.scrollTop:n.offset.top,s=t.within.height,o=e.top-t.collisionPosition.marginTop,u=i-o,a=o+t.collisionHeight-s-i,f;
t.collisionHeight>s?u>0&&a<=0?(f=e.top+u+t.collisionHeight-s-i,e.top+=u-f):a>0&&u<=0?e.top=i:u>a?e.top=i+s-t.collisionHeight:e.top=i:u>0?e.top+=u:a>0?e.top-=a:e.top=r(e.top-o,e.top);
}},flip:{left:function(e,t){var n=t.within,r=n.offset.left+n.scrollLeft,s=n.width,o=n.isWindow?n.scrollLeft:n.offset.left,u=e.left-t.collisionPosition.marginLeft,a=u-o,f=u+t.collisionWidth-s-o,l=t.my[0]==="left"?-t.elemWidth:t.my[0]==="right"?t.elemWidth:0,c=t.at[0]==="left"?t.targetWidth:t.at[0]==="right"?-t.targetWidth:0,h=-2*t.offset[0],p,d;
if(a<0){p=e.left+l+c+h+t.collisionWidth-s-r;if(p<0||p<i(a)){e.left+=l+c+h;}}else{if(f>0){d=e.left-t.collisionPosition.marginLeft+l+c+h-o;
if(d>0||i(d)<f){e.left+=l+c+h;}}}},top:function(e,t){var n=t.within,r=n.offset.top+n.scrollTop,s=n.height,o=n.isWindow?n.scrollTop:n.offset.top,u=e.top-t.collisionPosition.marginTop,a=u-o,f=u+t.collisionHeight-s-o,l=t.my[1]==="top",c=l?-t.elemHeight:t.my[1]==="bottom"?t.elemHeight:0,h=t.at[1]==="top"?t.targetHeight:t.at[1]==="bottom"?-t.targetHeight:0,p=-2*t.offset[1],d,v;
a<0?(v=e.top+c+h+p+t.collisionHeight-s-r,e.top+c+h+p>a&&(v<0||v<i(a))&&(e.top+=c+h+p)):f>0&&(d=e.top-t.collisionPosition.marginTop+c+h+p-o,e.top+c+h+p>f&&(d>0||i(d)<f)&&(e.top+=c+h+p));
}},flipfit:{left:function(){e.ui.position.flip.left.apply(this,arguments),e.ui.position.fit.left.apply(this,arguments);
},top:function(){e.ui.position.flip.top.apply(this,arguments),e.ui.position.fit.top.apply(this,arguments);
}}},function(){var t,n,r,i,s,o=document.getElementsByTagName("body")[0],u=document.createElement("div");
t=document.createElement(o?"div":"body"),r={visibility:"hidden",width:0,height:0,border:0,margin:0,background:"none"},o&&e.extend(r,{position:"absolute",left:"-1000px",top:"-1000px"});
for(s in r){t.style[s]=r[s];}t.appendChild(u),n=o||document.documentElement,n.insertBefore(t,n.firstChild),u.style.cssText="position: absolute; left: 10.7432222px;",i=e(u).offset().left,e.support.offsetFractions=i>10&&i<11,t.innerHTML="",n.removeChild(t);
}(),e.uiBackCompat!==!1&&function(e){var n=e.fn.position;e.fn.position=function(r){if(!r||!r.offset){return n.call(this,r);
}var i=r.offset.split(" "),s=r.at.split(" ");return i.length===1&&(i[1]=i[0]),/^\d/.test(i[0])&&(i[0]="+"+i[0]),/^\d/.test(i[1])&&(i[1]="+"+i[1]),s.length===1&&(/left|center|right/.test(s[0])?s[1]="center":(s[1]=s[0],s[0]="center")),n.call(this,e.extend(r,{at:s[0]+i[0]+" "+s[1]+i[1],offset:t}));
};}(jQuery);})(jQuery);(function(e,t){e.widget("ui.draggable",e.ui.mouse,{version:"1.9.2",widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1},_create:function(){this.options.helper=="original"&&!/^(?:r|a|f)/.test(this.element.css("position"))&&(this.element[0].style.position="relative"),this.options.addClasses&&this.element.addClass("ui-draggable"),this.options.disabled&&this.element.addClass("ui-draggable-disabled"),this._mouseInit();
},_destroy:function(){this.element.removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled"),this._mouseDestroy();
},_mouseCapture:function(t){var n=this.options;return this.helper||n.disabled||e(t.target).is(".ui-resizable-handle")?!1:(this.handle=this._getHandle(t),this.handle?(e(n.iframeFix===!0?"iframe":n.iframeFix).each(function(){e('<div class="ui-draggable-iframeFix" style="background: #fff;"></div>').css({width:this.offsetWidth+"px",height:this.offsetHeight+"px",position:"absolute",opacity:"0.001",zIndex:1000}).css(e(this).offset()).appendTo("body");
}),!0):!1);},_mouseStart:function(t){var n=this.options;return this.helper=this._createHelper(t),this.helper.addClass("ui-draggable-dragging"),this._cacheHelperProportions(),e.ui.ddmanager&&(e.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(),this.offset=this.positionAbs=this.element.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},e.extend(this.offset,{click:{left:t.pageX-this.offset.left,top:t.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.originalPosition=this.position=this._generatePosition(t),this.originalPageX=t.pageX,this.originalPageY=t.pageY,n.cursorAt&&this._adjustOffsetFromHelper(n.cursorAt),n.containment&&this._setContainment(),this._trigger("start",t)===!1?(this._clear(),!1):(this._cacheHelperProportions(),e.ui.ddmanager&&!n.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t),this._mouseDrag(t,!0),e.ui.ddmanager&&e.ui.ddmanager.dragStart(this,t),!0);
},_mouseDrag:function(t,n){this.position=this._generatePosition(t),this.positionAbs=this._convertPositionTo("absolute");
if(!n){var r=this._uiHash();if(this._trigger("drag",t,r)===!1){return this._mouseUp({}),!1;}this.position=r.position;
}if(!this.options.axis||this.options.axis!="y"){this.helper[0].style.left=this.position.left+"px";}if(!this.options.axis||this.options.axis!="x"){this.helper[0].style.top=this.position.top+"px";
}return e.ui.ddmanager&&e.ui.ddmanager.drag(this,t),!1;},_mouseStop:function(t){var n=!1;e.ui.ddmanager&&!this.options.dropBehaviour&&(n=e.ui.ddmanager.drop(this,t)),this.dropped&&(n=this.dropped,this.dropped=!1);
var r=this.element[0],i=!1;while(r&&(r=r.parentNode)){r==document&&(i=!0);}if(!i&&this.options.helper==="original"){return !1;
}if(this.options.revert=="invalid"&&!n||this.options.revert=="valid"&&n||this.options.revert===!0||e.isFunction(this.options.revert)&&this.options.revert.call(this.element,n)){var s=this;
e(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){s._trigger("stop",t)!==!1&&s._clear();
});}else{this._trigger("stop",t)!==!1&&this._clear();}return !1;},_mouseUp:function(t){return e("div.ui-draggable-iframeFix").each(function(){this.parentNode.removeChild(this);
}),e.ui.ddmanager&&e.ui.ddmanager.dragStop(this,t),e.ui.mouse.prototype._mouseUp.call(this,t);},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp({}):this._clear(),this;
},_getHandle:function(t){var n=!this.options.handle||!e(this.options.handle,this.element).length?!0:!1;
return e(this.options.handle,this.element).find("*").andSelf().each(function(){this==t.target&&(n=!0);
}),n;},_createHelper:function(t){var n=this.options,r=e.isFunction(n.helper)?e(n.helper.apply(this.element[0],[t])):n.helper=="clone"?this.element.clone().removeAttr("id"):this.element;
return r.parents("body").length||r.appendTo(n.appendTo=="parent"?this.element[0].parentNode:n.appendTo),r[0]!=this.element[0]&&!/(fixed|absolute)/.test(r.css("position"))&&r.css("position","absolute"),r;
},_adjustOffsetFromHelper:function(t){typeof t=="string"&&(t=t.split(" ")),e.isArray(t)&&(t={left:+t[0],top:+t[1]||0}),"left" in t&&(this.offset.click.left=t.left+this.margins.left),"right" in t&&(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left),"top" in t&&(this.offset.click.top=t.top+this.margins.top),"bottom" in t&&(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top);
},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var t=this.offsetParent.offset();
this.cssPosition=="absolute"&&this.scrollParent[0]!=document&&e.contains(this.scrollParent[0],this.offsetParent[0])&&(t.left+=this.scrollParent.scrollLeft(),t.top+=this.scrollParent.scrollTop());
if(this.offsetParent[0]==document.body||this.offsetParent[0].tagName&&this.offsetParent[0].tagName.toLowerCase()=="html"&&e.ui.ie){t={top:0,left:0};
}return{top:t.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:t.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)};
},_getRelativeOffset:function(){if(this.cssPosition=="relative"){var e=this.element.position();return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:e.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()};
}return{top:0,left:0};},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0};
},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()};
},_setContainment:function(){var t=this.options;t.containment=="parent"&&(t.containment=this.helper[0].parentNode);
if(t.containment=="document"||t.containment=="window"){this.containment=[t.containment=="document"?0:e(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,t.containment=="document"?0:e(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,(t.containment=="document"?0:e(window).scrollLeft())+e(t.containment=="document"?document:window).width()-this.helperProportions.width-this.margins.left,(t.containment=="document"?0:e(window).scrollTop())+(e(t.containment=="document"?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top];
}if(!/^(document|window|parent)$/.test(t.containment)&&t.containment.constructor!=Array){var n=e(t.containment),r=n[0];
if(!r){return;}var i=n.offset(),s=e(r).css("overflow")!="hidden";this.containment=[(parseInt(e(r).css("borderLeftWidth"),10)||0)+(parseInt(e(r).css("paddingLeft"),10)||0),(parseInt(e(r).css("borderTopWidth"),10)||0)+(parseInt(e(r).css("paddingTop"),10)||0),(s?Math.max(r.scrollWidth,r.offsetWidth):r.offsetWidth)-(parseInt(e(r).css("borderLeftWidth"),10)||0)-(parseInt(e(r).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(s?Math.max(r.scrollHeight,r.offsetHeight):r.offsetHeight)-(parseInt(e(r).css("borderTopWidth"),10)||0)-(parseInt(e(r).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relative_container=n;
}else{t.containment.constructor==Array&&(this.containment=t.containment);}},_convertPositionTo:function(t,n){n||(n=this.position);
var r=t=="absolute"?1:-1,i=this.options,s=this.cssPosition!="absolute"||this.scrollParent[0]!=document&&!!e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,o=/(html|body)/i.test(s[0].tagName);
return{top:n.top+this.offset.relative.top*r+this.offset.parent.top*r-(this.cssPosition=="fixed"?-this.scrollParent.scrollTop():o?0:s.scrollTop())*r,left:n.left+this.offset.relative.left*r+this.offset.parent.left*r-(this.cssPosition=="fixed"?-this.scrollParent.scrollLeft():o?0:s.scrollLeft())*r};
},_generatePosition:function(t){var n=this.options,r=this.cssPosition!="absolute"||this.scrollParent[0]!=document&&!!e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,i=/(html|body)/i.test(r[0].tagName),s=t.pageX,o=t.pageY;
if(this.originalPosition){var u;if(this.containment){if(this.relative_container){var a=this.relative_container.offset();
u=[this.containment[0]+a.left,this.containment[1]+a.top,this.containment[2]+a.left,this.containment[3]+a.top];
}else{u=this.containment;}t.pageX-this.offset.click.left<u[0]&&(s=u[0]+this.offset.click.left),t.pageY-this.offset.click.top<u[1]&&(o=u[1]+this.offset.click.top),t.pageX-this.offset.click.left>u[2]&&(s=u[2]+this.offset.click.left),t.pageY-this.offset.click.top>u[3]&&(o=u[3]+this.offset.click.top);
}if(n.grid){var f=n.grid[1]?this.originalPageY+Math.round((o-this.originalPageY)/n.grid[1])*n.grid[1]:this.originalPageY;
o=u?f-this.offset.click.top<u[1]||f-this.offset.click.top>u[3]?f-this.offset.click.top<u[1]?f+n.grid[1]:f-n.grid[1]:f:f;
var l=n.grid[0]?this.originalPageX+Math.round((s-this.originalPageX)/n.grid[0])*n.grid[0]:this.originalPageX;
s=u?l-this.offset.click.left<u[0]||l-this.offset.click.left>u[2]?l-this.offset.click.left<u[0]?l+n.grid[0]:l-n.grid[0]:l:l;
}}return{top:o-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+(this.cssPosition=="fixed"?-this.scrollParent.scrollTop():i?0:r.scrollTop()),left:s-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+(this.cssPosition=="fixed"?-this.scrollParent.scrollLeft():i?0:r.scrollLeft())};
},_clear:function(){this.helper.removeClass("ui-draggable-dragging"),this.helper[0]!=this.element[0]&&!this.cancelHelperRemoval&&this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1;
},_trigger:function(t,n,r){return r=r||this._uiHash(),e.ui.plugin.call(this,t,[n,r]),t=="drag"&&(this.positionAbs=this._convertPositionTo("absolute")),e.Widget.prototype._trigger.call(this,t,n,r);
},plugins:{},_uiHash:function(e){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs};
}}),e.ui.plugin.add("draggable","connectToSortable",{start:function(t,n){var r=e(this).data("draggable"),i=r.options,s=e.extend({},n,{item:r.element});
r.sortables=[],e(i.connectToSortable).each(function(){var n=e.data(this,"sortable");n&&!n.options.disabled&&(r.sortables.push({instance:n,shouldRevert:n.options.revert}),n.refreshPositions(),n._trigger("activate",t,s));
});},stop:function(t,n){var r=e(this).data("draggable"),i=e.extend({},n,{item:r.element});e.each(r.sortables,function(){this.instance.isOver?(this.instance.isOver=0,r.cancelHelperRemoval=!0,this.instance.cancelHelperRemoval=!1,this.shouldRevert&&(this.instance.options.revert=!0),this.instance._mouseStop(t),this.instance.options.helper=this.instance.options._helper,r.options.helper=="original"&&this.instance.currentItem.css({top:"auto",left:"auto"})):(this.instance.cancelHelperRemoval=!1,this.instance._trigger("deactivate",t,i));
});},drag:function(t,n){var r=e(this).data("draggable"),i=this,s=function(t){var n=this.offset.click.top,r=this.offset.click.left,i=this.positionAbs.top,s=this.positionAbs.left,o=t.height,u=t.width,a=t.top,f=t.left;
return e.ui.isOver(i+n,s+r,a,f,o,u);};e.each(r.sortables,function(s){var o=!1,u=this;this.instance.positionAbs=r.positionAbs,this.instance.helperProportions=r.helperProportions,this.instance.offset.click=r.offset.click,this.instance._intersectsWith(this.instance.containerCache)&&(o=!0,e.each(r.sortables,function(){return this.instance.positionAbs=r.positionAbs,this.instance.helperProportions=r.helperProportions,this.instance.offset.click=r.offset.click,this!=u&&this.instance._intersectsWith(this.instance.containerCache)&&e.ui.contains(u.instance.element[0],this.instance.element[0])&&(o=!1),o;
})),o?(this.instance.isOver||(this.instance.isOver=1,this.instance.currentItem=e(i).clone().removeAttr("id").appendTo(this.instance.element).data("sortable-item",!0),this.instance.options._helper=this.instance.options.helper,this.instance.options.helper=function(){return n.helper[0];
},t.target=this.instance.currentItem[0],this.instance._mouseCapture(t,!0),this.instance._mouseStart(t,!0,!0),this.instance.offset.click.top=r.offset.click.top,this.instance.offset.click.left=r.offset.click.left,this.instance.offset.parent.left-=r.offset.parent.left-this.instance.offset.parent.left,this.instance.offset.parent.top-=r.offset.parent.top-this.instance.offset.parent.top,r._trigger("toSortable",t),r.dropped=this.instance.element,r.currentItem=r.element,this.instance.fromOutside=r),this.instance.currentItem&&this.instance._mouseDrag(t)):this.instance.isOver&&(this.instance.isOver=0,this.instance.cancelHelperRemoval=!0,this.instance.options.revert=!1,this.instance._trigger("out",t,this.instance._uiHash(this.instance)),this.instance._mouseStop(t,!0),this.instance.options.helper=this.instance.options._helper,this.instance.currentItem.remove(),this.instance.placeholder&&this.instance.placeholder.remove(),r._trigger("fromSortable",t),r.dropped=!1);
});}}),e.ui.plugin.add("draggable","cursor",{start:function(t,n){var r=e("body"),i=e(this).data("draggable").options;
r.css("cursor")&&(i._cursor=r.css("cursor")),r.css("cursor",i.cursor);},stop:function(t,n){var r=e(this).data("draggable").options;
r._cursor&&e("body").css("cursor",r._cursor);}}),e.ui.plugin.add("draggable","opacity",{start:function(t,n){var r=e(n.helper),i=e(this).data("draggable").options;
r.css("opacity")&&(i._opacity=r.css("opacity")),r.css("opacity",i.opacity);},stop:function(t,n){var r=e(this).data("draggable").options;
r._opacity&&e(n.helper).css("opacity",r._opacity);}}),e.ui.plugin.add("draggable","scroll",{start:function(t,n){var r=e(this).data("draggable");
r.scrollParent[0]!=document&&r.scrollParent[0].tagName!="HTML"&&(r.overflowOffset=r.scrollParent.offset());
},drag:function(t,n){var r=e(this).data("draggable"),i=r.options,s=!1;if(r.scrollParent[0]!=document&&r.scrollParent[0].tagName!="HTML"){if(!i.axis||i.axis!="x"){r.overflowOffset.top+r.scrollParent[0].offsetHeight-t.pageY<i.scrollSensitivity?r.scrollParent[0].scrollTop=s=r.scrollParent[0].scrollTop+i.scrollSpeed:t.pageY-r.overflowOffset.top<i.scrollSensitivity&&(r.scrollParent[0].scrollTop=s=r.scrollParent[0].scrollTop-i.scrollSpeed);
}if(!i.axis||i.axis!="y"){r.overflowOffset.left+r.scrollParent[0].offsetWidth-t.pageX<i.scrollSensitivity?r.scrollParent[0].scrollLeft=s=r.scrollParent[0].scrollLeft+i.scrollSpeed:t.pageX-r.overflowOffset.left<i.scrollSensitivity&&(r.scrollParent[0].scrollLeft=s=r.scrollParent[0].scrollLeft-i.scrollSpeed);
}}else{if(!i.axis||i.axis!="x"){t.pageY-e(document).scrollTop()<i.scrollSensitivity?s=e(document).scrollTop(e(document).scrollTop()-i.scrollSpeed):e(window).height()-(t.pageY-e(document).scrollTop())<i.scrollSensitivity&&(s=e(document).scrollTop(e(document).scrollTop()+i.scrollSpeed));
}if(!i.axis||i.axis!="y"){t.pageX-e(document).scrollLeft()<i.scrollSensitivity?s=e(document).scrollLeft(e(document).scrollLeft()-i.scrollSpeed):e(window).width()-(t.pageX-e(document).scrollLeft())<i.scrollSensitivity&&(s=e(document).scrollLeft(e(document).scrollLeft()+i.scrollSpeed));
}}s!==!1&&e.ui.ddmanager&&!i.dropBehaviour&&e.ui.ddmanager.prepareOffsets(r,t);}}),e.ui.plugin.add("draggable","snap",{start:function(t,n){var r=e(this).data("draggable"),i=r.options;
r.snapElements=[],e(i.snap.constructor!=String?i.snap.items||":data(draggable)":i.snap).each(function(){var t=e(this),n=t.offset();
this!=r.element[0]&&r.snapElements.push({item:this,width:t.outerWidth(),height:t.outerHeight(),top:n.top,left:n.left});
});},drag:function(t,n){var r=e(this).data("draggable"),i=r.options,s=i.snapTolerance,o=n.offset.left,u=o+r.helperProportions.width,a=n.offset.top,f=a+r.helperProportions.height;
for(var l=r.snapElements.length-1;l>=0;l--){var c=r.snapElements[l].left,h=c+r.snapElements[l].width,p=r.snapElements[l].top,d=p+r.snapElements[l].height;
if(!(c-s<o&&o<h+s&&p-s<a&&a<d+s||c-s<o&&o<h+s&&p-s<f&&f<d+s||c-s<u&&u<h+s&&p-s<a&&a<d+s||c-s<u&&u<h+s&&p-s<f&&f<d+s)){r.snapElements[l].snapping&&r.options.snap.release&&r.options.snap.release.call(r.element,t,e.extend(r._uiHash(),{snapItem:r.snapElements[l].item})),r.snapElements[l].snapping=!1;
continue;}if(i.snapMode!="inner"){var v=Math.abs(p-f)<=s,m=Math.abs(d-a)<=s,g=Math.abs(c-u)<=s,y=Math.abs(h-o)<=s;
v&&(n.position.top=r._convertPositionTo("relative",{top:p-r.helperProportions.height,left:0}).top-r.margins.top),m&&(n.position.top=r._convertPositionTo("relative",{top:d,left:0}).top-r.margins.top),g&&(n.position.left=r._convertPositionTo("relative",{top:0,left:c-r.helperProportions.width}).left-r.margins.left),y&&(n.position.left=r._convertPositionTo("relative",{top:0,left:h}).left-r.margins.left);
}var b=v||m||g||y;if(i.snapMode!="outer"){var v=Math.abs(p-a)<=s,m=Math.abs(d-f)<=s,g=Math.abs(c-o)<=s,y=Math.abs(h-u)<=s;
v&&(n.position.top=r._convertPositionTo("relative",{top:p,left:0}).top-r.margins.top),m&&(n.position.top=r._convertPositionTo("relative",{top:d-r.helperProportions.height,left:0}).top-r.margins.top),g&&(n.position.left=r._convertPositionTo("relative",{top:0,left:c}).left-r.margins.left),y&&(n.position.left=r._convertPositionTo("relative",{top:0,left:h-r.helperProportions.width}).left-r.margins.left);
}!r.snapElements[l].snapping&&(v||m||g||y||b)&&r.options.snap.snap&&r.options.snap.snap.call(r.element,t,e.extend(r._uiHash(),{snapItem:r.snapElements[l].item})),r.snapElements[l].snapping=v||m||g||y||b;
}}}),e.ui.plugin.add("draggable","stack",{start:function(t,n){var r=e(this).data("draggable").options,i=e.makeArray(e(r.stack)).sort(function(t,n){return(parseInt(e(t).css("zIndex"),10)||0)-(parseInt(e(n).css("zIndex"),10)||0);
});if(!i.length){return;}var s=parseInt(i[0].style.zIndex)||0;e(i).each(function(e){this.style.zIndex=s+e;
}),this[0].style.zIndex=s+i.length;}}),e.ui.plugin.add("draggable","zIndex",{start:function(t,n){var r=e(n.helper),i=e(this).data("draggable").options;
r.css("zIndex")&&(i._zIndex=r.css("zIndex")),r.css("zIndex",i.zIndex);},stop:function(t,n){var r=e(this).data("draggable").options;
r._zIndex&&e(n.helper).css("zIndex",r._zIndex);}});})(jQuery);(function(e,t){e.widget("ui.droppable",{version:"1.9.2",widgetEventPrefix:"drop",options:{accept:"*",activeClass:!1,addClasses:!0,greedy:!1,hoverClass:!1,scope:"default",tolerance:"intersect"},_create:function(){var t=this.options,n=t.accept;
this.isover=0,this.isout=1,this.accept=e.isFunction(n)?n:function(e){return e.is(n);},this.proportions={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight},e.ui.ddmanager.droppables[t.scope]=e.ui.ddmanager.droppables[t.scope]||[],e.ui.ddmanager.droppables[t.scope].push(this),t.addClasses&&this.element.addClass("ui-droppable");
},_destroy:function(){var t=e.ui.ddmanager.droppables[this.options.scope];for(var n=0;n<t.length;n++){t[n]==this&&t.splice(n,1);
}this.element.removeClass("ui-droppable ui-droppable-disabled");},_setOption:function(t,n){t=="accept"&&(this.accept=e.isFunction(n)?n:function(e){return e.is(n);
}),e.Widget.prototype._setOption.apply(this,arguments);},_activate:function(t){var n=e.ui.ddmanager.current;
this.options.activeClass&&this.element.addClass(this.options.activeClass),n&&this._trigger("activate",t,this.ui(n));
},_deactivate:function(t){var n=e.ui.ddmanager.current;this.options.activeClass&&this.element.removeClass(this.options.activeClass),n&&this._trigger("deactivate",t,this.ui(n));
},_over:function(t){var n=e.ui.ddmanager.current;if(!n||(n.currentItem||n.element)[0]==this.element[0]){return;
}this.accept.call(this.element[0],n.currentItem||n.element)&&(this.options.hoverClass&&this.element.addClass(this.options.hoverClass),this._trigger("over",t,this.ui(n)));
},_out:function(t){var n=e.ui.ddmanager.current;if(!n||(n.currentItem||n.element)[0]==this.element[0]){return;
}this.accept.call(this.element[0],n.currentItem||n.element)&&(this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("out",t,this.ui(n)));
},_drop:function(t,n){var r=n||e.ui.ddmanager.current;if(!r||(r.currentItem||r.element)[0]==this.element[0]){return !1;
}var i=!1;return this.element.find(":data(droppable)").not(".ui-draggable-dragging").each(function(){var t=e.data(this,"droppable");
if(t.options.greedy&&!t.options.disabled&&t.options.scope==r.options.scope&&t.accept.call(t.element[0],r.currentItem||r.element)&&e.ui.intersect(r,e.extend(t,{offset:t.element.offset()}),t.options.tolerance)){return i=!0,!1;
}}),i?!1:this.accept.call(this.element[0],r.currentItem||r.element)?(this.options.activeClass&&this.element.removeClass(this.options.activeClass),this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("drop",t,this.ui(r)),this.element):!1;
},ui:function(e){return{draggable:e.currentItem||e.element,helper:e.helper,position:e.position,offset:e.positionAbs};
}}),e.ui.intersect=function(t,n,r){if(!n.offset){return !1;}var i=(t.positionAbs||t.position.absolute).left,s=i+t.helperProportions.width,o=(t.positionAbs||t.position.absolute).top,u=o+t.helperProportions.height,a=n.offset.left,f=a+n.proportions.width,l=n.offset.top,c=l+n.proportions.height;
switch(r){case"fit":return a<=i&&s<=f&&l<=o&&u<=c;case"intersect":return a<i+t.helperProportions.width/2&&s-t.helperProportions.width/2<f&&l<o+t.helperProportions.height/2&&u-t.helperProportions.height/2<c;
case"pointer":var h=(t.positionAbs||t.position.absolute).left+(t.clickOffset||t.offset.click).left,p=(t.positionAbs||t.position.absolute).top+(t.clickOffset||t.offset.click).top,d=e.ui.isOver(p,h,l,a,n.proportions.height,n.proportions.width);
return d;case"touch":return(o>=l&&o<=c||u>=l&&u<=c||o<l&&u>c)&&(i>=a&&i<=f||s>=a&&s<=f||i<a&&s>f);default:return !1;
}},e.ui.ddmanager={current:null,droppables:{"default":[]},prepareOffsets:function(t,n){var r=e.ui.ddmanager.droppables[t.options.scope]||[],i=n?n.type:null,s=(t.currentItem||t.element).find(":data(droppable)").andSelf();
e:for(var o=0;o<r.length;o++){if(r[o].options.disabled||t&&!r[o].accept.call(r[o].element[0],t.currentItem||t.element)){continue;
}for(var u=0;u<s.length;u++){if(s[u]==r[o].element[0]){r[o].proportions.height=0;continue e;}}r[o].visible=r[o].element.css("display")!="none";
if(!r[o].visible){continue;}i=="mousedown"&&r[o]._activate.call(r[o],n),r[o].offset=r[o].element.offset(),r[o].proportions={width:r[o].element[0].offsetWidth,height:r[o].element[0].offsetHeight};
}},drop:function(t,n){var r=!1;return e.each(e.ui.ddmanager.droppables[t.options.scope]||[],function(){if(!this.options){return;
}!this.options.disabled&&this.visible&&e.ui.intersect(t,this,this.options.tolerance)&&(r=this._drop.call(this,n)||r),!this.options.disabled&&this.visible&&this.accept.call(this.element[0],t.currentItem||t.element)&&(this.isout=1,this.isover=0,this._deactivate.call(this,n));
}),r;},dragStart:function(t,n){t.element.parentsUntil("body").bind("scroll.droppable",function(){t.options.refreshPositions||e.ui.ddmanager.prepareOffsets(t,n);
});},drag:function(t,n){t.options.refreshPositions&&e.ui.ddmanager.prepareOffsets(t,n),e.each(e.ui.ddmanager.droppables[t.options.scope]||[],function(){if(this.options.disabled||this.greedyChild||!this.visible){return;
}var r=e.ui.intersect(t,this,this.options.tolerance),i=!r&&this.isover==1?"isout":r&&this.isover==0?"isover":null;
if(!i){return;}var s;if(this.options.greedy){var o=this.options.scope,u=this.element.parents(":data(droppable)").filter(function(){return e.data(this,"droppable").options.scope===o;
});u.length&&(s=e.data(u[0],"droppable"),s.greedyChild=i=="isover"?1:0);}s&&i=="isover"&&(s.isover=0,s.isout=1,s._out.call(s,n)),this[i]=1,this[i=="isout"?"isover":"isout"]=0,this[i=="isover"?"_over":"_out"].call(this,n),s&&i=="isout"&&(s.isout=0,s.isover=1,s._over.call(s,n));
});},dragStop:function(t,n){t.element.parentsUntil("body").unbind("scroll.droppable"),t.options.refreshPositions||e.ui.ddmanager.prepareOffsets(t,n);
}};})(jQuery);(function(e,t){e.widget("ui.resizable",e.ui.mouse,{version:"1.9.2",widgetEventPrefix:"resize",options:{alsoResize:!1,animate:!1,animateDuration:"slow",animateEasing:"swing",aspectRatio:!1,autoHide:!1,containment:!1,ghost:!1,grid:!1,handles:"e,s,se",helper:!1,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:1000},_create:function(){var t=this,n=this.options;
this.element.addClass("ui-resizable"),e.extend(this,{_aspectRatio:!!n.aspectRatio,aspectRatio:n.aspectRatio,originalElement:this.element,_proportionallyResizeElements:[],_helper:n.helper||n.ghost||n.animate?n.helper||"ui-resizable-helper":null}),this.element[0].nodeName.match(/canvas|textarea|input|select|button|img/i)&&(this.element.wrap(e('<div class="ui-wrapper" style="overflow: hidden;"></div>').css({position:this.element.css("position"),width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.css("top"),left:this.element.css("left")})),this.element=this.element.parent().data("resizable",this.element.data("resizable")),this.elementIsWrapper=!0,this.element.css({marginLeft:this.originalElement.css("marginLeft"),marginTop:this.originalElement.css("marginTop"),marginRight:this.originalElement.css("marginRight"),marginBottom:this.originalElement.css("marginBottom")}),this.originalElement.css({marginLeft:0,marginTop:0,marginRight:0,marginBottom:0}),this.originalResizeStyle=this.originalElement.css("resize"),this.originalElement.css("resize","none"),this._proportionallyResizeElements.push(this.originalElement.css({position:"static",zoom:1,display:"block"})),this.originalElement.css({margin:this.originalElement.css("margin")}),this._proportionallyResize()),this.handles=n.handles||(e(".ui-resizable-handle",this.element).length?{n:".ui-resizable-n",e:".ui-resizable-e",s:".ui-resizable-s",w:".ui-resizable-w",se:".ui-resizable-se",sw:".ui-resizable-sw",ne:".ui-resizable-ne",nw:".ui-resizable-nw"}:"e,s,se");
if(this.handles.constructor==String){this.handles=="all"&&(this.handles="n,e,s,w,se,sw,ne,nw");var r=this.handles.split(",");
this.handles={};for(var i=0;i<r.length;i++){var s=e.trim(r[i]),o="ui-resizable-"+s,u=e('<div class="ui-resizable-handle '+o+'"></div>');
u.css({zIndex:n.zIndex}),"se"==s&&u.addClass("ui-icon ui-icon-gripsmall-diagonal-se"),this.handles[s]=".ui-resizable-"+s,this.element.append(u);
}}this._renderAxis=function(t){t=t||this.element;for(var n in this.handles){this.handles[n].constructor==String&&(this.handles[n]=e(this.handles[n],this.element).show());
if(this.elementIsWrapper&&this.originalElement[0].nodeName.match(/textarea|input|select|button/i)){var r=e(this.handles[n],this.element),i=0;
i=/sw|ne|nw|se|n|s/.test(n)?r.outerHeight():r.outerWidth();var s=["padding",/ne|nw|n/.test(n)?"Top":/se|sw|s/.test(n)?"Bottom":/^e$/.test(n)?"Right":"Left"].join("");
t.css(s,i),this._proportionallyResize();}if(!e(this.handles[n]).length){continue;}}},this._renderAxis(this.element),this._handles=e(".ui-resizable-handle",this.element).disableSelection(),this._handles.mouseover(function(){if(!t.resizing){if(this.className){var e=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i);
}t.axis=e&&e[1]?e[1]:"se";}}),n.autoHide&&(this._handles.hide(),e(this.element).addClass("ui-resizable-autohide").mouseenter(function(){if(n.disabled){return;
}e(this).removeClass("ui-resizable-autohide"),t._handles.show();}).mouseleave(function(){if(n.disabled){return;
}t.resizing||(e(this).addClass("ui-resizable-autohide"),t._handles.hide());})),this._mouseInit();},_destroy:function(){this._mouseDestroy();
var t=function(t){e(t).removeClass("ui-resizable ui-resizable-disabled ui-resizable-resizing").removeData("resizable").removeData("ui-resizable").unbind(".resizable").find(".ui-resizable-handle").remove();
};if(this.elementIsWrapper){t(this.element);var n=this.element;this.originalElement.css({position:n.css("position"),width:n.outerWidth(),height:n.outerHeight(),top:n.css("top"),left:n.css("left")}).insertAfter(n),n.remove();
}return this.originalElement.css("resize",this.originalResizeStyle),t(this.originalElement),this;},_mouseCapture:function(t){var n=!1;
for(var r in this.handles){e(this.handles[r])[0]==t.target&&(n=!0);}return !this.options.disabled&&n;
},_mouseStart:function(t){var r=this.options,i=this.element.position(),s=this.element;this.resizing=!0,this.documentScroll={top:e(document).scrollTop(),left:e(document).scrollLeft()},(s.is(".ui-draggable")||/absolute/.test(s.css("position")))&&s.css({position:"absolute",top:i.top,left:i.left}),this._renderProxy();
var o=n(this.helper.css("left")),u=n(this.helper.css("top"));r.containment&&(o+=e(r.containment).scrollLeft()||0,u+=e(r.containment).scrollTop()||0),this.offset=this.helper.offset(),this.position={left:o,top:u},this.size=this._helper?{width:s.outerWidth(),height:s.outerHeight()}:{width:s.width(),height:s.height()},this.originalSize=this._helper?{width:s.outerWidth(),height:s.outerHeight()}:{width:s.width(),height:s.height()},this.originalPosition={left:o,top:u},this.sizeDiff={width:s.outerWidth()-s.width(),height:s.outerHeight()-s.height()},this.originalMousePosition={left:t.pageX,top:t.pageY},this.aspectRatio=typeof r.aspectRatio=="number"?r.aspectRatio:this.originalSize.width/this.originalSize.height||1;
var a=e(".ui-resizable-"+this.axis).css("cursor");return e("body").css("cursor",a=="auto"?this.axis+"-resize":a),s.addClass("ui-resizable-resizing"),this._propagate("start",t),!0;
},_mouseDrag:function(e){var t=this.helper,n=this.options,r={},i=this,s=this.originalMousePosition,o=this.axis,u=e.pageX-s.left||0,a=e.pageY-s.top||0,f=this._change[o];
if(!f){return !1;}var l=f.apply(this,[e,u,a]);this._updateVirtualBoundaries(e.shiftKey);if(this._aspectRatio||e.shiftKey){l=this._updateRatio(l,e);
}return l=this._respectSize(l,e),this._propagate("resize",e),t.css({top:this.position.top+"px",left:this.position.left+"px",width:this.size.width+"px",height:this.size.height+"px"}),!this._helper&&this._proportionallyResizeElements.length&&this._proportionallyResize(),this._updateCache(l),this._trigger("resize",e,this.ui()),!1;
},_mouseStop:function(t){this.resizing=!1;var n=this.options,r=this;if(this._helper){var i=this._proportionallyResizeElements,s=i.length&&/textarea/i.test(i[0].nodeName),o=s&&e.ui.hasScroll(i[0],"left")?0:r.sizeDiff.height,u=s?0:r.sizeDiff.width,a={width:r.helper.width()-u,height:r.helper.height()-o},f=parseInt(r.element.css("left"),10)+(r.position.left-r.originalPosition.left)||null,l=parseInt(r.element.css("top"),10)+(r.position.top-r.originalPosition.top)||null;
n.animate||this.element.css(e.extend(a,{top:l,left:f})),r.helper.height(r.size.height),r.helper.width(r.size.width),this._helper&&!n.animate&&this._proportionallyResize();
}return e("body").css("cursor","auto"),this.element.removeClass("ui-resizable-resizing"),this._propagate("stop",t),this._helper&&this.helper.remove(),!1;
},_updateVirtualBoundaries:function(e){var t=this.options,n,i,s,o,u;u={minWidth:r(t.minWidth)?t.minWidth:0,maxWidth:r(t.maxWidth)?t.maxWidth:Infinity,minHeight:r(t.minHeight)?t.minHeight:0,maxHeight:r(t.maxHeight)?t.maxHeight:Infinity};
if(this._aspectRatio||e){n=u.minHeight*this.aspectRatio,s=u.minWidth/this.aspectRatio,i=u.maxHeight*this.aspectRatio,o=u.maxWidth/this.aspectRatio,n>u.minWidth&&(u.minWidth=n),s>u.minHeight&&(u.minHeight=s),i<u.maxWidth&&(u.maxWidth=i),o<u.maxHeight&&(u.maxHeight=o);
}this._vBoundaries=u;},_updateCache:function(e){var t=this.options;this.offset=this.helper.offset(),r(e.left)&&(this.position.left=e.left),r(e.top)&&(this.position.top=e.top),r(e.height)&&(this.size.height=e.height),r(e.width)&&(this.size.width=e.width);
},_updateRatio:function(e,t){var n=this.options,i=this.position,s=this.size,o=this.axis;return r(e.height)?e.width=e.height*this.aspectRatio:r(e.width)&&(e.height=e.width/this.aspectRatio),o=="sw"&&(e.left=i.left+(s.width-e.width),e.top=null),o=="nw"&&(e.top=i.top+(s.height-e.height),e.left=i.left+(s.width-e.width)),e;
},_respectSize:function(e,t){var n=this.helper,i=this._vBoundaries,s=this._aspectRatio||t.shiftKey,o=this.axis,u=r(e.width)&&i.maxWidth&&i.maxWidth<e.width,a=r(e.height)&&i.maxHeight&&i.maxHeight<e.height,f=r(e.width)&&i.minWidth&&i.minWidth>e.width,l=r(e.height)&&i.minHeight&&i.minHeight>e.height;
f&&(e.width=i.minWidth),l&&(e.height=i.minHeight),u&&(e.width=i.maxWidth),a&&(e.height=i.maxHeight);var c=this.originalPosition.left+this.originalSize.width,h=this.position.top+this.size.height,p=/sw|nw|w/.test(o),d=/nw|ne|n/.test(o);
f&&p&&(e.left=c-i.minWidth),u&&p&&(e.left=c-i.maxWidth),l&&d&&(e.top=h-i.minHeight),a&&d&&(e.top=h-i.maxHeight);
var v=!e.width&&!e.height;return v&&!e.left&&e.top?e.top=null:v&&!e.top&&e.left&&(e.left=null),e;},_proportionallyResize:function(){var t=this.options;
if(!this._proportionallyResizeElements.length){return;}var n=this.helper||this.element;for(var r=0;r<this._proportionallyResizeElements.length;
r++){var i=this._proportionallyResizeElements[r];if(!this.borderDif){var s=[i.css("borderTopWidth"),i.css("borderRightWidth"),i.css("borderBottomWidth"),i.css("borderLeftWidth")],o=[i.css("paddingTop"),i.css("paddingRight"),i.css("paddingBottom"),i.css("paddingLeft")];
this.borderDif=e.map(s,function(e,t){var n=parseInt(e,10)||0,r=parseInt(o[t],10)||0;return n+r;});}i.css({height:n.height()-this.borderDif[0]-this.borderDif[2]||0,width:n.width()-this.borderDif[1]-this.borderDif[3]||0});
}},_renderProxy:function(){var t=this.element,n=this.options;this.elementOffset=t.offset();if(this._helper){this.helper=this.helper||e('<div style="overflow:hidden;"></div>');
var r=e.ui.ie6?1:0,i=e.ui.ie6?2:-1;this.helper.addClass(this._helper).css({width:this.element.outerWidth()+i,height:this.element.outerHeight()+i,position:"absolute",left:this.elementOffset.left-r+"px",top:this.elementOffset.top-r+"px",zIndex:++n.zIndex}),this.helper.appendTo("body").disableSelection();
}else{this.helper=this.element;}},_change:{e:function(e,t,n){return{width:this.originalSize.width+t};
},w:function(e,t,n){var r=this.options,i=this.originalSize,s=this.originalPosition;return{left:s.left+t,width:i.width-t};
},n:function(e,t,n){var r=this.options,i=this.originalSize,s=this.originalPosition;return{top:s.top+n,height:i.height-n};
},s:function(e,t,n){return{height:this.originalSize.height+n};},se:function(t,n,r){return e.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[t,n,r]));
},sw:function(t,n,r){return e.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[t,n,r]));
},ne:function(t,n,r){return e.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[t,n,r]));
},nw:function(t,n,r){return e.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[t,n,r]));
}},_propagate:function(t,n){e.ui.plugin.call(this,t,[n,this.ui()]),t!="resize"&&this._trigger(t,n,this.ui());
},plugins:{},ui:function(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,originalSize:this.originalSize,originalPosition:this.originalPosition};
}}),e.ui.plugin.add("resizable","alsoResize",{start:function(t,n){var r=e(this).data("resizable"),i=r.options,s=function(t){e(t).each(function(){var t=e(this);
t.data("resizable-alsoresize",{width:parseInt(t.width(),10),height:parseInt(t.height(),10),left:parseInt(t.css("left"),10),top:parseInt(t.css("top"),10)});
});};typeof i.alsoResize=="object"&&!i.alsoResize.parentNode?i.alsoResize.length?(i.alsoResize=i.alsoResize[0],s(i.alsoResize)):e.each(i.alsoResize,function(e){s(e);
}):s(i.alsoResize);},resize:function(t,n){var r=e(this).data("resizable"),i=r.options,s=r.originalSize,o=r.originalPosition,u={height:r.size.height-s.height||0,width:r.size.width-s.width||0,top:r.position.top-o.top||0,left:r.position.left-o.left||0},a=function(t,r){e(t).each(function(){var t=e(this),i=e(this).data("resizable-alsoresize"),s={},o=r&&r.length?r:t.parents(n.originalElement[0]).length?["width","height"]:["width","height","top","left"];
e.each(o,function(e,t){var n=(i[t]||0)+(u[t]||0);n&&n>=0&&(s[t]=n||null);}),t.css(s);});};typeof i.alsoResize=="object"&&!i.alsoResize.nodeType?e.each(i.alsoResize,function(e,t){a(e,t);
}):a(i.alsoResize);},stop:function(t,n){e(this).removeData("resizable-alsoresize");}}),e.ui.plugin.add("resizable","animate",{stop:function(t,n){var r=e(this).data("resizable"),i=r.options,s=r._proportionallyResizeElements,o=s.length&&/textarea/i.test(s[0].nodeName),u=o&&e.ui.hasScroll(s[0],"left")?0:r.sizeDiff.height,a=o?0:r.sizeDiff.width,f={width:r.size.width-a,height:r.size.height-u},l=parseInt(r.element.css("left"),10)+(r.position.left-r.originalPosition.left)||null,c=parseInt(r.element.css("top"),10)+(r.position.top-r.originalPosition.top)||null;
r.element.animate(e.extend(f,c&&l?{top:c,left:l}:{}),{duration:i.animateDuration,easing:i.animateEasing,step:function(){var n={width:parseInt(r.element.css("width"),10),height:parseInt(r.element.css("height"),10),top:parseInt(r.element.css("top"),10),left:parseInt(r.element.css("left"),10)};
s&&s.length&&e(s[0]).css({width:n.width,height:n.height}),r._updateCache(n),r._propagate("resize",t);
}});}}),e.ui.plugin.add("resizable","containment",{start:function(t,r){var i=e(this).data("resizable"),s=i.options,o=i.element,u=s.containment,a=u instanceof e?u.get(0):/parent/.test(u)?o.parent().get(0):u;
if(!a){return;}i.containerElement=e(a);if(/document/.test(u)||u==document){i.containerOffset={left:0,top:0},i.containerPosition={left:0,top:0},i.parentData={element:e(document),left:0,top:0,width:e(document).width(),height:e(document).height()||document.body.parentNode.scrollHeight};
}else{var f=e(a),l=[];e(["Top","Right","Left","Bottom"]).each(function(e,t){l[e]=n(f.css("padding"+t));
}),i.containerOffset=f.offset(),i.containerPosition=f.position(),i.containerSize={height:f.innerHeight()-l[3],width:f.innerWidth()-l[1]};
var c=i.containerOffset,h=i.containerSize.height,p=i.containerSize.width,d=e.ui.hasScroll(a,"left")?a.scrollWidth:p,v=e.ui.hasScroll(a)?a.scrollHeight:h;
i.parentData={element:a,left:c.left,top:c.top,width:d,height:v};}},resize:function(t,n){var r=e(this).data("resizable"),i=r.options,s=r.containerSize,o=r.containerOffset,u=r.size,a=r.position,f=r._aspectRatio||t.shiftKey,l={top:0,left:0},c=r.containerElement;
c[0]!=document&&/static/.test(c.css("position"))&&(l=o),a.left<(r._helper?o.left:0)&&(r.size.width=r.size.width+(r._helper?r.position.left-o.left:r.position.left-l.left),f&&(r.size.height=r.size.width/r.aspectRatio),r.position.left=i.helper?o.left:0),a.top<(r._helper?o.top:0)&&(r.size.height=r.size.height+(r._helper?r.position.top-o.top:r.position.top),f&&(r.size.width=r.size.height*r.aspectRatio),r.position.top=r._helper?o.top:0),r.offset.left=r.parentData.left+r.position.left,r.offset.top=r.parentData.top+r.position.top;
var h=Math.abs((r._helper?r.offset.left-l.left:r.offset.left-l.left)+r.sizeDiff.width),p=Math.abs((r._helper?r.offset.top-l.top:r.offset.top-o.top)+r.sizeDiff.height),d=r.containerElement.get(0)==r.element.parent().get(0),v=/relative|absolute/.test(r.containerElement.css("position"));
d&&v&&(h-=r.parentData.left),h+r.size.width>=r.parentData.width&&(r.size.width=r.parentData.width-h,f&&(r.size.height=r.size.width/r.aspectRatio)),p+r.size.height>=r.parentData.height&&(r.size.height=r.parentData.height-p,f&&(r.size.width=r.size.height*r.aspectRatio));
},stop:function(t,n){var r=e(this).data("resizable"),i=r.options,s=r.position,o=r.containerOffset,u=r.containerPosition,a=r.containerElement,f=e(r.helper),l=f.offset(),c=f.outerWidth()-r.sizeDiff.width,h=f.outerHeight()-r.sizeDiff.height;
r._helper&&!i.animate&&/relative/.test(a.css("position"))&&e(this).css({left:l.left-u.left-o.left,width:c,height:h}),r._helper&&!i.animate&&/static/.test(a.css("position"))&&e(this).css({left:l.left-u.left-o.left,width:c,height:h});
}}),e.ui.plugin.add("resizable","ghost",{start:function(t,n){var r=e(this).data("resizable"),i=r.options,s=r.size;
r.ghost=r.originalElement.clone(),r.ghost.css({opacity:0.25,display:"block",position:"relative",height:s.height,width:s.width,margin:0,left:0,top:0}).addClass("ui-resizable-ghost").addClass(typeof i.ghost=="string"?i.ghost:""),r.ghost.appendTo(r.helper);
},resize:function(t,n){var r=e(this).data("resizable"),i=r.options;r.ghost&&r.ghost.css({position:"relative",height:r.size.height,width:r.size.width});
},stop:function(t,n){var r=e(this).data("resizable"),i=r.options;r.ghost&&r.helper&&r.helper.get(0).removeChild(r.ghost.get(0));
}}),e.ui.plugin.add("resizable","grid",{resize:function(t,n){var r=e(this).data("resizable"),i=r.options,s=r.size,o=r.originalSize,u=r.originalPosition,a=r.axis,f=i._aspectRatio||t.shiftKey;
i.grid=typeof i.grid=="number"?[i.grid,i.grid]:i.grid;var l=Math.round((s.width-o.width)/(i.grid[0]||1))*(i.grid[0]||1),c=Math.round((s.height-o.height)/(i.grid[1]||1))*(i.grid[1]||1);
/^(se|s|e)$/.test(a)?(r.size.width=o.width+l,r.size.height=o.height+c):/^(ne)$/.test(a)?(r.size.width=o.width+l,r.size.height=o.height+c,r.position.top=u.top-c):/^(sw)$/.test(a)?(r.size.width=o.width+l,r.size.height=o.height+c,r.position.left=u.left-l):(r.size.width=o.width+l,r.size.height=o.height+c,r.position.top=u.top-c,r.position.left=u.left-l);
}});var n=function(e){return parseInt(e,10)||0;},r=function(e){return !isNaN(parseInt(e,10));};})(jQuery);
(function(e,t){e.widget("ui.selectable",e.ui.mouse,{version:"1.9.2",options:{appendTo:"body",autoRefresh:!0,distance:0,filter:"*",tolerance:"touch"},_create:function(){var t=this;
this.element.addClass("ui-selectable"),this.dragged=!1;var n;this.refresh=function(){n=e(t.options.filter,t.element[0]),n.addClass("ui-selectee"),n.each(function(){var t=e(this),n=t.offset();
e.data(this,"selectable-item",{element:this,$element:t,left:n.left,top:n.top,right:n.left+t.outerWidth(),bottom:n.top+t.outerHeight(),startselected:!1,selected:t.hasClass("ui-selected"),selecting:t.hasClass("ui-selecting"),unselecting:t.hasClass("ui-unselecting")});
});},this.refresh(),this.selectees=n.addClass("ui-selectee"),this._mouseInit(),this.helper=e("<div class='ui-selectable-helper'></div>");
},_destroy:function(){this.selectees.removeClass("ui-selectee").removeData("selectable-item"),this.element.removeClass("ui-selectable ui-selectable-disabled"),this._mouseDestroy();
},_mouseStart:function(t){var n=this;this.opos=[t.pageX,t.pageY];if(this.options.disabled){return;}var r=this.options;
this.selectees=e(r.filter,this.element[0]),this._trigger("start",t),e(r.appendTo).append(this.helper),this.helper.css({left:t.clientX,top:t.clientY,width:0,height:0}),r.autoRefresh&&this.refresh(),this.selectees.filter(".ui-selected").each(function(){var r=e.data(this,"selectable-item");
r.startselected=!0,!t.metaKey&&!t.ctrlKey&&(r.$element.removeClass("ui-selected"),r.selected=!1,r.$element.addClass("ui-unselecting"),r.unselecting=!0,n._trigger("unselecting",t,{unselecting:r.element}));
}),e(t.target).parents().andSelf().each(function(){var r=e.data(this,"selectable-item");if(r){var i=!t.metaKey&&!t.ctrlKey||!r.$element.hasClass("ui-selected");
return r.$element.removeClass(i?"ui-unselecting":"ui-selected").addClass(i?"ui-selecting":"ui-unselecting"),r.unselecting=!i,r.selecting=i,r.selected=i,i?n._trigger("selecting",t,{selecting:r.element}):n._trigger("unselecting",t,{unselecting:r.element}),!1;
}});},_mouseDrag:function(t){var n=this;this.dragged=!0;if(this.options.disabled){return;}var r=this.options,i=this.opos[0],s=this.opos[1],o=t.pageX,u=t.pageY;
if(i>o){var a=o;o=i,i=a;}if(s>u){var a=u;u=s,s=a;}return this.helper.css({left:i,top:s,width:o-i,height:u-s}),this.selectees.each(function(){var a=e.data(this,"selectable-item");
if(!a||a.element==n.element[0]){return;}var f=!1;r.tolerance=="touch"?f=!(a.left>o||a.right<i||a.top>u||a.bottom<s):r.tolerance=="fit"&&(f=a.left>i&&a.right<o&&a.top>s&&a.bottom<u),f?(a.selected&&(a.$element.removeClass("ui-selected"),a.selected=!1),a.unselecting&&(a.$element.removeClass("ui-unselecting"),a.unselecting=!1),a.selecting||(a.$element.addClass("ui-selecting"),a.selecting=!0,n._trigger("selecting",t,{selecting:a.element}))):(a.selecting&&((t.metaKey||t.ctrlKey)&&a.startselected?(a.$element.removeClass("ui-selecting"),a.selecting=!1,a.$element.addClass("ui-selected"),a.selected=!0):(a.$element.removeClass("ui-selecting"),a.selecting=!1,a.startselected&&(a.$element.addClass("ui-unselecting"),a.unselecting=!0),n._trigger("unselecting",t,{unselecting:a.element}))),a.selected&&!t.metaKey&&!t.ctrlKey&&!a.startselected&&(a.$element.removeClass("ui-selected"),a.selected=!1,a.$element.addClass("ui-unselecting"),a.unselecting=!0,n._trigger("unselecting",t,{unselecting:a.element})));
}),!1;},_mouseStop:function(t){var n=this;this.dragged=!1;var r=this.options;return e(".ui-unselecting",this.element[0]).each(function(){var r=e.data(this,"selectable-item");
r.$element.removeClass("ui-unselecting"),r.unselecting=!1,r.startselected=!1,n._trigger("unselected",t,{unselected:r.element});
}),e(".ui-selecting",this.element[0]).each(function(){var r=e.data(this,"selectable-item");r.$element.removeClass("ui-selecting").addClass("ui-selected"),r.selecting=!1,r.selected=!0,r.startselected=!0,n._trigger("selected",t,{selected:r.element});
}),this._trigger("stop",t),this.helper.remove(),!1;}});})(jQuery);(function(e,t){e.widget("ui.sortable",e.ui.mouse,{version:"1.9.2",widgetEventPrefix:"sort",ready:!1,options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1000},_create:function(){var e=this.options;
this.containerCache={},this.element.addClass("ui-sortable"),this.refresh(),this.floating=this.items.length?e.axis==="x"||/left|right/.test(this.items[0].item.css("float"))||/inline|table-cell/.test(this.items[0].item.css("display")):!1,this.offset=this.element.offset(),this._mouseInit(),this.ready=!0;
},_destroy:function(){this.element.removeClass("ui-sortable ui-sortable-disabled"),this._mouseDestroy();
for(var e=this.items.length-1;e>=0;e--){this.items[e].item.removeData(this.widgetName+"-item");}return this;
},_setOption:function(t,n){t==="disabled"?(this.options[t]=n,this.widget().toggleClass("ui-sortable-disabled",!!n)):e.Widget.prototype._setOption.apply(this,arguments);
},_mouseCapture:function(t,n){var r=this;if(this.reverting){return !1;}if(this.options.disabled||this.options.type=="static"){return !1;
}this._refreshItems(t);var i=null,s=e(t.target).parents().each(function(){if(e.data(this,r.widgetName+"-item")==r){return i=e(this),!1;
}});e.data(t.target,r.widgetName+"-item")==r&&(i=e(t.target));if(!i){return !1;}if(this.options.handle&&!n){var o=!1;
e(this.options.handle,i).find("*").andSelf().each(function(){this==t.target&&(o=!0);});if(!o){return !1;
}}return this.currentItem=i,this._removeCurrentsFromItems(),!0;},_mouseStart:function(t,n,r){var i=this.options;
this.currentContainer=this,this.refreshPositions(),this.helper=this._createHelper(t),this._cacheHelperProportions(),this._cacheMargins(),this.scrollParent=this.helper.scrollParent(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},e.extend(this.offset,{click:{left:t.pageX-this.offset.left,top:t.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.helper.css("position","absolute"),this.cssPosition=this.helper.css("position"),this.originalPosition=this._generatePosition(t),this.originalPageX=t.pageX,this.originalPageY=t.pageY,i.cursorAt&&this._adjustOffsetFromHelper(i.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!=this.currentItem[0]&&this.currentItem.hide(),this._createPlaceholder(),i.containment&&this._setContainment(),i.cursor&&(e("body").css("cursor")&&(this._storedCursor=e("body").css("cursor")),e("body").css("cursor",i.cursor)),i.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",i.opacity)),i.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",i.zIndex)),this.scrollParent[0]!=document&&this.scrollParent[0].tagName!="HTML"&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",t,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions();
if(!r){for(var s=this.containers.length-1;s>=0;s--){this.containers[s]._trigger("activate",t,this._uiHash(this));
}}return e.ui.ddmanager&&(e.ui.ddmanager.current=this),e.ui.ddmanager&&!i.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t),this.dragging=!0,this.helper.addClass("ui-sortable-helper"),this._mouseDrag(t),!0;
},_mouseDrag:function(t){this.position=this._generatePosition(t),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs);
if(this.options.scroll){var n=this.options,r=!1;this.scrollParent[0]!=document&&this.scrollParent[0].tagName!="HTML"?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-t.pageY<n.scrollSensitivity?this.scrollParent[0].scrollTop=r=this.scrollParent[0].scrollTop+n.scrollSpeed:t.pageY-this.overflowOffset.top<n.scrollSensitivity&&(this.scrollParent[0].scrollTop=r=this.scrollParent[0].scrollTop-n.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-t.pageX<n.scrollSensitivity?this.scrollParent[0].scrollLeft=r=this.scrollParent[0].scrollLeft+n.scrollSpeed:t.pageX-this.overflowOffset.left<n.scrollSensitivity&&(this.scrollParent[0].scrollLeft=r=this.scrollParent[0].scrollLeft-n.scrollSpeed)):(t.pageY-e(document).scrollTop()<n.scrollSensitivity?r=e(document).scrollTop(e(document).scrollTop()-n.scrollSpeed):e(window).height()-(t.pageY-e(document).scrollTop())<n.scrollSensitivity&&(r=e(document).scrollTop(e(document).scrollTop()+n.scrollSpeed)),t.pageX-e(document).scrollLeft()<n.scrollSensitivity?r=e(document).scrollLeft(e(document).scrollLeft()-n.scrollSpeed):e(window).width()-(t.pageX-e(document).scrollLeft())<n.scrollSensitivity&&(r=e(document).scrollLeft(e(document).scrollLeft()+n.scrollSpeed))),r!==!1&&e.ui.ddmanager&&!n.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t);
}this.positionAbs=this._convertPositionTo("absolute");if(!this.options.axis||this.options.axis!="y"){this.helper[0].style.left=this.position.left+"px";
}if(!this.options.axis||this.options.axis!="x"){this.helper[0].style.top=this.position.top+"px";}for(var i=this.items.length-1;
i>=0;i--){var s=this.items[i],o=s.item[0],u=this._intersectsWithPointer(s);if(!u){continue;}if(s.instance!==this.currentContainer){continue;
}if(o!=this.currentItem[0]&&this.placeholder[u==1?"next":"prev"]()[0]!=o&&!e.contains(this.placeholder[0],o)&&(this.options.type=="semi-dynamic"?!e.contains(this.element[0],o):!0)){this.direction=u==1?"down":"up";
if(this.options.tolerance!="pointer"&&!this._intersectsWithSides(s)){break;}this._rearrange(t,s),this._trigger("change",t,this._uiHash());
break;}}return this._contactContainers(t),e.ui.ddmanager&&e.ui.ddmanager.drag(this,t),this._trigger("sort",t,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1;
},_mouseStop:function(t,n){if(!t){return;}e.ui.ddmanager&&!this.options.dropBehaviour&&e.ui.ddmanager.drop(this,t);
if(this.options.revert){var r=this,i=this.placeholder.offset();this.reverting=!0,e(this.helper).animate({left:i.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]==document.body?0:this.offsetParent[0].scrollLeft),top:i.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]==document.body?0:this.offsetParent[0].scrollTop)},parseInt(this.options.revert,10)||500,function(){r._clear(t);
});}else{this._clear(t,n);}return !1;},cancel:function(){if(this.dragging){this._mouseUp({target:null}),this.options.helper=="original"?this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper"):this.currentItem.show();
for(var t=this.containers.length-1;t>=0;t--){this.containers[t]._trigger("deactivate",null,this._uiHash(this)),this.containers[t].containerCache.over&&(this.containers[t]._trigger("out",null,this._uiHash(this)),this.containers[t].containerCache.over=0);
}}return this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.options.helper!="original"&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),e.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?e(this.domPosition.prev).after(this.currentItem):e(this.domPosition.parent).prepend(this.currentItem)),this;
},serialize:function(t){var n=this._getItemsAsjQuery(t&&t.connected),r=[];return t=t||{},e(n).each(function(){var n=(e(t.item||this).attr(t.attribute||"id")||"").match(t.expression||/(.+)[-=_](.+)/);
n&&r.push((t.key||n[1]+"[]")+"="+(t.key&&t.expression?n[1]:n[2]));}),!r.length&&t.key&&r.push(t.key+"="),r.join("&");
},toArray:function(t){var n=this._getItemsAsjQuery(t&&t.connected),r=[];return t=t||{},n.each(function(){r.push(e(t.item||this).attr(t.attribute||"id")||"");
}),r;},_intersectsWith:function(e){var t=this.positionAbs.left,n=t+this.helperProportions.width,r=this.positionAbs.top,i=r+this.helperProportions.height,s=e.left,o=s+e.width,u=e.top,a=u+e.height,f=this.offset.click.top,l=this.offset.click.left,c=r+f>u&&r+f<a&&t+l>s&&t+l<o;
return this.options.tolerance=="pointer"||this.options.forcePointerForContainers||this.options.tolerance!="pointer"&&this.helperProportions[this.floating?"width":"height"]>e[this.floating?"width":"height"]?c:s<t+this.helperProportions.width/2&&n-this.helperProportions.width/2<o&&u<r+this.helperProportions.height/2&&i-this.helperProportions.height/2<a;
},_intersectsWithPointer:function(t){var n=this.options.axis==="x"||e.ui.isOverAxis(this.positionAbs.top+this.offset.click.top,t.top,t.height),r=this.options.axis==="y"||e.ui.isOverAxis(this.positionAbs.left+this.offset.click.left,t.left,t.width),i=n&&r,s=this._getDragVerticalDirection(),o=this._getDragHorizontalDirection();
return i?this.floating?o&&o=="right"||s=="down"?2:1:s&&(s=="down"?2:1):!1;},_intersectsWithSides:function(t){var n=e.ui.isOverAxis(this.positionAbs.top+this.offset.click.top,t.top+t.height/2,t.height),r=e.ui.isOverAxis(this.positionAbs.left+this.offset.click.left,t.left+t.width/2,t.width),i=this._getDragVerticalDirection(),s=this._getDragHorizontalDirection();
return this.floating&&s?s=="right"&&r||s=="left"&&!r:i&&(i=="down"&&n||i=="up"&&!n);},_getDragVerticalDirection:function(){var e=this.positionAbs.top-this.lastPositionAbs.top;
return e!=0&&(e>0?"down":"up");},_getDragHorizontalDirection:function(){var e=this.positionAbs.left-this.lastPositionAbs.left;
return e!=0&&(e>0?"right":"left");},refresh:function(e){return this._refreshItems(e),this.refreshPositions(),this;
},_connectWith:function(){var e=this.options;return e.connectWith.constructor==String?[e.connectWith]:e.connectWith;
},_getItemsAsjQuery:function(t){var n=[],r=[],i=this._connectWith();if(i&&t){for(var s=i.length-1;s>=0;
s--){var o=e(i[s]);for(var u=o.length-1;u>=0;u--){var a=e.data(o[u],this.widgetName);a&&a!=this&&!a.options.disabled&&r.push([e.isFunction(a.options.items)?a.options.items.call(a.element):e(a.options.items,a.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),a]);
}}}r.push([e.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):e(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]);
for(var s=r.length-1;s>=0;s--){r[s][0].each(function(){n.push(this);});}return e(n);},_removeCurrentsFromItems:function(){var t=this.currentItem.find(":data("+this.widgetName+"-item)");
this.items=e.grep(this.items,function(e){for(var n=0;n<t.length;n++){if(t[n]==e.item[0]){return !1;}}return !0;
});},_refreshItems:function(t){this.items=[],this.containers=[this];var n=this.items,r=[[e.isFunction(this.options.items)?this.options.items.call(this.element[0],t,{item:this.currentItem}):e(this.options.items,this.element),this]],i=this._connectWith();
if(i&&this.ready){for(var s=i.length-1;s>=0;s--){var o=e(i[s]);for(var u=o.length-1;u>=0;u--){var a=e.data(o[u],this.widgetName);
a&&a!=this&&!a.options.disabled&&(r.push([e.isFunction(a.options.items)?a.options.items.call(a.element[0],t,{item:this.currentItem}):e(a.options.items,a.element),a]),this.containers.push(a));
}}}for(var s=r.length-1;s>=0;s--){var f=r[s][1],l=r[s][0];for(var u=0,c=l.length;u<c;u++){var h=e(l[u]);
h.data(this.widgetName+"-item",f),n.push({item:h,instance:f,width:0,height:0,left:0,top:0});}}},refreshPositions:function(t){this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset());
for(var n=this.items.length-1;n>=0;n--){var r=this.items[n];if(r.instance!=this.currentContainer&&this.currentContainer&&r.item[0]!=this.currentItem[0]){continue;
}var i=this.options.toleranceElement?e(this.options.toleranceElement,r.item):r.item;t||(r.width=i.outerWidth(),r.height=i.outerHeight());
var s=i.offset();r.left=s.left,r.top=s.top;}if(this.options.custom&&this.options.custom.refreshContainers){this.options.custom.refreshContainers.call(this);
}else{for(var n=this.containers.length-1;n>=0;n--){var s=this.containers[n].element.offset();this.containers[n].containerCache.left=s.left,this.containers[n].containerCache.top=s.top,this.containers[n].containerCache.width=this.containers[n].element.outerWidth(),this.containers[n].containerCache.height=this.containers[n].element.outerHeight();
}}return this;},_createPlaceholder:function(t){t=t||this;var n=t.options;if(!n.placeholder||n.placeholder.constructor==String){var r=n.placeholder;
n.placeholder={element:function(){var n=e(document.createElement(t.currentItem[0].nodeName)).addClass(r||t.currentItem[0].className+" ui-sortable-placeholder").removeClass("ui-sortable-helper")[0];
return r||(n.style.visibility="hidden"),n;},update:function(e,i){if(r&&!n.forcePlaceholderSize){return;
}i.height()||i.height(t.currentItem.innerHeight()-parseInt(t.currentItem.css("paddingTop")||0,10)-parseInt(t.currentItem.css("paddingBottom")||0,10)),i.width()||i.width(t.currentItem.innerWidth()-parseInt(t.currentItem.css("paddingLeft")||0,10)-parseInt(t.currentItem.css("paddingRight")||0,10));
}};}t.placeholder=e(n.placeholder.element.call(t.element,t.currentItem)),t.currentItem.after(t.placeholder),n.placeholder.update(t,t.placeholder);
},_contactContainers:function(t){var n=null,r=null;for(var i=this.containers.length-1;i>=0;i--){if(e.contains(this.currentItem[0],this.containers[i].element[0])){continue;
}if(this._intersectsWith(this.containers[i].containerCache)){if(n&&e.contains(this.containers[i].element[0],n.element[0])){continue;
}n=this.containers[i],r=i;}else{this.containers[i].containerCache.over&&(this.containers[i]._trigger("out",t,this._uiHash(this)),this.containers[i].containerCache.over=0);
}}if(!n){return;}if(this.containers.length===1){this.containers[r]._trigger("over",t,this._uiHash(this)),this.containers[r].containerCache.over=1;
}else{var s=10000,o=null,u=this.containers[r].floating?"left":"top",a=this.containers[r].floating?"width":"height",f=this.positionAbs[u]+this.offset.click[u];
for(var l=this.items.length-1;l>=0;l--){if(!e.contains(this.containers[r].element[0],this.items[l].item[0])){continue;
}if(this.items[l].item[0]==this.currentItem[0]){continue;}var c=this.items[l].item.offset()[u],h=!1;Math.abs(c-f)>Math.abs(c+this.items[l][a]-f)&&(h=!0,c+=this.items[l][a]),Math.abs(c-f)<s&&(s=Math.abs(c-f),o=this.items[l],this.direction=h?"up":"down");
}if(!o&&!this.options.dropOnEmpty){return;}this.currentContainer=this.containers[r],o?this._rearrange(t,o,null,!0):this._rearrange(t,null,this.containers[r].element,!0),this._trigger("change",t,this._uiHash()),this.containers[r]._trigger("change",t,this._uiHash(this)),this.options.placeholder.update(this.currentContainer,this.placeholder),this.containers[r]._trigger("over",t,this._uiHash(this)),this.containers[r].containerCache.over=1;
}},_createHelper:function(t){var n=this.options,r=e.isFunction(n.helper)?e(n.helper.apply(this.element[0],[t,this.currentItem])):n.helper=="clone"?this.currentItem.clone():this.currentItem;
return r.parents("body").length||e(n.appendTo!="parent"?n.appendTo:this.currentItem[0].parentNode)[0].appendChild(r[0]),r[0]==this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}),(r[0].style.width==""||n.forceHelperSize)&&r.width(this.currentItem.width()),(r[0].style.height==""||n.forceHelperSize)&&r.height(this.currentItem.height()),r;
},_adjustOffsetFromHelper:function(t){typeof t=="string"&&(t=t.split(" ")),e.isArray(t)&&(t={left:+t[0],top:+t[1]||0}),"left" in t&&(this.offset.click.left=t.left+this.margins.left),"right" in t&&(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left),"top" in t&&(this.offset.click.top=t.top+this.margins.top),"bottom" in t&&(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top);
},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var t=this.offsetParent.offset();
this.cssPosition=="absolute"&&this.scrollParent[0]!=document&&e.contains(this.scrollParent[0],this.offsetParent[0])&&(t.left+=this.scrollParent.scrollLeft(),t.top+=this.scrollParent.scrollTop());
if(this.offsetParent[0]==document.body||this.offsetParent[0].tagName&&this.offsetParent[0].tagName.toLowerCase()=="html"&&e.ui.ie){t={top:0,left:0};
}return{top:t.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:t.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)};
},_getRelativeOffset:function(){if(this.cssPosition=="relative"){var e=this.currentItem.position();return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:e.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()};
}return{top:0,left:0};},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0};
},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()};
},_setContainment:function(){var t=this.options;t.containment=="parent"&&(t.containment=this.helper[0].parentNode);
if(t.containment=="document"||t.containment=="window"){this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,e(t.containment=="document"?document:window).width()-this.helperProportions.width-this.margins.left,(e(t.containment=="document"?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top];
}if(!/^(document|window|parent)$/.test(t.containment)){var n=e(t.containment)[0],r=e(t.containment).offset(),i=e(n).css("overflow")!="hidden";
this.containment=[r.left+(parseInt(e(n).css("borderLeftWidth"),10)||0)+(parseInt(e(n).css("paddingLeft"),10)||0)-this.margins.left,r.top+(parseInt(e(n).css("borderTopWidth"),10)||0)+(parseInt(e(n).css("paddingTop"),10)||0)-this.margins.top,r.left+(i?Math.max(n.scrollWidth,n.offsetWidth):n.offsetWidth)-(parseInt(e(n).css("borderLeftWidth"),10)||0)-(parseInt(e(n).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,r.top+(i?Math.max(n.scrollHeight,n.offsetHeight):n.offsetHeight)-(parseInt(e(n).css("borderTopWidth"),10)||0)-(parseInt(e(n).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top];
}},_convertPositionTo:function(t,n){n||(n=this.position);var r=t=="absolute"?1:-1,i=this.options,s=this.cssPosition!="absolute"||this.scrollParent[0]!=document&&!!e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,o=/(html|body)/i.test(s[0].tagName);
return{top:n.top+this.offset.relative.top*r+this.offset.parent.top*r-(this.cssPosition=="fixed"?-this.scrollParent.scrollTop():o?0:s.scrollTop())*r,left:n.left+this.offset.relative.left*r+this.offset.parent.left*r-(this.cssPosition=="fixed"?-this.scrollParent.scrollLeft():o?0:s.scrollLeft())*r};
},_generatePosition:function(t){var n=this.options,r=this.cssPosition!="absolute"||this.scrollParent[0]!=document&&!!e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,i=/(html|body)/i.test(r[0].tagName);
this.cssPosition=="relative"&&(this.scrollParent[0]==document||this.scrollParent[0]==this.offsetParent[0])&&(this.offset.relative=this._getRelativeOffset());
var s=t.pageX,o=t.pageY;if(this.originalPosition){this.containment&&(t.pageX-this.offset.click.left<this.containment[0]&&(s=this.containment[0]+this.offset.click.left),t.pageY-this.offset.click.top<this.containment[1]&&(o=this.containment[1]+this.offset.click.top),t.pageX-this.offset.click.left>this.containment[2]&&(s=this.containment[2]+this.offset.click.left),t.pageY-this.offset.click.top>this.containment[3]&&(o=this.containment[3]+this.offset.click.top));
if(n.grid){var u=this.originalPageY+Math.round((o-this.originalPageY)/n.grid[1])*n.grid[1];o=this.containment?u-this.offset.click.top<this.containment[1]||u-this.offset.click.top>this.containment[3]?u-this.offset.click.top<this.containment[1]?u+n.grid[1]:u-n.grid[1]:u:u;
var a=this.originalPageX+Math.round((s-this.originalPageX)/n.grid[0])*n.grid[0];s=this.containment?a-this.offset.click.left<this.containment[0]||a-this.offset.click.left>this.containment[2]?a-this.offset.click.left<this.containment[0]?a+n.grid[0]:a-n.grid[0]:a:a;
}}return{top:o-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+(this.cssPosition=="fixed"?-this.scrollParent.scrollTop():i?0:r.scrollTop()),left:s-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+(this.cssPosition=="fixed"?-this.scrollParent.scrollLeft():i?0:r.scrollLeft())};
},_rearrange:function(e,t,n,r){n?n[0].appendChild(this.placeholder[0]):t.item[0].parentNode.insertBefore(this.placeholder[0],this.direction=="down"?t.item[0]:t.item[0].nextSibling),this.counter=this.counter?++this.counter:1;
var i=this.counter;this._delay(function(){i==this.counter&&this.refreshPositions(!r);});},_clear:function(t,n){this.reverting=!1;
var r=[];!this._noFinalSort&&this.currentItem.parent().length&&this.placeholder.before(this.currentItem),this._noFinalSort=null;
if(this.helper[0]==this.currentItem[0]){for(var i in this._storedCSS){if(this._storedCSS[i]=="auto"||this._storedCSS[i]=="static"){this._storedCSS[i]="";
}}this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper");}else{this.currentItem.show();
}this.fromOutside&&!n&&r.push(function(e){this._trigger("receive",e,this._uiHash(this.fromOutside));}),(this.fromOutside||this.domPosition.prev!=this.currentItem.prev().not(".ui-sortable-helper")[0]||this.domPosition.parent!=this.currentItem.parent()[0])&&!n&&r.push(function(e){this._trigger("update",e,this._uiHash());
}),this!==this.currentContainer&&(n||(r.push(function(e){this._trigger("remove",e,this._uiHash());}),r.push(function(e){return function(t){e._trigger("receive",t,this._uiHash(this));
};}.call(this,this.currentContainer)),r.push(function(e){return function(t){e._trigger("update",t,this._uiHash(this));
};}.call(this,this.currentContainer))));for(var i=this.containers.length-1;i>=0;i--){n||r.push(function(e){return function(t){e._trigger("deactivate",t,this._uiHash(this));
};}.call(this,this.containers[i])),this.containers[i].containerCache.over&&(r.push(function(e){return function(t){e._trigger("out",t,this._uiHash(this));
};}.call(this,this.containers[i])),this.containers[i].containerCache.over=0);}this._storedCursor&&e("body").css("cursor",this._storedCursor),this._storedOpacity&&this.helper.css("opacity",this._storedOpacity),this._storedZIndex&&this.helper.css("zIndex",this._storedZIndex=="auto"?"":this._storedZIndex),this.dragging=!1;
if(this.cancelHelperRemoval){if(!n){this._trigger("beforeStop",t,this._uiHash());for(var i=0;i<r.length;
i++){r[i].call(this,t);}this._trigger("stop",t,this._uiHash());}return this.fromOutside=!1,!1;}n||this._trigger("beforeStop",t,this._uiHash()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.helper[0]!=this.currentItem[0]&&this.helper.remove(),this.helper=null;
if(!n){for(var i=0;i<r.length;i++){r[i].call(this,t);}this._trigger("stop",t,this._uiHash());}return this.fromOutside=!1,!0;
},_trigger:function(){e.Widget.prototype._trigger.apply(this,arguments)===!1&&this.cancel();},_uiHash:function(t){var n=t||this;
return{helper:n.helper,placeholder:n.placeholder||e([]),position:n.position,originalPosition:n.originalPosition,offset:n.positionAbs,item:n.currentItem,sender:t?t.element:null};
}});})(jQuery);(function(e,t){var n=0,r={},i={};r.height=r.paddingTop=r.paddingBottom=r.borderTopWidth=r.borderBottomWidth="hide",i.height=i.paddingTop=i.paddingBottom=i.borderTopWidth=i.borderBottomWidth="show",e.widget("ui.accordion",{version:"1.9.2",options:{active:0,animate:{},collapsible:!1,event:"click",header:"> li > :first-child,> :not(li):even",heightStyle:"auto",icons:{activeHeader:"ui-icon-triangle-1-s",header:"ui-icon-triangle-1-e"},activate:null,beforeActivate:null},_create:function(){var t=this.accordionId="ui-accordion-"+(this.element.attr("id")||++n),r=this.options;
this.prevShow=this.prevHide=e(),this.element.addClass("ui-accordion ui-widget ui-helper-reset"),this.headers=this.element.find(r.header).addClass("ui-accordion-header ui-helper-reset ui-state-default ui-corner-all"),this._hoverable(this.headers),this._focusable(this.headers),this.headers.next().addClass("ui-accordion-content ui-helper-reset ui-widget-content ui-corner-bottom").hide(),!r.collapsible&&(r.active===!1||r.active==null)&&(r.active=0),r.active<0&&(r.active+=this.headers.length),this.active=this._findActive(r.active).addClass("ui-accordion-header-active ui-state-active").toggleClass("ui-corner-all ui-corner-top"),this.active.next().addClass("ui-accordion-content-active").show(),this._createIcons(),this.refresh(),this.element.attr("role","tablist"),this.headers.attr("role","tab").each(function(n){var r=e(this),i=r.attr("id"),s=r.next(),o=s.attr("id");
i||(i=t+"-header-"+n,r.attr("id",i)),o||(o=t+"-panel-"+n,s.attr("id",o)),r.attr("aria-controls",o),s.attr("aria-labelledby",i);
}).next().attr("role","tabpanel"),this.headers.not(this.active).attr({"aria-selected":"false",tabIndex:-1}).next().attr({"aria-expanded":"false","aria-hidden":"true"}).hide(),this.active.length?this.active.attr({"aria-selected":"true",tabIndex:0}).next().attr({"aria-expanded":"true","aria-hidden":"false"}):this.headers.eq(0).attr("tabIndex",0),this._on(this.headers,{keydown:"_keydown"}),this._on(this.headers.next(),{keydown:"_panelKeyDown"}),this._setupEvents(r.event);
},_getCreateEventData:function(){return{header:this.active,content:this.active.length?this.active.next():e()};
},_createIcons:function(){var t=this.options.icons;t&&(e("<span>").addClass("ui-accordion-header-icon ui-icon "+t.header).prependTo(this.headers),this.active.children(".ui-accordion-header-icon").removeClass(t.header).addClass(t.activeHeader),this.headers.addClass("ui-accordion-icons"));
},_destroyIcons:function(){this.headers.removeClass("ui-accordion-icons").children(".ui-accordion-header-icon").remove();
},_destroy:function(){var e;this.element.removeClass("ui-accordion ui-widget ui-helper-reset").removeAttr("role"),this.headers.removeClass("ui-accordion-header ui-accordion-header-active ui-helper-reset ui-state-default ui-corner-all ui-state-active ui-state-disabled ui-corner-top").removeAttr("role").removeAttr("aria-selected").removeAttr("aria-controls").removeAttr("tabIndex").each(function(){/^ui-accordion/.test(this.id)&&this.removeAttribute("id");
}),this._destroyIcons(),e=this.headers.next().css("display","").removeAttr("role").removeAttr("aria-expanded").removeAttr("aria-hidden").removeAttr("aria-labelledby").removeClass("ui-helper-reset ui-widget-content ui-corner-bottom ui-accordion-content ui-accordion-content-active ui-state-disabled").each(function(){/^ui-accordion/.test(this.id)&&this.removeAttribute("id");
}),this.options.heightStyle!=="content"&&e.css("height","");},_setOption:function(e,t){if(e==="active"){this._activate(t);
return;}e==="event"&&(this.options.event&&this._off(this.headers,this.options.event),this._setupEvents(t)),this._super(e,t),e==="collapsible"&&!t&&this.options.active===!1&&this._activate(0),e==="icons"&&(this._destroyIcons(),t&&this._createIcons()),e==="disabled"&&this.headers.add(this.headers.next()).toggleClass("ui-state-disabled",!!t);
},_keydown:function(t){if(t.altKey||t.ctrlKey){return;}var n=e.ui.keyCode,r=this.headers.length,i=this.headers.index(t.target),s=!1;
switch(t.keyCode){case n.RIGHT:case n.DOWN:s=this.headers[(i+1)%r];break;case n.LEFT:case n.UP:s=this.headers[(i-1+r)%r];
break;case n.SPACE:case n.ENTER:this._eventHandler(t);break;case n.HOME:s=this.headers[0];break;case n.END:s=this.headers[r-1];
}s&&(e(t.target).attr("tabIndex",-1),e(s).attr("tabIndex",0),s.focus(),t.preventDefault());},_panelKeyDown:function(t){t.keyCode===e.ui.keyCode.UP&&t.ctrlKey&&e(t.currentTarget).prev().focus();
},refresh:function(){var t,n,r=this.options.heightStyle,i=this.element.parent();r==="fill"?(e.support.minHeight||(n=i.css("overflow"),i.css("overflow","hidden")),t=i.height(),this.element.siblings(":visible").each(function(){var n=e(this),r=n.css("position");
if(r==="absolute"||r==="fixed"){return;}t-=n.outerHeight(!0);}),n&&i.css("overflow",n),this.headers.each(function(){t-=e(this).outerHeight(!0);
}),this.headers.next().each(function(){e(this).height(Math.max(0,t-e(this).innerHeight()+e(this).height()));
}).css("overflow","auto")):r==="auto"&&(t=0,this.headers.next().each(function(){t=Math.max(t,e(this).css("height","").height());
}).height(t));},_activate:function(t){var n=this._findActive(t)[0];if(n===this.active[0]){return;}n=n||this.active[0],this._eventHandler({target:n,currentTarget:n,preventDefault:e.noop});
},_findActive:function(t){return typeof t=="number"?this.headers.eq(t):e();},_setupEvents:function(t){var n={};
if(!t){return;}e.each(t.split(" "),function(e,t){n[t]="_eventHandler";}),this._on(this.headers,n);},_eventHandler:function(t){var n=this.options,r=this.active,i=e(t.currentTarget),s=i[0]===r[0],o=s&&n.collapsible,u=o?e():i.next(),a=r.next(),f={oldHeader:r,oldPanel:a,newHeader:o?e():i,newPanel:u};
t.preventDefault();if(s&&!n.collapsible||this._trigger("beforeActivate",t,f)===!1){return;}n.active=o?!1:this.headers.index(i),this.active=s?e():i,this._toggle(f),r.removeClass("ui-accordion-header-active ui-state-active"),n.icons&&r.children(".ui-accordion-header-icon").removeClass(n.icons.activeHeader).addClass(n.icons.header),s||(i.removeClass("ui-corner-all").addClass("ui-accordion-header-active ui-state-active ui-corner-top"),n.icons&&i.children(".ui-accordion-header-icon").removeClass(n.icons.header).addClass(n.icons.activeHeader),i.next().addClass("ui-accordion-content-active"));
},_toggle:function(t){var n=t.newPanel,r=this.prevShow.length?this.prevShow:t.oldPanel;this.prevShow.add(this.prevHide).stop(!0,!0),this.prevShow=n,this.prevHide=r,this.options.animate?this._animate(n,r,t):(r.hide(),n.show(),this._toggleComplete(t)),r.attr({"aria-expanded":"false","aria-hidden":"true"}),r.prev().attr("aria-selected","false"),n.length&&r.length?r.prev().attr("tabIndex",-1):n.length&&this.headers.filter(function(){return e(this).attr("tabIndex")===0;
}).attr("tabIndex",-1),n.attr({"aria-expanded":"true","aria-hidden":"false"}).prev().attr({"aria-selected":"true",tabIndex:0});
},_animate:function(e,t,n){var s,o,u,a=this,f=0,l=e.length&&(!t.length||e.index()<t.index()),c=this.options.animate||{},h=l&&c.down||c,p=function(){a._toggleComplete(n);
};typeof h=="number"&&(u=h),typeof h=="string"&&(o=h),o=o||h.easing||c.easing,u=u||h.duration||c.duration;
if(!t.length){return e.animate(i,u,o,p);}if(!e.length){return t.animate(r,u,o,p);}s=e.show().outerHeight(),t.animate(r,{duration:u,easing:o,step:function(e,t){t.now=Math.round(e);
}}),e.hide().animate(i,{duration:u,easing:o,complete:p,step:function(e,n){n.now=Math.round(e),n.prop!=="height"?f+=n.now:a.options.heightStyle!=="content"&&(n.now=Math.round(s-t.outerHeight()-f),f=0);
}});},_toggleComplete:function(e){var t=e.oldPanel;t.removeClass("ui-accordion-content-active").prev().removeClass("ui-corner-top").addClass("ui-corner-all"),t.length&&(t.parent()[0].className=t.parent()[0].className),this._trigger("activate",null,e);
}}),e.uiBackCompat!==!1&&(function(e,t){e.extend(t.options,{navigation:!1,navigationFilter:function(){return this.href.toLowerCase()===location.href.toLowerCase();
}});var n=t._create;t._create=function(){if(this.options.navigation){var t=this,r=this.element.find(this.options.header),i=r.next(),s=r.add(i).find("a").filter(this.options.navigationFilter)[0];
s&&r.add(i).each(function(n){if(e.contains(this,s)){return t.options.active=Math.floor(n/2),!1;}});}n.call(this);
};}(jQuery,jQuery.ui.accordion.prototype),function(e,t){e.extend(t.options,{heightStyle:null,autoHeight:!0,clearStyle:!1,fillSpace:!1});
var n=t._create,r=t._setOption;e.extend(t,{_create:function(){this.options.heightStyle=this.options.heightStyle||this._mergeHeightStyle(),n.call(this);
},_setOption:function(e){if(e==="autoHeight"||e==="clearStyle"||e==="fillSpace"){this.options.heightStyle=this._mergeHeightStyle();
}r.apply(this,arguments);},_mergeHeightStyle:function(){var e=this.options;if(e.fillSpace){return"fill";
}if(e.clearStyle){return"content";}if(e.autoHeight){return"auto";}}});}(jQuery,jQuery.ui.accordion.prototype),function(e,t){e.extend(t.options.icons,{activeHeader:null,headerSelected:"ui-icon-triangle-1-s"});
var n=t._createIcons;t._createIcons=function(){this.options.icons&&(this.options.icons.activeHeader=this.options.icons.activeHeader||this.options.icons.headerSelected),n.call(this);
};}(jQuery,jQuery.ui.accordion.prototype),function(e,t){t.activate=t._activate;var n=t._findActive;t._findActive=function(e){return e===-1&&(e=!1),e&&typeof e!="number"&&(e=this.headers.index(this.headers.filter(e)),e===-1&&(e=!1)),n.call(this,e);
};}(jQuery,jQuery.ui.accordion.prototype),jQuery.ui.accordion.prototype.resize=jQuery.ui.accordion.prototype.refresh,function(e,t){e.extend(t.options,{change:null,changestart:null});
var n=t._trigger;t._trigger=function(e,t,r){var i=n.apply(this,arguments);return i?(e==="beforeActivate"?i=n.call(this,"changestart",t,{oldHeader:r.oldHeader,oldContent:r.oldPanel,newHeader:r.newHeader,newContent:r.newPanel}):e==="activate"&&(i=n.call(this,"change",t,{oldHeader:r.oldHeader,oldContent:r.oldPanel,newHeader:r.newHeader,newContent:r.newPanel})),i):!1;
};}(jQuery,jQuery.ui.accordion.prototype),function(e,t){e.extend(t.options,{animate:null,animated:"slide"});
var n=t._create;t._create=function(){var e=this.options;e.animate===null&&(e.animated?e.animated==="slide"?e.animate=300:e.animated==="bounceslide"?e.animate={duration:200,down:{easing:"easeOutBounce",duration:1000}}:e.animate=e.animated:e.animate=!1),n.call(this);
};}(jQuery,jQuery.ui.accordion.prototype));})(jQuery);(function(e,t){var n=0;e.widget("ui.autocomplete",{version:"1.9.2",defaultElement:"<input>",options:{appendTo:"body",autoFocus:!1,delay:300,minLength:1,position:{my:"left top",at:"left bottom",collision:"none"},source:null,change:null,close:null,focus:null,open:null,response:null,search:null,select:null},pending:0,_create:function(){var t,n,r;
this.isMultiLine=this._isMultiLine(),this.valueMethod=this.element[this.element.is("input,textarea")?"val":"text"],this.isNewMenu=!0,this.element.addClass("ui-autocomplete-input").attr("autocomplete","off"),this._on(this.element,{keydown:function(i){if(this.element.prop("readOnly")){t=!0,r=!0,n=!0;
return;}t=!1,r=!1,n=!1;var s=e.ui.keyCode;switch(i.keyCode){case s.PAGE_UP:t=!0,this._move("previousPage",i);
break;case s.PAGE_DOWN:t=!0,this._move("nextPage",i);break;case s.UP:t=!0,this._keyEvent("previous",i);
break;case s.DOWN:t=!0,this._keyEvent("next",i);break;case s.ENTER:case s.NUMPAD_ENTER:this.menu.active&&(t=!0,i.preventDefault(),this.menu.select(i));
break;case s.TAB:this.menu.active&&this.menu.select(i);break;case s.ESCAPE:this.menu.element.is(":visible")&&(this._value(this.term),this.close(i),i.preventDefault());
break;default:n=!0,this._searchTimeout(i);}},keypress:function(r){if(t){t=!1,r.preventDefault();return;
}if(n){return;}var i=e.ui.keyCode;switch(r.keyCode){case i.PAGE_UP:this._move("previousPage",r);break;
case i.PAGE_DOWN:this._move("nextPage",r);break;case i.UP:this._keyEvent("previous",r);break;case i.DOWN:this._keyEvent("next",r);
}},input:function(e){if(r){r=!1,e.preventDefault();return;}this._searchTimeout(e);},focus:function(){this.selectedItem=null,this.previous=this._value();
},blur:function(e){if(this.cancelBlur){delete this.cancelBlur;return;}clearTimeout(this.searching),this.close(e),this._change(e);
}}),this._initSource(),this.menu=e("<ul>").addClass("ui-autocomplete").appendTo(this.document.find(this.options.appendTo||"body")[0]).menu({input:e(),role:null}).zIndex(this.element.zIndex()+1).hide().data("menu"),this._on(this.menu.element,{mousedown:function(t){t.preventDefault(),this.cancelBlur=!0,this._delay(function(){delete this.cancelBlur;
});var n=this.menu.element[0];e(t.target).closest(".ui-menu-item").length||this._delay(function(){var t=this;
this.document.one("mousedown",function(r){r.target!==t.element[0]&&r.target!==n&&!e.contains(n,r.target)&&t.close();
});});},menufocus:function(t,n){if(this.isNewMenu){this.isNewMenu=!1;if(t.originalEvent&&/^mouse/.test(t.originalEvent.type)){this.menu.blur(),this.document.one("mousemove",function(){e(t.target).trigger(t.originalEvent);
});return;}}var r=n.item.data("ui-autocomplete-item")||n.item.data("item.autocomplete");!1!==this._trigger("focus",t,{item:r})?t.originalEvent&&/^key/.test(t.originalEvent.type)&&this._value(r.value):this.liveRegion.text(r.value);
},menuselect:function(e,t){var n=t.item.data("ui-autocomplete-item")||t.item.data("item.autocomplete"),r=this.previous;
this.element[0]!==this.document[0].activeElement&&(this.element.focus(),this.previous=r,this._delay(function(){this.previous=r,this.selectedItem=n;
})),!1!==this._trigger("select",e,{item:n})&&this._value(n.value),this.term=this._value(),this.close(e),this.selectedItem=n;
}}),this.liveRegion=e("<span>",{role:"status","aria-live":"polite"}).addClass("ui-helper-hidden-accessible").insertAfter(this.element),e.fn.bgiframe&&this.menu.element.bgiframe(),this._on(this.window,{beforeunload:function(){this.element.removeAttr("autocomplete");
}});},_destroy:function(){clearTimeout(this.searching),this.element.removeClass("ui-autocomplete-input").removeAttr("autocomplete"),this.menu.element.remove(),this.liveRegion.remove();
},_setOption:function(e,t){this._super(e,t),e==="source"&&this._initSource(),e==="appendTo"&&this.menu.element.appendTo(this.document.find(t||"body")[0]),e==="disabled"&&t&&this.xhr&&this.xhr.abort();
},_isMultiLine:function(){return this.element.is("textarea")?!0:this.element.is("input")?!1:this.element.prop("isContentEditable");
},_initSource:function(){var t,n,r=this;e.isArray(this.options.source)?(t=this.options.source,this.source=function(n,r){r(e.ui.autocomplete.filter(t,n.term));
}):typeof this.options.source=="string"?(n=this.options.source,this.source=function(t,i){r.xhr&&r.xhr.abort(),r.xhr=e.ajax({url:n,data:t,dataType:"json",success:function(e){i(e);
},error:function(){i([]);}});}):this.source=this.options.source;},_searchTimeout:function(e){clearTimeout(this.searching),this.searching=this._delay(function(){this.term!==this._value()&&(this.selectedItem=null,this.search(null,e));
},this.options.delay);},search:function(e,t){e=e!=null?e:this._value(),this.term=this._value();if(e.length<this.options.minLength){return this.close(t);
}if(this._trigger("search",t)===!1){return;}return this._search(e);},_search:function(e){this.pending++,this.element.addClass("ui-autocomplete-loading"),this.cancelSearch=!1,this.source({term:e},this._response());
},_response:function(){var e=this,t=++n;return function(r){t===n&&e.__response(r),e.pending--,e.pending||e.element.removeClass("ui-autocomplete-loading");
};},__response:function(e){e&&(e=this._normalize(e)),this._trigger("response",null,{content:e}),!this.options.disabled&&e&&e.length&&!this.cancelSearch?(this._suggest(e),this._trigger("open")):this._close();
},close:function(e){this.cancelSearch=!0,this._close(e);},_close:function(e){this.menu.element.is(":visible")&&(this.menu.element.hide(),this.menu.blur(),this.isNewMenu=!0,this._trigger("close",e));
},_change:function(e){this.previous!==this._value()&&this._trigger("change",e,{item:this.selectedItem});
},_normalize:function(t){return t.length&&t[0].label&&t[0].value?t:e.map(t,function(t){return typeof t=="string"?{label:t,value:t}:e.extend({label:t.label||t.value,value:t.value||t.label},t);
});},_suggest:function(t){var n=this.menu.element.empty().zIndex(this.element.zIndex()+1);this._renderMenu(n,t),this.menu.refresh(),n.show(),this._resizeMenu(),n.position(e.extend({of:this.element},this.options.position)),this.options.autoFocus&&this.menu.next();
},_resizeMenu:function(){var e=this.menu.element;e.outerWidth(Math.max(e.width("").outerWidth()+1,this.element.outerWidth()));
},_renderMenu:function(t,n){var r=this;e.each(n,function(e,n){r._renderItemData(t,n);});},_renderItemData:function(e,t){return this._renderItem(e,t).data("ui-autocomplete-item",t);
},_renderItem:function(t,n){return e("<li>").append(e("<a>").text(n.label)).appendTo(t);},_move:function(e,t){if(!this.menu.element.is(":visible")){this.search(null,t);
return;}if(this.menu.isFirstItem()&&/^previous/.test(e)||this.menu.isLastItem()&&/^next/.test(e)){this._value(this.term),this.menu.blur();
return;}this.menu[e](t);},widget:function(){return this.menu.element;},_value:function(){return this.valueMethod.apply(this.element,arguments);
},_keyEvent:function(e,t){if(!this.isMultiLine||this.menu.element.is(":visible")){this._move(e,t),t.preventDefault();
}}}),e.extend(e.ui.autocomplete,{escapeRegex:function(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&");
},filter:function(t,n){var r=new RegExp(e.ui.autocomplete.escapeRegex(n),"i");return e.grep(t,function(e){return r.test(e.label||e.value||e);
});}}),e.widget("ui.autocomplete",e.ui.autocomplete,{options:{messages:{noResults:"No search results.",results:function(e){return e+(e>1?" results are":" result is")+" available, use up and down arrow keys to navigate.";
}}},__response:function(e){var t;this._superApply(arguments);if(this.options.disabled||this.cancelSearch){return;
}e&&e.length?t=this.options.messages.results(e.length):t=this.options.messages.noResults,this.liveRegion.text(t);
}});})(jQuery);(function(e,t){var n,r,i,s,o="ui-button ui-widget ui-state-default ui-corner-all",u="ui-state-hover ui-state-active ",a="ui-button-icons-only ui-button-icon-only ui-button-text-icons ui-button-text-icon-primary ui-button-text-icon-secondary ui-button-text-only",f=function(){var t=e(this).find(":ui-button");
setTimeout(function(){t.button("refresh");},1);},l=function(t){var n=t.name,r=t.form,i=e([]);return n&&(r?i=e(r).find("[name='"+n+"']"):i=e("[name='"+n+"']",t.ownerDocument).filter(function(){return !this.form;
})),i;};e.widget("ui.button",{version:"1.9.2",defaultElement:"<button>",options:{disabled:null,text:!0,label:null,icons:{primary:null,secondary:null}},_create:function(){this.element.closest("form").unbind("reset"+this.eventNamespace).bind("reset"+this.eventNamespace,f),typeof this.options.disabled!="boolean"?this.options.disabled=!!this.element.prop("disabled"):this.element.prop("disabled",this.options.disabled),this._determineButtonType(),this.hasTitle=!!this.buttonElement.attr("title");
var t=this,u=this.options,a=this.type==="checkbox"||this.type==="radio",c=a?"":"ui-state-active",h="ui-state-focus";
u.label===null&&(u.label=this.type==="input"?this.buttonElement.val():this.buttonElement.html()),this._hoverable(this.buttonElement),this.buttonElement.addClass(o).attr("role","button").bind("mouseenter"+this.eventNamespace,function(){if(u.disabled){return;
}this===n&&e(this).addClass("ui-state-active");}).bind("mouseleave"+this.eventNamespace,function(){if(u.disabled){return;
}e(this).removeClass(c);}).bind("click"+this.eventNamespace,function(e){u.disabled&&(e.preventDefault(),e.stopImmediatePropagation());
}),this.element.bind("focus"+this.eventNamespace,function(){t.buttonElement.addClass(h);}).bind("blur"+this.eventNamespace,function(){t.buttonElement.removeClass(h);
}),a&&(this.element.bind("change"+this.eventNamespace,function(){if(s){return;}t.refresh();}),this.buttonElement.bind("mousedown"+this.eventNamespace,function(e){if(u.disabled){return;
}s=!1,r=e.pageX,i=e.pageY;}).bind("mouseup"+this.eventNamespace,function(e){if(u.disabled){return;}if(r!==e.pageX||i!==e.pageY){s=!0;
}})),this.type==="checkbox"?this.buttonElement.bind("click"+this.eventNamespace,function(){if(u.disabled||s){return !1;
}e(this).toggleClass("ui-state-active"),t.buttonElement.attr("aria-pressed",t.element[0].checked);}):this.type==="radio"?this.buttonElement.bind("click"+this.eventNamespace,function(){if(u.disabled||s){return !1;
}e(this).addClass("ui-state-active"),t.buttonElement.attr("aria-pressed","true");var n=t.element[0];l(n).not(n).map(function(){return e(this).button("widget")[0];
}).removeClass("ui-state-active").attr("aria-pressed","false");}):(this.buttonElement.bind("mousedown"+this.eventNamespace,function(){if(u.disabled){return !1;
}e(this).addClass("ui-state-active"),n=this,t.document.one("mouseup",function(){n=null;});}).bind("mouseup"+this.eventNamespace,function(){if(u.disabled){return !1;
}e(this).removeClass("ui-state-active");}).bind("keydown"+this.eventNamespace,function(t){if(u.disabled){return !1;
}(t.keyCode===e.ui.keyCode.SPACE||t.keyCode===e.ui.keyCode.ENTER)&&e(this).addClass("ui-state-active");
}).bind("keyup"+this.eventNamespace,function(){e(this).removeClass("ui-state-active");}),this.buttonElement.is("a")&&this.buttonElement.keyup(function(t){t.keyCode===e.ui.keyCode.SPACE&&e(this).click();
})),this._setOption("disabled",u.disabled),this._resetButton();},_determineButtonType:function(){var e,t,n;
this.element.is("[type=checkbox]")?this.type="checkbox":this.element.is("[type=radio]")?this.type="radio":this.element.is("input")?this.type="input":this.type="button",this.type==="checkbox"||this.type==="radio"?(e=this.element.parents().last(),t="label[for='"+this.element.attr("id")+"']",this.buttonElement=e.find(t),this.buttonElement.length||(e=e.length?e.siblings():this.element.siblings(),this.buttonElement=e.filter(t),this.buttonElement.length||(this.buttonElement=e.find(t))),this.element.addClass("ui-helper-hidden-accessible"),n=this.element.is(":checked"),n&&this.buttonElement.addClass("ui-state-active"),this.buttonElement.prop("aria-pressed",n)):this.buttonElement=this.element;
},widget:function(){return this.buttonElement;},_destroy:function(){this.element.removeClass("ui-helper-hidden-accessible"),this.buttonElement.removeClass(o+" "+u+" "+a).removeAttr("role").removeAttr("aria-pressed").html(this.buttonElement.find(".ui-button-text").html()),this.hasTitle||this.buttonElement.removeAttr("title");
},_setOption:function(e,t){this._super(e,t);if(e==="disabled"){t?this.element.prop("disabled",!0):this.element.prop("disabled",!1);
return;}this._resetButton();},refresh:function(){var t=this.element.is("input, button")?this.element.is(":disabled"):this.element.hasClass("ui-button-disabled");
t!==this.options.disabled&&this._setOption("disabled",t),this.type==="radio"?l(this.element[0]).each(function(){e(this).is(":checked")?e(this).button("widget").addClass("ui-state-active").attr("aria-pressed","true"):e(this).button("widget").removeClass("ui-state-active").attr("aria-pressed","false");
}):this.type==="checkbox"&&(this.element.is(":checked")?this.buttonElement.addClass("ui-state-active").attr("aria-pressed","true"):this.buttonElement.removeClass("ui-state-active").attr("aria-pressed","false"));
},_resetButton:function(){if(this.type==="input"){this.options.label&&this.element.val(this.options.label);
return;}var t=this.buttonElement.removeClass(a),n=e("<span></span>",this.document[0]).addClass("ui-button-text").html(this.options.label).appendTo(t.empty()).text(),r=this.options.icons,i=r.primary&&r.secondary,s=[];
r.primary||r.secondary?(this.options.text&&s.push("ui-button-text-icon"+(i?"s":r.primary?"-primary":"-secondary")),r.primary&&t.prepend("<span class='ui-button-icon-primary ui-icon "+r.primary+"'></span>"),r.secondary&&t.append("<span class='ui-button-icon-secondary ui-icon "+r.secondary+"'></span>"),this.options.text||(s.push(i?"ui-button-icons-only":"ui-button-icon-only"),this.hasTitle||t.attr("title",e.trim(n)))):s.push("ui-button-text-only"),t.addClass(s.join(" "));
}}),e.widget("ui.buttonset",{version:"1.9.2",options:{items:"button, input[type=button], input[type=submit], input[type=reset], input[type=checkbox], input[type=radio], a, :data(button)"},_create:function(){this.element.addClass("ui-buttonset");
},_init:function(){this.refresh();},_setOption:function(e,t){e==="disabled"&&this.buttons.button("option",e,t),this._super(e,t);
},refresh:function(){var t=this.element.css("direction")==="rtl";this.buttons=this.element.find(this.options.items).filter(":ui-button").button("refresh").end().not(":ui-button").button().end().map(function(){return e(this).button("widget")[0];
}).removeClass("ui-corner-all ui-corner-left ui-corner-right").filter(":first").addClass(t?"ui-corner-right":"ui-corner-left").end().filter(":last").addClass(t?"ui-corner-left":"ui-corner-right").end().end();
},_destroy:function(){this.element.removeClass("ui-buttonset"),this.buttons.map(function(){return e(this).button("widget")[0];
}).removeClass("ui-corner-left ui-corner-right").end().button("destroy");}});})(jQuery);(function($,undefined){function Datepicker(){this.debug=!1,this._curInst=null,this._keyEvent=!1,this._disabledInputs=[],this._datepickerShowing=!1,this._inDialog=!1,this._mainDivId="ui-datepicker-div",this._inlineClass="ui-datepicker-inline",this._appendClass="ui-datepicker-append",this._triggerClass="ui-datepicker-trigger",this._dialogClass="ui-datepicker-dialog",this._disableClass="ui-datepicker-disabled",this._unselectableClass="ui-datepicker-unselectable",this._currentClass="ui-datepicker-current-day",this._dayOverClass="ui-datepicker-days-cell-over",this.regional=[],this.regional[""]={closeText:"Done",prevText:"Prev",nextText:"Next",currentText:"Today",monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dayNamesMin:["Su","Mo","Tu","We","Th","Fr","Sa"],weekHeader:"Wk",dateFormat:"mm/dd/yy",firstDay:0,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},this._defaults={showOn:"focus",showAnim:"fadeIn",showOptions:{},defaultDate:null,appendText:"",buttonText:"...",buttonImage:"",buttonImageOnly:!1,hideIfNoPrevNext:!1,navigationAsDateFormat:!1,gotoCurrent:!1,changeMonth:!1,changeYear:!1,yearRange:"c-10:c+10",showOtherMonths:!1,selectOtherMonths:!1,showWeek:!1,calculateWeek:this.iso8601Week,shortYearCutoff:"+10",minDate:null,maxDate:null,duration:"fast",beforeShowDay:null,beforeShow:null,onSelect:null,onChangeMonthYear:null,onClose:null,numberOfMonths:1,showCurrentAtPos:0,stepMonths:1,stepBigMonths:12,altField:"",altFormat:"",constrainInput:!0,showButtonPanel:!1,autoSize:!1,disabled:!1},$.extend(this._defaults,this.regional[""]),this.dpDiv=bindHover($('<div id="'+this._mainDivId+'" class="ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all"></div>'));
}function bindHover(e){var t="button, .ui-datepicker-prev, .ui-datepicker-next, .ui-datepicker-calendar td a";
return e.delegate(t,"mouseout",function(){$(this).removeClass("ui-state-hover"),this.className.indexOf("ui-datepicker-prev")!=-1&&$(this).removeClass("ui-datepicker-prev-hover"),this.className.indexOf("ui-datepicker-next")!=-1&&$(this).removeClass("ui-datepicker-next-hover");
}).delegate(t,"mouseover",function(){$.datepicker._isDisabledDatepicker(instActive.inline?e.parent()[0]:instActive.input[0])||($(this).parents(".ui-datepicker-calendar").find("a").removeClass("ui-state-hover"),$(this).addClass("ui-state-hover"),this.className.indexOf("ui-datepicker-prev")!=-1&&$(this).addClass("ui-datepicker-prev-hover"),this.className.indexOf("ui-datepicker-next")!=-1&&$(this).addClass("ui-datepicker-next-hover"));
});}function extendRemove(e,t){$.extend(e,t);for(var n in t){if(t[n]==null||t[n]==undefined){e[n]=t[n];
}}return e;}$.extend($.ui,{datepicker:{version:"1.9.2"}});var PROP_NAME="datepicker",dpuuid=(new Date).getTime(),instActive;
$.extend(Datepicker.prototype,{markerClassName:"hasDatepicker",maxRows:4,log:function(){this.debug&&console.log.apply("",arguments);
},_widgetDatepicker:function(){return this.dpDiv;},setDefaults:function(e){return extendRemove(this._defaults,e||{}),this;
},_attachDatepicker:function(target,settings){var inlineSettings=null;for(var attrName in this._defaults){var attrValue=target.getAttribute("date:"+attrName);
if(attrValue){inlineSettings=inlineSettings||{};try{inlineSettings[attrName]=eval(attrValue);}catch(err){inlineSettings[attrName]=attrValue;
}}}var nodeName=target.nodeName.toLowerCase(),inline=nodeName=="div"||nodeName=="span";target.id||(this.uuid+=1,target.id="dp"+this.uuid);
var inst=this._newInst($(target),inline);inst.settings=$.extend({},settings||{},inlineSettings||{}),nodeName=="input"?this._connectDatepicker(target,inst):inline&&this._inlineDatepicker(target,inst);
},_newInst:function(e,t){var n=e[0].id.replace(/([^A-Za-z0-9_-])/g,"\\\\$1");return{id:n,input:e,selectedDay:0,selectedMonth:0,selectedYear:0,drawMonth:0,drawYear:0,inline:t,dpDiv:t?bindHover($('<div class="'+this._inlineClass+' ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all"></div>')):this.dpDiv};
},_connectDatepicker:function(e,t){var n=$(e);t.append=$([]),t.trigger=$([]);if(n.hasClass(this.markerClassName)){return;
}this._attachments(n,t),n.addClass(this.markerClassName).keydown(this._doKeyDown).keypress(this._doKeyPress).keyup(this._doKeyUp).bind("setData.datepicker",function(e,n,r){t.settings[n]=r;
}).bind("getData.datepicker",function(e,n){return this._get(t,n);}),this._autoSize(t),$.data(e,PROP_NAME,t),t.settings.disabled&&this._disableDatepicker(e);
},_attachments:function(e,t){var n=this._get(t,"appendText"),r=this._get(t,"isRTL");t.append&&t.append.remove(),n&&(t.append=$('<span class="'+this._appendClass+'">'+n+"</span>"),e[r?"before":"after"](t.append)),e.unbind("focus",this._showDatepicker),t.trigger&&t.trigger.remove();
var i=this._get(t,"showOn");(i=="focus"||i=="both")&&e.focus(this._showDatepicker);if(i=="button"||i=="both"){var s=this._get(t,"buttonText"),o=this._get(t,"buttonImage");
t.trigger=$(this._get(t,"buttonImageOnly")?$("<img/>").addClass(this._triggerClass).attr({src:o,alt:s,title:s}):$('<button type="button"></button>').addClass(this._triggerClass).html(o==""?s:$("<img/>").attr({src:o,alt:s,title:s}))),e[r?"before":"after"](t.trigger),t.trigger.click(function(){return $.datepicker._datepickerShowing&&$.datepicker._lastInput==e[0]?$.datepicker._hideDatepicker():$.datepicker._datepickerShowing&&$.datepicker._lastInput!=e[0]?($.datepicker._hideDatepicker(),$.datepicker._showDatepicker(e[0])):$.datepicker._showDatepicker(e[0]),!1;
});}},_autoSize:function(e){if(this._get(e,"autoSize")&&!e.inline){var t=new Date(2009,11,20),n=this._get(e,"dateFormat");
if(n.match(/[DM]/)){var r=function(e){var t=0,n=0;for(var r=0;r<e.length;r++){e[r].length>t&&(t=e[r].length,n=r);
}return n;};t.setMonth(r(this._get(e,n.match(/MM/)?"monthNames":"monthNamesShort"))),t.setDate(r(this._get(e,n.match(/DD/)?"dayNames":"dayNamesShort"))+20-t.getDay());
}e.input.attr("size",this._formatDate(e,t).length);}},_inlineDatepicker:function(e,t){var n=$(e);if(n.hasClass(this.markerClassName)){return;
}n.addClass(this.markerClassName).append(t.dpDiv).bind("setData.datepicker",function(e,n,r){t.settings[n]=r;
}).bind("getData.datepicker",function(e,n){return this._get(t,n);}),$.data(e,PROP_NAME,t),this._setDate(t,this._getDefaultDate(t),!0),this._updateDatepicker(t),this._updateAlternate(t),t.settings.disabled&&this._disableDatepicker(e),t.dpDiv.css("display","block");
},_dialogDatepicker:function(e,t,n,r,i){var s=this._dialogInst;if(!s){this.uuid+=1;var o="dp"+this.uuid;
this._dialogInput=$('<input type="text" id="'+o+'" style="position: absolute; top: -100px; width: 0px;"/>'),this._dialogInput.keydown(this._doKeyDown),$("body").append(this._dialogInput),s=this._dialogInst=this._newInst(this._dialogInput,!1),s.settings={},$.data(this._dialogInput[0],PROP_NAME,s);
}extendRemove(s.settings,r||{}),t=t&&t.constructor==Date?this._formatDate(s,t):t,this._dialogInput.val(t),this._pos=i?i.length?i:[i.pageX,i.pageY]:null;
if(!this._pos){var u=document.documentElement.clientWidth,a=document.documentElement.clientHeight,f=document.documentElement.scrollLeft||document.body.scrollLeft,l=document.documentElement.scrollTop||document.body.scrollTop;
this._pos=[u/2-100+f,a/2-150+l];}return this._dialogInput.css("left",this._pos[0]+20+"px").css("top",this._pos[1]+"px"),s.settings.onSelect=n,this._inDialog=!0,this.dpDiv.addClass(this._dialogClass),this._showDatepicker(this._dialogInput[0]),$.blockUI&&$.blockUI(this.dpDiv),$.data(this._dialogInput[0],PROP_NAME,s),this;
},_destroyDatepicker:function(e){var t=$(e),n=$.data(e,PROP_NAME);if(!t.hasClass(this.markerClassName)){return;
}var r=e.nodeName.toLowerCase();$.removeData(e,PROP_NAME),r=="input"?(n.append.remove(),n.trigger.remove(),t.removeClass(this.markerClassName).unbind("focus",this._showDatepicker).unbind("keydown",this._doKeyDown).unbind("keypress",this._doKeyPress).unbind("keyup",this._doKeyUp)):(r=="div"||r=="span")&&t.removeClass(this.markerClassName).empty();
},_enableDatepicker:function(e){var t=$(e),n=$.data(e,PROP_NAME);if(!t.hasClass(this.markerClassName)){return;
}var r=e.nodeName.toLowerCase();if(r=="input"){e.disabled=!1,n.trigger.filter("button").each(function(){this.disabled=!1;
}).end().filter("img").css({opacity:"1.0",cursor:""});}else{if(r=="div"||r=="span"){var i=t.children("."+this._inlineClass);
i.children().removeClass("ui-state-disabled"),i.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",!1);
}}this._disabledInputs=$.map(this._disabledInputs,function(t){return t==e?null:t;});},_disableDatepicker:function(e){var t=$(e),n=$.data(e,PROP_NAME);
if(!t.hasClass(this.markerClassName)){return;}var r=e.nodeName.toLowerCase();if(r=="input"){e.disabled=!0,n.trigger.filter("button").each(function(){this.disabled=!0;
}).end().filter("img").css({opacity:"0.5",cursor:"default"});}else{if(r=="div"||r=="span"){var i=t.children("."+this._inlineClass);
i.children().addClass("ui-state-disabled"),i.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",!0);
}}this._disabledInputs=$.map(this._disabledInputs,function(t){return t==e?null:t;}),this._disabledInputs[this._disabledInputs.length]=e;
},_isDisabledDatepicker:function(e){if(!e){return !1;}for(var t=0;t<this._disabledInputs.length;t++){if(this._disabledInputs[t]==e){return !0;
}}return !1;},_getInst:function(e){try{return $.data(e,PROP_NAME);}catch(t){throw"Missing instance data for this datepicker";
}},_optionDatepicker:function(e,t,n){var r=this._getInst(e);if(arguments.length==2&&typeof t=="string"){return t=="defaults"?$.extend({},$.datepicker._defaults):r?t=="all"?$.extend({},r.settings):this._get(r,t):null;
}var i=t||{};typeof t=="string"&&(i={},i[t]=n);if(r){this._curInst==r&&this._hideDatepicker();var s=this._getDateDatepicker(e,!0),o=this._getMinMaxDate(r,"min"),u=this._getMinMaxDate(r,"max");
extendRemove(r.settings,i),o!==null&&i.dateFormat!==undefined&&i.minDate===undefined&&(r.settings.minDate=this._formatDate(r,o)),u!==null&&i.dateFormat!==undefined&&i.maxDate===undefined&&(r.settings.maxDate=this._formatDate(r,u)),this._attachments($(e),r),this._autoSize(r),this._setDate(r,s),this._updateAlternate(r),this._updateDatepicker(r);
}},_changeDatepicker:function(e,t,n){this._optionDatepicker(e,t,n);},_refreshDatepicker:function(e){var t=this._getInst(e);
t&&this._updateDatepicker(t);},_setDateDatepicker:function(e,t){var n=this._getInst(e);n&&(this._setDate(n,t),this._updateDatepicker(n),this._updateAlternate(n));
},_getDateDatepicker:function(e,t){var n=this._getInst(e);return n&&!n.inline&&this._setDateFromField(n,t),n?this._getDate(n):null;
},_doKeyDown:function(e){var t=$.datepicker._getInst(e.target),n=!0,r=t.dpDiv.is(".ui-datepicker-rtl");
t._keyEvent=!0;if($.datepicker._datepickerShowing){switch(e.keyCode){case 9:$.datepicker._hideDatepicker(),n=!1;
break;case 13:var i=$("td."+$.datepicker._dayOverClass+":not(."+$.datepicker._currentClass+")",t.dpDiv);
i[0]&&$.datepicker._selectDay(e.target,t.selectedMonth,t.selectedYear,i[0]);var s=$.datepicker._get(t,"onSelect");
if(s){var o=$.datepicker._formatDate(t);s.apply(t.input?t.input[0]:null,[o,t]);}else{$.datepicker._hideDatepicker();
}return !1;case 27:$.datepicker._hideDatepicker();break;case 33:$.datepicker._adjustDate(e.target,e.ctrlKey?-$.datepicker._get(t,"stepBigMonths"):-$.datepicker._get(t,"stepMonths"),"M");
break;case 34:$.datepicker._adjustDate(e.target,e.ctrlKey?+$.datepicker._get(t,"stepBigMonths"):+$.datepicker._get(t,"stepMonths"),"M");
break;case 35:(e.ctrlKey||e.metaKey)&&$.datepicker._clearDate(e.target),n=e.ctrlKey||e.metaKey;break;
case 36:(e.ctrlKey||e.metaKey)&&$.datepicker._gotoToday(e.target),n=e.ctrlKey||e.metaKey;break;case 37:(e.ctrlKey||e.metaKey)&&$.datepicker._adjustDate(e.target,r?1:-1,"D"),n=e.ctrlKey||e.metaKey,e.originalEvent.altKey&&$.datepicker._adjustDate(e.target,e.ctrlKey?-$.datepicker._get(t,"stepBigMonths"):-$.datepicker._get(t,"stepMonths"),"M");
break;case 38:(e.ctrlKey||e.metaKey)&&$.datepicker._adjustDate(e.target,-7,"D"),n=e.ctrlKey||e.metaKey;
break;case 39:(e.ctrlKey||e.metaKey)&&$.datepicker._adjustDate(e.target,r?-1:1,"D"),n=e.ctrlKey||e.metaKey,e.originalEvent.altKey&&$.datepicker._adjustDate(e.target,e.ctrlKey?+$.datepicker._get(t,"stepBigMonths"):+$.datepicker._get(t,"stepMonths"),"M");
break;case 40:(e.ctrlKey||e.metaKey)&&$.datepicker._adjustDate(e.target,7,"D"),n=e.ctrlKey||e.metaKey;
break;default:n=!1;}}else{e.keyCode==36&&e.ctrlKey?$.datepicker._showDatepicker(this):n=!1;}n&&(e.preventDefault(),e.stopPropagation());
},_doKeyPress:function(e){var t=$.datepicker._getInst(e.target);if($.datepicker._get(t,"constrainInput")){var n=$.datepicker._possibleChars($.datepicker._get(t,"dateFormat")),r=String.fromCharCode(e.charCode==undefined?e.keyCode:e.charCode);
return e.ctrlKey||e.metaKey||r<" "||!n||n.indexOf(r)>-1;}},_doKeyUp:function(e){var t=$.datepicker._getInst(e.target);
if(t.input.val()!=t.lastVal){try{var n=$.datepicker.parseDate($.datepicker._get(t,"dateFormat"),t.input?t.input.val():null,$.datepicker._getFormatConfig(t));
n&&($.datepicker._setDateFromField(t),$.datepicker._updateAlternate(t),$.datepicker._updateDatepicker(t));
}catch(r){$.datepicker.log(r);}}return !0;},_showDatepicker:function(e){e=e.target||e,e.nodeName.toLowerCase()!="input"&&(e=$("input",e.parentNode)[0]);
if($.datepicker._isDisabledDatepicker(e)||$.datepicker._lastInput==e){return;}var t=$.datepicker._getInst(e);
$.datepicker._curInst&&$.datepicker._curInst!=t&&($.datepicker._curInst.dpDiv.stop(!0,!0),t&&$.datepicker._datepickerShowing&&$.datepicker._hideDatepicker($.datepicker._curInst.input[0]));
var n=$.datepicker._get(t,"beforeShow"),r=n?n.apply(e,[e,t]):{};if(r===!1){return;}extendRemove(t.settings,r),t.lastVal=null,$.datepicker._lastInput=e,$.datepicker._setDateFromField(t),$.datepicker._inDialog&&(e.value=""),$.datepicker._pos||($.datepicker._pos=$.datepicker._findPos(e),$.datepicker._pos[1]+=e.offsetHeight);
var i=!1;$(e).parents().each(function(){return i|=$(this).css("position")=="fixed",!i;});var s={left:$.datepicker._pos[0],top:$.datepicker._pos[1]};
$.datepicker._pos=null,t.dpDiv.empty(),t.dpDiv.css({position:"absolute",display:"block",top:"-1000px"}),$.datepicker._updateDatepicker(t),s=$.datepicker._checkOffset(t,s,i),t.dpDiv.css({position:$.datepicker._inDialog&&$.blockUI?"static":i?"fixed":"absolute",display:"none",left:s.left+"px",top:s.top+"px"});
if(!t.inline){var o=$.datepicker._get(t,"showAnim"),u=$.datepicker._get(t,"duration"),a=function(){var e=t.dpDiv.find("iframe.ui-datepicker-cover");
if(!!e.length){var n=$.datepicker._getBorders(t.dpDiv);e.css({left:-n[0],top:-n[1],width:t.dpDiv.outerWidth(),height:t.dpDiv.outerHeight()});
}};t.dpDiv.zIndex($(e).zIndex()+1),$.datepicker._datepickerShowing=!0,$.effects&&($.effects.effect[o]||$.effects[o])?t.dpDiv.show(o,$.datepicker._get(t,"showOptions"),u,a):t.dpDiv[o||"show"](o?u:null,a),(!o||!u)&&a(),t.input.is(":visible")&&!t.input.is(":disabled")&&t.input.focus(),$.datepicker._curInst=t;
}},_updateDatepicker:function(e){this.maxRows=4;var t=$.datepicker._getBorders(e.dpDiv);instActive=e,e.dpDiv.empty().append(this._generateHTML(e)),this._attachHandlers(e);
var n=e.dpDiv.find("iframe.ui-datepicker-cover");!n.length||n.css({left:-t[0],top:-t[1],width:e.dpDiv.outerWidth(),height:e.dpDiv.outerHeight()}),e.dpDiv.find("."+this._dayOverClass+" a").mouseover();
var r=this._getNumberOfMonths(e),i=r[1],s=17;e.dpDiv.removeClass("ui-datepicker-multi-2 ui-datepicker-multi-3 ui-datepicker-multi-4").width(""),i>1&&e.dpDiv.addClass("ui-datepicker-multi-"+i).css("width",s*i+"em"),e.dpDiv[(r[0]!=1||r[1]!=1?"add":"remove")+"Class"]("ui-datepicker-multi"),e.dpDiv[(this._get(e,"isRTL")?"add":"remove")+"Class"]("ui-datepicker-rtl"),e==$.datepicker._curInst&&$.datepicker._datepickerShowing&&e.input&&e.input.is(":visible")&&!e.input.is(":disabled")&&e.input[0]!=document.activeElement&&e.input.focus();
if(e.yearshtml){var o=e.yearshtml;setTimeout(function(){o===e.yearshtml&&e.yearshtml&&e.dpDiv.find("select.ui-datepicker-year:first").replaceWith(e.yearshtml),o=e.yearshtml=null;
},0);}},_getBorders:function(e){var t=function(e){return{thin:1,medium:2,thick:3}[e]||e;};return[parseFloat(t(e.css("border-left-width"))),parseFloat(t(e.css("border-top-width")))];
},_checkOffset:function(e,t,n){var r=e.dpDiv.outerWidth(),i=e.dpDiv.outerHeight(),s=e.input?e.input.outerWidth():0,o=e.input?e.input.outerHeight():0,u=document.documentElement.clientWidth+(n?0:$(document).scrollLeft()),a=document.documentElement.clientHeight+(n?0:$(document).scrollTop());
return t.left-=this._get(e,"isRTL")?r-s:0,t.left-=n&&t.left==e.input.offset().left?$(document).scrollLeft():0,t.top-=n&&t.top==e.input.offset().top+o?$(document).scrollTop():0,t.left-=Math.min(t.left,t.left+r>u&&u>r?Math.abs(t.left+r-u):0),t.top-=Math.min(t.top,t.top+i>a&&a>i?Math.abs(i+o):0),t;
},_findPos:function(e){var t=this._getInst(e),n=this._get(t,"isRTL");while(e&&(e.type=="hidden"||e.nodeType!=1||$.expr.filters.hidden(e))){e=e[n?"previousSibling":"nextSibling"];
}var r=$(e).offset();return[r.left,r.top];},_hideDatepicker:function(e){var t=this._curInst;if(!t||e&&t!=$.data(e,PROP_NAME)){return;
}if(this._datepickerShowing){var n=this._get(t,"showAnim"),r=this._get(t,"duration"),i=function(){$.datepicker._tidyDialog(t);
};$.effects&&($.effects.effect[n]||$.effects[n])?t.dpDiv.hide(n,$.datepicker._get(t,"showOptions"),r,i):t.dpDiv[n=="slideDown"?"slideUp":n=="fadeIn"?"fadeOut":"hide"](n?r:null,i),n||i(),this._datepickerShowing=!1;
var s=this._get(t,"onClose");s&&s.apply(t.input?t.input[0]:null,[t.input?t.input.val():"",t]),this._lastInput=null,this._inDialog&&(this._dialogInput.css({position:"absolute",left:"0",top:"-100px"}),$.blockUI&&($.unblockUI(),$("body").append(this.dpDiv))),this._inDialog=!1;
}},_tidyDialog:function(e){e.dpDiv.removeClass(this._dialogClass).unbind(".ui-datepicker-calendar");},_checkExternalClick:function(e){if(!$.datepicker._curInst){return;
}var t=$(e.target),n=$.datepicker._getInst(t[0]);(t[0].id!=$.datepicker._mainDivId&&t.parents("#"+$.datepicker._mainDivId).length==0&&!t.hasClass($.datepicker.markerClassName)&&!t.closest("."+$.datepicker._triggerClass).length&&$.datepicker._datepickerShowing&&(!$.datepicker._inDialog||!$.blockUI)||t.hasClass($.datepicker.markerClassName)&&$.datepicker._curInst!=n)&&$.datepicker._hideDatepicker();
},_adjustDate:function(e,t,n){var r=$(e),i=this._getInst(r[0]);if(this._isDisabledDatepicker(r[0])){return;
}this._adjustInstDate(i,t+(n=="M"?this._get(i,"showCurrentAtPos"):0),n),this._updateDatepicker(i);},_gotoToday:function(e){var t=$(e),n=this._getInst(t[0]);
if(this._get(n,"gotoCurrent")&&n.currentDay){n.selectedDay=n.currentDay,n.drawMonth=n.selectedMonth=n.currentMonth,n.drawYear=n.selectedYear=n.currentYear;
}else{var r=new Date;n.selectedDay=r.getDate(),n.drawMonth=n.selectedMonth=r.getMonth(),n.drawYear=n.selectedYear=r.getFullYear();
}this._notifyChange(n),this._adjustDate(t);},_selectMonthYear:function(e,t,n){var r=$(e),i=this._getInst(r[0]);
i["selected"+(n=="M"?"Month":"Year")]=i["draw"+(n=="M"?"Month":"Year")]=parseInt(t.options[t.selectedIndex].value,10),this._notifyChange(i),this._adjustDate(r);
},_selectDay:function(e,t,n,r){var i=$(e);if($(r).hasClass(this._unselectableClass)||this._isDisabledDatepicker(i[0])){return;
}var s=this._getInst(i[0]);s.selectedDay=s.currentDay=$("a",r).html(),s.selectedMonth=s.currentMonth=t,s.selectedYear=s.currentYear=n,this._selectDate(e,this._formatDate(s,s.currentDay,s.currentMonth,s.currentYear));
},_clearDate:function(e){var t=$(e),n=this._getInst(t[0]);this._selectDate(t,"");},_selectDate:function(e,t){var n=$(e),r=this._getInst(n[0]);
t=t!=null?t:this._formatDate(r),r.input&&r.input.val(t),this._updateAlternate(r);var i=this._get(r,"onSelect");
i?i.apply(r.input?r.input[0]:null,[t,r]):r.input&&r.input.trigger("change"),r.inline?this._updateDatepicker(r):(this._hideDatepicker(),this._lastInput=r.input[0],typeof r.input[0]!="object"&&r.input.focus(),this._lastInput=null);
},_updateAlternate:function(e){var t=this._get(e,"altField");if(t){var n=this._get(e,"altFormat")||this._get(e,"dateFormat"),r=this._getDate(e),i=this.formatDate(n,r,this._getFormatConfig(e));
$(t).each(function(){$(this).val(i);});}},noWeekends:function(e){var t=e.getDay();return[t>0&&t<6,""];
},iso8601Week:function(e){var t=new Date(e.getTime());t.setDate(t.getDate()+4-(t.getDay()||7));var n=t.getTime();
return t.setMonth(0),t.setDate(1),Math.floor(Math.round((n-t)/86400000)/7)+1;},parseDate:function(e,t,n){if(e==null||t==null){throw"Invalid arguments";
}t=typeof t=="object"?t.toString():t+"";if(t==""){return null;}var r=(n?n.shortYearCutoff:null)||this._defaults.shortYearCutoff;
r=typeof r!="string"?r:(new Date).getFullYear()%100+parseInt(r,10);var i=(n?n.dayNamesShort:null)||this._defaults.dayNamesShort,s=(n?n.dayNames:null)||this._defaults.dayNames,o=(n?n.monthNamesShort:null)||this._defaults.monthNamesShort,u=(n?n.monthNames:null)||this._defaults.monthNames,a=-1,f=-1,l=-1,c=-1,h=!1,p=function(t){var n=y+1<e.length&&e.charAt(y+1)==t;
return n&&y++,n;},d=function(e){var n=p(e),r=e=="@"?14:e=="!"?20:e=="y"&&n?4:e=="o"?3:2,i=new RegExp("^\\d{1,"+r+"}"),s=t.substring(g).match(i);
if(!s){throw"Missing number at position "+g;}return g+=s[0].length,parseInt(s[0],10);},v=function(e,n,r){var i=$.map(p(e)?r:n,function(e,t){return[[t,e]];
}).sort(function(e,t){return -(e[1].length-t[1].length);}),s=-1;$.each(i,function(e,n){var r=n[1];if(t.substr(g,r.length).toLowerCase()==r.toLowerCase()){return s=n[0],g+=r.length,!1;
}});if(s!=-1){return s+1;}throw"Unknown name at position "+g;},m=function(){if(t.charAt(g)!=e.charAt(y)){throw"Unexpected literal at position "+g;
}g++;},g=0;for(var y=0;y<e.length;y++){if(h){e.charAt(y)=="'"&&!p("'")?h=!1:m();}else{switch(e.charAt(y)){case"d":l=d("d");
break;case"D":v("D",i,s);break;case"o":c=d("o");break;case"m":f=d("m");break;case"M":f=v("M",o,u);break;
case"y":a=d("y");break;case"@":var b=new Date(d("@"));a=b.getFullYear(),f=b.getMonth()+1,l=b.getDate();
break;case"!":var b=new Date((d("!")-this._ticksTo1970)/10000);a=b.getFullYear(),f=b.getMonth()+1,l=b.getDate();
break;case"'":p("'")?m():h=!0;break;default:m();}}}if(g<t.length){var w=t.substr(g);if(!/^\s+/.test(w)){throw"Extra/unparsed characters found in date: "+w;
}}a==-1?a=(new Date).getFullYear():a<100&&(a+=(new Date).getFullYear()-(new Date).getFullYear()%100+(a<=r?0:-100));
if(c>-1){f=1,l=c;do{var E=this._getDaysInMonth(a,f-1);if(l<=E){break;}f++,l-=E;}while(!0);}var b=this._daylightSavingAdjust(new Date(a,f-1,l));
if(b.getFullYear()!=a||b.getMonth()+1!=f||b.getDate()!=l){throw"Invalid date";}return b;},ATOM:"yy-mm-dd",COOKIE:"D, dd M yy",ISO_8601:"yy-mm-dd",RFC_822:"D, d M y",RFC_850:"DD, dd-M-y",RFC_1036:"D, d M y",RFC_1123:"D, d M yy",RFC_2822:"D, d M yy",RSS:"D, d M y",TICKS:"!",TIMESTAMP:"@",W3C:"yy-mm-dd",_ticksTo1970:(718685+Math.floor(492.5)-Math.floor(19.7)+Math.floor(4.925))*24*60*60*10000000,formatDate:function(e,t,n){if(!t){return"";
}var r=(n?n.dayNamesShort:null)||this._defaults.dayNamesShort,i=(n?n.dayNames:null)||this._defaults.dayNames,s=(n?n.monthNamesShort:null)||this._defaults.monthNamesShort,o=(n?n.monthNames:null)||this._defaults.monthNames,u=function(t){var n=h+1<e.length&&e.charAt(h+1)==t;
return n&&h++,n;},a=function(e,t,n){var r=""+t;if(u(e)){while(r.length<n){r="0"+r;}}return r;},f=function(e,t,n,r){return u(e)?r[t]:n[t];
},l="",c=!1;if(t){for(var h=0;h<e.length;h++){if(c){e.charAt(h)=="'"&&!u("'")?c=!1:l+=e.charAt(h);}else{switch(e.charAt(h)){case"d":l+=a("d",t.getDate(),2);
break;case"D":l+=f("D",t.getDay(),r,i);break;case"o":l+=a("o",Math.round(((new Date(t.getFullYear(),t.getMonth(),t.getDate())).getTime()-(new Date(t.getFullYear(),0,0)).getTime())/86400000),3);
break;case"m":l+=a("m",t.getMonth()+1,2);break;case"M":l+=f("M",t.getMonth(),s,o);break;case"y":l+=u("y")?t.getFullYear():(t.getYear()%100<10?"0":"")+t.getYear()%100;
break;case"@":l+=t.getTime();break;case"!":l+=t.getTime()*10000+this._ticksTo1970;break;case"'":u("'")?l+="'":c=!0;
break;default:l+=e.charAt(h);}}}}return l;},_possibleChars:function(e){var t="",n=!1,r=function(t){var n=i+1<e.length&&e.charAt(i+1)==t;
return n&&i++,n;};for(var i=0;i<e.length;i++){if(n){e.charAt(i)=="'"&&!r("'")?n=!1:t+=e.charAt(i);}else{switch(e.charAt(i)){case"d":case"m":case"y":case"@":t+="0123456789";
break;case"D":case"M":return null;case"'":r("'")?t+="'":n=!0;break;default:t+=e.charAt(i);}}}return t;
},_get:function(e,t){return e.settings[t]!==undefined?e.settings[t]:this._defaults[t];},_setDateFromField:function(e,t){if(e.input.val()==e.lastVal){return;
}var n=this._get(e,"dateFormat"),r=e.lastVal=e.input?e.input.val():null,i,s;i=s=this._getDefaultDate(e);
var o=this._getFormatConfig(e);try{i=this.parseDate(n,r,o)||s;}catch(u){this.log(u),r=t?"":r;}e.selectedDay=i.getDate(),e.drawMonth=e.selectedMonth=i.getMonth(),e.drawYear=e.selectedYear=i.getFullYear(),e.currentDay=r?i.getDate():0,e.currentMonth=r?i.getMonth():0,e.currentYear=r?i.getFullYear():0,this._adjustInstDate(e);
},_getDefaultDate:function(e){return this._restrictMinMax(e,this._determineDate(e,this._get(e,"defaultDate"),new Date));
},_determineDate:function(e,t,n){var r=function(e){var t=new Date;return t.setDate(t.getDate()+e),t;},i=function(t){try{return $.datepicker.parseDate($.datepicker._get(e,"dateFormat"),t,$.datepicker._getFormatConfig(e));
}catch(n){}var r=(t.toLowerCase().match(/^c/)?$.datepicker._getDate(e):null)||new Date,i=r.getFullYear(),s=r.getMonth(),o=r.getDate(),u=/([+-]?[0-9]+)\s*(d|D|w|W|m|M|y|Y)?/g,a=u.exec(t);
while(a){switch(a[2]||"d"){case"d":case"D":o+=parseInt(a[1],10);break;case"w":case"W":o+=parseInt(a[1],10)*7;
break;case"m":case"M":s+=parseInt(a[1],10),o=Math.min(o,$.datepicker._getDaysInMonth(i,s));break;case"y":case"Y":i+=parseInt(a[1],10),o=Math.min(o,$.datepicker._getDaysInMonth(i,s));
}a=u.exec(t);}return new Date(i,s,o);},s=t==null||t===""?n:typeof t=="string"?i(t):typeof t=="number"?isNaN(t)?n:r(t):new Date(t.getTime());
return s=s&&s.toString()=="Invalid Date"?n:s,s&&(s.setHours(0),s.setMinutes(0),s.setSeconds(0),s.setMilliseconds(0)),this._daylightSavingAdjust(s);
},_daylightSavingAdjust:function(e){return e?(e.setHours(e.getHours()>12?e.getHours()+2:0),e):null;},_setDate:function(e,t,n){var r=!t,i=e.selectedMonth,s=e.selectedYear,o=this._restrictMinMax(e,this._determineDate(e,t,new Date));
e.selectedDay=e.currentDay=o.getDate(),e.drawMonth=e.selectedMonth=e.currentMonth=o.getMonth(),e.drawYear=e.selectedYear=e.currentYear=o.getFullYear(),(i!=e.selectedMonth||s!=e.selectedYear)&&!n&&this._notifyChange(e),this._adjustInstDate(e),e.input&&e.input.val(r?"":this._formatDate(e));
},_getDate:function(e){var t=!e.currentYear||e.input&&e.input.val()==""?null:this._daylightSavingAdjust(new Date(e.currentYear,e.currentMonth,e.currentDay));
return t;},_attachHandlers:function(e){var t=this._get(e,"stepMonths"),n="#"+e.id.replace(/\\\\/g,"\\");
e.dpDiv.find("[data-handler]").map(function(){var e={prev:function(){window["DP_jQuery_"+dpuuid].datepicker._adjustDate(n,-t,"M");
},next:function(){window["DP_jQuery_"+dpuuid].datepicker._adjustDate(n,+t,"M");},hide:function(){window["DP_jQuery_"+dpuuid].datepicker._hideDatepicker();
},today:function(){window["DP_jQuery_"+dpuuid].datepicker._gotoToday(n);},selectDay:function(){return window["DP_jQuery_"+dpuuid].datepicker._selectDay(n,+this.getAttribute("data-month"),+this.getAttribute("data-year"),this),!1;
},selectMonth:function(){return window["DP_jQuery_"+dpuuid].datepicker._selectMonthYear(n,this,"M"),!1;
},selectYear:function(){return window["DP_jQuery_"+dpuuid].datepicker._selectMonthYear(n,this,"Y"),!1;
}};$(this).bind(this.getAttribute("data-event"),e[this.getAttribute("data-handler")]);});},_generateHTML:function(e){var t=new Date;
t=this._daylightSavingAdjust(new Date(t.getFullYear(),t.getMonth(),t.getDate()));var n=this._get(e,"isRTL"),r=this._get(e,"showButtonPanel"),i=this._get(e,"hideIfNoPrevNext"),s=this._get(e,"navigationAsDateFormat"),o=this._getNumberOfMonths(e),u=this._get(e,"showCurrentAtPos"),a=this._get(e,"stepMonths"),f=o[0]!=1||o[1]!=1,l=this._daylightSavingAdjust(e.currentDay?new Date(e.currentYear,e.currentMonth,e.currentDay):new Date(9999,9,9)),c=this._getMinMaxDate(e,"min"),h=this._getMinMaxDate(e,"max"),p=e.drawMonth-u,d=e.drawYear;
p<0&&(p+=12,d--);if(h){var v=this._daylightSavingAdjust(new Date(h.getFullYear(),h.getMonth()-o[0]*o[1]+1,h.getDate()));
v=c&&v<c?c:v;while(this._daylightSavingAdjust(new Date(d,p,1))>v){p--,p<0&&(p=11,d--);}}e.drawMonth=p,e.drawYear=d;
var m=this._get(e,"prevText");m=s?this.formatDate(m,this._daylightSavingAdjust(new Date(d,p-a,1)),this._getFormatConfig(e)):m;
var g=this._canAdjustMonth(e,-1,d,p)?'<a class="ui-datepicker-prev ui-corner-all" data-handler="prev" data-event="click" title="'+m+'"><span class="ui-icon ui-icon-circle-triangle-'+(n?"e":"w")+'">'+m+"</span></a>":i?"":'<a class="ui-datepicker-prev ui-corner-all ui-state-disabled" title="'+m+'"><span class="ui-icon ui-icon-circle-triangle-'+(n?"e":"w")+'">'+m+"</span></a>",y=this._get(e,"nextText");
y=s?this.formatDate(y,this._daylightSavingAdjust(new Date(d,p+a,1)),this._getFormatConfig(e)):y;var b=this._canAdjustMonth(e,1,d,p)?'<a class="ui-datepicker-next ui-corner-all" data-handler="next" data-event="click" title="'+y+'"><span class="ui-icon ui-icon-circle-triangle-'+(n?"w":"e")+'">'+y+"</span></a>":i?"":'<a class="ui-datepicker-next ui-corner-all ui-state-disabled" title="'+y+'"><span class="ui-icon ui-icon-circle-triangle-'+(n?"w":"e")+'">'+y+"</span></a>",w=this._get(e,"currentText"),E=this._get(e,"gotoCurrent")&&e.currentDay?l:t;
w=s?this.formatDate(w,E,this._getFormatConfig(e)):w;var S=e.inline?"":'<button type="button" class="ui-datepicker-close ui-state-default ui-priority-primary ui-corner-all" data-handler="hide" data-event="click">'+this._get(e,"closeText")+"</button>",x=r?'<div class="ui-datepicker-buttonpane ui-widget-content">'+(n?S:"")+(this._isInRange(e,E)?'<button type="button" class="ui-datepicker-current ui-state-default ui-priority-secondary ui-corner-all" data-handler="today" data-event="click">'+w+"</button>":"")+(n?"":S)+"</div>":"",T=parseInt(this._get(e,"firstDay"),10);
T=isNaN(T)?0:T;var N=this._get(e,"showWeek"),C=this._get(e,"dayNames"),k=this._get(e,"dayNamesShort"),L=this._get(e,"dayNamesMin"),A=this._get(e,"monthNames"),O=this._get(e,"monthNamesShort"),M=this._get(e,"beforeShowDay"),_=this._get(e,"showOtherMonths"),D=this._get(e,"selectOtherMonths"),P=this._get(e,"calculateWeek")||this.iso8601Week,H=this._getDefaultDate(e),B="";
for(var j=0;j<o[0];j++){var F="";this.maxRows=4;for(var I=0;I<o[1];I++){var q=this._daylightSavingAdjust(new Date(d,p,e.selectedDay)),R=" ui-corner-all",U="";
if(f){U+='<div class="ui-datepicker-group';if(o[1]>1){switch(I){case 0:U+=" ui-datepicker-group-first",R=" ui-corner-"+(n?"right":"left");
break;case o[1]-1:U+=" ui-datepicker-group-last",R=" ui-corner-"+(n?"left":"right");break;default:U+=" ui-datepicker-group-middle",R="";
}}U+='">';}U+='<div class="ui-datepicker-header ui-widget-header ui-helper-clearfix'+R+'">'+(/all|left/.test(R)&&j==0?n?b:g:"")+(/all|right/.test(R)&&j==0?n?g:b:"")+this._generateMonthYearHeader(e,p,d,c,h,j>0||I>0,A,O)+'</div><table class="ui-datepicker-calendar"><thead><tr>';
var z=N?'<th class="ui-datepicker-week-col">'+this._get(e,"weekHeader")+"</th>":"";for(var W=0;W<7;W++){var X=(W+T)%7;
z+="<th"+((W+T+6)%7>=5?' class="ui-datepicker-week-end"':"")+'><span title="'+C[X]+'">'+L[X]+"</span></th>";
}U+=z+"</tr></thead><tbody>";var V=this._getDaysInMonth(d,p);d==e.selectedYear&&p==e.selectedMonth&&(e.selectedDay=Math.min(e.selectedDay,V));
var J=(this._getFirstDayOfMonth(d,p)-T+7)%7,K=Math.ceil((J+V)/7),Q=f?this.maxRows>K?this.maxRows:K:K;
this.maxRows=Q;var G=this._daylightSavingAdjust(new Date(d,p,1-J));for(var Y=0;Y<Q;Y++){U+="<tr>";var Z=N?'<td class="ui-datepicker-week-col">'+this._get(e,"calculateWeek")(G)+"</td>":"";
for(var W=0;W<7;W++){var et=M?M.apply(e.input?e.input[0]:null,[G]):[!0,""],tt=G.getMonth()!=p,nt=tt&&!D||!et[0]||c&&G<c||h&&G>h;
Z+='<td class="'+((W+T+6)%7>=5?" ui-datepicker-week-end":"")+(tt?" ui-datepicker-other-month":"")+(G.getTime()==q.getTime()&&p==e.selectedMonth&&e._keyEvent||H.getTime()==G.getTime()&&H.getTime()==q.getTime()?" "+this._dayOverClass:"")+(nt?" "+this._unselectableClass+" ui-state-disabled":"")+(tt&&!_?"":" "+et[1]+(G.getTime()==l.getTime()?" "+this._currentClass:"")+(G.getTime()==t.getTime()?" ui-datepicker-today":""))+'"'+((!tt||_)&&et[2]?' title="'+et[2]+'"':"")+(nt?"":' data-handler="selectDay" data-event="click" data-month="'+G.getMonth()+'" data-year="'+G.getFullYear()+'"')+">"+(tt&&!_?"&#xa0;":nt?'<span class="ui-state-default">'+G.getDate()+"</span>":'<a class="ui-state-default'+(G.getTime()==t.getTime()?" ui-state-highlight":"")+(G.getTime()==l.getTime()?" ui-state-active":"")+(tt?" ui-priority-secondary":"")+'" href="#">'+G.getDate()+"</a>")+"</td>",G.setDate(G.getDate()+1),G=this._daylightSavingAdjust(G);
}U+=Z+"</tr>";}p++,p>11&&(p=0,d++),U+="</tbody></table>"+(f?"</div>"+(o[0]>0&&I==o[1]-1?'<div class="ui-datepicker-row-break"></div>':""):""),F+=U;
}B+=F;}return B+=x+($.ui.ie6&&!e.inline?'<iframe src="javascript:false;" class="ui-datepicker-cover" frameborder="0"></iframe>':""),e._keyEvent=!1,B;
},_generateMonthYearHeader:function(e,t,n,r,i,s,o,u){var a=this._get(e,"changeMonth"),f=this._get(e,"changeYear"),l=this._get(e,"showMonthAfterYear"),c='<div class="ui-datepicker-title">',h="";
if(s||!a){h+='<span class="ui-datepicker-month">'+o[t]+"</span>";}else{var p=r&&r.getFullYear()==n,d=i&&i.getFullYear()==n;
h+='<select class="ui-datepicker-month" data-handler="selectMonth" data-event="change">';for(var v=0;
v<12;v++){(!p||v>=r.getMonth())&&(!d||v<=i.getMonth())&&(h+='<option value="'+v+'"'+(v==t?' selected="selected"':"")+">"+u[v]+"</option>");
}h+="</select>";}l||(c+=h+(s||!a||!f?"&#xa0;":""));if(!e.yearshtml){e.yearshtml="";if(s||!f){c+='<span class="ui-datepicker-year">'+n+"</span>";
}else{var m=this._get(e,"yearRange").split(":"),g=(new Date).getFullYear(),y=function(e){var t=e.match(/c[+-].*/)?n+parseInt(e.substring(1),10):e.match(/[+-].*/)?g+parseInt(e,10):parseInt(e,10);
return isNaN(t)?g:t;},b=y(m[0]),w=Math.max(b,y(m[1]||""));b=r?Math.max(b,r.getFullYear()):b,w=i?Math.min(w,i.getFullYear()):w,e.yearshtml+='<select class="ui-datepicker-year" data-handler="selectYear" data-event="change">';
for(;b<=w;b++){e.yearshtml+='<option value="'+b+'"'+(b==n?' selected="selected"':"")+">"+b+"</option>";
}e.yearshtml+="</select>",c+=e.yearshtml,e.yearshtml=null;}}return c+=this._get(e,"yearSuffix"),l&&(c+=(s||!a||!f?"&#xa0;":"")+h),c+="</div>",c;
},_adjustInstDate:function(e,t,n){var r=e.drawYear+(n=="Y"?t:0),i=e.drawMonth+(n=="M"?t:0),s=Math.min(e.selectedDay,this._getDaysInMonth(r,i))+(n=="D"?t:0),o=this._restrictMinMax(e,this._daylightSavingAdjust(new Date(r,i,s)));
e.selectedDay=o.getDate(),e.drawMonth=e.selectedMonth=o.getMonth(),e.drawYear=e.selectedYear=o.getFullYear(),(n=="M"||n=="Y")&&this._notifyChange(e);
},_restrictMinMax:function(e,t){var n=this._getMinMaxDate(e,"min"),r=this._getMinMaxDate(e,"max"),i=n&&t<n?n:t;
return i=r&&i>r?r:i,i;},_notifyChange:function(e){var t=this._get(e,"onChangeMonthYear");t&&t.apply(e.input?e.input[0]:null,[e.selectedYear,e.selectedMonth+1,e]);
},_getNumberOfMonths:function(e){var t=this._get(e,"numberOfMonths");return t==null?[1,1]:typeof t=="number"?[1,t]:t;
},_getMinMaxDate:function(e,t){return this._determineDate(e,this._get(e,t+"Date"),null);},_getDaysInMonth:function(e,t){return 32-this._daylightSavingAdjust(new Date(e,t,32)).getDate();
},_getFirstDayOfMonth:function(e,t){return(new Date(e,t,1)).getDay();},_canAdjustMonth:function(e,t,n,r){var i=this._getNumberOfMonths(e),s=this._daylightSavingAdjust(new Date(n,r+(t<0?t:i[0]*i[1]),1));
return t<0&&s.setDate(this._getDaysInMonth(s.getFullYear(),s.getMonth())),this._isInRange(e,s);},_isInRange:function(e,t){var n=this._getMinMaxDate(e,"min"),r=this._getMinMaxDate(e,"max");
return(!n||t.getTime()>=n.getTime())&&(!r||t.getTime()<=r.getTime());},_getFormatConfig:function(e){var t=this._get(e,"shortYearCutoff");
return t=typeof t!="string"?t:(new Date).getFullYear()%100+parseInt(t,10),{shortYearCutoff:t,dayNamesShort:this._get(e,"dayNamesShort"),dayNames:this._get(e,"dayNames"),monthNamesShort:this._get(e,"monthNamesShort"),monthNames:this._get(e,"monthNames")};
},_formatDate:function(e,t,n,r){t||(e.currentDay=e.selectedDay,e.currentMonth=e.selectedMonth,e.currentYear=e.selectedYear);
var i=t?typeof t=="object"?t:this._daylightSavingAdjust(new Date(r,n,t)):this._daylightSavingAdjust(new Date(e.currentYear,e.currentMonth,e.currentDay));
return this.formatDate(this._get(e,"dateFormat"),i,this._getFormatConfig(e));}}),$.fn.datepicker=function(e){if(!this.length){return this;
}$.datepicker.initialized||($(document).mousedown($.datepicker._checkExternalClick).find(document.body).append($.datepicker.dpDiv),$.datepicker.initialized=!0);
var t=Array.prototype.slice.call(arguments,1);return typeof e!="string"||e!="isDisabled"&&e!="getDate"&&e!="widget"?e=="option"&&arguments.length==2&&typeof arguments[1]=="string"?$.datepicker["_"+e+"Datepicker"].apply($.datepicker,[this[0]].concat(t)):this.each(function(){typeof e=="string"?$.datepicker["_"+e+"Datepicker"].apply($.datepicker,[this].concat(t)):$.datepicker._attachDatepicker(this,e);
}):$.datepicker["_"+e+"Datepicker"].apply($.datepicker,[this[0]].concat(t));},$.datepicker=new Datepicker,$.datepicker.initialized=!1,$.datepicker.uuid=(new Date).getTime(),$.datepicker.version="1.9.2",window["DP_jQuery_"+dpuuid]=$;
})(jQuery);(function(e,t){var n="ui-dialog ui-widget ui-widget-content ui-corner-all ",r={buttons:!0,height:!0,maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0,width:!0},i={maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0};
e.widget("ui.dialog",{version:"1.9.2",options:{autoOpen:!0,buttons:{},closeOnEscape:!0,closeText:"close",dialogClass:"",draggable:!0,hide:null,height:"auto",maxHeight:!1,maxWidth:!1,minHeight:150,minWidth:150,modal:!1,position:{my:"center",at:"center",of:window,collision:"fit",using:function(t){var n=e(this).css(t).offset().top;
n<0&&e(this).css("top",t.top-n);}},resizable:!0,show:null,stack:!0,title:"",width:300,zIndex:1000},_create:function(){this.originalTitle=this.element.attr("title"),typeof this.originalTitle!="string"&&(this.originalTitle=""),this.oldPosition={parent:this.element.parent(),index:this.element.parent().children().index(this.element)},this.options.title=this.options.title||this.originalTitle;
var t=this,r=this.options,i=r.title||"",s,o,u,a,f;s=(this.uiDialog=e("<div>")).addClass(n+r.dialogClass).css({display:"none",outline:0,zIndex:r.zIndex}).attr("tabIndex",-1).keydown(function(n){r.closeOnEscape&&!n.isDefaultPrevented()&&n.keyCode&&n.keyCode===e.ui.keyCode.ESCAPE&&(t.close(n),n.preventDefault());
}).mousedown(function(e){t.moveToTop(!1,e);}).appendTo("body"),this.element.show().removeAttr("title").addClass("ui-dialog-content ui-widget-content").appendTo(s),o=(this.uiDialogTitlebar=e("<div>")).addClass("ui-dialog-titlebar  ui-widget-header  ui-corner-all  ui-helper-clearfix").bind("mousedown",function(){s.focus();
}).prependTo(s),u=e("<a href='#'></a>").addClass("ui-dialog-titlebar-close  ui-corner-all").attr("role","button").click(function(e){e.preventDefault(),t.close(e);
}).appendTo(o),(this.uiDialogTitlebarCloseText=e("<span>")).addClass("ui-icon ui-icon-closethick").text(r.closeText).appendTo(u),a=e("<span>").uniqueId().addClass("ui-dialog-title").text(i).prependTo(o),f=(this.uiDialogButtonPane=e("<div>")).addClass("ui-dialog-buttonpane ui-widget-content ui-helper-clearfix"),(this.uiButtonSet=e("<div>")).addClass("ui-dialog-buttonset").appendTo(f),s.attr({role:"dialog","aria-labelledby":a.attr("id")}),o.find("*").add(o).disableSelection(),this._hoverable(u),this._focusable(u),r.draggable&&e.fn.draggable&&this._makeDraggable(),r.resizable&&e.fn.resizable&&this._makeResizable(),this._createButtons(r.buttons),this._isOpen=!1,e.fn.bgiframe&&s.bgiframe(),this._on(s,{keydown:function(t){if(!r.modal||t.keyCode!==e.ui.keyCode.TAB){return;
}var n=e(":tabbable",s),i=n.filter(":first"),o=n.filter(":last");if(t.target===o[0]&&!t.shiftKey){return i.focus(1),!1;
}if(t.target===i[0]&&t.shiftKey){return o.focus(1),!1;}}});},_init:function(){this.options.autoOpen&&this.open();
},_destroy:function(){var e,t=this.oldPosition;this.overlay&&this.overlay.destroy(),this.uiDialog.hide(),this.element.removeClass("ui-dialog-content ui-widget-content").hide().appendTo("body"),this.uiDialog.remove(),this.originalTitle&&this.element.attr("title",this.originalTitle),e=t.parent.children().eq(t.index),e.length&&e[0]!==this.element[0]?e.before(this.element):t.parent.append(this.element);
},widget:function(){return this.uiDialog;},close:function(t){var n=this,r,i;if(!this._isOpen){return;
}if(!1===this._trigger("beforeClose",t)){return;}return this._isOpen=!1,this.overlay&&this.overlay.destroy(),this.options.hide?this._hide(this.uiDialog,this.options.hide,function(){n._trigger("close",t);
}):(this.uiDialog.hide(),this._trigger("close",t)),e.ui.dialog.overlay.resize(),this.options.modal&&(r=0,e(".ui-dialog").each(function(){this!==n.uiDialog[0]&&(i=e(this).css("z-index"),isNaN(i)||(r=Math.max(r,i)));
}),e.ui.dialog.maxZ=r),this;},isOpen:function(){return this._isOpen;},moveToTop:function(t,n){var r=this.options,i;
return r.modal&&!t||!r.stack&&!r.modal?this._trigger("focus",n):(r.zIndex>e.ui.dialog.maxZ&&(e.ui.dialog.maxZ=r.zIndex),this.overlay&&(e.ui.dialog.maxZ+=1,e.ui.dialog.overlay.maxZ=e.ui.dialog.maxZ,this.overlay.$el.css("z-index",e.ui.dialog.overlay.maxZ)),i={scrollTop:this.element.scrollTop(),scrollLeft:this.element.scrollLeft()},e.ui.dialog.maxZ+=1,this.uiDialog.css("z-index",e.ui.dialog.maxZ),this.element.attr(i),this._trigger("focus",n),this);
},open:function(){if(this._isOpen){return;}var t,n=this.options,r=this.uiDialog;return this._size(),this._position(n.position),r.show(n.show),this.overlay=n.modal?new e.ui.dialog.overlay(this):null,this.moveToTop(!0),t=this.element.find(":tabbable"),t.length||(t=this.uiDialogButtonPane.find(":tabbable"),t.length||(t=r)),t.eq(0).focus(),this._isOpen=!0,this._trigger("open"),this;
},_createButtons:function(t){var n=this,r=!1;this.uiDialogButtonPane.remove(),this.uiButtonSet.empty(),typeof t=="object"&&t!==null&&e.each(t,function(){return !(r=!0);
}),r?(e.each(t,function(t,r){var i,s;r=e.isFunction(r)?{click:r,text:t}:r,r=e.extend({type:"button"},r),s=r.click,r.click=function(){s.apply(n.element[0],arguments);
},i=e("<button></button>",r).appendTo(n.uiButtonSet),e.fn.button&&i.button();}),this.uiDialog.addClass("ui-dialog-buttons"),this.uiDialogButtonPane.appendTo(this.uiDialog)):this.uiDialog.removeClass("ui-dialog-buttons");
},_makeDraggable:function(){function r(e){return{position:e.position,offset:e.offset};}var t=this,n=this.options;
this.uiDialog.draggable({cancel:".ui-dialog-content, .ui-dialog-titlebar-close",handle:".ui-dialog-titlebar",containment:"document",start:function(n,i){e(this).addClass("ui-dialog-dragging"),t._trigger("dragStart",n,r(i));
},drag:function(e,n){t._trigger("drag",e,r(n));},stop:function(i,s){n.position=[s.position.left-t.document.scrollLeft(),s.position.top-t.document.scrollTop()],e(this).removeClass("ui-dialog-dragging"),t._trigger("dragStop",i,r(s)),e.ui.dialog.overlay.resize();
}});},_makeResizable:function(n){function u(e){return{originalPosition:e.originalPosition,originalSize:e.originalSize,position:e.position,size:e.size};
}n=n===t?this.options.resizable:n;var r=this,i=this.options,s=this.uiDialog.css("position"),o=typeof n=="string"?n:"n,e,s,w,se,sw,ne,nw";
this.uiDialog.resizable({cancel:".ui-dialog-content",containment:"document",alsoResize:this.element,maxWidth:i.maxWidth,maxHeight:i.maxHeight,minWidth:i.minWidth,minHeight:this._minHeight(),handles:o,start:function(t,n){e(this).addClass("ui-dialog-resizing"),r._trigger("resizeStart",t,u(n));
},resize:function(e,t){r._trigger("resize",e,u(t));},stop:function(t,n){e(this).removeClass("ui-dialog-resizing"),i.height=e(this).height(),i.width=e(this).width(),r._trigger("resizeStop",t,u(n)),e.ui.dialog.overlay.resize();
}}).css("position",s).find(".ui-resizable-se").addClass("ui-icon ui-icon-grip-diagonal-se");},_minHeight:function(){var e=this.options;
return e.height==="auto"?e.minHeight:Math.min(e.minHeight,e.height);},_position:function(t){var n=[],r=[0,0],i;
if(t){if(typeof t=="string"||typeof t=="object"&&"0" in t){n=t.split?t.split(" "):[t[0],t[1]],n.length===1&&(n[1]=n[0]),e.each(["left","top"],function(e,t){+n[e]===n[e]&&(r[e]=n[e],n[e]=t);
}),t={my:n[0]+(r[0]<0?r[0]:"+"+r[0])+" "+n[1]+(r[1]<0?r[1]:"+"+r[1]),at:n.join(" ")};}t=e.extend({},e.ui.dialog.prototype.options.position,t);
}else{t=e.ui.dialog.prototype.options.position;}i=this.uiDialog.is(":visible"),i||this.uiDialog.show(),this.uiDialog.position(t),i||this.uiDialog.hide();
},_setOptions:function(t){var n=this,s={},o=!1;e.each(t,function(e,t){n._setOption(e,t),e in r&&(o=!0),e in i&&(s[e]=t);
}),o&&this._size(),this.uiDialog.is(":data(resizable)")&&this.uiDialog.resizable("option",s);},_setOption:function(t,r){var i,s,o=this.uiDialog;
switch(t){case"buttons":this._createButtons(r);break;case"closeText":this.uiDialogTitlebarCloseText.text(""+r);
break;case"dialogClass":o.removeClass(this.options.dialogClass).addClass(n+r);break;case"disabled":r?o.addClass("ui-dialog-disabled"):o.removeClass("ui-dialog-disabled");
break;case"draggable":i=o.is(":data(draggable)"),i&&!r&&o.draggable("destroy"),!i&&r&&this._makeDraggable();
break;case"position":this._position(r);break;case"resizable":s=o.is(":data(resizable)"),s&&!r&&o.resizable("destroy"),s&&typeof r=="string"&&o.resizable("option","handles",r),!s&&r!==!1&&this._makeResizable(r);
break;case"title":e(".ui-dialog-title",this.uiDialogTitlebar).text(""+(r||""));}this._super(t,r);},_size:function(){var t,n,r,i=this.options,s=this.uiDialog.is(":visible");
this.element.show().css({width:"auto",minHeight:0,height:0}),i.minWidth>i.width&&(i.width=i.minWidth),t=this.uiDialog.css({height:"auto",width:i.width}).outerHeight(),n=Math.max(0,i.minHeight-t),i.height==="auto"?e.support.minHeight?this.element.css({minHeight:n,height:"auto"}):(this.uiDialog.show(),r=this.element.css("height","auto").height(),s||this.uiDialog.hide(),this.element.height(Math.max(r,n))):this.element.height(Math.max(i.height-t,0)),this.uiDialog.is(":data(resizable)")&&this.uiDialog.resizable("option","minHeight",this._minHeight());
}}),e.extend(e.ui.dialog,{uuid:0,maxZ:0,getTitleId:function(e){var t=e.attr("id");return t||(this.uuid+=1,t=this.uuid),"ui-dialog-title-"+t;
},overlay:function(t){this.$el=e.ui.dialog.overlay.create(t);}}),e.extend(e.ui.dialog.overlay,{instances:[],oldInstances:[],maxZ:0,events:e.map("focus,mousedown,mouseup,keydown,keypress,click".split(","),function(e){return e+".dialog-overlay";
}).join(" "),create:function(t){this.instances.length===0&&(setTimeout(function(){e.ui.dialog.overlay.instances.length&&e(document).bind(e.ui.dialog.overlay.events,function(t){if(e(t.target).zIndex()<e.ui.dialog.overlay.maxZ){return !1;
}});},1),e(window).bind("resize.dialog-overlay",e.ui.dialog.overlay.resize));var n=this.oldInstances.pop()||e("<div>").addClass("ui-widget-overlay");
return e(document).bind("keydown.dialog-overlay",function(r){var i=e.ui.dialog.overlay.instances;i.length!==0&&i[i.length-1]===n&&t.options.closeOnEscape&&!r.isDefaultPrevented()&&r.keyCode&&r.keyCode===e.ui.keyCode.ESCAPE&&(t.close(r),r.preventDefault());
}),n.appendTo(document.body).css({width:this.width(),height:this.height()}),e.fn.bgiframe&&n.bgiframe(),this.instances.push(n),n;
},destroy:function(t){var n=e.inArray(t,this.instances),r=0;n!==-1&&this.oldInstances.push(this.instances.splice(n,1)[0]),this.instances.length===0&&e([document,window]).unbind(".dialog-overlay"),t.height(0).width(0).remove(),e.each(this.instances,function(){r=Math.max(r,this.css("z-index"));
}),this.maxZ=r;},height:function(){var t,n;return e.ui.ie?(t=Math.max(document.documentElement.scrollHeight,document.body.scrollHeight),n=Math.max(document.documentElement.offsetHeight,document.body.offsetHeight),t<n?e(window).height()+"px":t+"px"):e(document).height()+"px";
},width:function(){var t,n;return e.ui.ie?(t=Math.max(document.documentElement.scrollWidth,document.body.scrollWidth),n=Math.max(document.documentElement.offsetWidth,document.body.offsetWidth),t<n?e(window).width()+"px":t+"px"):e(document).width()+"px";
},resize:function(){var t=e([]);e.each(e.ui.dialog.overlay.instances,function(){t=t.add(this);}),t.css({width:0,height:0}).css({width:e.ui.dialog.overlay.width(),height:e.ui.dialog.overlay.height()});
}}),e.extend(e.ui.dialog.overlay.prototype,{destroy:function(){e.ui.dialog.overlay.destroy(this.$el);
}});})(jQuery);(function(e,t){var n=!1;e.widget("ui.menu",{version:"1.9.2",defaultElement:"<ul>",delay:300,options:{icons:{submenu:"ui-icon-carat-1-e"},menus:"ul",position:{my:"left top",at:"right top"},role:"menu",blur:null,focus:null,select:null},_create:function(){this.activeMenu=this.element,this.element.uniqueId().addClass("ui-menu ui-widget ui-widget-content ui-corner-all").toggleClass("ui-menu-icons",!!this.element.find(".ui-icon").length).attr({role:this.options.role,tabIndex:0}).bind("click"+this.eventNamespace,e.proxy(function(e){this.options.disabled&&e.preventDefault();
},this)),this.options.disabled&&this.element.addClass("ui-state-disabled").attr("aria-disabled","true"),this._on({"mousedown .ui-menu-item > a":function(e){e.preventDefault();
},"click .ui-state-disabled > a":function(e){e.preventDefault();},"click .ui-menu-item:has(a)":function(t){var r=e(t.target).closest(".ui-menu-item");
!n&&r.not(".ui-state-disabled").length&&(n=!0,this.select(t),r.has(".ui-menu").length?this.expand(t):this.element.is(":focus")||(this.element.trigger("focus",[!0]),this.active&&this.active.parents(".ui-menu").length===1&&clearTimeout(this.timer)));
},"mouseenter .ui-menu-item":function(t){var n=e(t.currentTarget);n.siblings().children(".ui-state-active").removeClass("ui-state-active"),this.focus(t,n);
},mouseleave:"collapseAll","mouseleave .ui-menu":"collapseAll",focus:function(e,t){var n=this.active||this.element.children(".ui-menu-item").eq(0);
t||this.focus(e,n);},blur:function(t){this._delay(function(){e.contains(this.element[0],this.document[0].activeElement)||this.collapseAll(t);
});},keydown:"_keydown"}),this.refresh(),this._on(this.document,{click:function(t){e(t.target).closest(".ui-menu").length||this.collapseAll(t),n=!1;
}});},_destroy:function(){this.element.removeAttr("aria-activedescendant").find(".ui-menu").andSelf().removeClass("ui-menu ui-widget ui-widget-content ui-corner-all ui-menu-icons").removeAttr("role").removeAttr("tabIndex").removeAttr("aria-labelledby").removeAttr("aria-expanded").removeAttr("aria-hidden").removeAttr("aria-disabled").removeUniqueId().show(),this.element.find(".ui-menu-item").removeClass("ui-menu-item").removeAttr("role").removeAttr("aria-disabled").children("a").removeUniqueId().removeClass("ui-corner-all ui-state-hover").removeAttr("tabIndex").removeAttr("role").removeAttr("aria-haspopup").children().each(function(){var t=e(this);
t.data("ui-menu-submenu-carat")&&t.remove();}),this.element.find(".ui-menu-divider").removeClass("ui-menu-divider ui-widget-content");
},_keydown:function(t){function a(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&");}var n,r,i,s,o,u=!0;
switch(t.keyCode){case e.ui.keyCode.PAGE_UP:this.previousPage(t);break;case e.ui.keyCode.PAGE_DOWN:this.nextPage(t);
break;case e.ui.keyCode.HOME:this._move("first","first",t);break;case e.ui.keyCode.END:this._move("last","last",t);
break;case e.ui.keyCode.UP:this.previous(t);break;case e.ui.keyCode.DOWN:this.next(t);break;case e.ui.keyCode.LEFT:this.collapse(t);
break;case e.ui.keyCode.RIGHT:this.active&&!this.active.is(".ui-state-disabled")&&this.expand(t);break;
case e.ui.keyCode.ENTER:case e.ui.keyCode.SPACE:this._activate(t);break;case e.ui.keyCode.ESCAPE:this.collapse(t);
break;default:u=!1,r=this.previousFilter||"",i=String.fromCharCode(t.keyCode),s=!1,clearTimeout(this.filterTimer),i===r?s=!0:i=r+i,o=new RegExp("^"+a(i),"i"),n=this.activeMenu.children(".ui-menu-item").filter(function(){return o.test(e(this).children("a").text());
}),n=s&&n.index(this.active.next())!==-1?this.active.nextAll(".ui-menu-item"):n,n.length||(i=String.fromCharCode(t.keyCode),o=new RegExp("^"+a(i),"i"),n=this.activeMenu.children(".ui-menu-item").filter(function(){return o.test(e(this).children("a").text());
})),n.length?(this.focus(t,n),n.length>1?(this.previousFilter=i,this.filterTimer=this._delay(function(){delete this.previousFilter;
},1000)):delete this.previousFilter):delete this.previousFilter;}u&&t.preventDefault();},_activate:function(e){this.active.is(".ui-state-disabled")||(this.active.children("a[aria-haspopup='true']").length?this.expand(e):this.select(e));
},refresh:function(){var t,n=this.options.icons.submenu,r=this.element.find(this.options.menus);r.filter(":not(.ui-menu)").addClass("ui-menu ui-widget ui-widget-content ui-corner-all").hide().attr({role:this.options.role,"aria-hidden":"true","aria-expanded":"false"}).each(function(){var t=e(this),r=t.prev("a"),i=e("<span>").addClass("ui-menu-icon ui-icon "+n).data("ui-menu-submenu-carat",!0);
r.attr("aria-haspopup","true").prepend(i),t.attr("aria-labelledby",r.attr("id"));}),t=r.add(this.element),t.children(":not(.ui-menu-item):has(a)").addClass("ui-menu-item").attr("role","presentation").children("a").uniqueId().addClass("ui-corner-all").attr({tabIndex:-1,role:this._itemRole()}),t.children(":not(.ui-menu-item)").each(function(){var t=e(this);
/[^\-\s]/.test(t.text())||t.addClass("ui-widget-content ui-menu-divider");}),t.children(".ui-state-disabled").attr("aria-disabled","true"),this.active&&!e.contains(this.element[0],this.active[0])&&this.blur();
},_itemRole:function(){return{menu:"menuitem",listbox:"option"}[this.options.role];},focus:function(e,t){var n,r;
this.blur(e,e&&e.type==="focus"),this._scrollIntoView(t),this.active=t.first(),r=this.active.children("a").addClass("ui-state-focus"),this.options.role&&this.element.attr("aria-activedescendant",r.attr("id")),this.active.parent().closest(".ui-menu-item").children("a:first").addClass("ui-state-active"),e&&e.type==="keydown"?this._close():this.timer=this._delay(function(){this._close();
},this.delay),n=t.children(".ui-menu"),n.length&&/^mouse/.test(e.type)&&this._startOpening(n),this.activeMenu=t.parent(),this._trigger("focus",e,{item:t});
},_scrollIntoView:function(t){var n,r,i,s,o,u;this._hasScroll()&&(n=parseFloat(e.css(this.activeMenu[0],"borderTopWidth"))||0,r=parseFloat(e.css(this.activeMenu[0],"paddingTop"))||0,i=t.offset().top-this.activeMenu.offset().top-n-r,s=this.activeMenu.scrollTop(),o=this.activeMenu.height(),u=t.height(),i<0?this.activeMenu.scrollTop(s+i):i+u>o&&this.activeMenu.scrollTop(s+i-o+u));
},blur:function(e,t){t||clearTimeout(this.timer);if(!this.active){return;}this.active.children("a").removeClass("ui-state-focus"),this.active=null,this._trigger("blur",e,{item:this.active});
},_startOpening:function(e){clearTimeout(this.timer);if(e.attr("aria-hidden")!=="true"){return;}this.timer=this._delay(function(){this._close(),this._open(e);
},this.delay);},_open:function(t){var n=e.extend({of:this.active},this.options.position);clearTimeout(this.timer),this.element.find(".ui-menu").not(t.parents(".ui-menu")).hide().attr("aria-hidden","true"),t.show().removeAttr("aria-hidden").attr("aria-expanded","true").position(n);
},collapseAll:function(t,n){clearTimeout(this.timer),this.timer=this._delay(function(){var r=n?this.element:e(t&&t.target).closest(this.element.find(".ui-menu"));
r.length||(r=this.element),this._close(r),this.blur(t),this.activeMenu=r;},this.delay);},_close:function(e){e||(e=this.active?this.active.parent():this.element),e.find(".ui-menu").hide().attr("aria-hidden","true").attr("aria-expanded","false").end().find("a.ui-state-active").removeClass("ui-state-active");
},collapse:function(e){var t=this.active&&this.active.parent().closest(".ui-menu-item",this.element);
t&&t.length&&(this._close(),this.focus(e,t));},expand:function(e){var t=this.active&&this.active.children(".ui-menu ").children(".ui-menu-item").first();
t&&t.length&&(this._open(t.parent()),this._delay(function(){this.focus(e,t);}));},next:function(e){this._move("next","first",e);
},previous:function(e){this._move("prev","last",e);},isFirstItem:function(){return this.active&&!this.active.prevAll(".ui-menu-item").length;
},isLastItem:function(){return this.active&&!this.active.nextAll(".ui-menu-item").length;},_move:function(e,t,n){var r;
this.active&&(e==="first"||e==="last"?r=this.active[e==="first"?"prevAll":"nextAll"](".ui-menu-item").eq(-1):r=this.active[e+"All"](".ui-menu-item").eq(0));
if(!r||!r.length||!this.active){r=this.activeMenu.children(".ui-menu-item")[t]();}this.focus(n,r);},nextPage:function(t){var n,r,i;
if(!this.active){this.next(t);return;}if(this.isLastItem()){return;}this._hasScroll()?(r=this.active.offset().top,i=this.element.height(),this.active.nextAll(".ui-menu-item").each(function(){return n=e(this),n.offset().top-r-i<0;
}),this.focus(t,n)):this.focus(t,this.activeMenu.children(".ui-menu-item")[this.active?"last":"first"]());
},previousPage:function(t){var n,r,i;if(!this.active){this.next(t);return;}if(this.isFirstItem()){return;
}this._hasScroll()?(r=this.active.offset().top,i=this.element.height(),this.active.prevAll(".ui-menu-item").each(function(){return n=e(this),n.offset().top-r+i>0;
}),this.focus(t,n)):this.focus(t,this.activeMenu.children(".ui-menu-item").first());},_hasScroll:function(){return this.element.outerHeight()<this.element.prop("scrollHeight");
},select:function(t){this.active=this.active||e(t.target).closest(".ui-menu-item");var n={item:this.active};
this.active.has(".ui-menu").length||this.collapseAll(t,!0),this._trigger("select",t,n);}});})(jQuery);
(function(e,t){e.widget("ui.progressbar",{version:"1.9.2",options:{value:0,max:100},min:0,_create:function(){this.element.addClass("ui-progressbar ui-widget ui-widget-content ui-corner-all").attr({role:"progressbar","aria-valuemin":this.min,"aria-valuemax":this.options.max,"aria-valuenow":this._value()}),this.valueDiv=e("<div class='ui-progressbar-value ui-widget-header ui-corner-left'></div>").appendTo(this.element),this.oldValue=this._value(),this._refreshValue();
},_destroy:function(){this.element.removeClass("ui-progressbar ui-widget ui-widget-content ui-corner-all").removeAttr("role").removeAttr("aria-valuemin").removeAttr("aria-valuemax").removeAttr("aria-valuenow"),this.valueDiv.remove();
},value:function(e){return e===t?this._value():(this._setOption("value",e),this);},_setOption:function(e,t){e==="value"&&(this.options.value=t,this._refreshValue(),this._value()===this.options.max&&this._trigger("complete")),this._super(e,t);
},_value:function(){var e=this.options.value;return typeof e!="number"&&(e=0),Math.min(this.options.max,Math.max(this.min,e));
},_percentage:function(){return 100*this._value()/this.options.max;},_refreshValue:function(){var e=this.value(),t=this._percentage();
this.oldValue!==e&&(this.oldValue=e,this._trigger("change")),this.valueDiv.toggle(e>this.min).toggleClass("ui-corner-right",e===this.options.max).width(t.toFixed(0)+"%"),this.element.attr("aria-valuenow",e);
}});})(jQuery);(function(e,t){var n=5;e.widget("ui.slider",e.ui.mouse,{version:"1.9.2",widgetEventPrefix:"slide",options:{animate:!1,distance:0,max:100,min:0,orientation:"horizontal",range:!1,step:1,value:0,values:null},_create:function(){var t,r,i=this.options,s=this.element.find(".ui-slider-handle").addClass("ui-state-default ui-corner-all"),o="<a class='ui-slider-handle ui-state-default ui-corner-all' href='#'></a>",u=[];
this._keySliding=!1,this._mouseSliding=!1,this._animateOff=!0,this._handleIndex=null,this._detectOrientation(),this._mouseInit(),this.element.addClass("ui-slider ui-slider-"+this.orientation+" ui-widget ui-widget-content ui-corner-all"+(i.disabled?" ui-slider-disabled ui-disabled":"")),this.range=e([]),i.range&&(i.range===!0&&(i.values||(i.values=[this._valueMin(),this._valueMin()]),i.values.length&&i.values.length!==2&&(i.values=[i.values[0],i.values[0]])),this.range=e("<div></div>").appendTo(this.element).addClass("ui-slider-range ui-widget-header"+(i.range==="min"||i.range==="max"?" ui-slider-range-"+i.range:""))),r=i.values&&i.values.length||1;
for(t=s.length;t<r;t++){u.push(o);}this.handles=s.add(e(u.join("")).appendTo(this.element)),this.handle=this.handles.eq(0),this.handles.add(this.range).filter("a").click(function(e){e.preventDefault();
}).mouseenter(function(){i.disabled||e(this).addClass("ui-state-hover");}).mouseleave(function(){e(this).removeClass("ui-state-hover");
}).focus(function(){i.disabled?e(this).blur():(e(".ui-slider .ui-state-focus").removeClass("ui-state-focus"),e(this).addClass("ui-state-focus"));
}).blur(function(){e(this).removeClass("ui-state-focus");}),this.handles.each(function(t){e(this).data("ui-slider-handle-index",t);
}),this._on(this.handles,{keydown:function(t){var r,i,s,o,u=e(t.target).data("ui-slider-handle-index");
switch(t.keyCode){case e.ui.keyCode.HOME:case e.ui.keyCode.END:case e.ui.keyCode.PAGE_UP:case e.ui.keyCode.PAGE_DOWN:case e.ui.keyCode.UP:case e.ui.keyCode.RIGHT:case e.ui.keyCode.DOWN:case e.ui.keyCode.LEFT:t.preventDefault();
if(!this._keySliding){this._keySliding=!0,e(t.target).addClass("ui-state-active"),r=this._start(t,u);
if(r===!1){return;}}}o=this.options.step,this.options.values&&this.options.values.length?i=s=this.values(u):i=s=this.value();
switch(t.keyCode){case e.ui.keyCode.HOME:s=this._valueMin();break;case e.ui.keyCode.END:s=this._valueMax();
break;case e.ui.keyCode.PAGE_UP:s=this._trimAlignValue(i+(this._valueMax()-this._valueMin())/n);break;
case e.ui.keyCode.PAGE_DOWN:s=this._trimAlignValue(i-(this._valueMax()-this._valueMin())/n);break;case e.ui.keyCode.UP:case e.ui.keyCode.RIGHT:if(i===this._valueMax()){return;
}s=this._trimAlignValue(i+o);break;case e.ui.keyCode.DOWN:case e.ui.keyCode.LEFT:if(i===this._valueMin()){return;
}s=this._trimAlignValue(i-o);}this._slide(t,u,s);},keyup:function(t){var n=e(t.target).data("ui-slider-handle-index");
this._keySliding&&(this._keySliding=!1,this._stop(t,n),this._change(t,n),e(t.target).removeClass("ui-state-active"));
}}),this._refreshValue(),this._animateOff=!1;},_destroy:function(){this.handles.remove(),this.range.remove(),this.element.removeClass("ui-slider ui-slider-horizontal ui-slider-vertical ui-slider-disabled ui-widget ui-widget-content ui-corner-all"),this._mouseDestroy();
},_mouseCapture:function(t){var n,r,i,s,o,u,a,f,l=this,c=this.options;return c.disabled?!1:(this.elementSize={width:this.element.outerWidth(),height:this.element.outerHeight()},this.elementOffset=this.element.offset(),n={x:t.pageX,y:t.pageY},r=this._normValueFromMouse(n),i=this._valueMax()-this._valueMin()+1,this.handles.each(function(t){var n=Math.abs(r-l.values(t));
i>n&&(i=n,s=e(this),o=t);}),c.range===!0&&this.values(1)===c.min&&(o+=1,s=e(this.handles[o])),u=this._start(t,o),u===!1?!1:(this._mouseSliding=!0,this._handleIndex=o,s.addClass("ui-state-active").focus(),a=s.offset(),f=!e(t.target).parents().andSelf().is(".ui-slider-handle"),this._clickOffset=f?{left:0,top:0}:{left:t.pageX-a.left-s.width()/2,top:t.pageY-a.top-s.height()/2-(parseInt(s.css("borderTopWidth"),10)||0)-(parseInt(s.css("borderBottomWidth"),10)||0)+(parseInt(s.css("marginTop"),10)||0)},this.handles.hasClass("ui-state-hover")||this._slide(t,o,r),this._animateOff=!0,!0));
},_mouseStart:function(){return !0;},_mouseDrag:function(e){var t={x:e.pageX,y:e.pageY},n=this._normValueFromMouse(t);
return this._slide(e,this._handleIndex,n),!1;},_mouseStop:function(e){return this.handles.removeClass("ui-state-active"),this._mouseSliding=!1,this._stop(e,this._handleIndex),this._change(e,this._handleIndex),this._handleIndex=null,this._clickOffset=null,this._animateOff=!1,!1;
},_detectOrientation:function(){this.orientation=this.options.orientation==="vertical"?"vertical":"horizontal";
},_normValueFromMouse:function(e){var t,n,r,i,s;return this.orientation==="horizontal"?(t=this.elementSize.width,n=e.x-this.elementOffset.left-(this._clickOffset?this._clickOffset.left:0)):(t=this.elementSize.height,n=e.y-this.elementOffset.top-(this._clickOffset?this._clickOffset.top:0)),r=n/t,r>1&&(r=1),r<0&&(r=0),this.orientation==="vertical"&&(r=1-r),i=this._valueMax()-this._valueMin(),s=this._valueMin()+r*i,this._trimAlignValue(s);
},_start:function(e,t){var n={handle:this.handles[t],value:this.value()};return this.options.values&&this.options.values.length&&(n.value=this.values(t),n.values=this.values()),this._trigger("start",e,n);
},_slide:function(e,t,n){var r,i,s;this.options.values&&this.options.values.length?(r=this.values(t?0:1),this.options.values.length===2&&this.options.range===!0&&(t===0&&n>r||t===1&&n<r)&&(n=r),n!==this.values(t)&&(i=this.values(),i[t]=n,s=this._trigger("slide",e,{handle:this.handles[t],value:n,values:i}),r=this.values(t?0:1),s!==!1&&this.values(t,n,!0))):n!==this.value()&&(s=this._trigger("slide",e,{handle:this.handles[t],value:n}),s!==!1&&this.value(n));
},_stop:function(e,t){var n={handle:this.handles[t],value:this.value()};this.options.values&&this.options.values.length&&(n.value=this.values(t),n.values=this.values()),this._trigger("stop",e,n);
},_change:function(e,t){if(!this._keySliding&&!this._mouseSliding){var n={handle:this.handles[t],value:this.value()};
this.options.values&&this.options.values.length&&(n.value=this.values(t),n.values=this.values()),this._trigger("change",e,n);
}},value:function(e){if(arguments.length){this.options.value=this._trimAlignValue(e),this._refreshValue(),this._change(null,0);
return;}return this._value();},values:function(t,n){var r,i,s;if(arguments.length>1){this.options.values[t]=this._trimAlignValue(n),this._refreshValue(),this._change(null,t);
return;}if(!arguments.length){return this._values();}if(!e.isArray(arguments[0])){return this.options.values&&this.options.values.length?this._values(t):this.value();
}r=this.options.values,i=arguments[0];for(s=0;s<r.length;s+=1){r[s]=this._trimAlignValue(i[s]),this._change(null,s);
}this._refreshValue();},_setOption:function(t,n){var r,i=0;e.isArray(this.options.values)&&(i=this.options.values.length),e.Widget.prototype._setOption.apply(this,arguments);
switch(t){case"disabled":n?(this.handles.filter(".ui-state-focus").blur(),this.handles.removeClass("ui-state-hover"),this.handles.prop("disabled",!0),this.element.addClass("ui-disabled")):(this.handles.prop("disabled",!1),this.element.removeClass("ui-disabled"));
break;case"orientation":this._detectOrientation(),this.element.removeClass("ui-slider-horizontal ui-slider-vertical").addClass("ui-slider-"+this.orientation),this._refreshValue();
break;case"value":this._animateOff=!0,this._refreshValue(),this._change(null,0),this._animateOff=!1;break;
case"values":this._animateOff=!0,this._refreshValue();for(r=0;r<i;r+=1){this._change(null,r);}this._animateOff=!1;
break;case"min":case"max":this._animateOff=!0,this._refreshValue(),this._animateOff=!1;}},_value:function(){var e=this.options.value;
return e=this._trimAlignValue(e),e;},_values:function(e){var t,n,r;if(arguments.length){return t=this.options.values[e],t=this._trimAlignValue(t),t;
}n=this.options.values.slice();for(r=0;r<n.length;r+=1){n[r]=this._trimAlignValue(n[r]);}return n;},_trimAlignValue:function(e){if(e<=this._valueMin()){return this._valueMin();
}if(e>=this._valueMax()){return this._valueMax();}var t=this.options.step>0?this.options.step:1,n=(e-this._valueMin())%t,r=e-n;
return Math.abs(n)*2>=t&&(r+=n>0?t:-t),parseFloat(r.toFixed(5));},_valueMin:function(){return this.options.min;
},_valueMax:function(){return this.options.max;},_refreshValue:function(){var t,n,r,i,s,o=this.options.range,u=this.options,a=this,f=this._animateOff?!1:u.animate,l={};
this.options.values&&this.options.values.length?this.handles.each(function(r){n=(a.values(r)-a._valueMin())/(a._valueMax()-a._valueMin())*100,l[a.orientation==="horizontal"?"left":"bottom"]=n+"%",e(this).stop(1,1)[f?"animate":"css"](l,u.animate),a.options.range===!0&&(a.orientation==="horizontal"?(r===0&&a.range.stop(1,1)[f?"animate":"css"]({left:n+"%"},u.animate),r===1&&a.range[f?"animate":"css"]({width:n-t+"%"},{queue:!1,duration:u.animate})):(r===0&&a.range.stop(1,1)[f?"animate":"css"]({bottom:n+"%"},u.animate),r===1&&a.range[f?"animate":"css"]({height:n-t+"%"},{queue:!1,duration:u.animate}))),t=n;
}):(r=this.value(),i=this._valueMin(),s=this._valueMax(),n=s!==i?(r-i)/(s-i)*100:0,l[this.orientation==="horizontal"?"left":"bottom"]=n+"%",this.handle.stop(1,1)[f?"animate":"css"](l,u.animate),o==="min"&&this.orientation==="horizontal"&&this.range.stop(1,1)[f?"animate":"css"]({width:n+"%"},u.animate),o==="max"&&this.orientation==="horizontal"&&this.range[f?"animate":"css"]({width:100-n+"%"},{queue:!1,duration:u.animate}),o==="min"&&this.orientation==="vertical"&&this.range.stop(1,1)[f?"animate":"css"]({height:n+"%"},u.animate),o==="max"&&this.orientation==="vertical"&&this.range[f?"animate":"css"]({height:100-n+"%"},{queue:!1,duration:u.animate}));
}});})(jQuery);(function(e){function t(e){return function(){var t=this.element.val();e.apply(this,arguments),this._refresh(),t!==this.element.val()&&this._trigger("change");
};}e.widget("ui.spinner",{version:"1.9.2",defaultElement:"<input>",widgetEventPrefix:"spin",options:{culture:null,icons:{down:"ui-icon-triangle-1-s",up:"ui-icon-triangle-1-n"},incremental:!0,max:null,min:null,numberFormat:null,page:10,step:1,change:null,spin:null,start:null,stop:null},_create:function(){this._setOption("max",this.options.max),this._setOption("min",this.options.min),this._setOption("step",this.options.step),this._value(this.element.val(),!0),this._draw(),this._on(this._events),this._refresh(),this._on(this.window,{beforeunload:function(){this.element.removeAttr("autocomplete");
}});},_getCreateOptions:function(){var t={},n=this.element;return e.each(["min","max","step"],function(e,r){var i=n.attr(r);
i!==undefined&&i.length&&(t[r]=i);}),t;},_events:{keydown:function(e){this._start(e)&&this._keydown(e)&&e.preventDefault();
},keyup:"_stop",focus:function(){this.previous=this.element.val();},blur:function(e){if(this.cancelBlur){delete this.cancelBlur;
return;}this._refresh(),this.previous!==this.element.val()&&this._trigger("change",e);},mousewheel:function(e,t){if(!t){return;
}if(!this.spinning&&!this._start(e)){return !1;}this._spin((t>0?1:-1)*this.options.step,e),clearTimeout(this.mousewheelTimer),this.mousewheelTimer=this._delay(function(){this.spinning&&this._stop(e);
},100),e.preventDefault();},"mousedown .ui-spinner-button":function(t){function r(){var e=this.element[0]===this.document[0].activeElement;
e||(this.element.focus(),this.previous=n,this._delay(function(){this.previous=n;}));}var n;n=this.element[0]===this.document[0].activeElement?this.previous:this.element.val(),t.preventDefault(),r.call(this),this.cancelBlur=!0,this._delay(function(){delete this.cancelBlur,r.call(this);
});if(this._start(t)===!1){return;}this._repeat(null,e(t.currentTarget).hasClass("ui-spinner-up")?1:-1,t);
},"mouseup .ui-spinner-button":"_stop","mouseenter .ui-spinner-button":function(t){if(!e(t.currentTarget).hasClass("ui-state-active")){return;
}if(this._start(t)===!1){return !1;}this._repeat(null,e(t.currentTarget).hasClass("ui-spinner-up")?1:-1,t);
},"mouseleave .ui-spinner-button":"_stop"},_draw:function(){var e=this.uiSpinner=this.element.addClass("ui-spinner-input").attr("autocomplete","off").wrap(this._uiSpinnerHtml()).parent().append(this._buttonHtml());
this.element.attr("role","spinbutton"),this.buttons=e.find(".ui-spinner-button").attr("tabIndex",-1).button().removeClass("ui-corner-all"),this.buttons.height()>Math.ceil(e.height()*0.5)&&e.height()>0&&e.height(e.height()),this.options.disabled&&this.disable();
},_keydown:function(t){var n=this.options,r=e.ui.keyCode;switch(t.keyCode){case r.UP:return this._repeat(null,1,t),!0;
case r.DOWN:return this._repeat(null,-1,t),!0;case r.PAGE_UP:return this._repeat(null,n.page,t),!0;case r.PAGE_DOWN:return this._repeat(null,-n.page,t),!0;
}return !1;},_uiSpinnerHtml:function(){return"<span class='ui-spinner ui-widget ui-widget-content ui-corner-all'></span>";
},_buttonHtml:function(){return"<a class='ui-spinner-button ui-spinner-up ui-corner-tr'><span class='ui-icon "+this.options.icons.up+"'>&#9650;</span></a><a class='ui-spinner-button ui-spinner-down ui-corner-br'><span class='ui-icon "+this.options.icons.down+"'>&#9660;</span></a>";
},_start:function(e){return !this.spinning&&this._trigger("start",e)===!1?!1:(this.counter||(this.counter=1),this.spinning=!0,!0);
},_repeat:function(e,t,n){e=e||500,clearTimeout(this.timer),this.timer=this._delay(function(){this._repeat(40,t,n);
},e),this._spin(t*this.options.step,n);},_spin:function(e,t){var n=this.value()||0;this.counter||(this.counter=1),n=this._adjustValue(n+e*this._increment(this.counter));
if(!this.spinning||this._trigger("spin",t,{value:n})!==!1){this._value(n),this.counter++;}},_increment:function(t){var n=this.options.incremental;
return n?e.isFunction(n)?n(t):Math.floor(t*t*t/50000-t*t/500+17*t/200+1):1;},_precision:function(){var e=this._precisionOf(this.options.step);
return this.options.min!==null&&(e=Math.max(e,this._precisionOf(this.options.min))),e;},_precisionOf:function(e){var t=e.toString(),n=t.indexOf(".");
return n===-1?0:t.length-n-1;},_adjustValue:function(e){var t,n,r=this.options;return t=r.min!==null?r.min:0,n=e-t,n=Math.round(n/r.step)*r.step,e=t+n,e=parseFloat(e.toFixed(this._precision())),r.max!==null&&e>r.max?r.max:r.min!==null&&e<r.min?r.min:e;
},_stop:function(e){if(!this.spinning){return;}clearTimeout(this.timer),clearTimeout(this.mousewheelTimer),this.counter=0,this.spinning=!1,this._trigger("stop",e);
},_setOption:function(e,t){if(e==="culture"||e==="numberFormat"){var n=this._parse(this.element.val());
this.options[e]=t,this.element.val(this._format(n));return;}(e==="max"||e==="min"||e==="step")&&typeof t=="string"&&(t=this._parse(t)),this._super(e,t),e==="disabled"&&(t?(this.element.prop("disabled",!0),this.buttons.button("disable")):(this.element.prop("disabled",!1),this.buttons.button("enable")));
},_setOptions:t(function(e){this._super(e),this._value(this.element.val());}),_parse:function(e){return typeof e=="string"&&e!==""&&(e=window.Globalize&&this.options.numberFormat?Globalize.parseFloat(e,10,this.options.culture):+e),e===""||isNaN(e)?null:e;
},_format:function(e){return e===""?"":window.Globalize&&this.options.numberFormat?Globalize.format(e,this.options.numberFormat,this.options.culture):e;
},_refresh:function(){this.element.attr({"aria-valuemin":this.options.min,"aria-valuemax":this.options.max,"aria-valuenow":this._parse(this.element.val())});
},_value:function(e,t){var n;e!==""&&(n=this._parse(e),n!==null&&(t||(n=this._adjustValue(n)),e=this._format(n))),this.element.val(e),this._refresh();
},_destroy:function(){this.element.removeClass("ui-spinner-input").prop("disabled",!1).removeAttr("autocomplete").removeAttr("role").removeAttr("aria-valuemin").removeAttr("aria-valuemax").removeAttr("aria-valuenow"),this.uiSpinner.replaceWith(this.element);
},stepUp:t(function(e){this._stepUp(e);}),_stepUp:function(e){this._spin((e||1)*this.options.step);},stepDown:t(function(e){this._stepDown(e);
}),_stepDown:function(e){this._spin((e||1)*-this.options.step);},pageUp:t(function(e){this._stepUp((e||1)*this.options.page);
}),pageDown:t(function(e){this._stepDown((e||1)*this.options.page);}),value:function(e){if(!arguments.length){return this._parse(this.element.val());
}t(this._value).call(this,e);},widget:function(){return this.uiSpinner;}});})(jQuery);(function(e,t){function i(){return ++n;
}function s(e){return e.hash.length>1&&e.href.replace(r,"")===location.href.replace(r,"").replace(/\s/g,"%20");
}var n=0,r=/#.*$/;e.widget("ui.tabs",{version:"1.9.2",delay:300,options:{active:null,collapsible:!1,event:"click",heightStyle:"content",hide:null,show:null,activate:null,beforeActivate:null,beforeLoad:null,load:null},_create:function(){var t=this,n=this.options,r=n.active,i=location.hash.substring(1);
this.running=!1,this.element.addClass("ui-tabs ui-widget ui-widget-content ui-corner-all").toggleClass("ui-tabs-collapsible",n.collapsible).delegate(".ui-tabs-nav > li","mousedown"+this.eventNamespace,function(t){e(this).is(".ui-state-disabled")&&t.preventDefault();
}).delegate(".ui-tabs-anchor","focus"+this.eventNamespace,function(){e(this).closest("li").is(".ui-state-disabled")&&this.blur();
}),this._processTabs();if(r===null){i&&this.tabs.each(function(t,n){if(e(n).attr("aria-controls")===i){return r=t,!1;
}}),r===null&&(r=this.tabs.index(this.tabs.filter(".ui-tabs-active")));if(r===null||r===-1){r=this.tabs.length?0:!1;
}}r!==!1&&(r=this.tabs.index(this.tabs.eq(r)),r===-1&&(r=n.collapsible?!1:0)),n.active=r,!n.collapsible&&n.active===!1&&this.anchors.length&&(n.active=0),e.isArray(n.disabled)&&(n.disabled=e.unique(n.disabled.concat(e.map(this.tabs.filter(".ui-state-disabled"),function(e){return t.tabs.index(e);
}))).sort()),this.options.active!==!1&&this.anchors.length?this.active=this._findActive(this.options.active):this.active=e(),this._refresh(),this.active.length&&this.load(n.active);
},_getCreateEventData:function(){return{tab:this.active,panel:this.active.length?this._getPanelForTab(this.active):e()};
},_tabKeydown:function(t){var n=e(this.document[0].activeElement).closest("li"),r=this.tabs.index(n),i=!0;
if(this._handlePageNav(t)){return;}switch(t.keyCode){case e.ui.keyCode.RIGHT:case e.ui.keyCode.DOWN:r++;
break;case e.ui.keyCode.UP:case e.ui.keyCode.LEFT:i=!1,r--;break;case e.ui.keyCode.END:r=this.anchors.length-1;
break;case e.ui.keyCode.HOME:r=0;break;case e.ui.keyCode.SPACE:t.preventDefault(),clearTimeout(this.activating),this._activate(r);
return;case e.ui.keyCode.ENTER:t.preventDefault(),clearTimeout(this.activating),this._activate(r===this.options.active?!1:r);
return;default:return;}t.preventDefault(),clearTimeout(this.activating),r=this._focusNextTab(r,i),t.ctrlKey||(n.attr("aria-selected","false"),this.tabs.eq(r).attr("aria-selected","true"),this.activating=this._delay(function(){this.option("active",r);
},this.delay));},_panelKeydown:function(t){if(this._handlePageNav(t)){return;}t.ctrlKey&&t.keyCode===e.ui.keyCode.UP&&(t.preventDefault(),this.active.focus());
},_handlePageNav:function(t){if(t.altKey&&t.keyCode===e.ui.keyCode.PAGE_UP){return this._activate(this._focusNextTab(this.options.active-1,!1)),!0;
}if(t.altKey&&t.keyCode===e.ui.keyCode.PAGE_DOWN){return this._activate(this._focusNextTab(this.options.active+1,!0)),!0;
}},_findNextTab:function(t,n){function i(){return t>r&&(t=0),t<0&&(t=r),t;}var r=this.tabs.length-1;while(e.inArray(i(),this.options.disabled)!==-1){t=n?t+1:t-1;
}return t;},_focusNextTab:function(e,t){return e=this._findNextTab(e,t),this.tabs.eq(e).focus(),e;},_setOption:function(e,t){if(e==="active"){this._activate(t);
return;}if(e==="disabled"){this._setupDisabled(t);return;}this._super(e,t),e==="collapsible"&&(this.element.toggleClass("ui-tabs-collapsible",t),!t&&this.options.active===!1&&this._activate(0)),e==="event"&&this._setupEvents(t),e==="heightStyle"&&this._setupHeightStyle(t);
},_tabId:function(e){return e.attr("aria-controls")||"ui-tabs-"+i();},_sanitizeSelector:function(e){return e?e.replace(/[!"$%&'()*+,.\/:;<=>?@\[\]\^`{|}~]/g,"\\$&"):"";
},refresh:function(){var t=this.options,n=this.tablist.children(":has(a[href])");t.disabled=e.map(n.filter(".ui-state-disabled"),function(e){return n.index(e);
}),this._processTabs(),t.active===!1||!this.anchors.length?(t.active=!1,this.active=e()):this.active.length&&!e.contains(this.tablist[0],this.active[0])?this.tabs.length===t.disabled.length?(t.active=!1,this.active=e()):this._activate(this._findNextTab(Math.max(0,t.active-1),!1)):t.active=this.tabs.index(this.active),this._refresh();
},_refresh:function(){this._setupDisabled(this.options.disabled),this._setupEvents(this.options.event),this._setupHeightStyle(this.options.heightStyle),this.tabs.not(this.active).attr({"aria-selected":"false",tabIndex:-1}),this.panels.not(this._getPanelForTab(this.active)).hide().attr({"aria-expanded":"false","aria-hidden":"true"}),this.active.length?(this.active.addClass("ui-tabs-active ui-state-active").attr({"aria-selected":"true",tabIndex:0}),this._getPanelForTab(this.active).show().attr({"aria-expanded":"true","aria-hidden":"false"})):this.tabs.eq(0).attr("tabIndex",0);
},_processTabs:function(){var t=this;this.tablist=this._getList().addClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all").attr("role","tablist"),this.tabs=this.tablist.find("> li:has(a[href])").addClass("ui-state-default ui-corner-top").attr({role:"tab",tabIndex:-1}),this.anchors=this.tabs.map(function(){return e("a",this)[0];
}).addClass("ui-tabs-anchor").attr({role:"presentation",tabIndex:-1}),this.panels=e(),this.anchors.each(function(n,r){var i,o,u,a=e(r).uniqueId().attr("id"),f=e(r).closest("li"),l=f.attr("aria-controls");
s(r)?(i=r.hash,o=t.element.find(t._sanitizeSelector(i))):(u=t._tabId(f),i="#"+u,o=t.element.find(i),o.length||(o=t._createPanel(u),o.insertAfter(t.panels[n-1]||t.tablist)),o.attr("aria-live","polite")),o.length&&(t.panels=t.panels.add(o)),l&&f.data("ui-tabs-aria-controls",l),f.attr({"aria-controls":i.substring(1),"aria-labelledby":a}),o.attr("aria-labelledby",a);
}),this.panels.addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").attr("role","tabpanel");},_getList:function(){return this.element.find("ol,ul").eq(0);
},_createPanel:function(t){return e("<div>").attr("id",t).addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").data("ui-tabs-destroy",!0);
},_setupDisabled:function(t){e.isArray(t)&&(t.length?t.length===this.anchors.length&&(t=!0):t=!1);for(var n=0,r;
r=this.tabs[n];n++){t===!0||e.inArray(n,t)!==-1?e(r).addClass("ui-state-disabled").attr("aria-disabled","true"):e(r).removeClass("ui-state-disabled").removeAttr("aria-disabled");
}this.options.disabled=t;},_setupEvents:function(t){var n={click:function(e){e.preventDefault();}};t&&e.each(t.split(" "),function(e,t){n[t]="_eventHandler";
}),this._off(this.anchors.add(this.tabs).add(this.panels)),this._on(this.anchors,n),this._on(this.tabs,{keydown:"_tabKeydown"}),this._on(this.panels,{keydown:"_panelKeydown"}),this._focusable(this.tabs),this._hoverable(this.tabs);
},_setupHeightStyle:function(t){var n,r,i=this.element.parent();t==="fill"?(e.support.minHeight||(r=i.css("overflow"),i.css("overflow","hidden")),n=i.height(),this.element.siblings(":visible").each(function(){var t=e(this),r=t.css("position");
if(r==="absolute"||r==="fixed"){return;}n-=t.outerHeight(!0);}),r&&i.css("overflow",r),this.element.children().not(this.panels).each(function(){n-=e(this).outerHeight(!0);
}),this.panels.each(function(){e(this).height(Math.max(0,n-e(this).innerHeight()+e(this).height()));}).css("overflow","auto")):t==="auto"&&(n=0,this.panels.each(function(){n=Math.max(n,e(this).height("").height());
}).height(n));},_eventHandler:function(t){var n=this.options,r=this.active,i=e(t.currentTarget),s=i.closest("li"),o=s[0]===r[0],u=o&&n.collapsible,a=u?e():this._getPanelForTab(s),f=r.length?this._getPanelForTab(r):e(),l={oldTab:r,oldPanel:f,newTab:u?e():s,newPanel:a};
t.preventDefault();if(s.hasClass("ui-state-disabled")||s.hasClass("ui-tabs-loading")||this.running||o&&!n.collapsible||this._trigger("beforeActivate",t,l)===!1){return;
}n.active=u?!1:this.tabs.index(s),this.active=o?e():s,this.xhr&&this.xhr.abort(),!f.length&&!a.length&&e.error("jQuery UI Tabs: Mismatching fragment identifier."),a.length&&this.load(this.tabs.index(s),t),this._toggle(t,l);
},_toggle:function(t,n){function o(){r.running=!1,r._trigger("activate",t,n);}function u(){n.newTab.closest("li").addClass("ui-tabs-active ui-state-active"),i.length&&r.options.show?r._show(i,r.options.show,o):(i.show(),o());
}var r=this,i=n.newPanel,s=n.oldPanel;this.running=!0,s.length&&this.options.hide?this._hide(s,this.options.hide,function(){n.oldTab.closest("li").removeClass("ui-tabs-active ui-state-active"),u();
}):(n.oldTab.closest("li").removeClass("ui-tabs-active ui-state-active"),s.hide(),u()),s.attr({"aria-expanded":"false","aria-hidden":"true"}),n.oldTab.attr("aria-selected","false"),i.length&&s.length?n.oldTab.attr("tabIndex",-1):i.length&&this.tabs.filter(function(){return e(this).attr("tabIndex")===0;
}).attr("tabIndex",-1),i.attr({"aria-expanded":"true","aria-hidden":"false"}),n.newTab.attr({"aria-selected":"true",tabIndex:0});
},_activate:function(t){var n,r=this._findActive(t);if(r[0]===this.active[0]){return;}r.length||(r=this.active),n=r.find(".ui-tabs-anchor")[0],this._eventHandler({target:n,currentTarget:n,preventDefault:e.noop});
},_findActive:function(t){return t===!1?e():this.tabs.eq(t);},_getIndex:function(e){return typeof e=="string"&&(e=this.anchors.index(this.anchors.filter("[href$='"+e+"']"))),e;
},_destroy:function(){this.xhr&&this.xhr.abort(),this.element.removeClass("ui-tabs ui-widget ui-widget-content ui-corner-all ui-tabs-collapsible"),this.tablist.removeClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all").removeAttr("role"),this.anchors.removeClass("ui-tabs-anchor").removeAttr("role").removeAttr("tabIndex").removeData("href.tabs").removeData("load.tabs").removeUniqueId(),this.tabs.add(this.panels).each(function(){e.data(this,"ui-tabs-destroy")?e(this).remove():e(this).removeClass("ui-state-default ui-state-active ui-state-disabled ui-corner-top ui-corner-bottom ui-widget-content ui-tabs-active ui-tabs-panel").removeAttr("tabIndex").removeAttr("aria-live").removeAttr("aria-busy").removeAttr("aria-selected").removeAttr("aria-labelledby").removeAttr("aria-hidden").removeAttr("aria-expanded").removeAttr("role");
}),this.tabs.each(function(){var t=e(this),n=t.data("ui-tabs-aria-controls");n?t.attr("aria-controls",n):t.removeAttr("aria-controls");
}),this.panels.show(),this.options.heightStyle!=="content"&&this.panels.css("height","");},enable:function(n){var r=this.options.disabled;
if(r===!1){return;}n===t?r=!1:(n=this._getIndex(n),e.isArray(r)?r=e.map(r,function(e){return e!==n?e:null;
}):r=e.map(this.tabs,function(e,t){return t!==n?t:null;})),this._setupDisabled(r);},disable:function(n){var r=this.options.disabled;
if(r===!0){return;}if(n===t){r=!0;}else{n=this._getIndex(n);if(e.inArray(n,r)!==-1){return;}e.isArray(r)?r=e.merge([n],r).sort():r=[n];
}this._setupDisabled(r);},load:function(t,n){t=this._getIndex(t);var r=this,i=this.tabs.eq(t),o=i.find(".ui-tabs-anchor"),u=this._getPanelForTab(i),a={tab:i,panel:u};
if(s(o[0])){return;}this.xhr=e.ajax(this._ajaxSettings(o,n,a)),this.xhr&&this.xhr.statusText!=="canceled"&&(i.addClass("ui-tabs-loading"),u.attr("aria-busy","true"),this.xhr.success(function(e){setTimeout(function(){u.html(e),r._trigger("load",n,a);
},1);}).complete(function(e,t){setTimeout(function(){t==="abort"&&r.panels.stop(!1,!0),i.removeClass("ui-tabs-loading"),u.removeAttr("aria-busy"),e===r.xhr&&delete r.xhr;
},1);}));},_ajaxSettings:function(t,n,r){var i=this;return{url:t.attr("href"),beforeSend:function(t,s){return i._trigger("beforeLoad",n,e.extend({jqXHR:t,ajaxSettings:s},r));
}};},_getPanelForTab:function(t){var n=e(t).attr("aria-controls");return this.element.find(this._sanitizeSelector("#"+n));
}}),e.uiBackCompat!==!1&&(e.ui.tabs.prototype._ui=function(e,t){return{tab:e,panel:t,index:this.anchors.index(e)};
},e.widget("ui.tabs",e.ui.tabs,{url:function(e,t){this.anchors.eq(e).attr("href",t);}}),e.widget("ui.tabs",e.ui.tabs,{options:{ajaxOptions:null,cache:!1},_create:function(){this._super();
var t=this;this._on({tabsbeforeload:function(n,r){if(e.data(r.tab[0],"cache.tabs")){n.preventDefault();
return;}r.jqXHR.success(function(){t.options.cache&&e.data(r.tab[0],"cache.tabs",!0);});}});},_ajaxSettings:function(t,n,r){var i=this.options.ajaxOptions;
return e.extend({},i,{error:function(e,t){try{i.error(e,t,r.tab.closest("li").index(),r.tab[0]);}catch(n){}}},this._superApply(arguments));
},_setOption:function(e,t){e==="cache"&&t===!1&&this.anchors.removeData("cache.tabs"),this._super(e,t);
},_destroy:function(){this.anchors.removeData("cache.tabs"),this._super();},url:function(e){this.anchors.eq(e).removeData("cache.tabs"),this._superApply(arguments);
}}),e.widget("ui.tabs",e.ui.tabs,{abort:function(){this.xhr&&this.xhr.abort();}}),e.widget("ui.tabs",e.ui.tabs,{options:{spinner:"<em>Loading&#8230;</em>"},_create:function(){this._super(),this._on({tabsbeforeload:function(e,t){if(e.target!==this.element[0]||!this.options.spinner){return;
}var n=t.tab.find("span"),r=n.html();n.html(this.options.spinner),t.jqXHR.complete(function(){n.html(r);
});}});}}),e.widget("ui.tabs",e.ui.tabs,{options:{enable:null,disable:null},enable:function(t){var n=this.options,r;
if(t&&n.disabled===!0||e.isArray(n.disabled)&&e.inArray(t,n.disabled)!==-1){r=!0;}this._superApply(arguments),r&&this._trigger("enable",null,this._ui(this.anchors[t],this.panels[t]));
},disable:function(t){var n=this.options,r;if(t&&n.disabled===!1||e.isArray(n.disabled)&&e.inArray(t,n.disabled)===-1){r=!0;
}this._superApply(arguments),r&&this._trigger("disable",null,this._ui(this.anchors[t],this.panels[t]));
}}),e.widget("ui.tabs",e.ui.tabs,{options:{add:null,remove:null,tabTemplate:"<li><a href='#{href}'><span>#{label}</span></a></li>"},add:function(n,r,i){i===t&&(i=this.anchors.length);
var s,o,u=this.options,a=e(u.tabTemplate.replace(/#\{href\}/g,n).replace(/#\{label\}/g,r)),f=n.indexOf("#")?this._tabId(a):n.replace("#","");
return a.addClass("ui-state-default ui-corner-top").data("ui-tabs-destroy",!0),a.attr("aria-controls",f),s=i>=this.tabs.length,o=this.element.find("#"+f),o.length||(o=this._createPanel(f),s?i>0?o.insertAfter(this.panels.eq(-1)):o.appendTo(this.element):o.insertBefore(this.panels[i])),o.addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").hide(),s?a.appendTo(this.tablist):a.insertBefore(this.tabs[i]),u.disabled=e.map(u.disabled,function(e){return e>=i?++e:e;
}),this.refresh(),this.tabs.length===1&&u.active===!1&&this.option("active",0),this._trigger("add",null,this._ui(this.anchors[i],this.panels[i])),this;
},remove:function(t){t=this._getIndex(t);var n=this.options,r=this.tabs.eq(t).remove(),i=this._getPanelForTab(r).remove();
return r.hasClass("ui-tabs-active")&&this.anchors.length>2&&this._activate(t+(t+1<this.anchors.length?1:-1)),n.disabled=e.map(e.grep(n.disabled,function(e){return e!==t;
}),function(e){return e>=t?--e:e;}),this.refresh(),this._trigger("remove",null,this._ui(r.find("a")[0],i[0])),this;
}}),e.widget("ui.tabs",e.ui.tabs,{length:function(){return this.anchors.length;}}),e.widget("ui.tabs",e.ui.tabs,{options:{idPrefix:"ui-tabs-"},_tabId:function(t){var n=t.is("li")?t.find("a[href]"):t;
return n=n[0],e(n).closest("li").attr("aria-controls")||n.title&&n.title.replace(/\s/g,"_").replace(/[^\w\u00c0-\uFFFF\-]/g,"")||this.options.idPrefix+i();
}}),e.widget("ui.tabs",e.ui.tabs,{options:{panelTemplate:"<div></div>"},_createPanel:function(t){return e(this.options.panelTemplate).attr("id",t).addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").data("ui-tabs-destroy",!0);
}}),e.widget("ui.tabs",e.ui.tabs,{_create:function(){var e=this.options;e.active===null&&e.selected!==t&&(e.active=e.selected===-1?!1:e.selected),this._super(),e.selected=e.active,e.selected===!1&&(e.selected=-1);
},_setOption:function(e,t){if(e!=="selected"){return this._super(e,t);}var n=this.options;this._super("active",t===-1?!1:t),n.selected=n.active,n.selected===!1&&(n.selected=-1);
},_eventHandler:function(){this._superApply(arguments),this.options.selected=this.options.active,this.options.selected===!1&&(this.options.selected=-1);
}}),e.widget("ui.tabs",e.ui.tabs,{options:{show:null,select:null},_create:function(){this._super(),this.options.active!==!1&&this._trigger("show",null,this._ui(this.active.find(".ui-tabs-anchor")[0],this._getPanelForTab(this.active)[0]));
},_trigger:function(e,t,n){var r,i,s=this._superApply(arguments);return s?(e==="beforeActivate"?(r=n.newTab.length?n.newTab:n.oldTab,i=n.newPanel.length?n.newPanel:n.oldPanel,s=this._super("select",t,{tab:r.find(".ui-tabs-anchor")[0],panel:i[0],index:r.closest("li").index()})):e==="activate"&&n.newTab.length&&(s=this._super("show",t,{tab:n.newTab.find(".ui-tabs-anchor")[0],panel:n.newPanel[0],index:n.newTab.closest("li").index()})),s):!1;
}}),e.widget("ui.tabs",e.ui.tabs,{select:function(e){e=this._getIndex(e);if(e===-1){if(!this.options.collapsible||this.options.selected===-1){return;
}e=this.options.selected;}this.anchors.eq(e).trigger(this.options.event+this.eventNamespace);}}),function(){var t=0;
e.widget("ui.tabs",e.ui.tabs,{options:{cookie:null},_create:function(){var e=this.options,t;e.active==null&&e.cookie&&(t=parseInt(this._cookie(),10),t===-1&&(t=!1),e.active=t),this._super();
},_cookie:function(n){var r=[this.cookie||(this.cookie=this.options.cookie.name||"ui-tabs-"+ ++t)];return arguments.length&&(r.push(n===!1?-1:n),r.push(this.options.cookie)),e.cookie.apply(null,r);
},_refresh:function(){this._super(),this.options.cookie&&this._cookie(this.options.active,this.options.cookie);
},_eventHandler:function(){this._superApply(arguments),this.options.cookie&&this._cookie(this.options.active,this.options.cookie);
},_destroy:function(){this._super(),this.options.cookie&&this._cookie(null,this.options.cookie);}});}(),e.widget("ui.tabs",e.ui.tabs,{_trigger:function(t,n,r){var i=e.extend({},r);
return t==="load"&&(i.panel=i.panel[0],i.tab=i.tab.find(".ui-tabs-anchor")[0]),this._super(t,n,i);}}),e.widget("ui.tabs",e.ui.tabs,{options:{fx:null},_getFx:function(){var t,n,r=this.options.fx;
return r&&(e.isArray(r)?(t=r[0],n=r[1]):t=n=r),r?{show:n,hide:t}:null;},_toggle:function(e,t){function o(){n.running=!1,n._trigger("activate",e,t);
}function u(){t.newTab.closest("li").addClass("ui-tabs-active ui-state-active"),r.length&&s.show?r.animate(s.show,s.show.duration,function(){o();
}):(r.show(),o());}var n=this,r=t.newPanel,i=t.oldPanel,s=this._getFx();if(!s){return this._super(e,t);
}n.running=!0,i.length&&s.hide?i.animate(s.hide,s.hide.duration,function(){t.oldTab.closest("li").removeClass("ui-tabs-active ui-state-active"),u();
}):(t.oldTab.closest("li").removeClass("ui-tabs-active ui-state-active"),i.hide(),u());}}));})(jQuery);
jQuery.effects||function(e,t){var n=e.uiBackCompat!==!1,r="ui-effects-";e.effects={effect:{}},function(t,n){function p(e,t,n){var r=a[t.type]||{};
return e==null?n||!t.def?null:t.def:(e=r.floor?~~e:parseFloat(e),isNaN(e)?t.def:r.mod?(e+r.mod)%r.mod:0>e?0:r.max<e?r.max:e);
}function d(e){var n=o(),r=n._rgba=[];return e=e.toLowerCase(),h(s,function(t,i){var s,o=i.re.exec(e),a=o&&i.parse(o),f=i.space||"rgba";
if(a){return s=n[f](a),n[u[f].cache]=s[u[f].cache],r=n._rgba=s._rgba,!1;}}),r.length?(r.join()==="0,0,0,0"&&t.extend(r,c.transparent),n):c[e];
}function v(e,t,n){return n=(n+1)%1,n*6<1?e+(t-e)*n*6:n*2<1?t:n*3<2?e+(t-e)*(2/3-n)*6:e;}var r="backgroundColor borderBottomColor borderLeftColor borderRightColor borderTopColor color columnRuleColor outlineColor textDecorationColor textEmphasisColor".split(" "),i=/^([\-+])=\s*(\d+\.?\d*)/,s=[{re:/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,parse:function(e){return[e[1],e[2],e[3],e[4]];
}},{re:/rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,parse:function(e){return[e[1]*2.55,e[2]*2.55,e[3]*2.55,e[4]];
}},{re:/#([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})/,parse:function(e){return[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16)];
}},{re:/#([a-f0-9])([a-f0-9])([a-f0-9])/,parse:function(e){return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16)];
}},{re:/hsla?\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,space:"hsla",parse:function(e){return[e[1],e[2]/100,e[3]/100,e[4]];
}}],o=t.Color=function(e,n,r,i){return new t.Color.fn.parse(e,n,r,i);},u={rgba:{props:{red:{idx:0,type:"byte"},green:{idx:1,type:"byte"},blue:{idx:2,type:"byte"}}},hsla:{props:{hue:{idx:0,type:"degrees"},saturation:{idx:1,type:"percent"},lightness:{idx:2,type:"percent"}}}},a={"byte":{floor:!0,max:255},percent:{max:1},degrees:{mod:360,floor:!0}},f=o.support={},l=t("<p>")[0],c,h=t.each;
l.style.cssText="background-color:rgba(1,1,1,.5)",f.rgba=l.style.backgroundColor.indexOf("rgba")>-1,h(u,function(e,t){t.cache="_"+e,t.props.alpha={idx:3,type:"percent",def:1};
}),o.fn=t.extend(o.prototype,{parse:function(r,i,s,a){if(r===n){return this._rgba=[null,null,null,null],this;
}if(r.jquery||r.nodeType){r=t(r).css(i),i=n;}var f=this,l=t.type(r),v=this._rgba=[];i!==n&&(r=[r,i,s,a],l="array");
if(l==="string"){return this.parse(d(r)||c._default);}if(l==="array"){return h(u.rgba.props,function(e,t){v[t.idx]=p(r[t.idx],t);
}),this;}if(l==="object"){return r instanceof o?h(u,function(e,t){r[t.cache]&&(f[t.cache]=r[t.cache].slice());
}):h(u,function(t,n){var i=n.cache;h(n.props,function(e,t){if(!f[i]&&n.to){if(e==="alpha"||r[e]==null){return;
}f[i]=n.to(f._rgba);}f[i][t.idx]=p(r[e],t,!0);}),f[i]&&e.inArray(null,f[i].slice(0,3))<0&&(f[i][3]=1,n.from&&(f._rgba=n.from(f[i])));
}),this;}},is:function(e){var t=o(e),n=!0,r=this;return h(u,function(e,i){var s,o=t[i.cache];return o&&(s=r[i.cache]||i.to&&i.to(r._rgba)||[],h(i.props,function(e,t){if(o[t.idx]!=null){return n=o[t.idx]===s[t.idx],n;
}})),n;}),n;},_space:function(){var e=[],t=this;return h(u,function(n,r){t[r.cache]&&e.push(n);}),e.pop();
},transition:function(e,t){var n=o(e),r=n._space(),i=u[r],s=this.alpha()===0?o("transparent"):this,f=s[i.cache]||i.to(s._rgba),l=f.slice();
return n=n[i.cache],h(i.props,function(e,r){var i=r.idx,s=f[i],o=n[i],u=a[r.type]||{};if(o===null){return;
}s===null?l[i]=o:(u.mod&&(o-s>u.mod/2?s+=u.mod:s-o>u.mod/2&&(s-=u.mod)),l[i]=p((o-s)*t+s,r));}),this[r](l);
},blend:function(e){if(this._rgba[3]===1){return this;}var n=this._rgba.slice(),r=n.pop(),i=o(e)._rgba;
return o(t.map(n,function(e,t){return(1-r)*i[t]+r*e;}));},toRgbaString:function(){var e="rgba(",n=t.map(this._rgba,function(e,t){return e==null?t>2?1:0:e;
});return n[3]===1&&(n.pop(),e="rgb("),e+n.join()+")";},toHslaString:function(){var e="hsla(",n=t.map(this.hsla(),function(e,t){return e==null&&(e=t>2?1:0),t&&t<3&&(e=Math.round(e*100)+"%"),e;
});return n[3]===1&&(n.pop(),e="hsl("),e+n.join()+")";},toHexString:function(e){var n=this._rgba.slice(),r=n.pop();
return e&&n.push(~~(r*255)),"#"+t.map(n,function(e){return e=(e||0).toString(16),e.length===1?"0"+e:e;
}).join("");},toString:function(){return this._rgba[3]===0?"transparent":this.toRgbaString();}}),o.fn.parse.prototype=o.fn,u.hsla.to=function(e){if(e[0]==null||e[1]==null||e[2]==null){return[null,null,null,e[3]];
}var t=e[0]/255,n=e[1]/255,r=e[2]/255,i=e[3],s=Math.max(t,n,r),o=Math.min(t,n,r),u=s-o,a=s+o,f=a*0.5,l,c;
return o===s?l=0:t===s?l=60*(n-r)/u+360:n===s?l=60*(r-t)/u+120:l=60*(t-n)/u+240,f===0||f===1?c=f:f<=0.5?c=u/a:c=u/(2-a),[Math.round(l)%360,c,f,i==null?1:i];
},u.hsla.from=function(e){if(e[0]==null||e[1]==null||e[2]==null){return[null,null,null,e[3]];}var t=e[0]/360,n=e[1],r=e[2],i=e[3],s=r<=0.5?r*(1+n):r+n-r*n,o=2*r-s;
return[Math.round(v(o,s,t+1/3)*255),Math.round(v(o,s,t)*255),Math.round(v(o,s,t-1/3)*255),i];},h(u,function(e,r){var s=r.props,u=r.cache,a=r.to,f=r.from;
o.fn[e]=function(e){a&&!this[u]&&(this[u]=a(this._rgba));if(e===n){return this[u].slice();}var r,i=t.type(e),l=i==="array"||i==="object"?e:arguments,c=this[u].slice();
return h(s,function(e,t){var n=l[i==="object"?e:t.idx];n==null&&(n=c[t.idx]),c[t.idx]=p(n,t);}),f?(r=o(f(c)),r[u]=c,r):o(c);
},h(s,function(n,r){if(o.fn[n]){return;}o.fn[n]=function(s){var o=t.type(s),u=n==="alpha"?this._hsla?"hsla":"rgba":e,a=this[u](),f=a[r.idx],l;
return o==="undefined"?f:(o==="function"&&(s=s.call(this,f),o=t.type(s)),s==null&&r.empty?this:(o==="string"&&(l=i.exec(s),l&&(s=f+parseFloat(l[2])*(l[1]==="+"?1:-1))),a[r.idx]=s,this[u](a)));
};});}),h(r,function(e,n){t.cssHooks[n]={set:function(e,r){var i,s,u="";if(t.type(r)!=="string"||(i=d(r))){r=o(i||r);
if(!f.rgba&&r._rgba[3]!==1){s=n==="backgroundColor"?e.parentNode:e;while((u===""||u==="transparent")&&s&&s.style){try{u=t.css(s,"backgroundColor"),s=s.parentNode;
}catch(a){}}r=r.blend(u&&u!=="transparent"?u:"_default");}r=r.toRgbaString();}try{e.style[n]=r;}catch(l){}}},t.fx.step[n]=function(e){e.colorInit||(e.start=o(e.elem,n),e.end=o(e.end),e.colorInit=!0),t.cssHooks[n].set(e.elem,e.start.transition(e.end,e.pos));
};}),t.cssHooks.borderColor={expand:function(e){var t={};return h(["Top","Right","Bottom","Left"],function(n,r){t["border"+r+"Color"]=e;
}),t;}},c=t.Color.names={aqua:"#00ffff",black:"#000000",blue:"#0000ff",fuchsia:"#ff00ff",gray:"#808080",green:"#008000",lime:"#00ff00",maroon:"#800000",navy:"#000080",olive:"#808000",purple:"#800080",red:"#ff0000",silver:"#c0c0c0",teal:"#008080",white:"#ffffff",yellow:"#ffff00",transparent:[null,null,null,0],_default:"#ffffff"};
}(jQuery),function(){function i(){var t=this.ownerDocument.defaultView?this.ownerDocument.defaultView.getComputedStyle(this,null):this.currentStyle,n={},r,i;
if(t&&t.length&&t[0]&&t[t[0]]){i=t.length;while(i--){r=t[i],typeof t[r]=="string"&&(n[e.camelCase(r)]=t[r]);
}}else{for(r in t){typeof t[r]=="string"&&(n[r]=t[r]);}}return n;}function s(t,n){var i={},s,o;for(s in n){o=n[s],t[s]!==o&&!r[s]&&(e.fx.step[s]||!isNaN(parseFloat(o)))&&(i[s]=o);
}return i;}var n=["add","remove","toggle"],r={border:1,borderBottom:1,borderColor:1,borderLeft:1,borderRight:1,borderTop:1,borderWidth:1,margin:1,padding:1};
e.each(["borderLeftStyle","borderRightStyle","borderBottomStyle","borderTopStyle"],function(t,n){e.fx.step[n]=function(e){if(e.end!=="none"&&!e.setAttr||e.pos===1&&!e.setAttr){jQuery.style(e.elem,n,e.end),e.setAttr=!0;
}};}),e.effects.animateClass=function(t,r,o,u){var a=e.speed(r,o,u);return this.queue(function(){var r=e(this),o=r.attr("class")||"",u,f=a.children?r.find("*").andSelf():r;
f=f.map(function(){var t=e(this);return{el:t,start:i.call(this)};}),u=function(){e.each(n,function(e,n){t[n]&&r[n+"Class"](t[n]);
});},u(),f=f.map(function(){return this.end=i.call(this.el[0]),this.diff=s(this.start,this.end),this;
}),r.attr("class",o),f=f.map(function(){var t=this,n=e.Deferred(),r=jQuery.extend({},a,{queue:!1,complete:function(){n.resolve(t);
}});return this.el.animate(this.diff,r),n.promise();}),e.when.apply(e,f.get()).done(function(){u(),e.each(arguments,function(){var t=this.el;
e.each(this.diff,function(e){t.css(e,"");});}),a.complete.call(r[0]);});});},e.fn.extend({_addClass:e.fn.addClass,addClass:function(t,n,r,i){return n?e.effects.animateClass.call(this,{add:t},n,r,i):this._addClass(t);
},_removeClass:e.fn.removeClass,removeClass:function(t,n,r,i){return n?e.effects.animateClass.call(this,{remove:t},n,r,i):this._removeClass(t);
},_toggleClass:e.fn.toggleClass,toggleClass:function(n,r,i,s,o){return typeof r=="boolean"||r===t?i?e.effects.animateClass.call(this,r?{add:n}:{remove:n},i,s,o):this._toggleClass(n,r):e.effects.animateClass.call(this,{toggle:n},r,i,s);
},switchClass:function(t,n,r,i,s){return e.effects.animateClass.call(this,{add:n,remove:t},r,i,s);}});
}(),function(){function i(t,n,r,i){e.isPlainObject(t)&&(n=t,t=t.effect),t={effect:t},n==null&&(n={}),e.isFunction(n)&&(i=n,r=null,n={});
if(typeof n=="number"||e.fx.speeds[n]){i=r,r=n,n={};}return e.isFunction(r)&&(i=r,r=null),n&&e.extend(t,n),r=r||n.duration,t.duration=e.fx.off?0:typeof r=="number"?r:r in e.fx.speeds?e.fx.speeds[r]:e.fx.speeds._default,t.complete=i||n.complete,t;
}function s(t){return !t||typeof t=="number"||e.fx.speeds[t]?!0:typeof t=="string"&&!e.effects.effect[t]?n&&e.effects[t]?!1:!0:!1;
}e.extend(e.effects,{version:"1.9.2",save:function(e,t){for(var n=0;n<t.length;n++){t[n]!==null&&e.data(r+t[n],e[0].style[t[n]]);
}},restore:function(e,n){var i,s;for(s=0;s<n.length;s++){n[s]!==null&&(i=e.data(r+n[s]),i===t&&(i=""),e.css(n[s],i));
}},setMode:function(e,t){return t==="toggle"&&(t=e.is(":hidden")?"show":"hide"),t;},getBaseline:function(e,t){var n,r;
switch(e[0]){case"top":n=0;break;case"middle":n=0.5;break;case"bottom":n=1;break;default:n=e[0]/t.height;
}switch(e[1]){case"left":r=0;break;case"center":r=0.5;break;case"right":r=1;break;default:r=e[1]/t.width;
}return{x:r,y:n};},createWrapper:function(t){if(t.parent().is(".ui-effects-wrapper")){return t.parent();
}var n={width:t.outerWidth(!0),height:t.outerHeight(!0),"float":t.css("float")},r=e("<div></div>").addClass("ui-effects-wrapper").css({fontSize:"100%",background:"transparent",border:"none",margin:0,padding:0}),i={width:t.width(),height:t.height()},s=document.activeElement;
try{s.id;}catch(o){s=document.body;}return t.wrap(r),(t[0]===s||e.contains(t[0],s))&&e(s).focus(),r=t.parent(),t.css("position")==="static"?(r.css({position:"relative"}),t.css({position:"relative"})):(e.extend(n,{position:t.css("position"),zIndex:t.css("z-index")}),e.each(["top","left","bottom","right"],function(e,r){n[r]=t.css(r),isNaN(parseInt(n[r],10))&&(n[r]="auto");
}),t.css({position:"relative",top:0,left:0,right:"auto",bottom:"auto"})),t.css(i),r.css(n).show();},removeWrapper:function(t){var n=document.activeElement;
return t.parent().is(".ui-effects-wrapper")&&(t.parent().replaceWith(t),(t[0]===n||e.contains(t[0],n))&&e(n).focus()),t;
},setTransition:function(t,n,r,i){return i=i||{},e.each(n,function(e,n){var s=t.cssUnit(n);s[0]>0&&(i[n]=s[0]*r+s[1]);
}),i;}}),e.fn.extend({effect:function(){function a(n){function u(){e.isFunction(i)&&i.call(r[0]),e.isFunction(n)&&n();
}var r=e(this),i=t.complete,s=t.mode;(r.is(":hidden")?s==="hide":s==="show")?u():o.call(r[0],t,u);}var t=i.apply(this,arguments),r=t.mode,s=t.queue,o=e.effects.effect[t.effect],u=!o&&n&&e.effects[t.effect];
return e.fx.off||!o&&!u?r?this[r](t.duration,t.complete):this.each(function(){t.complete&&t.complete.call(this);
}):o?s===!1?this.each(a):this.queue(s||"fx",a):u.call(this,{options:t,duration:t.duration,callback:t.complete,mode:t.mode});
},_show:e.fn.show,show:function(e){if(s(e)){return this._show.apply(this,arguments);}var t=i.apply(this,arguments);
return t.mode="show",this.effect.call(this,t);},_hide:e.fn.hide,hide:function(e){if(s(e)){return this._hide.apply(this,arguments);
}var t=i.apply(this,arguments);return t.mode="hide",this.effect.call(this,t);},__toggle:e.fn.toggle,toggle:function(t){if(s(t)||typeof t=="boolean"||e.isFunction(t)){return this.__toggle.apply(this,arguments);
}var n=i.apply(this,arguments);return n.mode="toggle",this.effect.call(this,n);},cssUnit:function(t){var n=this.css(t),r=[];
return e.each(["em","px","%","pt"],function(e,t){n.indexOf(t)>0&&(r=[parseFloat(n),t]);}),r;}});}(),function(){var t={};
e.each(["Quad","Cubic","Quart","Quint","Expo"],function(e,n){t[n]=function(t){return Math.pow(t,e+2);
};}),e.extend(t,{Sine:function(e){return 1-Math.cos(e*Math.PI/2);},Circ:function(e){return 1-Math.sqrt(1-e*e);
},Elastic:function(e){return e===0||e===1?e:-Math.pow(2,8*(e-1))*Math.sin(((e-1)*80-7.5)*Math.PI/15);
},Back:function(e){return e*e*(3*e-2);},Bounce:function(e){var t,n=4;while(e<((t=Math.pow(2,--n))-1)/11){}return 1/Math.pow(4,3-n)-7.5625*Math.pow((t*3-2)/22-e,2);
}}),e.each(t,function(t,n){e.easing["easeIn"+t]=n,e.easing["easeOut"+t]=function(e){return 1-n(1-e);},e.easing["easeInOut"+t]=function(e){return e<0.5?n(e*2)/2:1-n(e*-2+2)/2;
};});}();}(jQuery);(function(e,t){var n=/up|down|vertical/,r=/up|left|vertical|horizontal/;e.effects.effect.blind=function(t,i){var s=e(this),o=["position","top","bottom","left","right","height","width"],u=e.effects.setMode(s,t.mode||"hide"),a=t.direction||"up",f=n.test(a),l=f?"height":"width",c=f?"top":"left",h=r.test(a),p={},d=u==="show",v,m,g;
s.parent().is(".ui-effects-wrapper")?e.effects.save(s.parent(),o):e.effects.save(s,o),s.show(),v=e.effects.createWrapper(s).css({overflow:"hidden"}),m=v[l](),g=parseFloat(v.css(c))||0,p[l]=d?m:0,h||(s.css(f?"bottom":"right",0).css(f?"top":"left","auto").css({position:"absolute"}),p[c]=d?g:m+g),d&&(v.css(l,0),h||v.css(c,g+m)),v.animate(p,{duration:t.duration,easing:t.easing,queue:!1,complete:function(){u==="hide"&&s.hide(),e.effects.restore(s,o),e.effects.removeWrapper(s),i();
}});};})(jQuery);(function(e,t){e.effects.effect.bounce=function(t,n){var r=e(this),i=["position","top","bottom","left","right","height","width"],s=e.effects.setMode(r,t.mode||"effect"),o=s==="hide",u=s==="show",a=t.direction||"up",f=t.distance,l=t.times||5,c=l*2+(u||o?1:0),h=t.duration/c,p=t.easing,d=a==="up"||a==="down"?"top":"left",v=a==="up"||a==="left",m,g,y,b=r.queue(),w=b.length;
(u||o)&&i.push("opacity"),e.effects.save(r,i),r.show(),e.effects.createWrapper(r),f||(f=r[d==="top"?"outerHeight":"outerWidth"]()/3),u&&(y={opacity:1},y[d]=0,r.css("opacity",0).css(d,v?-f*2:f*2).animate(y,h,p)),o&&(f/=Math.pow(2,l-1)),y={},y[d]=0;
for(m=0;m<l;m++){g={},g[d]=(v?"-=":"+=")+f,r.animate(g,h,p).animate(y,h,p),f=o?f*2:f/2;}o&&(g={opacity:0},g[d]=(v?"-=":"+=")+f,r.animate(g,h,p)),r.queue(function(){o&&r.hide(),e.effects.restore(r,i),e.effects.removeWrapper(r),n();
}),w>1&&b.splice.apply(b,[1,0].concat(b.splice(w,c+1))),r.dequeue();};})(jQuery);(function(e,t){e.effects.effect.clip=function(t,n){var r=e(this),i=["position","top","bottom","left","right","height","width"],s=e.effects.setMode(r,t.mode||"hide"),o=s==="show",u=t.direction||"vertical",a=u==="vertical",f=a?"height":"width",l=a?"top":"left",c={},h,p,d;
e.effects.save(r,i),r.show(),h=e.effects.createWrapper(r).css({overflow:"hidden"}),p=r[0].tagName==="IMG"?h:r,d=p[f](),o&&(p.css(f,0),p.css(l,d/2)),c[f]=o?d:0,c[l]=o?0:d/2,p.animate(c,{queue:!1,duration:t.duration,easing:t.easing,complete:function(){o||r.hide(),e.effects.restore(r,i),e.effects.removeWrapper(r),n();
}});};})(jQuery);(function(e,t){e.effects.effect.drop=function(t,n){var r=e(this),i=["position","top","bottom","left","right","opacity","height","width"],s=e.effects.setMode(r,t.mode||"hide"),o=s==="show",u=t.direction||"left",a=u==="up"||u==="down"?"top":"left",f=u==="up"||u==="left"?"pos":"neg",l={opacity:o?1:0},c;
e.effects.save(r,i),r.show(),e.effects.createWrapper(r),c=t.distance||r[a==="top"?"outerHeight":"outerWidth"](!0)/2,o&&r.css("opacity",0).css(a,f==="pos"?-c:c),l[a]=(o?f==="pos"?"+=":"-=":f==="pos"?"-=":"+=")+c,r.animate(l,{queue:!1,duration:t.duration,easing:t.easing,complete:function(){s==="hide"&&r.hide(),e.effects.restore(r,i),e.effects.removeWrapper(r),n();
}});};})(jQuery);(function(e,t){e.effects.effect.explode=function(t,n){function y(){c.push(this),c.length===r*i&&b();
}function b(){s.css({visibility:"visible"}),e(c).remove(),u||s.hide(),n();}var r=t.pieces?Math.round(Math.sqrt(t.pieces)):3,i=r,s=e(this),o=e.effects.setMode(s,t.mode||"hide"),u=o==="show",a=s.show().css("visibility","hidden").offset(),f=Math.ceil(s.outerWidth()/i),l=Math.ceil(s.outerHeight()/r),c=[],h,p,d,v,m,g;
for(h=0;h<r;h++){v=a.top+h*l,g=h-(r-1)/2;for(p=0;p<i;p++){d=a.left+p*f,m=p-(i-1)/2,s.clone().appendTo("body").wrap("<div></div>").css({position:"absolute",visibility:"visible",left:-p*f,top:-h*l}).parent().addClass("ui-effects-explode").css({position:"absolute",overflow:"hidden",width:f,height:l,left:d+(u?m*f:0),top:v+(u?g*l:0),opacity:u?0:1}).animate({left:d+(u?0:m*f),top:v+(u?0:g*l),opacity:u?1:0},t.duration||500,t.easing,y);
}}};})(jQuery);(function(e,t){e.effects.effect.fade=function(t,n){var r=e(this),i=e.effects.setMode(r,t.mode||"toggle");
r.animate({opacity:i},{queue:!1,duration:t.duration,easing:t.easing,complete:n});};})(jQuery);(function(e,t){e.effects.effect.fold=function(t,n){var r=e(this),i=["position","top","bottom","left","right","height","width"],s=e.effects.setMode(r,t.mode||"hide"),o=s==="show",u=s==="hide",a=t.size||15,f=/([0-9]+)%/.exec(a),l=!!t.horizFirst,c=o!==l,h=c?["width","height"]:["height","width"],p=t.duration/2,d,v,m={},g={};
e.effects.save(r,i),r.show(),d=e.effects.createWrapper(r).css({overflow:"hidden"}),v=c?[d.width(),d.height()]:[d.height(),d.width()],f&&(a=parseInt(f[1],10)/100*v[u?0:1]),o&&d.css(l?{height:0,width:a}:{height:a,width:0}),m[h[0]]=o?v[0]:a,g[h[1]]=o?v[1]:0,d.animate(m,p,t.easing).animate(g,p,t.easing,function(){u&&r.hide(),e.effects.restore(r,i),e.effects.removeWrapper(r),n();
});};})(jQuery);(function(e,t){e.effects.effect.highlight=function(t,n){var r=e(this),i=["backgroundImage","backgroundColor","opacity"],s=e.effects.setMode(r,t.mode||"show"),o={backgroundColor:r.css("backgroundColor")};
s==="hide"&&(o.opacity=0),e.effects.save(r,i),r.show().css({backgroundImage:"none",backgroundColor:t.color||"#ffff99"}).animate(o,{queue:!1,duration:t.duration,easing:t.easing,complete:function(){s==="hide"&&r.hide(),e.effects.restore(r,i),n();
}});};})(jQuery);(function(e,t){e.effects.effect.pulsate=function(t,n){var r=e(this),i=e.effects.setMode(r,t.mode||"show"),s=i==="show",o=i==="hide",u=s||i==="hide",a=(t.times||5)*2+(u?1:0),f=t.duration/a,l=0,c=r.queue(),h=c.length,p;
if(s||!r.is(":visible")){r.css("opacity",0).show(),l=1;}for(p=1;p<a;p++){r.animate({opacity:l},f,t.easing),l=1-l;
}r.animate({opacity:l},f,t.easing),r.queue(function(){o&&r.hide(),n();}),h>1&&c.splice.apply(c,[1,0].concat(c.splice(h,a+1))),r.dequeue();
};})(jQuery);(function(e,t){e.effects.effect.puff=function(t,n){var r=e(this),i=e.effects.setMode(r,t.mode||"hide"),s=i==="hide",o=parseInt(t.percent,10)||150,u=o/100,a={height:r.height(),width:r.width(),outerHeight:r.outerHeight(),outerWidth:r.outerWidth()};
e.extend(t,{effect:"scale",queue:!1,fade:!0,mode:i,complete:n,percent:s?o:100,from:s?a:{height:a.height*u,width:a.width*u,outerHeight:a.outerHeight*u,outerWidth:a.outerWidth*u}}),r.effect(t);
},e.effects.effect.scale=function(t,n){var r=e(this),i=e.extend(!0,{},t),s=e.effects.setMode(r,t.mode||"effect"),o=parseInt(t.percent,10)||(parseInt(t.percent,10)===0?0:s==="hide"?0:100),u=t.direction||"both",a=t.origin,f={height:r.height(),width:r.width(),outerHeight:r.outerHeight(),outerWidth:r.outerWidth()},l={y:u!=="horizontal"?o/100:1,x:u!=="vertical"?o/100:1};
i.effect="size",i.queue=!1,i.complete=n,s!=="effect"&&(i.origin=a||["middle","center"],i.restore=!0),i.from=t.from||(s==="show"?{height:0,width:0,outerHeight:0,outerWidth:0}:f),i.to={height:f.height*l.y,width:f.width*l.x,outerHeight:f.outerHeight*l.y,outerWidth:f.outerWidth*l.x},i.fade&&(s==="show"&&(i.from.opacity=0,i.to.opacity=1),s==="hide"&&(i.from.opacity=1,i.to.opacity=0)),r.effect(i);
},e.effects.effect.size=function(t,n){var r,i,s,o=e(this),u=["position","top","bottom","left","right","width","height","overflow","opacity"],a=["position","top","bottom","left","right","overflow","opacity"],f=["width","height","overflow"],l=["fontSize"],c=["borderTopWidth","borderBottomWidth","paddingTop","paddingBottom"],h=["borderLeftWidth","borderRightWidth","paddingLeft","paddingRight"],p=e.effects.setMode(o,t.mode||"effect"),d=t.restore||p!=="effect",v=t.scale||"both",m=t.origin||["middle","center"],g=o.css("position"),y=d?u:a,b={height:0,width:0,outerHeight:0,outerWidth:0};
p==="show"&&o.show(),r={height:o.height(),width:o.width(),outerHeight:o.outerHeight(),outerWidth:o.outerWidth()},t.mode==="toggle"&&p==="show"?(o.from=t.to||b,o.to=t.from||r):(o.from=t.from||(p==="show"?b:r),o.to=t.to||(p==="hide"?b:r)),s={from:{y:o.from.height/r.height,x:o.from.width/r.width},to:{y:o.to.height/r.height,x:o.to.width/r.width}};
if(v==="box"||v==="both"){s.from.y!==s.to.y&&(y=y.concat(c),o.from=e.effects.setTransition(o,c,s.from.y,o.from),o.to=e.effects.setTransition(o,c,s.to.y,o.to)),s.from.x!==s.to.x&&(y=y.concat(h),o.from=e.effects.setTransition(o,h,s.from.x,o.from),o.to=e.effects.setTransition(o,h,s.to.x,o.to));
}(v==="content"||v==="both")&&s.from.y!==s.to.y&&(y=y.concat(l).concat(f),o.from=e.effects.setTransition(o,l,s.from.y,o.from),o.to=e.effects.setTransition(o,l,s.to.y,o.to)),e.effects.save(o,y),o.show(),e.effects.createWrapper(o),o.css("overflow","hidden").css(o.from),m&&(i=e.effects.getBaseline(m,r),o.from.top=(r.outerHeight-o.outerHeight())*i.y,o.from.left=(r.outerWidth-o.outerWidth())*i.x,o.to.top=(r.outerHeight-o.to.outerHeight)*i.y,o.to.left=(r.outerWidth-o.to.outerWidth)*i.x),o.css(o.from);
if(v==="content"||v==="both"){c=c.concat(["marginTop","marginBottom"]).concat(l),h=h.concat(["marginLeft","marginRight"]),f=u.concat(c).concat(h),o.find("*[width]").each(function(){var n=e(this),r={height:n.height(),width:n.width(),outerHeight:n.outerHeight(),outerWidth:n.outerWidth()};
d&&e.effects.save(n,f),n.from={height:r.height*s.from.y,width:r.width*s.from.x,outerHeight:r.outerHeight*s.from.y,outerWidth:r.outerWidth*s.from.x},n.to={height:r.height*s.to.y,width:r.width*s.to.x,outerHeight:r.height*s.to.y,outerWidth:r.width*s.to.x},s.from.y!==s.to.y&&(n.from=e.effects.setTransition(n,c,s.from.y,n.from),n.to=e.effects.setTransition(n,c,s.to.y,n.to)),s.from.x!==s.to.x&&(n.from=e.effects.setTransition(n,h,s.from.x,n.from),n.to=e.effects.setTransition(n,h,s.to.x,n.to)),n.css(n.from),n.animate(n.to,t.duration,t.easing,function(){d&&e.effects.restore(n,f);
});});}o.animate(o.to,{queue:!1,duration:t.duration,easing:t.easing,complete:function(){o.to.opacity===0&&o.css("opacity",o.from.opacity),p==="hide"&&o.hide(),e.effects.restore(o,y),d||(g==="static"?o.css({position:"relative",top:o.to.top,left:o.to.left}):e.each(["top","left"],function(e,t){o.css(t,function(t,n){var r=parseInt(n,10),i=e?o.to.left:o.to.top;
return n==="auto"?i+"px":r+i+"px";});})),e.effects.removeWrapper(o),n();}});};})(jQuery);(function(e,t){e.effects.effect.shake=function(t,n){var r=e(this),i=["position","top","bottom","left","right","height","width"],s=e.effects.setMode(r,t.mode||"effect"),o=t.direction||"left",u=t.distance||20,a=t.times||3,f=a*2+1,l=Math.round(t.duration/f),c=o==="up"||o==="down"?"top":"left",h=o==="up"||o==="left",p={},d={},v={},m,g=r.queue(),y=g.length;
e.effects.save(r,i),r.show(),e.effects.createWrapper(r),p[c]=(h?"-=":"+=")+u,d[c]=(h?"+=":"-=")+u*2,v[c]=(h?"-=":"+=")+u*2,r.animate(p,l,t.easing);
for(m=1;m<a;m++){r.animate(d,l,t.easing).animate(v,l,t.easing);}r.animate(d,l,t.easing).animate(p,l/2,t.easing).queue(function(){s==="hide"&&r.hide(),e.effects.restore(r,i),e.effects.removeWrapper(r),n();
}),y>1&&g.splice.apply(g,[1,0].concat(g.splice(y,f+1))),r.dequeue();};})(jQuery);(function(e,t){e.effects.effect.slide=function(t,n){var r=e(this),i=["position","top","bottom","left","right","width","height"],s=e.effects.setMode(r,t.mode||"show"),o=s==="show",u=t.direction||"left",a=u==="up"||u==="down"?"top":"left",f=u==="up"||u==="left",l,c={};
e.effects.save(r,i),r.show(),l=t.distance||r[a==="top"?"outerHeight":"outerWidth"](!0),e.effects.createWrapper(r).css({overflow:"hidden"}),o&&r.css(a,f?isNaN(l)?"-"+l:-l:l),c[a]=(o?f?"+=":"-=":f?"-=":"+=")+l,r.animate(c,{queue:!1,duration:t.duration,easing:t.easing,complete:function(){s==="hide"&&r.hide(),e.effects.restore(r,i),e.effects.removeWrapper(r),n();
}});};})(jQuery);(function(e,t){e.effects.effect.transfer=function(t,n){var r=e(this),i=e(t.to),s=i.css("position")==="fixed",o=e("body"),u=s?o.scrollTop():0,a=s?o.scrollLeft():0,f=i.offset(),l={top:f.top-u,left:f.left-a,height:i.innerHeight(),width:i.innerWidth()},c=r.offset(),h=e('<div class="ui-effects-transfer"></div>').appendTo(document.body).addClass(t.className).css({top:c.top-u,left:c.left-a,height:r.innerHeight(),width:r.innerWidth(),position:s?"fixed":"absolute"}).animate(l,t.duration,t.easing,function(){h.remove(),n();
});};})(jQuery);(function(mod){if(typeof exports=="object"&&typeof module=="object"){module.exports=mod();
}else{if(typeof define=="function"&&define.amd){return define([],mod);}else{(this||window).CodeMirror=mod();
}}})(function(){var userAgent=navigator.userAgent;var platform=navigator.platform;var gecko=/gecko\/\d/i.test(userAgent);
var ie_upto10=/MSIE \d/.test(userAgent);var ie_11up=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(userAgent);
var ie=ie_upto10||ie_11up;var ie_version=ie&&(ie_upto10?document.documentMode||6:ie_11up[1]);var webkit=/WebKit\//.test(userAgent);
var qtwebkit=webkit&&/Qt\/\d+\.\d+/.test(userAgent);var chrome=/Chrome\//.test(userAgent);var presto=/Opera\//.test(userAgent);
var safari=/Apple Computer/.test(navigator.vendor);var mac_geMountainLion=/Mac OS X 1\d\D([8-9]|\d\d)\D/.test(userAgent);
var phantom=/PhantomJS/.test(userAgent);var ios=/AppleWebKit/.test(userAgent)&&/Mobile\/\w+/.test(userAgent);
var mobile=ios||/Android|webOS|BlackBerry|Opera Mini|Opera Mobi|IEMobile/i.test(userAgent);var mac=ios||/Mac/.test(platform);
var chromeOS=/\bCrOS\b/.test(userAgent);var windows=/win/i.test(platform);var presto_version=presto&&userAgent.match(/Version\/(\d*\.\d*)/);
if(presto_version){presto_version=Number(presto_version[1]);}if(presto_version&&presto_version>=15){presto=false;
webkit=true;}var flipCtrlCmd=mac&&(qtwebkit||presto&&(presto_version==null||presto_version<12.11));var captureRightClick=gecko||(ie&&ie_version>=9);
var sawReadOnlySpans=false,sawCollapsedSpans=false;function CodeMirror(place,options){if(!(this instanceof CodeMirror)){return new CodeMirror(place,options);
}this.options=options=options?copyObj(options):{};copyObj(defaults,options,false);setGuttersForLineNumbers(options);
var doc=options.value;if(typeof doc=="string"){doc=new Doc(doc,options.mode,null,options.lineSeparator);
}this.doc=doc;var input=new CodeMirror.inputStyles[options.inputStyle](this);var display=this.display=new Display(place,doc,input);
display.wrapper.CodeMirror=this;updateGutters(this);themeChanged(this);if(options.lineWrapping){this.display.wrapper.className+=" CodeMirror-wrap";
}if(options.autofocus&&!mobile){display.input.focus();}initScrollbars(this);this.state={keyMaps:[],overlays:[],modeGen:0,overwrite:false,delayingBlurEvent:false,focused:false,suppressEdits:false,pasteIncoming:false,cutIncoming:false,selectingText:false,draggingText:false,highlight:new Delayed(),keySeq:null,specialChars:null};
var cm=this;if(ie&&ie_version<11){setTimeout(function(){cm.display.input.reset(true);},20);}registerEventHandlers(this);
ensureGlobalHandlers();startOperation(this);this.curOp.forceUpdate=true;attachDoc(this,doc);if((options.autofocus&&!mobile)||cm.hasFocus()){setTimeout(bind(onFocus,this),20);
}else{onBlur(this);}for(var opt in optionHandlers){if(optionHandlers.hasOwnProperty(opt)){optionHandlers[opt](this,options[opt],Init);
}}maybeUpdateLineNumberWidth(this);if(options.finishInit){options.finishInit(this);}for(var i=0;i<initHooks.length;
++i){initHooks[i](this);}endOperation(this);if(webkit&&options.lineWrapping&&getComputedStyle(display.lineDiv).textRendering=="optimizelegibility"){display.lineDiv.style.textRendering="auto";
}}function Display(place,doc,input){var d=this;this.input=input;d.scrollbarFiller=elt("div",null,"CodeMirror-scrollbar-filler");
d.scrollbarFiller.setAttribute("cm-not-content","true");d.gutterFiller=elt("div",null,"CodeMirror-gutter-filler");
d.gutterFiller.setAttribute("cm-not-content","true");d.lineDiv=elt("div",null,"CodeMirror-code");d.selectionDiv=elt("div",null,null,"position: relative");
d.cursorDiv=elt("div",null,"CodeMirror-cursors");d.measure=elt("div",null,"CodeMirror-measure");d.lineMeasure=elt("div",null,"CodeMirror-measure");
d.lineSpace=elt("div",[d.measure,d.lineMeasure,d.selectionDiv,d.cursorDiv,d.lineDiv],null,"position: relative; outline: none");
d.mover=elt("div",[elt("div",[d.lineSpace],"CodeMirror-lines")],null,"position: relative");d.sizer=elt("div",[d.mover],"CodeMirror-sizer");
d.sizerWidth=null;d.heightForcer=elt("div",null,null,"position: absolute; height: "+scrollerGap+"px; width: 1px;");
d.gutters=elt("div",null,"CodeMirror-gutters");d.lineGutter=null;d.scroller=elt("div",[d.sizer,d.heightForcer,d.gutters],"CodeMirror-scroll");
d.scroller.setAttribute("tabIndex","-1");d.wrapper=elt("div",[d.scrollbarFiller,d.gutterFiller,d.scroller],"CodeMirror");
if(ie&&ie_version<8){d.gutters.style.zIndex=-1;d.scroller.style.paddingRight=0;}if(!webkit&&!(gecko&&mobile)){d.scroller.draggable=true;
}if(place){if(place.appendChild){place.appendChild(d.wrapper);}else{place(d.wrapper);}}d.viewFrom=d.viewTo=doc.first;
d.reportedViewFrom=d.reportedViewTo=doc.first;d.view=[];d.renderedView=null;d.externalMeasured=null;d.viewOffset=0;
d.lastWrapHeight=d.lastWrapWidth=0;d.updateLineNumbers=null;d.nativeBarWidth=d.barHeight=d.barWidth=0;
d.scrollbarsClipped=false;d.lineNumWidth=d.lineNumInnerWidth=d.lineNumChars=null;d.alignWidgets=false;
d.cachedCharWidth=d.cachedTextHeight=d.cachedPaddingH=null;d.maxLine=null;d.maxLineLength=0;d.maxLineChanged=false;
d.wheelDX=d.wheelDY=d.wheelStartX=d.wheelStartY=null;d.shift=false;d.selForContextMenu=null;d.activeTouch=null;
input.init(d);}function loadMode(cm){cm.doc.mode=CodeMirror.getMode(cm.options,cm.doc.modeOption);resetModeState(cm);
}function resetModeState(cm){cm.doc.iter(function(line){if(line.stateAfter){line.stateAfter=null;}if(line.styles){line.styles=null;
}});cm.doc.frontier=cm.doc.first;startWorker(cm,100);cm.state.modeGen++;if(cm.curOp){regChange(cm);}}function wrappingChanged(cm){if(cm.options.lineWrapping){addClass(cm.display.wrapper,"CodeMirror-wrap");
cm.display.sizer.style.minWidth="";cm.display.sizerWidth=null;}else{rmClass(cm.display.wrapper,"CodeMirror-wrap");
findMaxLine(cm);}estimateLineHeights(cm);regChange(cm);clearCaches(cm);setTimeout(function(){updateScrollbars(cm);
},100);}function estimateHeight(cm){var th=textHeight(cm.display),wrapping=cm.options.lineWrapping;var perLine=wrapping&&Math.max(5,cm.display.scroller.clientWidth/charWidth(cm.display)-3);
return function(line){if(lineIsHidden(cm.doc,line)){return 0;}var widgetsHeight=0;if(line.widgets){for(var i=0;
i<line.widgets.length;i++){if(line.widgets[i].height){widgetsHeight+=line.widgets[i].height;}}}if(wrapping){return widgetsHeight+(Math.ceil(line.text.length/perLine)||1)*th;
}else{return widgetsHeight+th;}};}function estimateLineHeights(cm){var doc=cm.doc,est=estimateHeight(cm);
doc.iter(function(line){var estHeight=est(line);if(estHeight!=line.height){updateLineHeight(line,estHeight);
}});}function themeChanged(cm){cm.display.wrapper.className=cm.display.wrapper.className.replace(/\s*cm-s-\S+/g,"")+cm.options.theme.replace(/(^|\s)\s*/g," cm-s-");
clearCaches(cm);}function guttersChanged(cm){updateGutters(cm);regChange(cm);setTimeout(function(){alignHorizontally(cm);
},20);}function updateGutters(cm){var gutters=cm.display.gutters,specs=cm.options.gutters;removeChildren(gutters);
for(var i=0;i<specs.length;++i){var gutterClass=specs[i];var gElt=gutters.appendChild(elt("div",null,"CodeMirror-gutter "+gutterClass));
if(gutterClass=="CodeMirror-linenumbers"){cm.display.lineGutter=gElt;gElt.style.width=(cm.display.lineNumWidth||1)+"px";
}}gutters.style.display=i?"":"none";updateGutterSpace(cm);}function updateGutterSpace(cm){var width=cm.display.gutters.offsetWidth;
cm.display.sizer.style.marginLeft=width+"px";}function lineLength(line){if(line.height==0){return 0;}var len=line.text.length,merged,cur=line;
while(merged=collapsedSpanAtStart(cur)){var found=merged.find(0,true);cur=found.from.line;len+=found.from.ch-found.to.ch;
}cur=line;while(merged=collapsedSpanAtEnd(cur)){var found=merged.find(0,true);len-=cur.text.length-found.from.ch;
cur=found.to.line;len+=cur.text.length-found.to.ch;}return len;}function findMaxLine(cm){var d=cm.display,doc=cm.doc;
d.maxLine=getLine(doc,doc.first);d.maxLineLength=lineLength(d.maxLine);d.maxLineChanged=true;doc.iter(function(line){var len=lineLength(line);
if(len>d.maxLineLength){d.maxLineLength=len;d.maxLine=line;}});}function setGuttersForLineNumbers(options){var found=indexOf(options.gutters,"CodeMirror-linenumbers");
if(found==-1&&options.lineNumbers){options.gutters=options.gutters.concat(["CodeMirror-linenumbers"]);
}else{if(found>-1&&!options.lineNumbers){options.gutters=options.gutters.slice(0);options.gutters.splice(found,1);
}}}function measureForScrollbars(cm){var d=cm.display,gutterW=d.gutters.offsetWidth;var docH=Math.round(cm.doc.height+paddingVert(cm.display));
return{clientHeight:d.scroller.clientHeight,viewHeight:d.wrapper.clientHeight,scrollWidth:d.scroller.scrollWidth,clientWidth:d.scroller.clientWidth,viewWidth:d.wrapper.clientWidth,barLeft:cm.options.fixedGutter?gutterW:0,docHeight:docH,scrollHeight:docH+scrollGap(cm)+d.barHeight,nativeBarWidth:d.nativeBarWidth,gutterWidth:gutterW};
}function NativeScrollbars(place,scroll,cm){this.cm=cm;var vert=this.vert=elt("div",[elt("div",null,null,"min-width: 1px")],"CodeMirror-vscrollbar");
var horiz=this.horiz=elt("div",[elt("div",null,null,"height: 100%; min-height: 1px")],"CodeMirror-hscrollbar");
place(vert);place(horiz);on(vert,"scroll",function(){if(vert.clientHeight){scroll(vert.scrollTop,"vertical");
}});on(horiz,"scroll",function(){if(horiz.clientWidth){scroll(horiz.scrollLeft,"horizontal");}});this.checkedZeroWidth=false;
if(ie&&ie_version<8){this.horiz.style.minHeight=this.vert.style.minWidth="18px";}}NativeScrollbars.prototype=copyObj({update:function(measure){var needsH=measure.scrollWidth>measure.clientWidth+1;
var needsV=measure.scrollHeight>measure.clientHeight+1;var sWidth=measure.nativeBarWidth;if(needsV){this.vert.style.display="block";
this.vert.style.bottom=needsH?sWidth+"px":"0";var totalHeight=measure.viewHeight-(needsH?sWidth:0);this.vert.firstChild.style.height=Math.max(0,measure.scrollHeight-measure.clientHeight+totalHeight)+"px";
}else{this.vert.style.display="";this.vert.firstChild.style.height="0";}if(needsH){this.horiz.style.display="block";
this.horiz.style.right=needsV?sWidth+"px":"0";this.horiz.style.left=measure.barLeft+"px";var totalWidth=measure.viewWidth-measure.barLeft-(needsV?sWidth:0);
this.horiz.firstChild.style.width=(measure.scrollWidth-measure.clientWidth+totalWidth)+"px";}else{this.horiz.style.display="";
this.horiz.firstChild.style.width="0";}if(!this.checkedZeroWidth&&measure.clientHeight>0){if(sWidth==0){this.zeroWidthHack();
}this.checkedZeroWidth=true;}return{right:needsV?sWidth:0,bottom:needsH?sWidth:0};},setScrollLeft:function(pos){if(this.horiz.scrollLeft!=pos){this.horiz.scrollLeft=pos;
}if(this.disableHoriz){this.enableZeroWidthBar(this.horiz,this.disableHoriz);}},setScrollTop:function(pos){if(this.vert.scrollTop!=pos){this.vert.scrollTop=pos;
}if(this.disableVert){this.enableZeroWidthBar(this.vert,this.disableVert);}},zeroWidthHack:function(){var w=mac&&!mac_geMountainLion?"12px":"18px";
this.horiz.style.height=this.vert.style.width=w;this.horiz.style.pointerEvents=this.vert.style.pointerEvents="none";
this.disableHoriz=new Delayed;this.disableVert=new Delayed;},enableZeroWidthBar:function(bar,delay){bar.style.pointerEvents="auto";
function maybeDisable(){var box=bar.getBoundingClientRect();var elt=document.elementFromPoint(box.left+1,box.bottom-1);
if(elt!=bar){bar.style.pointerEvents="none";}else{delay.set(1000,maybeDisable);}}delay.set(1000,maybeDisable);
},clear:function(){var parent=this.horiz.parentNode;parent.removeChild(this.horiz);parent.removeChild(this.vert);
}},NativeScrollbars.prototype);function NullScrollbars(){}NullScrollbars.prototype=copyObj({update:function(){return{bottom:0,right:0};
},setScrollLeft:function(){},setScrollTop:function(){},clear:function(){}},NullScrollbars.prototype);
CodeMirror.scrollbarModel={"native":NativeScrollbars,"null":NullScrollbars};function initScrollbars(cm){if(cm.display.scrollbars){cm.display.scrollbars.clear();
if(cm.display.scrollbars.addClass){rmClass(cm.display.wrapper,cm.display.scrollbars.addClass);}}cm.display.scrollbars=new CodeMirror.scrollbarModel[cm.options.scrollbarStyle](function(node){cm.display.wrapper.insertBefore(node,cm.display.scrollbarFiller);
on(node,"mousedown",function(){if(cm.state.focused){setTimeout(function(){cm.display.input.focus();},0);
}});node.setAttribute("cm-not-content","true");},function(pos,axis){if(axis=="horizontal"){setScrollLeft(cm,pos);
}else{setScrollTop(cm,pos);}},cm);if(cm.display.scrollbars.addClass){addClass(cm.display.wrapper,cm.display.scrollbars.addClass);
}}function updateScrollbars(cm,measure){if(!measure){measure=measureForScrollbars(cm);}var startWidth=cm.display.barWidth,startHeight=cm.display.barHeight;
updateScrollbarsInner(cm,measure);for(var i=0;i<4&&startWidth!=cm.display.barWidth||startHeight!=cm.display.barHeight;
i++){if(startWidth!=cm.display.barWidth&&cm.options.lineWrapping){updateHeightsInViewport(cm);}updateScrollbarsInner(cm,measureForScrollbars(cm));
startWidth=cm.display.barWidth;startHeight=cm.display.barHeight;}}function updateScrollbarsInner(cm,measure){var d=cm.display;
var sizes=d.scrollbars.update(measure);d.sizer.style.paddingRight=(d.barWidth=sizes.right)+"px";d.sizer.style.paddingBottom=(d.barHeight=sizes.bottom)+"px";
d.heightForcer.style.borderBottom=sizes.bottom+"px solid transparent";if(sizes.right&&sizes.bottom){d.scrollbarFiller.style.display="block";
d.scrollbarFiller.style.height=sizes.bottom+"px";d.scrollbarFiller.style.width=sizes.right+"px";}else{d.scrollbarFiller.style.display="";
}if(sizes.bottom&&cm.options.coverGutterNextToScrollbar&&cm.options.fixedGutter){d.gutterFiller.style.display="block";
d.gutterFiller.style.height=sizes.bottom+"px";d.gutterFiller.style.width=measure.gutterWidth+"px";}else{d.gutterFiller.style.display="";
}}function visibleLines(display,doc,viewport){var top=viewport&&viewport.top!=null?Math.max(0,viewport.top):display.scroller.scrollTop;
top=Math.floor(top-paddingTop(display));var bottom=viewport&&viewport.bottom!=null?viewport.bottom:top+display.wrapper.clientHeight;
var from=lineAtHeight(doc,top),to=lineAtHeight(doc,bottom);if(viewport&&viewport.ensure){var ensureFrom=viewport.ensure.from.line,ensureTo=viewport.ensure.to.line;
if(ensureFrom<from){from=ensureFrom;to=lineAtHeight(doc,heightAtLine(getLine(doc,ensureFrom))+display.wrapper.clientHeight);
}else{if(Math.min(ensureTo,doc.lastLine())>=to){from=lineAtHeight(doc,heightAtLine(getLine(doc,ensureTo))-display.wrapper.clientHeight);
to=ensureTo;}}}return{from:from,to:Math.max(to,from+1)};}function alignHorizontally(cm){var display=cm.display,view=display.view;
if(!display.alignWidgets&&(!display.gutters.firstChild||!cm.options.fixedGutter)){return;}var comp=compensateForHScroll(display)-display.scroller.scrollLeft+cm.doc.scrollLeft;
var gutterW=display.gutters.offsetWidth,left=comp+"px";for(var i=0;i<view.length;i++){if(!view[i].hidden){if(cm.options.fixedGutter){if(view[i].gutter){view[i].gutter.style.left=left;
}if(view[i].gutterBackground){view[i].gutterBackground.style.left=left;}}var align=view[i].alignable;
if(align){for(var j=0;j<align.length;j++){align[j].style.left=left;}}}}if(cm.options.fixedGutter){display.gutters.style.left=(comp+gutterW)+"px";
}}function maybeUpdateLineNumberWidth(cm){if(!cm.options.lineNumbers){return false;}var doc=cm.doc,last=lineNumberFor(cm.options,doc.first+doc.size-1),display=cm.display;
if(last.length!=display.lineNumChars){var test=display.measure.appendChild(elt("div",[elt("div",last)],"CodeMirror-linenumber CodeMirror-gutter-elt"));
var innerW=test.firstChild.offsetWidth,padding=test.offsetWidth-innerW;display.lineGutter.style.width="";
display.lineNumInnerWidth=Math.max(innerW,display.lineGutter.offsetWidth-padding)+1;display.lineNumWidth=display.lineNumInnerWidth+padding;
display.lineNumChars=display.lineNumInnerWidth?last.length:-1;display.lineGutter.style.width=display.lineNumWidth+"px";
updateGutterSpace(cm);return true;}return false;}function lineNumberFor(options,i){return String(options.lineNumberFormatter(i+options.firstLineNumber));
}function compensateForHScroll(display){return display.scroller.getBoundingClientRect().left-display.sizer.getBoundingClientRect().left;
}function DisplayUpdate(cm,viewport,force){var display=cm.display;this.viewport=viewport;this.visible=visibleLines(display,cm.doc,viewport);
this.editorIsHidden=!display.wrapper.offsetWidth;this.wrapperHeight=display.wrapper.clientHeight;this.wrapperWidth=display.wrapper.clientWidth;
this.oldDisplayWidth=displayWidth(cm);this.force=force;this.dims=getDimensions(cm);this.events=[];}DisplayUpdate.prototype.signal=function(emitter,type){if(hasHandler(emitter,type)){this.events.push(arguments);
}};DisplayUpdate.prototype.finish=function(){for(var i=0;i<this.events.length;i++){signal.apply(null,this.events[i]);
}};function maybeClipScrollbars(cm){var display=cm.display;if(!display.scrollbarsClipped&&display.scroller.offsetWidth){display.nativeBarWidth=display.scroller.offsetWidth-display.scroller.clientWidth;
display.heightForcer.style.height=scrollGap(cm)+"px";display.sizer.style.marginBottom=-display.nativeBarWidth+"px";
display.sizer.style.borderRightWidth=scrollGap(cm)+"px";display.scrollbarsClipped=true;}}function updateDisplayIfNeeded(cm,update){var display=cm.display,doc=cm.doc;
if(update.editorIsHidden){resetView(cm);return false;}if(!update.force&&update.visible.from>=display.viewFrom&&update.visible.to<=display.viewTo&&(display.updateLineNumbers==null||display.updateLineNumbers>=display.viewTo)&&display.renderedView==display.view&&countDirtyView(cm)==0){return false;
}if(maybeUpdateLineNumberWidth(cm)){resetView(cm);update.dims=getDimensions(cm);}var end=doc.first+doc.size;
var from=Math.max(update.visible.from-cm.options.viewportMargin,doc.first);var to=Math.min(end,update.visible.to+cm.options.viewportMargin);
if(display.viewFrom<from&&from-display.viewFrom<20){from=Math.max(doc.first,display.viewFrom);}if(display.viewTo>to&&display.viewTo-to<20){to=Math.min(end,display.viewTo);
}if(sawCollapsedSpans){from=visualLineNo(cm.doc,from);to=visualLineEndNo(cm.doc,to);}var different=from!=display.viewFrom||to!=display.viewTo||display.lastWrapHeight!=update.wrapperHeight||display.lastWrapWidth!=update.wrapperWidth;
adjustView(cm,from,to);display.viewOffset=heightAtLine(getLine(cm.doc,display.viewFrom));cm.display.mover.style.top=display.viewOffset+"px";
var toUpdate=countDirtyView(cm);if(!different&&toUpdate==0&&!update.force&&display.renderedView==display.view&&(display.updateLineNumbers==null||display.updateLineNumbers>=display.viewTo)){return false;
}var focused=activeElt();if(toUpdate>4){display.lineDiv.style.display="none";}patchDisplay(cm,display.updateLineNumbers,update.dims);
if(toUpdate>4){display.lineDiv.style.display="";}display.renderedView=display.view;if(focused&&activeElt()!=focused&&focused.offsetHeight){focused.focus();
}removeChildren(display.cursorDiv);removeChildren(display.selectionDiv);display.gutters.style.height=display.sizer.style.minHeight=0;
if(different){display.lastWrapHeight=update.wrapperHeight;display.lastWrapWidth=update.wrapperWidth;startWorker(cm,400);
}display.updateLineNumbers=null;return true;}function postUpdateDisplay(cm,update){var viewport=update.viewport;
for(var first=true;;first=false){if(!first||!cm.options.lineWrapping||update.oldDisplayWidth==displayWidth(cm)){if(viewport&&viewport.top!=null){viewport={top:Math.min(cm.doc.height+paddingVert(cm.display)-displayHeight(cm),viewport.top)};
}update.visible=visibleLines(cm.display,cm.doc,viewport);if(update.visible.from>=cm.display.viewFrom&&update.visible.to<=cm.display.viewTo){break;
}}if(!updateDisplayIfNeeded(cm,update)){break;}updateHeightsInViewport(cm);var barMeasure=measureForScrollbars(cm);
updateSelection(cm);updateScrollbars(cm,barMeasure);setDocumentHeight(cm,barMeasure);}update.signal(cm,"update",cm);
if(cm.display.viewFrom!=cm.display.reportedViewFrom||cm.display.viewTo!=cm.display.reportedViewTo){update.signal(cm,"viewportChange",cm,cm.display.viewFrom,cm.display.viewTo);
cm.display.reportedViewFrom=cm.display.viewFrom;cm.display.reportedViewTo=cm.display.viewTo;}}function updateDisplaySimple(cm,viewport){var update=new DisplayUpdate(cm,viewport);
if(updateDisplayIfNeeded(cm,update)){updateHeightsInViewport(cm);postUpdateDisplay(cm,update);var barMeasure=measureForScrollbars(cm);
updateSelection(cm);updateScrollbars(cm,barMeasure);setDocumentHeight(cm,barMeasure);update.finish();
}}function setDocumentHeight(cm,measure){cm.display.sizer.style.minHeight=measure.docHeight+"px";cm.display.heightForcer.style.top=measure.docHeight+"px";
cm.display.gutters.style.height=(measure.docHeight+cm.display.barHeight+scrollGap(cm))+"px";}function updateHeightsInViewport(cm){var display=cm.display;
var prevBottom=display.lineDiv.offsetTop;for(var i=0;i<display.view.length;i++){var cur=display.view[i],height;
if(cur.hidden){continue;}if(ie&&ie_version<8){var bot=cur.node.offsetTop+cur.node.offsetHeight;height=bot-prevBottom;
prevBottom=bot;}else{var box=cur.node.getBoundingClientRect();height=box.bottom-box.top;}var diff=cur.line.height-height;
if(height<2){height=textHeight(display);}if(diff>0.001||diff<-0.001){updateLineHeight(cur.line,height);
updateWidgetHeight(cur.line);if(cur.rest){for(var j=0;j<cur.rest.length;j++){updateWidgetHeight(cur.rest[j]);
}}}}}function updateWidgetHeight(line){if(line.widgets){for(var i=0;i<line.widgets.length;++i){line.widgets[i].height=line.widgets[i].node.parentNode.offsetHeight;
}}}function getDimensions(cm){var d=cm.display,left={},width={};var gutterLeft=d.gutters.clientLeft;for(var n=d.gutters.firstChild,i=0;
n;n=n.nextSibling,++i){left[cm.options.gutters[i]]=n.offsetLeft+n.clientLeft+gutterLeft;width[cm.options.gutters[i]]=n.clientWidth;
}return{fixedPos:compensateForHScroll(d),gutterTotalWidth:d.gutters.offsetWidth,gutterLeft:left,gutterWidth:width,wrapperWidth:d.wrapper.clientWidth};
}function patchDisplay(cm,updateNumbersFrom,dims){var display=cm.display,lineNumbers=cm.options.lineNumbers;
var container=display.lineDiv,cur=container.firstChild;function rm(node){var next=node.nextSibling;if(webkit&&mac&&cm.display.currentWheelTarget==node){node.style.display="none";
}else{node.parentNode.removeChild(node);}return next;}var view=display.view,lineN=display.viewFrom;for(var i=0;
i<view.length;i++){var lineView=view[i];if(lineView.hidden){}else{if(!lineView.node||lineView.node.parentNode!=container){var node=buildLineElement(cm,lineView,lineN,dims);
container.insertBefore(node,cur);}else{while(cur!=lineView.node){cur=rm(cur);}var updateNumber=lineNumbers&&updateNumbersFrom!=null&&updateNumbersFrom<=lineN&&lineView.lineNumber;
if(lineView.changes){if(indexOf(lineView.changes,"gutter")>-1){updateNumber=false;}updateLineForChanges(cm,lineView,lineN,dims);
}if(updateNumber){removeChildren(lineView.lineNumber);lineView.lineNumber.appendChild(document.createTextNode(lineNumberFor(cm.options,lineN)));
}cur=lineView.node.nextSibling;}}lineN+=lineView.size;}while(cur){cur=rm(cur);}}function updateLineForChanges(cm,lineView,lineN,dims){for(var j=0;
j<lineView.changes.length;j++){var type=lineView.changes[j];if(type=="text"){updateLineText(cm,lineView);
}else{if(type=="gutter"){updateLineGutter(cm,lineView,lineN,dims);}else{if(type=="class"){updateLineClasses(lineView);
}else{if(type=="widget"){updateLineWidgets(cm,lineView,dims);}}}}}lineView.changes=null;}function ensureLineWrapped(lineView){if(lineView.node==lineView.text){lineView.node=elt("div",null,null,"position: relative");
if(lineView.text.parentNode){lineView.text.parentNode.replaceChild(lineView.node,lineView.text);}lineView.node.appendChild(lineView.text);
if(ie&&ie_version<8){lineView.node.style.zIndex=2;}}return lineView.node;}function updateLineBackground(lineView){var cls=lineView.bgClass?lineView.bgClass+" "+(lineView.line.bgClass||""):lineView.line.bgClass;
if(cls){cls+=" CodeMirror-linebackground";}if(lineView.background){if(cls){lineView.background.className=cls;
}else{lineView.background.parentNode.removeChild(lineView.background);lineView.background=null;}}else{if(cls){var wrap=ensureLineWrapped(lineView);
lineView.background=wrap.insertBefore(elt("div",null,cls),wrap.firstChild);}}}function getLineContent(cm,lineView){var ext=cm.display.externalMeasured;
if(ext&&ext.line==lineView.line){cm.display.externalMeasured=null;lineView.measure=ext.measure;return ext.built;
}return buildLineContent(cm,lineView);}function updateLineText(cm,lineView){var cls=lineView.text.className;
var built=getLineContent(cm,lineView);if(lineView.text==lineView.node){lineView.node=built.pre;}lineView.text.parentNode.replaceChild(built.pre,lineView.text);
lineView.text=built.pre;if(built.bgClass!=lineView.bgClass||built.textClass!=lineView.textClass){lineView.bgClass=built.bgClass;
lineView.textClass=built.textClass;updateLineClasses(lineView);}else{if(cls){lineView.text.className=cls;
}}}function updateLineClasses(lineView){updateLineBackground(lineView);if(lineView.line.wrapClass){ensureLineWrapped(lineView).className=lineView.line.wrapClass;
}else{if(lineView.node!=lineView.text){lineView.node.className="";}}var textClass=lineView.textClass?lineView.textClass+" "+(lineView.line.textClass||""):lineView.line.textClass;
lineView.text.className=textClass||"";}function updateLineGutter(cm,lineView,lineN,dims){if(lineView.gutter){lineView.node.removeChild(lineView.gutter);
lineView.gutter=null;}if(lineView.gutterBackground){lineView.node.removeChild(lineView.gutterBackground);
lineView.gutterBackground=null;}if(lineView.line.gutterClass){var wrap=ensureLineWrapped(lineView);lineView.gutterBackground=elt("div",null,"CodeMirror-gutter-background "+lineView.line.gutterClass,"left: "+(cm.options.fixedGutter?dims.fixedPos:-dims.gutterTotalWidth)+"px; width: "+dims.gutterTotalWidth+"px");
wrap.insertBefore(lineView.gutterBackground,lineView.text);}var markers=lineView.line.gutterMarkers;if(cm.options.lineNumbers||markers){var wrap=ensureLineWrapped(lineView);
var gutterWrap=lineView.gutter=elt("div",null,"CodeMirror-gutter-wrapper","left: "+(cm.options.fixedGutter?dims.fixedPos:-dims.gutterTotalWidth)+"px");
cm.display.input.setUneditable(gutterWrap);wrap.insertBefore(gutterWrap,lineView.text);if(lineView.line.gutterClass){gutterWrap.className+=" "+lineView.line.gutterClass;
}if(cm.options.lineNumbers&&(!markers||!markers["CodeMirror-linenumbers"])){lineView.lineNumber=gutterWrap.appendChild(elt("div",lineNumberFor(cm.options,lineN),"CodeMirror-linenumber CodeMirror-gutter-elt","left: "+dims.gutterLeft["CodeMirror-linenumbers"]+"px; width: "+cm.display.lineNumInnerWidth+"px"));
}if(markers){for(var k=0;k<cm.options.gutters.length;++k){var id=cm.options.gutters[k],found=markers.hasOwnProperty(id)&&markers[id];
if(found){gutterWrap.appendChild(elt("div",[found],"CodeMirror-gutter-elt","left: "+dims.gutterLeft[id]+"px; width: "+dims.gutterWidth[id]+"px"));
}}}}}function updateLineWidgets(cm,lineView,dims){if(lineView.alignable){lineView.alignable=null;}for(var node=lineView.node.firstChild,next;
node;node=next){var next=node.nextSibling;if(node.className=="CodeMirror-linewidget"){lineView.node.removeChild(node);
}}insertLineWidgets(cm,lineView,dims);}function buildLineElement(cm,lineView,lineN,dims){var built=getLineContent(cm,lineView);
lineView.text=lineView.node=built.pre;if(built.bgClass){lineView.bgClass=built.bgClass;}if(built.textClass){lineView.textClass=built.textClass;
}updateLineClasses(lineView);updateLineGutter(cm,lineView,lineN,dims);insertLineWidgets(cm,lineView,dims);
return lineView.node;}function insertLineWidgets(cm,lineView,dims){insertLineWidgetsFor(cm,lineView.line,lineView,dims,true);
if(lineView.rest){for(var i=0;i<lineView.rest.length;i++){insertLineWidgetsFor(cm,lineView.rest[i],lineView,dims,false);
}}}function insertLineWidgetsFor(cm,line,lineView,dims,allowAbove){if(!line.widgets){return;}var wrap=ensureLineWrapped(lineView);
for(var i=0,ws=line.widgets;i<ws.length;++i){var widget=ws[i],node=elt("div",[widget.node],"CodeMirror-linewidget");
if(!widget.handleMouseEvents){node.setAttribute("cm-ignore-events","true");}positionLineWidget(widget,node,lineView,dims);
cm.display.input.setUneditable(node);if(allowAbove&&widget.above){wrap.insertBefore(node,lineView.gutter||lineView.text);
}else{wrap.appendChild(node);}signalLater(widget,"redraw");}}function positionLineWidget(widget,node,lineView,dims){if(widget.noHScroll){(lineView.alignable||(lineView.alignable=[])).push(node);
var width=dims.wrapperWidth;node.style.left=dims.fixedPos+"px";if(!widget.coverGutter){width-=dims.gutterTotalWidth;
node.style.paddingLeft=dims.gutterTotalWidth+"px";}node.style.width=width+"px";}if(widget.coverGutter){node.style.zIndex=5;
node.style.position="relative";if(!widget.noHScroll){node.style.marginLeft=-dims.gutterTotalWidth+"px";
}}}var Pos=CodeMirror.Pos=function(line,ch){if(!(this instanceof Pos)){return new Pos(line,ch);}this.line=line;
this.ch=ch;};var cmp=CodeMirror.cmpPos=function(a,b){return a.line-b.line||a.ch-b.ch;};function copyPos(x){return Pos(x.line,x.ch);
}function maxPos(a,b){return cmp(a,b)<0?b:a;}function minPos(a,b){return cmp(a,b)<0?a:b;}function ensureFocus(cm){if(!cm.state.focused){cm.display.input.focus();
onFocus(cm);}}var lastCopied=null;function applyTextInput(cm,inserted,deleted,sel,origin){var doc=cm.doc;
cm.display.shift=false;if(!sel){sel=doc.sel;}var paste=cm.state.pasteIncoming||origin=="paste";var textLines=doc.splitLines(inserted),multiPaste=null;
if(paste&&sel.ranges.length>1){if(lastCopied&&lastCopied.text.join("\n")==inserted){if(sel.ranges.length%lastCopied.text.length==0){multiPaste=[];
for(var i=0;i<lastCopied.text.length;i++){multiPaste.push(doc.splitLines(lastCopied.text[i]));}}}else{if(textLines.length==sel.ranges.length){multiPaste=map(textLines,function(l){return[l];
});}}}for(var i=sel.ranges.length-1;i>=0;i--){var range=sel.ranges[i];var from=range.from(),to=range.to();
if(range.empty()){if(deleted&&deleted>0){from=Pos(from.line,from.ch-deleted);}else{if(cm.state.overwrite&&!paste){to=Pos(to.line,Math.min(getLine(doc,to.line).text.length,to.ch+lst(textLines).length));
}else{if(lastCopied&&lastCopied.lineWise&&lastCopied.text.join("\n")==inserted){from=to=Pos(from.line,0);
}}}}var updateInput=cm.curOp.updateInput;var changeEvent={from:from,to:to,text:multiPaste?multiPaste[i%multiPaste.length]:textLines,origin:origin||(paste?"paste":cm.state.cutIncoming?"cut":"+input")};
makeChange(cm.doc,changeEvent);signalLater(cm,"inputRead",cm,changeEvent);}if(inserted&&!paste){triggerElectric(cm,inserted);
}ensureCursorVisible(cm);cm.curOp.updateInput=updateInput;cm.curOp.typing=true;cm.state.pasteIncoming=cm.state.cutIncoming=false;
}function handlePaste(e,cm){var pasted=e.clipboardData&&e.clipboardData.getData("Text");if(pasted){e.preventDefault();
if(!cm.isReadOnly()&&!cm.options.disableInput){runInOp(cm,function(){applyTextInput(cm,pasted,0,null,"paste");
});}return true;}}function triggerElectric(cm,inserted){if(!cm.options.electricChars||!cm.options.smartIndent){return;
}var sel=cm.doc.sel;for(var i=sel.ranges.length-1;i>=0;i--){var range=sel.ranges[i];if(range.head.ch>100||(i&&sel.ranges[i-1].head.line==range.head.line)){continue;
}var mode=cm.getModeAt(range.head);var indented=false;if(mode.electricChars){for(var j=0;j<mode.electricChars.length;
j++){if(inserted.indexOf(mode.electricChars.charAt(j))>-1){indented=indentLine(cm,range.head.line,"smart");
break;}}}else{if(mode.electricInput){if(mode.electricInput.test(getLine(cm.doc,range.head.line).text.slice(0,range.head.ch))){indented=indentLine(cm,range.head.line,"smart");
}}}if(indented){signalLater(cm,"electricInput",cm,range.head.line);}}}function copyableRanges(cm){var text=[],ranges=[];
for(var i=0;i<cm.doc.sel.ranges.length;i++){var line=cm.doc.sel.ranges[i].head.line;var lineRange={anchor:Pos(line,0),head:Pos(line+1,0)};
ranges.push(lineRange);text.push(cm.getRange(lineRange.anchor,lineRange.head));}return{text:text,ranges:ranges};
}function disableBrowserMagic(field,spellcheck){field.setAttribute("autocorrect","off");field.setAttribute("autocapitalize","off");
field.setAttribute("spellcheck",!!spellcheck);}function TextareaInput(cm){this.cm=cm;this.prevInput="";
this.pollingFast=false;this.polling=new Delayed();this.inaccurateSelection=false;this.hasSelection=false;
this.composing=null;}function hiddenTextarea(){var te=elt("textarea",null,null,"position: absolute; bottom: -1em; padding: 0; width: 1px; height: 1em; outline: none");
var div=elt("div",[te],null,"overflow: hidden; position: relative; width: 3px; height: 0px;");if(webkit){te.style.width="1000px";
}else{te.setAttribute("wrap","off");}if(ios){te.style.border="1px solid black";}disableBrowserMagic(te);
return div;}TextareaInput.prototype=copyObj({init:function(display){var input=this,cm=this.cm;var div=this.wrapper=hiddenTextarea();
var te=this.textarea=div.firstChild;display.wrapper.insertBefore(div,display.wrapper.firstChild);if(ios){te.style.width="0px";
}on(te,"input",function(){if(ie&&ie_version>=9&&input.hasSelection){input.hasSelection=null;}input.poll();
});on(te,"paste",function(e){if(signalDOMEvent(cm,e)||handlePaste(e,cm)){return;}cm.state.pasteIncoming=true;
input.fastPoll();});function prepareCopyCut(e){if(signalDOMEvent(cm,e)){return;}if(cm.somethingSelected()){lastCopied={lineWise:false,text:cm.getSelections()};
if(input.inaccurateSelection){input.prevInput="";input.inaccurateSelection=false;te.value=lastCopied.text.join("\n");
selectInput(te);}}else{if(!cm.options.lineWiseCopyCut){return;}else{var ranges=copyableRanges(cm);lastCopied={lineWise:true,text:ranges.text};
if(e.type=="cut"){cm.setSelections(ranges.ranges,null,sel_dontScroll);}else{input.prevInput="";te.value=ranges.text.join("\n");
selectInput(te);}}}if(e.type=="cut"){cm.state.cutIncoming=true;}}on(te,"cut",prepareCopyCut);on(te,"copy",prepareCopyCut);
on(display.scroller,"paste",function(e){if(eventInWidget(display,e)||signalDOMEvent(cm,e)){return;}cm.state.pasteIncoming=true;
input.focus();});on(display.lineSpace,"selectstart",function(e){if(!eventInWidget(display,e)){e_preventDefault(e);
}});on(te,"compositionstart",function(){var start=cm.getCursor("from");if(input.composing){input.composing.range.clear();
}input.composing={start:start,range:cm.markText(start,cm.getCursor("to"),{className:"CodeMirror-composing"})};
});on(te,"compositionend",function(){if(input.composing){input.poll();input.composing.range.clear();input.composing=null;
}});},prepareSelection:function(){var cm=this.cm,display=cm.display,doc=cm.doc;var result=prepareSelection(cm);
if(cm.options.moveInputWithCursor){var headPos=cursorCoords(cm,doc.sel.primary().head,"div");var wrapOff=display.wrapper.getBoundingClientRect(),lineOff=display.lineDiv.getBoundingClientRect();
result.teTop=Math.max(0,Math.min(display.wrapper.clientHeight-10,headPos.top+lineOff.top-wrapOff.top));
result.teLeft=Math.max(0,Math.min(display.wrapper.clientWidth-10,headPos.left+lineOff.left-wrapOff.left));
}return result;},showSelection:function(drawn){var cm=this.cm,display=cm.display;removeChildrenAndAdd(display.cursorDiv,drawn.cursors);
removeChildrenAndAdd(display.selectionDiv,drawn.selection);if(drawn.teTop!=null){this.wrapper.style.top=drawn.teTop+"px";
this.wrapper.style.left=drawn.teLeft+"px";}},reset:function(typing){if(this.contextMenuPending){return;
}var minimal,selected,cm=this.cm,doc=cm.doc;if(cm.somethingSelected()){this.prevInput="";var range=doc.sel.primary();
minimal=hasCopyEvent&&(range.to().line-range.from().line>100||(selected=cm.getSelection()).length>1000);
var content=minimal?"-":selected||cm.getSelection();this.textarea.value=content;if(cm.state.focused){selectInput(this.textarea);
}if(ie&&ie_version>=9){this.hasSelection=content;}}else{if(!typing){this.prevInput=this.textarea.value="";
if(ie&&ie_version>=9){this.hasSelection=null;}}}this.inaccurateSelection=minimal;},getField:function(){return this.textarea;
},supportsTouch:function(){return false;},focus:function(){if(this.cm.options.readOnly!="nocursor"&&(!mobile||activeElt()!=this.textarea)){try{this.textarea.focus();
}catch(e){}}},blur:function(){this.textarea.blur();},resetPosition:function(){this.wrapper.style.top=this.wrapper.style.left=0;
},receivedFocus:function(){this.slowPoll();},slowPoll:function(){var input=this;if(input.pollingFast){return;
}input.polling.set(this.cm.options.pollInterval,function(){input.poll();if(input.cm.state.focused){input.slowPoll();
}});},fastPoll:function(){var missed=false,input=this;input.pollingFast=true;function p(){var changed=input.poll();
if(!changed&&!missed){missed=true;input.polling.set(60,p);}else{input.pollingFast=false;input.slowPoll();
}}input.polling.set(20,p);},poll:function(){var cm=this.cm,input=this.textarea,prevInput=this.prevInput;
if(this.contextMenuPending||!cm.state.focused||(hasSelection(input)&&!prevInput&&!this.composing)||cm.isReadOnly()||cm.options.disableInput||cm.state.keySeq){return false;
}var text=input.value;if(text==prevInput&&!cm.somethingSelected()){return false;}if(ie&&ie_version>=9&&this.hasSelection===text||mac&&/[\uf700-\uf7ff]/.test(text)){cm.display.input.reset();
return false;}if(cm.doc.sel==cm.display.selForContextMenu){var first=text.charCodeAt(0);if(first==8203&&!prevInput){prevInput="\u200b";
}if(first==8666){this.reset();return this.cm.execCommand("undo");}}var same=0,l=Math.min(prevInput.length,text.length);
while(same<l&&prevInput.charCodeAt(same)==text.charCodeAt(same)){++same;}var self=this;runInOp(cm,function(){applyTextInput(cm,text.slice(same),prevInput.length-same,null,self.composing?"*compose":null);
if(text.length>1000||text.indexOf("\n")>-1){input.value=self.prevInput="";}else{self.prevInput=text;}if(self.composing){self.composing.range.clear();
self.composing.range=cm.markText(self.composing.start,cm.getCursor("to"),{className:"CodeMirror-composing"});
}});return true;},ensurePolled:function(){if(this.pollingFast&&this.poll()){this.pollingFast=false;}},onKeyPress:function(){if(ie&&ie_version>=9){this.hasSelection=null;
}this.fastPoll();},onContextMenu:function(e){var input=this,cm=input.cm,display=cm.display,te=input.textarea;
var pos=posFromMouse(cm,e),scrollPos=display.scroller.scrollTop;if(!pos||presto){return;}var reset=cm.options.resetSelectionOnContextMenu;
if(reset&&cm.doc.sel.contains(pos)==-1){operation(cm,setSelection)(cm.doc,simpleSelection(pos),sel_dontScroll);
}var oldCSS=te.style.cssText,oldWrapperCSS=input.wrapper.style.cssText;input.wrapper.style.cssText="position: absolute";
var wrapperBox=input.wrapper.getBoundingClientRect();te.style.cssText="position: absolute; width: 30px; height: 30px; top: "+(e.clientY-wrapperBox.top-5)+"px; left: "+(e.clientX-wrapperBox.left-5)+"px; z-index: 1000; background: "+(ie?"rgba(255, 255, 255, .05)":"transparent")+"; outline: none; border-width: 0; outline: none; overflow: hidden; opacity: .05; filter: alpha(opacity=5);";
if(webkit){var oldScrollY=window.scrollY;}display.input.focus();if(webkit){window.scrollTo(null,oldScrollY);
}display.input.reset();if(!cm.somethingSelected()){te.value=input.prevInput=" ";}input.contextMenuPending=true;
display.selForContextMenu=cm.doc.sel;clearTimeout(display.detectingSelectAll);function prepareSelectAllHack(){if(te.selectionStart!=null){var selected=cm.somethingSelected();
var extval="\u200b"+(selected?te.value:"");te.value="\u21da";te.value=extval;input.prevInput=selected?"":"\u200b";
te.selectionStart=1;te.selectionEnd=extval.length;display.selForContextMenu=cm.doc.sel;}}function rehide(){input.contextMenuPending=false;
input.wrapper.style.cssText=oldWrapperCSS;te.style.cssText=oldCSS;if(ie&&ie_version<9){display.scrollbars.setScrollTop(display.scroller.scrollTop=scrollPos);
}if(te.selectionStart!=null){if(!ie||(ie&&ie_version<9)){prepareSelectAllHack();}var i=0,poll=function(){if(display.selForContextMenu==cm.doc.sel&&te.selectionStart==0&&te.selectionEnd>0&&input.prevInput=="\u200b"){operation(cm,commands.selectAll)(cm);
}else{if(i++<10){display.detectingSelectAll=setTimeout(poll,500);}else{display.input.reset();}}};display.detectingSelectAll=setTimeout(poll,200);
}}if(ie&&ie_version>=9){prepareSelectAllHack();}if(captureRightClick){e_stop(e);var mouseup=function(){off(window,"mouseup",mouseup);
setTimeout(rehide,20);};on(window,"mouseup",mouseup);}else{setTimeout(rehide,50);}},readOnlyChanged:function(val){if(!val){this.reset();
}},setUneditable:nothing,needsContentAttribute:false},TextareaInput.prototype);function ContentEditableInput(cm){this.cm=cm;
this.lastAnchorNode=this.lastAnchorOffset=this.lastFocusNode=this.lastFocusOffset=null;this.polling=new Delayed();
this.gracePeriod=false;}ContentEditableInput.prototype=copyObj({init:function(display){var input=this,cm=input.cm;
var div=input.div=display.lineDiv;disableBrowserMagic(div,cm.options.spellcheck);on(div,"paste",function(e){if(signalDOMEvent(cm,e)||handlePaste(e,cm)){return;
}if(ie_version<=11){setTimeout(operation(cm,function(){if(!input.pollContent()){regChange(cm);}}),20);
}});on(div,"compositionstart",function(e){var data=e.data;input.composing={sel:cm.doc.sel,data:data,startData:data};
if(!data){return;}var prim=cm.doc.sel.primary();var line=cm.getLine(prim.head.line);var found=line.indexOf(data,Math.max(0,prim.head.ch-data.length));
if(found>-1&&found<=prim.head.ch){input.composing.sel=simpleSelection(Pos(prim.head.line,found),Pos(prim.head.line,found+data.length));
}});on(div,"compositionupdate",function(e){input.composing.data=e.data;});on(div,"compositionend",function(e){var ours=input.composing;
if(!ours){return;}if(e.data!=ours.startData&&!/\u200b/.test(e.data)){ours.data=e.data;}setTimeout(function(){if(!ours.handled){input.applyComposition(ours);
}if(input.composing==ours){input.composing=null;}},50);});on(div,"touchstart",function(){input.forceCompositionEnd();
});on(div,"input",function(){if(input.composing){return;}if(cm.isReadOnly()||!input.pollContent()){runInOp(input.cm,function(){regChange(cm);
});}});function onCopyCut(e){if(signalDOMEvent(cm,e)){return;}if(cm.somethingSelected()){lastCopied={lineWise:false,text:cm.getSelections()};
if(e.type=="cut"){cm.replaceSelection("",null,"cut");}}else{if(!cm.options.lineWiseCopyCut){return;}else{var ranges=copyableRanges(cm);
lastCopied={lineWise:true,text:ranges.text};if(e.type=="cut"){cm.operation(function(){cm.setSelections(ranges.ranges,0,sel_dontScroll);
cm.replaceSelection("",null,"cut");});}}}if(e.clipboardData){e.clipboardData.clearData();var content=lastCopied.text.join("\n");
e.clipboardData.setData("Text",content);if(e.clipboardData.getData("Text")==content){e.preventDefault();
return;}}var kludge=hiddenTextarea(),te=kludge.firstChild;cm.display.lineSpace.insertBefore(kludge,cm.display.lineSpace.firstChild);
te.value=lastCopied.text.join("\n");var hadFocus=document.activeElement;selectInput(te);setTimeout(function(){cm.display.lineSpace.removeChild(kludge);
hadFocus.focus();if(hadFocus==div){input.showPrimarySelection();}},50);}on(div,"copy",onCopyCut);on(div,"cut",onCopyCut);
},prepareSelection:function(){var result=prepareSelection(this.cm,false);result.focus=this.cm.state.focused;
return result;},showSelection:function(info,takeFocus){if(!info||!this.cm.display.view.length){return;
}if(info.focus||takeFocus){this.showPrimarySelection();}this.showMultipleSelections(info);},showPrimarySelection:function(){var sel=window.getSelection(),prim=this.cm.doc.sel.primary();
var curAnchor=domToPos(this.cm,sel.anchorNode,sel.anchorOffset);var curFocus=domToPos(this.cm,sel.focusNode,sel.focusOffset);
if(curAnchor&&!curAnchor.bad&&curFocus&&!curFocus.bad&&cmp(minPos(curAnchor,curFocus),prim.from())==0&&cmp(maxPos(curAnchor,curFocus),prim.to())==0){return;
}var start=posToDOM(this.cm,prim.from());var end=posToDOM(this.cm,prim.to());if(!start&&!end){return;
}var view=this.cm.display.view;var old=sel.rangeCount&&sel.getRangeAt(0);if(!start){start={node:view[0].measure.map[2],offset:0};
}else{if(!end){var measure=view[view.length-1].measure;var map=measure.maps?measure.maps[measure.maps.length-1]:measure.map;
end={node:map[map.length-1],offset:map[map.length-2]-map[map.length-3]};}}try{var rng=range(start.node,start.offset,end.offset,end.node);
}catch(e){}if(rng){if(!gecko&&this.cm.state.focused){sel.collapse(start.node,start.offset);if(!rng.collapsed){sel.addRange(rng);
}}else{sel.removeAllRanges();sel.addRange(rng);}if(old&&sel.anchorNode==null){sel.addRange(old);}else{if(gecko){this.startGracePeriod();
}}}this.rememberSelection();},startGracePeriod:function(){var input=this;clearTimeout(this.gracePeriod);
this.gracePeriod=setTimeout(function(){input.gracePeriod=false;if(input.selectionChanged()){input.cm.operation(function(){input.cm.curOp.selectionChanged=true;
});}},20);},showMultipleSelections:function(info){removeChildrenAndAdd(this.cm.display.cursorDiv,info.cursors);
removeChildrenAndAdd(this.cm.display.selectionDiv,info.selection);},rememberSelection:function(){var sel=window.getSelection();
this.lastAnchorNode=sel.anchorNode;this.lastAnchorOffset=sel.anchorOffset;this.lastFocusNode=sel.focusNode;
this.lastFocusOffset=sel.focusOffset;},selectionInEditor:function(){var sel=window.getSelection();if(!sel.rangeCount){return false;
}var node=sel.getRangeAt(0).commonAncestorContainer;return contains(this.div,node);},focus:function(){if(this.cm.options.readOnly!="nocursor"){this.div.focus();
}},blur:function(){this.div.blur();},getField:function(){return this.div;},supportsTouch:function(){return true;
},receivedFocus:function(){var input=this;if(this.selectionInEditor()){this.pollSelection();}else{runInOp(this.cm,function(){input.cm.curOp.selectionChanged=true;
});}function poll(){if(input.cm.state.focused){input.pollSelection();input.polling.set(input.cm.options.pollInterval,poll);
}}this.polling.set(this.cm.options.pollInterval,poll);},selectionChanged:function(){var sel=window.getSelection();
return sel.anchorNode!=this.lastAnchorNode||sel.anchorOffset!=this.lastAnchorOffset||sel.focusNode!=this.lastFocusNode||sel.focusOffset!=this.lastFocusOffset;
},pollSelection:function(){if(!this.composing&&!this.gracePeriod&&this.selectionChanged()){var sel=window.getSelection(),cm=this.cm;
this.rememberSelection();var anchor=domToPos(cm,sel.anchorNode,sel.anchorOffset);var head=domToPos(cm,sel.focusNode,sel.focusOffset);
if(anchor&&head){runInOp(cm,function(){setSelection(cm.doc,simpleSelection(anchor,head),sel_dontScroll);
if(anchor.bad||head.bad){cm.curOp.selectionChanged=true;}});}}},pollContent:function(){var cm=this.cm,display=cm.display,sel=cm.doc.sel.primary();
var from=sel.from(),to=sel.to();if(from.line<display.viewFrom||to.line>display.viewTo-1){return false;
}var fromIndex;if(from.line==display.viewFrom||(fromIndex=findViewIndex(cm,from.line))==0){var fromLine=lineNo(display.view[0].line);
var fromNode=display.view[0].node;}else{var fromLine=lineNo(display.view[fromIndex].line);var fromNode=display.view[fromIndex-1].node.nextSibling;
}var toIndex=findViewIndex(cm,to.line);if(toIndex==display.view.length-1){var toLine=display.viewTo-1;
var toNode=display.lineDiv.lastChild;}else{var toLine=lineNo(display.view[toIndex+1].line)-1;var toNode=display.view[toIndex+1].node.previousSibling;
}var newText=cm.doc.splitLines(domTextBetween(cm,fromNode,toNode,fromLine,toLine));var oldText=getBetween(cm.doc,Pos(fromLine,0),Pos(toLine,getLine(cm.doc,toLine).text.length));
while(newText.length>1&&oldText.length>1){if(lst(newText)==lst(oldText)){newText.pop();oldText.pop();
toLine--;}else{if(newText[0]==oldText[0]){newText.shift();oldText.shift();fromLine++;}else{break;}}}var cutFront=0,cutEnd=0;
var newTop=newText[0],oldTop=oldText[0],maxCutFront=Math.min(newTop.length,oldTop.length);while(cutFront<maxCutFront&&newTop.charCodeAt(cutFront)==oldTop.charCodeAt(cutFront)){++cutFront;
}var newBot=lst(newText),oldBot=lst(oldText);var maxCutEnd=Math.min(newBot.length-(newText.length==1?cutFront:0),oldBot.length-(oldText.length==1?cutFront:0));
while(cutEnd<maxCutEnd&&newBot.charCodeAt(newBot.length-cutEnd-1)==oldBot.charCodeAt(oldBot.length-cutEnd-1)){++cutEnd;
}newText[newText.length-1]=newBot.slice(0,newBot.length-cutEnd);newText[0]=newText[0].slice(cutFront);
var chFrom=Pos(fromLine,cutFront);var chTo=Pos(toLine,oldText.length?lst(oldText).length-cutEnd:0);if(newText.length>1||newText[0]||cmp(chFrom,chTo)){replaceRange(cm.doc,newText,chFrom,chTo,"+input");
return true;}},ensurePolled:function(){this.forceCompositionEnd();},reset:function(){this.forceCompositionEnd();
},forceCompositionEnd:function(){if(!this.composing||this.composing.handled){return;}this.applyComposition(this.composing);
this.composing.handled=true;this.div.blur();this.div.focus();},applyComposition:function(composing){if(this.cm.isReadOnly()){operation(this.cm,regChange)(this.cm);
}else{if(composing.data&&composing.data!=composing.startData){operation(this.cm,applyTextInput)(this.cm,composing.data,0,composing.sel);
}}},setUneditable:function(node){node.contentEditable="false";},onKeyPress:function(e){e.preventDefault();
if(!this.cm.isReadOnly()){operation(this.cm,applyTextInput)(this.cm,String.fromCharCode(e.charCode==null?e.keyCode:e.charCode),0);
}},readOnlyChanged:function(val){this.div.contentEditable=String(val!="nocursor");},onContextMenu:nothing,resetPosition:nothing,needsContentAttribute:true},ContentEditableInput.prototype);
function posToDOM(cm,pos){var view=findViewForLine(cm,pos.line);if(!view||view.hidden){return null;}var line=getLine(cm.doc,pos.line);
var info=mapFromLineView(view,line,pos.line);var order=getOrder(line),side="left";if(order){var partPos=getBidiPartAt(order,pos.ch);
side=partPos%2?"right":"left";}var result=nodeAndOffsetInLineMap(info.map,pos.ch,side);result.offset=result.collapse=="right"?result.end:result.start;
return result;}function badPos(pos,bad){if(bad){pos.bad=true;}return pos;}function domToPos(cm,node,offset){var lineNode;
if(node==cm.display.lineDiv){lineNode=cm.display.lineDiv.childNodes[offset];if(!lineNode){return badPos(cm.clipPos(Pos(cm.display.viewTo-1)),true);
}node=null;offset=0;}else{for(lineNode=node;;lineNode=lineNode.parentNode){if(!lineNode||lineNode==cm.display.lineDiv){return null;
}if(lineNode.parentNode&&lineNode.parentNode==cm.display.lineDiv){break;}}}for(var i=0;i<cm.display.view.length;
i++){var lineView=cm.display.view[i];if(lineView.node==lineNode){return locateNodeInLineView(lineView,node,offset);
}}}function locateNodeInLineView(lineView,node,offset){var wrapper=lineView.text.firstChild,bad=false;
if(!node||!contains(wrapper,node)){return badPos(Pos(lineNo(lineView.line),0),true);}if(node==wrapper){bad=true;
node=wrapper.childNodes[offset];offset=0;if(!node){var line=lineView.rest?lst(lineView.rest):lineView.line;
return badPos(Pos(lineNo(line),line.text.length),bad);}}var textNode=node.nodeType==3?node:null,topNode=node;
if(!textNode&&node.childNodes.length==1&&node.firstChild.nodeType==3){textNode=node.firstChild;if(offset){offset=textNode.nodeValue.length;
}}while(topNode.parentNode!=wrapper){topNode=topNode.parentNode;}var measure=lineView.measure,maps=measure.maps;
function find(textNode,topNode,offset){for(var i=-1;i<(maps?maps.length:0);i++){var map=i<0?measure.map:maps[i];
for(var j=0;j<map.length;j+=3){var curNode=map[j+2];if(curNode==textNode||curNode==topNode){var line=lineNo(i<0?lineView.line:lineView.rest[i]);
var ch=map[j]+offset;if(offset<0||curNode!=textNode){ch=map[j+(offset?1:0)];}return Pos(line,ch);}}}}var found=find(textNode,topNode,offset);
if(found){return badPos(found,bad);}for(var after=topNode.nextSibling,dist=textNode?textNode.nodeValue.length-offset:0;
after;after=after.nextSibling){found=find(after,after.firstChild,0);if(found){return badPos(Pos(found.line,found.ch-dist),bad);
}else{dist+=after.textContent.length;}}for(var before=topNode.previousSibling,dist=offset;before;before=before.previousSibling){found=find(before,before.firstChild,-1);
if(found){return badPos(Pos(found.line,found.ch+dist),bad);}else{dist+=before.textContent.length;}}}function domTextBetween(cm,from,to,fromLine,toLine){var text="",closing=false,lineSep=cm.doc.lineSeparator();
function recognizeMarker(id){return function(marker){return marker.id==id;};}function walk(node){if(node.nodeType==1){var cmText=node.getAttribute("cm-text");
if(cmText!=null){if(cmText==""){cmText=node.textContent.replace(/\u200b/g,"");}text+=cmText;return;}var markerID=node.getAttribute("cm-marker"),range;
if(markerID){var found=cm.findMarks(Pos(fromLine,0),Pos(toLine+1,0),recognizeMarker(+markerID));if(found.length&&(range=found[0].find())){text+=getBetween(cm.doc,range.from,range.to).join(lineSep);
}return;}if(node.getAttribute("contenteditable")=="false"){return;}for(var i=0;i<node.childNodes.length;
i++){walk(node.childNodes[i]);}if(/^(pre|div|p)$/i.test(node.nodeName)){closing=true;}}else{if(node.nodeType==3){var val=node.nodeValue;
if(!val){return;}if(closing){text+=lineSep;closing=false;}text+=val;}}}for(;;){walk(from);if(from==to){break;
}from=from.nextSibling;}return text;}CodeMirror.inputStyles={textarea:TextareaInput,contenteditable:ContentEditableInput};
function Selection(ranges,primIndex){this.ranges=ranges;this.primIndex=primIndex;}Selection.prototype={primary:function(){return this.ranges[this.primIndex];
},equals:function(other){if(other==this){return true;}if(other.primIndex!=this.primIndex||other.ranges.length!=this.ranges.length){return false;
}for(var i=0;i<this.ranges.length;i++){var here=this.ranges[i],there=other.ranges[i];if(cmp(here.anchor,there.anchor)!=0||cmp(here.head,there.head)!=0){return false;
}}return true;},deepCopy:function(){for(var out=[],i=0;i<this.ranges.length;i++){out[i]=new Range(copyPos(this.ranges[i].anchor),copyPos(this.ranges[i].head));
}return new Selection(out,this.primIndex);},somethingSelected:function(){for(var i=0;i<this.ranges.length;
i++){if(!this.ranges[i].empty()){return true;}}return false;},contains:function(pos,end){if(!end){end=pos;
}for(var i=0;i<this.ranges.length;i++){var range=this.ranges[i];if(cmp(end,range.from())>=0&&cmp(pos,range.to())<=0){return i;
}}return -1;}};function Range(anchor,head){this.anchor=anchor;this.head=head;}Range.prototype={from:function(){return minPos(this.anchor,this.head);
},to:function(){return maxPos(this.anchor,this.head);},empty:function(){return this.head.line==this.anchor.line&&this.head.ch==this.anchor.ch;
}};function normalizeSelection(ranges,primIndex){var prim=ranges[primIndex];ranges.sort(function(a,b){return cmp(a.from(),b.from());
});primIndex=indexOf(ranges,prim);for(var i=1;i<ranges.length;i++){var cur=ranges[i],prev=ranges[i-1];
if(cmp(prev.to(),cur.from())>=0){var from=minPos(prev.from(),cur.from()),to=maxPos(prev.to(),cur.to());
var inv=prev.empty()?cur.from()==cur.head:prev.from()==prev.head;if(i<=primIndex){--primIndex;}ranges.splice(--i,2,new Range(inv?to:from,inv?from:to));
}}return new Selection(ranges,primIndex);}function simpleSelection(anchor,head){return new Selection([new Range(anchor,head||anchor)],0);
}function clipLine(doc,n){return Math.max(doc.first,Math.min(n,doc.first+doc.size-1));}function clipPos(doc,pos){if(pos.line<doc.first){return Pos(doc.first,0);
}var last=doc.first+doc.size-1;if(pos.line>last){return Pos(last,getLine(doc,last).text.length);}return clipToLen(pos,getLine(doc,pos.line).text.length);
}function clipToLen(pos,linelen){var ch=pos.ch;if(ch==null||ch>linelen){return Pos(pos.line,linelen);
}else{if(ch<0){return Pos(pos.line,0);}else{return pos;}}}function isLine(doc,l){return l>=doc.first&&l<doc.first+doc.size;
}function clipPosArray(doc,array){for(var out=[],i=0;i<array.length;i++){out[i]=clipPos(doc,array[i]);
}return out;}function extendRange(doc,range,head,other){if(doc.cm&&doc.cm.display.shift||doc.extend){var anchor=range.anchor;
if(other){var posBefore=cmp(head,anchor)<0;if(posBefore!=(cmp(other,anchor)<0)){anchor=head;head=other;
}else{if(posBefore!=(cmp(head,other)<0)){head=other;}}}return new Range(anchor,head);}else{return new Range(other||head,head);
}}function extendSelection(doc,head,other,options){setSelection(doc,new Selection([extendRange(doc,doc.sel.primary(),head,other)],0),options);
}function extendSelections(doc,heads,options){for(var out=[],i=0;i<doc.sel.ranges.length;i++){out[i]=extendRange(doc,doc.sel.ranges[i],heads[i],null);
}var newSel=normalizeSelection(out,doc.sel.primIndex);setSelection(doc,newSel,options);}function replaceOneSelection(doc,i,range,options){var ranges=doc.sel.ranges.slice(0);
ranges[i]=range;setSelection(doc,normalizeSelection(ranges,doc.sel.primIndex),options);}function setSimpleSelection(doc,anchor,head,options){setSelection(doc,simpleSelection(anchor,head),options);
}function filterSelectionChange(doc,sel,options){var obj={ranges:sel.ranges,update:function(ranges){this.ranges=[];
for(var i=0;i<ranges.length;i++){this.ranges[i]=new Range(clipPos(doc,ranges[i].anchor),clipPos(doc,ranges[i].head));
}},origin:options&&options.origin};signal(doc,"beforeSelectionChange",doc,obj);if(doc.cm){signal(doc.cm,"beforeSelectionChange",doc.cm,obj);
}if(obj.ranges!=sel.ranges){return normalizeSelection(obj.ranges,obj.ranges.length-1);}else{return sel;
}}function setSelectionReplaceHistory(doc,sel,options){var done=doc.history.done,last=lst(done);if(last&&last.ranges){done[done.length-1]=sel;
setSelectionNoUndo(doc,sel,options);}else{setSelection(doc,sel,options);}}function setSelection(doc,sel,options){setSelectionNoUndo(doc,sel,options);
addSelectionToHistory(doc,doc.sel,doc.cm?doc.cm.curOp.id:NaN,options);}function setSelectionNoUndo(doc,sel,options){if(hasHandler(doc,"beforeSelectionChange")||doc.cm&&hasHandler(doc.cm,"beforeSelectionChange")){sel=filterSelectionChange(doc,sel,options);
}var bias=options&&options.bias||(cmp(sel.primary().head,doc.sel.primary().head)<0?-1:1);setSelectionInner(doc,skipAtomicInSelection(doc,sel,bias,true));
if(!(options&&options.scroll===false)&&doc.cm){ensureCursorVisible(doc.cm);}}function setSelectionInner(doc,sel){if(sel.equals(doc.sel)){return;
}doc.sel=sel;if(doc.cm){doc.cm.curOp.updateInput=doc.cm.curOp.selectionChanged=true;signalCursorActivity(doc.cm);
}signalLater(doc,"cursorActivity",doc);}function reCheckSelection(doc){setSelectionInner(doc,skipAtomicInSelection(doc,doc.sel,null,false),sel_dontScroll);
}function skipAtomicInSelection(doc,sel,bias,mayClear){var out;for(var i=0;i<sel.ranges.length;i++){var range=sel.ranges[i];
var old=sel.ranges.length==doc.sel.ranges.length&&doc.sel.ranges[i];var newAnchor=skipAtomic(doc,range.anchor,old&&old.anchor,bias,mayClear);
var newHead=skipAtomic(doc,range.head,old&&old.head,bias,mayClear);if(out||newAnchor!=range.anchor||newHead!=range.head){if(!out){out=sel.ranges.slice(0,i);
}out[i]=new Range(newAnchor,newHead);}}return out?normalizeSelection(out,sel.primIndex):sel;}function skipAtomicInner(doc,pos,oldPos,dir,mayClear){var line=getLine(doc,pos.line);
if(line.markedSpans){for(var i=0;i<line.markedSpans.length;++i){var sp=line.markedSpans[i],m=sp.marker;
if((sp.from==null||(m.inclusiveLeft?sp.from<=pos.ch:sp.from<pos.ch))&&(sp.to==null||(m.inclusiveRight?sp.to>=pos.ch:sp.to>pos.ch))){if(mayClear){signal(m,"beforeCursorEnter");
if(m.explicitlyCleared){if(!line.markedSpans){break;}else{--i;continue;}}}if(!m.atomic){continue;}if(oldPos){var near=m.find(dir<0?1:-1),diff;
if(dir<0?m.inclusiveRight:m.inclusiveLeft){near=movePos(doc,near,-dir,near&&near.line==pos.line?line:null);
}if(near&&near.line==pos.line&&(diff=cmp(near,oldPos))&&(dir<0?diff<0:diff>0)){return skipAtomicInner(doc,near,pos,dir,mayClear);
}}var far=m.find(dir<0?-1:1);if(dir<0?m.inclusiveLeft:m.inclusiveRight){far=movePos(doc,far,dir,far.line==pos.line?line:null);
}return far?skipAtomicInner(doc,far,pos,dir,mayClear):null;}}}return pos;}function skipAtomic(doc,pos,oldPos,bias,mayClear){var dir=bias||1;
var found=skipAtomicInner(doc,pos,oldPos,dir,mayClear)||(!mayClear&&skipAtomicInner(doc,pos,oldPos,dir,true))||skipAtomicInner(doc,pos,oldPos,-dir,mayClear)||(!mayClear&&skipAtomicInner(doc,pos,oldPos,-dir,true));
if(!found){doc.cantEdit=true;return Pos(doc.first,0);}return found;}function movePos(doc,pos,dir,line){if(dir<0&&pos.ch==0){if(pos.line>doc.first){return clipPos(doc,Pos(pos.line-1));
}else{return null;}}else{if(dir>0&&pos.ch==(line||getLine(doc,pos.line)).text.length){if(pos.line<doc.first+doc.size-1){return Pos(pos.line+1,0);
}else{return null;}}else{return new Pos(pos.line,pos.ch+dir);}}}function updateSelection(cm){cm.display.input.showSelection(cm.display.input.prepareSelection());
}function prepareSelection(cm,primary){var doc=cm.doc,result={};var curFragment=result.cursors=document.createDocumentFragment();
var selFragment=result.selection=document.createDocumentFragment();for(var i=0;i<doc.sel.ranges.length;
i++){if(primary===false&&i==doc.sel.primIndex){continue;}var range=doc.sel.ranges[i];if(range.from().line>=cm.display.viewTo||range.to().line<cm.display.viewFrom){continue;
}var collapsed=range.empty();if(collapsed||cm.options.showCursorWhenSelecting){drawSelectionCursor(cm,range.head,curFragment);
}if(!collapsed){drawSelectionRange(cm,range,selFragment);}}return result;}function drawSelectionCursor(cm,head,output){var pos=cursorCoords(cm,head,"div",null,null,!cm.options.singleCursorHeightPerLine);
var cursor=output.appendChild(elt("div","\u00a0","CodeMirror-cursor"));cursor.style.left=pos.left+"px";
cursor.style.top=pos.top+"px";cursor.style.height=Math.max(0,pos.bottom-pos.top)*cm.options.cursorHeight+"px";
if(pos.other){var otherCursor=output.appendChild(elt("div","\u00a0","CodeMirror-cursor CodeMirror-secondarycursor"));
otherCursor.style.display="";otherCursor.style.left=pos.other.left+"px";otherCursor.style.top=pos.other.top+"px";
otherCursor.style.height=(pos.other.bottom-pos.other.top)*0.85+"px";}}function drawSelectionRange(cm,range,output){var display=cm.display,doc=cm.doc;
var fragment=document.createDocumentFragment();var padding=paddingH(cm.display),leftSide=padding.left;
var rightSide=Math.max(display.sizerWidth,displayWidth(cm)-display.sizer.offsetLeft)-padding.right;function add(left,top,width,bottom){if(top<0){top=0;
}top=Math.round(top);bottom=Math.round(bottom);fragment.appendChild(elt("div",null,"CodeMirror-selected","position: absolute; left: "+left+"px; top: "+top+"px; width: "+(width==null?rightSide-left:width)+"px; height: "+(bottom-top)+"px"));
}function drawForLine(line,fromArg,toArg){var lineObj=getLine(doc,line);var lineLen=lineObj.text.length;
var start,end;function coords(ch,bias){return charCoords(cm,Pos(line,ch),"div",lineObj,bias);}iterateBidiSections(getOrder(lineObj),fromArg||0,toArg==null?lineLen:toArg,function(from,to,dir){var leftPos=coords(from,"left"),rightPos,left,right;
if(from==to){rightPos=leftPos;left=right=leftPos.left;}else{rightPos=coords(to-1,"right");if(dir=="rtl"){var tmp=leftPos;
leftPos=rightPos;rightPos=tmp;}left=leftPos.left;right=rightPos.right;}if(fromArg==null&&from==0){left=leftSide;
}if(rightPos.top-leftPos.top>3){add(left,leftPos.top,null,leftPos.bottom);left=leftSide;if(leftPos.bottom<rightPos.top){add(left,leftPos.bottom,null,rightPos.top);
}}if(toArg==null&&to==lineLen){right=rightSide;}if(!start||leftPos.top<start.top||leftPos.top==start.top&&leftPos.left<start.left){start=leftPos;
}if(!end||rightPos.bottom>end.bottom||rightPos.bottom==end.bottom&&rightPos.right>end.right){end=rightPos;
}if(left<leftSide+1){left=leftSide;}add(left,rightPos.top,right-left,rightPos.bottom);});return{start:start,end:end};
}var sFrom=range.from(),sTo=range.to();if(sFrom.line==sTo.line){drawForLine(sFrom.line,sFrom.ch,sTo.ch);
}else{var fromLine=getLine(doc,sFrom.line),toLine=getLine(doc,sTo.line);var singleVLine=visualLine(fromLine)==visualLine(toLine);
var leftEnd=drawForLine(sFrom.line,sFrom.ch,singleVLine?fromLine.text.length+1:null).end;var rightStart=drawForLine(sTo.line,singleVLine?0:null,sTo.ch).start;
if(singleVLine){if(leftEnd.top<rightStart.top-2){add(leftEnd.right,leftEnd.top,null,leftEnd.bottom);add(leftSide,rightStart.top,rightStart.left,rightStart.bottom);
}else{add(leftEnd.right,leftEnd.top,rightStart.left-leftEnd.right,leftEnd.bottom);}}if(leftEnd.bottom<rightStart.top){add(leftSide,leftEnd.bottom,null,rightStart.top);
}}output.appendChild(fragment);}function restartBlink(cm){if(!cm.state.focused){return;}var display=cm.display;
clearInterval(display.blinker);var on=true;display.cursorDiv.style.visibility="";if(cm.options.cursorBlinkRate>0){display.blinker=setInterval(function(){display.cursorDiv.style.visibility=(on=!on)?"":"hidden";
},cm.options.cursorBlinkRate);}else{if(cm.options.cursorBlinkRate<0){display.cursorDiv.style.visibility="hidden";
}}}function startWorker(cm,time){if(cm.doc.mode.startState&&cm.doc.frontier<cm.display.viewTo){cm.state.highlight.set(time,bind(highlightWorker,cm));
}}function highlightWorker(cm){var doc=cm.doc;if(doc.frontier<doc.first){doc.frontier=doc.first;}if(doc.frontier>=cm.display.viewTo){return;
}var end=+new Date+cm.options.workTime;var state=copyState(doc.mode,getStateBefore(cm,doc.frontier));
var changedLines=[];doc.iter(doc.frontier,Math.min(doc.first+doc.size,cm.display.viewTo+500),function(line){if(doc.frontier>=cm.display.viewFrom){var oldStyles=line.styles,tooLong=line.text.length>cm.options.maxHighlightLength;
var highlighted=highlightLine(cm,line,tooLong?copyState(doc.mode,state):state,true);line.styles=highlighted.styles;
var oldCls=line.styleClasses,newCls=highlighted.classes;if(newCls){line.styleClasses=newCls;}else{if(oldCls){line.styleClasses=null;
}}var ischange=!oldStyles||oldStyles.length!=line.styles.length||oldCls!=newCls&&(!oldCls||!newCls||oldCls.bgClass!=newCls.bgClass||oldCls.textClass!=newCls.textClass);
for(var i=0;!ischange&&i<oldStyles.length;++i){ischange=oldStyles[i]!=line.styles[i];}if(ischange){changedLines.push(doc.frontier);
}line.stateAfter=tooLong?state:copyState(doc.mode,state);}else{if(line.text.length<=cm.options.maxHighlightLength){processLine(cm,line.text,state);
}line.stateAfter=doc.frontier%5==0?copyState(doc.mode,state):null;}++doc.frontier;if(+new Date>end){startWorker(cm,cm.options.workDelay);
return true;}});if(changedLines.length){runInOp(cm,function(){for(var i=0;i<changedLines.length;i++){regLineChange(cm,changedLines[i],"text");
}});}}function findStartLine(cm,n,precise){var minindent,minline,doc=cm.doc;var lim=precise?-1:n-(cm.doc.mode.innerMode?1000:100);
for(var search=n;search>lim;--search){if(search<=doc.first){return doc.first;}var line=getLine(doc,search-1);
if(line.stateAfter&&(!precise||search<=doc.frontier)){return search;}var indented=countColumn(line.text,null,cm.options.tabSize);
if(minline==null||minindent>indented){minline=search-1;minindent=indented;}}return minline;}function getStateBefore(cm,n,precise){var doc=cm.doc,display=cm.display;
if(!doc.mode.startState){return true;}var pos=findStartLine(cm,n,precise),state=pos>doc.first&&getLine(doc,pos-1).stateAfter;
if(!state){state=startState(doc.mode);}else{state=copyState(doc.mode,state);}doc.iter(pos,n,function(line){processLine(cm,line.text,state);
var save=pos==n-1||pos%5==0||pos>=display.viewFrom&&pos<display.viewTo;line.stateAfter=save?copyState(doc.mode,state):null;
++pos;});if(precise){doc.frontier=pos;}return state;}function paddingTop(display){return display.lineSpace.offsetTop;
}function paddingVert(display){return display.mover.offsetHeight-display.lineSpace.offsetHeight;}function paddingH(display){if(display.cachedPaddingH){return display.cachedPaddingH;
}var e=removeChildrenAndAdd(display.measure,elt("pre","x"));var style=window.getComputedStyle?window.getComputedStyle(e):e.currentStyle;
var data={left:parseInt(style.paddingLeft),right:parseInt(style.paddingRight)};if(!isNaN(data.left)&&!isNaN(data.right)){display.cachedPaddingH=data;
}return data;}function scrollGap(cm){return scrollerGap-cm.display.nativeBarWidth;}function displayWidth(cm){return cm.display.scroller.clientWidth-scrollGap(cm)-cm.display.barWidth;
}function displayHeight(cm){return cm.display.scroller.clientHeight-scrollGap(cm)-cm.display.barHeight;
}function ensureLineHeights(cm,lineView,rect){var wrapping=cm.options.lineWrapping;var curWidth=wrapping&&displayWidth(cm);
if(!lineView.measure.heights||wrapping&&lineView.measure.width!=curWidth){var heights=lineView.measure.heights=[];
if(wrapping){lineView.measure.width=curWidth;var rects=lineView.text.firstChild.getClientRects();for(var i=0;
i<rects.length-1;i++){var cur=rects[i],next=rects[i+1];if(Math.abs(cur.bottom-next.bottom)>2){heights.push((cur.bottom+next.top)/2-rect.top);
}}}heights.push(rect.bottom-rect.top);}}function mapFromLineView(lineView,line,lineN){if(lineView.line==line){return{map:lineView.measure.map,cache:lineView.measure.cache};
}for(var i=0;i<lineView.rest.length;i++){if(lineView.rest[i]==line){return{map:lineView.measure.maps[i],cache:lineView.measure.caches[i]};
}}for(var i=0;i<lineView.rest.length;i++){if(lineNo(lineView.rest[i])>lineN){return{map:lineView.measure.maps[i],cache:lineView.measure.caches[i],before:true};
}}}function updateExternalMeasurement(cm,line){line=visualLine(line);var lineN=lineNo(line);var view=cm.display.externalMeasured=new LineView(cm.doc,line,lineN);
view.lineN=lineN;var built=view.built=buildLineContent(cm,view);view.text=built.pre;removeChildrenAndAdd(cm.display.lineMeasure,built.pre);
return view;}function measureChar(cm,line,ch,bias){return measureCharPrepared(cm,prepareMeasureForLine(cm,line),ch,bias);
}function findViewForLine(cm,lineN){if(lineN>=cm.display.viewFrom&&lineN<cm.display.viewTo){return cm.display.view[findViewIndex(cm,lineN)];
}var ext=cm.display.externalMeasured;if(ext&&lineN>=ext.lineN&&lineN<ext.lineN+ext.size){return ext;}}function prepareMeasureForLine(cm,line){var lineN=lineNo(line);
var view=findViewForLine(cm,lineN);if(view&&!view.text){view=null;}else{if(view&&view.changes){updateLineForChanges(cm,view,lineN,getDimensions(cm));
cm.curOp.forceUpdate=true;}}if(!view){view=updateExternalMeasurement(cm,line);}var info=mapFromLineView(view,line,lineN);
return{line:line,view:view,rect:null,map:info.map,cache:info.cache,before:info.before,hasHeights:false};
}function measureCharPrepared(cm,prepared,ch,bias,varHeight){if(prepared.before){ch=-1;}var key=ch+(bias||""),found;
if(prepared.cache.hasOwnProperty(key)){found=prepared.cache[key];}else{if(!prepared.rect){prepared.rect=prepared.view.text.getBoundingClientRect();
}if(!prepared.hasHeights){ensureLineHeights(cm,prepared.view,prepared.rect);prepared.hasHeights=true;
}found=measureCharInner(cm,prepared,ch,bias);if(!found.bogus){prepared.cache[key]=found;}}return{left:found.left,right:found.right,top:varHeight?found.rtop:found.top,bottom:varHeight?found.rbottom:found.bottom};
}var nullRect={left:0,right:0,top:0,bottom:0};function nodeAndOffsetInLineMap(map,ch,bias){var node,start,end,collapse;
for(var i=0;i<map.length;i+=3){var mStart=map[i],mEnd=map[i+1];if(ch<mStart){start=0;end=1;collapse="left";
}else{if(ch<mEnd){start=ch-mStart;end=start+1;}else{if(i==map.length-3||ch==mEnd&&map[i+3]>ch){end=mEnd-mStart;
start=end-1;if(ch>=mEnd){collapse="right";}}}}if(start!=null){node=map[i+2];if(mStart==mEnd&&bias==(node.insertLeft?"left":"right")){collapse=bias;
}if(bias=="left"&&start==0){while(i&&map[i-2]==map[i-3]&&map[i-1].insertLeft){node=map[(i-=3)+2];collapse="left";
}}if(bias=="right"&&start==mEnd-mStart){while(i<map.length-3&&map[i+3]==map[i+4]&&!map[i+5].insertLeft){node=map[(i+=3)+2];
collapse="right";}}break;}}return{node:node,start:start,end:end,collapse:collapse,coverStart:mStart,coverEnd:mEnd};
}function getUsefulRect(rects,bias){var rect=nullRect;if(bias=="left"){for(var i=0;i<rects.length;i++){if((rect=rects[i]).left!=rect.right){break;
}}}else{for(var i=rects.length-1;i>=0;i--){if((rect=rects[i]).left!=rect.right){break;}}}return rect;
}function measureCharInner(cm,prepared,ch,bias){var place=nodeAndOffsetInLineMap(prepared.map,ch,bias);
var node=place.node,start=place.start,end=place.end,collapse=place.collapse;var rect;if(node.nodeType==3){for(var i=0;
i<4;i++){while(start&&isExtendingChar(prepared.line.text.charAt(place.coverStart+start))){--start;}while(place.coverStart+end<place.coverEnd&&isExtendingChar(prepared.line.text.charAt(place.coverStart+end))){++end;
}if(ie&&ie_version<9&&start==0&&end==place.coverEnd-place.coverStart){rect=node.parentNode.getBoundingClientRect();
}else{rect=getUsefulRect(range(node,start,end).getClientRects(),bias);}if(rect.left||rect.right||start==0){break;
}end=start;start=start-1;collapse="right";}if(ie&&ie_version<11){rect=maybeUpdateRectForZooming(cm.display.measure,rect);
}}else{if(start>0){collapse=bias="right";}var rects;if(cm.options.lineWrapping&&(rects=node.getClientRects()).length>1){rect=rects[bias=="right"?rects.length-1:0];
}else{rect=node.getBoundingClientRect();}}if(ie&&ie_version<9&&!start&&(!rect||!rect.left&&!rect.right)){var rSpan=node.parentNode.getClientRects()[0];
if(rSpan){rect={left:rSpan.left,right:rSpan.left+charWidth(cm.display),top:rSpan.top,bottom:rSpan.bottom};
}else{rect=nullRect;}}var rtop=rect.top-prepared.rect.top,rbot=rect.bottom-prepared.rect.top;var mid=(rtop+rbot)/2;
var heights=prepared.view.measure.heights;for(var i=0;i<heights.length-1;i++){if(mid<heights[i]){break;
}}var top=i?heights[i-1]:0,bot=heights[i];var result={left:(collapse=="right"?rect.right:rect.left)-prepared.rect.left,right:(collapse=="left"?rect.left:rect.right)-prepared.rect.left,top:top,bottom:bot};
if(!rect.left&&!rect.right){result.bogus=true;}if(!cm.options.singleCursorHeightPerLine){result.rtop=rtop;
result.rbottom=rbot;}return result;}function maybeUpdateRectForZooming(measure,rect){if(!window.screen||screen.logicalXDPI==null||screen.logicalXDPI==screen.deviceXDPI||!hasBadZoomedRects(measure)){return rect;
}var scaleX=screen.logicalXDPI/screen.deviceXDPI;var scaleY=screen.logicalYDPI/screen.deviceYDPI;return{left:rect.left*scaleX,right:rect.right*scaleX,top:rect.top*scaleY,bottom:rect.bottom*scaleY};
}function clearLineMeasurementCacheFor(lineView){if(lineView.measure){lineView.measure.cache={};lineView.measure.heights=null;
if(lineView.rest){for(var i=0;i<lineView.rest.length;i++){lineView.measure.caches[i]={};}}}}function clearLineMeasurementCache(cm){cm.display.externalMeasure=null;
removeChildren(cm.display.lineMeasure);for(var i=0;i<cm.display.view.length;i++){clearLineMeasurementCacheFor(cm.display.view[i]);
}}function clearCaches(cm){clearLineMeasurementCache(cm);cm.display.cachedCharWidth=cm.display.cachedTextHeight=cm.display.cachedPaddingH=null;
if(!cm.options.lineWrapping){cm.display.maxLineChanged=true;}cm.display.lineNumChars=null;}function pageScrollX(){return window.pageXOffset||(document.documentElement||document.body).scrollLeft;
}function pageScrollY(){return window.pageYOffset||(document.documentElement||document.body).scrollTop;
}function intoCoordSystem(cm,lineObj,rect,context){if(lineObj.widgets){for(var i=0;i<lineObj.widgets.length;
++i){if(lineObj.widgets[i].above){var size=widgetHeight(lineObj.widgets[i]);rect.top+=size;rect.bottom+=size;
}}}if(context=="line"){return rect;}if(!context){context="local";}var yOff=heightAtLine(lineObj);if(context=="local"){yOff+=paddingTop(cm.display);
}else{yOff-=cm.display.viewOffset;}if(context=="page"||context=="window"){var lOff=cm.display.lineSpace.getBoundingClientRect();
yOff+=lOff.top+(context=="window"?0:pageScrollY());var xOff=lOff.left+(context=="window"?0:pageScrollX());
rect.left+=xOff;rect.right+=xOff;}rect.top+=yOff;rect.bottom+=yOff;return rect;}function fromCoordSystem(cm,coords,context){if(context=="div"){return coords;
}var left=coords.left,top=coords.top;if(context=="page"){left-=pageScrollX();top-=pageScrollY();}else{if(context=="local"||!context){var localBox=cm.display.sizer.getBoundingClientRect();
left+=localBox.left;top+=localBox.top;}}var lineSpaceBox=cm.display.lineSpace.getBoundingClientRect();
return{left:left-lineSpaceBox.left,top:top-lineSpaceBox.top};}function charCoords(cm,pos,context,lineObj,bias){if(!lineObj){lineObj=getLine(cm.doc,pos.line);
}return intoCoordSystem(cm,lineObj,measureChar(cm,lineObj,pos.ch,bias),context);}function cursorCoords(cm,pos,context,lineObj,preparedMeasure,varHeight){lineObj=lineObj||getLine(cm.doc,pos.line);
if(!preparedMeasure){preparedMeasure=prepareMeasureForLine(cm,lineObj);}function get(ch,right){var m=measureCharPrepared(cm,preparedMeasure,ch,right?"right":"left",varHeight);
if(right){m.left=m.right;}else{m.right=m.left;}return intoCoordSystem(cm,lineObj,m,context);}function getBidi(ch,partPos){var part=order[partPos],right=part.level%2;
if(ch==bidiLeft(part)&&partPos&&part.level<order[partPos-1].level){part=order[--partPos];ch=bidiRight(part)-(part.level%2?0:1);
right=true;}else{if(ch==bidiRight(part)&&partPos<order.length-1&&part.level<order[partPos+1].level){part=order[++partPos];
ch=bidiLeft(part)-part.level%2;right=false;}}if(right&&ch==part.to&&ch>part.from){return get(ch-1);}return get(ch,right);
}var order=getOrder(lineObj),ch=pos.ch;if(!order){return get(ch);}var partPos=getBidiPartAt(order,ch);
var val=getBidi(ch,partPos);if(bidiOther!=null){val.other=getBidi(ch,bidiOther);}return val;}function estimateCoords(cm,pos){var left=0,pos=clipPos(cm.doc,pos);
if(!cm.options.lineWrapping){left=charWidth(cm.display)*pos.ch;}var lineObj=getLine(cm.doc,pos.line);
var top=heightAtLine(lineObj)+paddingTop(cm.display);return{left:left,right:left,top:top,bottom:top+lineObj.height};
}function PosWithInfo(line,ch,outside,xRel){var pos=Pos(line,ch);pos.xRel=xRel;if(outside){pos.outside=true;
}return pos;}function coordsChar(cm,x,y){var doc=cm.doc;y+=cm.display.viewOffset;if(y<0){return PosWithInfo(doc.first,0,true,-1);
}var lineN=lineAtHeight(doc,y),last=doc.first+doc.size-1;if(lineN>last){return PosWithInfo(doc.first+doc.size-1,getLine(doc,last).text.length,true,1);
}if(x<0){x=0;}var lineObj=getLine(doc,lineN);for(;;){var found=coordsCharInner(cm,lineObj,lineN,x,y);
var merged=collapsedSpanAtEnd(lineObj);var mergedPos=merged&&merged.find(0,true);if(merged&&(found.ch>mergedPos.from.ch||found.ch==mergedPos.from.ch&&found.xRel>0)){lineN=lineNo(lineObj=mergedPos.to.line);
}else{return found;}}}function coordsCharInner(cm,lineObj,lineNo,x,y){var innerOff=y-heightAtLine(lineObj);
var wrongLine=false,adjust=2*cm.display.wrapper.clientWidth;var preparedMeasure=prepareMeasureForLine(cm,lineObj);
function getX(ch){var sp=cursorCoords(cm,Pos(lineNo,ch),"line",lineObj,preparedMeasure);wrongLine=true;
if(innerOff>sp.bottom){return sp.left-adjust;}else{if(innerOff<sp.top){return sp.left+adjust;}else{wrongLine=false;
}}return sp.left;}var bidi=getOrder(lineObj),dist=lineObj.text.length;var from=lineLeft(lineObj),to=lineRight(lineObj);
var fromX=getX(from),fromOutside=wrongLine,toX=getX(to),toOutside=wrongLine;if(x>toX){return PosWithInfo(lineNo,to,toOutside,1);
}for(;;){if(bidi?to==from||to==moveVisually(lineObj,from,1):to-from<=1){var ch=x<fromX||x-fromX<=toX-x?from:to;
var outside=ch==from?fromOutside:toOutside;var xDiff=x-(ch==from?fromX:toX);if(toOutside&&!bidi&&!/\s/.test(lineObj.text.charAt(ch))&&xDiff>0&&ch<lineObj.text.length&&preparedMeasure.view.measure.heights.length>1){var charSize=measureCharPrepared(cm,preparedMeasure,ch,"right");
if(innerOff<=charSize.bottom&&innerOff>=charSize.top&&Math.abs(x-charSize.right)<xDiff){outside=false;
ch++;xDiff=x-charSize.right;}}while(isExtendingChar(lineObj.text.charAt(ch))){++ch;}var pos=PosWithInfo(lineNo,ch,outside,xDiff<-1?-1:xDiff>1?1:0);
return pos;}var step=Math.ceil(dist/2),middle=from+step;if(bidi){middle=from;for(var i=0;i<step;++i){middle=moveVisually(lineObj,middle,1);
}}var middleX=getX(middle);if(middleX>x){to=middle;toX=middleX;if(toOutside=wrongLine){toX+=1000;}dist=step;
}else{from=middle;fromX=middleX;fromOutside=wrongLine;dist-=step;}}}var measureText;function textHeight(display){if(display.cachedTextHeight!=null){return display.cachedTextHeight;
}if(measureText==null){measureText=elt("pre");for(var i=0;i<49;++i){measureText.appendChild(document.createTextNode("x"));
measureText.appendChild(elt("br"));}measureText.appendChild(document.createTextNode("x"));}removeChildrenAndAdd(display.measure,measureText);
var height=measureText.offsetHeight/50;if(height>3){display.cachedTextHeight=height;}removeChildren(display.measure);
return height||1;}function charWidth(display){if(display.cachedCharWidth!=null){return display.cachedCharWidth;
}var anchor=elt("span","xxxxxxxxxx");var pre=elt("pre",[anchor]);removeChildrenAndAdd(display.measure,pre);
var rect=anchor.getBoundingClientRect(),width=(rect.right-rect.left)/10;if(width>2){display.cachedCharWidth=width;
}return width||10;}var operationGroup=null;var nextOpId=0;function startOperation(cm){cm.curOp={cm:cm,viewChanged:false,startHeight:cm.doc.height,forceUpdate:false,updateInput:null,typing:false,changeObjs:null,cursorActivityHandlers:null,cursorActivityCalled:0,selectionChanged:false,updateMaxLine:false,scrollLeft:null,scrollTop:null,scrollToPos:null,focus:false,id:++nextOpId};
if(operationGroup){operationGroup.ops.push(cm.curOp);}else{cm.curOp.ownsGroup=operationGroup={ops:[cm.curOp],delayedCallbacks:[]};
}}function fireCallbacksForOps(group){var callbacks=group.delayedCallbacks,i=0;do{for(;i<callbacks.length;
i++){callbacks[i].call(null);}for(var j=0;j<group.ops.length;j++){var op=group.ops[j];if(op.cursorActivityHandlers){while(op.cursorActivityCalled<op.cursorActivityHandlers.length){op.cursorActivityHandlers[op.cursorActivityCalled++].call(null,op.cm);
}}}}while(i<callbacks.length);}function endOperation(cm){var op=cm.curOp,group=op.ownsGroup;if(!group){return;
}try{fireCallbacksForOps(group);}finally{operationGroup=null;for(var i=0;i<group.ops.length;i++){group.ops[i].cm.curOp=null;
}endOperations(group);}}function endOperations(group){var ops=group.ops;for(var i=0;i<ops.length;i++){endOperation_R1(ops[i]);
}for(var i=0;i<ops.length;i++){endOperation_W1(ops[i]);}for(var i=0;i<ops.length;i++){endOperation_R2(ops[i]);
}for(var i=0;i<ops.length;i++){endOperation_W2(ops[i]);}for(var i=0;i<ops.length;i++){endOperation_finish(ops[i]);
}}function endOperation_R1(op){var cm=op.cm,display=cm.display;maybeClipScrollbars(cm);if(op.updateMaxLine){findMaxLine(cm);
}op.mustUpdate=op.viewChanged||op.forceUpdate||op.scrollTop!=null||op.scrollToPos&&(op.scrollToPos.from.line<display.viewFrom||op.scrollToPos.to.line>=display.viewTo)||display.maxLineChanged&&cm.options.lineWrapping;
op.update=op.mustUpdate&&new DisplayUpdate(cm,op.mustUpdate&&{top:op.scrollTop,ensure:op.scrollToPos},op.forceUpdate);
}function endOperation_W1(op){op.updatedDisplay=op.mustUpdate&&updateDisplayIfNeeded(op.cm,op.update);
}function endOperation_R2(op){var cm=op.cm,display=cm.display;if(op.updatedDisplay){updateHeightsInViewport(cm);
}op.barMeasure=measureForScrollbars(cm);if(display.maxLineChanged&&!cm.options.lineWrapping){op.adjustWidthTo=measureChar(cm,display.maxLine,display.maxLine.text.length).left+3;
cm.display.sizerWidth=op.adjustWidthTo;op.barMeasure.scrollWidth=Math.max(display.scroller.clientWidth,display.sizer.offsetLeft+op.adjustWidthTo+scrollGap(cm)+cm.display.barWidth);
op.maxScrollLeft=Math.max(0,display.sizer.offsetLeft+op.adjustWidthTo-displayWidth(cm));}if(op.updatedDisplay||op.selectionChanged){op.preparedSelection=display.input.prepareSelection(op.focus);
}}function endOperation_W2(op){var cm=op.cm;if(op.adjustWidthTo!=null){cm.display.sizer.style.minWidth=op.adjustWidthTo+"px";
if(op.maxScrollLeft<cm.doc.scrollLeft){setScrollLeft(cm,Math.min(cm.display.scroller.scrollLeft,op.maxScrollLeft),true);
}cm.display.maxLineChanged=false;}var takeFocus=op.focus&&op.focus==activeElt()&&(!document.hasFocus||document.hasFocus());
if(op.preparedSelection){cm.display.input.showSelection(op.preparedSelection,takeFocus);}if(op.updatedDisplay||op.startHeight!=cm.doc.height){updateScrollbars(cm,op.barMeasure);
}if(op.updatedDisplay){setDocumentHeight(cm,op.barMeasure);}if(op.selectionChanged){restartBlink(cm);
}if(cm.state.focused&&op.updateInput){cm.display.input.reset(op.typing);}if(takeFocus){ensureFocus(op.cm);
}}function endOperation_finish(op){var cm=op.cm,display=cm.display,doc=cm.doc;if(op.updatedDisplay){postUpdateDisplay(cm,op.update);
}if(display.wheelStartX!=null&&(op.scrollTop!=null||op.scrollLeft!=null||op.scrollToPos)){display.wheelStartX=display.wheelStartY=null;
}if(op.scrollTop!=null&&(display.scroller.scrollTop!=op.scrollTop||op.forceScroll)){doc.scrollTop=Math.max(0,Math.min(display.scroller.scrollHeight-display.scroller.clientHeight,op.scrollTop));
display.scrollbars.setScrollTop(doc.scrollTop);display.scroller.scrollTop=doc.scrollTop;}if(op.scrollLeft!=null&&(display.scroller.scrollLeft!=op.scrollLeft||op.forceScroll)){doc.scrollLeft=Math.max(0,Math.min(display.scroller.scrollWidth-display.scroller.clientWidth,op.scrollLeft));
display.scrollbars.setScrollLeft(doc.scrollLeft);display.scroller.scrollLeft=doc.scrollLeft;alignHorizontally(cm);
}if(op.scrollToPos){var coords=scrollPosIntoView(cm,clipPos(doc,op.scrollToPos.from),clipPos(doc,op.scrollToPos.to),op.scrollToPos.margin);
if(op.scrollToPos.isCursor&&cm.state.focused){maybeScrollWindow(cm,coords);}}var hidden=op.maybeHiddenMarkers,unhidden=op.maybeUnhiddenMarkers;
if(hidden){for(var i=0;i<hidden.length;++i){if(!hidden[i].lines.length){signal(hidden[i],"hide");}}}if(unhidden){for(var i=0;
i<unhidden.length;++i){if(unhidden[i].lines.length){signal(unhidden[i],"unhide");}}}if(display.wrapper.offsetHeight){doc.scrollTop=cm.display.scroller.scrollTop;
}if(op.changeObjs){signal(cm,"changes",cm,op.changeObjs);}if(op.update){op.update.finish();}}function runInOp(cm,f){if(cm.curOp){return f();
}startOperation(cm);try{return f();}finally{endOperation(cm);}}function operation(cm,f){return function(){if(cm.curOp){return f.apply(cm,arguments);
}startOperation(cm);try{return f.apply(cm,arguments);}finally{endOperation(cm);}};}function methodOp(f){return function(){if(this.curOp){return f.apply(this,arguments);
}startOperation(this);try{return f.apply(this,arguments);}finally{endOperation(this);}};}function docMethodOp(f){return function(){var cm=this.cm;
if(!cm||cm.curOp){return f.apply(this,arguments);}startOperation(cm);try{return f.apply(this,arguments);
}finally{endOperation(cm);}};}function LineView(doc,line,lineN){this.line=line;this.rest=visualLineContinued(line);
this.size=this.rest?lineNo(lst(this.rest))-lineN+1:1;this.node=this.text=null;this.hidden=lineIsHidden(doc,line);
}function buildViewArray(cm,from,to){var array=[],nextPos;for(var pos=from;pos<to;pos=nextPos){var view=new LineView(cm.doc,getLine(cm.doc,pos),pos);
nextPos=pos+view.size;array.push(view);}return array;}function regChange(cm,from,to,lendiff){if(from==null){from=cm.doc.first;
}if(to==null){to=cm.doc.first+cm.doc.size;}if(!lendiff){lendiff=0;}var display=cm.display;if(lendiff&&to<display.viewTo&&(display.updateLineNumbers==null||display.updateLineNumbers>from)){display.updateLineNumbers=from;
}cm.curOp.viewChanged=true;if(from>=display.viewTo){if(sawCollapsedSpans&&visualLineNo(cm.doc,from)<display.viewTo){resetView(cm);
}}else{if(to<=display.viewFrom){if(sawCollapsedSpans&&visualLineEndNo(cm.doc,to+lendiff)>display.viewFrom){resetView(cm);
}else{display.viewFrom+=lendiff;display.viewTo+=lendiff;}}else{if(from<=display.viewFrom&&to>=display.viewTo){resetView(cm);
}else{if(from<=display.viewFrom){var cut=viewCuttingPoint(cm,to,to+lendiff,1);if(cut){display.view=display.view.slice(cut.index);
display.viewFrom=cut.lineN;display.viewTo+=lendiff;}else{resetView(cm);}}else{if(to>=display.viewTo){var cut=viewCuttingPoint(cm,from,from,-1);
if(cut){display.view=display.view.slice(0,cut.index);display.viewTo=cut.lineN;}else{resetView(cm);}}else{var cutTop=viewCuttingPoint(cm,from,from,-1);
var cutBot=viewCuttingPoint(cm,to,to+lendiff,1);if(cutTop&&cutBot){display.view=display.view.slice(0,cutTop.index).concat(buildViewArray(cm,cutTop.lineN,cutBot.lineN)).concat(display.view.slice(cutBot.index));
display.viewTo+=lendiff;}else{resetView(cm);}}}}}}var ext=display.externalMeasured;if(ext){if(to<ext.lineN){ext.lineN+=lendiff;
}else{if(from<ext.lineN+ext.size){display.externalMeasured=null;}}}}function regLineChange(cm,line,type){cm.curOp.viewChanged=true;
var display=cm.display,ext=cm.display.externalMeasured;if(ext&&line>=ext.lineN&&line<ext.lineN+ext.size){display.externalMeasured=null;
}if(line<display.viewFrom||line>=display.viewTo){return;}var lineView=display.view[findViewIndex(cm,line)];
if(lineView.node==null){return;}var arr=lineView.changes||(lineView.changes=[]);if(indexOf(arr,type)==-1){arr.push(type);
}}function resetView(cm){cm.display.viewFrom=cm.display.viewTo=cm.doc.first;cm.display.view=[];cm.display.viewOffset=0;
}function findViewIndex(cm,n){if(n>=cm.display.viewTo){return null;}n-=cm.display.viewFrom;if(n<0){return null;
}var view=cm.display.view;for(var i=0;i<view.length;i++){n-=view[i].size;if(n<0){return i;}}}function viewCuttingPoint(cm,oldN,newN,dir){var index=findViewIndex(cm,oldN),diff,view=cm.display.view;
if(!sawCollapsedSpans||newN==cm.doc.first+cm.doc.size){return{index:index,lineN:newN};}for(var i=0,n=cm.display.viewFrom;
i<index;i++){n+=view[i].size;}if(n!=oldN){if(dir>0){if(index==view.length-1){return null;}diff=(n+view[index].size)-oldN;
index++;}else{diff=n-oldN;}oldN+=diff;newN+=diff;}while(visualLineNo(cm.doc,newN)!=newN){if(index==(dir<0?0:view.length-1)){return null;
}newN+=dir*view[index-(dir<0?1:0)].size;index+=dir;}return{index:index,lineN:newN};}function adjustView(cm,from,to){var display=cm.display,view=display.view;
if(view.length==0||from>=display.viewTo||to<=display.viewFrom){display.view=buildViewArray(cm,from,to);
display.viewFrom=from;}else{if(display.viewFrom>from){display.view=buildViewArray(cm,from,display.viewFrom).concat(display.view);
}else{if(display.viewFrom<from){display.view=display.view.slice(findViewIndex(cm,from));}}display.viewFrom=from;
if(display.viewTo<to){display.view=display.view.concat(buildViewArray(cm,display.viewTo,to));}else{if(display.viewTo>to){display.view=display.view.slice(0,findViewIndex(cm,to));
}}}display.viewTo=to;}function countDirtyView(cm){var view=cm.display.view,dirty=0;for(var i=0;i<view.length;
i++){var lineView=view[i];if(!lineView.hidden&&(!lineView.node||lineView.changes)){++dirty;}}return dirty;
}function registerEventHandlers(cm){var d=cm.display;on(d.scroller,"mousedown",operation(cm,onMouseDown));
if(ie&&ie_version<11){on(d.scroller,"dblclick",operation(cm,function(e){if(signalDOMEvent(cm,e)){return;
}var pos=posFromMouse(cm,e);if(!pos||clickInGutter(cm,e)||eventInWidget(cm.display,e)){return;}e_preventDefault(e);
var word=cm.findWordAt(pos);extendSelection(cm.doc,word.anchor,word.head);}));}else{on(d.scroller,"dblclick",function(e){signalDOMEvent(cm,e)||e_preventDefault(e);
});}if(!captureRightClick){on(d.scroller,"contextmenu",function(e){onContextMenu(cm,e);});}var touchFinished,prevTouch={end:0};
function finishTouch(){if(d.activeTouch){touchFinished=setTimeout(function(){d.activeTouch=null;},1000);
prevTouch=d.activeTouch;prevTouch.end=+new Date;}}function isMouseLikeTouchEvent(e){if(e.touches.length!=1){return false;
}var touch=e.touches[0];return touch.radiusX<=1&&touch.radiusY<=1;}function farAway(touch,other){if(other.left==null){return true;
}var dx=other.left-touch.left,dy=other.top-touch.top;return dx*dx+dy*dy>20*20;}on(d.scroller,"touchstart",function(e){if(!signalDOMEvent(cm,e)&&!isMouseLikeTouchEvent(e)){clearTimeout(touchFinished);
var now=+new Date;d.activeTouch={start:now,moved:false,prev:now-prevTouch.end<=300?prevTouch:null};if(e.touches.length==1){d.activeTouch.left=e.touches[0].pageX;
d.activeTouch.top=e.touches[0].pageY;}}});on(d.scroller,"touchmove",function(){if(d.activeTouch){d.activeTouch.moved=true;
}});on(d.scroller,"touchend",function(e){var touch=d.activeTouch;if(touch&&!eventInWidget(d,e)&&touch.left!=null&&!touch.moved&&new Date-touch.start<300){var pos=cm.coordsChar(d.activeTouch,"page"),range;
if(!touch.prev||farAway(touch,touch.prev)){range=new Range(pos,pos);}else{if(!touch.prev.prev||farAway(touch,touch.prev.prev)){range=cm.findWordAt(pos);
}else{range=new Range(Pos(pos.line,0),clipPos(cm.doc,Pos(pos.line+1,0)));}}cm.setSelection(range.anchor,range.head);
cm.focus();e_preventDefault(e);}finishTouch();});on(d.scroller,"touchcancel",finishTouch);on(d.scroller,"scroll",function(){if(d.scroller.clientHeight){setScrollTop(cm,d.scroller.scrollTop);
setScrollLeft(cm,d.scroller.scrollLeft,true);signal(cm,"scroll",cm);}});on(d.scroller,"mousewheel",function(e){onScrollWheel(cm,e);
});on(d.scroller,"DOMMouseScroll",function(e){onScrollWheel(cm,e);});on(d.wrapper,"scroll",function(){d.wrapper.scrollTop=d.wrapper.scrollLeft=0;
});d.dragFunctions={enter:function(e){if(!signalDOMEvent(cm,e)){e_stop(e);}},over:function(e){if(!signalDOMEvent(cm,e)){onDragOver(cm,e);
e_stop(e);}},start:function(e){onDragStart(cm,e);},drop:operation(cm,onDrop),leave:function(e){if(!signalDOMEvent(cm,e)){clearDragCursor(cm);
}}};var inp=d.input.getField();on(inp,"keyup",function(e){onKeyUp.call(cm,e);});on(inp,"keydown",operation(cm,onKeyDown));
on(inp,"keypress",operation(cm,onKeyPress));on(inp,"focus",bind(onFocus,cm));on(inp,"blur",bind(onBlur,cm));
}function dragDropChanged(cm,value,old){var wasOn=old&&old!=CodeMirror.Init;if(!value!=!wasOn){var funcs=cm.display.dragFunctions;
var toggle=value?on:off;toggle(cm.display.scroller,"dragstart",funcs.start);toggle(cm.display.scroller,"dragenter",funcs.enter);
toggle(cm.display.scroller,"dragover",funcs.over);toggle(cm.display.scroller,"dragleave",funcs.leave);
toggle(cm.display.scroller,"drop",funcs.drop);}}function onResize(cm){var d=cm.display;if(d.lastWrapHeight==d.wrapper.clientHeight&&d.lastWrapWidth==d.wrapper.clientWidth){return;
}d.cachedCharWidth=d.cachedTextHeight=d.cachedPaddingH=null;d.scrollbarsClipped=false;cm.setSize();}function eventInWidget(display,e){for(var n=e_target(e);
n!=display.wrapper;n=n.parentNode){if(!n||(n.nodeType==1&&n.getAttribute("cm-ignore-events")=="true")||(n.parentNode==display.sizer&&n!=display.mover)){return true;
}}}function posFromMouse(cm,e,liberal,forRect){var display=cm.display;if(!liberal&&e_target(e).getAttribute("cm-not-content")=="true"){return null;
}var x,y,space=display.lineSpace.getBoundingClientRect();try{x=e.clientX-space.left;y=e.clientY-space.top;
}catch(e){return null;}var coords=coordsChar(cm,x,y),line;if(forRect&&coords.xRel==1&&(line=getLine(cm.doc,coords.line).text).length==coords.ch){var colDiff=countColumn(line,line.length,cm.options.tabSize)-line.length;
coords=Pos(coords.line,Math.max(0,Math.round((x-paddingH(cm.display).left)/charWidth(cm.display))-colDiff));
}return coords;}function onMouseDown(e){var cm=this,display=cm.display;if(signalDOMEvent(cm,e)||display.activeTouch&&display.input.supportsTouch()){return;
}display.shift=e.shiftKey;if(eventInWidget(display,e)){if(!webkit){display.scroller.draggable=false;setTimeout(function(){display.scroller.draggable=true;
},100);}return;}if(clickInGutter(cm,e)){return;}var start=posFromMouse(cm,e);window.focus();switch(e_button(e)){case 1:if(cm.state.selectingText){cm.state.selectingText(e);
}else{if(start){leftButtonDown(cm,e,start);}else{if(e_target(e)==display.scroller){e_preventDefault(e);
}}}break;case 2:if(webkit){cm.state.lastMiddleDown=+new Date;}if(start){extendSelection(cm.doc,start);
}setTimeout(function(){display.input.focus();},20);e_preventDefault(e);break;case 3:if(captureRightClick){onContextMenu(cm,e);
}else{delayBlurEvent(cm);}break;}}var lastClick,lastDoubleClick;function leftButtonDown(cm,e,start){if(ie){setTimeout(bind(ensureFocus,cm),0);
}else{cm.curOp.focus=activeElt();}var now=+new Date,type;if(lastDoubleClick&&lastDoubleClick.time>now-400&&cmp(lastDoubleClick.pos,start)==0){type="triple";
}else{if(lastClick&&lastClick.time>now-400&&cmp(lastClick.pos,start)==0){type="double";lastDoubleClick={time:now,pos:start};
}else{type="single";lastClick={time:now,pos:start};}}var sel=cm.doc.sel,modifier=mac?e.metaKey:e.ctrlKey,contained;
if(cm.options.dragDrop&&dragAndDrop&&!cm.isReadOnly()&&type=="single"&&(contained=sel.contains(start))>-1&&(cmp((contained=sel.ranges[contained]).from(),start)<0||start.xRel>0)&&(cmp(contained.to(),start)>0||start.xRel<0)){leftButtonStartDrag(cm,e,start,modifier);
}else{leftButtonSelect(cm,e,start,type,modifier);}}function leftButtonStartDrag(cm,e,start,modifier){var display=cm.display,startTime=+new Date;
var dragEnd=operation(cm,function(e2){if(webkit){display.scroller.draggable=false;}cm.state.draggingText=false;
off(document,"mouseup",dragEnd);off(display.scroller,"drop",dragEnd);if(Math.abs(e.clientX-e2.clientX)+Math.abs(e.clientY-e2.clientY)<10){e_preventDefault(e2);
if(!modifier&&+new Date-200<startTime){extendSelection(cm.doc,start);}if(webkit||ie&&ie_version==9){setTimeout(function(){document.body.focus();
display.input.focus();},20);}else{display.input.focus();}}});if(webkit){display.scroller.draggable=true;
}cm.state.draggingText=dragEnd;dragEnd.copy=mac?e.altKey:e.ctrlKey;if(display.scroller.dragDrop){display.scroller.dragDrop();
}on(document,"mouseup",dragEnd);on(display.scroller,"drop",dragEnd);}function leftButtonSelect(cm,e,start,type,addNew){var display=cm.display,doc=cm.doc;
e_preventDefault(e);var ourRange,ourIndex,startSel=doc.sel,ranges=startSel.ranges;if(addNew&&!e.shiftKey){ourIndex=doc.sel.contains(start);
if(ourIndex>-1){ourRange=ranges[ourIndex];}else{ourRange=new Range(start,start);}}else{ourRange=doc.sel.primary();
ourIndex=doc.sel.primIndex;}if(chromeOS?e.shiftKey&&e.metaKey:e.altKey){type="rect";if(!addNew){ourRange=new Range(start,start);
}start=posFromMouse(cm,e,true,true);ourIndex=-1;}else{if(type=="double"){var word=cm.findWordAt(start);
if(cm.display.shift||doc.extend){ourRange=extendRange(doc,ourRange,word.anchor,word.head);}else{ourRange=word;
}}else{if(type=="triple"){var line=new Range(Pos(start.line,0),clipPos(doc,Pos(start.line+1,0)));if(cm.display.shift||doc.extend){ourRange=extendRange(doc,ourRange,line.anchor,line.head);
}else{ourRange=line;}}else{ourRange=extendRange(doc,ourRange,start);}}}if(!addNew){ourIndex=0;setSelection(doc,new Selection([ourRange],0),sel_mouse);
startSel=doc.sel;}else{if(ourIndex==-1){ourIndex=ranges.length;setSelection(doc,normalizeSelection(ranges.concat([ourRange]),ourIndex),{scroll:false,origin:"*mouse"});
}else{if(ranges.length>1&&ranges[ourIndex].empty()&&type=="single"&&!e.shiftKey){setSelection(doc,normalizeSelection(ranges.slice(0,ourIndex).concat(ranges.slice(ourIndex+1)),0),{scroll:false,origin:"*mouse"});
startSel=doc.sel;}else{replaceOneSelection(doc,ourIndex,ourRange,sel_mouse);}}}var lastPos=start;function extendTo(pos){if(cmp(lastPos,pos)==0){return;
}lastPos=pos;if(type=="rect"){var ranges=[],tabSize=cm.options.tabSize;var startCol=countColumn(getLine(doc,start.line).text,start.ch,tabSize);
var posCol=countColumn(getLine(doc,pos.line).text,pos.ch,tabSize);var left=Math.min(startCol,posCol),right=Math.max(startCol,posCol);
for(var line=Math.min(start.line,pos.line),end=Math.min(cm.lastLine(),Math.max(start.line,pos.line));
line<=end;line++){var text=getLine(doc,line).text,leftPos=findColumn(text,left,tabSize);if(left==right){ranges.push(new Range(Pos(line,leftPos),Pos(line,leftPos)));
}else{if(text.length>leftPos){ranges.push(new Range(Pos(line,leftPos),Pos(line,findColumn(text,right,tabSize))));
}}}if(!ranges.length){ranges.push(new Range(start,start));}setSelection(doc,normalizeSelection(startSel.ranges.slice(0,ourIndex).concat(ranges),ourIndex),{origin:"*mouse",scroll:false});
cm.scrollIntoView(pos);}else{var oldRange=ourRange;var anchor=oldRange.anchor,head=pos;if(type!="single"){if(type=="double"){var range=cm.findWordAt(pos);
}else{var range=new Range(Pos(pos.line,0),clipPos(doc,Pos(pos.line+1,0)));}if(cmp(range.anchor,anchor)>0){head=range.head;
anchor=minPos(oldRange.from(),range.anchor);}else{head=range.anchor;anchor=maxPos(oldRange.to(),range.head);
}}var ranges=startSel.ranges.slice(0);ranges[ourIndex]=new Range(clipPos(doc,anchor),head);setSelection(doc,normalizeSelection(ranges,ourIndex),sel_mouse);
}}var editorSize=display.wrapper.getBoundingClientRect();var counter=0;function extend(e){var curCount=++counter;
var cur=posFromMouse(cm,e,true,type=="rect");if(!cur){return;}if(cmp(cur,lastPos)!=0){cm.curOp.focus=activeElt();
extendTo(cur);var visible=visibleLines(display,doc);if(cur.line>=visible.to||cur.line<visible.from){setTimeout(operation(cm,function(){if(counter==curCount){extend(e);
}}),150);}}else{var outside=e.clientY<editorSize.top?-20:e.clientY>editorSize.bottom?20:0;if(outside){setTimeout(operation(cm,function(){if(counter!=curCount){return;
}display.scroller.scrollTop+=outside;extend(e);}),50);}}}function done(e){cm.state.selectingText=false;
counter=Infinity;e_preventDefault(e);display.input.focus();off(document,"mousemove",move);off(document,"mouseup",up);
doc.history.lastSelOrigin=null;}var move=operation(cm,function(e){if(!e_button(e)){done(e);}else{extend(e);
}});var up=operation(cm,done);cm.state.selectingText=up;on(document,"mousemove",move);on(document,"mouseup",up);
}function gutterEvent(cm,e,type,prevent){try{var mX=e.clientX,mY=e.clientY;}catch(e){return false;}if(mX>=Math.floor(cm.display.gutters.getBoundingClientRect().right)){return false;
}if(prevent){e_preventDefault(e);}var display=cm.display;var lineBox=display.lineDiv.getBoundingClientRect();
if(mY>lineBox.bottom||!hasHandler(cm,type)){return e_defaultPrevented(e);}mY-=lineBox.top-display.viewOffset;
for(var i=0;i<cm.options.gutters.length;++i){var g=display.gutters.childNodes[i];if(g&&g.getBoundingClientRect().right>=mX){var line=lineAtHeight(cm.doc,mY);
var gutter=cm.options.gutters[i];signal(cm,type,cm,line,gutter,e);return e_defaultPrevented(e);}}}function clickInGutter(cm,e){return gutterEvent(cm,e,"gutterClick",true);
}var lastDrop=0;function onDrop(e){var cm=this;clearDragCursor(cm);if(signalDOMEvent(cm,e)||eventInWidget(cm.display,e)){return;
}e_preventDefault(e);if(ie){lastDrop=+new Date;}var pos=posFromMouse(cm,e,true),files=e.dataTransfer.files;
if(!pos||cm.isReadOnly()){return;}if(files&&files.length&&window.FileReader&&window.File){var n=files.length,text=Array(n),read=0;
var loadFile=function(file,i){if(cm.options.allowDropFileTypes&&indexOf(cm.options.allowDropFileTypes,file.type)==-1){return;
}var reader=new FileReader;reader.onload=operation(cm,function(){var content=reader.result;if(/[\x00-\x08\x0e-\x1f]{2}/.test(content)){content="";
}text[i]=content;if(++read==n){pos=clipPos(cm.doc,pos);var change={from:pos,to:pos,text:cm.doc.splitLines(text.join(cm.doc.lineSeparator())),origin:"paste"};
makeChange(cm.doc,change);setSelectionReplaceHistory(cm.doc,simpleSelection(pos,changeEnd(change)));}});
reader.readAsText(file);};for(var i=0;i<n;++i){loadFile(files[i],i);}}else{if(cm.state.draggingText&&cm.doc.sel.contains(pos)>-1){cm.state.draggingText(e);
setTimeout(function(){cm.display.input.focus();},20);return;}try{var text=e.dataTransfer.getData("Text");
if(text){if(cm.state.draggingText&&!cm.state.draggingText.copy){var selected=cm.listSelections();}setSelectionNoUndo(cm.doc,simpleSelection(pos,pos));
if(selected){for(var i=0;i<selected.length;++i){replaceRange(cm.doc,"",selected[i].anchor,selected[i].head,"drag");
}}cm.replaceSelection(text,"around","paste");cm.display.input.focus();}}catch(e){}}}function onDragStart(cm,e){if(ie&&(!cm.state.draggingText||+new Date-lastDrop<100)){e_stop(e);
return;}if(signalDOMEvent(cm,e)||eventInWidget(cm.display,e)){return;}e.dataTransfer.setData("Text",cm.getSelection());
e.dataTransfer.effectAllowed="copyMove";if(e.dataTransfer.setDragImage&&!safari){var img=elt("img",null,null,"position: fixed; left: 0; top: 0;");
img.src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==";if(presto){img.width=img.height=1;
cm.display.wrapper.appendChild(img);img._top=img.offsetTop;}e.dataTransfer.setDragImage(img,0,0);if(presto){img.parentNode.removeChild(img);
}}}function onDragOver(cm,e){var pos=posFromMouse(cm,e);if(!pos){return;}var frag=document.createDocumentFragment();
drawSelectionCursor(cm,pos,frag);if(!cm.display.dragCursor){cm.display.dragCursor=elt("div",null,"CodeMirror-cursors CodeMirror-dragcursors");
cm.display.lineSpace.insertBefore(cm.display.dragCursor,cm.display.cursorDiv);}removeChildrenAndAdd(cm.display.dragCursor,frag);
}function clearDragCursor(cm){if(cm.display.dragCursor){cm.display.lineSpace.removeChild(cm.display.dragCursor);
cm.display.dragCursor=null;}}function setScrollTop(cm,val){if(Math.abs(cm.doc.scrollTop-val)<2){return;
}cm.doc.scrollTop=val;if(!gecko){updateDisplaySimple(cm,{top:val});}if(cm.display.scroller.scrollTop!=val){cm.display.scroller.scrollTop=val;
}cm.display.scrollbars.setScrollTop(val);if(gecko){updateDisplaySimple(cm);}startWorker(cm,100);}function setScrollLeft(cm,val,isScroller){if(isScroller?val==cm.doc.scrollLeft:Math.abs(cm.doc.scrollLeft-val)<2){return;
}val=Math.min(val,cm.display.scroller.scrollWidth-cm.display.scroller.clientWidth);cm.doc.scrollLeft=val;
alignHorizontally(cm);if(cm.display.scroller.scrollLeft!=val){cm.display.scroller.scrollLeft=val;}cm.display.scrollbars.setScrollLeft(val);
}var wheelSamples=0,wheelPixelsPerUnit=null;if(ie){wheelPixelsPerUnit=-0.53;}else{if(gecko){wheelPixelsPerUnit=15;
}else{if(chrome){wheelPixelsPerUnit=-0.7;}else{if(safari){wheelPixelsPerUnit=-1/3;}}}}var wheelEventDelta=function(e){var dx=e.wheelDeltaX,dy=e.wheelDeltaY;
if(dx==null&&e.detail&&e.axis==e.HORIZONTAL_AXIS){dx=e.detail;}if(dy==null&&e.detail&&e.axis==e.VERTICAL_AXIS){dy=e.detail;
}else{if(dy==null){dy=e.wheelDelta;}}return{x:dx,y:dy};};CodeMirror.wheelEventPixels=function(e){var delta=wheelEventDelta(e);
delta.x*=wheelPixelsPerUnit;delta.y*=wheelPixelsPerUnit;return delta;};function onScrollWheel(cm,e){var delta=wheelEventDelta(e),dx=delta.x,dy=delta.y;
var display=cm.display,scroll=display.scroller;var canScrollX=scroll.scrollWidth>scroll.clientWidth;var canScrollY=scroll.scrollHeight>scroll.clientHeight;
if(!(dx&&canScrollX||dy&&canScrollY)){return;}if(dy&&mac&&webkit){outer:for(var cur=e.target,view=display.view;
cur!=scroll;cur=cur.parentNode){for(var i=0;i<view.length;i++){if(view[i].node==cur){cm.display.currentWheelTarget=cur;
break outer;}}}}if(dx&&!gecko&&!presto&&wheelPixelsPerUnit!=null){if(dy&&canScrollY){setScrollTop(cm,Math.max(0,Math.min(scroll.scrollTop+dy*wheelPixelsPerUnit,scroll.scrollHeight-scroll.clientHeight)));
}setScrollLeft(cm,Math.max(0,Math.min(scroll.scrollLeft+dx*wheelPixelsPerUnit,scroll.scrollWidth-scroll.clientWidth)));
if(!dy||(dy&&canScrollY)){e_preventDefault(e);}display.wheelStartX=null;return;}if(dy&&wheelPixelsPerUnit!=null){var pixels=dy*wheelPixelsPerUnit;
var top=cm.doc.scrollTop,bot=top+display.wrapper.clientHeight;if(pixels<0){top=Math.max(0,top+pixels-50);
}else{bot=Math.min(cm.doc.height,bot+pixels+50);}updateDisplaySimple(cm,{top:top,bottom:bot});}if(wheelSamples<20){if(display.wheelStartX==null){display.wheelStartX=scroll.scrollLeft;
display.wheelStartY=scroll.scrollTop;display.wheelDX=dx;display.wheelDY=dy;setTimeout(function(){if(display.wheelStartX==null){return;
}var movedX=scroll.scrollLeft-display.wheelStartX;var movedY=scroll.scrollTop-display.wheelStartY;var sample=(movedY&&display.wheelDY&&movedY/display.wheelDY)||(movedX&&display.wheelDX&&movedX/display.wheelDX);
display.wheelStartX=display.wheelStartY=null;if(!sample){return;}wheelPixelsPerUnit=(wheelPixelsPerUnit*wheelSamples+sample)/(wheelSamples+1);
++wheelSamples;},200);}else{display.wheelDX+=dx;display.wheelDY+=dy;}}}function doHandleBinding(cm,bound,dropShift){if(typeof bound=="string"){bound=commands[bound];
if(!bound){return false;}}cm.display.input.ensurePolled();var prevShift=cm.display.shift,done=false;try{if(cm.isReadOnly()){cm.state.suppressEdits=true;
}if(dropShift){cm.display.shift=false;}done=bound(cm)!=Pass;}finally{cm.display.shift=prevShift;cm.state.suppressEdits=false;
}return done;}function lookupKeyForEditor(cm,name,handle){for(var i=0;i<cm.state.keyMaps.length;i++){var result=lookupKey(name,cm.state.keyMaps[i],handle,cm);
if(result){return result;}}return(cm.options.extraKeys&&lookupKey(name,cm.options.extraKeys,handle,cm))||lookupKey(name,cm.options.keyMap,handle,cm);
}var stopSeq=new Delayed;function dispatchKey(cm,name,e,handle){var seq=cm.state.keySeq;if(seq){if(isModifierKey(name)){return"handled";
}stopSeq.set(50,function(){if(cm.state.keySeq==seq){cm.state.keySeq=null;cm.display.input.reset();}});
name=seq+" "+name;}var result=lookupKeyForEditor(cm,name,handle);if(result=="multi"){cm.state.keySeq=name;
}if(result=="handled"){signalLater(cm,"keyHandled",cm,name,e);}if(result=="handled"||result=="multi"){e_preventDefault(e);
restartBlink(cm);}if(seq&&!result&&/\'$/.test(name)){e_preventDefault(e);return true;}return !!result;
}function handleKeyBinding(cm,e){var name=keyName(e,true);if(!name){return false;}if(e.shiftKey&&!cm.state.keySeq){return dispatchKey(cm,"Shift-"+name,e,function(b){return doHandleBinding(cm,b,true);
})||dispatchKey(cm,name,e,function(b){if(typeof b=="string"?/^go[A-Z]/.test(b):b.motion){return doHandleBinding(cm,b);
}});}else{return dispatchKey(cm,name,e,function(b){return doHandleBinding(cm,b);});}}function handleCharBinding(cm,e,ch){return dispatchKey(cm,"'"+ch+"'",e,function(b){return doHandleBinding(cm,b,true);
});}var lastStoppedKey=null;function onKeyDown(e){var cm=this;cm.curOp.focus=activeElt();if(signalDOMEvent(cm,e)){return;
}if(ie&&ie_version<11&&e.keyCode==27){e.returnValue=false;}var code=e.keyCode;cm.display.shift=code==16||e.shiftKey;
var handled=handleKeyBinding(cm,e);if(presto){lastStoppedKey=handled?code:null;if(!handled&&code==88&&!hasCopyEvent&&(mac?e.metaKey:e.ctrlKey)){cm.replaceSelection("",null,"cut");
}}if(code==18&&!/\bCodeMirror-crosshair\b/.test(cm.display.lineDiv.className)){showCrossHair(cm);}}function showCrossHair(cm){var lineDiv=cm.display.lineDiv;
addClass(lineDiv,"CodeMirror-crosshair");function up(e){if(e.keyCode==18||!e.altKey){rmClass(lineDiv,"CodeMirror-crosshair");
off(document,"keyup",up);off(document,"mouseover",up);}}on(document,"keyup",up);on(document,"mouseover",up);
}function onKeyUp(e){if(e.keyCode==16){this.doc.sel.shift=false;}signalDOMEvent(this,e);}function onKeyPress(e){var cm=this;
if(eventInWidget(cm.display,e)||signalDOMEvent(cm,e)||e.ctrlKey&&!e.altKey||mac&&e.metaKey){return;}var keyCode=e.keyCode,charCode=e.charCode;
if(presto&&keyCode==lastStoppedKey){lastStoppedKey=null;e_preventDefault(e);return;}if((presto&&(!e.which||e.which<10))&&handleKeyBinding(cm,e)){return;
}var ch=String.fromCharCode(charCode==null?keyCode:charCode);if(handleCharBinding(cm,e,ch)){return;}cm.display.input.onKeyPress(e);
}function delayBlurEvent(cm){cm.state.delayingBlurEvent=true;setTimeout(function(){if(cm.state.delayingBlurEvent){cm.state.delayingBlurEvent=false;
onBlur(cm);}},100);}function onFocus(cm){if(cm.state.delayingBlurEvent){cm.state.delayingBlurEvent=false;
}if(cm.options.readOnly=="nocursor"){return;}if(!cm.state.focused){signal(cm,"focus",cm);cm.state.focused=true;
addClass(cm.display.wrapper,"CodeMirror-focused");if(!cm.curOp&&cm.display.selForContextMenu!=cm.doc.sel){cm.display.input.reset();
if(webkit){setTimeout(function(){cm.display.input.reset(true);},20);}}cm.display.input.receivedFocus();
}restartBlink(cm);}function onBlur(cm){if(cm.state.delayingBlurEvent){return;}if(cm.state.focused){signal(cm,"blur",cm);
cm.state.focused=false;rmClass(cm.display.wrapper,"CodeMirror-focused");}clearInterval(cm.display.blinker);
setTimeout(function(){if(!cm.state.focused){cm.display.shift=false;}},150);}function onContextMenu(cm,e){if(eventInWidget(cm.display,e)||contextMenuInGutter(cm,e)){return;
}if(signalDOMEvent(cm,e,"contextmenu")){return;}cm.display.input.onContextMenu(e);}function contextMenuInGutter(cm,e){if(!hasHandler(cm,"gutterContextMenu")){return false;
}return gutterEvent(cm,e,"gutterContextMenu",false);}var changeEnd=CodeMirror.changeEnd=function(change){if(!change.text){return change.to;
}return Pos(change.from.line+change.text.length-1,lst(change.text).length+(change.text.length==1?change.from.ch:0));
};function adjustForChange(pos,change){if(cmp(pos,change.from)<0){return pos;}if(cmp(pos,change.to)<=0){return changeEnd(change);
}var line=pos.line+change.text.length-(change.to.line-change.from.line)-1,ch=pos.ch;if(pos.line==change.to.line){ch+=changeEnd(change).ch-change.to.ch;
}return Pos(line,ch);}function computeSelAfterChange(doc,change){var out=[];for(var i=0;i<doc.sel.ranges.length;
i++){var range=doc.sel.ranges[i];out.push(new Range(adjustForChange(range.anchor,change),adjustForChange(range.head,change)));
}return normalizeSelection(out,doc.sel.primIndex);}function offsetPos(pos,old,nw){if(pos.line==old.line){return Pos(nw.line,pos.ch-old.ch+nw.ch);
}else{return Pos(nw.line+(pos.line-old.line),pos.ch);}}function computeReplacedSel(doc,changes,hint){var out=[];
var oldPrev=Pos(doc.first,0),newPrev=oldPrev;for(var i=0;i<changes.length;i++){var change=changes[i];
var from=offsetPos(change.from,oldPrev,newPrev);var to=offsetPos(changeEnd(change),oldPrev,newPrev);oldPrev=change.to;
newPrev=to;if(hint=="around"){var range=doc.sel.ranges[i],inv=cmp(range.head,range.anchor)<0;out[i]=new Range(inv?to:from,inv?from:to);
}else{out[i]=new Range(from,from);}}return new Selection(out,doc.sel.primIndex);}function filterChange(doc,change,update){var obj={canceled:false,from:change.from,to:change.to,text:change.text,origin:change.origin,cancel:function(){this.canceled=true;
}};if(update){obj.update=function(from,to,text,origin){if(from){this.from=clipPos(doc,from);}if(to){this.to=clipPos(doc,to);
}if(text){this.text=text;}if(origin!==undefined){this.origin=origin;}};}signal(doc,"beforeChange",doc,obj);
if(doc.cm){signal(doc.cm,"beforeChange",doc.cm,obj);}if(obj.canceled){return null;}return{from:obj.from,to:obj.to,text:obj.text,origin:obj.origin};
}function makeChange(doc,change,ignoreReadOnly){if(doc.cm){if(!doc.cm.curOp){return operation(doc.cm,makeChange)(doc,change,ignoreReadOnly);
}if(doc.cm.state.suppressEdits){return;}}if(hasHandler(doc,"beforeChange")||doc.cm&&hasHandler(doc.cm,"beforeChange")){change=filterChange(doc,change,true);
if(!change){return;}}var split=sawReadOnlySpans&&!ignoreReadOnly&&removeReadOnlyRanges(doc,change.from,change.to);
if(split){for(var i=split.length-1;i>=0;--i){makeChangeInner(doc,{from:split[i].from,to:split[i].to,text:i?[""]:change.text});
}}else{makeChangeInner(doc,change);}}function makeChangeInner(doc,change){if(change.text.length==1&&change.text[0]==""&&cmp(change.from,change.to)==0){return;
}var selAfter=computeSelAfterChange(doc,change);addChangeToHistory(doc,change,selAfter,doc.cm?doc.cm.curOp.id:NaN);
makeChangeSingleDoc(doc,change,selAfter,stretchSpansOverChange(doc,change));var rebased=[];linkedDocs(doc,function(doc,sharedHist){if(!sharedHist&&indexOf(rebased,doc.history)==-1){rebaseHist(doc.history,change);
rebased.push(doc.history);}makeChangeSingleDoc(doc,change,null,stretchSpansOverChange(doc,change));});
}function makeChangeFromHistory(doc,type,allowSelectionOnly){if(doc.cm&&doc.cm.state.suppressEdits&&!allowSelectionOnly){return;
}var hist=doc.history,event,selAfter=doc.sel;var source=type=="undo"?hist.done:hist.undone,dest=type=="undo"?hist.undone:hist.done;
for(var i=0;i<source.length;i++){event=source[i];if(allowSelectionOnly?event.ranges&&!event.equals(doc.sel):!event.ranges){break;
}}if(i==source.length){return;}hist.lastOrigin=hist.lastSelOrigin=null;for(;;){event=source.pop();if(event.ranges){pushSelectionToHistory(event,dest);
if(allowSelectionOnly&&!event.equals(doc.sel)){setSelection(doc,event,{clearRedo:false});return;}selAfter=event;
}else{break;}}var antiChanges=[];pushSelectionToHistory(selAfter,dest);dest.push({changes:antiChanges,generation:hist.generation});
hist.generation=event.generation||++hist.maxGeneration;var filter=hasHandler(doc,"beforeChange")||doc.cm&&hasHandler(doc.cm,"beforeChange");
for(var i=event.changes.length-1;i>=0;--i){var change=event.changes[i];change.origin=type;if(filter&&!filterChange(doc,change,false)){source.length=0;
return;}antiChanges.push(historyChangeFromChange(doc,change));var after=i?computeSelAfterChange(doc,change):lst(source);
makeChangeSingleDoc(doc,change,after,mergeOldSpans(doc,change));if(!i&&doc.cm){doc.cm.scrollIntoView({from:change.from,to:changeEnd(change)});
}var rebased=[];linkedDocs(doc,function(doc,sharedHist){if(!sharedHist&&indexOf(rebased,doc.history)==-1){rebaseHist(doc.history,change);
rebased.push(doc.history);}makeChangeSingleDoc(doc,change,null,mergeOldSpans(doc,change));});}}function shiftDoc(doc,distance){if(distance==0){return;
}doc.first+=distance;doc.sel=new Selection(map(doc.sel.ranges,function(range){return new Range(Pos(range.anchor.line+distance,range.anchor.ch),Pos(range.head.line+distance,range.head.ch));
}),doc.sel.primIndex);if(doc.cm){regChange(doc.cm,doc.first,doc.first-distance,distance);for(var d=doc.cm.display,l=d.viewFrom;
l<d.viewTo;l++){regLineChange(doc.cm,l,"gutter");}}}function makeChangeSingleDoc(doc,change,selAfter,spans){if(doc.cm&&!doc.cm.curOp){return operation(doc.cm,makeChangeSingleDoc)(doc,change,selAfter,spans);
}if(change.to.line<doc.first){shiftDoc(doc,change.text.length-1-(change.to.line-change.from.line));return;
}if(change.from.line>doc.lastLine()){return;}if(change.from.line<doc.first){var shift=change.text.length-1-(doc.first-change.from.line);
shiftDoc(doc,shift);change={from:Pos(doc.first,0),to:Pos(change.to.line+shift,change.to.ch),text:[lst(change.text)],origin:change.origin};
}var last=doc.lastLine();if(change.to.line>last){change={from:change.from,to:Pos(last,getLine(doc,last).text.length),text:[change.text[0]],origin:change.origin};
}change.removed=getBetween(doc,change.from,change.to);if(!selAfter){selAfter=computeSelAfterChange(doc,change);
}if(doc.cm){makeChangeSingleDocInEditor(doc.cm,change,spans);}else{updateDoc(doc,change,spans);}setSelectionNoUndo(doc,selAfter,sel_dontScroll);
}function makeChangeSingleDocInEditor(cm,change,spans){var doc=cm.doc,display=cm.display,from=change.from,to=change.to;
var recomputeMaxLength=false,checkWidthStart=from.line;if(!cm.options.lineWrapping){checkWidthStart=lineNo(visualLine(getLine(doc,from.line)));
doc.iter(checkWidthStart,to.line+1,function(line){if(line==display.maxLine){recomputeMaxLength=true;return true;
}});}if(doc.sel.contains(change.from,change.to)>-1){signalCursorActivity(cm);}updateDoc(doc,change,spans,estimateHeight(cm));
if(!cm.options.lineWrapping){doc.iter(checkWidthStart,from.line+change.text.length,function(line){var len=lineLength(line);
if(len>display.maxLineLength){display.maxLine=line;display.maxLineLength=len;display.maxLineChanged=true;
recomputeMaxLength=false;}});if(recomputeMaxLength){cm.curOp.updateMaxLine=true;}}doc.frontier=Math.min(doc.frontier,from.line);
startWorker(cm,400);var lendiff=change.text.length-(to.line-from.line)-1;if(change.full){regChange(cm);
}else{if(from.line==to.line&&change.text.length==1&&!isWholeLineUpdate(cm.doc,change)){regLineChange(cm,from.line,"text");
}else{regChange(cm,from.line,to.line+1,lendiff);}}var changesHandler=hasHandler(cm,"changes"),changeHandler=hasHandler(cm,"change");
if(changeHandler||changesHandler){var obj={from:from,to:to,text:change.text,removed:change.removed,origin:change.origin};
if(changeHandler){signalLater(cm,"change",cm,obj);}if(changesHandler){(cm.curOp.changeObjs||(cm.curOp.changeObjs=[])).push(obj);
}}cm.display.selForContextMenu=null;}function replaceRange(doc,code,from,to,origin){if(!to){to=from;}if(cmp(to,from)<0){var tmp=to;
to=from;from=tmp;}if(typeof code=="string"){code=doc.splitLines(code);}makeChange(doc,{from:from,to:to,text:code,origin:origin});
}function maybeScrollWindow(cm,coords){if(signalDOMEvent(cm,"scrollCursorIntoView")){return;}var display=cm.display,box=display.sizer.getBoundingClientRect(),doScroll=null;
if(coords.top+box.top<0){doScroll=true;}else{if(coords.bottom+box.top>(window.innerHeight||document.documentElement.clientHeight)){doScroll=false;
}}if(doScroll!=null&&!phantom){var scrollNode=elt("div","\u200b",null,"position: absolute; top: "+(coords.top-display.viewOffset-paddingTop(cm.display))+"px; height: "+(coords.bottom-coords.top+scrollGap(cm)+display.barHeight)+"px; left: "+coords.left+"px; width: 2px;");
cm.display.lineSpace.appendChild(scrollNode);scrollNode.scrollIntoView(doScroll);cm.display.lineSpace.removeChild(scrollNode);
}}function scrollPosIntoView(cm,pos,end,margin){if(margin==null){margin=0;}for(var limit=0;limit<5;limit++){var changed=false,coords=cursorCoords(cm,pos);
var endCoords=!end||end==pos?coords:cursorCoords(cm,end);var scrollPos=calculateScrollPos(cm,Math.min(coords.left,endCoords.left),Math.min(coords.top,endCoords.top)-margin,Math.max(coords.left,endCoords.left),Math.max(coords.bottom,endCoords.bottom)+margin);
var startTop=cm.doc.scrollTop,startLeft=cm.doc.scrollLeft;if(scrollPos.scrollTop!=null){setScrollTop(cm,scrollPos.scrollTop);
if(Math.abs(cm.doc.scrollTop-startTop)>1){changed=true;}}if(scrollPos.scrollLeft!=null){setScrollLeft(cm,scrollPos.scrollLeft);
if(Math.abs(cm.doc.scrollLeft-startLeft)>1){changed=true;}}if(!changed){break;}}return coords;}function scrollIntoView(cm,x1,y1,x2,y2){var scrollPos=calculateScrollPos(cm,x1,y1,x2,y2);
if(scrollPos.scrollTop!=null){setScrollTop(cm,scrollPos.scrollTop);}if(scrollPos.scrollLeft!=null){setScrollLeft(cm,scrollPos.scrollLeft);
}}function calculateScrollPos(cm,x1,y1,x2,y2){var display=cm.display,snapMargin=textHeight(cm.display);
if(y1<0){y1=0;}var screentop=cm.curOp&&cm.curOp.scrollTop!=null?cm.curOp.scrollTop:display.scroller.scrollTop;
var screen=displayHeight(cm),result={};if(y2-y1>screen){y2=y1+screen;}var docBottom=cm.doc.height+paddingVert(display);
var atTop=y1<snapMargin,atBottom=y2>docBottom-snapMargin;if(y1<screentop){result.scrollTop=atTop?0:y1;
}else{if(y2>screentop+screen){var newTop=Math.min(y1,(atBottom?docBottom:y2)-screen);if(newTop!=screentop){result.scrollTop=newTop;
}}}var screenleft=cm.curOp&&cm.curOp.scrollLeft!=null?cm.curOp.scrollLeft:display.scroller.scrollLeft;
var screenw=displayWidth(cm)-(cm.options.fixedGutter?display.gutters.offsetWidth:0);var tooWide=x2-x1>screenw;
if(tooWide){x2=x1+screenw;}if(x1<10){result.scrollLeft=0;}else{if(x1<screenleft){result.scrollLeft=Math.max(0,x1-(tooWide?0:10));
}else{if(x2>screenw+screenleft-3){result.scrollLeft=x2+(tooWide?0:10)-screenw;}}}return result;}function addToScrollPos(cm,left,top){if(left!=null||top!=null){resolveScrollToPos(cm);
}if(left!=null){cm.curOp.scrollLeft=(cm.curOp.scrollLeft==null?cm.doc.scrollLeft:cm.curOp.scrollLeft)+left;
}if(top!=null){cm.curOp.scrollTop=(cm.curOp.scrollTop==null?cm.doc.scrollTop:cm.curOp.scrollTop)+top;
}}function ensureCursorVisible(cm){resolveScrollToPos(cm);var cur=cm.getCursor(),from=cur,to=cur;if(!cm.options.lineWrapping){from=cur.ch?Pos(cur.line,cur.ch-1):cur;
to=Pos(cur.line,cur.ch+1);}cm.curOp.scrollToPos={from:from,to:to,margin:cm.options.cursorScrollMargin,isCursor:true};
}function resolveScrollToPos(cm){var range=cm.curOp.scrollToPos;if(range){cm.curOp.scrollToPos=null;var from=estimateCoords(cm,range.from),to=estimateCoords(cm,range.to);
var sPos=calculateScrollPos(cm,Math.min(from.left,to.left),Math.min(from.top,to.top)-range.margin,Math.max(from.right,to.right),Math.max(from.bottom,to.bottom)+range.margin);
cm.scrollTo(sPos.scrollLeft,sPos.scrollTop);}}function indentLine(cm,n,how,aggressive){var doc=cm.doc,state;
if(how==null){how="add";}if(how=="smart"){if(!doc.mode.indent){how="prev";}else{state=getStateBefore(cm,n);
}}var tabSize=cm.options.tabSize;var line=getLine(doc,n),curSpace=countColumn(line.text,null,tabSize);
if(line.stateAfter){line.stateAfter=null;}var curSpaceString=line.text.match(/^\s*/)[0],indentation;if(!aggressive&&!/\S/.test(line.text)){indentation=0;
how="not";}else{if(how=="smart"){indentation=doc.mode.indent(state,line.text.slice(curSpaceString.length),line.text);
if(indentation==Pass||indentation>150){if(!aggressive){return;}how="prev";}}}if(how=="prev"){if(n>doc.first){indentation=countColumn(getLine(doc,n-1).text,null,tabSize);
}else{indentation=0;}}else{if(how=="add"){indentation=curSpace+cm.options.indentUnit;}else{if(how=="subtract"){indentation=curSpace-cm.options.indentUnit;
}else{if(typeof how=="number"){indentation=curSpace+how;}}}}indentation=Math.max(0,indentation);var indentString="",pos=0;
if(cm.options.indentWithTabs){for(var i=Math.floor(indentation/tabSize);i;--i){pos+=tabSize;indentString+="\t";
}}if(pos<indentation){indentString+=spaceStr(indentation-pos);}if(indentString!=curSpaceString){replaceRange(doc,indentString,Pos(n,0),Pos(n,curSpaceString.length),"+input");
line.stateAfter=null;return true;}else{for(var i=0;i<doc.sel.ranges.length;i++){var range=doc.sel.ranges[i];
if(range.head.line==n&&range.head.ch<curSpaceString.length){var pos=Pos(n,curSpaceString.length);replaceOneSelection(doc,i,new Range(pos,pos));
break;}}}}function changeLine(doc,handle,changeType,op){var no=handle,line=handle;if(typeof handle=="number"){line=getLine(doc,clipLine(doc,handle));
}else{no=lineNo(handle);}if(no==null){return null;}if(op(line,no)&&doc.cm){regLineChange(doc.cm,no,changeType);
}return line;}function deleteNearSelection(cm,compute){var ranges=cm.doc.sel.ranges,kill=[];for(var i=0;
i<ranges.length;i++){var toKill=compute(ranges[i]);while(kill.length&&cmp(toKill.from,lst(kill).to)<=0){var replaced=kill.pop();
if(cmp(replaced.from,toKill.from)<0){toKill.from=replaced.from;break;}}kill.push(toKill);}runInOp(cm,function(){for(var i=kill.length-1;
i>=0;i--){replaceRange(cm.doc,"",kill[i].from,kill[i].to,"+delete");}ensureCursorVisible(cm);});}function findPosH(doc,pos,dir,unit,visually){var line=pos.line,ch=pos.ch,origDir=dir;
var lineObj=getLine(doc,line);function findNextLine(){var l=line+dir;if(l<doc.first||l>=doc.first+doc.size){return false;
}line=l;return lineObj=getLine(doc,l);}function moveOnce(boundToLine){var next=(visually?moveVisually:moveLogically)(lineObj,ch,dir,true);
if(next==null){if(!boundToLine&&findNextLine()){if(visually){ch=(dir<0?lineRight:lineLeft)(lineObj);}else{ch=dir<0?lineObj.text.length:0;
}}else{return false;}}else{ch=next;}return true;}if(unit=="char"){moveOnce();}else{if(unit=="column"){moveOnce(true);
}else{if(unit=="word"||unit=="group"){var sawType=null,group=unit=="group";var helper=doc.cm&&doc.cm.getHelper(pos,"wordChars");
for(var first=true;;first=false){if(dir<0&&!moveOnce(!first)){break;}var cur=lineObj.text.charAt(ch)||"\n";
var type=isWordChar(cur,helper)?"w":group&&cur=="\n"?"n":!group||/\s/.test(cur)?null:"p";if(group&&!first&&!type){type="s";
}if(sawType&&sawType!=type){if(dir<0){dir=1;moveOnce();}break;}if(type){sawType=type;}if(dir>0&&!moveOnce(!first)){break;
}}}}}var result=skipAtomic(doc,Pos(line,ch),pos,origDir,true);if(!cmp(pos,result)){result.hitSide=true;
}return result;}function findPosV(cm,pos,dir,unit){var doc=cm.doc,x=pos.left,y;if(unit=="page"){var pageSize=Math.min(cm.display.wrapper.clientHeight,window.innerHeight||document.documentElement.clientHeight);
y=pos.top+dir*(pageSize-(dir<0?1.5:0.5)*textHeight(cm.display));}else{if(unit=="line"){y=dir>0?pos.bottom+3:pos.top-3;
}}for(;;){var target=coordsChar(cm,x,y);if(!target.outside){break;}if(dir<0?y<=0:y>=doc.height){target.hitSide=true;
break;}y+=dir*5;}return target;}CodeMirror.prototype={constructor:CodeMirror,focus:function(){window.focus();
this.display.input.focus();},setOption:function(option,value){var options=this.options,old=options[option];
if(options[option]==value&&option!="mode"){return;}options[option]=value;if(optionHandlers.hasOwnProperty(option)){operation(this,optionHandlers[option])(this,value,old);
}},getOption:function(option){return this.options[option];},getDoc:function(){return this.doc;},addKeyMap:function(map,bottom){this.state.keyMaps[bottom?"push":"unshift"](getKeyMap(map));
},removeKeyMap:function(map){var maps=this.state.keyMaps;for(var i=0;i<maps.length;++i){if(maps[i]==map||maps[i].name==map){maps.splice(i,1);
return true;}}},addOverlay:methodOp(function(spec,options){var mode=spec.token?spec:CodeMirror.getMode(this.options,spec);
if(mode.startState){throw new Error("Overlays may not be stateful.");}insertSorted(this.state.overlays,{mode:mode,modeSpec:spec,opaque:options&&options.opaque,priority:(options&&options.priority)||0},function(overlay){return overlay.priority;
});this.state.modeGen++;regChange(this);}),removeOverlay:methodOp(function(spec){var overlays=this.state.overlays;
for(var i=0;i<overlays.length;++i){var cur=overlays[i].modeSpec;if(cur==spec||typeof spec=="string"&&cur.name==spec){overlays.splice(i,1);
this.state.modeGen++;regChange(this);return;}}}),indentLine:methodOp(function(n,dir,aggressive){if(typeof dir!="string"&&typeof dir!="number"){if(dir==null){dir=this.options.smartIndent?"smart":"prev";
}else{dir=dir?"add":"subtract";}}if(isLine(this.doc,n)){indentLine(this,n,dir,aggressive);}}),indentSelection:methodOp(function(how){var ranges=this.doc.sel.ranges,end=-1;
for(var i=0;i<ranges.length;i++){var range=ranges[i];if(!range.empty()){var from=range.from(),to=range.to();
var start=Math.max(end,from.line);end=Math.min(this.lastLine(),to.line-(to.ch?0:1))+1;for(var j=start;
j<end;++j){indentLine(this,j,how);}var newRanges=this.doc.sel.ranges;if(from.ch==0&&ranges.length==newRanges.length&&newRanges[i].from().ch>0){replaceOneSelection(this.doc,i,new Range(from,newRanges[i].to()),sel_dontScroll);
}}else{if(range.head.line>end){indentLine(this,range.head.line,how,true);end=range.head.line;if(i==this.doc.sel.primIndex){ensureCursorVisible(this);
}}}}}),getTokenAt:function(pos,precise){return takeToken(this,pos,precise);},getLineTokens:function(line,precise){return takeToken(this,Pos(line),precise,true);
},getTokenTypeAt:function(pos){pos=clipPos(this.doc,pos);var styles=getLineStyles(this,getLine(this.doc,pos.line));
var before=0,after=(styles.length-1)/2,ch=pos.ch;var type;if(ch==0){type=styles[2];}else{for(;;){var mid=(before+after)>>1;
if((mid?styles[mid*2-1]:0)>=ch){after=mid;}else{if(styles[mid*2+1]<ch){before=mid+1;}else{type=styles[mid*2+2];
break;}}}}var cut=type?type.indexOf("cm-overlay "):-1;return cut<0?type:cut==0?null:type.slice(0,cut-1);
},getModeAt:function(pos){var mode=this.doc.mode;if(!mode.innerMode){return mode;}return CodeMirror.innerMode(mode,this.getTokenAt(pos).state).mode;
},getHelper:function(pos,type){return this.getHelpers(pos,type)[0];},getHelpers:function(pos,type){var found=[];
if(!helpers.hasOwnProperty(type)){return found;}var help=helpers[type],mode=this.getModeAt(pos);if(typeof mode[type]=="string"){if(help[mode[type]]){found.push(help[mode[type]]);
}}else{if(mode[type]){for(var i=0;i<mode[type].length;i++){var val=help[mode[type][i]];if(val){found.push(val);
}}}else{if(mode.helperType&&help[mode.helperType]){found.push(help[mode.helperType]);}else{if(help[mode.name]){found.push(help[mode.name]);
}}}}for(var i=0;i<help._global.length;i++){var cur=help._global[i];if(cur.pred(mode,this)&&indexOf(found,cur.val)==-1){found.push(cur.val);
}}return found;},getStateAfter:function(line,precise){var doc=this.doc;line=clipLine(doc,line==null?doc.first+doc.size-1:line);
return getStateBefore(this,line+1,precise);},cursorCoords:function(start,mode){var pos,range=this.doc.sel.primary();
if(start==null){pos=range.head;}else{if(typeof start=="object"){pos=clipPos(this.doc,start);}else{pos=start?range.from():range.to();
}}return cursorCoords(this,pos,mode||"page");},charCoords:function(pos,mode){return charCoords(this,clipPos(this.doc,pos),mode||"page");
},coordsChar:function(coords,mode){coords=fromCoordSystem(this,coords,mode||"page");return coordsChar(this,coords.left,coords.top);
},lineAtHeight:function(height,mode){height=fromCoordSystem(this,{top:height,left:0},mode||"page").top;
return lineAtHeight(this.doc,height+this.display.viewOffset);},heightAtLine:function(line,mode){var end=false,lineObj;
if(typeof line=="number"){var last=this.doc.first+this.doc.size-1;if(line<this.doc.first){line=this.doc.first;
}else{if(line>last){line=last;end=true;}}lineObj=getLine(this.doc,line);}else{lineObj=line;}return intoCoordSystem(this,lineObj,{top:0,left:0},mode||"page").top+(end?this.doc.height-heightAtLine(lineObj):0);
},defaultTextHeight:function(){return textHeight(this.display);},defaultCharWidth:function(){return charWidth(this.display);
},setGutterMarker:methodOp(function(line,gutterID,value){return changeLine(this.doc,line,"gutter",function(line){var markers=line.gutterMarkers||(line.gutterMarkers={});
markers[gutterID]=value;if(!value&&isEmpty(markers)){line.gutterMarkers=null;}return true;});}),clearGutter:methodOp(function(gutterID){var cm=this,doc=cm.doc,i=doc.first;
doc.iter(function(line){if(line.gutterMarkers&&line.gutterMarkers[gutterID]){line.gutterMarkers[gutterID]=null;
regLineChange(cm,i,"gutter");if(isEmpty(line.gutterMarkers)){line.gutterMarkers=null;}}++i;});}),lineInfo:function(line){if(typeof line=="number"){if(!isLine(this.doc,line)){return null;
}var n=line;line=getLine(this.doc,line);if(!line){return null;}}else{var n=lineNo(line);if(n==null){return null;
}}return{line:n,handle:line,text:line.text,gutterMarkers:line.gutterMarkers,textClass:line.textClass,bgClass:line.bgClass,wrapClass:line.wrapClass,widgets:line.widgets};
},getViewport:function(){return{from:this.display.viewFrom,to:this.display.viewTo};},addWidget:function(pos,node,scroll,vert,horiz){var display=this.display;
pos=cursorCoords(this,clipPos(this.doc,pos));var top=pos.bottom,left=pos.left;node.style.position="absolute";
node.setAttribute("cm-ignore-events","true");this.display.input.setUneditable(node);display.sizer.appendChild(node);
if(vert=="over"){top=pos.top;}else{if(vert=="above"||vert=="near"){var vspace=Math.max(display.wrapper.clientHeight,this.doc.height),hspace=Math.max(display.sizer.clientWidth,display.lineSpace.clientWidth);
if((vert=="above"||pos.bottom+node.offsetHeight>vspace)&&pos.top>node.offsetHeight){top=pos.top-node.offsetHeight;
}else{if(pos.bottom+node.offsetHeight<=vspace){top=pos.bottom;}}if(left+node.offsetWidth>hspace){left=hspace-node.offsetWidth;
}}}node.style.top=top+"px";node.style.left=node.style.right="";if(horiz=="right"){left=display.sizer.clientWidth-node.offsetWidth;
node.style.right="0px";}else{if(horiz=="left"){left=0;}else{if(horiz=="middle"){left=(display.sizer.clientWidth-node.offsetWidth)/2;
}}node.style.left=left+"px";}if(scroll){scrollIntoView(this,left,top,left+node.offsetWidth,top+node.offsetHeight);
}},triggerOnKeyDown:methodOp(onKeyDown),triggerOnKeyPress:methodOp(onKeyPress),triggerOnKeyUp:onKeyUp,execCommand:function(cmd){if(commands.hasOwnProperty(cmd)){return commands[cmd].call(null,this);
}},triggerElectric:methodOp(function(text){triggerElectric(this,text);}),findPosH:function(from,amount,unit,visually){var dir=1;
if(amount<0){dir=-1;amount=-amount;}for(var i=0,cur=clipPos(this.doc,from);i<amount;++i){cur=findPosH(this.doc,cur,dir,unit,visually);
if(cur.hitSide){break;}}return cur;},moveH:methodOp(function(dir,unit){var cm=this;cm.extendSelectionsBy(function(range){if(cm.display.shift||cm.doc.extend||range.empty()){return findPosH(cm.doc,range.head,dir,unit,cm.options.rtlMoveVisually);
}else{return dir<0?range.from():range.to();}},sel_move);}),deleteH:methodOp(function(dir,unit){var sel=this.doc.sel,doc=this.doc;
if(sel.somethingSelected()){doc.replaceSelection("",null,"+delete");}else{deleteNearSelection(this,function(range){var other=findPosH(doc,range.head,dir,unit,false);
return dir<0?{from:other,to:range.head}:{from:range.head,to:other};});}}),findPosV:function(from,amount,unit,goalColumn){var dir=1,x=goalColumn;
if(amount<0){dir=-1;amount=-amount;}for(var i=0,cur=clipPos(this.doc,from);i<amount;++i){var coords=cursorCoords(this,cur,"div");
if(x==null){x=coords.left;}else{coords.left=x;}cur=findPosV(this,coords,dir,unit);if(cur.hitSide){break;
}}return cur;},moveV:methodOp(function(dir,unit){var cm=this,doc=this.doc,goals=[];var collapse=!cm.display.shift&&!doc.extend&&doc.sel.somethingSelected();
doc.extendSelectionsBy(function(range){if(collapse){return dir<0?range.from():range.to();}var headPos=cursorCoords(cm,range.head,"div");
if(range.goalColumn!=null){headPos.left=range.goalColumn;}goals.push(headPos.left);var pos=findPosV(cm,headPos,dir,unit);
if(unit=="page"&&range==doc.sel.primary()){addToScrollPos(cm,null,charCoords(cm,pos,"div").top-headPos.top);
}return pos;},sel_move);if(goals.length){for(var i=0;i<doc.sel.ranges.length;i++){doc.sel.ranges[i].goalColumn=goals[i];
}}}),findWordAt:function(pos){var doc=this.doc,line=getLine(doc,pos.line).text;var start=pos.ch,end=pos.ch;
if(line){var helper=this.getHelper(pos,"wordChars");if((pos.xRel<0||end==line.length)&&start){--start;
}else{++end;}var startChar=line.charAt(start);var check=isWordChar(startChar,helper)?function(ch){return isWordChar(ch,helper);
}:/\s/.test(startChar)?function(ch){return/\s/.test(ch);}:function(ch){return !/\s/.test(ch)&&!isWordChar(ch);
};while(start>0&&check(line.charAt(start-1))){--start;}while(end<line.length&&check(line.charAt(end))){++end;
}}return new Range(Pos(pos.line,start),Pos(pos.line,end));},toggleOverwrite:function(value){if(value!=null&&value==this.state.overwrite){return;
}if(this.state.overwrite=!this.state.overwrite){addClass(this.display.cursorDiv,"CodeMirror-overwrite");
}else{rmClass(this.display.cursorDiv,"CodeMirror-overwrite");}signal(this,"overwriteToggle",this,this.state.overwrite);
},hasFocus:function(){return this.display.input.getField()==activeElt();},isReadOnly:function(){return !!(this.options.readOnly||this.doc.cantEdit);
},scrollTo:methodOp(function(x,y){if(x!=null||y!=null){resolveScrollToPos(this);}if(x!=null){this.curOp.scrollLeft=x;
}if(y!=null){this.curOp.scrollTop=y;}}),getScrollInfo:function(){var scroller=this.display.scroller;return{left:scroller.scrollLeft,top:scroller.scrollTop,height:scroller.scrollHeight-scrollGap(this)-this.display.barHeight,width:scroller.scrollWidth-scrollGap(this)-this.display.barWidth,clientHeight:displayHeight(this),clientWidth:displayWidth(this)};
},scrollIntoView:methodOp(function(range,margin){if(range==null){range={from:this.doc.sel.primary().head,to:null};
if(margin==null){margin=this.options.cursorScrollMargin;}}else{if(typeof range=="number"){range={from:Pos(range,0),to:null};
}else{if(range.from==null){range={from:range,to:null};}}}if(!range.to){range.to=range.from;}range.margin=margin||0;
if(range.from.line!=null){resolveScrollToPos(this);this.curOp.scrollToPos=range;}else{var sPos=calculateScrollPos(this,Math.min(range.from.left,range.to.left),Math.min(range.from.top,range.to.top)-range.margin,Math.max(range.from.right,range.to.right),Math.max(range.from.bottom,range.to.bottom)+range.margin);
this.scrollTo(sPos.scrollLeft,sPos.scrollTop);}}),setSize:methodOp(function(width,height){var cm=this;
function interpret(val){return typeof val=="number"||/^\d+$/.test(String(val))?val+"px":val;}if(width!=null){cm.display.wrapper.style.width=interpret(width);
}if(height!=null){cm.display.wrapper.style.height=interpret(height);}if(cm.options.lineWrapping){clearLineMeasurementCache(this);
}var lineNo=cm.display.viewFrom;cm.doc.iter(lineNo,cm.display.viewTo,function(line){if(line.widgets){for(var i=0;
i<line.widgets.length;i++){if(line.widgets[i].noHScroll){regLineChange(cm,lineNo,"widget");break;}}}++lineNo;
});cm.curOp.forceUpdate=true;signal(cm,"refresh",this);}),operation:function(f){return runInOp(this,f);
},refresh:methodOp(function(){var oldHeight=this.display.cachedTextHeight;regChange(this);this.curOp.forceUpdate=true;
clearCaches(this);this.scrollTo(this.doc.scrollLeft,this.doc.scrollTop);updateGutterSpace(this);if(oldHeight==null||Math.abs(oldHeight-textHeight(this.display))>0.5){estimateLineHeights(this);
}signal(this,"refresh",this);}),swapDoc:methodOp(function(doc){var old=this.doc;old.cm=null;attachDoc(this,doc);
clearCaches(this);this.display.input.reset();this.scrollTo(doc.scrollLeft,doc.scrollTop);this.curOp.forceScroll=true;
signalLater(this,"swapDoc",this,old);return old;}),getInputField:function(){return this.display.input.getField();
},getWrapperElement:function(){return this.display.wrapper;},getScrollerElement:function(){return this.display.scroller;
},getGutterElement:function(){return this.display.gutters;}};eventMixin(CodeMirror);var defaults=CodeMirror.defaults={};
var optionHandlers=CodeMirror.optionHandlers={};function option(name,deflt,handle,notOnInit){CodeMirror.defaults[name]=deflt;
if(handle){optionHandlers[name]=notOnInit?function(cm,val,old){if(old!=Init){handle(cm,val,old);}}:handle;
}}var Init=CodeMirror.Init={toString:function(){return"CodeMirror.Init";}};option("value","",function(cm,val){cm.setValue(val);
},true);option("mode",null,function(cm,val){cm.doc.modeOption=val;loadMode(cm);},true);option("indentUnit",2,loadMode,true);
option("indentWithTabs",false);option("smartIndent",true);option("tabSize",4,function(cm){resetModeState(cm);
clearCaches(cm);regChange(cm);},true);option("lineSeparator",null,function(cm,val){cm.doc.lineSep=val;
if(!val){return;}var newBreaks=[],lineNo=cm.doc.first;cm.doc.iter(function(line){for(var pos=0;;){var found=line.text.indexOf(val,pos);
if(found==-1){break;}pos=found+val.length;newBreaks.push(Pos(lineNo,found));}lineNo++;});for(var i=newBreaks.length-1;
i>=0;i--){replaceRange(cm.doc,val,newBreaks[i],Pos(newBreaks[i].line,newBreaks[i].ch+val.length));}});
option("specialChars",/[\u0000-\u001f\u007f\u00ad\u200b-\u200f\u2028\u2029\ufeff]/g,function(cm,val,old){cm.state.specialChars=new RegExp(val.source+(val.test("\t")?"":"|\t"),"g");
if(old!=CodeMirror.Init){cm.refresh();}});option("specialCharPlaceholder",defaultSpecialCharPlaceholder,function(cm){cm.refresh();
},true);option("electricChars",true);option("inputStyle",mobile?"contenteditable":"textarea",function(){throw new Error("inputStyle can not (yet) be changed in a running editor");
},true);option("spellcheck",false,function(cm,val){cm.getInputField().spellcheck=val;},true);option("rtlMoveVisually",!windows);
option("wholeLineUpdateBefore",true);option("theme","default",function(cm){themeChanged(cm);guttersChanged(cm);
},true);option("keyMap","default",function(cm,val,old){var next=getKeyMap(val);var prev=old!=CodeMirror.Init&&getKeyMap(old);
if(prev&&prev.detach){prev.detach(cm,next);}if(next.attach){next.attach(cm,prev||null);}});option("extraKeys",null);
option("lineWrapping",false,wrappingChanged,true);option("gutters",[],function(cm){setGuttersForLineNumbers(cm.options);
guttersChanged(cm);},true);option("fixedGutter",true,function(cm,val){cm.display.gutters.style.left=val?compensateForHScroll(cm.display)+"px":"0";
cm.refresh();},true);option("coverGutterNextToScrollbar",false,function(cm){updateScrollbars(cm);},true);
option("scrollbarStyle","native",function(cm){initScrollbars(cm);updateScrollbars(cm);cm.display.scrollbars.setScrollTop(cm.doc.scrollTop);
cm.display.scrollbars.setScrollLeft(cm.doc.scrollLeft);},true);option("lineNumbers",false,function(cm){setGuttersForLineNumbers(cm.options);
guttersChanged(cm);},true);option("firstLineNumber",1,guttersChanged,true);option("lineNumberFormatter",function(integer){return integer;
},guttersChanged,true);option("showCursorWhenSelecting",false,updateSelection,true);option("resetSelectionOnContextMenu",true);
option("lineWiseCopyCut",true);option("readOnly",false,function(cm,val){if(val=="nocursor"){onBlur(cm);
cm.display.input.blur();cm.display.disabled=true;}else{cm.display.disabled=false;}cm.display.input.readOnlyChanged(val);
});option("disableInput",false,function(cm,val){if(!val){cm.display.input.reset();}},true);option("dragDrop",true,dragDropChanged);
option("allowDropFileTypes",null);option("cursorBlinkRate",530);option("cursorScrollMargin",0);option("cursorHeight",1,updateSelection,true);
option("singleCursorHeightPerLine",true,updateSelection,true);option("workTime",100);option("workDelay",100);
option("flattenSpans",true,resetModeState,true);option("addModeClass",false,resetModeState,true);option("pollInterval",100);
option("undoDepth",200,function(cm,val){cm.doc.history.undoDepth=val;});option("historyEventDelay",1250);
option("viewportMargin",10,function(cm){cm.refresh();},true);option("maxHighlightLength",10000,resetModeState,true);
option("moveInputWithCursor",true,function(cm,val){if(!val){cm.display.input.resetPosition();}});option("tabindex",null,function(cm,val){cm.display.input.getField().tabIndex=val||"";
});option("autofocus",null);var modes=CodeMirror.modes={},mimeModes=CodeMirror.mimeModes={};CodeMirror.defineMode=function(name,mode){if(!CodeMirror.defaults.mode&&name!="null"){CodeMirror.defaults.mode=name;
}if(arguments.length>2){mode.dependencies=Array.prototype.slice.call(arguments,2);}modes[name]=mode;};
CodeMirror.defineMIME=function(mime,spec){mimeModes[mime]=spec;};CodeMirror.resolveMode=function(spec){if(typeof spec=="string"&&mimeModes.hasOwnProperty(spec)){spec=mimeModes[spec];
}else{if(spec&&typeof spec.name=="string"&&mimeModes.hasOwnProperty(spec.name)){var found=mimeModes[spec.name];
if(typeof found=="string"){found={name:found};}spec=createObj(found,spec);spec.name=found.name;}else{if(typeof spec=="string"&&/^[\w\-]+\/[\w\-]+\+xml$/.test(spec)){return CodeMirror.resolveMode("application/xml");
}else{if(typeof spec=="string"&&/^[\w\-]+\/[\w\-]+\+json$/.test(spec)){return CodeMirror.resolveMode("application/json");
}}}}if(typeof spec=="string"){return{name:spec};}else{return spec||{name:"null"};}};CodeMirror.getMode=function(options,spec){var spec=CodeMirror.resolveMode(spec);
var mfactory=modes[spec.name];if(!mfactory){return CodeMirror.getMode(options,"text/plain");}var modeObj=mfactory(options,spec);
if(modeExtensions.hasOwnProperty(spec.name)){var exts=modeExtensions[spec.name];for(var prop in exts){if(!exts.hasOwnProperty(prop)){continue;
}if(modeObj.hasOwnProperty(prop)){modeObj["_"+prop]=modeObj[prop];}modeObj[prop]=exts[prop];}}modeObj.name=spec.name;
if(spec.helperType){modeObj.helperType=spec.helperType;}if(spec.modeProps){for(var prop in spec.modeProps){modeObj[prop]=spec.modeProps[prop];
}}return modeObj;};CodeMirror.defineMode("null",function(){return{token:function(stream){stream.skipToEnd();
}};});CodeMirror.defineMIME("text/plain","null");var modeExtensions=CodeMirror.modeExtensions={};CodeMirror.extendMode=function(mode,properties){var exts=modeExtensions.hasOwnProperty(mode)?modeExtensions[mode]:(modeExtensions[mode]={});
copyObj(properties,exts);};CodeMirror.defineExtension=function(name,func){CodeMirror.prototype[name]=func;
};CodeMirror.defineDocExtension=function(name,func){Doc.prototype[name]=func;};CodeMirror.defineOption=option;
var initHooks=[];CodeMirror.defineInitHook=function(f){initHooks.push(f);};var helpers=CodeMirror.helpers={};
CodeMirror.registerHelper=function(type,name,value){if(!helpers.hasOwnProperty(type)){helpers[type]=CodeMirror[type]={_global:[]};
}helpers[type][name]=value;};CodeMirror.registerGlobalHelper=function(type,name,predicate,value){CodeMirror.registerHelper(type,name,value);
helpers[type]._global.push({pred:predicate,val:value});};var copyState=CodeMirror.copyState=function(mode,state){if(state===true){return state;
}if(mode.copyState){return mode.copyState(state);}var nstate={};for(var n in state){var val=state[n];
if(val instanceof Array){val=val.concat([]);}nstate[n]=val;}return nstate;};var startState=CodeMirror.startState=function(mode,a1,a2){return mode.startState?mode.startState(a1,a2):true;
};CodeMirror.innerMode=function(mode,state){while(mode.innerMode){var info=mode.innerMode(state);if(!info||info.mode==mode){break;
}state=info.state;mode=info.mode;}return info||{mode:mode,state:state};};var commands=CodeMirror.commands={selectAll:function(cm){cm.setSelection(Pos(cm.firstLine(),0),Pos(cm.lastLine()),sel_dontScroll);
},singleSelection:function(cm){cm.setSelection(cm.getCursor("anchor"),cm.getCursor("head"),sel_dontScroll);
},killLine:function(cm){deleteNearSelection(cm,function(range){if(range.empty()){var len=getLine(cm.doc,range.head.line).text.length;
if(range.head.ch==len&&range.head.line<cm.lastLine()){return{from:range.head,to:Pos(range.head.line+1,0)};
}else{return{from:range.head,to:Pos(range.head.line,len)};}}else{return{from:range.from(),to:range.to()};
}});},deleteLine:function(cm){deleteNearSelection(cm,function(range){return{from:Pos(range.from().line,0),to:clipPos(cm.doc,Pos(range.to().line+1,0))};
});},delLineLeft:function(cm){deleteNearSelection(cm,function(range){return{from:Pos(range.from().line,0),to:range.from()};
});},delWrappedLineLeft:function(cm){deleteNearSelection(cm,function(range){var top=cm.charCoords(range.head,"div").top+5;
var leftPos=cm.coordsChar({left:0,top:top},"div");return{from:leftPos,to:range.from()};});},delWrappedLineRight:function(cm){deleteNearSelection(cm,function(range){var top=cm.charCoords(range.head,"div").top+5;
var rightPos=cm.coordsChar({left:cm.display.lineDiv.offsetWidth+100,top:top},"div");return{from:range.from(),to:rightPos};
});},undo:function(cm){cm.undo();},redo:function(cm){cm.redo();},undoSelection:function(cm){cm.undoSelection();
},redoSelection:function(cm){cm.redoSelection();},goDocStart:function(cm){cm.extendSelection(Pos(cm.firstLine(),0));
},goDocEnd:function(cm){cm.extendSelection(Pos(cm.lastLine()));},goLineStart:function(cm){cm.extendSelectionsBy(function(range){return lineStart(cm,range.head.line);
},{origin:"+move",bias:1});},goLineStartSmart:function(cm){cm.extendSelectionsBy(function(range){return lineStartSmart(cm,range.head);
},{origin:"+move",bias:1});},goLineEnd:function(cm){cm.extendSelectionsBy(function(range){return lineEnd(cm,range.head.line);
},{origin:"+move",bias:-1});},goLineRight:function(cm){cm.extendSelectionsBy(function(range){var top=cm.charCoords(range.head,"div").top+5;
return cm.coordsChar({left:cm.display.lineDiv.offsetWidth+100,top:top},"div");},sel_move);},goLineLeft:function(cm){cm.extendSelectionsBy(function(range){var top=cm.charCoords(range.head,"div").top+5;
return cm.coordsChar({left:0,top:top},"div");},sel_move);},goLineLeftSmart:function(cm){cm.extendSelectionsBy(function(range){var top=cm.charCoords(range.head,"div").top+5;
var pos=cm.coordsChar({left:0,top:top},"div");if(pos.ch<cm.getLine(pos.line).search(/\S/)){return lineStartSmart(cm,range.head);
}return pos;},sel_move);},goLineUp:function(cm){cm.moveV(-1,"line");},goLineDown:function(cm){cm.moveV(1,"line");
},goPageUp:function(cm){cm.moveV(-1,"page");},goPageDown:function(cm){cm.moveV(1,"page");},goCharLeft:function(cm){cm.moveH(-1,"char");
},goCharRight:function(cm){cm.moveH(1,"char");},goColumnLeft:function(cm){cm.moveH(-1,"column");},goColumnRight:function(cm){cm.moveH(1,"column");
},goWordLeft:function(cm){cm.moveH(-1,"word");},goGroupRight:function(cm){cm.moveH(1,"group");},goGroupLeft:function(cm){cm.moveH(-1,"group");
},goWordRight:function(cm){cm.moveH(1,"word");},delCharBefore:function(cm){cm.deleteH(-1,"char");},delCharAfter:function(cm){cm.deleteH(1,"char");
},delWordBefore:function(cm){cm.deleteH(-1,"word");},delWordAfter:function(cm){cm.deleteH(1,"word");},delGroupBefore:function(cm){cm.deleteH(-1,"group");
},delGroupAfter:function(cm){cm.deleteH(1,"group");},indentAuto:function(cm){cm.indentSelection("smart");
},indentMore:function(cm){cm.indentSelection("add");},indentLess:function(cm){cm.indentSelection("subtract");
},insertTab:function(cm){cm.replaceSelection("\t");},insertSoftTab:function(cm){var spaces=[],ranges=cm.listSelections(),tabSize=cm.options.tabSize;
for(var i=0;i<ranges.length;i++){var pos=ranges[i].from();var col=countColumn(cm.getLine(pos.line),pos.ch,tabSize);
spaces.push(spaceStr(tabSize-col%tabSize));}cm.replaceSelections(spaces);},defaultTab:function(cm){if(cm.somethingSelected()){cm.indentSelection("add");
}else{cm.execCommand("insertTab");}},transposeChars:function(cm){runInOp(cm,function(){var ranges=cm.listSelections(),newSel=[];
for(var i=0;i<ranges.length;i++){var cur=ranges[i].head,line=getLine(cm.doc,cur.line).text;if(line){if(cur.ch==line.length){cur=new Pos(cur.line,cur.ch-1);
}if(cur.ch>0){cur=new Pos(cur.line,cur.ch+1);cm.replaceRange(line.charAt(cur.ch-1)+line.charAt(cur.ch-2),Pos(cur.line,cur.ch-2),cur,"+transpose");
}else{if(cur.line>cm.doc.first){var prev=getLine(cm.doc,cur.line-1).text;if(prev){cm.replaceRange(line.charAt(0)+cm.doc.lineSeparator()+prev.charAt(prev.length-1),Pos(cur.line-1,prev.length-1),Pos(cur.line,1),"+transpose");
}}}}newSel.push(new Range(cur,cur));}cm.setSelections(newSel);});},newlineAndIndent:function(cm){runInOp(cm,function(){var len=cm.listSelections().length;
for(var i=0;i<len;i++){var range=cm.listSelections()[i];cm.replaceRange(cm.doc.lineSeparator(),range.anchor,range.head,"+input");
cm.indentLine(range.from().line+1,null,true);}ensureCursorVisible(cm);});},openLine:function(cm){cm.replaceSelection("\n","start");
},toggleOverwrite:function(cm){cm.toggleOverwrite();}};var keyMap=CodeMirror.keyMap={};keyMap.basic={Left:"goCharLeft",Right:"goCharRight",Up:"goLineUp",Down:"goLineDown",End:"goLineEnd",Home:"goLineStartSmart",PageUp:"goPageUp",PageDown:"goPageDown",Delete:"delCharAfter",Backspace:"delCharBefore","Shift-Backspace":"delCharBefore",Tab:"defaultTab","Shift-Tab":"indentAuto",Enter:"newlineAndIndent",Insert:"toggleOverwrite",Esc:"singleSelection"};
keyMap.pcDefault={"Ctrl-A":"selectAll","Ctrl-D":"deleteLine","Ctrl-Z":"undo","Shift-Ctrl-Z":"redo","Ctrl-Y":"redo","Ctrl-Home":"goDocStart","Ctrl-End":"goDocEnd","Ctrl-Up":"goLineUp","Ctrl-Down":"goLineDown","Ctrl-Left":"goGroupLeft","Ctrl-Right":"goGroupRight","Alt-Left":"goLineStart","Alt-Right":"goLineEnd","Ctrl-Backspace":"delGroupBefore","Ctrl-Delete":"delGroupAfter","Ctrl-S":"save","Ctrl-F":"find","Ctrl-G":"findNext","Shift-Ctrl-G":"findPrev","Shift-Ctrl-F":"replace","Shift-Ctrl-R":"replaceAll","Ctrl-[":"indentLess","Ctrl-]":"indentMore","Ctrl-U":"undoSelection","Shift-Ctrl-U":"redoSelection","Alt-U":"redoSelection",fallthrough:"basic"};
keyMap.emacsy={"Ctrl-F":"goCharRight","Ctrl-B":"goCharLeft","Ctrl-P":"goLineUp","Ctrl-N":"goLineDown","Alt-F":"goWordRight","Alt-B":"goWordLeft","Ctrl-A":"goLineStart","Ctrl-E":"goLineEnd","Ctrl-V":"goPageDown","Shift-Ctrl-V":"goPageUp","Ctrl-D":"delCharAfter","Ctrl-H":"delCharBefore","Alt-D":"delWordAfter","Alt-Backspace":"delWordBefore","Ctrl-K":"killLine","Ctrl-T":"transposeChars","Ctrl-O":"openLine"};
keyMap.macDefault={"Cmd-A":"selectAll","Cmd-D":"deleteLine","Cmd-Z":"undo","Shift-Cmd-Z":"redo","Cmd-Y":"redo","Cmd-Home":"goDocStart","Cmd-Up":"goDocStart","Cmd-End":"goDocEnd","Cmd-Down":"goDocEnd","Alt-Left":"goGroupLeft","Alt-Right":"goGroupRight","Cmd-Left":"goLineLeft","Cmd-Right":"goLineRight","Alt-Backspace":"delGroupBefore","Ctrl-Alt-Backspace":"delGroupAfter","Alt-Delete":"delGroupAfter","Cmd-S":"save","Cmd-F":"find","Cmd-G":"findNext","Shift-Cmd-G":"findPrev","Cmd-Alt-F":"replace","Shift-Cmd-Alt-F":"replaceAll","Cmd-[":"indentLess","Cmd-]":"indentMore","Cmd-Backspace":"delWrappedLineLeft","Cmd-Delete":"delWrappedLineRight","Cmd-U":"undoSelection","Shift-Cmd-U":"redoSelection","Ctrl-Up":"goDocStart","Ctrl-Down":"goDocEnd",fallthrough:["basic","emacsy"]};
keyMap["default"]=mac?keyMap.macDefault:keyMap.pcDefault;function normalizeKeyName(name){var parts=name.split(/-(?!$)/),name=parts[parts.length-1];
var alt,ctrl,shift,cmd;for(var i=0;i<parts.length-1;i++){var mod=parts[i];if(/^(cmd|meta|m)$/i.test(mod)){cmd=true;
}else{if(/^a(lt)?$/i.test(mod)){alt=true;}else{if(/^(c|ctrl|control)$/i.test(mod)){ctrl=true;}else{if(/^s(hift)$/i.test(mod)){shift=true;
}else{throw new Error("Unrecognized modifier name: "+mod);}}}}}if(alt){name="Alt-"+name;}if(ctrl){name="Ctrl-"+name;
}if(cmd){name="Cmd-"+name;}if(shift){name="Shift-"+name;}return name;}CodeMirror.normalizeKeyMap=function(keymap){var copy={};
for(var keyname in keymap){if(keymap.hasOwnProperty(keyname)){var value=keymap[keyname];if(/^(name|fallthrough|(de|at)tach)$/.test(keyname)){continue;
}if(value=="..."){delete keymap[keyname];continue;}var keys=map(keyname.split(" "),normalizeKeyName);
for(var i=0;i<keys.length;i++){var val,name;if(i==keys.length-1){name=keys.join(" ");val=value;}else{name=keys.slice(0,i+1).join(" ");
val="...";}var prev=copy[name];if(!prev){copy[name]=val;}else{if(prev!=val){throw new Error("Inconsistent bindings for "+name);
}}}delete keymap[keyname];}}for(var prop in copy){keymap[prop]=copy[prop];}return keymap;};var lookupKey=CodeMirror.lookupKey=function(key,map,handle,context){map=getKeyMap(map);
var found=map.call?map.call(key,context):map[key];if(found===false){return"nothing";}if(found==="..."){return"multi";
}if(found!=null&&handle(found)){return"handled";}if(map.fallthrough){if(Object.prototype.toString.call(map.fallthrough)!="[object Array]"){return lookupKey(key,map.fallthrough,handle,context);
}for(var i=0;i<map.fallthrough.length;i++){var result=lookupKey(key,map.fallthrough[i],handle,context);
if(result){return result;}}}};var isModifierKey=CodeMirror.isModifierKey=function(value){var name=typeof value=="string"?value:keyNames[value.keyCode];
return name=="Ctrl"||name=="Alt"||name=="Shift"||name=="Mod";};var keyName=CodeMirror.keyName=function(event,noShift){if(presto&&event.keyCode==34&&event["char"]){return false;
}var base=keyNames[event.keyCode],name=base;if(name==null||event.altGraphKey){return false;}if(event.altKey&&base!="Alt"){name="Alt-"+name;
}if((flipCtrlCmd?event.metaKey:event.ctrlKey)&&base!="Ctrl"){name="Ctrl-"+name;}if((flipCtrlCmd?event.ctrlKey:event.metaKey)&&base!="Cmd"){name="Cmd-"+name;
}if(!noShift&&event.shiftKey&&base!="Shift"){name="Shift-"+name;}return name;};function getKeyMap(val){return typeof val=="string"?keyMap[val]:val;
}CodeMirror.fromTextArea=function(textarea,options){options=options?copyObj(options):{};options.value=textarea.value;
if(!options.tabindex&&textarea.tabIndex){options.tabindex=textarea.tabIndex;}if(!options.placeholder&&textarea.placeholder){options.placeholder=textarea.placeholder;
}if(options.autofocus==null){var hasFocus=activeElt();options.autofocus=hasFocus==textarea||textarea.getAttribute("autofocus")!=null&&hasFocus==document.body;
}function save(){textarea.value=cm.getValue();}if(textarea.form){on(textarea.form,"submit",save);if(!options.leaveSubmitMethodAlone){var form=textarea.form,realSubmit=form.submit;
try{var wrappedSubmit=form.submit=function(){save();form.submit=realSubmit;form.submit();form.submit=wrappedSubmit;
};}catch(e){}}}options.finishInit=function(cm){cm.save=save;cm.getTextArea=function(){return textarea;
};cm.toTextArea=function(){cm.toTextArea=isNaN;save();textarea.parentNode.removeChild(cm.getWrapperElement());
textarea.style.display="";if(textarea.form){off(textarea.form,"submit",save);if(typeof textarea.form.submit=="function"){textarea.form.submit=realSubmit;
}}};};textarea.style.display="none";var cm=CodeMirror(function(node){textarea.parentNode.insertBefore(node,textarea.nextSibling);
},options);return cm;};var StringStream=CodeMirror.StringStream=function(string,tabSize){this.pos=this.start=0;
this.string=string;this.tabSize=tabSize||8;this.lastColumnPos=this.lastColumnValue=0;this.lineStart=0;
};StringStream.prototype={eol:function(){return this.pos>=this.string.length;},sol:function(){return this.pos==this.lineStart;
},peek:function(){return this.string.charAt(this.pos)||undefined;},next:function(){if(this.pos<this.string.length){return this.string.charAt(this.pos++);
}},eat:function(match){var ch=this.string.charAt(this.pos);if(typeof match=="string"){var ok=ch==match;
}else{var ok=ch&&(match.test?match.test(ch):match(ch));}if(ok){++this.pos;return ch;}},eatWhile:function(match){var start=this.pos;
while(this.eat(match)){}return this.pos>start;},eatSpace:function(){var start=this.pos;while(/[\s\u00a0]/.test(this.string.charAt(this.pos))){++this.pos;
}return this.pos>start;},skipToEnd:function(){this.pos=this.string.length;},skipTo:function(ch){var found=this.string.indexOf(ch,this.pos);
if(found>-1){this.pos=found;return true;}},backUp:function(n){this.pos-=n;},column:function(){if(this.lastColumnPos<this.start){this.lastColumnValue=countColumn(this.string,this.start,this.tabSize,this.lastColumnPos,this.lastColumnValue);
this.lastColumnPos=this.start;}return this.lastColumnValue-(this.lineStart?countColumn(this.string,this.lineStart,this.tabSize):0);
},indentation:function(){return countColumn(this.string,null,this.tabSize)-(this.lineStart?countColumn(this.string,this.lineStart,this.tabSize):0);
},match:function(pattern,consume,caseInsensitive){if(typeof pattern=="string"){var cased=function(str){return caseInsensitive?str.toLowerCase():str;
};var substr=this.string.substr(this.pos,pattern.length);if(cased(substr)==cased(pattern)){if(consume!==false){this.pos+=pattern.length;
}return true;}}else{var match=this.string.slice(this.pos).match(pattern);if(match&&match.index>0){return null;
}if(match&&consume!==false){this.pos+=match[0].length;}return match;}},current:function(){return this.string.slice(this.start,this.pos);
},hideFirstChars:function(n,inner){this.lineStart+=n;try{return inner();}finally{this.lineStart-=n;}}};
var nextMarkerId=0;var TextMarker=CodeMirror.TextMarker=function(doc,type){this.lines=[];this.type=type;
this.doc=doc;this.id=++nextMarkerId;};eventMixin(TextMarker);TextMarker.prototype.clear=function(){if(this.explicitlyCleared){return;
}var cm=this.doc.cm,withOp=cm&&!cm.curOp;if(withOp){startOperation(cm);}if(hasHandler(this,"clear")){var found=this.find();
if(found){signalLater(this,"clear",found.from,found.to);}}var min=null,max=null;for(var i=0;i<this.lines.length;
++i){var line=this.lines[i];var span=getMarkedSpanFor(line.markedSpans,this);if(cm&&!this.collapsed){regLineChange(cm,lineNo(line),"text");
}else{if(cm){if(span.to!=null){max=lineNo(line);}if(span.from!=null){min=lineNo(line);}}}line.markedSpans=removeMarkedSpan(line.markedSpans,span);
if(span.from==null&&this.collapsed&&!lineIsHidden(this.doc,line)&&cm){updateLineHeight(line,textHeight(cm.display));
}}if(cm&&this.collapsed&&!cm.options.lineWrapping){for(var i=0;i<this.lines.length;++i){var visual=visualLine(this.lines[i]),len=lineLength(visual);
if(len>cm.display.maxLineLength){cm.display.maxLine=visual;cm.display.maxLineLength=len;cm.display.maxLineChanged=true;
}}}if(min!=null&&cm&&this.collapsed){regChange(cm,min,max+1);}this.lines.length=0;this.explicitlyCleared=true;
if(this.atomic&&this.doc.cantEdit){this.doc.cantEdit=false;if(cm){reCheckSelection(cm.doc);}}if(cm){signalLater(cm,"markerCleared",cm,this);
}if(withOp){endOperation(cm);}if(this.parent){this.parent.clear();}};TextMarker.prototype.find=function(side,lineObj){if(side==null&&this.type=="bookmark"){side=1;
}var from,to;for(var i=0;i<this.lines.length;++i){var line=this.lines[i];var span=getMarkedSpanFor(line.markedSpans,this);
if(span.from!=null){from=Pos(lineObj?line:lineNo(line),span.from);if(side==-1){return from;}}if(span.to!=null){to=Pos(lineObj?line:lineNo(line),span.to);
if(side==1){return to;}}}return from&&{from:from,to:to};};TextMarker.prototype.changed=function(){var pos=this.find(-1,true),widget=this,cm=this.doc.cm;
if(!pos||!cm){return;}runInOp(cm,function(){var line=pos.line,lineN=lineNo(pos.line);var view=findViewForLine(cm,lineN);
if(view){clearLineMeasurementCacheFor(view);cm.curOp.selectionChanged=cm.curOp.forceUpdate=true;}cm.curOp.updateMaxLine=true;
if(!lineIsHidden(widget.doc,line)&&widget.height!=null){var oldHeight=widget.height;widget.height=null;
var dHeight=widgetHeight(widget)-oldHeight;if(dHeight){updateLineHeight(line,line.height+dHeight);}}});
};TextMarker.prototype.attachLine=function(line){if(!this.lines.length&&this.doc.cm){var op=this.doc.cm.curOp;
if(!op.maybeHiddenMarkers||indexOf(op.maybeHiddenMarkers,this)==-1){(op.maybeUnhiddenMarkers||(op.maybeUnhiddenMarkers=[])).push(this);
}}this.lines.push(line);};TextMarker.prototype.detachLine=function(line){this.lines.splice(indexOf(this.lines,line),1);
if(!this.lines.length&&this.doc.cm){var op=this.doc.cm.curOp;(op.maybeHiddenMarkers||(op.maybeHiddenMarkers=[])).push(this);
}};var nextMarkerId=0;function markText(doc,from,to,options,type){if(options&&options.shared){return markTextShared(doc,from,to,options,type);
}if(doc.cm&&!doc.cm.curOp){return operation(doc.cm,markText)(doc,from,to,options,type);}var marker=new TextMarker(doc,type),diff=cmp(from,to);
if(options){copyObj(options,marker,false);}if(diff>0||diff==0&&marker.clearWhenEmpty!==false){return marker;
}if(marker.replacedWith){marker.collapsed=true;marker.widgetNode=elt("span",[marker.replacedWith],"CodeMirror-widget");
if(!options.handleMouseEvents){marker.widgetNode.setAttribute("cm-ignore-events","true");}if(options.insertLeft){marker.widgetNode.insertLeft=true;
}}if(marker.collapsed){if(conflictingCollapsedRange(doc,from.line,from,to,marker)||from.line!=to.line&&conflictingCollapsedRange(doc,to.line,from,to,marker)){throw new Error("Inserting collapsed marker partially overlapping an existing one");
}sawCollapsedSpans=true;}if(marker.addToHistory){addChangeToHistory(doc,{from:from,to:to,origin:"markText"},doc.sel,NaN);
}var curLine=from.line,cm=doc.cm,updateMaxLine;doc.iter(curLine,to.line+1,function(line){if(cm&&marker.collapsed&&!cm.options.lineWrapping&&visualLine(line)==cm.display.maxLine){updateMaxLine=true;
}if(marker.collapsed&&curLine!=from.line){updateLineHeight(line,0);}addMarkedSpan(line,new MarkedSpan(marker,curLine==from.line?from.ch:null,curLine==to.line?to.ch:null));
++curLine;});if(marker.collapsed){doc.iter(from.line,to.line+1,function(line){if(lineIsHidden(doc,line)){updateLineHeight(line,0);
}});}if(marker.clearOnEnter){on(marker,"beforeCursorEnter",function(){marker.clear();});}if(marker.readOnly){sawReadOnlySpans=true;
if(doc.history.done.length||doc.history.undone.length){doc.clearHistory();}}if(marker.collapsed){marker.id=++nextMarkerId;
marker.atomic=true;}if(cm){if(updateMaxLine){cm.curOp.updateMaxLine=true;}if(marker.collapsed){regChange(cm,from.line,to.line+1);
}else{if(marker.className||marker.title||marker.startStyle||marker.endStyle||marker.css){for(var i=from.line;
i<=to.line;i++){regLineChange(cm,i,"text");}}}if(marker.atomic){reCheckSelection(cm.doc);}signalLater(cm,"markerAdded",cm,marker);
}return marker;}var SharedTextMarker=CodeMirror.SharedTextMarker=function(markers,primary){this.markers=markers;
this.primary=primary;for(var i=0;i<markers.length;++i){markers[i].parent=this;}};eventMixin(SharedTextMarker);
SharedTextMarker.prototype.clear=function(){if(this.explicitlyCleared){return;}this.explicitlyCleared=true;
for(var i=0;i<this.markers.length;++i){this.markers[i].clear();}signalLater(this,"clear");};SharedTextMarker.prototype.find=function(side,lineObj){return this.primary.find(side,lineObj);
};function markTextShared(doc,from,to,options,type){options=copyObj(options);options.shared=false;var markers=[markText(doc,from,to,options,type)],primary=markers[0];
var widget=options.widgetNode;linkedDocs(doc,function(doc){if(widget){options.widgetNode=widget.cloneNode(true);
}markers.push(markText(doc,clipPos(doc,from),clipPos(doc,to),options,type));for(var i=0;i<doc.linked.length;
++i){if(doc.linked[i].isParent){return;}}primary=lst(markers);});return new SharedTextMarker(markers,primary);
}function findSharedMarkers(doc){return doc.findMarks(Pos(doc.first,0),doc.clipPos(Pos(doc.lastLine())),function(m){return m.parent;
});}function copySharedMarkers(doc,markers){for(var i=0;i<markers.length;i++){var marker=markers[i],pos=marker.find();
var mFrom=doc.clipPos(pos.from),mTo=doc.clipPos(pos.to);if(cmp(mFrom,mTo)){var subMark=markText(doc,mFrom,mTo,marker.primary,marker.primary.type);
marker.markers.push(subMark);subMark.parent=marker;}}}function detachSharedMarkers(markers){for(var i=0;
i<markers.length;i++){var marker=markers[i],linked=[marker.primary.doc];linkedDocs(marker.primary.doc,function(d){linked.push(d);
});for(var j=0;j<marker.markers.length;j++){var subMarker=marker.markers[j];if(indexOf(linked,subMarker.doc)==-1){subMarker.parent=null;
marker.markers.splice(j--,1);}}}}function MarkedSpan(marker,from,to){this.marker=marker;this.from=from;
this.to=to;}function getMarkedSpanFor(spans,marker){if(spans){for(var i=0;i<spans.length;++i){var span=spans[i];
if(span.marker==marker){return span;}}}}function removeMarkedSpan(spans,span){for(var r,i=0;i<spans.length;
++i){if(spans[i]!=span){(r||(r=[])).push(spans[i]);}}return r;}function addMarkedSpan(line,span){line.markedSpans=line.markedSpans?line.markedSpans.concat([span]):[span];
span.marker.attachLine(line);}function markedSpansBefore(old,startCh,isInsert){if(old){for(var i=0,nw;
i<old.length;++i){var span=old[i],marker=span.marker;var startsBefore=span.from==null||(marker.inclusiveLeft?span.from<=startCh:span.from<startCh);
if(startsBefore||span.from==startCh&&marker.type=="bookmark"&&(!isInsert||!span.marker.insertLeft)){var endsAfter=span.to==null||(marker.inclusiveRight?span.to>=startCh:span.to>startCh);
(nw||(nw=[])).push(new MarkedSpan(marker,span.from,endsAfter?null:span.to));}}}return nw;}function markedSpansAfter(old,endCh,isInsert){if(old){for(var i=0,nw;
i<old.length;++i){var span=old[i],marker=span.marker;var endsAfter=span.to==null||(marker.inclusiveRight?span.to>=endCh:span.to>endCh);
if(endsAfter||span.from==endCh&&marker.type=="bookmark"&&(!isInsert||span.marker.insertLeft)){var startsBefore=span.from==null||(marker.inclusiveLeft?span.from<=endCh:span.from<endCh);
(nw||(nw=[])).push(new MarkedSpan(marker,startsBefore?null:span.from-endCh,span.to==null?null:span.to-endCh));
}}}return nw;}function stretchSpansOverChange(doc,change){if(change.full){return null;}var oldFirst=isLine(doc,change.from.line)&&getLine(doc,change.from.line).markedSpans;
var oldLast=isLine(doc,change.to.line)&&getLine(doc,change.to.line).markedSpans;if(!oldFirst&&!oldLast){return null;
}var startCh=change.from.ch,endCh=change.to.ch,isInsert=cmp(change.from,change.to)==0;var first=markedSpansBefore(oldFirst,startCh,isInsert);
var last=markedSpansAfter(oldLast,endCh,isInsert);var sameLine=change.text.length==1,offset=lst(change.text).length+(sameLine?startCh:0);
if(first){for(var i=0;i<first.length;++i){var span=first[i];if(span.to==null){var found=getMarkedSpanFor(last,span.marker);
if(!found){span.to=startCh;}else{if(sameLine){span.to=found.to==null?null:found.to+offset;}}}}}if(last){for(var i=0;
i<last.length;++i){var span=last[i];if(span.to!=null){span.to+=offset;}if(span.from==null){var found=getMarkedSpanFor(first,span.marker);
if(!found){span.from=offset;if(sameLine){(first||(first=[])).push(span);}}}else{span.from+=offset;if(sameLine){(first||(first=[])).push(span);
}}}}if(first){first=clearEmptySpans(first);}if(last&&last!=first){last=clearEmptySpans(last);}var newMarkers=[first];
if(!sameLine){var gap=change.text.length-2,gapMarkers;if(gap>0&&first){for(var i=0;i<first.length;++i){if(first[i].to==null){(gapMarkers||(gapMarkers=[])).push(new MarkedSpan(first[i].marker,null,null));
}}}for(var i=0;i<gap;++i){newMarkers.push(gapMarkers);}newMarkers.push(last);}return newMarkers;}function clearEmptySpans(spans){for(var i=0;
i<spans.length;++i){var span=spans[i];if(span.from!=null&&span.from==span.to&&span.marker.clearWhenEmpty!==false){spans.splice(i--,1);
}}if(!spans.length){return null;}return spans;}function mergeOldSpans(doc,change){var old=getOldSpans(doc,change);
var stretched=stretchSpansOverChange(doc,change);if(!old){return stretched;}if(!stretched){return old;
}for(var i=0;i<old.length;++i){var oldCur=old[i],stretchCur=stretched[i];if(oldCur&&stretchCur){spans:for(var j=0;
j<stretchCur.length;++j){var span=stretchCur[j];for(var k=0;k<oldCur.length;++k){if(oldCur[k].marker==span.marker){continue spans;
}}oldCur.push(span);}}else{if(stretchCur){old[i]=stretchCur;}}}return old;}function removeReadOnlyRanges(doc,from,to){var markers=null;
doc.iter(from.line,to.line+1,function(line){if(line.markedSpans){for(var i=0;i<line.markedSpans.length;
++i){var mark=line.markedSpans[i].marker;if(mark.readOnly&&(!markers||indexOf(markers,mark)==-1)){(markers||(markers=[])).push(mark);
}}}});if(!markers){return null;}var parts=[{from:from,to:to}];for(var i=0;i<markers.length;++i){var mk=markers[i],m=mk.find(0);
for(var j=0;j<parts.length;++j){var p=parts[j];if(cmp(p.to,m.from)<0||cmp(p.from,m.to)>0){continue;}var newParts=[j,1],dfrom=cmp(p.from,m.from),dto=cmp(p.to,m.to);
if(dfrom<0||!mk.inclusiveLeft&&!dfrom){newParts.push({from:p.from,to:m.from});}if(dto>0||!mk.inclusiveRight&&!dto){newParts.push({from:m.to,to:p.to});
}parts.splice.apply(parts,newParts);j+=newParts.length-1;}}return parts;}function detachMarkedSpans(line){var spans=line.markedSpans;
if(!spans){return;}for(var i=0;i<spans.length;++i){spans[i].marker.detachLine(line);}line.markedSpans=null;
}function attachMarkedSpans(line,spans){if(!spans){return;}for(var i=0;i<spans.length;++i){spans[i].marker.attachLine(line);
}line.markedSpans=spans;}function extraLeft(marker){return marker.inclusiveLeft?-1:0;}function extraRight(marker){return marker.inclusiveRight?1:0;
}function compareCollapsedMarkers(a,b){var lenDiff=a.lines.length-b.lines.length;if(lenDiff!=0){return lenDiff;
}var aPos=a.find(),bPos=b.find();var fromCmp=cmp(aPos.from,bPos.from)||extraLeft(a)-extraLeft(b);if(fromCmp){return -fromCmp;
}var toCmp=cmp(aPos.to,bPos.to)||extraRight(a)-extraRight(b);if(toCmp){return toCmp;}return b.id-a.id;
}function collapsedSpanAtSide(line,start){var sps=sawCollapsedSpans&&line.markedSpans,found;if(sps){for(var sp,i=0;
i<sps.length;++i){sp=sps[i];if(sp.marker.collapsed&&(start?sp.from:sp.to)==null&&(!found||compareCollapsedMarkers(found,sp.marker)<0)){found=sp.marker;
}}}return found;}function collapsedSpanAtStart(line){return collapsedSpanAtSide(line,true);}function collapsedSpanAtEnd(line){return collapsedSpanAtSide(line,false);
}function conflictingCollapsedRange(doc,lineNo,from,to,marker){var line=getLine(doc,lineNo);var sps=sawCollapsedSpans&&line.markedSpans;
if(sps){for(var i=0;i<sps.length;++i){var sp=sps[i];if(!sp.marker.collapsed){continue;}var found=sp.marker.find(0);
var fromCmp=cmp(found.from,from)||extraLeft(sp.marker)-extraLeft(marker);var toCmp=cmp(found.to,to)||extraRight(sp.marker)-extraRight(marker);
if(fromCmp>=0&&toCmp<=0||fromCmp<=0&&toCmp>=0){continue;}if(fromCmp<=0&&(sp.marker.inclusiveRight&&marker.inclusiveLeft?cmp(found.to,from)>=0:cmp(found.to,from)>0)||fromCmp>=0&&(sp.marker.inclusiveRight&&marker.inclusiveLeft?cmp(found.from,to)<=0:cmp(found.from,to)<0)){return true;
}}}}function visualLine(line){var merged;while(merged=collapsedSpanAtStart(line)){line=merged.find(-1,true).line;
}return line;}function visualLineContinued(line){var merged,lines;while(merged=collapsedSpanAtEnd(line)){line=merged.find(1,true).line;
(lines||(lines=[])).push(line);}return lines;}function visualLineNo(doc,lineN){var line=getLine(doc,lineN),vis=visualLine(line);
if(line==vis){return lineN;}return lineNo(vis);}function visualLineEndNo(doc,lineN){if(lineN>doc.lastLine()){return lineN;
}var line=getLine(doc,lineN),merged;if(!lineIsHidden(doc,line)){return lineN;}while(merged=collapsedSpanAtEnd(line)){line=merged.find(1,true).line;
}return lineNo(line)+1;}function lineIsHidden(doc,line){var sps=sawCollapsedSpans&&line.markedSpans;if(sps){for(var sp,i=0;
i<sps.length;++i){sp=sps[i];if(!sp.marker.collapsed){continue;}if(sp.from==null){return true;}if(sp.marker.widgetNode){continue;
}if(sp.from==0&&sp.marker.inclusiveLeft&&lineIsHiddenInner(doc,line,sp)){return true;}}}}function lineIsHiddenInner(doc,line,span){if(span.to==null){var end=span.marker.find(1,true);
return lineIsHiddenInner(doc,end.line,getMarkedSpanFor(end.line.markedSpans,span.marker));}if(span.marker.inclusiveRight&&span.to==line.text.length){return true;
}for(var sp,i=0;i<line.markedSpans.length;++i){sp=line.markedSpans[i];if(sp.marker.collapsed&&!sp.marker.widgetNode&&sp.from==span.to&&(sp.to==null||sp.to!=span.from)&&(sp.marker.inclusiveLeft||span.marker.inclusiveRight)&&lineIsHiddenInner(doc,line,sp)){return true;
}}}var LineWidget=CodeMirror.LineWidget=function(doc,node,options){if(options){for(var opt in options){if(options.hasOwnProperty(opt)){this[opt]=options[opt];
}}}this.doc=doc;this.node=node;};eventMixin(LineWidget);function adjustScrollWhenAboveVisible(cm,line,diff){if(heightAtLine(line)<((cm.curOp&&cm.curOp.scrollTop)||cm.doc.scrollTop)){addToScrollPos(cm,null,diff);
}}LineWidget.prototype.clear=function(){var cm=this.doc.cm,ws=this.line.widgets,line=this.line,no=lineNo(line);
if(no==null||!ws){return;}for(var i=0;i<ws.length;++i){if(ws[i]==this){ws.splice(i--,1);}}if(!ws.length){line.widgets=null;
}var height=widgetHeight(this);updateLineHeight(line,Math.max(0,line.height-height));if(cm){runInOp(cm,function(){adjustScrollWhenAboveVisible(cm,line,-height);
regLineChange(cm,no,"widget");});}};LineWidget.prototype.changed=function(){var oldH=this.height,cm=this.doc.cm,line=this.line;
this.height=null;var diff=widgetHeight(this)-oldH;if(!diff){return;}updateLineHeight(line,line.height+diff);
if(cm){runInOp(cm,function(){cm.curOp.forceUpdate=true;adjustScrollWhenAboveVisible(cm,line,diff);});
}};function widgetHeight(widget){if(widget.height!=null){return widget.height;}var cm=widget.doc.cm;if(!cm){return 0;
}if(!contains(document.body,widget.node)){var parentStyle="position: relative;";if(widget.coverGutter){parentStyle+="margin-left: -"+cm.display.gutters.offsetWidth+"px;";
}if(widget.noHScroll){parentStyle+="width: "+cm.display.wrapper.clientWidth+"px;";}removeChildrenAndAdd(cm.display.measure,elt("div",[widget.node],null,parentStyle));
}return widget.height=widget.node.parentNode.offsetHeight;}function addLineWidget(doc,handle,node,options){var widget=new LineWidget(doc,node,options);
var cm=doc.cm;if(cm&&widget.noHScroll){cm.display.alignWidgets=true;}changeLine(doc,handle,"widget",function(line){var widgets=line.widgets||(line.widgets=[]);
if(widget.insertAt==null){widgets.push(widget);}else{widgets.splice(Math.min(widgets.length-1,Math.max(0,widget.insertAt)),0,widget);
}widget.line=line;if(cm&&!lineIsHidden(doc,line)){var aboveVisible=heightAtLine(line)<doc.scrollTop;updateLineHeight(line,line.height+widgetHeight(widget));
if(aboveVisible){addToScrollPos(cm,null,widget.height);}cm.curOp.forceUpdate=true;}return true;});return widget;
}var Line=CodeMirror.Line=function(text,markedSpans,estimateHeight){this.text=text;attachMarkedSpans(this,markedSpans);
this.height=estimateHeight?estimateHeight(this):1;};eventMixin(Line);Line.prototype.lineNo=function(){return lineNo(this);
};function updateLine(line,text,markedSpans,estimateHeight){line.text=text;if(line.stateAfter){line.stateAfter=null;
}if(line.styles){line.styles=null;}if(line.order!=null){line.order=null;}detachMarkedSpans(line);attachMarkedSpans(line,markedSpans);
var estHeight=estimateHeight?estimateHeight(line):1;if(estHeight!=line.height){updateLineHeight(line,estHeight);
}}function cleanUpLine(line){line.parent=null;detachMarkedSpans(line);}function extractLineClasses(type,output){if(type){for(;
;){var lineClass=type.match(/(?:^|\s+)line-(background-)?(\S+)/);if(!lineClass){break;}type=type.slice(0,lineClass.index)+type.slice(lineClass.index+lineClass[0].length);
var prop=lineClass[1]?"bgClass":"textClass";if(output[prop]==null){output[prop]=lineClass[2];}else{if(!(new RegExp("(?:^|s)"+lineClass[2]+"(?:$|s)")).test(output[prop])){output[prop]+=" "+lineClass[2];
}}}}return type;}function callBlankLine(mode,state){if(mode.blankLine){return mode.blankLine(state);}if(!mode.innerMode){return;
}var inner=CodeMirror.innerMode(mode,state);if(inner.mode.blankLine){return inner.mode.blankLine(inner.state);
}}function readToken(mode,stream,state,inner){for(var i=0;i<10;i++){if(inner){inner[0]=CodeMirror.innerMode(mode,state).mode;
}var style=mode.token(stream,state);if(stream.pos>stream.start){return style;}}throw new Error("Mode "+mode.name+" failed to advance stream.");
}function takeToken(cm,pos,precise,asArray){function getObj(copy){return{start:stream.start,end:stream.pos,string:stream.current(),type:style||null,state:copy?copyState(doc.mode,state):state};
}var doc=cm.doc,mode=doc.mode,style;pos=clipPos(doc,pos);var line=getLine(doc,pos.line),state=getStateBefore(cm,pos.line,precise);
var stream=new StringStream(line.text,cm.options.tabSize),tokens;if(asArray){tokens=[];}while((asArray||stream.pos<pos.ch)&&!stream.eol()){stream.start=stream.pos;
style=readToken(mode,stream,state);if(asArray){tokens.push(getObj(true));}}return asArray?tokens:getObj();
}function runMode(cm,text,mode,state,f,lineClasses,forceToEnd){var flattenSpans=mode.flattenSpans;if(flattenSpans==null){flattenSpans=cm.options.flattenSpans;
}var curStart=0,curStyle=null;var stream=new StringStream(text,cm.options.tabSize),style;var inner=cm.options.addModeClass&&[null];
if(text==""){extractLineClasses(callBlankLine(mode,state),lineClasses);}while(!stream.eol()){if(stream.pos>cm.options.maxHighlightLength){flattenSpans=false;
if(forceToEnd){processLine(cm,text,state,stream.pos);}stream.pos=text.length;style=null;}else{style=extractLineClasses(readToken(mode,stream,state,inner),lineClasses);
}if(inner){var mName=inner[0].name;if(mName){style="m-"+(style?mName+" "+style:mName);}}if(!flattenSpans||curStyle!=style){while(curStart<stream.start){curStart=Math.min(stream.start,curStart+50000);
f(curStart,curStyle);}curStyle=style;}stream.start=stream.pos;}while(curStart<stream.pos){var pos=Math.min(stream.pos,curStart+50000);
f(pos,curStyle);curStart=pos;}}function highlightLine(cm,line,state,forceToEnd){var st=[cm.state.modeGen],lineClasses={};
runMode(cm,line.text,cm.doc.mode,state,function(end,style){st.push(end,style);},lineClasses,forceToEnd);
for(var o=0;o<cm.state.overlays.length;++o){var overlay=cm.state.overlays[o],i=1,at=0;runMode(cm,line.text,overlay.mode,true,function(end,style){var start=i;
while(at<end){var i_end=st[i];if(i_end>end){st.splice(i,1,end,st[i+1],i_end);}i+=2;at=Math.min(end,i_end);
}if(!style){return;}if(overlay.opaque){st.splice(start,i-start,end,"cm-overlay "+style);i=start+2;}else{for(;
start<i;start+=2){var cur=st[start+1];st[start+1]=(cur?cur+" ":"")+"cm-overlay "+style;}}},lineClasses);
}return{styles:st,classes:lineClasses.bgClass||lineClasses.textClass?lineClasses:null};}function getLineStyles(cm,line,updateFrontier){if(!line.styles||line.styles[0]!=cm.state.modeGen){var state=getStateBefore(cm,lineNo(line));
var result=highlightLine(cm,line,line.text.length>cm.options.maxHighlightLength?copyState(cm.doc.mode,state):state);
line.stateAfter=state;line.styles=result.styles;if(result.classes){line.styleClasses=result.classes;}else{if(line.styleClasses){line.styleClasses=null;
}}if(updateFrontier===cm.doc.frontier){cm.doc.frontier++;}}return line.styles;}function processLine(cm,text,state,startAt){var mode=cm.doc.mode;
var stream=new StringStream(text,cm.options.tabSize);stream.start=stream.pos=startAt||0;if(text==""){callBlankLine(mode,state);
}while(!stream.eol()){readToken(mode,stream,state);stream.start=stream.pos;}}var styleToClassCache={},styleToClassCacheWithMode={};
function interpretTokenStyle(style,options){if(!style||/^\s*$/.test(style)){return null;}var cache=options.addModeClass?styleToClassCacheWithMode:styleToClassCache;
return cache[style]||(cache[style]=style.replace(/\S+/g,"cm-$&"));}function buildLineContent(cm,lineView){var content=elt("span",null,null,webkit?"padding-right: .1px":null);
var builder={pre:elt("pre",[content],"CodeMirror-line"),content:content,col:0,pos:0,cm:cm,trailingSpace:false,splitSpaces:(ie||webkit)&&cm.getOption("lineWrapping")};
lineView.measure={};for(var i=0;i<=(lineView.rest?lineView.rest.length:0);i++){var line=i?lineView.rest[i-1]:lineView.line,order;
builder.pos=0;builder.addToken=buildToken;if(hasBadBidiRects(cm.display.measure)&&(order=getOrder(line))){builder.addToken=buildTokenBadBidi(builder.addToken,order);
}builder.map=[];var allowFrontierUpdate=lineView!=cm.display.externalMeasured&&lineNo(line);insertLineContent(line,builder,getLineStyles(cm,line,allowFrontierUpdate));
if(line.styleClasses){if(line.styleClasses.bgClass){builder.bgClass=joinClasses(line.styleClasses.bgClass,builder.bgClass||"");
}if(line.styleClasses.textClass){builder.textClass=joinClasses(line.styleClasses.textClass,builder.textClass||"");
}}if(builder.map.length==0){builder.map.push(0,0,builder.content.appendChild(zeroWidthElement(cm.display.measure)));
}if(i==0){lineView.measure.map=builder.map;lineView.measure.cache={};}else{(lineView.measure.maps||(lineView.measure.maps=[])).push(builder.map);
(lineView.measure.caches||(lineView.measure.caches=[])).push({});}}if(webkit){var last=builder.content.lastChild;
if(/\bcm-tab\b/.test(last.className)||(last.querySelector&&last.querySelector(".cm-tab"))){builder.content.className="cm-tab-wrap-hack";
}}signal(cm,"renderLine",cm,lineView.line,builder.pre);if(builder.pre.className){builder.textClass=joinClasses(builder.pre.className,builder.textClass||"");
}return builder;}function defaultSpecialCharPlaceholder(ch){var token=elt("span","\u2022","cm-invalidchar");
token.title="\\u"+ch.charCodeAt(0).toString(16);token.setAttribute("aria-label",token.title);return token;
}function buildToken(builder,text,style,startStyle,endStyle,title,css){if(!text){return;}var displayText=builder.splitSpaces?splitSpaces(text,builder.trailingSpace):text;
var special=builder.cm.state.specialChars,mustWrap=false;if(!special.test(text)){builder.col+=text.length;
var content=document.createTextNode(displayText);builder.map.push(builder.pos,builder.pos+text.length,content);
if(ie&&ie_version<9){mustWrap=true;}builder.pos+=text.length;}else{var content=document.createDocumentFragment(),pos=0;
while(true){special.lastIndex=pos;var m=special.exec(text);var skipped=m?m.index-pos:text.length-pos;
if(skipped){var txt=document.createTextNode(displayText.slice(pos,pos+skipped));if(ie&&ie_version<9){content.appendChild(elt("span",[txt]));
}else{content.appendChild(txt);}builder.map.push(builder.pos,builder.pos+skipped,txt);builder.col+=skipped;
builder.pos+=skipped;}if(!m){break;}pos+=skipped+1;if(m[0]=="\t"){var tabSize=builder.cm.options.tabSize,tabWidth=tabSize-builder.col%tabSize;
var txt=content.appendChild(elt("span",spaceStr(tabWidth),"cm-tab"));txt.setAttribute("role","presentation");
txt.setAttribute("cm-text","\t");builder.col+=tabWidth;}else{if(m[0]=="\r"||m[0]=="\n"){var txt=content.appendChild(elt("span",m[0]=="\r"?"\u240d":"\u2424","cm-invalidchar"));
txt.setAttribute("cm-text",m[0]);builder.col+=1;}else{var txt=builder.cm.options.specialCharPlaceholder(m[0]);
txt.setAttribute("cm-text",m[0]);if(ie&&ie_version<9){content.appendChild(elt("span",[txt]));}else{content.appendChild(txt);
}builder.col+=1;}}builder.map.push(builder.pos,builder.pos+1,txt);builder.pos++;}}builder.trailingSpace=displayText.charCodeAt(text.length-1)==32;
if(style||startStyle||endStyle||mustWrap||css){var fullStyle=style||"";if(startStyle){fullStyle+=startStyle;
}if(endStyle){fullStyle+=endStyle;}var token=elt("span",[content],fullStyle,css);if(title){token.title=title;
}return builder.content.appendChild(token);}builder.content.appendChild(content);}function splitSpaces(text,trailingBefore){if(text.length>1&&!/  /.test(text)){return text;
}var spaceBefore=trailingBefore,result="";for(var i=0;i<text.length;i++){var ch=text.charAt(i);if(ch==" "&&spaceBefore&&(i==text.length-1||text.charCodeAt(i+1)==32)){ch="\u00a0";
}result+=ch;spaceBefore=ch==" ";}return result;}function buildTokenBadBidi(inner,order){return function(builder,text,style,startStyle,endStyle,title,css){style=style?style+" cm-force-border":"cm-force-border";
var start=builder.pos,end=start+text.length;for(;;){for(var i=0;i<order.length;i++){var part=order[i];
if(part.to>start&&part.from<=start){break;}}if(part.to>=end){return inner(builder,text,style,startStyle,endStyle,title,css);
}inner(builder,text.slice(0,part.to-start),style,startStyle,null,title,css);startStyle=null;text=text.slice(part.to-start);
start=part.to;}};}function buildCollapsedSpan(builder,size,marker,ignoreWidget){var widget=!ignoreWidget&&marker.widgetNode;
if(widget){builder.map.push(builder.pos,builder.pos+size,widget);}if(!ignoreWidget&&builder.cm.display.input.needsContentAttribute){if(!widget){widget=builder.content.appendChild(document.createElement("span"));
}widget.setAttribute("cm-marker",marker.id);}if(widget){builder.cm.display.input.setUneditable(widget);
builder.content.appendChild(widget);}builder.pos+=size;builder.trailingSpace=false;}function insertLineContent(line,builder,styles){var spans=line.markedSpans,allText=line.text,at=0;
if(!spans){for(var i=1;i<styles.length;i+=2){builder.addToken(builder,allText.slice(at,at=styles[i]),interpretTokenStyle(styles[i+1],builder.cm.options));
}return;}var len=allText.length,pos=0,i=1,text="",style,css;var nextChange=0,spanStyle,spanEndStyle,spanStartStyle,title,collapsed;
for(;;){if(nextChange==pos){spanStyle=spanEndStyle=spanStartStyle=title=css="";collapsed=null;nextChange=Infinity;
var foundBookmarks=[],endStyles;for(var j=0;j<spans.length;++j){var sp=spans[j],m=sp.marker;if(m.type=="bookmark"&&sp.from==pos&&m.widgetNode){foundBookmarks.push(m);
}else{if(sp.from<=pos&&(sp.to==null||sp.to>pos||m.collapsed&&sp.to==pos&&sp.from==pos)){if(sp.to!=null&&sp.to!=pos&&nextChange>sp.to){nextChange=sp.to;
spanEndStyle="";}if(m.className){spanStyle+=" "+m.className;}if(m.css){css=(css?css+";":"")+m.css;}if(m.startStyle&&sp.from==pos){spanStartStyle+=" "+m.startStyle;
}if(m.endStyle&&sp.to==nextChange){(endStyles||(endStyles=[])).push(m.endStyle,sp.to);}if(m.title&&!title){title=m.title;
}if(m.collapsed&&(!collapsed||compareCollapsedMarkers(collapsed.marker,m)<0)){collapsed=sp;}}else{if(sp.from>pos&&nextChange>sp.from){nextChange=sp.from;
}}}}if(endStyles){for(var j=0;j<endStyles.length;j+=2){if(endStyles[j+1]==nextChange){spanEndStyle+=" "+endStyles[j];
}}}if(!collapsed||collapsed.from==pos){for(var j=0;j<foundBookmarks.length;++j){buildCollapsedSpan(builder,0,foundBookmarks[j]);
}}if(collapsed&&(collapsed.from||0)==pos){buildCollapsedSpan(builder,(collapsed.to==null?len+1:collapsed.to)-pos,collapsed.marker,collapsed.from==null);
if(collapsed.to==null){return;}if(collapsed.to==pos){collapsed=false;}}}if(pos>=len){break;}var upto=Math.min(len,nextChange);
while(true){if(text){var end=pos+text.length;if(!collapsed){var tokenText=end>upto?text.slice(0,upto-pos):text;
builder.addToken(builder,tokenText,style?style+spanStyle:spanStyle,spanStartStyle,pos+tokenText.length==nextChange?spanEndStyle:"",title,css);
}if(end>=upto){text=text.slice(upto-pos);pos=upto;break;}pos=end;spanStartStyle="";}text=allText.slice(at,at=styles[i++]);
style=interpretTokenStyle(styles[i++],builder.cm.options);}}}function isWholeLineUpdate(doc,change){return change.from.ch==0&&change.to.ch==0&&lst(change.text)==""&&(!doc.cm||doc.cm.options.wholeLineUpdateBefore);
}function updateDoc(doc,change,markedSpans,estimateHeight){function spansFor(n){return markedSpans?markedSpans[n]:null;
}function update(line,text,spans){updateLine(line,text,spans,estimateHeight);signalLater(line,"change",line,change);
}function linesFor(start,end){for(var i=start,result=[];i<end;++i){result.push(new Line(text[i],spansFor(i),estimateHeight));
}return result;}var from=change.from,to=change.to,text=change.text;var firstLine=getLine(doc,from.line),lastLine=getLine(doc,to.line);
var lastText=lst(text),lastSpans=spansFor(text.length-1),nlines=to.line-from.line;if(change.full){doc.insert(0,linesFor(0,text.length));
doc.remove(text.length,doc.size-text.length);}else{if(isWholeLineUpdate(doc,change)){var added=linesFor(0,text.length-1);
update(lastLine,lastLine.text,lastSpans);if(nlines){doc.remove(from.line,nlines);}if(added.length){doc.insert(from.line,added);
}}else{if(firstLine==lastLine){if(text.length==1){update(firstLine,firstLine.text.slice(0,from.ch)+lastText+firstLine.text.slice(to.ch),lastSpans);
}else{var added=linesFor(1,text.length-1);added.push(new Line(lastText+firstLine.text.slice(to.ch),lastSpans,estimateHeight));
update(firstLine,firstLine.text.slice(0,from.ch)+text[0],spansFor(0));doc.insert(from.line+1,added);}}else{if(text.length==1){update(firstLine,firstLine.text.slice(0,from.ch)+text[0]+lastLine.text.slice(to.ch),spansFor(0));
doc.remove(from.line+1,nlines);}else{update(firstLine,firstLine.text.slice(0,from.ch)+text[0],spansFor(0));
update(lastLine,lastText+lastLine.text.slice(to.ch),lastSpans);var added=linesFor(1,text.length-1);if(nlines>1){doc.remove(from.line+1,nlines-1);
}doc.insert(from.line+1,added);}}}}signalLater(doc,"change",doc,change);}function LeafChunk(lines){this.lines=lines;
this.parent=null;for(var i=0,height=0;i<lines.length;++i){lines[i].parent=this;height+=lines[i].height;
}this.height=height;}LeafChunk.prototype={chunkSize:function(){return this.lines.length;},removeInner:function(at,n){for(var i=at,e=at+n;
i<e;++i){var line=this.lines[i];this.height-=line.height;cleanUpLine(line);signalLater(line,"delete");
}this.lines.splice(at,n);},collapse:function(lines){lines.push.apply(lines,this.lines);},insertInner:function(at,lines,height){this.height+=height;
this.lines=this.lines.slice(0,at).concat(lines).concat(this.lines.slice(at));for(var i=0;i<lines.length;
++i){lines[i].parent=this;}},iterN:function(at,n,op){for(var e=at+n;at<e;++at){if(op(this.lines[at])){return true;
}}}};function BranchChunk(children){this.children=children;var size=0,height=0;for(var i=0;i<children.length;
++i){var ch=children[i];size+=ch.chunkSize();height+=ch.height;ch.parent=this;}this.size=size;this.height=height;
this.parent=null;}BranchChunk.prototype={chunkSize:function(){return this.size;},removeInner:function(at,n){this.size-=n;
for(var i=0;i<this.children.length;++i){var child=this.children[i],sz=child.chunkSize();if(at<sz){var rm=Math.min(n,sz-at),oldHeight=child.height;
child.removeInner(at,rm);this.height-=oldHeight-child.height;if(sz==rm){this.children.splice(i--,1);child.parent=null;
}if((n-=rm)==0){break;}at=0;}else{at-=sz;}}if(this.size-n<25&&(this.children.length>1||!(this.children[0] instanceof LeafChunk))){var lines=[];
this.collapse(lines);this.children=[new LeafChunk(lines)];this.children[0].parent=this;}},collapse:function(lines){for(var i=0;
i<this.children.length;++i){this.children[i].collapse(lines);}},insertInner:function(at,lines,height){this.size+=lines.length;
this.height+=height;for(var i=0;i<this.children.length;++i){var child=this.children[i],sz=child.chunkSize();
if(at<=sz){child.insertInner(at,lines,height);if(child.lines&&child.lines.length>50){var remaining=child.lines.length%25+25;
for(var pos=remaining;pos<child.lines.length;){var leaf=new LeafChunk(child.lines.slice(pos,pos+=25));
child.height-=leaf.height;this.children.splice(++i,0,leaf);leaf.parent=this;}child.lines=child.lines.slice(0,remaining);
this.maybeSpill();}break;}at-=sz;}},maybeSpill:function(){if(this.children.length<=10){return;}var me=this;
do{var spilled=me.children.splice(me.children.length-5,5);var sibling=new BranchChunk(spilled);if(!me.parent){var copy=new BranchChunk(me.children);
copy.parent=me;me.children=[copy,sibling];me=copy;}else{me.size-=sibling.size;me.height-=sibling.height;
var myIndex=indexOf(me.parent.children,me);me.parent.children.splice(myIndex+1,0,sibling);}sibling.parent=me.parent;
}while(me.children.length>10);me.parent.maybeSpill();},iterN:function(at,n,op){for(var i=0;i<this.children.length;
++i){var child=this.children[i],sz=child.chunkSize();if(at<sz){var used=Math.min(n,sz-at);if(child.iterN(at,used,op)){return true;
}if((n-=used)==0){break;}at=0;}else{at-=sz;}}}};var nextDocId=0;var Doc=CodeMirror.Doc=function(text,mode,firstLine,lineSep){if(!(this instanceof Doc)){return new Doc(text,mode,firstLine,lineSep);
}if(firstLine==null){firstLine=0;}BranchChunk.call(this,[new LeafChunk([new Line("",null)])]);this.first=firstLine;
this.scrollTop=this.scrollLeft=0;this.cantEdit=false;this.cleanGeneration=1;this.frontier=firstLine;var start=Pos(firstLine,0);
this.sel=simpleSelection(start);this.history=new History(null);this.id=++nextDocId;this.modeOption=mode;
this.lineSep=lineSep;this.extend=false;if(typeof text=="string"){text=this.splitLines(text);}updateDoc(this,{from:start,to:start,text:text});
setSelection(this,simpleSelection(start),sel_dontScroll);};Doc.prototype=createObj(BranchChunk.prototype,{constructor:Doc,iter:function(from,to,op){if(op){this.iterN(from-this.first,to-from,op);
}else{this.iterN(this.first,this.first+this.size,from);}},insert:function(at,lines){var height=0;for(var i=0;
i<lines.length;++i){height+=lines[i].height;}this.insertInner(at-this.first,lines,height);},remove:function(at,n){this.removeInner(at-this.first,n);
},getValue:function(lineSep){var lines=getLines(this,this.first,this.first+this.size);if(lineSep===false){return lines;
}return lines.join(lineSep||this.lineSeparator());},setValue:docMethodOp(function(code){var top=Pos(this.first,0),last=this.first+this.size-1;
makeChange(this,{from:top,to:Pos(last,getLine(this,last).text.length),text:this.splitLines(code),origin:"setValue",full:true},true);
setSelection(this,simpleSelection(top));}),replaceRange:function(code,from,to,origin){from=clipPos(this,from);
to=to?clipPos(this,to):from;replaceRange(this,code,from,to,origin);},getRange:function(from,to,lineSep){var lines=getBetween(this,clipPos(this,from),clipPos(this,to));
if(lineSep===false){return lines;}return lines.join(lineSep||this.lineSeparator());},getLine:function(line){var l=this.getLineHandle(line);
return l&&l.text;},getLineHandle:function(line){if(isLine(this,line)){return getLine(this,line);}},getLineNumber:function(line){return lineNo(line);
},getLineHandleVisualStart:function(line){if(typeof line=="number"){line=getLine(this,line);}return visualLine(line);
},lineCount:function(){return this.size;},firstLine:function(){return this.first;},lastLine:function(){return this.first+this.size-1;
},clipPos:function(pos){return clipPos(this,pos);},getCursor:function(start){var range=this.sel.primary(),pos;
if(start==null||start=="head"){pos=range.head;}else{if(start=="anchor"){pos=range.anchor;}else{if(start=="end"||start=="to"||start===false){pos=range.to();
}else{pos=range.from();}}}return pos;},listSelections:function(){return this.sel.ranges;},somethingSelected:function(){return this.sel.somethingSelected();
},setCursor:docMethodOp(function(line,ch,options){setSimpleSelection(this,clipPos(this,typeof line=="number"?Pos(line,ch||0):line),null,options);
}),setSelection:docMethodOp(function(anchor,head,options){setSimpleSelection(this,clipPos(this,anchor),clipPos(this,head||anchor),options);
}),extendSelection:docMethodOp(function(head,other,options){extendSelection(this,clipPos(this,head),other&&clipPos(this,other),options);
}),extendSelections:docMethodOp(function(heads,options){extendSelections(this,clipPosArray(this,heads),options);
}),extendSelectionsBy:docMethodOp(function(f,options){var heads=map(this.sel.ranges,f);extendSelections(this,clipPosArray(this,heads),options);
}),setSelections:docMethodOp(function(ranges,primary,options){if(!ranges.length){return;}for(var i=0,out=[];
i<ranges.length;i++){out[i]=new Range(clipPos(this,ranges[i].anchor),clipPos(this,ranges[i].head));}if(primary==null){primary=Math.min(ranges.length-1,this.sel.primIndex);
}setSelection(this,normalizeSelection(out,primary),options);}),addSelection:docMethodOp(function(anchor,head,options){var ranges=this.sel.ranges.slice(0);
ranges.push(new Range(clipPos(this,anchor),clipPos(this,head||anchor)));setSelection(this,normalizeSelection(ranges,ranges.length-1),options);
}),getSelection:function(lineSep){var ranges=this.sel.ranges,lines;for(var i=0;i<ranges.length;i++){var sel=getBetween(this,ranges[i].from(),ranges[i].to());
lines=lines?lines.concat(sel):sel;}if(lineSep===false){return lines;}else{return lines.join(lineSep||this.lineSeparator());
}},getSelections:function(lineSep){var parts=[],ranges=this.sel.ranges;for(var i=0;i<ranges.length;i++){var sel=getBetween(this,ranges[i].from(),ranges[i].to());
if(lineSep!==false){sel=sel.join(lineSep||this.lineSeparator());}parts[i]=sel;}return parts;},replaceSelection:function(code,collapse,origin){var dup=[];
for(var i=0;i<this.sel.ranges.length;i++){dup[i]=code;}this.replaceSelections(dup,collapse,origin||"+input");
},replaceSelections:docMethodOp(function(code,collapse,origin){var changes=[],sel=this.sel;for(var i=0;
i<sel.ranges.length;i++){var range=sel.ranges[i];changes[i]={from:range.from(),to:range.to(),text:this.splitLines(code[i]),origin:origin};
}var newSel=collapse&&collapse!="end"&&computeReplacedSel(this,changes,collapse);for(var i=changes.length-1;
i>=0;i--){makeChange(this,changes[i]);}if(newSel){setSelectionReplaceHistory(this,newSel);}else{if(this.cm){ensureCursorVisible(this.cm);
}}}),undo:docMethodOp(function(){makeChangeFromHistory(this,"undo");}),redo:docMethodOp(function(){makeChangeFromHistory(this,"redo");
}),undoSelection:docMethodOp(function(){makeChangeFromHistory(this,"undo",true);}),redoSelection:docMethodOp(function(){makeChangeFromHistory(this,"redo",true);
}),setExtending:function(val){this.extend=val;},getExtending:function(){return this.extend;},historySize:function(){var hist=this.history,done=0,undone=0;
for(var i=0;i<hist.done.length;i++){if(!hist.done[i].ranges){++done;}}for(var i=0;i<hist.undone.length;
i++){if(!hist.undone[i].ranges){++undone;}}return{undo:done,redo:undone};},clearHistory:function(){this.history=new History(this.history.maxGeneration);
},markClean:function(){this.cleanGeneration=this.changeGeneration(true);},changeGeneration:function(forceSplit){if(forceSplit){this.history.lastOp=this.history.lastSelOp=this.history.lastOrigin=null;
}return this.history.generation;},isClean:function(gen){return this.history.generation==(gen||this.cleanGeneration);
},getHistory:function(){return{done:copyHistoryArray(this.history.done),undone:copyHistoryArray(this.history.undone)};
},setHistory:function(histData){var hist=this.history=new History(this.history.maxGeneration);hist.done=copyHistoryArray(histData.done.slice(0),null,true);
hist.undone=copyHistoryArray(histData.undone.slice(0),null,true);},addLineClass:docMethodOp(function(handle,where,cls){return changeLine(this,handle,where=="gutter"?"gutter":"class",function(line){var prop=where=="text"?"textClass":where=="background"?"bgClass":where=="gutter"?"gutterClass":"wrapClass";
if(!line[prop]){line[prop]=cls;}else{if(classTest(cls).test(line[prop])){return false;}else{line[prop]+=" "+cls;
}}return true;});}),removeLineClass:docMethodOp(function(handle,where,cls){return changeLine(this,handle,where=="gutter"?"gutter":"class",function(line){var prop=where=="text"?"textClass":where=="background"?"bgClass":where=="gutter"?"gutterClass":"wrapClass";
var cur=line[prop];if(!cur){return false;}else{if(cls==null){line[prop]=null;}else{var found=cur.match(classTest(cls));
if(!found){return false;}var end=found.index+found[0].length;line[prop]=cur.slice(0,found.index)+(!found.index||end==cur.length?"":" ")+cur.slice(end)||null;
}}return true;});}),addLineWidget:docMethodOp(function(handle,node,options){return addLineWidget(this,handle,node,options);
}),removeLineWidget:function(widget){widget.clear();},markText:function(from,to,options){return markText(this,clipPos(this,from),clipPos(this,to),options,options&&options.type||"range");
},setBookmark:function(pos,options){var realOpts={replacedWith:options&&(options.nodeType==null?options.widget:options),insertLeft:options&&options.insertLeft,clearWhenEmpty:false,shared:options&&options.shared,handleMouseEvents:options&&options.handleMouseEvents};
pos=clipPos(this,pos);return markText(this,pos,pos,realOpts,"bookmark");},findMarksAt:function(pos){pos=clipPos(this,pos);
var markers=[],spans=getLine(this,pos.line).markedSpans;if(spans){for(var i=0;i<spans.length;++i){var span=spans[i];
if((span.from==null||span.from<=pos.ch)&&(span.to==null||span.to>=pos.ch)){markers.push(span.marker.parent||span.marker);
}}}return markers;},findMarks:function(from,to,filter){from=clipPos(this,from);to=clipPos(this,to);var found=[],lineNo=from.line;
this.iter(from.line,to.line+1,function(line){var spans=line.markedSpans;if(spans){for(var i=0;i<spans.length;
i++){var span=spans[i];if(!(span.to!=null&&lineNo==from.line&&from.ch>=span.to||span.from==null&&lineNo!=from.line||span.from!=null&&lineNo==to.line&&span.from>=to.ch)&&(!filter||filter(span.marker))){found.push(span.marker.parent||span.marker);
}}}++lineNo;});return found;},getAllMarks:function(){var markers=[];this.iter(function(line){var sps=line.markedSpans;
if(sps){for(var i=0;i<sps.length;++i){if(sps[i].from!=null){markers.push(sps[i].marker);}}}});return markers;
},posFromIndex:function(off){var ch,lineNo=this.first,sepSize=this.lineSeparator().length;this.iter(function(line){var sz=line.text.length+sepSize;
if(sz>off){ch=off;return true;}off-=sz;++lineNo;});return clipPos(this,Pos(lineNo,ch));},indexFromPos:function(coords){coords=clipPos(this,coords);
var index=coords.ch;if(coords.line<this.first||coords.ch<0){return 0;}var sepSize=this.lineSeparator().length;
this.iter(this.first,coords.line,function(line){index+=line.text.length+sepSize;});return index;},copy:function(copyHistory){var doc=new Doc(getLines(this,this.first,this.first+this.size),this.modeOption,this.first,this.lineSep);
doc.scrollTop=this.scrollTop;doc.scrollLeft=this.scrollLeft;doc.sel=this.sel;doc.extend=false;if(copyHistory){doc.history.undoDepth=this.history.undoDepth;
doc.setHistory(this.getHistory());}return doc;},linkedDoc:function(options){if(!options){options={};}var from=this.first,to=this.first+this.size;
if(options.from!=null&&options.from>from){from=options.from;}if(options.to!=null&&options.to<to){to=options.to;
}var copy=new Doc(getLines(this,from,to),options.mode||this.modeOption,from,this.lineSep);if(options.sharedHist){copy.history=this.history;
}(this.linked||(this.linked=[])).push({doc:copy,sharedHist:options.sharedHist});copy.linked=[{doc:this,isParent:true,sharedHist:options.sharedHist}];
copySharedMarkers(copy,findSharedMarkers(this));return copy;},unlinkDoc:function(other){if(other instanceof CodeMirror){other=other.doc;
}if(this.linked){for(var i=0;i<this.linked.length;++i){var link=this.linked[i];if(link.doc!=other){continue;
}this.linked.splice(i,1);other.unlinkDoc(this);detachSharedMarkers(findSharedMarkers(this));break;}}if(other.history==this.history){var splitIds=[other.id];
linkedDocs(other,function(doc){splitIds.push(doc.id);},true);other.history=new History(null);other.history.done=copyHistoryArray(this.history.done,splitIds);
other.history.undone=copyHistoryArray(this.history.undone,splitIds);}},iterLinkedDocs:function(f){linkedDocs(this,f);
},getMode:function(){return this.mode;},getEditor:function(){return this.cm;},splitLines:function(str){if(this.lineSep){return str.split(this.lineSep);
}return splitLinesAuto(str);},lineSeparator:function(){return this.lineSep||"\n";}});Doc.prototype.eachLine=Doc.prototype.iter;
var dontDelegate="iter insert remove copy getEditor constructor".split(" ");for(var prop in Doc.prototype){if(Doc.prototype.hasOwnProperty(prop)&&indexOf(dontDelegate,prop)<0){CodeMirror.prototype[prop]=(function(method){return function(){return method.apply(this.doc,arguments);
};})(Doc.prototype[prop]);}}eventMixin(Doc);function linkedDocs(doc,f,sharedHistOnly){function propagate(doc,skip,sharedHist){if(doc.linked){for(var i=0;
i<doc.linked.length;++i){var rel=doc.linked[i];if(rel.doc==skip){continue;}var shared=sharedHist&&rel.sharedHist;
if(sharedHistOnly&&!shared){continue;}f(rel.doc,shared);propagate(rel.doc,doc,shared);}}}propagate(doc,null,true);
}function attachDoc(cm,doc){if(doc.cm){throw new Error("This document is already in use.");}cm.doc=doc;
doc.cm=cm;estimateLineHeights(cm);loadMode(cm);if(!cm.options.lineWrapping){findMaxLine(cm);}cm.options.mode=doc.modeOption;
regChange(cm);}function getLine(doc,n){n-=doc.first;if(n<0||n>=doc.size){throw new Error("There is no line "+(n+doc.first)+" in the document.");
}for(var chunk=doc;!chunk.lines;){for(var i=0;;++i){var child=chunk.children[i],sz=child.chunkSize();
if(n<sz){chunk=child;break;}n-=sz;}}return chunk.lines[n];}function getBetween(doc,start,end){var out=[],n=start.line;
doc.iter(start.line,end.line+1,function(line){var text=line.text;if(n==end.line){text=text.slice(0,end.ch);
}if(n==start.line){text=text.slice(start.ch);}out.push(text);++n;});return out;}function getLines(doc,from,to){var out=[];
doc.iter(from,to,function(line){out.push(line.text);});return out;}function updateLineHeight(line,height){var diff=height-line.height;
if(diff){for(var n=line;n;n=n.parent){n.height+=diff;}}}function lineNo(line){if(line.parent==null){return null;
}var cur=line.parent,no=indexOf(cur.lines,line);for(var chunk=cur.parent;chunk;cur=chunk,chunk=chunk.parent){for(var i=0;
;++i){if(chunk.children[i]==cur){break;}no+=chunk.children[i].chunkSize();}}return no+cur.first;}function lineAtHeight(chunk,h){var n=chunk.first;
outer:do{for(var i=0;i<chunk.children.length;++i){var child=chunk.children[i],ch=child.height;if(h<ch){chunk=child;
continue outer;}h-=ch;n+=child.chunkSize();}return n;}while(!chunk.lines);for(var i=0;i<chunk.lines.length;
++i){var line=chunk.lines[i],lh=line.height;if(h<lh){break;}h-=lh;}return n+i;}function heightAtLine(lineObj){lineObj=visualLine(lineObj);
var h=0,chunk=lineObj.parent;for(var i=0;i<chunk.lines.length;++i){var line=chunk.lines[i];if(line==lineObj){break;
}else{h+=line.height;}}for(var p=chunk.parent;p;chunk=p,p=chunk.parent){for(var i=0;i<p.children.length;
++i){var cur=p.children[i];if(cur==chunk){break;}else{h+=cur.height;}}}return h;}function getOrder(line){var order=line.order;
if(order==null){order=line.order=bidiOrdering(line.text);}return order;}function History(startGen){this.done=[];
this.undone=[];this.undoDepth=Infinity;this.lastModTime=this.lastSelTime=0;this.lastOp=this.lastSelOp=null;
this.lastOrigin=this.lastSelOrigin=null;this.generation=this.maxGeneration=startGen||1;}function historyChangeFromChange(doc,change){var histChange={from:copyPos(change.from),to:changeEnd(change),text:getBetween(doc,change.from,change.to)};
attachLocalSpans(doc,histChange,change.from.line,change.to.line+1);linkedDocs(doc,function(doc){attachLocalSpans(doc,histChange,change.from.line,change.to.line+1);
},true);return histChange;}function clearSelectionEvents(array){while(array.length){var last=lst(array);
if(last.ranges){array.pop();}else{break;}}}function lastChangeEvent(hist,force){if(force){clearSelectionEvents(hist.done);
return lst(hist.done);}else{if(hist.done.length&&!lst(hist.done).ranges){return lst(hist.done);}else{if(hist.done.length>1&&!hist.done[hist.done.length-2].ranges){hist.done.pop();
return lst(hist.done);}}}}function addChangeToHistory(doc,change,selAfter,opId){var hist=doc.history;
hist.undone.length=0;var time=+new Date,cur;if((hist.lastOp==opId||hist.lastOrigin==change.origin&&change.origin&&((change.origin.charAt(0)=="+"&&doc.cm&&hist.lastModTime>time-doc.cm.options.historyEventDelay)||change.origin.charAt(0)=="*"))&&(cur=lastChangeEvent(hist,hist.lastOp==opId))){var last=lst(cur.changes);
if(cmp(change.from,change.to)==0&&cmp(change.from,last.to)==0){last.to=changeEnd(change);}else{cur.changes.push(historyChangeFromChange(doc,change));
}}else{var before=lst(hist.done);if(!before||!before.ranges){pushSelectionToHistory(doc.sel,hist.done);
}cur={changes:[historyChangeFromChange(doc,change)],generation:hist.generation};hist.done.push(cur);while(hist.done.length>hist.undoDepth){hist.done.shift();
if(!hist.done[0].ranges){hist.done.shift();}}}hist.done.push(selAfter);hist.generation=++hist.maxGeneration;
hist.lastModTime=hist.lastSelTime=time;hist.lastOp=hist.lastSelOp=opId;hist.lastOrigin=hist.lastSelOrigin=change.origin;
if(!last){signal(doc,"historyAdded");}}function selectionEventCanBeMerged(doc,origin,prev,sel){var ch=origin.charAt(0);
return ch=="*"||ch=="+"&&prev.ranges.length==sel.ranges.length&&prev.somethingSelected()==sel.somethingSelected()&&new Date-doc.history.lastSelTime<=(doc.cm?doc.cm.options.historyEventDelay:500);
}function addSelectionToHistory(doc,sel,opId,options){var hist=doc.history,origin=options&&options.origin;
if(opId==hist.lastSelOp||(origin&&hist.lastSelOrigin==origin&&(hist.lastModTime==hist.lastSelTime&&hist.lastOrigin==origin||selectionEventCanBeMerged(doc,origin,lst(hist.done),sel)))){hist.done[hist.done.length-1]=sel;
}else{pushSelectionToHistory(sel,hist.done);}hist.lastSelTime=+new Date;hist.lastSelOrigin=origin;hist.lastSelOp=opId;
if(options&&options.clearRedo!==false){clearSelectionEvents(hist.undone);}}function pushSelectionToHistory(sel,dest){var top=lst(dest);
if(!(top&&top.ranges&&top.equals(sel))){dest.push(sel);}}function attachLocalSpans(doc,change,from,to){var existing=change["spans_"+doc.id],n=0;
doc.iter(Math.max(doc.first,from),Math.min(doc.first+doc.size,to),function(line){if(line.markedSpans){(existing||(existing=change["spans_"+doc.id]={}))[n]=line.markedSpans;
}++n;});}function removeClearedSpans(spans){if(!spans){return null;}for(var i=0,out;i<spans.length;++i){if(spans[i].marker.explicitlyCleared){if(!out){out=spans.slice(0,i);
}}else{if(out){out.push(spans[i]);}}}return !out?spans:out.length?out:null;}function getOldSpans(doc,change){var found=change["spans_"+doc.id];
if(!found){return null;}for(var i=0,nw=[];i<change.text.length;++i){nw.push(removeClearedSpans(found[i]));
}return nw;}function copyHistoryArray(events,newGroup,instantiateSel){for(var i=0,copy=[];i<events.length;
++i){var event=events[i];if(event.ranges){copy.push(instantiateSel?Selection.prototype.deepCopy.call(event):event);
continue;}var changes=event.changes,newChanges=[];copy.push({changes:newChanges});for(var j=0;j<changes.length;
++j){var change=changes[j],m;newChanges.push({from:change.from,to:change.to,text:change.text});if(newGroup){for(var prop in change){if(m=prop.match(/^spans_(\d+)$/)){if(indexOf(newGroup,Number(m[1]))>-1){lst(newChanges)[prop]=change[prop];
delete change[prop];}}}}}}return copy;}function rebaseHistSelSingle(pos,from,to,diff){if(to<pos.line){pos.line+=diff;
}else{if(from<pos.line){pos.line=from;pos.ch=0;}}}function rebaseHistArray(array,from,to,diff){for(var i=0;
i<array.length;++i){var sub=array[i],ok=true;if(sub.ranges){if(!sub.copied){sub=array[i]=sub.deepCopy();
sub.copied=true;}for(var j=0;j<sub.ranges.length;j++){rebaseHistSelSingle(sub.ranges[j].anchor,from,to,diff);
rebaseHistSelSingle(sub.ranges[j].head,from,to,diff);}continue;}for(var j=0;j<sub.changes.length;++j){var cur=sub.changes[j];
if(to<cur.from.line){cur.from=Pos(cur.from.line+diff,cur.from.ch);cur.to=Pos(cur.to.line+diff,cur.to.ch);
}else{if(from<=cur.to.line){ok=false;break;}}}if(!ok){array.splice(0,i+1);i=0;}}}function rebaseHist(hist,change){var from=change.from.line,to=change.to.line,diff=change.text.length-(to-from)-1;
rebaseHistArray(hist.done,from,to,diff);rebaseHistArray(hist.undone,from,to,diff);}var e_preventDefault=CodeMirror.e_preventDefault=function(e){if(e.preventDefault){e.preventDefault();
}else{e.returnValue=false;}};var e_stopPropagation=CodeMirror.e_stopPropagation=function(e){if(e.stopPropagation){e.stopPropagation();
}else{e.cancelBubble=true;}};function e_defaultPrevented(e){return e.defaultPrevented!=null?e.defaultPrevented:e.returnValue==false;
}var e_stop=CodeMirror.e_stop=function(e){e_preventDefault(e);e_stopPropagation(e);};function e_target(e){return e.target||e.srcElement;
}function e_button(e){var b=e.which;if(b==null){if(e.button&1){b=1;}else{if(e.button&2){b=3;}else{if(e.button&4){b=2;
}}}}if(mac&&e.ctrlKey&&b==1){b=3;}return b;}var on=CodeMirror.on=function(emitter,type,f){if(emitter.addEventListener){emitter.addEventListener(type,f,false);
}else{if(emitter.attachEvent){emitter.attachEvent("on"+type,f);}else{var map=emitter._handlers||(emitter._handlers={});
var arr=map[type]||(map[type]=[]);arr.push(f);}}};var noHandlers=[];function getHandlers(emitter,type,copy){var arr=emitter._handlers&&emitter._handlers[type];
if(copy){return arr&&arr.length>0?arr.slice():noHandlers;}else{return arr||noHandlers;}}var off=CodeMirror.off=function(emitter,type,f){if(emitter.removeEventListener){emitter.removeEventListener(type,f,false);
}else{if(emitter.detachEvent){emitter.detachEvent("on"+type,f);}else{var handlers=getHandlers(emitter,type,false);
for(var i=0;i<handlers.length;++i){if(handlers[i]==f){handlers.splice(i,1);break;}}}}};var signal=CodeMirror.signal=function(emitter,type){var handlers=getHandlers(emitter,type,true);
if(!handlers.length){return;}var args=Array.prototype.slice.call(arguments,2);for(var i=0;i<handlers.length;
++i){handlers[i].apply(null,args);}};var orphanDelayedCallbacks=null;function signalLater(emitter,type){var arr=getHandlers(emitter,type,false);
if(!arr.length){return;}var args=Array.prototype.slice.call(arguments,2),list;if(operationGroup){list=operationGroup.delayedCallbacks;
}else{if(orphanDelayedCallbacks){list=orphanDelayedCallbacks;}else{list=orphanDelayedCallbacks=[];setTimeout(fireOrphanDelayed,0);
}}function bnd(f){return function(){f.apply(null,args);};}for(var i=0;i<arr.length;++i){list.push(bnd(arr[i]));
}}function fireOrphanDelayed(){var delayed=orphanDelayedCallbacks;orphanDelayedCallbacks=null;for(var i=0;
i<delayed.length;++i){delayed[i]();}}function signalDOMEvent(cm,e,override){if(typeof e=="string"){e={type:e,preventDefault:function(){this.defaultPrevented=true;
}};}signal(cm,override||e.type,cm,e);return e_defaultPrevented(e)||e.codemirrorIgnore;}function signalCursorActivity(cm){var arr=cm._handlers&&cm._handlers.cursorActivity;
if(!arr){return;}var set=cm.curOp.cursorActivityHandlers||(cm.curOp.cursorActivityHandlers=[]);for(var i=0;
i<arr.length;++i){if(indexOf(set,arr[i])==-1){set.push(arr[i]);}}}function hasHandler(emitter,type){return getHandlers(emitter,type).length>0;
}function eventMixin(ctor){ctor.prototype.on=function(type,f){on(this,type,f);};ctor.prototype.off=function(type,f){off(this,type,f);
};}var scrollerGap=30;var Pass=CodeMirror.Pass={toString:function(){return"CodeMirror.Pass";}};var sel_dontScroll={scroll:false},sel_mouse={origin:"*mouse"},sel_move={origin:"+move"};
function Delayed(){this.id=null;}Delayed.prototype.set=function(ms,f){clearTimeout(this.id);this.id=setTimeout(f,ms);
};var countColumn=CodeMirror.countColumn=function(string,end,tabSize,startIndex,startValue){if(end==null){end=string.search(/[^\s\u00a0]/);
if(end==-1){end=string.length;}}for(var i=startIndex||0,n=startValue||0;;){var nextTab=string.indexOf("\t",i);
if(nextTab<0||nextTab>=end){return n+(end-i);}n+=nextTab-i;n+=tabSize-(n%tabSize);i=nextTab+1;}};var findColumn=CodeMirror.findColumn=function(string,goal,tabSize){for(var pos=0,col=0;
;){var nextTab=string.indexOf("\t",pos);if(nextTab==-1){nextTab=string.length;}var skipped=nextTab-pos;
if(nextTab==string.length||col+skipped>=goal){return pos+Math.min(skipped,goal-col);}col+=nextTab-pos;
col+=tabSize-(col%tabSize);pos=nextTab+1;if(col>=goal){return pos;}}};var spaceStrs=[""];function spaceStr(n){while(spaceStrs.length<=n){spaceStrs.push(lst(spaceStrs)+" ");
}return spaceStrs[n];}function lst(arr){return arr[arr.length-1];}var selectInput=function(node){node.select();
};if(ios){selectInput=function(node){node.selectionStart=0;node.selectionEnd=node.value.length;};}else{if(ie){selectInput=function(node){try{node.select();
}catch(_e){}};}}function indexOf(array,elt){for(var i=0;i<array.length;++i){if(array[i]==elt){return i;
}}return -1;}function map(array,f){var out=[];for(var i=0;i<array.length;i++){out[i]=f(array[i],i);}return out;
}function insertSorted(array,value,score){var pos=0,priority=score(value);while(pos<array.length&&score(array[pos])<=priority){pos++;
}array.splice(pos,0,value);}function nothing(){}function createObj(base,props){var inst;if(Object.create){inst=Object.create(base);
}else{nothing.prototype=base;inst=new nothing();}if(props){copyObj(props,inst);}return inst;}function copyObj(obj,target,overwrite){if(!target){target={};
}for(var prop in obj){if(obj.hasOwnProperty(prop)&&(overwrite!==false||!target.hasOwnProperty(prop))){target[prop]=obj[prop];
}}return target;}function bind(f){var args=Array.prototype.slice.call(arguments,1);return function(){return f.apply(null,args);
};}var nonASCIISingleCaseWordChar=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/;
var isWordCharBasic=CodeMirror.isWordChar=function(ch){return/\w/.test(ch)||ch>"\x80"&&(ch.toUpperCase()!=ch.toLowerCase()||nonASCIISingleCaseWordChar.test(ch));
};function isWordChar(ch,helper){if(!helper){return isWordCharBasic(ch);}if(helper.source.indexOf("\\w")>-1&&isWordCharBasic(ch)){return true;
}return helper.test(ch);}function isEmpty(obj){for(var n in obj){if(obj.hasOwnProperty(n)&&obj[n]){return false;
}}return true;}var extendingChars=/[\u0300-\u036f\u0483-\u0489\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u0610-\u061a\u064b-\u065e\u0670\u06d6-\u06dc\u06de-\u06e4\u06e7\u06e8\u06ea-\u06ed\u0711\u0730-\u074a\u07a6-\u07b0\u07eb-\u07f3\u0816-\u0819\u081b-\u0823\u0825-\u0827\u0829-\u082d\u0900-\u0902\u093c\u0941-\u0948\u094d\u0951-\u0955\u0962\u0963\u0981\u09bc\u09be\u09c1-\u09c4\u09cd\u09d7\u09e2\u09e3\u0a01\u0a02\u0a3c\u0a41\u0a42\u0a47\u0a48\u0a4b-\u0a4d\u0a51\u0a70\u0a71\u0a75\u0a81\u0a82\u0abc\u0ac1-\u0ac5\u0ac7\u0ac8\u0acd\u0ae2\u0ae3\u0b01\u0b3c\u0b3e\u0b3f\u0b41-\u0b44\u0b4d\u0b56\u0b57\u0b62\u0b63\u0b82\u0bbe\u0bc0\u0bcd\u0bd7\u0c3e-\u0c40\u0c46-\u0c48\u0c4a-\u0c4d\u0c55\u0c56\u0c62\u0c63\u0cbc\u0cbf\u0cc2\u0cc6\u0ccc\u0ccd\u0cd5\u0cd6\u0ce2\u0ce3\u0d3e\u0d41-\u0d44\u0d4d\u0d57\u0d62\u0d63\u0dca\u0dcf\u0dd2-\u0dd4\u0dd6\u0ddf\u0e31\u0e34-\u0e3a\u0e47-\u0e4e\u0eb1\u0eb4-\u0eb9\u0ebb\u0ebc\u0ec8-\u0ecd\u0f18\u0f19\u0f35\u0f37\u0f39\u0f71-\u0f7e\u0f80-\u0f84\u0f86\u0f87\u0f90-\u0f97\u0f99-\u0fbc\u0fc6\u102d-\u1030\u1032-\u1037\u1039\u103a\u103d\u103e\u1058\u1059\u105e-\u1060\u1071-\u1074\u1082\u1085\u1086\u108d\u109d\u135f\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17b7-\u17bd\u17c6\u17c9-\u17d3\u17dd\u180b-\u180d\u18a9\u1920-\u1922\u1927\u1928\u1932\u1939-\u193b\u1a17\u1a18\u1a56\u1a58-\u1a5e\u1a60\u1a62\u1a65-\u1a6c\u1a73-\u1a7c\u1a7f\u1b00-\u1b03\u1b34\u1b36-\u1b3a\u1b3c\u1b42\u1b6b-\u1b73\u1b80\u1b81\u1ba2-\u1ba5\u1ba8\u1ba9\u1c2c-\u1c33\u1c36\u1c37\u1cd0-\u1cd2\u1cd4-\u1ce0\u1ce2-\u1ce8\u1ced\u1dc0-\u1de6\u1dfd-\u1dff\u200c\u200d\u20d0-\u20f0\u2cef-\u2cf1\u2de0-\u2dff\u302a-\u302f\u3099\u309a\ua66f-\ua672\ua67c\ua67d\ua6f0\ua6f1\ua802\ua806\ua80b\ua825\ua826\ua8c4\ua8e0-\ua8f1\ua926-\ua92d\ua947-\ua951\ua980-\ua982\ua9b3\ua9b6-\ua9b9\ua9bc\uaa29-\uaa2e\uaa31\uaa32\uaa35\uaa36\uaa43\uaa4c\uaab0\uaab2-\uaab4\uaab7\uaab8\uaabe\uaabf\uaac1\uabe5\uabe8\uabed\udc00-\udfff\ufb1e\ufe00-\ufe0f\ufe20-\ufe26\uff9e\uff9f]/;
function isExtendingChar(ch){return ch.charCodeAt(0)>=768&&extendingChars.test(ch);}function elt(tag,content,className,style){var e=document.createElement(tag);
if(className){e.className=className;}if(style){e.style.cssText=style;}if(typeof content=="string"){e.appendChild(document.createTextNode(content));
}else{if(content){for(var i=0;i<content.length;++i){e.appendChild(content[i]);}}}return e;}var range;
if(document.createRange){range=function(node,start,end,endNode){var r=document.createRange();r.setEnd(endNode||node,end);
r.setStart(node,start);return r;};}else{range=function(node,start,end){var r=document.body.createTextRange();
try{r.moveToElementText(node.parentNode);}catch(e){return r;}r.collapse(true);r.moveEnd("character",end);
r.moveStart("character",start);return r;};}function removeChildren(e){for(var count=e.childNodes.length;
count>0;--count){e.removeChild(e.firstChild);}return e;}function removeChildrenAndAdd(parent,e){return removeChildren(parent).appendChild(e);
}var contains=CodeMirror.contains=function(parent,child){if(child.nodeType==3){child=child.parentNode;
}if(parent.contains){return parent.contains(child);}do{if(child.nodeType==11){child=child.host;}if(child==parent){return true;
}}while(child=child.parentNode);};function activeElt(){var activeElement=document.activeElement;while(activeElement&&activeElement.root&&activeElement.root.activeElement){activeElement=activeElement.root.activeElement;
}return activeElement;}if(ie&&ie_version<11){activeElt=function(){try{return document.activeElement;}catch(e){return document.body;
}};}function classTest(cls){return new RegExp("(^|\\s)"+cls+"(?:$|\\s)\\s*");}var rmClass=CodeMirror.rmClass=function(node,cls){var current=node.className;
var match=classTest(cls).exec(current);if(match){var after=current.slice(match.index+match[0].length);
node.className=current.slice(0,match.index)+(after?match[1]+after:"");}};var addClass=CodeMirror.addClass=function(node,cls){var current=node.className;
if(!classTest(cls).test(current)){node.className+=(current?" ":"")+cls;}};function joinClasses(a,b){var as=a.split(" ");
for(var i=0;i<as.length;i++){if(as[i]&&!classTest(as[i]).test(b)){b+=" "+as[i];}}return b;}function forEachCodeMirror(f){if(!document.body.getElementsByClassName){return;
}var byClass=document.body.getElementsByClassName("CodeMirror");for(var i=0;i<byClass.length;i++){var cm=byClass[i].CodeMirror;
if(cm){f(cm);}}}var globalsRegistered=false;function ensureGlobalHandlers(){if(globalsRegistered){return;
}registerGlobalHandlers();globalsRegistered=true;}function registerGlobalHandlers(){var resizeTimer;on(window,"resize",function(){if(resizeTimer==null){resizeTimer=setTimeout(function(){resizeTimer=null;
forEachCodeMirror(onResize);},100);}});on(window,"blur",function(){forEachCodeMirror(onBlur);});}var dragAndDrop=function(){if(ie&&ie_version<9){return false;
}var div=elt("div");return"draggable" in div||"dragDrop" in div;}();var zwspSupported;function zeroWidthElement(measure){if(zwspSupported==null){var test=elt("span","\u200b");
removeChildrenAndAdd(measure,elt("span",[test,document.createTextNode("x")]));if(measure.firstChild.offsetHeight!=0){zwspSupported=test.offsetWidth<=1&&test.offsetHeight>2&&!(ie&&ie_version<8);
}}var node=zwspSupported?elt("span","\u200b"):elt("span","\u00a0",null,"display: inline-block; width: 1px; margin-right: -1px");
node.setAttribute("cm-text","");return node;}var badBidiRects;function hasBadBidiRects(measure){if(badBidiRects!=null){return badBidiRects;
}var txt=removeChildrenAndAdd(measure,document.createTextNode("A\u062eA"));var r0=range(txt,0,1).getBoundingClientRect();
var r1=range(txt,1,2).getBoundingClientRect();removeChildren(measure);if(!r0||r0.left==r0.right){return false;
}return badBidiRects=(r1.right-r0.right<3);}var splitLinesAuto=CodeMirror.splitLines="\n\nb".split(/\n/).length!=3?function(string){var pos=0,result=[],l=string.length;
while(pos<=l){var nl=string.indexOf("\n",pos);if(nl==-1){nl=string.length;}var line=string.slice(pos,string.charAt(nl-1)=="\r"?nl-1:nl);
var rt=line.indexOf("\r");if(rt!=-1){result.push(line.slice(0,rt));pos+=rt+1;}else{result.push(line);
pos=nl+1;}}return result;}:function(string){return string.split(/\r\n?|\n/);};var hasSelection=window.getSelection?function(te){try{return te.selectionStart!=te.selectionEnd;
}catch(e){return false;}}:function(te){try{var range=te.ownerDocument.selection.createRange();}catch(e){}if(!range||range.parentElement()!=te){return false;
}return range.compareEndPoints("StartToEnd",range)!=0;};var hasCopyEvent=(function(){var e=elt("div");
if("oncopy" in e){return true;}e.setAttribute("oncopy","return;");return typeof e.oncopy=="function";
})();var badZoomedRects=null;function hasBadZoomedRects(measure){if(badZoomedRects!=null){return badZoomedRects;
}var node=removeChildrenAndAdd(measure,elt("span","x"));var normal=node.getBoundingClientRect();var fromRange=range(node,0,1).getBoundingClientRect();
return badZoomedRects=Math.abs(normal.left-fromRange.left)>1;}var keyNames=CodeMirror.keyNames={3:"Enter",8:"Backspace",9:"Tab",13:"Enter",16:"Shift",17:"Ctrl",18:"Alt",19:"Pause",20:"CapsLock",27:"Esc",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",44:"PrintScrn",45:"Insert",46:"Delete",59:";",61:"=",91:"Mod",92:"Mod",93:"Mod",106:"*",107:"=",109:"-",110:".",111:"/",127:"Delete",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",63232:"Up",63233:"Down",63234:"Left",63235:"Right",63272:"Delete",63273:"Home",63275:"End",63276:"PageUp",63277:"PageDown",63302:"Insert"};
(function(){for(var i=0;i<10;i++){keyNames[i+48]=keyNames[i+96]=String(i);}for(var i=65;i<=90;i++){keyNames[i]=String.fromCharCode(i);
}for(var i=1;i<=12;i++){keyNames[i+111]=keyNames[i+63235]="F"+i;}})();function iterateBidiSections(order,from,to,f){if(!order){return f(from,to,"ltr");
}var found=false;for(var i=0;i<order.length;++i){var part=order[i];if(part.from<to&&part.to>from||from==to&&part.to==from){f(Math.max(part.from,from),Math.min(part.to,to),part.level==1?"rtl":"ltr");
found=true;}}if(!found){f(from,to,"ltr");}}function bidiLeft(part){return part.level%2?part.to:part.from;
}function bidiRight(part){return part.level%2?part.from:part.to;}function lineLeft(line){var order=getOrder(line);
return order?bidiLeft(order[0]):0;}function lineRight(line){var order=getOrder(line);if(!order){return line.text.length;
}return bidiRight(lst(order));}function lineStart(cm,lineN){var line=getLine(cm.doc,lineN);var visual=visualLine(line);
if(visual!=line){lineN=lineNo(visual);}var order=getOrder(visual);var ch=!order?0:order[0].level%2?lineRight(visual):lineLeft(visual);
return Pos(lineN,ch);}function lineEnd(cm,lineN){var merged,line=getLine(cm.doc,lineN);while(merged=collapsedSpanAtEnd(line)){line=merged.find(1,true).line;
lineN=null;}var order=getOrder(line);var ch=!order?line.text.length:order[0].level%2?lineLeft(line):lineRight(line);
return Pos(lineN==null?lineNo(line):lineN,ch);}function lineStartSmart(cm,pos){var start=lineStart(cm,pos.line);
var line=getLine(cm.doc,start.line);var order=getOrder(line);if(!order||order[0].level==0){var firstNonWS=Math.max(0,line.text.search(/\S/));
var inWS=pos.line==start.line&&pos.ch<=firstNonWS&&pos.ch;return Pos(start.line,inWS?0:firstNonWS);}return start;
}function compareBidiLevel(order,a,b){var linedir=order[0].level;if(a==linedir){return true;}if(b==linedir){return false;
}return a<b;}var bidiOther;function getBidiPartAt(order,pos){bidiOther=null;for(var i=0,found;i<order.length;
++i){var cur=order[i];if(cur.from<pos&&cur.to>pos){return i;}if((cur.from==pos||cur.to==pos)){if(found==null){found=i;
}else{if(compareBidiLevel(order,cur.level,order[found].level)){if(cur.from!=cur.to){bidiOther=found;}return i;
}else{if(cur.from!=cur.to){bidiOther=i;}return found;}}}}return found;}function moveInLine(line,pos,dir,byUnit){if(!byUnit){return pos+dir;
}do{pos+=dir;}while(pos>0&&isExtendingChar(line.text.charAt(pos)));return pos;}function moveVisually(line,start,dir,byUnit){var bidi=getOrder(line);
if(!bidi){return moveLogically(line,start,dir,byUnit);}var pos=getBidiPartAt(bidi,start),part=bidi[pos];
var target=moveInLine(line,start,part.level%2?-dir:dir,byUnit);for(;;){if(target>part.from&&target<part.to){return target;
}if(target==part.from||target==part.to){if(getBidiPartAt(bidi,target)==pos){return target;}part=bidi[pos+=dir];
return(dir>0)==part.level%2?part.to:part.from;}else{part=bidi[pos+=dir];if(!part){return null;}if((dir>0)==part.level%2){target=moveInLine(line,part.to,-1,byUnit);
}else{target=moveInLine(line,part.from,1,byUnit);}}}}function moveLogically(line,start,dir,byUnit){var target=start+dir;
if(byUnit){while(target>0&&isExtendingChar(line.text.charAt(target))){target+=dir;}}return target<0||target>line.text.length?null:target;
}var bidiOrdering=(function(){var lowTypes="bbbbbbbbbtstwsbbbbbbbbbbbbbbssstwNN%%%NNNNNN,N,N1111111111NNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNbbbbbbsbbbbbbbbbbbbbbbbbbbbbbbbbb,N%%%%NNNNLNNNNN%%11NLNNN1LNNNNNLLLLLLLLLLLLLLLLLLLLLLLNLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLN";
var arabicTypes="rrrrrrrrrrrr,rNNmmmmmmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmrrrrrrrnnnnnnnnnn%nnrrrmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmmmmmmNmmmm";
function charType(code){if(code<=247){return lowTypes.charAt(code);}else{if(1424<=code&&code<=1524){return"R";
}else{if(1536<=code&&code<=1773){return arabicTypes.charAt(code-1536);}else{if(1774<=code&&code<=2220){return"r";
}else{if(8192<=code&&code<=8203){return"w";}else{if(code==8204){return"b";}else{return"L";}}}}}}}var bidiRE=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;
var isNeutral=/[stwN]/,isStrong=/[LRr]/,countsAsLeft=/[Lb1n]/,countsAsNum=/[1n]/;var outerType="L";function BidiSpan(level,from,to){this.level=level;
this.from=from;this.to=to;}return function(str){if(!bidiRE.test(str)){return false;}var len=str.length,types=[];
for(var i=0,type;i<len;++i){types.push(type=charType(str.charCodeAt(i)));}for(var i=0,prev=outerType;
i<len;++i){var type=types[i];if(type=="m"){types[i]=prev;}else{prev=type;}}for(var i=0,cur=outerType;
i<len;++i){var type=types[i];if(type=="1"&&cur=="r"){types[i]="n";}else{if(isStrong.test(type)){cur=type;
if(type=="r"){types[i]="R";}}}}for(var i=1,prev=types[0];i<len-1;++i){var type=types[i];if(type=="+"&&prev=="1"&&types[i+1]=="1"){types[i]="1";
}else{if(type==","&&prev==types[i+1]&&(prev=="1"||prev=="n")){types[i]=prev;}}prev=type;}for(var i=0;
i<len;++i){var type=types[i];if(type==","){types[i]="N";}else{if(type=="%"){for(var end=i+1;end<len&&types[end]=="%";
++end){}var replace=(i&&types[i-1]=="!")||(end<len&&types[end]=="1")?"1":"N";for(var j=i;j<end;++j){types[j]=replace;
}i=end-1;}}}for(var i=0,cur=outerType;i<len;++i){var type=types[i];if(cur=="L"&&type=="1"){types[i]="L";
}else{if(isStrong.test(type)){cur=type;}}}for(var i=0;i<len;++i){if(isNeutral.test(types[i])){for(var end=i+1;
end<len&&isNeutral.test(types[end]);++end){}var before=(i?types[i-1]:outerType)=="L";var after=(end<len?types[end]:outerType)=="L";
var replace=before||after?"L":"R";for(var j=i;j<end;++j){types[j]=replace;}i=end-1;}}var order=[],m;for(var i=0;
i<len;){if(countsAsLeft.test(types[i])){var start=i;for(++i;i<len&&countsAsLeft.test(types[i]);++i){}order.push(new BidiSpan(0,start,i));
}else{var pos=i,at=order.length;for(++i;i<len&&types[i]!="L";++i){}for(var j=pos;j<i;){if(countsAsNum.test(types[j])){if(pos<j){order.splice(at,0,new BidiSpan(1,pos,j));
}var nstart=j;for(++j;j<i&&countsAsNum.test(types[j]);++j){}order.splice(at,0,new BidiSpan(2,nstart,j));
pos=j;}else{++j;}}if(pos<i){order.splice(at,0,new BidiSpan(1,pos,i));}}}if(order[0].level==1&&(m=str.match(/^\s+/))){order[0].from=m[0].length;
order.unshift(new BidiSpan(0,0,m[0].length));}if(lst(order).level==1&&(m=str.match(/\s+$/))){lst(order).to-=m[0].length;
order.push(new BidiSpan(0,len-m[0].length,len));}if(order[0].level==2){order.unshift(new BidiSpan(1,order[0].to,order[0].to));
}if(order[0].level!=lst(order).level){order.push(new BidiSpan(order[0].level,len,len));}return order;
};})();CodeMirror.version="5.18.2";return CodeMirror;});$(function(){function AddRowsPromptControl(newHandlers){var settings;
var style;var handlers=newHandlers;var accordionMatchSection;var accordionIncludeAdditionalSection;var accordionOriginSection;
var $previewTableContainer;var $matchListContainer;var $matchLabelContainer;var matchListbox;var $includeAdditionalColumnsListContainer;
var includeAdditionalColumnsListbox;var availableListBox;var $includeAllButton;var $includeNoneButton;
var $originExistingColumnCombobox;var lastRequestedPreviewKey;var previewId;var initialized=false;var createButton=function(text,clickHandler,$container){var $button=$("<div/>").css("padding","6px 10px 5px 10px").css("font-size","12px").addClass("sfpc-secondary").appendTo($container);
var onClick=function(){if(!$(this).hasClass("disabled")){clickHandler();}};Spotfire.Controls.PanelButton.initialize($button,text,undefined,onClick,false,text);
return $button;};var createColumnListItemPart=function(hasButton,references){var $part=Spotfire.Flex.item({container:"horizontal","align-items":"stretch"});
var $content=Spotfire.Flex.item({container:"vertical","justify-content":"center",grow:true}).addClass("sf-addrows-column-list-item-part").appendTo($part);
if(hasButton){var $rightButton=Spotfire.Flex.item({container:"vertical","justify-content":"center","align-items":"center",shrink:false}).addClass("sf-addrows-remove-and-error-button-container").appendTo($part);
var $iconDiv=$("<div/>").addClass("sf-addrows-remove-and-error-button sf-clickable").appendTo($rightButton);
references.removeAndErrorButton=$iconDiv;Spotfire.getSvg("Images/Data/ErrorExclamation14x14.svg",function($svg){$svg.attr("class","sf-addrows-error-icon").appendTo($iconDiv);
});Spotfire.getSvg("Images/Data/ClearSearch.svg",function($svg){$svg.attr("class","sf-addrows-remove-icon").css("fill",style.removeIconColor).hover(function(){$(this).css("fill",style.removeIconHoverColor);
},function(){$(this).css("fill",style.removeIconColor);}).appendTo($iconDiv);$iconDiv.attr("title",Spotfire.Localization.resources.AddRowsRemoveMatchTooltip);
});}var $nameAndType=Spotfire.Flex.item({container:"horizontal"}).css("width","100%").appendTo($content);
var $name=Spotfire.Flex.item().addClass("sf-addrows-column-list-item-part-name").appendTo($nameAndType);
references.name=$name;var $datatype=Spotfire.Flex.item({shrink:false}).addClass("sf-addrows-column-list-item-part-datatype").appendTo($nameAndType);
references.datatype=$datatype;var $distinct=Spotfire.Flex.item().addClass("sf-addrows-column-list-item-part-distinct").css("width","100%").appendTo($content);
references.distinct=$distinct;return $part;};var setColumnListItemPartInfo=function($columnPart,columnInfo,forceInvalid,references){var $name=references.name;
var $datatype=references.datatype;var $distinct=references.distinct;$name.text(columnInfo.name);$datatype.text("("+columnInfo.dataTypeName+")");
var tooltipText=columnInfo.name+" ("+columnInfo.dataTypeName+")";$name.attr("title",tooltipText);$datatype.attr("title",tooltipText);
if(columnInfo.sampleValues){var sampleValuesString=columnInfo.sampleValues.join(", ");$distinct.text(sampleValuesString);
$distinct.attr("title",sampleValuesString);}else{$distinct.text("");$distinct.attr("title","");}if(forceInvalid||columnInfo.invalid){$columnPart.addClass("sf-addrows-invalid-column");
}else{$columnPart.removeClass("sf-addrows-invalid-column");}};var createAddListItemPart=function(){var $part=Spotfire.Flex.item({container:"vertical","justify-content":"center","align-items":"center",shrink:false});
var $iconDiv=$("<div/>").addClass("sf-addrows-add-icon").css("fill",style.addIconColor).attr("title",Spotfire.Localization.resources.AddRowsAddMatchTooltip).appendTo($part);
Spotfire.getSvg("Images/Data/Plus.svg",function($svg){$svg.appendTo($iconDiv);});return $part;};var createListItemNoValue=function(){var $noValueContainer=Spotfire.Flex.item({container:"horizontal","align-items":"center"}).addClass("sf-addrows-list-item-no-value");
Spotfire.Flex.item({}).addClass("sf-addrows-column-list-item-part").text("...").appendTo($noValueContainer);
return $noValueContainer;};var getLocalListItems=function(allListItems,low,high,generation,callback){var items=[];
var len=allListItems.Items.length;var i;for(i=low;i<=high&&i<len;++i){items.push(allListItems.Items[i]);
}var result={TopIndex:low,Items:items,GetValuesGeneration:generation};callback(result);};var hide=function($selector){if(!$selector.hasClass("sf-addrows-hidden")){$selector.addClass("sf-addrows-hidden");
}};var show=function($selector){if($selector.hasClass("sf-addrows-hidden")){$selector.removeClass("sf-addrows-hidden");
}};var createColumnSelectPopout=function($button,matchItem){var $popoutContainer=Spotfire.Flex.item({container:"vertical","align-items":"stretch",shrink:false}).addClass("sf-addrows-popout").css("width",300);
var $listContainer;var insertSelectColumnContainer=function(addCorrectMatchHeader){var $selectColumnContainer=Spotfire.Flex.item({container:"vertical",grow:true,"align-items":"stretch"}).addClass("sf-addrows-popout-part").appendTo($popoutContainer);
if(addCorrectMatchHeader){Spotfire.Flex.item({grow:true}).addClass("sf-addrows-correct-match-text").text(Spotfire.Localization.resources.AddRowsCorrectMatch).appendTo($selectColumnContainer);
}$listContainer=Spotfire.Flex.item({grow:true}).appendTo($selectColumnContainer);};var popout;var allowSelectColumn=true;
if(matchItem.isMatched&&matchItem.invalid){if(matchItem.originalColumn.invalid||!settings.hasAvailableAdditionalColumns){allowSelectColumn=false;
}var $invalidInfoContainer=Spotfire.Flex.item({container:"horizontal",shrink:false}).addClass("sf-addrows-popout-part").appendTo($popoutContainer);
var $invalidInfoIcon=Spotfire.Flex.item({shrink:false}).addClass("sf-addrows-error-icon").appendTo($invalidInfoContainer);
Spotfire.getSvg("Images/Data/ErrorExclamation14x14.svg",function($svg){$svg.appendTo($invalidInfoIcon);
});Spotfire.Flex.item({grow:true}).addClass("sf-addrows-invalid-match-text").text(matchItem.invalidReason).appendTo($invalidInfoContainer);
if(allowSelectColumn){insertSelectColumnContainer(true);}var removeMatchClick=function(){popout.close();
var args={index:matchItem.index};handlers.modify("removeMatch",args);};var $buttonContainer=Spotfire.Flex.item({container:"vertical","align-items":"stretch"}).addClass("sf-addrows-popout-part").appendTo($popoutContainer);
if(allowSelectColumn){$buttonContainer.addClass("sf-addrows-popout-remove-match-part-with-border");}var $removeButton=createButton(Spotfire.Localization.resources.AddRowsRemoveMatch,removeMatchClick,$buttonContainer);
$removeButton.addClass("sf-addrows-popout-remove-match-button");}else{insertSelectColumnContainer(false);
}var createAvailableColumnsListItem=function(top,settings){var $item=$("<div/>").addClass(settings.listItemClass);
$item.css({top:top+"px",height:settings.itemHeight+"px"});var references={};var $noValue=createListItemNoValue().appendTo($item);
hide($noValue);references.noValue=$noValue;var columnPartRefs={};var $columnItem=createColumnListItemPart(false,columnPartRefs).addClass("sf-addrows-available-column-container").css("height","100%").appendTo($item);
references.columnItem=$columnItem;references.columnItemReferences=columnPartRefs;$item.data("references",references);
return $item;};var updateAvailableColumnsListItem=function($item,index,item,hasValue,checked,itemHeight){var references=$item.data("references");
if(!references){return;}var $columnItem=references.columnItem;var $noValue=references.noValue;$item.css("background-color",index%2===0?style.alternateListItemColor:"");
if(!hasValue){hide($columnItem);show($noValue);return;}hide($noValue);show($columnItem);setColumnListItemPartInfo($columnItem,item,false,references.columnItemReferences);
};var updateAvailableColumnsListSelected=function($item,checked){return;};var onSelectionChanged=function(listIndex,item){if(item!==undefined){popout.close();
var args={index:matchItem.index,additionalIndex:item.index};handlers.modify("setMatch",args);}};var availableColumnsListSettings={totalVisibleValues:settings.numberOfVisibleAvailableListItems,itemHeight:40,height:Math.min(settings.numberOfVisibleAvailableListItems,4),showSearchField:settings.numberOfVisibleAvailableListItems>4,onGetValues:function(low,high,generation,callback){if(settings.availableListItems!==undefined){getLocalListItems(settings.availableListItems,low,high,generation,callback);
}else{var args={low:low,high:high,GetValuesGeneration:generation};handlers.read("getAvailableItems",args,callback);
}},itemManager:{createListItem:createAvailableColumnsListItem,updateListItem:updateAvailableColumnsListItem,updateListItemSelected:updateAvailableColumnsListSelected},sendSelectionAfterKeyboardMovement:false,onSelectionChanged:onSelectionChanged,onSearch:function(searchExpression){var args={expression:searchExpression};
handlers.modify("setAvailableListSearchExpression",args);},listItemClass:"sf-addrows-list-box-available-column-item",disableWebPlayerScrollDelay:true};
var beforeClose=function(){availableListBox=null;var args={expression:""};handlers.modify("setAvailableListSearchExpression",args);
};popout=Spotfire.Visuals.Popout.showPopout(Spotfire.newFakeGuid(),{alignment:["Left","Right"],anchor:$button,arrowAlignment:"Center",dialogType:Spotfire.Visuals.Popout.DialogType.ModalDialog,beforeClose:beforeClose},$popoutContainer);
if(allowSelectColumn){availableListBox=Spotfire.Controls.VirtualListBox.create($listContainer,availableColumnsListSettings);
availableListBox.update();}popout.update();};var createMatchList=function($matchContainer){var createMatchItem=function(top,settings){var $item=$("<div/>").addClass(settings.listItemClass);
$item.css({top:top+"px",height:settings.itemHeight+"px"});var references={};var $noValue=createListItemNoValue().addClass("sf-addrows-match-no-value").appendTo($item);
hide($noValue);references.noValue=$noValue;var $container=Spotfire.Flex.item({container:"horizontal","align-items":"stretch"}).addClass("sf-addrows-match-container").appendTo($item);
references.container=$container;var origRefs={};var $originalPart=createColumnListItemPart(false,origRefs).addClass("sf-addrows-match-original").css("width","50%").css("border-right-color",style.matchedBorderColor).appendTo($container);
references.originalPart=$originalPart;references.originalPartReferences=origRefs;var $addedContainer=Spotfire.Flex.item({container:"horizontal","align-items":"stretch"}).addClass("sf-addrows-match-added").css("width","50%").appendTo($container);
var addedRefs={};var $addedColumnPart=createColumnListItemPart(true,addedRefs).addClass("sf-addrows-match-added-column").css("width","100%").appendTo($addedContainer);
hide($addedColumnPart);references.addedColumnPart=$addedColumnPart;references.addedColumnPartReferences=addedRefs;
var $addedCreateNewPart=createAddListItemPart().addClass("sf-addrows-match-added-create-new").hover(function(){$(this).css("background-color",style.matchedColor);
},function(){$(this).css("background-color","");}).css("width","100%").appendTo($addedContainer);hide($addedCreateNewPart);
references.addedCreateNewPart=$addedCreateNewPart;var $addedNoColumnsPart=Spotfire.Flex.item({container:"horizontal","align-items":"center"}).addClass("sf-addrows-match-added-no-columns").css("width","100%").appendTo($addedContainer);
references.addedNoColumnsPart=$addedNoColumnsPart;Spotfire.Flex.item().addClass("sf-addrows-match-added-no-columns-text").text(Spotfire.Localization.resources.AddRowsNoColumnsAvailable).appendTo($addedNoColumnsPart);
hide($addedNoColumnsPart);$item.data("references",references);return $item;};var updateRemoveErrorButton=function($button,matchItem){$button.off("click");
if(matchItem.invalid){$button.removeClass("sf-addrows-remove-button");$button.addClass("sf-addrows-error-button");
$button.on("click",function(){createColumnSelectPopout($button,matchItem);});}else{$button.removeClass("sf-addrows-error-button");
$button.addClass("sf-addrows-remove-button");$button.on("click",function(){var args={index:matchItem.index};
handlers.modify("removeMatch",args);});}};var updateMatchItem=function($item,index,item,hasValue,checked,itemHeight){var references=$item.data("references");
if(!references){return;}var $container=references.container;var $noValue=references.noValue;if(!hasValue){$item.css("background-color","");
hide($container);show($noValue);return;}hide($noValue);show($container);if(item.invalid){$container.addClass("sf-addrows-invalid-match");
}else{$container.removeClass("sf-addrows-invalid-match");}var $originalPart=references.originalPart;setColumnListItemPartInfo($originalPart,item.originalColumn,false,references.originalPartReferences);
var $addedColumnPart=references.addedColumnPart;var $addedColumnPartErrorRemoveButton=references.addedColumnPartReferences.removeAndErrorButton;
var $addedCreateNewPart=references.addedCreateNewPart;var $addedNoColumnsPart=references.addedNoColumnsPart;
if(item.isMatched){hide($addedCreateNewPart);hide($addedNoColumnsPart);show($addedColumnPart);$item.css("background-color",style.matchedColor);
$container.addClass("sf-addrows-matched");setColumnListItemPartInfo($addedColumnPart,item.addedColumn,item.invalid,references.addedColumnPartReferences);
updateRemoveErrorButton($addedColumnPartErrorRemoveButton,item);}else{$item.css("background-color","");
hide($addedColumnPart);$container.removeClass("sf-addrows-matched");if(!settings.hasAvailableAdditionalColumns){hide($addedCreateNewPart);
show($addedNoColumnsPart);}else{hide($addedNoColumnsPart);show($addedCreateNewPart);$addedCreateNewPart.off("click");
$addedCreateNewPart.on("click",function(){createColumnSelectPopout($addedCreateNewPart,item);});}}};var onSelectionChanged=function(listIndex,item){return;
};var updateMatchItemSelected=function($item,checked){return;};var matchListSettings={totalVisibleValues:settings.numberOfVisibleMatchListItems,itemHeight:40,showSearchField:true,onGetValues:function(low,high,generation,callback){if(settings.matchListItems!==undefined){getLocalListItems(settings.matchListItems,low,high,generation,callback);
}else{var args={low:low,high:high,GetValuesGeneration:generation};handlers.read("getMatchItems",args,callback);
}},itemManager:{createListItem:createMatchItem,updateListItem:updateMatchItem,updateListItemSelected:updateMatchItemSelected},listItemClass:"sf-addrows-list-box-match-item",onSearch:function(searchExpression){var args={expression:searchExpression};
handlers.modify("setMatchListSearchExpression",args);},onSelectionChanged:onSelectionChanged,disableWebPlayerScrollDelay:true};
return Spotfire.Controls.VirtualListBox.create($matchContainer,matchListSettings);};var fillOriginContainer=function(){var $originContainer=accordionOriginSection.content;
$originContainer.empty();var createRadioButton=function(id,label,checked,changeMethod,disabled){var radioSize=13;
var $container=Spotfire.Flex.item({container:"horizontal","align-items":"center"});var $radioButton=$("<input/>").attr({type:"radio",name:"selectOrigin",id:id,checked:checked,disabled:disabled}).appendTo($container);
$("<label/>").attr("for",id).text(label).appendTo($container);Spotfire.Filters.StyledFilters.createStyledInput($radioButton,radioSize,radioSize);
$radioButton.change(function(){handlers.modify(changeMethod,{});});return $container;};var createInputField=function(text,defaultText,methodOnChange){var $input=$("<input class='sf-element sf-element-input' type='text'/>").val(text);
Spotfire.Prompt.suppressFormsAcceptCommandIfFocused($input);$input.change(function(){var value=$(this).val().trim();
if(value===""){value=defaultText;}if(value!==text){handlers.modify(methodOnChange,{value:value});}});
Spotfire.Controls.InputField.initialize($input,defaultText,$.noop);return $input;};var isNone=settings.originInformation.setting==="None";
createRadioButton("selectOriginNone",Spotfire.Localization.resources.AddRowsOriginNone,isNone,"switchToNoneOriginColumn",false).addClass("sf-addrows-origin-radio-selector").appendTo($originContainer);
var isNew=settings.originInformation.setting==="New";createRadioButton("selectOriginCreateNew",Spotfire.Localization.resources.AddRowsOriginCreateNew,isNew,"switchToNewOriginColumn",false).addClass("sf-addrows-origin-radio-selector").appendTo($originContainer);
var createBlock=function($parent,$label,$content){var $block=Spotfire.Flex.item({container:"vertical","align-items":"stretch",shrink:false}).addClass("sf-addrows-origin-radio-content-block").appendTo($parent);
$label.appendTo($block);$content.appendTo($block);};if(isNew){var $createNewExpandedContainer=Spotfire.Flex.item({container:"vertical","align-items":"stretch",shrink:false}).addClass("sf-addrows-origin-radio-content").css("background-color",style.originRadioContentColor).appendTo($originContainer);
createBlock($createNewExpandedContainer,Spotfire.Flex.item().addClass("sf-addrows-label").text(Spotfire.Localization.resources.AddRowsOriginCreateNew_ColumnName),createInputField(settings.originInformation.newColumnName,settings.originInformation.defaultNewColumnName,"setNewOriginColumnName"));
createBlock($createNewExpandedContainer,Spotfire.Flex.item().addClass("sf-addrows-label").text(Spotfire.Localization.resources.AddRowsOriginValueOriginalRows),createInputField(settings.originInformation.originalRowSourceValue,settings.originInformation.defaultOriginalRowSourceValue,"setOriginalRowValues"));
createBlock($createNewExpandedContainer,Spotfire.Flex.item().addClass("sf-addrows-label").text(Spotfire.Localization.resources.AddRowsOriginValueNewRows),createInputField(settings.originInformation.newRowSourceValue,settings.originInformation.defaultNewRowSourceValue,"setNewRowValues"));
}var isExisting=settings.originInformation.setting==="Existing";var disabled=!settings.originInformation.canUseExisting;
createRadioButton("selectOriginUseExisting",Spotfire.Localization.resources.AddRowsOriginUseExisting,isExisting,"switchToExistingOriginColumn",disabled).addClass("sf-addrows-origin-radio-selector").appendTo($originContainer);
if(isExisting){if(settings.originInformation.hasError){var $invalidInfoContainer=Spotfire.Flex.item({container:"horizontal",shrink:false}).addClass("sf-addrows-origin-error-container").appendTo($originContainer);
var $invalidInfoIcon=Spotfire.Flex.item({shrink:false}).addClass("sf-addrows-error-icon").appendTo($invalidInfoContainer);
Spotfire.getSvg("Images/Data/ErrorExclamation14x14.svg",function($svg){$svg.appendTo($invalidInfoIcon);
});Spotfire.Flex.item({grow:true}).addClass("sf-addrows-origin-error-text").text(settings.originInformation.errorDescription).appendTo($invalidInfoContainer);
}if(!disabled){var $useExistingExpandedContainer=Spotfire.Flex.item({container:"vertical","align-items":"stretch",shrink:false}).addClass("sf-addrows-origin-radio-content").css("background-color",style.originRadioContentColor).appendTo($originContainer);
$originExistingColumnCombobox=$("<div/>");createBlock($useExistingExpandedContainer,Spotfire.Flex.item().addClass("sf-addrows-label").text(Spotfire.Localization.resources.AddRowsOriginUseExisting_Column),$originExistingColumnCombobox);
Spotfire.Controls.DropDown.initialize($originExistingColumnCombobox,{onSelected:function(selectedValue){handlers.modify("setExistingOriginColumnName",{value:selectedValue});
},values:settings.originInformation.availableExistingColumns,useIndexAsValueId:true,selectedIndex:settings.originInformation.existingSelectedIndex,fixedListWidth:true,useCombobox:true});
createBlock($useExistingExpandedContainer,Spotfire.Flex.item().addClass("sf-addrows-label").text(Spotfire.Localization.resources.AddRowsOriginValueNewRows),createInputField(settings.originInformation.newRowSourceValue,settings.originInformation.defaultNewRowSourceValue,"setNewRowValues"));
}}};var createIncludeList=function($includeContainer){var createIncludeItem=function(top,settings){var $item=$("<div/>").addClass(settings.listItemClass);
$item.css({top:top+"px",height:settings.itemHeight+"px"});var references={};var $noValue=createListItemNoValue().appendTo($item);
hide($noValue);references.noValue=$noValue;var $container=Spotfire.Flex.item({container:"horizontal",inline:true,"align-items":"center"}).addClass("sf-addrows-include-container").css("width","100%").css("height","100%").appendTo($item);
references.container=$container;var $checkbox=Spotfire.Flex.item({shrink:false}).addClass("sf-element sf-element-check-box").appendTo($container);
Spotfire.getSvg("Images/Filters/CheckMark.svg",function($svg){$checkbox.append($svg);});references.checkbox=$checkbox;
var $label=Spotfire.Flex.item().addClass("sf-element sf-element-text-box sf-addrows-include-name").css("text-overflow","ellipsis");
references.label=$label;$label.appendTo($container);$item.data("references",references);return $item;
};var updateIncludeItem=function($item,index,item,hasValue,checked,itemHeight){var references=$item.data("references");
if(!references){return;}var $container=references.container;var $noValue=references.noValue;$item.css("background-color",index%2===0?style.alternateListItemColor:"");
if(!hasValue){hide($container);show($noValue);return;}hide($noValue);show($container);var $checkbox=references.checkbox;
var included=!item.ignored;if(included){$checkbox.removeClass("sfpc-unchecked");$checkbox.addClass("sfpc-checked");
$checkbox.attr("title",Spotfire.Localization.resources.AddRowsExcludeTooltip);}else{$checkbox.removeClass("sfpc-checked");
$checkbox.addClass("sfpc-unchecked");$checkbox.attr("title",Spotfire.Localization.resources.AddRowsIncludeTooltip);
}var onClick=function(){var args={index:item.index};handlers.modify("toggleAdditionalIgnore",args);};
$checkbox.off("sf-touchmousedown");$checkbox.on("sf-touchmousedown",onClick);var $label=references.label;
$label.text(item.name);$label.attr("title",item.name);$label.off("sf-touchmousedown");$label.on("sf-touchmousedown",onClick);
};var updateIncludeItemSelected=function($item,checked){return;};var includeListSettings={height:4,totalVisibleValues:settings.numberOfVisibleIncludeListItems,itemHeight:25,showSearchField:true,onGetValues:function(low,high,generation,callback){if(settings.includeListItems!==undefined){getLocalListItems(settings.includeListItems,low,high,generation,callback);
}else{var args={low:low,high:high,GetValuesGeneration:generation};handlers.read("getIncludeItems",args,callback);
}},itemManager:{createListItem:createIncludeItem,updateListItem:updateIncludeItem,updateListItemSelected:updateIncludeItemSelected},onSearch:function(searchExpression){var args={expression:searchExpression};
handlers.modify("setIncludeListSearchExpression",args);},listItemClass:"sf-addrows-list-box-include-item",disableWebPlayerScrollDelay:true};
return Spotfire.Controls.VirtualListBox.create($includeContainer,includeListSettings);};var updateIncludeButtons=function(){if(settings.hasIncludedAdditionalColumns){$includeNoneButton.removeClass("sfpc-disabled disabled");
$includeNoneButton.css("cursor","pointer");}else{$includeNoneButton.addClass("sfpc-disabled disabled");
$includeNoneButton.css("cursor","default");}if(settings.hasIgnoredAdditionalColumns){$includeAllButton.removeClass("sfpc-disabled disabled");
$includeAllButton.css("cursor","pointer");}else{$includeAllButton.addClass("sfpc-disabled disabled");
$includeAllButton.css("cursor","default");}};var updateAccordion=function(){accordionMatchSection.updateDescription(settings.matchDescription);
if(settings.hasMatchError){accordionMatchSection.additionalIcon.show();}else{accordionMatchSection.additionalIcon.hide();
}accordionIncludeAdditionalSection.updateDescription(settings.includeDescription);accordionOriginSection.updateDescription(settings.originInformation.description);
if(settings.originInformation.hasError){accordionOriginSection.additionalIcon.show();}else{accordionOriginSection.additionalIcon.hide();
}};var setMatchListBoxType=function(){if(matchListbox.totalVisibleValues()<matchListbox.height()){$matchListContainer.addClass("sf-addrows-small-list");
}else{$matchListContainer.removeClass("sf-addrows-small-list");}};var renderSettingsUi=function($pane){var accordion=Spotfire.Controls.Accordion.builder($pane,true);
accordionMatchSection=accordion.addSection({header:Spotfire.Localization.resources.AddRowsMatchHeader,description:settings.matchDescription,onExpanded:function(){matchListbox.adjustHeightToContainer($matchListContainer,undefined,$matchLabelContainer.outerHeight(true));
setMatchListBoxType();},additionalIconUrl:"Images/Data/ErrorExclamation14x14.svg"});var $matchSectionContent=accordionMatchSection.content;
$matchListContainer=Spotfire.Flex.item({grow:true}).appendTo($matchSectionContent);matchListbox=createMatchList($matchListContainer);
$matchLabelContainer=Spotfire.Flex.item({container:"horizontal",shrink:false}).addClass("sf-addrow-match-labels");
Spotfire.Flex.item().css("width","50%").text(Spotfire.Localization.resources.AddRowsOriginalData).appendTo($matchLabelContainer);
Spotfire.Flex.item().css("width","50%").text(Spotfire.Localization.resources.AddRowsAddedData).appendTo($matchLabelContainer);
var $listContainer=$(".ListContainer",$matchListContainer);$matchLabelContainer.insertBefore($listContainer);
accordionIncludeAdditionalSection=accordion.addSection({header:Spotfire.Localization.resources.AddRowsIncludeHeader,description:settings.includeDescription,onExpanded:function(){includeAdditionalColumnsListbox.adjustHeightToContainer($includeAdditionalColumnsListContainer);
}});var $includeAdditionalSectionContent=accordionIncludeAdditionalSection.content;$includeAdditionalColumnsListContainer=Spotfire.Flex.item({grow:true}).appendTo($includeAdditionalSectionContent);
includeAdditionalColumnsListbox=createIncludeList($includeAdditionalColumnsListContainer);var createIncludeButton=function(text,method,$container){var onClick=function(){handlers.modify(method,{});
};var $button=createButton(text,onClick,$container);$button.addClass("sf-addrows-include-button");return $button;
};var $buttonContainer=Spotfire.Flex.item({container:"horizontal","justify-content":"end",shrink:false}).addClass("sf-addrows-include-button-container").css("width","100%").appendTo($includeAdditionalSectionContent);
$includeNoneButton=createIncludeButton(Spotfire.Localization.resources.AddRowsDeselectAllAdditional,"ignoreAllAdditional",$buttonContainer);
$includeAllButton=createIncludeButton(Spotfire.Localization.resources.AddRowsSelectAllAdditional,"includeAllAdditional",$buttonContainer);
updateIncludeButtons();accordionOriginSection=accordion.addSection({header:Spotfire.Localization.resources.AddRowsOriginOfRows,description:settings.originInformation.description,additionalIconUrl:"Images/Data/ErrorExclamation14x14.svg",onExpanded:function(){if($originExistingColumnCombobox){Spotfire.Controls.DropDown.update($originExistingColumnCombobox,{});
}}});fillOriginContainer();accordion.finish();updateAccordion();};var renderPreviewUi=function($pane){Spotfire.Flex.item({shrink:false}).addClass("sf-addrows-label").text(Spotfire.Localization.resources.AddRowsPreviewOfResult).appendTo($pane);
$previewTableContainer=Spotfire.Flex.item({grow:true}).addClass("sf-addrows-preview").appendTo($pane);
var $legend=Spotfire.Flex.item({container:"horizontal",shrink:false}).addClass("sf-addrows-legend").appendTo($pane);
var addLegendItem=function(description,color){Spotfire.Flex.item({shrink:false}).addClass("sf-addrows-legend-colorbox").css("background-color",color).appendTo($legend);
Spotfire.Flex.item().addClass("sf-addrows-legend-description").text(description).attr("title",description).appendTo($legend);
};addLegendItem(Spotfire.Localization.resources.AddRowsLegendOldData,style.oldDataColor);addLegendItem(Spotfire.Localization.resources.AddRowsLegendNewData,style.newDataColor);
var plotBounds={width:$previewTableContainer.width(),height:$previewTableContainer.height()};handlers.modifyWithoutBlocking("CreatePreview",plotBounds);
};var init=function($container,newSettings){settings=newSettings;style=settings.style;var $main=Spotfire.Flex.item({container:"horizontal","align-items":"stretch"}).css("box-sizing","border-box").height("100%").addClass("AddRowsDialog-splitter").appendTo($container);
var $leftPane=Spotfire.Flex.item({container:"vertical","align-items":"stretch"}).addClass("AddRowsDialog-leftPane").css("height","100%").appendTo($main);
var $rightPane=Spotfire.Flex.item({container:"vertical","align-items":"stretch",grow:true}).addClass("AddRowsDialog-rightPane").appendTo($main);
renderSettingsUi($leftPane);renderPreviewUi($rightPane);initialized=true;};var updatePreview=function(){var progressTimer;
var callback=function(callbackArgs){window.clearTimeout(progressTimer);if(callbackArgs.key){var args={key:callbackArgs.key,isUpToDate:callbackArgs.key===lastRequestedPreviewKey};
handlers.modifyWithoutBlocking("UpdatePreview",args);}return;};var showProgress=function(){Progress.showPlotOverlay(previewId);
};progressTimer=window.setTimeout(showProgress,1000);lastRequestedPreviewKey=Spotfire.newFakeGuid();handlers.read("GetPreview",{key:lastRequestedPreviewKey},callback);
};var update=function(newSettings){settings=newSettings;updateAccordion();matchListbox.update({totalVisibleValues:settings.numberOfVisibleMatchListItems});
setMatchListBoxType();includeAdditionalColumnsListbox.update({totalVisibleValues:settings.numberOfVisibleIncludeListItems});
if(availableListBox){availableListBox.update({totalVisibleValues:settings.numberOfVisibleAvailableListItems});
}updateIncludeButtons();fillOriginContainer();if(settings.updatePreview){updatePreview();}};var initPreview=function(id,html){if(!$previewTableContainer){return;
}previewId=id;$previewTableContainer.empty();var $html=$(html);$html.attr("viewid",id);$previewTableContainer.append($html);
updatePreview();};var onResize=function(){if(!initialized){return;}matchListbox.adjustHeightToContainer($matchListContainer,undefined,$matchLabelContainer.outerHeight(true));
setMatchListBoxType();includeAdditionalColumnsListbox.adjustHeightToContainer($includeAdditionalColumnsListContainer);
var plotBounds={width:$previewTableContainer.width(),height:$previewTableContainer.height()};handlers.modifyWithoutBlocking("ResizePreview",plotBounds);
};var handleButtonClick=function(action){switch(action){case"OK":handlers.onOk();break;case"Cancel":handlers.onCancel();
break;}};this.handleButtonClick=handleButtonClick;this.init=init;this.update=update;this.initPreview=initPreview;
this.onResize=onResize;return this;}var getButtons=function(okDisabled,modalDialogHandlers){var okClick=$.noop;
var cancelClick=$.noop;if(modalDialogHandlers){okClick=modalDialogHandlers.onOk;cancelClick=modalDialogHandlers.onCancel;
}return[{text:Spotfire.Localization.resources.Ok,isDefault:true,disabled:okDisabled,actionName:"OK",click:okClick},{text:Spotfire.Localization.resources.Cancel,isCancel:true,actionName:"Cancel",click:cancelClick}];
};var createHandlers=function(invoker,$view,dimColor,confirmOrCancel,stringifyArgs){return{modify:function(method,args){ProgressBlocker.block($view,{bgOpacity:0.5,bgColor:dimColor,showProgress:false,delay:2000});
var finalArgs=stringifyArgs?JSON.stringify(args):args;invoker.modify(method,finalArgs);},modifyWithoutBlocking:function(method,args){var finalArgs=stringifyArgs?JSON.stringify(args):args;
invoker.modify(method,finalArgs);},read:function(method,args,callback){var finalArgs=stringifyArgs?JSON.stringify(args):args;
invoker.read(method,finalArgs,callback);},onOk:function(){var finalArgs=stringifyArgs?JSON.stringify({}):{};
invoker.modify("okSettings",finalArgs);if(confirmOrCancel){invoker.confirm();}},onCancel:function(){var finalArgs=stringifyArgs?JSON.stringify({}):{};
invoker.modify("cancelSettings",finalArgs);if(confirmOrCancel){invoker.cancel();}}};};Spotfire.registerNameSpace("Controls.AddRowsPromptControl",{handleButtonClick:function(viewId,action){var $view=$("#"+viewId);
if($view.length>0){var promptControl=$view.data("promptControl");promptControl.handleButtonClick(action);
}},initializePromptControl:function(viewId,settings){var $view=$("#"+viewId);$view.css("overflow","hidden");
var prompt=Spotfire.Prompt.create(viewId);prompt.setButtons(getButtons(true),"Spotfire.Controls.AddRowsPromptControl.handleButtonClick");
prompt.setEnableSelection(false);var dimColor=settings.progressBlockerColor;var handlers=createHandlers(prompt,$view,dimColor,true,true);
var promptControl=new AddRowsPromptControl(handlers);$view.data("promptControl",promptControl);ProgressBlocker.block($view,{delay:250});
prompt.read("loadPromptControl",JSON.stringify({}),function(newSettings){var resizeImpl=_.debounce(function(){promptControl.onResize();
},100);$view.on("sf-resize",function(e){if($view.is(e.target)){resizeImpl();}});ProgressBlocker.unblock($view);
prompt.setButtons(getButtons(false),"Spotfire.Controls.AddRowsPromptControl.handleButtonClick");promptControl.init($view,newSettings);
});},update:function(viewId,newSettings){var $view=$("#"+viewId);if($view.length>0){var promptControl=$view.data("promptControl");
promptControl.update(newSettings);ProgressBlocker.unblock($view);}},initPreview:function(viewId,previewId,html){var $view=$("#"+viewId);
if($view.length>0){var promptControl=$view.data("promptControl");promptControl.initPreview(previewId,html);
}},showDialog:function(viewId,settings,handlers){var $dialog=$("<div/>").attr("id",viewId);var dimColor=settings.progressBlockerColor;
var wrappedHandlers=createHandlers(handlers,$dialog,dimColor,false,false);var promptControl=new AddRowsPromptControl(wrappedHandlers);
$dialog.data("promptControl",promptControl);var resizeImpl=_.debounce(function(){promptControl.onResize();
},100);Spotfire.Controls.ModalDialog.initialize($dialog,{modal:true,title:settings.title,resizable:true,resize:resizeImpl,minWidth:settings.minWidth,minHeight:settings.minHeight,width:settings.initialWidth,height:settings.initialHeight,buttons:getButtons(true,wrappedHandlers),preventAutoClose:function(){return true;
}});$dialog.parent().css("overflow","hidden");ProgressBlocker.block($dialog,{delay:250});handlers.read("loadPromptControl",{},function(newSettings){ProgressBlocker.unblock($dialog);
Spotfire.Controls.ModalDialog.update($dialog,"buttons",getButtons(false,wrappedHandlers));promptControl.init($dialog,newSettings);
});}});});$(function(){function AddTablePromptControl(){var handlers;var $content;var generateRowsPreview=function(){$content.empty();
var plotBounds={width:$content.width(),height:$content.height()};handlers.modify("GetPreview",plotBounds);
};var init=function($container,newSettings,newHandlers){handlers=newHandlers;var $main=Spotfire.Flex.item({container:"vertical","align-items":"stretch",fill:true}).appendTo($container);
$content=Spotfire.Flex.item({grow:true}).appendTo($main);};var update=function(newSettings){generateRowsPreview();
};var initPreview=function(id,html){$content.empty();var $html=$(html);$html.attr("viewid",id);$content.append($html);
};var handleButtonClick=function(action){switch(action){case"OK":handlers.onOk();break;case"Cancel":handlers.onCancel();
break;}};this.handleButtonClick=handleButtonClick;this.generateRowsPreview=generateRowsPreview;this.init=init;
this.update=update;this.initPreview=initPreview;return this;}var getButtons=function(){return[{text:Spotfire.Localization.resources.Ok,isDefault:true,actionName:"OK"},{text:Spotfire.Localization.resources.Cancel,isCancel:true,actionName:"Cancel"}];
};Spotfire.registerNameSpace("Controls.AddTablePromptControl",{handleButtonClick:function(viewId,action){var $view=$("#"+viewId);
if($view.length>0){var promptControl=$view.data("promptControl");promptControl.handleButtonClick(action);
}},initializePromptControl:function(viewId,settings){var promptControl=new AddTablePromptControl();var prompt=Spotfire.Prompt.create(viewId);
Prompt.onPromptLoaded=function(){prompt.resize(window.innerWidth-60,window.innerHeight-60);promptControl.generateRowsPreview();
};var $view=$("#"+viewId);$view.css("overflow","hidden");var handlers={modify:function(method,args){prompt.modify(method,JSON.stringify(args));
},read:function(method,args,callback){prompt.read(method,JSON.stringify(args),callback);},onOk:function(){prompt.modify("okSettings",JSON.stringify({}));
prompt.confirm();},onCancel:function(){prompt.modify("cancelSettings",JSON.stringify({}));prompt.cancel();
}};prompt.setButtons(getButtons(),"Spotfire.Controls.AddTablePromptControl.handleButtonClick");promptControl.init($view,settings,handlers);
$view.data("promptControl",promptControl);},update:function(viewId,newSettings){var $view=$("#"+viewId);
if($view.length>0){var promptControl=$view.data("promptControl");promptControl.update(newSettings);}},initPreview:function(viewId,previewId,html){var $view=$("#"+viewId);
if($view.length>0){var promptControl=$view.data("promptControl");promptControl.initPreview(previewId,html);
}},showDialog:function(viewId,settings,handlers){var $dialog=$("<div/>").attr("id",viewId);var control=new AddTablePromptControl();
control.init($dialog,settings,handlers);$dialog.data("promptControl",control);Spotfire.Controls.ModalDialog.initialize($dialog,{modal:true,title:settings.title,resizable:true,minWidth:400,minHeight:350,width:window.innerWidth-60,height:window.innerHeight-60,buttons:getButtons(handlers)});
control.generateRowsPreview();}});});jQuery(function($){Spotfire.registerNameSpace("Annotations");var disableReference=null;
var timer=null;var actions={ADD:"AddAnnotation",REMOVE:"DeleteAnnotation",COPY:"CopyAnnotation",STATE:"UpdateAnnotationState",TOGGLE:"ToggleAnnotationViewState"};
var $activeAnnotation;function mouseUp(){$activeAnnotation.removeClass("annotation--active");$(window).off("mouseup",mouseUp);
}function mouseDown(){$activeAnnotation=$(this);$activeAnnotation.addClass("annotation--active");$(window).on("mouseup",mouseUp);
}$(window.document).on("mousedown","div.annotation",mouseDown);function sendUpdate(annotationId,action,content){content=content||{};
Ajax.enqueueRequest(Spotfire.Annotations.Id,action,{id:annotationId,content:content});}function getStyleSettings($annotation){var styles={};
var fontSize=$annotation.get(0).style.fontSize;var backgroundColor=$annotation.get(0).style.backgroundColor;
var color=$annotation.get(0).style.color;if(fontSize!==""){styles["font-size"]=parseInt(fontSize,10);
}if(backgroundColor!==""){styles["background-color"]=$annotation.css("background-color");}if(color!==""){styles.color=color;
}return styles;}function minimizedAnnotation(config){var $annotation=$("<div>");$annotation.css({top:config.y,left:config.x}).append($('<svg viewBox="0 0 17 17"><rect fill="#F8E58B" width="17" height="17"/><path fill="#B5A55C" d="M0,0v17h17V0H0z M16,16H1V1h15V16z"/><rect x="12" y="12" fill="#918448" width="1" height="4"/><rect x="13" y="12" fill="#918448" width="3" height="1"/><path fill="#7C6E35" d="M11.533,10.631c-0.146-0.139-0.333-0.474-0.56-1.007L8.597,4H8.504L6.147,9.473c-0.224,0.523-0.412,0.868-0.564,1.034C5.431,10.674,5.237,10.775,5,10.813V11h2.193v-0.187c-0.345-0.027-0.56-0.067-0.647-0.121c-0.149-0.092-0.224-0.233-0.224-0.425c0-0.145,0.045-0.329,0.136-0.551l0.277-0.668h2.329l0.35,0.855c0.091,0.223,0.139,0.349,0.146,0.379c0.019,0.064,0.029,0.126,0.029,0.187c0,0.102-0.036,0.178-0.107,0.232c-0.104,0.074-0.284,0.112-0.539,0.112H8.811V11H12v-0.187C11.799,10.795,11.643,10.735,11.533,10.631z M6.906,8.673l1.011-2.362l0.982,2.362H6.906z"/></svg>')).attr("title",config.content).addClass("annotation annotation--minimized").on("contextmenu",function(event){event.preventDefault();
}).on("click",function(){sendUpdate(config.id,actions.TOGGLE,{});}).appendTo($(".sf-annotations-container"));
Spotfire.Utilities.placeWithinContainer($annotation,Spotfire.Utilities.containerDimensions(config.parent),true,true);
}function editableAnnotation(config){var containerMeasurements=Spotfire.Utilities.containerDimensions(config.parent);
var $annotation=$("<div>"),$expandingTextarea=$("<div>"),changewidth=100;function updateState(){sendUpdate(config.id,actions.STATE,{position:{x:parseInt($annotation.css("left"),10),y:parseInt($annotation.css("top"),10)},content:config.content,minimized:config.minimized,size:{width:parseInt($annotation.outerWidth(),10),height:parseInt($annotation.outerHeight(),10)},styleSettings:getStyleSettings($annotation)});
}function disableEdit(e,noUpdate){noUpdate=noUpdate||false;if(e){var $parent=$(e.target);while(true){if($parent.length===0){break;
}if($parent.hasClass("ColorPicker")||$parent.hasClass("contextMenu")||$parent.hasClass("AxisExpressionPopout")||$parent.hasClass("ShapePicker")||$parent.hasClass("ui-dialog")||$parent.hasClass("ui-widget-overlay")||$parent.hasClass("ui-resizable-handle")||$parent.hasClass("annotations-edit-bar")){return;
}if($parent.is($annotation)){return;}$parent=$parent.parent();}if($parent.hasClass("annotations-edit-bar")){return;
}}disableReference=null;$annotation.removeClass("annotation--edit annotation--active");$(document.body).off("mousedown.annotation-edit touchstart.annotation-edit");
$(document.body).off("keydown.annotation-edit");$(window).off("resize.annotation-edit");$(".expanding-textarea__text",$annotation).blur();
$expandingTextarea.removeClass("edit");Spotfire.Annotations.EditBar.remove();if(!noUpdate){updateState();
}Spotfire.MultipleViews.OffRemoteFocus(disableEdit);}Spotfire.MultipleViews.OnRemoteFocus(disableEdit);
function editBarConfig(){function getCurrentStyleSettings(){return{"background-color":$annotation.css("background-color"),color:$annotation.css("color"),"font-size":$annotation.css("font-size")};
}return{annotation:$annotation,annotationId:config.id,containment:config.parent,styleSettings:getCurrentStyleSettings(),copyCallback:function(){disableEdit();
sendUpdate(config.id,actions.COPY,{});},removeCallback:function(){disableEdit(null,true);sendUpdate(config.id,actions.REMOVE);
$annotation.remove();},setFontSize:function(difference){var lowerLimit=5,upperLimit=50,movements,startHeight=parseInt($annotation.css("height"),10),size=parseInt($annotation.css("font-size"),10)+difference;
movements=Spotfire.Utilities.availableMovementWithinContainer($annotation,Spotfire.Utilities.containerDimensions(config.parent),true);
size=size<lowerLimit?lowerLimit:size;size=size>upperLimit?upperLimit:size;if(size>=lowerLimit&&size<=upperLimit){$annotation.css("font-size",size);
}if($annotation.outerHeight()>startHeight+movements.down&&difference>0){$annotation.css("font-size",size-difference);
}if(changewidth===100){changewidth=changewidth+0.01;}else{changewidth=changewidth-0.01;}$expandingTextarea.css({width:changewidth+"%"});
},setColor:function(color){$annotation.css("color",color);},setBackground:function(color){$annotation.css("background-color",color);
}};}function esc(event){if(event.which===27){disableEdit();event.stopPropagation();event.preventDefault();
}}function enableEdit(focus){disableReference=disableEdit;focus=focus||false;$expandingTextarea.addClass("edit");
$annotation.addClass("annotation--edit annotation--active");Spotfire.Annotations.EditBar.take(editBarConfig());
$(".annotation").not(".annotation--active").insertBefore($annotation);$(document.body).off("mousedown.annotation-edit touchstart.annotation-edit",disableEdit);
$(document.body).on("mousedown.annotation-edit touchstart.annotation-edit",disableEdit);$(window).on("resize.annotation-edit",disableEdit);
$(document.body).on("keydown.annotation-edit",esc);if(focus){var val=$(".expanding-textarea__text",$annotation).val();
$(".expanding-textarea__text",$annotation).focus().val("").val(val);}}function minimize(e){disableEdit();
sendUpdate(config.id,actions.TOGGLE,{});e.preventDefault();e.stopPropagation();}$annotation.css({top:config.y,left:config.x,width:config.width,position:"absolute"}).css(config.styleSettings).addClass("annotation sf-element-annotation annotation--editable").attr("id",config.id).append($expandingTextarea).appendTo($(".sf-annotations-container")).on("contextmenu",function(e){e.preventDefault();
});var measurements=Spotfire.Utilities.containerDimensions(config.parent);Spotfire.Controls.ExpandingTextarea.initialize($expandingTextarea,{content:config.content,editAllowed:config.editAllowed,textChange:function(val){config.content=val;
measurements.offset=config.parent.offset();measurements.scrollLeft=config.parent.prop("scrollLeft");measurements.scrollTop=config.parent.prop("scrollTop");
Spotfire.Utilities.placeWithinContainer($annotation,measurements,true,true);Spotfire.Annotations.EditBar.updatePosition();
}});$annotation.append($("<div>").addClass("annotation__minimize-button").bind("mousedown",function(event){if(event.which!==1){event.preventDefault();
}else{minimize(event);}}).bind("touchstart",minimize).attr("title",Spotfire.Localization.resources.Annotations_Minimize).append($('<svg viewBox="0 0 16 16"><circle class="annotations-collapse__bg" fill="currentColor" cx="8" cy="8" r="8"/><polygon class="annotations-collapse__arrow" fill="currentColor" points="5,5 5,12 6.937,12 6.937,6.932 12,6.932 12,5"/></svg>')));
enableEdit(true);Spotfire.Touch.draggable($annotation,{containment:config.parent,dragThreshold:3,start:function(){$(".annotation").not(".annotation--active").insertBefore($annotation);
Spotfire.Annotations.EditBar.remove();$(document.body).off("keydown.annotation-edit",esc);},stop:function(){Spotfire.Annotations.EditBar.take(editBarConfig());
$(document.body).on("keydown.annotation-edit",esc);}});Spotfire.Touch.resizable($annotation,{containment:config.parent,minWidth:50,start:function(){Spotfire.Annotations.EditBar.remove();
$(document.body).off("keydown.annotation-edit",esc);},stop:function(){Spotfire.Annotations.EditBar.take(editBarConfig());
$(document.body).on("keydown.annotation-edit",esc);}});Spotfire.Utilities.placeWithinContainer($annotation,containerMeasurements,true,true);
}function annotation(config){var containerMeasurements=Spotfire.Utilities.containerDimensions(config.parent);
var $annotation=$("<div>");function updateState(){sendUpdate(config.id,actions.STATE,{position:{x:parseInt($annotation.css("left"),10),y:parseInt($annotation.css("top"),10)},size:{width:parseInt($annotation.outerWidth(),10),height:parseInt($annotation.outerHeight(),10)}});
}function minimize(e){sendUpdate(config.id,actions.TOGGLE,{});e.preventDefault();e.stopPropagation();
}$annotation.css({top:config.y,left:config.x,width:config.width,position:"absolute"}).css(config.styleSettings).addClass("annotation sf-element-annotation").attr("id",config.id).text(config.content).appendTo($(".sf-annotations-container"));
$annotation.append($("<div>").addClass("annotation__minimize-button").on("mousedown",function(event){if(event.which!==1){event.preventDefault();
}else{minimize(event);}}).on("touchstart",minimize).attr("title",Spotfire.Localization.resources.Annotations_Minimize).append($('<svg viewBox="0 0 16 16"><circle class="annotations-collapse__bg" fill="currentColor" cx="8" cy="8" r="8"/><polygon class="annotations-collapse__arrow" fill="currentColor" points="5,5 5,12 6.937,12 6.937,6.932 12,6.932 12,5"/></svg>')));
$annotation.on("contextmenu",function(e){e.preventDefault();});if(config.editAllowed){$annotation.addClass("annotation--editable");
Spotfire.Touch.draggable($annotation,{containment:config.parent,dragThreshold:3,start:function(){$(".annotation").not(".annotation--active").insertBefore($annotation);
},stop:function(){updateState();},click:function(){$annotation.remove();editableAnnotation(config);}});
Spotfire.Touch.resizable($annotation,{containment:config.parent,minWidth:50,stop:function(){updateState();
}});}Spotfire.Utilities.placeWithinContainer($annotation,containerMeasurements,true,true);}Spotfire.Annotations.update=function(config){Spotfire.Annotations.Id=config.visualPageArea;
function create(){var activeIds=[];$(".annotation--active").each(function(){activeIds.push($(this).attr("id"));
});$(".annotation").not(".annotation--active").not(".annotation--edit").remove();var nonActiveAnnotations=config.annotations.filter(function(a){return activeIds.indexOf(a.id)<0;
});nonActiveAnnotations.forEach(function(a){a.parent=$("#"+config.visualPageArea);if(a.minimized){minimizedAnnotation(a);
}else{if(config.editId!==undefined&&config.editId===a.id){editableAnnotation(a);}else{annotation(a);}}});
}if(timer!==null){window.clearTimeout(timer);}timer=setTimeout(create,0);};Spotfire.Annotations.clear=function(){if(timer!==null){window.clearTimeout(timer);
timer=null;}Spotfire.Annotations.EditBar.remove();$(".annotation").remove();disableReference=null;$(document.body).off("mousedown.annotation-edit touchstart.annotation-edit");
$(document.body).off("keydown.annotation-edit");};Spotfire.Annotations.add=function(){if(disableReference!==null){disableReference();
}sendUpdate(null,actions.ADD,{});};});jQuery(function($){Spotfire.registerNameSpace("Annotations");Spotfire.Annotations.EditBar=(function(){var bar=null;
function Bar(config){var $bar=$("<div>");function updatePosition(){var distance=10;var containerMeasurement=Spotfire.Utilities.containerDimensions(config.containment);
var annotationPosition={top:parseInt(config.annotation.css("top"),10),left:parseInt(config.annotation.css("left"),10)};
$bar.css({top:annotationPosition.top-$bar.outerHeight()-distance,left:annotationPosition.left,position:"absolute",border:"1px solid #404040"});
if(Spotfire.Utilities.elementFitsInsideMeasurement($bar,containerMeasurement,true)){return;}$bar.css({top:annotationPosition.top-$bar.outerHeight()-distance,left:annotationPosition.left-$bar.outerWidth()+config.annotation.outerWidth()});
if(Spotfire.Utilities.elementFitsInsideMeasurement($bar,containerMeasurement,true)){return;}$bar.css({top:annotationPosition.top,left:annotationPosition.left+config.annotation.outerWidth()+distance});
if(Spotfire.Utilities.elementFitsInsideMeasurement($bar,containerMeasurement,true)){return;}$bar.css({top:annotationPosition.top,left:annotationPosition.left-$bar.outerWidth()-distance});
if(Spotfire.Utilities.elementFitsInsideMeasurement($bar,containerMeasurement,true)){return;}$bar.css({top:annotationPosition.top+config.annotation.outerHeight()+distance,left:annotationPosition.left});
if(Spotfire.Utilities.elementFitsInsideMeasurement($bar,containerMeasurement,true)){return;}$bar.css({top:annotationPosition.top+config.annotation.outerHeight()+distance,left:annotationPosition.left-$bar.outerWidth()+config.annotation.outerWidth()});
if(Spotfire.Utilities.elementFitsInsideMeasurement($bar,containerMeasurement,true)){return;}$bar.css({top:annotationPosition.top+distance,left:annotationPosition.left+distance});
return;}function build(){function barButton($parent,options){var defaultOptions={enabled:true,tooltip:"",svg:undefined,horizontalMargins:undefined,onClick:$.noop};
$.extend(defaultOptions,options);var $button=$("<button>").addClass("annotations-edit-bar__button");if(defaultOptions.svg){$button.append(defaultOptions.svg);
}$button.attr("title",defaultOptions.tooltip);if(defaultOptions.enabled){$button.click(defaultOptions.onClick);
}else{$button.addClass("annotations-edit-bar__button--disabled");}$button.appendTo($parent);return $button;
}$bar.addClass("annotations-edit-bar sf-element-dialog").appendTo($(".sf-annotations-container")).empty();
var backgroundColorEditor=Spotfire.Visuals.BoxEditor.colorField();backgroundColorEditor.element().css("display","inline-block").attr("title",Spotfire.Localization.resources.AnnotationsEditBar_BackgroundColor);
backgroundColorEditor.value(config.styleSettings["background-color"]);backgroundColorEditor.onChange(function(value){config.setBackground(value);
});$bar.append(backgroundColorEditor.element());var colorEditor=Spotfire.Visuals.BoxEditor.colorField();
colorEditor.element().css("display","inline-block").attr("title",Spotfire.Localization.resources.AnnotationsEditBar_TextColor);
colorEditor.value(config.styleSettings.color);colorEditor.onChange(function(value){config.setColor(value);
});$bar.append(colorEditor.element());barButton($bar,{enabled:true,tooltip:Spotfire.Localization.resources.AnnotationsEditBar_DecreaseFontSize,svg:$('<svg viewBox="0 0 20 20"><path fill="#FFFFFF" d="M10,2c-4.418,0-8,3.582-8,8s3.582,8,8,8s8-3.582,8-8S14.418,2,10,2z M14,11H6V9h8V11z"/></svg>'),onClick:function(){config.setFontSize(-2);
updatePosition();}});barButton($bar,{enabled:true,tooltip:Spotfire.Localization.resources.AnnotationsEditBar_IncreaseFontSize,svg:$('<svg viewBox="0 0 20 20"><path fill="#FFFFFF" d="M10,2c-4.418,0-8,3.582-8,8s3.582,8,8,8s8-3.582,8-8S14.418,2,10,2z M14,11h-3v3H9v-3H6V9h3V6h2v3h3V11z"	/></svg>'),onClick:function(){config.setFontSize(2);
updatePosition();}});barButton($bar,{enabled:Spotfire.Licenses.licensedFeatures.CreateAnnotations,tooltip:Spotfire.Localization.resources.AnnotationsEditBar_Duplicate,svg:$('<svg viewBox="0 0 20 20"><path fill="#ffffff" d="M15.021,7H9v11h9V9.979L15.021,7z M16,15h-5v-1h5V15z M16,13h-5v-1h5V13z M16,11h-5v-1h5V11z"/><polygon fill="#ffffff" points="8.021,2 2,2 2,13 8,13 8,10 4,10 4,9 8,9 8,8 4,8 4,7 8,7 8,6 4,6 4,5 9,5 9,6 11,6 11,4.979"/></svg>'),onClick:function(){config.copyCallback();
}});barButton($bar,{enabled:true,tooltip:Spotfire.Localization.resources.AnnotationsEditBar_Remove,svg:$('<svg viewBox="0 0 20 20"><path fill="#ffffff" d="M3,6l1.375,10.554c0,0.799,0.672,1.446,1.5,1.446h8.25c0.828,0,1.5-0.647,1.5-1.446L17,6H3z"/><path fill="#ffffff" d="M17.502,4H13.5V3.621C13.5,2.726,12.803,2,11.944,2H8.056C7.196,2,6.5,2.726,6.5,3.621V4H2.498 C2.223,4,2,4.226,2,4.504C2,4.769,2.203,4.979,2.459,5h15.082C17.797,4.979,18,4.769,18,4.504C18,4.226,17.777,4,17.502,4z M12.722,4H7.278V3.621c0-0.448,0.348-0.81,0.778-0.81h3.889c0.43,0,0.778,0.363,0.778,0.81V4z"/></svg>'),onClick:function(){config.removeCallback();
}});$bar.on("contextmenu",function(e){e.preventDefault();});updatePosition();}function show(){if(jQuery.contains(document,$bar[0])&&$bar.is(":visible")){$bar.detach();
}build();}build();this.Id=config.annotationId;this.show=show;this.hide=function(){$bar.detach();};this.updatePosition=updatePosition;
this.remove=function(){$bar.remove();};}function hasBar(id){if(!id){return(bar!==null);}if(bar&&id===bar.Id){return true;
}return false;}function take(config){if(bar){bar.remove();}bar=new Bar(config);return bar;}function release(id){if(hasBar(id)){bar.remove();
bar=null;}}function updatePosition(){if(bar!==null){bar.updatePosition();}}function remove(){if(bar!==null){bar.remove();
}bar=null;}return{take:take,release:release,hasBar:hasBar,remove:remove,updatePosition:updatePosition};
}());});$(function(){var viewId=null;var eventHandlers={};var ensureString=function(obj){if(obj===null){return null;
}return typeof obj==="string"?obj:JSON.stringify(obj);};var verifyInitialized=function(){if(viewId===null){throw"AppIntegration not initialized";
}};Spotfire.registerNameSpace("AppIntegration",{initialize:function(id){var raiseEvent=viewId===null;
viewId=id;if(raiseEvent){window.dispatchEvent(new window.CustomEvent("SpotfireAppReady"));}},version:function(){return 3;
},invokeEventHandler:function(eventArgs){var name=eventArgs.name;var args=eventArgs.args;if(eventHandlers[name]!==undefined){$.each(eventHandlers[name],function(){this(args);
});}},read:function(method,args,callback){verifyInitialized();Spotfire.Dxp.Web.Forms.AjaxService.Read(viewId,method,ensureString(args),callback);
},modify:function(method,args){verifyInitialized();Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,method,ensureString(args));
},addEventHandler:function(name,handler){if(typeof name==="string"&&typeof handler==="function"){if(eventHandlers[name]===undefined){eventHandlers[name]=[];
}eventHandlers[name].push(handler);}}});});$(function(){Spotfire.registerNameSpace("Visuals.AxisExpressionPopout");
var currentPopout=null;Spotfire.Visuals.AxisExpressionPopout.update=function(viewId){if(currentPopout!==null&&currentPopout.viewId===viewId){currentPopout.invalidate();
}};Spotfire.Visuals.AxisExpressionPopout.show=function(viewId,index,settings){var invalidate,onBodyMouseDown;
var $popout=$("<div/>").addClass("AxisExpressionPopout");if(Spotfire.capabilities.supportsDropShadow()){$popout.addClass("RoundedDropShadow");
}var $body=$(document.body);Spotfire.PopoverPanel.showPopout($popout);var closePopout=function(){$popout.remove();
$body.unbind("mousedown",onBodyMouseDown);currentPopout=null;};onBodyMouseDown=function(event){var target=$(event.target);
while(true){if(target.length===0||target.is(document.body)){break;}if(target.is(".AxisExpressionPopout")){return;
}if(target.is(".contextMenu")){return;}target=target.parent();}closePopout();};$body.bind("mousedown",onBodyMouseDown);
var $header=$("<div/>").addClass("header");var $settingsDropDown=$("<div/>").addClass("button dropDownButton").attr("title",Spotfire.Localization.resources.AxisExpressionPopoutSettings).hide();
var $closeButton=$("<div/>").addClass("button closeButton").attr("title",Spotfire.Localization.resources.Close).click(closePopout);
var $removeButton=$("<div/>").addClass("removeButton").attr("title",Spotfire.Localization.resources.AxisExpressionPopoutRemove).text(Spotfire.Localization.resources.AxisExpressionPopoutRemove);
var $columnList=$("<div/>").addClass("columnList");$header.append($closeButton);$header.append($settingsDropDown);
$popout.append($header);var $calculationDropDown;if(settings.supportsAggregation){$calculationDropDown=$("<div/>").addClass("calculationDropDown");
var $calculationDropDownButton=$("<div/>").addClass("calculationDropDownButton");$calculationDropDown.append($calculationDropDownButton);
$popout.append($calculationDropDown);$popout.height($popout.height()+$calculationDropDown.outerHeight(true));
}$popout.append($columnList);var $displayNameHeader=$("<div/>").addClass("displayNameHeader");var $displayName=$("<input/>").addClass("sf-element-displayName").attr("type","text");
$displayNameHeader.append($displayName);$popout.append($displayNameHeader);$popout.height($popout.height()+$displayNameHeader.outerHeight(true));
$popout.append($removeButton);var searchExpression="";var tableIndex=-1;var createArgs=function(){return{axisIndex:index,searchExpression:searchExpression,tableIndex:tableIndex};
};var listBox=Spotfire.Controls.VirtualListBox.create($columnList,{showSearchField:true,height:12,itemHeight:20,onGetValues:function(low,high,generation,callback){var args=createArgs();
args.low=low;args.high=high;Spotfire.Dxp.Web.Forms.AjaxService.Read(viewId,"GetColumns",JSON.stringify(args),callback);
},onSelectionChanged:function(selectedIndex){var args=createArgs();args.selectedIndex=selectedIndex;args.contextMenuIndex=-1;
Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,"SelectColumn",JSON.stringify(args));},onSearch:function(pattern){searchExpression=pattern;
invalidate();},onShowContextMenu:function(i,pos){var showContextMenu=function(items){var menu=Spotfire.Controls.ContextMenu.create(items,function(item){var contextMenuArgs=createArgs();
contextMenuArgs.selectedIndex=i;contextMenuArgs.contextMenuIndex=item.index;Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,"SelectColumn",JSON.stringify(contextMenuArgs));
return true;});menu.show(pos.left,pos.top);};var args=createArgs();args.listIndex=i;Spotfire.Dxp.Web.Forms.AjaxService.Read(viewId,"GetContextMenuItems",JSON.stringify(args),showContextMenu);
}});var enableDisplayName=function(enabled){$displayNameHeader.toggleClass("displayNameHeaderDisabled",!enabled);
$displayName.prop("disabled",!enabled);};var enableRemoveButton=function(enabled){$removeButton.toggleClass("removeButtonDisabled",!enabled);
$removeButton.off("click");if(enabled){$removeButton.on("click",function(){Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,"Remove",JSON.stringify(index));
closePopout();});}};var hasDisplayName;var dNfocus;var updateDisplayName=function(displayName){if(!displayName&&!dNfocus){hasDisplayName=false;
$displayName.val(Spotfire.Localization.resources.AxisExpressionPopoutDisplayName);$displayName.css("color","#949494");
return;}hasDisplayName=true;$displayName.css("color","#000000");$displayName.val(displayName);};$displayName.on("keydown",function(e){if(e.keyCode===Keys.RETURN){$(this).blur();
}else{if(e.keyCode===Keys.ESCAPE){$displayName.val("");$(this.blur());}}});$displayName.focus(function(){dNfocus=true;
$displayNameHeader.toggleClass("displayNameHeaderFocus",true);if(!hasDisplayName){$displayName.val("");
$displayName.css("color","#000000");}});$displayName.on("blur",function(){dNfocus=false;$displayNameHeader.toggleClass("displayNameHeaderFocus",false);
var newDisplayName=$.trim($displayName.val());if(!newDisplayName){updateDisplayName("");}var args={index:index,newDisplayName:newDisplayName};
Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,"newDisplayName",JSON.stringify(args));});var updateDataTableDropDown=function(tables){var showDropDown=tables.length>1;
var $dataTableDropDown=$(".dataTableDropDown",$header);if($dataTableDropDown.length===0){if(!showDropDown){return;
}$dataTableDropDown=$("<div/>").addClass("dataTableDropDown");$header.append($dataTableDropDown);}$dataTableDropDown.empty();
if(!showDropDown){$dataTableDropDown.remove();return;}if(tableIndex>=0&&tableIndex<tables.length){$dataTableDropDown.append($("<span/>").attr("title",tables[tableIndex]).text(tables[tableIndex]));
}var $arrow=$("<div/>").addClass("arrow");$dataTableDropDown.append($arrow);var onMenuItemClicked=function(item){tableIndex=item.tableIndex;
invalidate();return true;};var createMenuItems=function(){var items=[];var i;for(i=0;i<tables.length;
i++){items.push({text:tables[i],enabled:true,checked:i===tableIndex,tableIndex:i});}return items;};$dataTableDropDown.children().on("click",function(){var contextMenu=Spotfire.Controls.ContextMenu.create(createMenuItems(),onMenuItemClicked);
var pos=$dataTableDropDown.offset();contextMenu.show(pos.left,pos.top+$dataTableDropDown.height());});
};var updateCalculationsDropDown=function(calculations,selectedIndex){if(!settings.supportsAggregation){return;
}$("span",$calculationDropDown).remove();var $label=$("<span/>");$calculationDropDown.append($label);
var setLabelText=function(text){$label.attr("title",text).text(text);};if(selectedIndex>=0&&selectedIndex<calculations.length){setLabelText(calculations[selectedIndex].name);
}var onMenuItemClicked=function(clickedItem){var args=createArgs();setLabelText(clickedItem.text);args.calculationIndex=clickedItem.calculationIndex;
Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,"SelectCalculation",JSON.stringify(args));return true;
};var createMenuItems=function(){var items=[],j;var listLength=11;for(j=0;j<calculations.length;j++){if(items.length<listLength){items.push({text:calculations[j].name,enabled:true,checked:j===selectedIndex,calculationIndex:j});
}else{if(items[listLength]===undefined){items[listLength]={text:Spotfire.Localization.resources.AxisExpressionPopoutNestedListTitle,children:[],enabled:true,checked:selectedIndex>=listLength};
}items[listLength].children.push({text:calculations[j].name,enabled:true,checked:j===selectedIndex,calculationIndex:j});
}}return items;};$calculationDropDown.off("click");$calculationDropDown.on("click",function(){var contextMenu=Spotfire.Controls.ContextMenu.create(createMenuItems(),onMenuItemClicked);
var pos=$calculationDropDown.offset();contextMenu.show(pos.left,pos.top+$calculationDropDown.height());
});};var updateSettingsDropDown=function(supportsAutoBin,isAutoBin){if(supportsAutoBin){$settingsDropDown.show();
}else{$settingsDropDown.hide();}$settingsDropDown.unbind("click");$settingsDropDown.click(function(){var autoBin={text:Spotfire.Localization.resources.AxisExpressionPopoutAutoBin,enabled:true,checked:isAutoBin,onClick:function(){Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,"ToggleAutoBin",JSON.stringify({index:index}));
}};var menu=Spotfire.Controls.ContextMenu.create([autoBin],function(item){item.onClick();return true;
});var pos=$settingsDropDown.offset();pos.top+=$settingsDropDown.height();menu.show(pos.left,pos.top);
});};invalidate=function(){listBox.update();Spotfire.Dxp.Web.Forms.AjaxService.Read(viewId,"Invalidate",JSON.stringify(createArgs()),function(state){tableIndex=state.selectedTableIndex;
updateDataTableDropDown(state.tables);updateCalculationsDropDown(state.calculations,state.selectedCalculationIndex);
updateSettingsDropDown(state.supportsAutoBin,state.isAutoBin);enableDisplayName(state.hasAxisValue&&tableIndex>=0);
enableRemoveButton(state.hasAxisValue);updateDisplayName(state.displayName);listBox.update({totalVisibleValues:state.columnCount});
});};currentPopout={viewId:viewId,invalidate:invalidate};var left=settings.left;var top=settings.top;
var windowMargin=5;var overflowY=Math.min(0,$(window).height()-(top+$popout.height()+windowMargin));var overflowX=Math.min(0,$(window).width()-(left+$popout.width()+windowMargin));
$popout.css({left:(left+overflowX)+"px",top:(top+overflowY)+"px"});$popout.draggable({containment:"window",handle:".header"});
invalidate();};});$(function(){Spotfire.registerNameSpace("Visuals.AxisTrayControl");var createSelectColumnsMenuItem=function(viewId){return{text:Spotfire.Localization.resources.AxisTraySelectColumns,enabled:true,onClick:function(){Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,"ShowSelectColumnsDialog","");
}};};if(Spotfire.isWebPlayer()){var onShowPopout=function(subject,message){var data=JSON.parse(message);
if(data.isCollapsed&&data.index===0){var menu=Spotfire.Controls.ContextMenu.create([createSelectColumnsMenuItem(data.viewId)],function(item){item.onClick();
return true;});menu.show(data.popoutSettings.left,data.popoutSettings.top);return;}Spotfire.Visuals.AxisExpressionPopout.show(data.viewId,data.index,data.popoutSettings);
};Spotfire.PageBus.subscribe("spotfire.visuals.axistray.showpopout",onShowPopout);}var showCustomExpressionDialog=function(viewId,expression,expressionFont){var dialog;
var $dialog=$("<div/>").addClass("CustomExpressionDialog");var applyAndClose;var editor=Spotfire.Controls.CustomExpressionEditor.create({ApplyAndClose:function(){applyAndClose();
},ExpressionFont:expressionFont,InitialExpression:expression,ProvideIntellisense:function(args,callback){Spotfire.Dxp.Web.Forms.AjaxService.Read(viewId,"ProvideIntellisense",JSON.stringify(args),callback);
}});var $textBox=editor.TextBox;var $error=editor.Error;$dialog.append($textBox);$dialog.append($error);
var performApply=function(callback){$error.empty();var expr=editor.GetExpression();if(expr===expression){_.defer(callback);
return;}var tryParse=function(result){if(result.valid){expression=expr;Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,"CustomExpression",expr);
callback();}else{$error.text(result.message);}};Spotfire.Dxp.Web.Forms.AjaxService.Read(viewId,"ValidateExpression",expr,tryParse);
};var close=function(){dialog.close();};applyAndClose=function(){performApply(close);return true;};var apply=function(){performApply(_.noop);
};var showHelp=function(){Spotfire.Web.showHelp("5001037");};var onOpen=function(){editor.OnOpen();};
var onClose=function(){editor.OnClose();};var buttons=[{text:Spotfire.Localization.resources.Ok,isDefault:true,click:applyAndClose},{text:Spotfire.Localization.resources.Cancel,isCancel:true},{text:Spotfire.Localization.resources.AxisTrayApplyExpression,click:apply}];
dialog=Spotfire.Controls.ModalDialog.initialize($dialog,{title:Spotfire.Localization.resources.CustomExpression,minWidth:593,minHeight:344,height:344,help:showHelp,resizable:true,buttons:buttons,open:onOpen,close:onClose,dialogClass:"CustomExpressionDialog",preventAutoClose:function(){return editor.HasFocus();
}});};var convertPercentageToBinCount=function(percentage){var logStart=9;var binCount;var logValue;if(percentage<=logStart){binCount=(10-1)*(percentage/logStart)+1;
}else{logValue=2*(percentage-logStart)/(100-logStart)+1;binCount=Math.pow(10,logValue);}return Math.round(Math.max(1,Math.min(binCount,1000)));
};var convertBinCountToPercentage=function(binCount){var logStart=9;var value;var logValue;if(binCount<=10){value=Math.round(logStart*(binCount-1)/(10-1));
}else{logValue=Math.log(binCount)/Math.log(10);value=Math.round((logValue-1)/2*(100-logStart)+logStart);
}return Math.max(0,Math.min(value,100));};var attachSlider=function(viewId,$item,itemIndex,callback,horizontal,editMode,initValue,levels,showTooltip){var $container=$item.parent();
var isHierarchySlider=false;var tickCount=1;var pixelLeft;var preventClick=false;if(levels){isHierarchySlider=true;
tickCount=Math.max(0,levels.length-1);}var $slider=$("<div/>").addClass("AxisTraySlider sf-element sf-element-bin-slider");
var $thumb=$("<div/>").addClass("sf-element sf-element-thumb");Spotfire.getSvg("Images/AxisTrayControl/handle.svg",function($svg){$svg.css("position","absolute");
$thumb.prepend($svg);});var getMaxPixelLeft=function(){return $slider.width()-$thumb.width();};var getNormalizedValue=function(){return pixelLeft/getMaxPixelLeft();
};var getLabelIndex=function(){if(!isHierarchySlider){throw"Not a hierarchy slider";}var normalized=getNormalizedValue();
var index=Math.round(normalized*tickCount);return index;};var getValue=function(){if(isHierarchySlider){return getLabelIndex();
}var normalized=getNormalizedValue();var percentage=Math.round(normalized*100);return convertPercentageToBinCount(percentage);
};var moveThumb=function(pos){pixelLeft=Math.max(0,Math.min(pos,getMaxPixelLeft()));var left=pixelLeft;
if(isHierarchySlider){var index=getLabelIndex();left=Math.round((index/tickCount)*getMaxPixelLeft());
$(".sf-element-bin-slider-tick",$slider).each(function(ii,tick){if(ii<index){$(tick).removeClass("sfpc-tick-not-included");
}else{$(tick).addClass("sfpc-tick-not-included");}});}$thumb.css("left",left+"px");};var getPos=function(e){var offset=$slider.offset();
if(horizontal){return e.clientX-offset.left;}return(offset.top+$slider.width())-e.clientY;};var onMouseMove=function(e){moveThumb(getPos(e));
var val=getValue();var text=val;if(isHierarchySlider){var j;text="";for(j=0;j<=val;j++){if(j>0){text+="\u00A0\u00BB\r\n";
}text+=levels[j];}}var offset=$thumb.offset();if(showTooltip===undefined||showTooltip===true){Spotfire.Visuals.Tooltip.showAt(text,offset.left,offset.top);
}};var onMouseUp=function(){Spotfire.Visuals.Tooltip.hide();preventClick=true;callback(getValue());};
var onSliderClick=function(e){if(preventClick){preventClick=false;return;}moveThumb(getPos(e));callback(getValue());
};$slider.click(onSliderClick);if(!isHierarchySlider){var onThumbDblClick=function(){if(Spotfire.isProfessional()){var data={index:itemIndex,position:initValue};
Spotfire.PageBus.publish("spotfire.visuals.axistray.showBinDialog",data,viewId);}else{var result=parseInt(window.prompt(Spotfire.Localization.resources.NumberOfBins,initValue),10);
if(!isNaN(result)){callback(result,true);}}};$thumb.dblclick(onThumbDblClick);}var onLayoutComplete=function(){var leftMargin=5;
var width=Math.max(0,$item.outerWidth()-(leftMargin*2));if(width===0){return;}var left=0;$item.prevAll(".sf-element-axis-tray-item").each(function(){left+=$(this).outerWidth(true);
});$slider.width(width).css("left",(left+leftMargin)+"px");var outerTickWidth=Math.round(width/tickCount);
$(".sf-element-bin-slider-tick",$slider).each(function(j,tick){$(tick).width(outerTickWidth-2).css("left",(outerTickWidth*j)+"px");
});var initPos;if(isHierarchySlider){initPos=Math.round((initValue/(levels.length-1))*getMaxPixelLeft());
}else{var percentage=convertBinCountToPercentage(initValue);initPos=Math.round((percentage/100)*getMaxPixelLeft());
}moveThumb(initPos);Spotfire.Touch.registerTouchEvents($thumb,$.noop,onMouseMove,onMouseUp);};var i,$tick;
for(i=0;i<tickCount;i++){$tick=$("<div/>").addClass("sf-element sf-element-bin-slider-tick");$slider.append($tick);
}$slider.append($thumb);$container.append($slider);$container.bind("layoutComplete",onLayoutComplete);
};function AxisTrayControl($parent,viewId,settings,leftAlign,showColorIndication,expressionFont){var $rotate=$("<div/>").addClass("rotate");
var $container=$("<div/>");var colorIndicators=[];var colorIndicatorGeneration=0;$container.css("position","absolute");
var updateContainerClasses=function(box){$container.attr("class","").addClass("sf-nowrap").addClass(box.classes);
if(!settings.editMode){$container.addClass("sfpc-disabled");}};updateContainerClasses(settings.box);$rotate.append($container);
$parent.append($rotate);var canBeMergedIntoHierarchy;var expression,horizontal,showAddButton,supportsAggregation,editMode,expressionCount;
var allowMultiple,isValid,needsAttention,isParameterized,visualizationId;var isCollapsed=function(){return expressionCount>=4;
};var updateColorIndicators=function(){colorIndicatorGeneration++;if(!_.any(colorIndicators)){return;
}var indexes=[];$.each(colorIndicators,function(index,item){indexes.push(item.index);});Spotfire.Dxp.Web.Forms.AjaxService.Read(viewId,"GetColor",JSON.stringify({indexes:indexes,generation:colorIndicatorGeneration}),function(data){if(colorIndicators.length!==data.items.length||data.generation!==colorIndicatorGeneration){return;
}$.each(colorIndicators,function(index,uiItem){var item;$.each(data.items,function(dataIndex,dataItem){if(dataItem.index===uiItem.index){item=dataItem;
return;}});if(item){uiItem.element.css({"background-color":item.color,"border-color":item.borderColor});
}});});};var createTextItem=function(text,itemBox,hasColor,itemIndex){var $item=$("<div/>").attr("title",text);
var $colorDivContainer=$("<div/>").addClass("itemColorContainer");var $colorDiv=$("<div/>").addClass("itemColor");
$item.append($colorDivContainer.append($colorDiv));if(showColorIndication&&hasColor){colorIndicators.push({index:itemIndex,element:$colorDiv});
}else{$colorDiv.css("display","none");}var $text=$("<div/>").addClass("itemText").text(text);$item.append($text);
if(itemBox){$item.addClass(itemBox.classes);var textBox=itemBox.text;$text.addClass(textBox.classes);
}if(editMode){$item.addClass("itemEditable");}return $item;};var publishShowContextMenu=function(e,index){if(!e.ctrlKey){if(index===undefined){index=-1;
}var args={viewId:viewId,index:index,pointOnPage:new Point(e.pageX,e.pageY)};Spotfire.PageBus.publish("spotfire.visuals.showcontextmenu",args);
e.stopPropagation();e.preventDefault();}return false;};var createItem=function(item,showDropDown,itemBox){var index=item.index;
var text=item.text;var $item=createTextItem(text,itemBox,item.hasColor,index);$item.addClass("sf-nowrap");
if(item.isPlusItem){Spotfire.getSvg("Images/AxisTrayControl/Plus.svg",function($svg){$svg.css("fill","currentColor");
$svg.css("vertical-align","middle");$(".itemText",$item).html($svg);});}if(editMode&&!item.isPlusItem&&Spotfire.isProfessional()){$item.bind("contextmenu",function(e){publishShowContextMenu(e,item.index);
});}if(showDropDown){if(itemBox){var button=itemBox.button;var $arrow=$("<div/>").addClass(button.classes);
$arrow.css({width:"7px",height:"4px"});Spotfire.getSvg("Images/AxisTrayControl/DownArrow.svg",function($svg){$svg.css("vertical-align","middle");
$arrow.append($svg);});$item.append($arrow);}var showAxisSelector=function(e){var offset=$item.offset();
$(document).trigger("onShowAxisSelector",$parent.selector);var minOffset=3;var popoutSettings={left:Math.round(offset.left+(horizontal?0:$item.height()+minOffset)),top:Math.round(offset.top+(horizontal?$item.height()+minOffset:0)),horizontal:horizontal,supportsAggregation:supportsAggregation};
Spotfire.PageBus.publish("spotfire.visuals.axistray.showpopout",{index:index,isCollapsed:isCollapsed(),popoutSettings:popoutSettings},viewId);
e.stopPropagation();};$item.click(showAxisSelector);}$container.append($item);if(item.qualifiedExpression){Spotfire.DragDrop.makeDraggable($item,{effectAllowed:"copyMove",populateData:function(data){data.columnNames=[item.qualifiedExpression];
data.viewId=viewId;data.draggedItemIndex=index;data.isCollapsed=item.isCollapsed||false;data.visualizationId=visualizationId;
},dragInProgressClass:"sfpc-highlight-axis-trays"});if(editMode&&!isParameterized){$item.addClass("dropEnabled");
}}if(isParameterized){return $item;}if(item.binCount!==undefined){var onBinCountChanged=function(n,dblClick){var args={index:index,value:n,dblClick:dblClick?true:false};
Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,"SetBinCount",JSON.stringify(args));};attachSlider(viewId,$item,index,onBinCountChanged,horizontal,editMode,item.binCount,null,item.showSlider);
}if(item.pruneLevel!==undefined){var onPruneLevelChanged=function(n){var args={index:index,value:n};Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,"SetPruneLevel",JSON.stringify(args));
};attachSlider(viewId,$item,index,onPruneLevelChanged,horizontal,editMode,item.pruneLevel,item.levels);
}if(item.timeLevel!==undefined){var onTimeLevelChanged=function(n){var args={index:index,value:n};Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,"SetTimeLevel",JSON.stringify(args));
};attachSlider(viewId,$item,index,onTimeLevelChanged,horizontal,editMode,item.timeLevel,item.levels);
}return $item;};var createItems=function(items,itemBoxes,axisExpression){$container.empty();var showDropDown=editMode&&!isParameterized;
var isEmpty=expressionCount===0;if(isCollapsed()){var collapsedItem={isCollapsed:true,qualifiedExpression:axisExpression,index:0,text:expressionCount+" "+Spotfire.Localization.resources.AxisTrayCollapsedColumns};
createItem(collapsedItem,editMode,itemBoxes[0]);}else{$.each(items,function(i,item){createItem(item,showDropDown,itemBoxes[i]);
});}if(editMode){if(!isParameterized){var appendAddButton=showAddButton&&(!isEmpty||isCollapsed());if(appendAddButton){var plusItem={isPlusItem:true,index:expressionCount,text:"+"};
var $plusItem=createItem(plusItem,true,itemBoxes[0]);$plusItem.addClass(itemBoxes.addButtonClass);}Spotfire.DragDrop.removeDroppable($container);
Spotfire.DragDrop.makeDroppableWithOverlay($container,function(){return true;},Spotfire.Visuals.AxisTrayControl.createDropHandler($container,viewId,horizontal,appendAddButton,visualizationId));
}var showContextMenu=function(e){var menuItems=[];var removeAllItem={text:Spotfire.Localization.resources.AxisTrayRemoveAll,enabled:true,onClick:function(){Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,"RemoveAll","");
}};menuItems.push(removeAllItem);if(allowMultiple&&!isParameterized){menuItems.push(createSelectColumnsMenuItem(viewId));
}if(canBeMergedIntoHierarchy&&!isParameterized){var mergeIntoHierarchyItem={text:Spotfire.Localization.resources.AxisTrayMergeIntoHierarchy,enabled:true,onClick:function(){Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,"MergeIntoHierarchy","");
}};menuItems.push(mergeIntoHierarchyItem);}var customExpressionItem={text:Spotfire.Localization.resources.AxisTrayCustomExpression,enabled:true,onClick:function(){showCustomExpressionDialog(viewId,expression,expressionFont);
}};menuItems.push(customExpressionItem);var menu=Spotfire.Controls.ContextMenu.create(menuItems,function(item){item.onClick();
return true;});menu.show(e.pageX,e.pageY);return false;};$container.off("contextmenu");$container.on("contextmenu",Spotfire.isWebPlayer()?showContextMenu:publishShowContextMenu);
}};var performLayout=function(){var w=horizontal?$parent.width():$parent.height();var h=horizontal?$parent.height():$parent.width();
$rotate.width(w);$rotate.height(h);if(!horizontal){$rotate.addClass("rotate270deg");var h2=Math.round(h/2);
var w2=Math.round(w/2);$rotate.css("margin-left",(h2-w2)+"px");$rotate.css("margin-top",(w2-h2)+"px");
}var $items=$(".sf-element-axis-tray-item",$container);$(".itemText",$items).css("max-width","");var totalItemWidth=0;
$items.each(function(){totalItemWidth+=$(this).outerWidth(true);});var overflow=totalItemWidth-w;if(overflow>0){var $texts=$(".itemText",$items);
var textWidths=$.map($texts,function(item){return $(item).width();});var adjustedMaxWidth=Spotfire.Visuals.AxisTrayControl.calculateMaxWidthPerItem(textWidths,overflow);
$texts.css("max-width",adjustedMaxWidth);}if(!leftAlign){var leftMargin=Math.round((w-$container.width())/2);
$container.css("left",leftMargin+"px");}if(isValid){if($items.hasClass("sfc-axis-tray-item-error")){$items.removeClass("sfc-axis-tray-item-error");
}}else{$items.addClass("sfc-axis-tray-item-error");}if(!needsAttention){if($items.hasClass("sfc-axis-tray-item-needs-attention")){$items.removeClass("sfc-axis-tray-item-needs-attention");
}}else{$items.addClass("sfc-axis-tray-item-needs-attention");}$container.trigger("layoutComplete");};
var currentSettingsJson="";var update=function(updatedSettings){var updatedSettingsJson=JSON.stringify(updatedSettings);
if(currentSettingsJson!==updatedSettingsJson){expression=updatedSettings.expression;horizontal=updatedSettings.horizontal;
showAddButton=updatedSettings.showAddButton;supportsAggregation=updatedSettings.supportsAggregation;editMode=updatedSettings.editMode;
expressionCount=updatedSettings.expressionCount;allowMultiple=updatedSettings.allowMultiple;canBeMergedIntoHierarchy=updatedSettings.canBeMergedIntoHierarchy;
isValid=updatedSettings.isValid;needsAttention=updatedSettings.needsAttention;isParameterized=updatedSettings.isParameterized;
visualizationId=updatedSettings.visualizationId;updateContainerClasses(updatedSettings.box);createItems(updatedSettings.items,updatedSettings.box.children,expression);
performLayout();}var hasColors=_.any(updatedSettings.items,function(item){return item.hasColor;});if(hasColors){updateColorIndicators();
}currentSettingsJson=updatedSettingsJson;};$parent.bind("shown",performLayout);return{update:update};
}var createDropHandler=function($container,viewId,horizontal,considerPlusButton,visualizationId){var dropHandler=function(event,data,$indicator){var indicatorWidth=3;
var snapRadius=10;var positionLeftNoMargin=function($element){if(horizontal){return $element.position().left;
}var topWithMargin=$element.position().top-parseInt($element.css("margin-right"),10);return($element.parent().width()-topWithMargin-$element.outerWidth(true));
};var $children=$container.children().filter(".sf-element-axis-tray-item");if($children.length>1){var $first=$children.eq(0);
var $second=$children.eq(1);indicatorWidth=positionLeftNoMargin($second)-(positionLeftNoMargin($first)+$first.outerWidth());
}$indicator.css({position:"absolute",width:indicatorWidth+"px",height:"100%"});$indicator.addClass("dropBetweenIndicator");
var dropSegments=[];var lastIndex=$children.length-1;var draggedItemIndex=data?data.draggedItemIndex:-1;
var isMove=data?(data.viewId===viewId):false;$children.each(function(index){var $this=$(this);var width=$this.outerWidth(true);
var leftNoMargin=positionLeftNoMargin($this);var pushDropSegment=function(seg){seg.index=index;seg.item=$this;
dropSegments.push(seg);};var movingPrevItem=isMove&&(draggedItemIndex===(index-1));var movingThisItem=isMove&&(draggedItemIndex===index);
var movingNextItem=isMove&&(draggedItemIndex===(index+1));if(considerPlusButton&&index===lastIndex){if(movingPrevItem){pushDropSegment({x:leftNoMargin+width});
}else{pushDropSegment({x:leftNoMargin+width,snapBefore:true});}}else{if(movingThisItem){pushDropSegment({x:leftNoMargin+width});
}else{if(movingPrevItem){pushDropSegment({x:leftNoMargin+width,snapAfter:true});}else{if(movingNextItem){pushDropSegment({x:leftNoMargin+width,snapBefore:true});
}else{if(isMove){pushDropSegment({x:leftNoMargin+width/2,snapBefore:true});pushDropSegment({x:leftNoMargin+width,snapAfter:true});
}else{pushDropSegment({x:leftNoMargin+snapRadius,snapBefore:true});pushDropSegment({x:leftNoMargin+width-snapRadius,snapOnto:true});
pushDropSegment({x:leftNoMargin+width,snapAfter:true});}}}}}});dropSegments.sort(function(a,b){return a.x-b.x;
});var getDropSegment=function(e){var offset=$container.offset();var x;var i;if(horizontal){x=e.pageX-offset.left;
}else{x=offset.top+$container.width()-e.pageY;}for(i=0;i<dropSegments.length;i++){if(x<dropSegments[i].x){return dropSegments[i];
}}return null;};var updateHoverEffect=function(dropSegment){var ds=dropSegment;ds.item.siblings().removeClass("dragDropHover");
if(ds.snapBefore||ds.snapAfter){var $item=ds.item;var $e=ds.snapBefore?$item.prevAll(".sf-element-axis-tray-item").first():$item;
var left=$e.length===0?0:Math.max(0,positionLeftNoMargin($e)+$e.outerWidth(true)-parseInt($e.css("margin-right"),10));
$indicator.css("left",left+"px");$indicator.show();ds.item.removeClass("dragDropHover");}else{$indicator.hide();
if(ds.snapOnto){ds.item.addClass("dragDropHover");}}};var onDragOver=function(e){var ds=getDropSegment(e);
if(data===undefined||data===null||ds===undefined||ds===null){return;}updateHoverEffect(ds);if(ds.snapOnto||ds.snapAfter||ds.snapBefore){var isMoveEffect=isMove||(visualizationId===data.visualizationId);
e.originalEvent.dataTransfer.dropEffect=isMoveEffect?"move":"copy";}else{e.originalEvent.dataTransfer.dropEffect="none";
}};var onDrop=function(e){$container.children().removeClass("dragDropHover");var ds=getDropSegment(e);
if(data===undefined||data===null||ds===undefined||ds===null){return;}if(isMove){if(ds.snapBefore||ds.snapAfter||ds.snapOnto){var targetIndex=ds.snapBefore?ds.index:ds.index+1;
Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,"MoveExpression",JSON.stringify({sourceIndex:data.draggedItemIndex,targetIndex:targetIndex}));
}}else{var args={axisIndex:ds.snapAfter?ds.index+1:ds.index,droppedData:data,insert:ds.snapBefore||ds.snapAfter};
Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,"HandleDrop",JSON.stringify(args));}};var onDragLeave=function(){$container.children().removeClass("dragDropHover");
};return{onDragOver:onDragOver,onDrop:onDrop,onDragLeave:onDragLeave};};return dropHandler;};var calculateMaxWidthPerItem=function(widthList,overflow){var sumWithMax=function(max){return _.reduce(widthList,function(memo,width){return memo+Math.min(width,max);
},0);};var maxWidth=_.max(widthList);var targetTotalWidth=sumWithMax(maxWidth)-overflow;while(maxWidth>0&&sumWithMax(maxWidth)>targetTotalWidth){maxWidth--;
}return maxWidth;};Spotfire.Visuals.AxisTrayControl.initialize=function(parentSelector,viewId,settings,leftAlign,isInVisualization,expressionFont){var $parent=$(parentSelector).attr("viewId",viewId).empty();
var trayControl=new AxisTrayControl($parent,viewId,settings,leftAlign,isInVisualization,expressionFont);
$parent.data("trayControl",trayControl);trayControl.update(settings);};Spotfire.Visuals.AxisTrayControl.update=function(viewId,settings){var $parent=$("[viewId="+viewId+"]");
var trayControl=$parent.data("trayControl");if(trayControl){trayControl.update(settings);}Spotfire.Visuals.AxisExpressionPopout.update(viewId);
};Spotfire.Visuals.AxisTrayControl.createDropHandler=createDropHandler;Spotfire.Visuals.AxisTrayControl.calculateMaxWidthPerItem=calculateMaxWidthPerItem;
});$(function(){Spotfire.registerNameSpace("Boldchat");Spotfire.Boldchat.open=function(username,accountId,chatWindowId,preChatWindowId,websiteId,currentUserLocation){var openChat=function(currentUser){var email="";
var realName="";var homeFolderUrl="";if(currentUser){realName=currentUser.firstname+"%20"+currentUser.lastname;
email=currentUser.email;homeFolderUrl=currentUser.homeFolderUrl;}else{realName=username;}var url="https://livechat.boldchat.com/aid/"+accountId+"/bc.chat?resize=true&cwdid="+(email!==""?chatWindowId:preChatWindowId)+"&wdid="+websiteId+"&url="+encodeURI($(location).attr("href"))+"&curl="+homeFolderUrl+"&vn="+realName+"&ve="+email+"&vr="+username+"&curl="+encodeURI(homeFolderUrl);
var width=500,height=450,left=($(window).width()-width)/2,top=($(window).height()-height)/2,opts="status=1,resizable=1,,width="+width+",height="+height+",top="+top+",left="+left;
window.open(url,"Chat support",opts);};$.ajax({url:currentUserLocation,type:"post",data:{},headers:{"X-Requested-With":"XMLHttpRequest","Content-Type":"application/json"},dataType:"json",error:openChat,success:function(data){openChat(data.d?data.d.currentUser:null);
}});};});$(function(){Spotfire.registerNameSpace("BookmarkPanel");Spotfire.BookmarkPanel.initialize=function($parent){$parent.empty();
if(!(Spotfire.BookmarkPanel.accessRights&&Spotfire.BookmarkPanel.eachComponent)){throw"BookmarkPanel not properly initialized";
}var isEditing=false;var pendingBookmarkUpdate=null;var pendingBookmarkSync=false;var $captureContainer=$("<div></div>").addClass("sf-element sf-element-bookmark-capture");
var $captureButton=$("<div></div>").addClass("sf-element sf-element-button");$captureButton.attr("title",Spotfire.Localization.resources.BookmarksAddBookmark);
Spotfire.getSvg("Images/Bookmarks/BookmarkAdd.svg",function($svg){$svg.css("shape-rendering","crispEdges");
$captureButton.append($svg);});var input;var $input=$("<input type='text'/>").addClass("sf-element sf-element-input");
$captureContainer.append($input);$captureContainer.append($captureButton);var $list=$("<div></div>").addClass("sf-element sf-element-bookmark-list");
$list.css("overflow-y","auto");$list.css("overflow-x","hidden");var nameOfBookmarkToCreate="";var captureBookmark=function(){BookmarkService.CaptureBookmark(nameOfBookmarkToCreate);
input.element().val("");input.element().trigger("change");nameOfBookmarkToCreate="";};var onInputChanged=function(text){nameOfBookmarkToCreate=text;
};input=Spotfire.Controls.InputField.initializeWithTimeout($input,Spotfire.Localization.resources.BookmarksInputDefault,onInputChanged,0);
var onKeyUp=function(event){if(event.which===Keys.RETURN){captureBookmark();}};$captureButton.on("click",captureBookmark);
if(Spotfire.isProfessional){$captureButton.on("contextmenu",function(e){var pos=$captureButton.offset();
Spotfire.PageBus.publish("spotfire.visuals.bookmark.showadddropdownmenu",{x:pos.left,y:pos.top});e.preventDefault();
});}input.element().on("keyup",onKeyUp);$parent.append($captureContainer);var captureButtonPbmHeight=$captureButton.outerHeight(true)-$captureButton.height();
var size=input.element().outerHeight(true)-captureButtonPbmHeight;$captureButton.css({width:size,height:size});
if(Spotfire.BookmarkPanel.accessRights.canCreate){$captureContainer.show();}else{$captureContainer.hide();
}$parent.append($list);var scrollbar=$list.StyledScrollbar({cssClass:"BookmarkScroll"});if(Spotfire.isProfessional){Spotfire.Focus.handleKeyDown($parent,function(e){if(e.keyCode===Keys.F1){Spotfire.PageBus.publish("spotfire.visuals.bookmark.showhelp",{});
}});}var resize=function(width,height){var captureContainerPbmWidth=$captureContainer.outerWidth(true)-$captureContainer.width();
var captureContainerWidth=width-captureContainerPbmWidth;$captureContainer.width(captureContainerWidth);
var mobileInputMargin=Spotfire.capabilities.supportsTouch()?8:0;var inputPbmWidth=input.element().outerWidth(true)-input.element().width();
input.element().width(Math.max(0,captureContainerWidth-inputPbmWidth-$captureButton.outerWidth(true)-mobileInputMargin));
var listPbmWidth=$list.outerWidth(true)-$list.width();width=width-listPbmWidth;$list.width(width);listPbmWidth=$list.outerHeight(true)-$list.height();
var captureContainerHeight=$captureContainer.is(":visible")?$captureContainer.outerHeight(true):0;$list.height(height-captureContainerHeight-listPbmWidth);
var labelWidth=width-52-scrollbar.getVScrollbarSize();$(".shouldExpand",$list).width(function(index,currentWidth){var $item=$(this);
var labelPbm=$item.outerWidth(true)-$item.width();$item.width(labelWidth-labelPbm);});$.each($(".sf-element-title",$list),function(i,elem){var $label=$(elem);
var text=$label.attr("title");$label.sfSetTextWithEllipsis(text,2);});$.each($(".sf-element-text-box",$list),function(i,elem){var label=$(elem);
var text=label.attr("title");label.text(text);});};var performLayout=function(){resize($parent.width(),$parent.height());
if(Spotfire.capabilities.supportsTouch()){$.each($(".bookmarkDropDownButton",$parent),function(i,button){Touch.addTouchTarget(button,15,15,15,15);
});}scrollbar.refresh();};var applyBookmark=function(bookmark,components){$parent.trigger("popupClose");
BookmarkService.ApplyBookmark({BookmarkId:bookmark.Id,value:components});};var editBookmarkElement=function($element,bookmark){isEditing=true;
$element.empty();$element.unbind();$element.addClass("renamedItem");var $icon=createBookmarkIconElement(bookmark);
$element.append($icon);var $editContainer=$("<div />").css({display:"inline-block",position:"relative","vertical-align":"top",color:"black"});
$element.append($editContainer);var $textarea=$("<textarea></textarea>").val(bookmark.Name).attr("rows","4");
$editContainer.append($textarea);$textarea.width($element.width()-$icon.outerWidth(true)-20);var close=function(){$(document.body).unbind("mousedown",onBodyMouseDown);
$element.replaceWith(createBookmarkElement(bookmark));performLayout();isEditing=false;if(pendingBookmarkUpdate){update(pendingBookmarkUpdate,pendingBookmarkSync);
pendingBookmarkUpdate=null;}};var save=function(){var name=$.trim($textarea.val());if(name===""){return;
}BookmarkService.EditBookmark({BookmarkId:bookmark.Id,Value:name});close();};var createButton=function(){var button=$("<input type='button'/>").css({"float":"right",padding:"1px 10px 1px 10px","border-radius":"3px"});
return button;};var saveButton=createButton();saveButton.val(Spotfire.Localization.resources.BookmarksSave);
saveButton.attr("title",Spotfire.Localization.resources.BookmarksSave);var cancelButton=createButton().css({"margin-left":"10px"});
cancelButton.val(Spotfire.Localization.resources.BookmarksCancel);cancelButton.attr("title",Spotfire.Localization.resources.BookmarksCancel);
saveButton.click(save);cancelButton.click(close);$textarea.keydown(function(event){if(event.which===Keys.RETURN){save();
}if(event.which===Keys.ESCAPE){close();}});var $buttonDiv=$("<div />").css({padding:"3px 0px 3px 0px"});
$buttonDiv.append(cancelButton).append(saveButton);$editContainer.append($buttonDiv);var onBodyMouseDown=function(event){var target=$(event.target);
while(true){if(target.length===0||target.is(document.body)){break;}if(target.is(".renamedItem")){return;
}target=target.parent();}close();};$(document.body).bind("mousedown",onBodyMouseDown);$textarea.select();
performLayout();};var $dropdownItem=null;var dropDownBookmark=null;var showDropDownMenu=function($itemElement,$button,bookmark,position){var pos=position||$button.offset();
if(Spotfire.isProfessional()){$dropdownItem=$itemElement;dropDownBookmark=bookmark;var location={top:pos.top,left:pos.left};
Spotfire.PageBus.publish("spotfire.visuals.bookmark.showdropdownmenu",{location:location,bookmarkId:bookmark.Id});
return;}var specials=[];Spotfire.BookmarkPanel.eachComponent(function(displayName,componentValue){specials.push({text:displayName,tag:"applySpecial",component:componentValue,enabled:(bookmark.Components&componentValue)!==0});
});var isModifiable=bookmark.Modifiable;var canCreate=Spotfire.BookmarkPanel.accessRights.canCreate;var canPublish=isModifiable&&Spotfire.BookmarkPanel.accessRights.canPublish;
var canModify=isModifiable&&canCreate;var settings=Spotfire.BookmarkPanel.settings;var tools=[];$.each(bookmark.Tools,function(i,tool){tools.push({text:tool.DisplayName,tag:"shareTool",enabled:true,toolId:tool.ToolId});
});var items=[{text:Spotfire.Localization.resources.BookmarksApply,tag:"apply",enabled:true},{text:Spotfire.Localization.resources.BookmarksApplySpecial,enabled:true,children:specials},{separator:true},{text:Spotfire.Localization.resources.BookmarksRename,tag:"rename",enabled:canModify},{text:Spotfire.Localization.resources.BookmarksCopyUrl,tag:"copyUrl",enabled:settings.isSaved}];
if(tools.length>0){items.push({text:Spotfire.Localization.resources.Share,enabled:true,children:tools});
}items.push({separator:true},{text:Spotfire.Localization.resources.BookmarksPrivate,tag:"setPrivate",enabled:canModify,checked:!bookmark.IsPublic},{text:Spotfire.Localization.resources.BookmarksPublic,tag:"setPublic",enabled:canPublish,checked:bookmark.IsPublic},{separator:true},{text:Spotfire.Localization.resources.BookmarksSavePrivate,tag:"savePrivateCopy",enabled:canCreate},{text:Spotfire.Localization.resources.BookmarksUpdate,tag:"update",enabled:canModify},{text:Spotfire.Localization.resources.BookmarksDelete,tag:"delete",enabled:canModify});
var onMenuItemClick=function(item){switch(item.tag){case"apply":applyBookmark(bookmark,-1);break;case"applySpecial":applyBookmark(bookmark,item.component);
break;case"rename":editBookmarkElement($itemElement,bookmark);break;case"setPrivate":BookmarkService.SetBookmarkPrivate(bookmark.Id);
break;case"setPublic":BookmarkService.SetBookmarkPublic(bookmark.Id);break;case"delete":if(window.confirm(Spotfire.Localization.resources.BookmarksConfirmDeletion)){BookmarkService.DeleteBookmark(bookmark.Id);
}break;case"savePrivateCopy":BookmarkService.SavePrivateCopy(bookmark.Id);break;case"update":BookmarkService.UpdateBookmark(bookmark.Id);
break;case"copyUrl":BookmarkService.CopyBookmarkUrl(bookmark.Id);break;case"shareTool":BookmarkService.InvokeShareTool({ToolId:item.toolId,BookmarkId:bookmark.Id});
break;default:break;}return true;};var menu=Spotfire.Controls.ContextMenu.create(items,onMenuItemClick);
menu.show(pos.left,pos.top+$button.height());};var createBookmarkIconElement=function(bookmark){var $icon=$("<div class='sf-element-icon'></div>");
if(bookmark.IsPublic){Spotfire.getSvg("Images/Bookmarks/TripleBust_16x16.svg",function($svg){$icon.append($svg);
});}else{Spotfire.getSvg("Images/Bookmarks/Bust_16x16.svg",function($svg){$icon.append($svg);});}return $icon;
};var createBookmarkElement=function(bookmark){var $item=$("<div class='sf-element-bookmark-item'></div>");
$item.click(function(){applyBookmark(bookmark,-1);});var $label=$("<div class='sf-element-bookmark-label'></div>");
$label.addClass("shouldExpand");var $title=$("<div class='sf-element-title'></div>");var $author=$("<div class='sf-element-text-box'></div>");
$title.text(bookmark.Name);$title.attr("title",bookmark.Name);var text="";if(bookmark.Author!==undefined){text+=bookmark.Author+", ";
}text+=bookmark.Modified;$author.text(text);$author.attr("title",text);$label.append($title);$label.append($author);
$item.append(createBookmarkIconElement(bookmark));$item.append($label);var $button=$("<div class='bookmarkDropDownButton sf-element-button'></div>");
Spotfire.getSvg("Images/Bookmarks/DownArrow.svg",function($svg){$button.append($svg);});var onDropDownButtonClick=function(event){showDropDownMenu($item,$button,bookmark);
event.stopPropagation();};$button.click(onDropDownButtonClick);$item.append($button);$item.on("contextmenu",function(e){e.preventDefault();
var position={top:e.pageY,left:e.pageX};showDropDownMenu($item,$button,bookmark,position);});return $item;
};var update=function(bookmarks,pendingSync){if(isEditing){pendingBookmarkUpdate=bookmarks;pendingBookmarkSync=pendingSync;
return;}ProgressBlocker.block($parent);$list.empty();if(pendingSync){var $item=$("<div class='sf-element-bookmark-item sf-element-bookmark-synchronizing'></div>");
var $progress=$("<div class='sf-svg-loader-16x16'></div>");$list.append($item.append($progress));Spotfire.getSvg("Images/Progress/CircularProgressAnimation.svg",function($svg){$progress.append($svg);
});}$.each(bookmarks,function(i,bookmark){$list.append(createBookmarkElement(bookmark));});performLayout();
Spotfire.BookmarkPanel.alertChanges(false);ProgressBlocker.unblock($parent);};performLayout();$parent.bind("panelResize",performLayout);
Spotfire.BookmarkPanel.updateCallback=update;Spotfire.BookmarkPanel.renameCurrentBookmark=function(){editBookmarkElement($dropdownItem,dropDownBookmark);
};ProgressBlocker.block($parent);BookmarkService.GetBookmarks();};Spotfire.BookmarkPanel.update=function(bookmarks,settings){Spotfire.BookmarkPanel.settings=settings;
if(Spotfire.BookmarkPanel.updateCallback){Spotfire.BookmarkPanel.updateCallback(bookmarks.Bookmarks,bookmarks.PendingSync);
}};Spotfire.BookmarkPanel.showCopyBookmarkUrlDialog=function(webPlayerUrl){var container=$("<div></div>");
container.css({overflow:"hidden"});var label2=$("<div></div>");label2.text(Spotfire.Localization.resources.LinkToBookmark);
container.append(label2);var field2=$("<input type='text'/>").addClass("sf-element-input");field2.val(webPlayerUrl);
field2.css({width:"100%","box-sizing":"border-box"});container.append(field2);var onFocus=function(){$(this).select();
};field2.click(onFocus);var buttons=[{text:Spotfire.Localization.resources.BookmarksClose,isDefault:true}];
var options={title:Spotfire.Localization.resources.CopyUrlTitle,modal:true,resizable:true,buttons:buttons,width:300,height:150,minWidth:300,minHeight:200};
Spotfire.Controls.ModalDialog.initialize(container,options);};Spotfire.BookmarkPanel.initializeAccessRights=function(canCreate,canPublish){Spotfire.BookmarkPanel.accessRights={canCreate:canCreate,canPublish:canPublish};
};Spotfire.BookmarkPanel.updateAccessRights=function(canCreate,canPublish){Spotfire.BookmarkPanel.accessRights={canCreate:canCreate,canPublish:canPublish};
var $captureContainer=$(".sf-element-bookmark-capture");if($captureContainer.length>0){if(canCreate){$captureContainer.show();
}else{$captureContainer.hide();}}};Spotfire.BookmarkPanel.initializeComponents=function(flags,displayNames){Spotfire.BookmarkPanel.eachComponent=function(callback){var i=0;
var flag;for(flag in flags){if(typeof flag==="string"){callback(displayNames[i],flags[flag]);i++;}}};
};Spotfire.BookmarkPanel.showErrorDialog=function(title,message){var container=$("<div></div>");var label1=$("<div></div>");
label1.text(message);container.append(label1);var buttons=[{text:Spotfire.Localization.resources.BookmarksClose,isDefault:true}];
var options={title:title,modal:true,buttons:buttons,width:300,height:200,resizable:false};Spotfire.Controls.ModalDialog.initialize(container,options);
};Spotfire.BookmarkPanel.alertChanges=function(showIndication){var status=Spotfire.PopoverPanel.getState("Spotfire.BookmarkPanel2");
if(!status||status.IsDocked){return;}if(showIndication===undefined){showIndication=true;}var tooltip=showIndication?Spotfire.Localization.resources.BookmarksChanges:Spotfire.Localization.resources.BookmarksHeader;
var $button=$("#"+status.ButtonId).attr("title",tooltip);$(".WP-BookmarksUpdated",$button).remove();if(showIndication){var $plus=$("<div/>").addClass("WP-BookmarksUpdated");
if(Spotfire.isAuthorMode()){$(".toolBarImage",$button).append($plus);}else{$button.append($plus);}}};
});$(function(){Spotfire.registerNameSpace("Visuals.BoxEditor");var wrapTitle=function($e,title,titleClassName){titleClassName=titleClassName||"";
return Spotfire.Flex.item({container:"vertical"}).append(Spotfire.Flex.item().text(title).addClass(titleClassName),Spotfire.Flex.item().append($e));
};Spotfire.Visuals.BoxEditor.colorField=function(){var $wrapper=$("<div/>").addClass("colorButtonWrapper");
var $inputElement=$("<input type='button'/>").addClass("colorButton");$wrapper.append($inputElement);
var instance;var element=function(){return $wrapper;};var picker=Spotfire.Picker.createColorPicker($inputElement);
instance={value:function(value){if(value===undefined){return picker.value();}picker.value(value);return instance;
},element:element,onChange:function(callback){picker.onChange(callback);return instance;}};instance.value("rgb(0, 0, 0)");
return instance;};Spotfire.Visuals.BoxEditor.intSpinner=function(){var changeTimer;var options={};var onChange=$.noop;
var $inputElement=$("<input/>");var spinner;var instance;var defaultValue=0;var mostRecentValidValue=defaultValue;
var setValue=function(value){if(changeTimer&&$inputElement.is(":focus")){return;}spinner.spinner("value",value);
};var getValue=function(){return spinner.spinner("value");};var isValidValue=function(value){var min=spinner.spinner("option","min");
var max=spinner.spinner("option","max");if(value===null||value===undefined){return false;}if(!value.toString().match(/^[\-]?[0-9]+$/)){return false;
}if(value<min||value>max){return false;}return true;};var updateValidityIndication=function(){var valueString=$inputElement.val();
var isValidString=isValidValue(valueString);$inputElement.css({color:isValidString?"":"red"});};var spinnerChanged=function(){var value=getValue();
var isValid=isValidValue(value);if(isValid){mostRecentValidValue=value;onChange();if(changeTimer){clearTimeout(changeTimer);
}changeTimer=setTimeout(function(){changeTimer=null;},1000);}updateValidityIndication();};var settings=$.extend({},options,{start:function(event){if(event.originalEvent.type==="keydown"){switch(event.which){case $.ui.keyCode.PAGE_UP:case $.ui.keyCode.PAGE_DOWN:case $.ui.keyCode.UP:case $.ui.keyCode.DOWN:case $.ui.keyCode.ENTER:return true;
}return false;}return true;},change:spinnerChanged,stop:spinnerChanged,min:0,max:999});$("<div/>").append($inputElement);
spinner=$inputElement.spinner(settings);$inputElement.width(20);$inputElement.on("keyup",updateValidityIndication);
instance={value:function(val){if(val===undefined){return mostRecentValidValue;}setValue(val);return instance;
},element:function(){return $inputElement.parents(".ui-spinner").eq(0);},onChange:function(callback){onChange=callback;
return instance;}};instance.value(defaultValue);return instance;};Spotfire.Visuals.BoxEditor.radioAccordion=function($element,settings){var isUpdating=false;
var items=settings.items;var groupName=settings.groupName;var $radioAccordion=Spotfire.Flex.item({container:"vertical"}).addClass("RadioAccordion");
var radioButtons=[];$.each(items,function(index,radioItem){var title=radioItem.title;var onActive=radioItem.onActive;
var content=radioItem.content;var disabled=radioItem.disabled;if(content){content.addClass("Item");}var $content=Spotfire.Flex.item().attr("name","content").append(radioItem.content).hide();
var $radioButton=$("<input type='radio' name='"+groupName+"'/>");var changeFunction=function(){$radioButton.prop("checked",true);
$radioAccordion.find("[name='content']").hide();$content.show();if(!isUpdating){onActive();}};var titleItem=Spotfire.Flex.item().text(title);
var radioRow=Spotfire.Flex.item({container:"horizontal","align-items":"center"}).addClass("ItemTitle").append($radioButton,titleItem);
if(disabled){$radioButton.attr("disabled",disabled);titleItem.addClass("DisabledLabel");}else{$radioButton.change(changeFunction);
titleItem.click(changeFunction);}radioRow.css("cursor","pointer");$radioAccordion.append(radioRow,Spotfire.Flex.item({container:"horizontal"}).append(Spotfire.Flex.item().addClass("Indent"),$content));
Spotfire.Filters.StyledFilters.createStyledInput($radioButton,13,13,{opacity:"0",display:"none"});radioButtons.push($radioButton);
});$element.addClass("Control").append($radioAccordion);return{selected:function(index){isUpdating=true;
if(!radioButtons[index].prop("checked")){radioButtons[index].prop("checked",true).trigger("change");}isUpdating=false;
}};};Spotfire.Visuals.BoxEditor.expander=function($expandedContent,$collapsedContent){var isExpanded=true;
var onChanged=$.noop;var $toggler;var $collapseSvg;var $expandSvg;var $collapsedContainer=$("<div/>");
var $expandedContainer=$("<div/>");var update=function(){if(isExpanded){$collapsedContainer.hide();$collapseSvg.hide();
$expandedContainer.show();$expandSvg.show();}else{$expandedContainer.hide();$expandSvg.hide();$collapsedContainer.show();
$collapseSvg.show();}onChanged(isExpanded);};var expanded=function(isExpandedParam){if(isExpandedParam!==undefined){isExpanded=isExpandedParam;
update();}return isExpanded;};$toggler=Spotfire.Flex.item().click(function(){expanded(!isExpanded);});
var collapseSvgPath="Images/Buttons/HorizontalCollapse.svg";var expandSvgPath="Images/Buttons/HorizontalExpand.svg";
$collapseSvg=$("<div/>").addClass("sf-element-style-editor expandButton");$expandSvg=$("<div/>").addClass("sf-element-style-editor expandButton");
Spotfire.getSvg(collapseSvgPath,function($svg){$collapseSvg.append($svg);});Spotfire.getSvg(expandSvgPath,function($svg){$expandSvg.append($svg);
});$toggler.append($collapseSvg);$toggler.append($expandSvg);var $element=Spotfire.Flex.item({container:"horizontal","align-items":"end"}).append($collapsedContainer.append($collapsedContent),$expandedContainer.append($expandedContent),$toggler.addClass("Item"));
return{expanded:expanded,onChanged:function(callback){onChanged=callback;},element:function(){return $element;
}};};Spotfire.Visuals.BoxEditor.itemsExpander=function(expandedItems,collapsedItems){var $expandedContent=Spotfire.Flex.item({container:"horizontal"}).append(expandedItems);
var $collapsedContent=Spotfire.Flex.item({container:"horizontal"}).append(collapsedItems);return Spotfire.Visuals.BoxEditor.expander($expandedContent,$collapsedContent);
};var propertyNameToString=function(propertyName){var resources=Spotfire.Localization.resources;var replace=function(replacements){var ret=propertyName==="border-radius"?resources.StyleEditor_AllCorners:resources.StyleEditor_AllSides;
$.each(replacements,function(i,replacement){if(propertyName.search(replacement[0])>-1){ret=replacement[1];
return false;}});return ret;};return replace([["-top-left",resources.StyleEditor_TopLeft],["-top-right",resources.StyleEditor_TopRight],["-bottom-left",resources.StyleEditor_BottomLeft],["-bottom-right",resources.StyleEditor_BottomRight],["-top",resources.StyleEditor_Top],["-right",resources.StyleEditor_Right],["-bottom",resources.StyleEditor_Bottom],["-left",resources.StyleEditor_Left]]);
};var parseValue=function(value){var parsedValue=parseInt(value,10);if(isNaN(parsedValue)){parsedValue=value;
}return parsedValue;};Spotfire.Visuals.BoxEditor.control=function(title,control,propertyName,titleCssClass){var isUpdating=false;
titleCssClass=titleCssClass||"Title";var $element=title?wrapTitle(control.element().addClass("Item"),title,titleCssClass).addClass("Control"):control.element();
var propertiesReference;var setCalculatedProperties=function(calculatedProperties){var value=calculatedProperties[propertyName];
var parsedValue=parseValue(value);control.value(parsedValue);};var properties=function(propertyOverrides,calculatedProperties){isUpdating=true;
setCalculatedProperties(calculatedProperties);propertiesReference=propertyOverrides;isUpdating=false;
};var onChangeCallback=$.noop;var onChange=function(){if(isUpdating){return;}propertiesReference[propertyName]=control.value();
onChangeCallback();};control.onChange(onChange);return{onChange:function(callback){onChangeCallback=callback;
},properties:properties,element:function(){return $element;}};};Spotfire.Visuals.BoxEditor.allSidesControl=function(title,controlFactoryMethod,collapsedPropertyName,expandedPropertyNames){var itemDict={};
var propertiesReference={};var isUpdating=false;var onChange=$.noop;var createItem=function(name){var control=controlFactoryMethod(name);
itemDict[name]=control;var mainControl=Spotfire.Visuals.BoxEditor.control(propertyNameToString(name),control,name,"ItemTitle");
return mainControl.element();};var expandedItems=_.map(expandedPropertyNames,createItem);var collapsedItem=createItem(collapsedPropertyName);
var propertyNames=[collapsedPropertyName].concat(expandedPropertyNames);var expander=Spotfire.Visuals.BoxEditor.itemsExpander(expandedItems,[collapsedItem]);
var $element=title?wrapTitle(expander.element(),title,"Title"):expander.element();$element.addClass("Control");
var expandedPropertiesAreSet=false;var calculatedPropertiesAreEqual=true;var updateProperties=function(){var isExpanded=expander.expanded();
var updateProperty=function(name,shouldDelete){if(shouldDelete){delete propertiesReference[name];}else{propertiesReference[name]=itemDict[name].value();
}};updateProperty(collapsedPropertyName,isExpanded);_.each(expandedPropertyNames,function(name){updateProperty(name,!isExpanded);
});onChange();};var setExpansion=function(){expander.expanded(expandedPropertiesAreSet||!calculatedPropertiesAreEqual);
};var setProperties=function(propertyDict){propertiesReference=propertyDict;expandedPropertiesAreSet=false;
expandedPropertiesAreSet=_.any(expandedPropertyNames,function(name){return propertyDict.hasOwnProperty(name);
});};var setCalculatedProperties=function(propertyDict){$.each(expandedPropertyNames,function(index,name){if(!propertyDict.hasOwnProperty(name)){throw"No property "+name+" defined.";
}var value=parseValue(propertyDict[name]);itemDict[name].value(value);});var firstExpandedValue=itemDict[expandedPropertyNames[0]].value();
itemDict[collapsedPropertyName].value(firstExpandedValue);var values=_.sortBy(_.map(expandedPropertyNames,function(name){return itemDict[name].value();
}));calculatedPropertiesAreEqual=_.first(values)===_.last(values);};var properties=function(propertyOverrides,calculatedProperties){isUpdating=true;
setCalculatedProperties(calculatedProperties);setProperties(propertyOverrides);setExpansion();isUpdating=false;
};var performExpand=function(){var collapsedValue=itemDict[collapsedPropertyName].value();_.each(expandedPropertyNames,function(name){itemDict[name].value(collapsedValue);
});};var performCollapse=function(){var firstExpandedPropertyName=expandedPropertyNames[0];var firstExpandedValue=itemDict[firstExpandedPropertyName].value();
itemDict[collapsedPropertyName].value(firstExpandedValue);};var expanderChanged=function(){var isExpanded=expander.expanded();
isUpdating=true;if(isExpanded){performExpand();}else{performCollapse();}isUpdating=false;updateProperties();
};_.each(propertyNames,function(name){itemDict[name].onChange(function(){if(!isUpdating){updateProperties();
}});});expander.onChanged(function(){if(!isUpdating){expanderChanged();}});return{onChange:function(callback){onChange=callback;
},properties:properties,expanded:function(bool){return expander.expanded(bool);},element:function(){return $element;
}};};});$(function(){Spotfire.registerNameSpace("Visuals.BoxEditor");Spotfire.Visuals.BoxEditor.boldButtonBox=function(){return Spotfire.Visuals.BoxEditor.buttonBox("sf-element-style-editor-buttonbox__bold","button--selected","Normal","Bold","B");
};Spotfire.Visuals.BoxEditor.italicButtonBox=function(){return Spotfire.Visuals.BoxEditor.buttonBox("sf-element-style-editor-buttonbox__italic","button--selected","Normal","Italic","I");
};Spotfire.Visuals.BoxEditor.buttonBox=function(baseClass,selectedClass,unselectedValue,selectedValue,text,svgPath){var instance,onChange;
var currentVal;var $button=$("<div/>").text(text).addClass("sf-element-style-editor-buttonbox").addClass(baseClass);
if(svgPath){Spotfire.getSvg(svgPath,function($svg){$svg.css({width:"10px",height:"10px"});$button.append($svg);
});}var updateCurrentValue=function(){if(currentVal===selectedValue){$button.addClass(selectedClass);
}else{$button.removeClass(selectedClass);}};var onChangeCallback=function(){currentVal=currentVal===selectedValue?unselectedValue:selectedValue;
updateCurrentValue();if(onChange){onChange(currentVal);}};$button.click(onChangeCallback);instance={value:function(val){if(val===undefined){return currentVal;
}currentVal=val;updateCurrentValue();return instance;},element:function(){return $button;},onChange:function(callback){onChange=callback;
return instance;}};return instance;};Spotfire.Visuals.BoxEditor.textAlignButtonGroupBox=function(){var instance,onChange;
var currentVal;var $buttonGroup=Spotfire.Flex.item({container:"horizontal"});var leftButtonControl=Spotfire.Visuals.BoxEditor.buttonBox("","button--selected",null,"Left","","Images/StyleEditor/TextAlignLeft.svg");
var centerButtonControl=Spotfire.Visuals.BoxEditor.buttonBox("","button--selected",null,"Center","","Images/StyleEditor/TextAlignCenter.svg");
var rightButtonControl=Spotfire.Visuals.BoxEditor.buttonBox("","button--selected",null,"Right","","Images/StyleEditor/TextAlignRight.svg");
$buttonGroup.append(leftButtonControl.element(),centerButtonControl.element(),rightButtonControl.element());
var updateCurrentValue=function(){leftButtonControl.value(currentVal);centerButtonControl.value(currentVal);
rightButtonControl.value(currentVal);};var onChangeCallback=function(val){currentVal=val;updateCurrentValue();
if(onChange){onChange();}};leftButtonControl.onChange(onChangeCallback);centerButtonControl.onChange(onChangeCallback);
rightButtonControl.onChange(onChangeCallback);instance={value:function(val){if(val===undefined){return currentVal;
}currentVal=val;updateCurrentValue();return instance;},element:function(){return $buttonGroup;},onChange:function(callback){onChange=callback;
return instance;}};return instance;};});$(function(){Spotfire.registerNameSpace("Visuals.BoxEditor");
Spotfire.Visuals.BoxEditor.comboBox=function(options,numeric){if(!$.fn.combobox){$.widget("custom.combobox",{_create:function(){this.wrapper=$("<span/>").addClass("sf-element-custom-combobox  ui-widget");
this.element.parent().append(this.wrapper);this.element.hide();this._createAutocomplete();this._createShowAllButton();
},value:function(value){if(value===undefined){var currentValue=this.element.val()===null?this.input.val():this.element.val();
if(this.options.isNumeric){if(currentValue.length>0&&!isNaN(currentValue)&&parseInt(currentValue,10)>0){return parseInt(currentValue,10);
}return null;}return currentValue;}this.input.css("color","");this.element.val(value);this.input.val(value);
},_createAutocomplete:function(){var selected=this.element.children(":selected"),value=selected.val()?selected.text():"";
var $input=$("<input>").appendTo(this.wrapper).val(value).addClass("sf-element-custom-combobox-input sf-element-styling-editor-box-standard").autocomplete({delay:0,minLength:0,source:$.proxy(this,"_source"),open:function(){var $autocomplete=$input.autocomplete("widget");
var autocompleteHeight=$autocomplete.outerHeight(true);var inputHeight=$input.outerHeight(true);var bodyHeight=$(document.body).height();
var overBottom=$autocomplete.offset().top+autocompleteHeight-bodyHeight;var overTop=-($input.offset().top-autocompleteHeight);
if(overBottom>0&&overBottom>overTop){$autocomplete.css("top","-="+(inputHeight+autocompleteHeight));}$.each($autocomplete.children(),function(index,item){if($(item).find("a").text()===$input.val()){var top=index*$(item).outerHeight();
$autocomplete.scrollTop(top);$(item).addClass("ui-state-hover");return false;}});},focus:function(event,ui){$("li",ui.currentTarget).removeClass("ui-state-hover");
}});this.input=$input;this.input.autocomplete("widget").addClass("sf-element-custom-combobox-autocomplete");
if(this.options.isNumeric){this.input.autocomplete("widget").addClass("small-autocomplete");}this._on(this.input,{autocompleteselect:function(event,ui){ui.item.option.selected=true;
this._trigger("select",event,{item:ui.item.option});},keydown:function(event){if(event.keyCode===13){this._removeIfInvalid(event);
}},autocompletechange:"_removeIfInvalid"});},_createShowAllButton:function(){var input=this.input,wasOpen=false;
$("<a>").attr("tabIndex",-1).appendTo(this.wrapper).button({icons:{primary:"ui-icon-triangle-1-s"},text:false}).removeClass("ui-corner-all").addClass("custom-combobox-toggle").mousedown(function(){wasOpen=input.autocomplete("widget").is(":visible");
}).click(function(){input.focus();if(wasOpen){return;}input.autocomplete("search","");});},_source:function(request,response){var matcher=new RegExp($.ui.autocomplete.escapeRegex(request.term),"i");
response(this.element.children("option").map(function(){var text=$(this).text();if(this.value&&(!request.term||matcher.test(text))){return{label:text,value:text,option:this};
}}));},_removeIfInvalid:function(event,ui){this.input.css("color","");if(ui&&ui.item){return;}var value=this.input.val(),valueLowerCase=value.toLowerCase(),valid=false;
if(this.options.isNumeric&&value.length>0&&!isNaN(value)&&parseInt(value,10)>0){this.element.val(value);
this._trigger("select");return;}this.element.children("option").each(function(){if($(this).text().toLowerCase()===valueLowerCase){this.selected=valid=true;
return false;}});if(valid){this._trigger("select");return;}this.input.css("color","red");},_destroy:function(){this.wrapper.remove();
this.element.show();}});}var instance,onChange;var currentVal;var $wrapper=$("<div/>").addClass("sf-element-style-editor-combobox");
var $select=$("<select/>").appendTo($wrapper);$.each(options,function(index,option){$("<option/>").val(option).text(option).appendTo($select);
});if(numeric){$wrapper.addClass("sf-element-custom-small-combobox");}var updateCurrentValue=function(){$select.combobox("value",currentVal);
};var onChangeCallback=function(){currentVal=$select.combobox("value");if(onChange){onChange();}};$select.combobox({select:onChangeCallback,isNumeric:numeric});
instance={value:function(val){if(val===undefined){return currentVal;}if(val){currentVal=val;updateCurrentValue();
}return instance;},element:function(){return $wrapper;},onChange:function(callback){onChange=callback;
return instance;}};return instance;};});$(function(){Spotfire.registerNameSpace("Controls.ButtonGroup");
var hideCss={opacity:"0.001"};var showCss={opacity:"1"};var setup=function(selector){$(selector).css({"background-color":$(selector).parent(".sf-element-visual-title").css("background-color")});
if(!$(selector).is(":last-child")){$(selector).appendTo($(selector).parent());}};var hide=function(selector){setup(selector);
var $buttonGroup=$(selector);var fullyVisible=$buttonGroup.css("opacity")>0.95;var d3ButtonGroup=d3.select($buttonGroup.get(0));
d3ButtonGroup.transition().duration(0).transition().delay(fullyVisible?400:0).duration(fullyVisible?600:200).style(hideCss);
};var tryHide=function(selector){var $buttonGroup=$(selector);if($buttonGroup.prop("AutoHide")){hide($buttonGroup);
}};var hideFast=function(selector){setup(selector);var $buttonGroup=$(selector);$buttonGroup.css(hideCss);
};var initialize=function(selector,autoHide){$(selector).prop("AutoHide",autoHide);if(autoHide){hideFast(selector);
}};var showFast=function(selector){setup(selector);d3.select($(selector).get(0)).transition().duration(50).style(showCss);
};var show=function(selector){setup(selector);d3.select($(selector).get(0)).transition().delay(200).duration(300).style(showCss);
};Spotfire.Controls.ButtonGroup.initialize=initialize;Spotfire.Controls.ButtonGroup.tryHide=tryHide;Spotfire.Controls.ButtonGroup.show=show;
Spotfire.Controls.ButtonGroup.showFast=showFast;});$(function(){function ChangeDataTypeSettingsControl(){var viewId;
var settings;var $settingsDiv;var $preview;var updateDataTypeSettings;var $dialog;var updateConversionSettings=function(conversionSettings){var blurOnEnter=function(e){if(e.keyCode===13){$(this).blur();
}};$settingsDiv.empty();var $settingsContainer=Spotfire.Flex.item({container:"vertical",grow:true}).appendTo($settingsDiv);
var $errorText=$("<div/>").addClass("sf-dataoverview-ChangeDataTypeError").hide();var addSettingBox=function($parent){return Spotfire.Flex.item({container:"vertical",grow:true}).addClass("sf-changedatatype-setting").appendTo($parent);
};var validateAndApplyConversionSettings=function(){var callback=function(result){$errorText.hide();if(result.ok){Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,"UpdateConversion",JSON.stringify(conversionSettings));
}else{if(result.error){$errorText.text(result.error).show();}}};Spotfire.Dxp.Web.Forms.AjaxService.Read(viewId,"ValidateConversion",JSON.stringify(conversionSettings),callback);
};var createDropDown=function(useComboBox,$parent,title,items,itemIndex,onChangedSettings){var $dropdownContainer=addSettingBox($parent);
$("<span/>").text(title).appendTo($dropdownContainer);var $dropdown=$("<div/>").appendTo($dropdownContainer);
var onComboBoxChanged=function(item,index){if(index!==conversionSettings[itemIndex]){conversionSettings[itemIndex]=index;
if(onChangedSettings){onChangedSettings(conversionSettings);}validateAndApplyConversionSettings();}};
Spotfire.Controls.DropDown.initialize($dropdown,{values:conversionSettings[items],useIndexAsValueId:true,selectedIndex:conversionSettings[itemIndex],onSelected:onComboBoxChanged,useCombobox:useComboBox});
};var addCheckbox=function($parent,property,label){var $topCheckboxContainer=addSettingBox($parent);var $checkboxContainer=Spotfire.Flex.item({container:"horizontal",grow:true}).appendTo($topCheckboxContainer);
var $checkbox=$("<input>").attr("type","checkbox").attr("id","cb"+property).appendTo($checkboxContainer).change(function(){conversionSettings[property]=$checkbox.prop("checked");
validateAndApplyConversionSettings();});var $label=$("<label/>").attr("id",property).attr("for","cb"+property).appendTo($checkboxContainer);
if(conversionSettings[property]){$checkbox.attr("checked","checked");}$label.append(document.createTextNode(label));
Spotfire.Filters.StyledFilters.createStyledInput($checkbox,13,13);};var addTextBox=function($parent,textBoxHeader,property,help){var $textBoxContainer=addSettingBox($parent);
$("<span/>").text(textBoxHeader).appendTo($textBoxContainer);var $textBoxInput=$("<input/>").attr("type","text").addClass("sf-element-input").appendTo($textBoxContainer);
$textBoxInput.val(conversionSettings[property]);$textBoxInput.on("keydown",blurOnEnter);var onBlur=function(){var newValue=$.trim($textBoxInput.val());
if(newValue===conversionSettings[property]){return;}conversionSettings[property]=newValue;validateAndApplyConversionSettings();
};$textBoxInput.on("blur",onBlur);if(help){$("<span/>").text(help).addClass("sf-changedatatype-formathelp").appendTo($textBoxContainer);
}return $textBoxContainer;};if(conversionSettings!==undefined&&conversionSettings!==null&&conversionSettings.hasSettings){if(conversionSettings.conversion==="StringToBoolean"){addTextBox($settingsContainer,Spotfire.Localization.resources.ChangeDataType_StringsRepresentingTrue,"trueValues",Spotfire.Localization.resources.ChangeDataType_SeparateUsingSemicolon);
addTextBox($settingsContainer,Spotfire.Localization.resources.ChangeDataType_StringsRepresentingFalse,"falseValues",Spotfire.Localization.resources.ChangeDataType_SeparateUsingSemicolon);
}else{if(conversionSettings.conversion==="TimeSpanToNumeric"||conversionSettings.conversion==="NumericRound"||conversionSettings.conversion==="TimeToNumeric"||conversionSettings.conversion==="NumericToTimeSpan"){createDropDown(false,$settingsContainer,conversionSettings.title,"levels","levelIndex");
}else{if(conversionSettings.conversion==="StringToNumeric"){createDropDown(true,$settingsContainer,Spotfire.Localization.resources.ChangeDataType_SelectLocaleToUse,"locales","localeIndex");
var $negativeContainer=addSettingBox($settingsContainer);$negativeContainer.append($("<div/>").text(Spotfire.Localization.resources.ChangeDataType_NegativeNumbersTitle).addClass("Header"));
var $negativeNumbersDropdown=$("<div/>").appendTo($negativeContainer);var onNegativeNumberChanged=function(item,index){var isParanthesis=index===1;
if(conversionSettings.allowParenthesis!==isParanthesis){conversionSettings.allowParenthesis=isParanthesis;
validateAndApplyConversionSettings();}};var negativeNumbers=[Spotfire.Localization.resources.ChangeDataType_NegativeNumbersMinusSign,Spotfire.Localization.resources.ChangeDataType_NegativeNumbersParenthesis];
var selectedNegativeNumberIndex=conversionSettings.allowParenthesis?1:0;Spotfire.Controls.DropDown.initialize($negativeNumbersDropdown,{values:negativeNumbers,useIndexAsValueId:true,selectedIndex:selectedNegativeNumberIndex,onSelected:onNegativeNumberChanged});
addCheckbox($settingsContainer,"keepMinusSign",Spotfire.Localization.resources.ChangeDataType_UseMinusSign);
addCheckbox($settingsContainer,"allowExponent",Spotfire.Localization.resources.ChangeDataType_AllowExponents);
addCheckbox($settingsContainer,"keepThousandsSeparator",Spotfire.Localization.resources.ChangeDataType_KeepThousandsSeparator);
if(!conversionSettings.isInteger){addCheckbox($settingsContainer,"keepDecimalPoint",Spotfire.Localization.resources.ChangeDataType_KeepDecimalPoint);
}}else{if(conversionSettings.conversion==="StringToTime"){conversionSettings.forceUpdate=true;createDropDown(true,$settingsContainer,Spotfire.Localization.resources.ChangeDataType_SelectLocaleToUse,"locales","localeIndex");
var $customTextBox;var onFormatSettingsChanged=function(){var selectedFormatSettings=conversionSettings.formatOptions[conversionSettings.formatOptionIndex];
conversionSettings.isCustom=selectedFormatSettings.isCustom;if(conversionSettings.isCustom){$customTextBox.show();
}else{$customTextBox.hide();conversionSettings.formatString=selectedFormatSettings.id;}};createDropDown(false,$settingsContainer,Spotfire.Localization.resources.ChangeDataType_FormattingComboLabel,"formatOptions","formatOptionIndex",onFormatSettingsChanged);
$customTextBox=addTextBox($settingsContainer,Spotfire.Localization.resources.ChangeDataType_FormatStringLabel,"formatString");
onFormatSettingsChanged();}else{if(conversionSettings.conversion==="FromBoolean"){addTextBox($settingsContainer,Spotfire.Localization.resources.ChangeDataType_ValueForTrue,"trueValue",conversionSettings.formatHelp);
addTextBox($settingsContainer,Spotfire.Localization.resources.ChangeDataType_ValueForFalse,"falseValue",conversionSettings.formatHelp);
}}}}}}else{var $messageItem=Spotfire.Flex.item({shrink:false}).appendTo($settingsContainer);$("<div/>").text(Spotfire.Localization.resources.ChangeDataType_NoSettingsMessage).addClass("sf-changedatatype-nosettingsmessage").appendTo($messageItem);
}$errorText.appendTo($settingsContainer);};this.initInPlace=function($d,theViewId,newSettings){$dialog=$d;
viewId=theViewId;settings=newSettings;var $topLayout=Spotfire.Flex.item({container:"vertical",fill:true,grow:true,"align-items":"stretch"}).css("height","100%").appendTo($dialog);
var $changeDataTypeDialogHeader=$("<div/>").addClass("sf-changedatatype-header").appendTo($topLayout);
$changeDataTypeDialogHeader.text(Spotfire.Utilities.formatString(Spotfire.Localization.resources.ChangeDataType_EditDataTypeHeader,settings.columnName));
var $layout=Spotfire.Flex.item({container:"horizontal",fill:true,grow:true,"align-items":"stretch"}).css("height","100%").appendTo($topLayout);
var $dataTypeContainer=Spotfire.Flex.item({container:"vertical",grow:true,"auto-basis":false}).addClass("sf-changedatatype-datatype-container").appendTo($layout);
var $valuesContainer=Spotfire.Flex.item({container:"vertical",grow:true,"auto-basis":false}).addClass("sf-changedatatype-values-container").appendTo($layout);
Spotfire.Flex.item({shrink:false}).text(Spotfire.Localization.resources.ChangeDataType_DataTypeHeader).addClass("sf-changedatatype-lower-header").appendTo($dataTypeContainer);
var $dropdownContainer=Spotfire.Flex.item({shrink:false}).css("width","100%").appendTo($dataTypeContainer);
var $dropdown=$("<div/>").appendTo($dropdownContainer);var onDataTypeSelected=function(item,index){if(index!==settings.dataTypeIndex){var args={tableId:settings.tableId,columnId:settings.columnId,dataType:settings.dataTypes[index].id};
Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,"ChangeDataType",JSON.stringify(args));}};var addOrignalDataType=function(settings){var i;
var newTypes=[];for(i=0;i<settings.dataTypes.length;++i){if(i!==settings.dataTypeIndex&&i===settings.originalDataTypeIndex){newTypes.push({id:settings.dataTypes[i].id,text:Spotfire.Utilities.formatString(Spotfire.Localization.resources.DataOverview_OriginalDataType,settings.dataTypes[i].text)});
}else{newTypes.push(settings.dataTypes[i]);}}return newTypes;};var comboBoxDataTypeSettings={values:addOrignalDataType(settings),useIndexAsValueId:true,selectedIndex:settings.dataTypeIndex,onSelected:onDataTypeSelected,maxVisibleValues:12};
Spotfire.Controls.DropDown.initialize($dropdown,comboBoxDataTypeSettings);updateDataTypeSettings=function(){comboBoxDataTypeSettings.values=addOrignalDataType(settings);
comboBoxDataTypeSettings.selectedIndex=settings.dataTypeIndex;Spotfire.Controls.DropDown.update($dropdown,comboBoxDataTypeSettings);
};$settingsDiv=Spotfire.Flex.item({grow:true}).addClass("sf-changedatatype-settings-container").appendTo($dataTypeContainer);
updateConversionSettings(settings.conversionSettings);Spotfire.Flex.item({shrink:false}).text(Spotfire.Localization.resources.ChangeDataType_PreviewHeader).addClass("sf-changedatatype-lower-header").appendTo($valuesContainer);
$preview=Spotfire.Flex.item({grow:true}).css("width","100%").appendTo($valuesContainer).addClass("sf-ChangeDataTypeSettingsPreview");
var plotBounds={width:$preview.width(),height:$preview.height()};Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,"GetPreview",JSON.stringify(plotBounds));
};var resizePreview=_.debounce(function(){$dialog.height($dialog.parent().innerHeight());var plotBounds={width:$preview.width(),height:$preview.height()};
Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,"ResizePreview",JSON.stringify(plotBounds));},100);this.handleResize=function(){resizePreview();
};this.show=function(theViewId,newSettings){viewId=theViewId;settings=newSettings;var $d=$("<div/>").addClass("sf-ChangeDataTypeSettings");
var buttons=[{text:Spotfire.Localization.resources.Close,isDefault:true}];Spotfire.Controls.ModalDialog.initialize($d,{modal:true,title:Spotfire.Localization.resources.ChangeDataType_DialogHeader,buttons:buttons,resizable:true,minWidth:500,minHeight:480,resize:resizePreview,resizeStop:resizePreview,close:function(){$dialog.remove();
}});this.initInPlace($d,theViewId,newSettings);};this.update=function(newSettings){settings=newSettings;
updateDataTypeSettings();updateConversionSettings(settings.conversionSettings);};this.initPreview=function(id,html){$preview.empty();
var $html=$(html);$html.attr("viewid",id);$preview.append($html);};return this;}Spotfire.registerNameSpace("Controls.ChangeDataTypeSettingsControl",{show:function(viewId,settings){var dialog=new ChangeDataTypeSettingsControl();
dialog.show(viewId,settings);$(".sf-ChangeDataTypeSettings").data("dialog",dialog);},initInPlace:function(viewId,settings){$(document.body).css("overflow","hidden");
var $dialog=$("#"+viewId);$dialog.width(settings.width);$dialog.height(settings.height);var dialog=new ChangeDataTypeSettingsControl();
dialog.initInPlace($dialog,viewId,settings);$dialog.data("dialog",dialog);},handleResize:function(viewId,args){var $content=$(".sf-ChangeDataTypeSettings");
if($content.length>0){$content.width(args.width);$content.height(args.height);var dialog=$content.data("dialog");
dialog.handleResize();}},update:function(settings){var $content=$(".sf-ChangeDataTypeSettings");if($content.length>0){var dialog=$content.data("dialog");
dialog.update(settings);}},initPreview:function(id,html){var $content=$(".sf-ChangeDataTypeSettings");
if($content.length>0){var dialog=$content.data("dialog");dialog.initPreview(id,html);}}});});$(function(){var copyElementAndInlineStyle=function(element){var inlineStyle=function(srcNode,dstNode){if(srcNode.nodeType!==1){return;
}var i;dstNode.removeAttribute("class");dstNode.removeAttribute("draggable");dstNode.removeAttribute("id");
dstNode.removeAttribute("style");var computedStyles=window.getComputedStyle(srcNode);var property;for(i=0;
i<computedStyles.length;i++){property=computedStyles[i];if(property.indexOf("-")!==0){dstNode.style.setProperty(property,computedStyles.getPropertyValue(property),computedStyles.getPropertyPriority(property));
}}if(srcNode.hasChildNodes()){for(i=0;i<srcNode.childNodes.length;i++){inlineStyle(srcNode.childNodes[i],dstNode.childNodes[i]);
}}};var clone=element.cloneNode(true);inlineStyle(element,clone);clone.style.position="absolute";clone.style.top=0;
clone.style.left=0;clone.style.margin=0;return clone;};var createItemCountIndicator=function(itemCount){var $indicator=$("<div>").css({"font-family":"Arial, sans-serif","font-size":"10px",color:"white",position:"absolute",margin:"2px 2px 0 0",right:"0",top:"0",width:"18px",height:"18px","text-align":"center","vertical-align":"middle","line-height":"18px","border-radius":"100%","background-color":"#f05050","border-width":"1px","border-style":"solid","box-shadow":"0 0 1px 1px rgba(0, 0, 0, 0.1)"}).text(itemCount);
return $indicator;};var createDragImage=function(element,itemCount){var $target=$(element);var width=$target.outerWidth();
var height=$target.outerHeight();var $dragImage=$("<div>").css("overflow","hidden").css("position","absolute").css("width",width).css("height",height).css("left",0).css("top",0);
var $copy=$(copyElementAndInlineStyle(element));$dragImage.append($copy);if(itemCount>1){$dragImage.append(createItemCountIndicator(itemCount));
}return $dragImage;};var dragImageVisible=false;var setDragImage=function(element,itemCount){var $target=$(element);
if($("*",$target).length>1000){return;}var $dragImage=createDragImage(element,itemCount);var dragImageHtml=$dragImage.get(0).outerHTML;
if(JSON.stringify(dragImageHtml).length>2000000){return;}var args={width:$target.outerWidth(),height:$target.outerHeight(),fragment:dragImageHtml};
Spotfire.PageBus.publish("spotfire.visuals.updatedragimage",args);dragImageVisible=true;};var clearDragImage=function(){if(dragImageVisible){Spotfire.PageBus.publish("spotfire.visuals.updatedragimage",{});
dragImageVisible=false;}};Spotfire.registerNameSpace("ClientDragDrop",{useDragImageWorkaround:function(){return window.SpotfireCef!==undefined;
},setDragImage:setDragImage,clearDragImage:clearDragImage,copyElementAndInlineStyle:copyElementAndInlineStyle,createItemCountIndicator:createItemCountIndicator});
});$(function(){Spotfire.registerNameSpace("CollaborationPanel");var createPlaceHolder=function(){return $("<div/>").addClass("sf-collaborationFrame");
};Spotfire.CollaborationPanel.initialize=function($parent){$parent.empty();$parent.append(createPlaceHolder());
window.CollaborationPanelService.UpdateContent();};Spotfire.CollaborationPanel.update=function(settings){var $placeholder=$(".sf-collaborationFrame");
if(settings.isUrl){var $iframe=$("<iframe/>").addClass("sf-collaborationFrame").attr("name","sf-collaborationFrame").attr("src",settings.data);
$placeholder.replaceWith($iframe);}else{$placeholder.replaceWith(createPlaceHolder().text(settings.data));
}};});$(function(){Spotfire.registerNameSpace("Visual.ColorScheme");var onShow=function(data,$offsetelement,callback){var menu=Spotfire.Controls.ContextMenu.create(data.colorschemes,callback,"ColorSchemePickerPopout");
var offset=$offsetelement.offset();menu.show(offset.left,offset.top+$offsetelement.outerHeight(true)).addClass("schemepickerfor_"+$offsetelement.attr("id"));
};Spotfire.Visual.ColorScheme.show=function($colorschemeImage,data,callback){var openonclick=true;$colorschemeImage.bind("mouseover",function(){openonclick=$(".schemepickerfor_"+$colorschemeImage.attr("id")).length===0;
});if(data.colorschemes.length>0){$colorschemeImage.bind("click",function(){if(!openonclick){openonclick=true;
return;}onShow(data,$colorschemeImage,callback);openonclick=false;});}else{$colorschemeImage.addClass("colorschemepicker-disabled");
}};});$(function(){Spotfire.registerNameSpace("ConfirmDialog");Spotfire.ConfirmDialog.showYesNoDialog=function(title,message,yesCallback,noCallback){var $contentPanel=$("<div />").addClass("confirmContent");
$contentPanel.attr("title",title);$contentPanel.text(message);var buttons=[{text:Spotfire.Localization.resources.Yes,isDefault:true,click:yesCallback},{text:Spotfire.Localization.resources.No,isCancel:true,click:noCallback}];
Spotfire.Controls.ModalDialog.initialize($contentPanel,{width:400,resizable:false,buttons:buttons,modal:true,dialogClass:"confirmDialog"});
};Spotfire.ConfirmDialog.showYesNoCancelDialog=function(title,message,yesCallback,noCallback,cancelCallback){var $contentPanel=$("<div />").addClass("confirmContent");
$contentPanel.attr("title",title);$contentPanel.text(message);var buttons=[{text:Spotfire.Localization.resources.Yes,click:yesCallback,isDefault:true},{text:Spotfire.Localization.resources.No,click:noCallback},{text:Spotfire.Localization.resources.Cancel,click:cancelCallback,isCancel:true}];
Spotfire.Controls.ModalDialog.initialize($contentPanel,{width:400,resizable:false,buttons:buttons,modal:true,dialogClass:"confirmDialog"});
};Spotfire.ConfirmDialog.showOkCancelDialog=function(title,message,okCallback,cancelCallback){var $contentPanel=$("<div />").addClass("confirmContent");
$contentPanel.attr("title",title);$contentPanel.text(message);var buttons=[{text:Spotfire.Localization.resources.Ok,isDefault:true,click:okCallback},{text:Spotfire.Localization.resources.Cancel,isCancel:true,click:cancelCallback}];
Spotfire.Controls.ModalDialog.initialize($contentPanel,{width:400,resizable:false,buttons:buttons,modal:true,dialogClass:"confirmDialog",zIndex:10000});
};Spotfire.ConfirmDialog.showDialog=function(title,message,buttons){var $contentPanel=$("<div />").addClass("confirmContent");
$contentPanel.attr("title",title);$contentPanel.text(message);return Spotfire.Controls.ModalDialog.initialize($contentPanel,{width:400,resizable:false,buttons:buttons,modal:true,dialogClass:"confirmDialog"});
};});$(function(){function ContextMenu(items,onMenuItemClick,cssClass){var close,onBodyMouseDown,onKeyDown;
var currentInstance=null;var getPositionInsideWindowBorders=function(left,top,width,height){var windowWidth=$(window).innerWidth();
var windowHeight=$(window).innerHeight();left=Math.max(0,left);top=Math.max(0,top);var x=Math.min(left,windowWidth-width);
var y=Math.min(top,windowHeight-height);return{left:x,top:y};};var layoutMenu=function(menu){var maxWidth=0;
$.each($(".contextMenuItem",menu),function(index,item){var w=$(item).width();if(w>maxWidth){maxWidth=w;
}});var width=Math.min(maxWidth,300);$(".contextMenuItem",menu).width(width);$(".contextMenuSeparator",menu).width(width+80);
menu.css("max-height",$(window).innerHeight()-8);};var build=function(children){var menu=$("<div/>").addClass("contextMenu");
menu.on("contextmenu",function(e){e.preventDefault();});if(cssClass){menu.addClass(cssClass);}var createItem=function(child){var item=$("<div/>");
item.addClass("contextMenuItem");if(child.imageUrl||child.checked){var image=$("<div/>");image.addClass("contextMenuItemCheckmark");
var checkmark=$("<img/>");if(!child.imageUrl){checkmark.attr("src","Images/ContextMenu/Checkmark.gif");
checkmark.css({position:"absolute",left:"4px",top:"3px"});}else{checkmark.attr("src",child.imageUrl);
if(child.checked){item.addClass("selected");}}image.append(checkmark);item.append(image);}if(!child.enabled){item.addClass("contextMenuItemDisabled");
}var label=$("<div/>").addClass("contextMenuItemLabel");label.text(child.text).attr("title",child.tooltip||child.text);
item.append(label);if(child.itemImage){var innerimage=$("<img/>");if(child.text.length>0){innerimage.css({top:"23px",position:"absolute"});
}innerimage.attr("src",child.itemImage);item.append(innerimage);item.css({height:13+child.itemImageHeight+"px",width:child.itemImageWidth+"px"});
}if(child.children){var arrow=$("<img src='Images/ContextMenu/ArrowRight.png'/>");arrow.css({position:"absolute",top:"13px",right:"13px"});
item.append(arrow);}return item;};var opentimer;var openclosedelay=300;var showSubMenu=function($item,child){var $parent=$item.parent();
if($parent.data("subMenuItem")===$item[0]){return;}if($parent.data("subMenu")){$parent.data("subMenu").StyledScrollbar("close").remove();
$parent.removeData("subMenu");$parent.removeData("subMenuItem");}if(child.children){var $subMenu=build(child.children);
$parent.data("subMenu",$subMenu);$parent.data("subMenuItem",$item[0]);$(document.body).append($subMenu);
layoutMenu($subMenu);var padding=2;var pos={left:menu.offset().left+menu.outerWidth(),top:$item.offset().top};
var insidePos=getPositionInsideWindowBorders(pos.left,pos.top,$subMenu.outerWidth()+padding,$subMenu.outerHeight()+padding);
var outsideX=(insidePos.left-pos.left)<0;var outsideY=(insidePos.top-pos.top)<0;insidePos.left=pos.left+(outsideX?1-$subMenu.outerWidth()-menu.outerWidth():-1);
insidePos.top=pos.top+(insidePos.top+1-pos.top-(outsideY?0:2));insidePos=getPositionInsideWindowBorders(insidePos.left,insidePos.top,$subMenu.outerWidth()+padding,$subMenu.outerHeight()+padding);
$subMenu.css({top:insidePos.top+"px",left:insidePos.left+"px"});$subMenu.addClass("withOverflow");$subMenu.StyledScrollbar({cssClass:"light"});
}};$.each(children,function(index,child){if(child.separator){$("<div/>").addClass("contextMenuSeparator").appendTo(menu);
}else{var $item=createItem(child);menu.append($item);var showSubMenuForItem=function(){showSubMenu($item,child);
};$item.click(showSubMenuForItem);$item.mouseenter(function(){if(opentimer){window.clearTimeout(opentimer);
opentimer=0;}opentimer=window.setTimeout(showSubMenuForItem,openclosedelay);return false;});$item.mouseleave(function(){if(opentimer){window.clearTimeout(opentimer);
opentimer=0;}return false;});if(child.enabled&&!child.children){$item.click(function(){if(onMenuItemClick(child)){close();
}return false;});}}});return menu;};close=function(){currentInstance=null;$(document.body).unbind("mousedown",onBodyMouseDown);
$(document.body).unbind("keydown",onKeyDown);$(".contextMenu").each(function(){$(this).StyledScrollbar("close").remove();
});Spotfire.MultipleViews.OffRemoteFocus(close);};Spotfire.MultipleViews.OnRemoteFocus(close);onKeyDown=function(event){if(event.which===Keys.ESCAPE){close();
event.preventDefault();event.stopPropagation();}};onBodyMouseDown=function(event){var target=$(event.target);
while(true){if(target.length===0||target.is(document.body)){break;}if(target.is(".contextMenu")||(target.is(".StyledScrollbar")&&target.has(".contextMenu").length)){return;
}target=target.parent();}close();};var show=function(x,y){if(currentInstance){currentInstance.close();
}currentInstance=this;var root=build(items).addClass("contextMenuRoot");$(document.body).append(root);
$(document.body).bind("mousedown",onBodyMouseDown);$(document.body).bind("keydown",onKeyDown);$(document.body).on("close.contextMenu",close);
layoutMenu(root);var padding=2;var rootWidth=root.width();var rootHeight=root.height();var pos=getPositionInsideWindowBorders(x,y,rootWidth+padding,rootHeight+padding);
root.css("left",Math.max(pos.left,0)+"px");root.css("top",Math.max(pos.top,0)+"px");root.addClass("withOverflow");
root.StyledScrollbar({cssClass:"light"});return root;};this.show=show;this.close=close;}Spotfire.registerNameSpace("Controls.ContextMenu");
Spotfire.Controls.ContextMenu.create=function(items,onMenuItemClick,cssClass){return new ContextMenu(items,onMenuItemClick,cssClass);
};Spotfire.registerNameSpace("Controls.DropDownMenu");Spotfire.Controls.DropDownMenu.initialize=function(id,items,point,callbackId){var $parent=$("#"+id);
var offset=$parent.offset();if(point===undefined||point===null){point=new Point(0,$parent.outerHeight());
}if(callbackId===undefined){callbackId=id;}var onMenuItemClick=function(item){if(item.lightbox){Spotfire.LightBox.show();
}Ajax.enqueueRequest(callbackId,"DropDownMenuItemClicked",item.tag);return true;};var menu=Spotfire.Controls.ContextMenu.create(items,onMenuItemClick);
return menu.show(offset.left+point.x,offset.top+point.y);};Spotfire.Controls.ContextMenu.bindRightClick=function(selector,viewId,settings){var $item=$(selector);
var callbackControlId=$item.attr("id");var onContextMenu=function(e){if(!e.ctrlKey){var itemOffset=$item.sfBoxOffset();
var offset=new Point(e.pageX-itemOffset.left,e.pageY-itemOffset.top);var args={id:callbackControlId,viewId:viewId,settings:settings,pointOnPage:new Point(e.pageX,e.pageY),offset:offset};
Spotfire.PageBus.publish("spotfire.visuals.showcontextmenu",args);e.stopPropagation();e.preventDefault();
}return false;};$item.bind("contextmenu",onContextMenu);};if(Spotfire.isWebPlayer()){var onShowContextMenu=function(subject,message){var data=JSON.parse(message);
var callbackControlId=data.id;var point=data.pointOnPage;var offset=$("#"+callbackControlId).offset();
var relativeParent=new Point(point.x-offset.left,point.y-offset.top);Ajax.enqueueRequest(callbackControlId,"ShowContextMenu",JSON.stringify(relativeParent));
};Spotfire.PageBus.subscribe("spotfire.visuals.showcontextmenu",onShowContextMenu);}});$(function(){Spotfire.registerNameSpace("Visuals.ContextualPopout");
var hoverarea;var currentTrackedElement;var currentActiveElement;function round(value,decimals){return Number(Math.round(value+"e"+decimals)+"e-"+decimals);
}function icon(key,urlOverride){var svgs={standard:"Images/ContextualPopout/crosstable/15.MarkValuesVertical16x16.svg",markValuesVertical:"Images/ContextualPopout/crosstable/15.MarkValuesVertical16x16.svg",markValuesHorizontal:"Images/ContextualPopout/crosstable/16.MarkValuesHorizontal16x16.svg",sizeToFit:"Images/ContextualPopout/crosstable/3.SizeWidthToFit16x16.svg",columnWidth:"Images/ContextualPopout/crosstable/4.ColumnWidth16x16.svg",columnHorizontalAlign_DataType:"Images/ContextualPopout/plotinteraction/1.General_16x16.svg",columnHorizontalAlign_Left:"Images/ContextualPopout/crosstable/6.TxtLeft16x16.svg",columnHorizontalAlign_Center:"Images/ContextualPopout/crosstable/7.TxtWidthCenter16x16.svg",columnHorizontalAlign_Right:"Images/ContextualPopout/crosstable/8.TxtRight16x16.svg",columnSorting_None:"Images/ContextualPopout/crosstable/1.SortingArrowUp16x16.svg",columnSorting_Ascending:"Images/ContextualPopout/crosstable/1.SortingArrowUp16x16.svg",columnSorting_Descending:"Images/ContextualPopout/crosstable/2.SortingArrowDown16x16.svg",headerHorizontalAlign_DataType:"Images/ContextualPopout/plotinteraction/1.General_16x16.svg",headerHorizontalAlign_Left:"Images/ContextualPopout/crosstable/6.TxtLeft16x16.svg",headerHorizontalAlign_Center:"Images/ContextualPopout/crosstable/7.TxtWidthCenter16x16.svg",headerHorizontalAlign_Right:"Images/ContextualPopout/crosstable/8.TxtRight16x16.svg",headerOrientation_Vertical:"Images/ContextualPopout/crosstable/13.Vertical16x16.svg",headerOrientation_Horizontal:"Images/ContextualPopout/crosstable/12.Horizontal16x16.svg",headerVerticalAlign_Top:"Images/ContextualPopout/crosstable/9.TxtUp16x16.svg",headerVerticalAlign_Middle:"Images/ContextualPopout/crosstable/10.TxtHeightCentre16x16.svg",headerVerticalAlign_Bottom:"Images/ContextualPopout/crosstable/11.TxtDown16x16.svg",hideGrandTotalForColumns:"Images/ContextualPopout/crosstable/14.Hide16x16.svg",hideGrandTotalForRows:"Images/ContextualPopout/crosstable/14.Hide16x16.svg",hideSubtotals:"Images/ContextualPopout/crosstable/14.Hide16x16.svg",globalSorting_GlobalAscending:"Images/ContextualPopout/crosstable/17.GlobalSortUp.svg",globalSorting_GlobalDescending:"Images/ContextualPopout/crosstable/18.GlobalSortDown.svg",hideColumn:"Images/ContextualPopout/crosstable/14.Hide16x16.svg",moveColumnFirst:"Images/ContextualPopout/tableplot/MoveColumnFirst.svg",moveColumnLast:"Images/ContextualPopout/tableplot/MoveColumnLast.svg",formatting_Reset:"Images/ContextualPopout/plotinteraction/1.General_16x16.svg",formatting_Number:"Images/ContextualPopout/plotinteraction/2.Numbers_16x16.svg",formatting_Percentage:"Images/ContextualPopout/plotinteraction/3.Percentage_16x16.svg",formatting_Currency:"Images/ContextualPopout/plotinteraction/4.Currency_16x16.svg",formatting_Scientific:"Images/ContextualPopout/plotinteraction/5.Scientific_16x16.svg",formatting_Date:"Images/ContextualPopout/plotinteraction/20.Date_16x16.svg",formatting_timespan:"Images/ContextualPopout/plotinteraction/21.011_16x16.svg",showMarkerLabels:"Images/ContextualPopout/plotinteraction/6.ab12_16x16.svg",labelVisibilityShowAll:"Images/ContextualPopout/plotinteraction/6.ab12_16x16.svg",labelVisibilityShowAllBarsAndBlocks:"Images/ContextualPopout/plotinteraction/6.ab12_16x16.svg",showGridlinesHorizontal:"Images/ContextualPopout/plotinteraction/7.GridlinesHorizontal16x16.svg",showGridlinesVertical:"Images/ContextualPopout/plotinteraction/8.GridlinesVertical16x16.svg",showReferenceLine:"Images/ContextualPopout/plotinteraction/9.ReferenceLineHorizontal_16x16.svg",showReferenceLine2:"Images/ContextualPopout/plotinteraction/10.ReferenceLineVertical_16x16.svg",stackModeCC_Stack:"Images/ContextualPopout/plotinteraction/11.Stacked_16x16.svg",stackMode_Stack:"Images/ContextualPopout/plotinteraction/11.Stacked_16x16.svg",stackModeCC_None:"Images/ContextualPopout/plotinteraction/12.SideBysideBars_16x16.svg",stackMode_None:"Images/ContextualPopout/plotinteraction/12.SideBysideBars_16x16.svg",stackMode_Stack100Percent:"Images/ContextualPopout/plotinteraction/13.Label16x16.svg",orientation_Vertical:"Images/ContextualPopout/plotinteraction/14.100Stacked16x16.svg",orientation_Horizontal:"Images/ContextualPopout/plotinteraction/15.HorizontalBars_16x16.svg",sortedBars:"Images/ContextualPopout/plotinteraction/16.OnlyTop_16x16.svg",showTopX:"Images/ContextualPopout/plotinteraction/17.Label_16x16.svg",showMarkers:"Images/ContextualPopout/plotinteraction/18.Markers_16x16.svg",reversed:"Images/ContextualPopout/plotinteraction/19.Reverse_16x16.svg"};
var url=urlOverride||svgs[key]||svgs.standard;var elem=$("<div />").addClass("ButtonImage");Spotfire.getSvg(url,function(svg){elem.append(svg);
});return elem;}function resetActiveState(){if(currentActiveElement){currentActiveElement.removeClass("sfpc-active");
currentActiveElement=null;}$(window).off("sf-touchmouseup",resetActiveState);}function setActiveState(){currentActiveElement=$(this);
currentActiveElement.addClass("sfpc-active");$(window).on("sf-touchmouseup",resetActiveState);}function builder(id,args,$container,defaultCallback){var API;
var rootContainer=$container;var currentContainer=$container;defaultCallback=defaultCallback||$.noop;
function beginSection(){var $section=$("<div />").addClass("sf-element-contextual-popout-section");currentContainer.append($section);
currentContainer=$section;}function endSection(){var $section=currentContainer;currentContainer=currentContainer.parent();
var totalLength=0;$section.children(".sf-element-contextual-popout-row").each(function(){totalLength+=$(this).children(":not(.sf-element-contextual-popout-heading)").length;
});if(totalLength===0){$section.remove();}}function beginRow(singleItemRow){var $row=$("<div />").addClass("sf-element-contextual-popout-row");
$row.toggleClass("sfpc-single",singleItemRow===true);currentContainer.append($row);currentContainer=$row;
if(singleItemRow){$row.on("click",function(){$row.find("input").first().trigger("click");return false;
});}}function endRow(){var emptyRow;if(currentContainer.contents().length===0){emptyRow=currentContainer;
}if(currentContainer.hasClass("sfpc-single")&&!currentContainer.attr("title")){currentContainer.attr("title",currentContainer.find("div[title]").first().attr("title"));
}currentContainer=currentContainer.parent();if(emptyRow){emptyRow.remove();}}function addButton(name,text,callback,iconUrl){if(!args[name]){return;
}if(!callback){callback=defaultCallback.bind(null,name,undefined,undefined);}var $button;if(iconUrl){$button=$("<div />").addClass("sf-element-contextual-popout-button sfc-enabled").attr("title",text).on("click",function(){callback();
$button.trigger("close");}).append(icon("",iconUrl));}else{$button=$("<input type='button'/>").val(text).attr("id",name).addClass("whiteButton").on("click",function(){callback();
$button.trigger("close");});}$button.on("sf-touchmousedown",setActiveState);currentContainer.append($button);
}function addNode(name,node){currentContainer.append(node);}function addRadioButton(name,value,settings){settings=settings||{};
var text=settings.text;var checked=settings.checked;var compactMode=settings.compactMode;var callback=settings.callback;
var title=settings.title;var enabled=settings.enabled===undefined||settings.enabled;var inputId=name+"_"+value;
var $input=$("<input type='radio'/>").attr("name",name).val(value).attr("id",inputId);callback=callback||defaultCallback;
$input.on("click",function(){callback(name,$input.val());$input.trigger("close");return false;});currentContainer.append($input);
var $imageButton=$("<div />").addClass("sf-element-contextual-popout-button").attr("title",title||text).append(icon(name+"_"+value,settings.iconOverride));
if(enabled){$imageButton.addClass("sfc-enabled");}else{$input.attr("disabled","disabled");}var $label=$("<label/>").append($imageButton).attr("for",inputId);
var $labelSpan=$("<span />").addClass("ValueLabel sf-element-contextual-popout-label").text(text);if(!compactMode){$label.append($labelSpan);
}if((typeof checked==="boolean"&&checked)||value===args[name]){$input.prop("checked",true);$imageButton.addClass("sfc-checked");
$labelSpan.addClass("sfc-checked");}$imageButton.on("sf-touchmousedown",setActiveState);currentContainer.append($label);
}function addFormatting(name){var options=args[name].items;options.filter(function(option){return option.value!=="General"&&option.value!=="Custom";
}).forEach(function(option){addRadioButton(name,option.value,{text:option.text,checked:option.checked,compactMode:true});
});}function addRadioTextButton(name,text,title,value,checked,callback){var inputId=name+"_"+value;var $input=$("<input type='radio'/>").attr("name",name).val(value).attr("id",inputId);
callback=callback||defaultCallback;$input.on("click",function(){callback(name,$input.val());$input.trigger("close");
return false;});currentContainer.append($input);var $imageButton=$("<div />").addClass("sf-element-contextual-popout-button sfc-enabled sfc-text-button").attr("title",title).append(text);
var $label=$("<label/>").append($imageButton).attr("for",inputId);if((typeof checked==="boolean"&&checked)||value===args[name]){$input.prop("checked",true);
$imageButton.addClass("sfc-checked");}$imageButton.on("sf-touchmousedown",setActiveState);currentContainer.append($label);
}function addNullableField(name,text,noButton,title){var inputId=name;var $button=$("<input type='checkbox' />").attr("id",inputId);
var $imageButton=$("<div />").addClass("sf-element-contextual-popout-button").append(icon(name));var $label=$("<label />").append($imageButton).attr("for",inputId);
var $labelSpan=$("<span />").addClass("ValueLabel sf-element-contextual-popout-label").text(text);$label.append($labelSpan);
if(!noButton){$imageButton.addClass("sfc-enabled");}var $input=$("<input />").addClass("sf-element-contextual-popout-field").val(args[name+"Value"]);
$input.attr("type","text");$input.data("originalValue",$input.val());if(args[name]){$button.prop("checked",true);
$imageButton.addClass("sfc-checked");$labelSpan.addClass("sfc-checked");}var clearCallbackTimer=function(){var currentTimer=$input.data("timer");
if(currentTimer){window.clearTimeout(currentTimer);}};var onchange;var setCallbackTimeout=function(){clearCallbackTimer();
$input.data("timer",window.setTimeout(function(){onchange(false);},500));};onchange=function(close,value,checked){if(value===undefined||value===null){value=$input.val();
}if(checked===undefined||value===null){checked=$button.prop("checked");}defaultCallback(name,value,checked);
if(close){clearCallbackTimer();$button.trigger("close");}};$button.on("click",function(){onchange(true);
return false;});$input.on("keyup",function(e){if(e.which===13){onchange(true,null,true);return false;
}if(e.which===27){onchange(true,$input.data("originalValue"));return false;}setCallbackTimeout();return true;
});$input.on("click sf-touchmousedown",function(e){e.stopPropagation();});$imageButton.on("sf-touchmousedown",setActiveState);
currentContainer.attr("title",title||text);currentContainer.append($button);currentContainer.append($label);
currentContainer.append($input);}function addHeading(name,key,value,title){if(!key||!value){return;}var text=Spotfire.Localization.resources[key+value];
if(!text){text=value;}var $headertext=$("<span />").text(name+": ").attr("title",title);var $currentvalue=$("<span />").text(text).addClass("sf-element-contextual-popout-label");
var $header=$("<div />").addClass("sf-element-contextual-popout-heading");$header.append($headertext);
$header.append($currentvalue);currentContainer.append($header);}function addCheckBox(name,text,checkBoxId,compactMode,callback,title){var inputId=(checkBoxId!==undefined)?name+"_"+checkBoxId:name;
var $button=$("<input type='checkbox' />").attr("id",inputId);callback=callback||defaultCallback;var $imageButton=$("<div />").addClass("sf-element-contextual-popout-button sfc-enabled").attr("title",title||text).append(icon(name));
var $label=$("<label/>").append($imageButton).attr("for",inputId);var $labelSpan=$("<span />").addClass("ValueLabel sf-element-contextual-popout-label").text(text);
if(!compactMode){$label.append($labelSpan);}if(args[name]){$button.prop("checked",true);$imageButton.addClass("sfc-checked");
$labelSpan.addClass("sfc-checked");}$button.on("click",function(){callback(name,$button.prop("checked"));
$button.trigger("close");return false;});$imageButton.on("sf-touchmousedown",setActiveState);currentContainer.append($button);
currentContainer.append($label);}function addSlider(name,text,min,max){var value=args[name];var $label=$("<label />").text(text);
var $slider=$("<div/>").attr("name",name);currentContainer.append($label).append($slider);var onSlide=function(e,ui){$slider.find(".ui-slider-handle").attr("title",round(ui.value,2));
};var onStop=function(e,ui){defaultCallback(name,ui.value);};Spotfire.Slider.create($slider,{min:min,max:max,value:value,stop:onStop,slide:onSlide});
rootContainer.on("performLayout",function(){Spotfire.Slider.update($slider);return false;});}function apiWrapper(fn,checkForProperty){return function(name){if(checkForProperty&&!args.hasOwnProperty(name)){return API;
}fn.apply(null,arguments);return API;};}API={addButton:apiWrapper(addButton,true),addRadioButton:apiWrapper(addRadioButton,true),addRadioTextButton:apiWrapper(addRadioTextButton,true),addCheckBox:apiWrapper(addCheckBox,true),addFormatting:apiWrapper(addFormatting,true),addSlider:apiWrapper(addSlider,true),addNode:apiWrapper(addNode,true),addNullableField:apiWrapper(addNullableField,true),addHeading:apiWrapper(addHeading),beginRow:apiWrapper(beginRow),endRow:apiWrapper(endRow),beginSection:apiWrapper(beginSection),endSection:apiWrapper(endSection)};
return API;}function getPoint(alignment,measurements,hoverarea,mouseCoordinates){switch(alignment){case"Left":return{x:measurements.x+hoverarea.width+hoverarea.x,y:measurements.y+mouseCoordinates.y};
case"Right":return{x:measurements.x+hoverarea.x,y:measurements.y+mouseCoordinates.y};case"Top":return{x:measurements.x+mouseCoordinates.x,y:measurements.y+hoverarea.height+hoverarea.y};
default:return{x:measurements.x+mouseCoordinates.x,y:measurements.y+hoverarea.y};}}function setHoverAreas(id,accesspoints){if(!accesspoints){return;
}var accessAreas=accesspoints.map(function(accessPoint){return{position:accessPoint.position,rectangle:new Rectangle(accessPoint.left,accessPoint.top,accessPoint.width,accessPoint.height)};
});$("#"+id).data("accesspoints",accessAreas);}function getHoverArea($canvas){var $overlay=$canvas.find(".sf-element-interaction-access-area");
if($overlay.length===0){$overlay=$("<div />").addClass("sf-element sf-element-interaction-access-area").appendTo($canvas);
$overlay.on("sf-touchmousedown",function(){$overlay.addClass("sfpc-active");});$overlay.on("sf-touchmouseout",function(){$overlay.removeClass("sfpc-active");
});$overlay.on("sf-touchmouseup",function(){$overlay.removeClass("sfpc-active");});}return $overlay;}function onMouseMove(e,$trackedElement){currentTrackedElement=$trackedElement;
if(!Spotfire.isAuthorMode()){return false;}var offset=$trackedElement.offset();var accessPointAreas=$trackedElement.data("accesspoints");
if(!accessPointAreas){$(".sf-element-interaction-access-area").css("display","none");return true;}hoverarea=null;
var position;var accessPointArea=_.find(accessPointAreas,function(accessPointArea){return accessPointArea.rectangle.containsPoint(e.pageX-offset.left,e.pageY-offset.top);
});if(accessPointArea){hoverarea=accessPointArea.rectangle;position=accessPointArea.position;var $axishover=Spotfire.Visuals.ContextualPopout.getHoverArea($trackedElement.parent());
$axishover.css("display","block");var top=hoverarea.y;var left=hoverarea.x;$axishover.css({left:left,top:top,width:hoverarea.width,height:hoverarea.height});
$axishover.removeClass("sfpc-bottom").removeClass("sfpc-left").removeClass("sfpc-right").removeClass("sfpc-top");
$axishover.addClass("sfpc-"+position.toLowerCase());}else{$(".sf-element-interaction-access-area").css("display","none");
}return true;}function showPropertiesPopover(id,args,$content){args.hasSpecialPositioning=function(){return hoverarea;
};args.doSpecialPositioning=function(alignment){return getPoint(alignment,{x:currentTrackedElement.offset().left,y:currentTrackedElement.offset().top},hoverarea,{x:args.x,y:args.y});
};var onButtonMouseDown=function(){$(this).addClass("PressedButton");};var onLabelMouseDown=function(){$(this).find(".Button").addClass("PressedButton");
};var onBodyMouseUp=function(){$content.find(".PressedButton").removeClass("PressedButton");};$content.on("mousedown.contextualPopout",".Button",onButtonMouseDown);
$content.on("mousedown.contextualPopout","label",onLabelMouseDown);$(document.body).on("mouseup.contextualPopout",onBodyMouseUp);
args.runAfterDomAdded=function(){$content.trigger("performLayout");};args.beforeClose=function(){$content.off("mousedown.contextualPopout",onButtonMouseDown);
$content.off("mousedown.contextualPopout",onLabelMouseDown);$(document.body).off("mouseup.contextualPopout",onBodyMouseUp);
};args.anchor=args.node;Spotfire.Visuals.Popout.showPopout(id,args,$content);}Spotfire.Visuals.ContextualPopout.builder=builder;
Spotfire.Visuals.ContextualPopout.setHoverAreas=setHoverAreas;Spotfire.Visuals.ContextualPopout.getHoverArea=getHoverArea;
Spotfire.Visuals.ContextualPopout.onMouseMove=onMouseMove;Spotfire.Visuals.ContextualPopout.showPropertiesPopover=showPropertiesPopover;
});$(function(){var mouseX,mouseY;$(document.body).on("mousemove",function(e){mouseX=e.pageX;mouseY=e.pageY;
});Spotfire.registerNameSpace("Cursor",{getX:function(){return mouseX;},getY:function(){return mouseY;
}});});$(function(){function CustomSortOrderControl(){var controls={};var serverSettings;var userInput=(function(){var inputEnabled=true;
var inputEnabledEvent=jQuery.Event("inputEnabled");return{enabled:function(enabled){if(enabled!==undefined){inputEnabled=enabled;
controls.dialog.trigger(inputEnabledEvent);}return inputEnabled;}};}());var SelectedIndicesClass=function(){var indices=[];
var capacity=0;var contains=function(index){var i;for(i=0;i<indices.length;i++){if(indices[i]===index){return true;
}}return false;};this.add=function(ranges){if(typeof ranges==="number"){if(!contains(ranges)){indices.push(ranges);
}return;}var j,i,range;for(j=0;j<ranges.length;j++){range=ranges[j];if(range.operation==="remove"){indices=[];
return;}if(range.operation==="replace"){indices=[];}for(i=Math.max(0,range.low);i<=Math.min(range.high,this.capacity()-1);
i++){if(!contains(i)){indices.push(i);}}}};this.set=function(selectedIndices){indices=selectedIndices;
};this.clear=function(){indices=[];};this.get=function(){return indices;};this.move=function(move){var i;
for(i=0;i<indices.length;i++){indices[i]=indices[i]+move;}};this.moveFirst=function(){var i;for(i=0;i<indices.length;
i++){indices[i]=i;}};this.moveLast=function(){var i;var offset=this.capacity()-indices.length;for(i=0;
i<indices.length;i++){indices[i]=offset+i;}};this.count=function(){return indices.length;};this.capacity=function(count){if(count!==undefined){capacity=count;
}return capacity;};this.contains=contains;};this.show=function(settings){serverSettings=settings;var selected=new SelectedIndicesClass();
var addButton=function(text,visibility,action,parentContainer,margin){var $button=$("<button/>");$button.append($("<span style='width=100%'/>").text(text)).attr("title",text);
$button.addClass("whiteButton");$button.attr("disabled","disabled");$button.css("visibility",visibility);
$button.click(action);$button.css("width","100px");$button.css("height","25px");$button.css("display","block");
$button.css("margin-bottom",margin);parentContainer.append($button);return $button;};var listBox;var moveUpAction=function(){if(selected.count()>0){var selectedIndices=selected.get();
var indicesInRange=true;$.each(selectedIndices,function(index,item){if(item===0){indicesInRange=false;
}});if(indicesInRange){var args={indices:selectedIndices};Spotfire.Dxp.Web.Forms.AjaxService.Modify(serverSettings.viewId,"MoveUp",JSON.stringify(args));
selected.move(-1);userInput.enabled(false);}}};var moveDownAction=function(){if(selected.count()>0){var selectedIndices=selected.get();
var indicesInRange=true;var lastIndex=selected.capacity()-1;$.each(selectedIndices,function(index,item){if(item===lastIndex){indicesInRange=false;
}});if(indicesInRange){var args={indices:selectedIndices};Spotfire.Dxp.Web.Forms.AjaxService.Modify(serverSettings.viewId,"MoveDown",JSON.stringify(args));
selected.move(1);userInput.enabled(false);}}};var moveFirstAction=function(){if(selected.count()>0){var args={indices:selected.get()};
Spotfire.Dxp.Web.Forms.AjaxService.Modify(serverSettings.viewId,"MoveFirst",JSON.stringify(args));selected.moveFirst();
userInput.enabled(false);}};var moveLastAction=function(){if(selected.count()>0){var args={indices:selected.get()};
Spotfire.Dxp.Web.Forms.AjaxService.Modify(serverSettings.viewId,"MoveLast",JSON.stringify(args));selected.moveLast();
userInput.enabled(false);}};var moveToAction=function(dest){if(selected.count()===1&&(selected.contains(dest)||selected.contains(dest-1))){return;
}var selectedIndices=selected.get();var args={indices:selectedIndices,to:dest};Spotfire.Dxp.Web.Forms.AjaxService.Modify(serverSettings.viewId,"MoveTo",JSON.stringify(args));
selected.clear();listBox.clearSelection();userInput.enabled(false);};var reverseAction=function(){Spotfire.Dxp.Web.Forms.AjaxService.Modify(serverSettings.viewId,"Reverse");
selected.clear();userInput.enabled(false);};var $container=$("<div/>");var $content=Spotfire.Flex.item({container:"horizontal"});
$content.addClass("CustomSortOrderControl sf-element-dialog");$container.append($content);controls.dialog=$container;
controls.control=$content;controls.listBox=Spotfire.Flex.item({grow:true});$content.append(controls.listBox);
var $rightDiv=Spotfire.Flex.item({shrink:false});$rightDiv.addClass("buttons");$content.append($rightDiv);
controls.moveUpButton=addButton(Spotfire.Localization.resources.CustomSortOrder_MoveUp,"visible",moveUpAction,$rightDiv,"8px");
controls.moveDownButton=addButton(Spotfire.Localization.resources.CustomSortOrder_MoveDown,"visible",moveDownAction,$rightDiv,"16px");
controls.moveFirstButton=addButton(Spotfire.Localization.resources.CustomSortOrder_MoveFirst,"visible",moveFirstAction,$rightDiv,"8px");
controls.moveLastButton=addButton(Spotfire.Localization.resources.CustomSortOrder_MoveLast,"visible",moveLastAction,$rightDiv,"16px");
controls.reverseButton=addButton(Spotfire.Localization.resources.CustomSortOrder_Reverse,"visible",reverseAction,$rightDiv,"16px");
var enableControl=function(control,enabled){if(!control){return;}if(enabled){control.removeAttr("disabled");
}else{control.attr("disabled","disabled");}};var enableControls=function(){if(userInput.enabled()){enableControl(controls.moveUpButton,selected.count()>0&&!selected.contains(0));
enableControl(controls.moveDownButton,selected.count()>0&&!selected.contains(selected.capacity()-1));
enableControl(controls.moveFirstButton,selected.count()>0&&selected.capacity()>1);enableControl(controls.moveLastButton,selected.count()>0&&selected.capacity()>1);
}else{enableControl(controls.moveUpButton,false);enableControl(controls.moveDownButton,false);enableControl(controls.moveFirstButton,false);
enableControl(controls.moveLastButton,false);}enableControl(controls.reverseButton,userInput.enabled()&&selected.capacity()>1);
};var buttons=[{text:Spotfire.Localization.resources.Ok,isDefault:true,click:function(){Spotfire.Dxp.Web.Forms.AjaxService.Modify(serverSettings.viewId,"Commit");
controls.dialog.remove();}},{text:Spotfire.Localization.resources.Cancel,isCancel:true,click:function(){controls.dialog.remove();
}}];var getListboxItemCount=function(){var controlPadding=controls.control.outerHeight()-controls.control.height();
var listboxScrollable=$(".sfc-scrollable",controls.listBox);var listboxPadding=listboxScrollable.outerHeight()-listboxScrollable.height();
var newViewportHeight=controls.dialog.parent().height()-controlPadding-listboxPadding;var newItemCount=Math.max(Math.floor(newViewportHeight/listBox.itemHeight()),1);
return newItemCount;};var resizeListbox=function(force){var newItemCount=getListboxItemCount();if(force||(listBox.height()!==newItemCount)){listBox.update({height:newItemCount});
}};Spotfire.Controls.ModalDialog.initialize(controls.dialog,{dialogClass:"CustomSortOrderDialog",modal:true,title:Spotfire.Localization.resources.CustomSortOrder_Title,buttons:buttons,resizable:true,minWidth:400,minHeight:350,resize:_.throttle(_.partial(resizeListbox,false),100),resizeStop:_.partial(resizeListbox,true)});
var getValues=function(low,high,generation,callback){var args={low:low,high:high};var ready=function(data){var selectedIndices=selected.get();
var topIndex=data.TopIndex;var i,index;for(i=0;i<data.Items.length;i++){index=topIndex+i;if($.inArray(index,selectedIndices)>-1){data.Items[i].Selected=true;
}}selected.capacity(data.TotalItemCount);userInput.enabled(true);enableControls();callback(data);};Spotfire.Dxp.Web.Forms.AjaxService.Read(serverSettings.viewId,"GetValues",JSON.stringify(args),ready);
};var invalidateListBox=function(){listBox.update();var args={low:0,high:0};var ready=function(data){selected.capacity(data.TotalItemCount);
listBox.update({totalVisibleValues:data.TotalItemCount});};Spotfire.Dxp.Web.Forms.AjaxService.Read(serverSettings.viewId,"GetValues",JSON.stringify(args),ready);
};listBox=Spotfire.Controls.VirtualListBox.create(controls.listBox,{multiSelect:true,onGetValues:getValues,onSelectionChanged:function(selectedIndices){selected.add(selectedIndices);
enableControls();},allowDragDrop:true,onDragDrop:function(data,to){moveToAction(to);}});listBox.update({height:getListboxItemCount()});
invalidateListBox();this.update=function(settings){serverSettings=settings;invalidateListBox();};};return this;
}Spotfire.registerNameSpace("Controls.CustomSortOrderControl",{show:function(settings){var dialog=new CustomSortOrderControl();
dialog.show(settings);var content=$(".CustomSortOrderControl");content.data("dialog",dialog);},update:function(settings){var content=$(".CustomSortOrderControl");
if(content.length>0){var dialog=content.data("dialog");dialog.update(settings);}}});});$(function(){function CustomView($parent,viewId){var eventHandlers={};
var ensureString=function(obj){if(obj===null){return null;}return typeof obj==="string"?obj:JSON.stringify(obj);
};var sdk={read:function(method,args,callback){Spotfire.Dxp.Web.Forms.AjaxService.Read(viewId,method,ensureString(args),callback);
},modify:function(method,args){Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,method,ensureString(args));
},addEventHandler:function(name,handler){if(typeof name==="string"&&typeof handler==="function"){if(eventHandlers[name]===undefined){eventHandlers[name]=[];
}eventHandlers[name].push(handler);}}};$("<iframe/>").attr({src:"CustomView/"+(Ajax.DocumentId||"NoDocumentId")+"/"+(Ajax.DocumentViewId||"NoDocumentViewId")+"/"+viewId+"/",sandbox:"allow-scripts allow-same-origin allow-popups allow-forms",name:"sf-custom-visual-frame"}).on("load",function(){var win=this.contentWindow;
win.Spotfire=sdk;win.dispatchEvent(new window.CustomEvent("SpotfireLoaded"));var $iframeBody=$(win.document.body);
$iframeBody.on("dragenter",function(e){$parent.trigger("dragenter",[e]);});$iframeBody.on("mousedown",function(e){$parent.trigger("mousedown",[e]);
});}).appendTo($parent).css({width:"100%",height:"100%",border:"0"});return{invokeEventHandler:function(name,args){if(eventHandlers[name]!==undefined){$.each(eventHandlers[name],function(){this(args);
});}}};}var initialize=function(id,settings){var $parent=$("#"+id).empty();$parent.data("customView",new CustomView($parent,settings.viewId));
};var invokeEventHandler=function(id,eventArgs){var customView=$("#"+id).data("customView");if(customView!==undefined&&customView!==null){customView.invokeEventHandler(eventArgs.name,eventArgs.args);
}};Spotfire.registerNameSpace("Visuals.CustomView",{initialize:initialize,invokeEventHandler:invokeEventHandler});
});$(function(){function DataAccessSettingsControl(){var viewId;var settings;var scrollbar;var $mainLayout;
var $accordion;var $scrollableContainer;var $expandedSettings;var $currentStateText;var topInfoIconClassName="sf-DataAccessSettings-TopInformation-Icon";
var updateCachingIcon=function($iconContainer,cachingBehavior){$iconContainer.empty();Spotfire.getSvg("Images/Data/"+Spotfire.DataOverview.EditTable.getDataCachingBehaviorIcon({name:cachingBehavior}),function($svg){$svg.appendTo($iconContainer);
});};var updateToggleSettings=function($iconContainer,$textContainer,isCompact){$iconContainer.empty();
var icon=isCompact?"Images/Data/DataAccessSettingsExpand.svg":"Images/Data/DataAccessSettingsCollapse.svg";
Spotfire.getSvg(icon,function($svg){$svg.attr("class","sf-DataAccessSettings-ToggleSettings-IconSvg").appendTo($iconContainer);
});var text=isCompact?Spotfire.Localization.resources.DataAccessSettings_ExpandSettings:Spotfire.Localization.resources.DataAccessSettings_CollapseSettings;
$textContainer.text(text);};var updateCachingDropdown=function($dropdownContainer,cachingBehavior){var newSettings={selectedValue:cachingBehavior};
Spotfire.Controls.DropDown.update($dropdownContainer,newSettings);};var setCurrentStateText=function(){if(settings.aggregatedCachingBehavior==="Linked"){$currentStateText.text(Spotfire.Localization.resources.DataAccessSettings_NeedsAccessTrue);
}else{if(settings.aggregatedCachingBehavior==="Cached"){$currentStateText.text(Spotfire.Localization.resources.DataAccessSettings_NeedsAccessFalse);
}else{if(settings.aggregatedCachingBehavior==="Embedded"){$currentStateText.text(Spotfire.Localization.resources.DataAccessSettings_AllDataEmbedded);
}}}};var addColumn=function($row,className,fixedSize){var args=fixedSize?{shrink:false}:{grow:true};return Spotfire.Flex.item(args).addClass("sf-DataAccessSettings-Column").addClass(className).appendTo($row);
};this.initInPlace=function($d,theViewId,newSettings){viewId=theViewId;settings=newSettings;$mainLayout=Spotfire.Flex.item({container:"vertical","align-items":"stretch"}).appendTo($d);
var $information=Spotfire.Flex.item({container:"horizontal","align-items":"center",shrink:false}).addClass("sf-DataAccessSettings-TopInformation").appendTo($mainLayout);
var $leftInformation=Spotfire.Flex.item({shrink:false}).addClass("sf-DataAccessSettings-TopInformationLeft").appendTo($information);
var $rightInformation=Spotfire.Flex.item({grow:true}).addClass("sf-DataAccessSettings-TopInformationRight").appendTo($information);
var $infoIcon=$("<div/>").addClass(topInfoIconClassName).appendTo($leftInformation);updateCachingIcon($infoIcon,settings.aggregatedCachingBehavior);
$currentStateText=$("<div/>").addClass("sf-DataAccessSettings-TopInformation-Row sf-DataAccessSettings-TopInformation-CurrentState").appendTo($rightInformation);
setCurrentStateText();if(settings.allowCompactMode){var $expandCollapseSettings=Spotfire.Flex.item({container:"horizontal"}).addClass("sf-DataAccessSettings-ToggleSettings").appendTo($mainLayout);
var $expandClickable=Spotfire.Flex.item({container:"horizontal","align-items":"center",shrink:false}).addClass("sf-DataAccessSettings-ToggleSettings-Clickable").appendTo($expandCollapseSettings);
var toggleIcon=$("<div/>").addClass("sf-DataAccessSettings-ToggleSettings-IconContainer").appendTo($expandClickable);
var toggleText=$("<div/>").addClass("sf-DataAccessSettings-ToggleSettings-Text").appendTo($expandClickable);
updateToggleSettings(toggleIcon,toggleText,settings.isCompact);$expandClickable.on("click",function(){Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,"ToggleCompactMode",JSON.stringify({}));
});}$expandedSettings=Spotfire.Flex.item({container:"vertical","align-items":"stretch",grow:true}).appendTo($mainLayout);
$("<div/>").addClass("sf-DataAccessSettings-DataTablesInAnalysisLabel").text(Spotfire.Localization.resources.DataAccessSettings_DataTablesInAnalysis).appendTo($expandedSettings);
$accordion=Spotfire.Flex.item({grow:true}).addClass("sf-DataAccessSettings-Sources").appendTo($expandedSettings);
$scrollableContainer=$("<div/>").addClass("sf-DataAccessSettings-ScrollableContainer").appendTo($accordion);
var $scrollableContent=$("<div/>").addClass("sf-DataAccessSettings-ScrollableContent").appendTo($scrollableContainer);
settings.tables.forEach(function(table){var $tableSourceGroup=$("<div/>").addClass("sf-DataAccessSettings-TableSourceGroup").appendTo($scrollableContent);
var $tableRow=Spotfire.Flex.item({container:"horizontal","align-items":"center"}).addClass("sf-DataAccessSettings-TableRow").appendTo($tableSourceGroup);
var setToggleIcon=function($container,expanded){$container.empty();var path=expanded?"Images/Data/DataAccessSettingsTableCollapse.svg":"Images/Data/DataAccessSettingsTableExpand.svg";
Spotfire.getSvg(path,function($svg){$svg.attr("class","sf-DataAccessSettings-ToggleIcon").appendTo($container);
});};var $expandCollapse=addColumn($tableRow,"sf-DataAccessSettings-Toggle",true);var $sourceGroup;if(table.sources.length>0){var expanded=true;
$sourceGroup=$("<div/>").addClass("sf-DataAccessSettings-SourceGroup").appendTo($tableSourceGroup);$tableRow.addClass("sf-DataAccessSettings-Expandable").on("click",function(){if(expanded){expanded=false;
$sourceGroup.off().slideUp(100,function(){scrollbar.refresh();});setToggleIcon($expandCollapse,false);
}else{expanded=true;$sourceGroup.off().slideDown(100,function(){scrollbar.refresh();});$sourceGroup.find(".sf-DataAccessSettings-CachingDropdownContainer").each(function(){Spotfire.Controls.DropDown.update($(this),{});
});setToggleIcon($expandCollapse,true);}scrollbar.refresh();});setToggleIcon($expandCollapse,true);}addColumn($tableRow,"sf-DataAccessSettings-TableName",false).text(table.name).attr("title",table.name);
if(table.external||table.embedded){var $tableTypeCell=addColumn($tableRow,"sf-DataAccessSettings-TableType",true);
if(table.external){$tableTypeCell.text(Spotfire.Localization.resources.DataAccessSettings_TableExternal);
}else{if(table.embedded){$tableTypeCell.text(Spotfire.Localization.resources.DataAccessSettings_TableEmbedded);
}}}table.sources.forEach(function(producer){var $srcRow=Spotfire.Flex.item({container:"horizontal","align-items":"stretch"}).addClass("sf-DataAccessSettings-SourceRow").appendTo($sourceGroup);
var $listView=Spotfire.Flex.item({shrink:false,container:"vertical","align-items":"stretch"}).addClass("sf-DataAccessSettings-Column sf-DataAccessSettings-SourceList").appendTo($srcRow);
Spotfire.Flex.item({grow:true}).addClass("sf-DataAccessSettings-SourceListTop").appendTo($listView);Spotfire.Flex.item({grow:true}).addClass("sf-DataAccessSettings-SourceListBottom").appendTo($listView);
var $srcRowContent=Spotfire.Flex.item({container:"horizontal",grow:true,"align-items":"center"}).addClass("sf-DataAccessSettings-SourceRowContent").appendTo($srcRow);
addColumn($srcRowContent,"sf-DataAccessSettings-SourceName",false).text(producer.displayName).attr("title",producer.displayName);
if(producer.cachingBehavior!==undefined){var $cachingBehaviorIcon=addColumn($srcRowContent,"sf-DataAccessSettings-CachingIcon",true);
$cachingBehaviorIcon.attr("id",producer.id+"-CachingIcon");updateCachingIcon($cachingBehaviorIcon,producer.cachingBehavior);
}var $cachingBehaviorCell=addColumn($srcRowContent,"sf-DataAccessSettings-Caching",true);if(producer.label!==undefined){$cachingBehaviorCell.addClass("sf-DataAccessSettings-CachingLabel");
$cachingBehaviorCell.text(producer.label);}else{if(producer.cachingBehavior!==undefined){if(producer.allowedCachingBehavior.length===1){$cachingBehaviorCell.addClass("sf-DataAccessSettings-CachingLabel");
$cachingBehaviorCell.text(producer.allowedCachingBehavior[0].text);}else{var selectCachingBehavior=function(behavior){var args={tableId:table.id,producerId:producer.id,cachingBehavior:behavior};
Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,"SetCachingBehavior",JSON.stringify(args));};var $dropdown=$("<div/>").addClass("sf-DataAccessSettings-CachingDropdownContainer").appendTo($cachingBehaviorCell);
$dropdown.attr("id",producer.id+"-CachingDropdown");Spotfire.Controls.DropDown.initialize($dropdown,{values:producer.allowedCachingBehavior,selectedValue:producer.cachingBehavior,onSelected:selectCachingBehavior});
}}}var $reloadCell=addColumn($srcRowContent,"sf-DataAccessSettings-Reload",true);if(producer.dataLoadTimeStamp!==undefined){$reloadCell.text(Spotfire.Utilities.formatString(Spotfire.Localization.resources.DataAccessSettings_LastReload,producer.dataLoadTimeStamp));
}});});if(settings.batchCachingBehaviors){var $batchChangeRow=Spotfire.Flex.item({container:"horizontal","align-items":"center",shrink:false}).addClass("sf-DataAccessSettings-BatchChange").appendTo($expandedSettings);
addColumn($batchChangeRow,"",true).text(Spotfire.Localization.resources.DataAccessSettings_BatchChange);
var $cachingColumn=addColumn($batchChangeRow,"sf-DataAccessSettings-Caching",true);var selectBatchCachingBehavior=function(behavior){var args={cachingBehavior:behavior};
Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,"SetBatchCachingBehavior",JSON.stringify(args));};var $batchDropdown=$("<div/>").addClass("sf-DataAccessSettings-BatchChangeDropdown").appendTo($cachingColumn);
Spotfire.Controls.DropDown.initialize($batchDropdown,{values:settings.batchCachingBehaviors,onSelected:selectBatchCachingBehavior});
}$mainLayout.width(settings.width);$mainLayout.height(settings.height);$scrollableContainer.width($accordion.width());
$scrollableContainer.height($accordion.height());if(settings.allowCompactMode&&settings.isCompact){$expandedSettings.hide();
}scrollbar=$scrollableContainer.StyledScrollbar();};this.updateNeedsSourceAccess=function(newSettings){settings=newSettings;
updateCachingIcon($("."+topInfoIconClassName),settings.aggregatedCachingBehavior);setCurrentStateText();
updateToggleSettings($(".sf-DataAccessSettings-ToggleSettings-IconContainer"),$(".sf-DataAccessSettings-ToggleSettings-Text"),settings.isCompact);
if(settings.allowCompactMode){if(settings.isCompact){$expandedSettings.hide();}else{$expandedSettings.show();
$scrollableContainer.width($accordion.width());$scrollableContainer.height($accordion.height());}}settings.tables.forEach(function(table){table.sources.forEach(function(producer){if(producer.cachingBehavior!==undefined){updateCachingIcon($("#"+producer.id+"-CachingIcon"),producer.cachingBehavior);
updateCachingDropdown($("#"+producer.id+"-CachingDropdown"),producer.cachingBehavior);}});});if(settings.batchCachingBehaviors&&settings.clearBatchChange){Spotfire.Controls.DropDown.update($(".sf-DataAccessSettings-BatchChangeDropdown"),{selectedValue:null});
}scrollbar.refresh();};this.handleResize=function(width,height){$mainLayout.width(width);$mainLayout.height(height);
$scrollableContainer.width($accordion.width());$scrollableContainer.height($accordion.height());scrollbar.refresh();
};return this;}Spotfire.registerNameSpace("Controls.DataAccessSettingsControl",{initInPlace:function(viewId,settings){$(document.body).css("overflow","hidden");
var $dialog=$("#"+viewId);var dialog=new DataAccessSettingsControl();dialog.initInPlace($dialog,viewId,settings);
$dialog.data("dialog",dialog);},handleResize:function(viewId,args){var $content=$(".sf-DataAccessSettingsControl");
if($content.length>0){var dialog=$content.data("dialog");dialog.handleResize(args.width,args.height);
}},updateNeedsSourceAccess:function(viewId,settings){var $content=$(".sf-DataAccessSettingsControl");
if($content.length>0){var dialog=$content.data("dialog");dialog.updateNeedsSourceAccess(settings);}}});
});$(function(){Spotfire.registerNameSpace("DataOverview",{create:function(parent,viewId,modeSelectorOnClick){var dataOverviewId=viewId+"dataoverview";
$("#"+dataOverviewId).remove();var $overview;var editTable=Spotfire.DataOverview.EditTable.create(viewId);
var side;var resizeFuncs=[];var fitInsideContainer=function($overviewPanelArea){var $page=$overviewPanelArea.closest(".sf-element-page");
if($overviewPanelArea.hasClass("sfpc-left")){var start=$overviewPanelArea.offset().left-$page.offset().left;
var end=start+$overviewPanelArea.outerWidth();if(end>=$page.width()){$overviewPanelArea.width($overviewPanelArea.width()-(end-$page.width()));
return true;}}else{if($overviewPanelArea.offset().left<$page.offset().left){var diff=$page.offset().left-$overviewPanelArea.offset().left;
$overviewPanelArea.width($overviewPanelArea.width()-diff);return true;}}return false;};var resizeFuncImpl=function(){resizeFuncs.forEach(function(f){f();
});};var setWidthImpl=function(width,$panelArea){var sendEvents=false;if($panelArea.length){if($panelArea.outerWidth()!==width){$panelArea.width(width);
sendEvents=true;}if(fitInsideContainer($panelArea)){sendEvents=true;}}return sendEvents;};var resizeFunc=_.debounce(resizeFuncImpl,100,false);
var initializeContainer=function(settings){resizeFuncs=[];var $page=parent.closest(".sf-element-page");
$page.off(".sf-data-overview");var $overviewContainer=$("<div/>").addClass("sf-element sf-element-data-overview").appendTo($page);
if(Spotfire.capabilities.supportsDropShadow()){$overviewContainer.addClass("sf-dataoverview-dropshadow");
}$overviewContainer.on("contextmenu",function(e){e.preventDefault();});$overviewContainer.attr("id",dataOverviewId);
$overviewContainer.attr("viewId",viewId);$overview=Spotfire.Flex.item({container:"vertical"}).addClass("sf-dataoverview").appendTo($overviewContainer);
var $fakePanelArea=$overviewContainer;var prevPageHeight;var setHeight=function($page){var pageHeight=$page.sfBoxHeight();
if(_.isNumber(prevPageHeight)&&prevPageHeight===pageHeight){return false;}$fakePanelArea.height(pageHeight-2*$fakePanelArea.position().top);
prevPageHeight=pageHeight;return true;};var resizeEnd=function(){settings.width=$fakePanelArea.outerWidth();
var args={width:settings.width};Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,"SetDataOverviewWidth",JSON.stringify(args));
};var $panelArea=parent.closest(".sf-element-panel-area");var $firstPanelHeader=$(".sf-element-panel.sfpc-first .sf-element-panel-header");
var $dataPanelHeader=$(".sf-element-data-panel-header",parent);var $hider=$("<div/>").appendTo($fakePanelArea).css({position:"fixed",top:$dataPanelHeader.offset().top,width:"1px",height:$dataPanelHeader.outerHeight()});
var $resizeHandle=$("<div/>").addClass("sf-dataoverview-ResizeIndicator").appendTo($overviewContainer);
var handles;$fakePanelArea.css("top",$firstPanelHeader.height());if($panelArea.hasClass("sfpc-left")){side="left";
$fakePanelArea.addClass("sfpc-left");handles="e";$hider.css({left:$dataPanelHeader.offset().left+$dataPanelHeader.outerWidth(),"background-color":settings.style[side].backgroundColor});
$fakePanelArea.css("left",$panelArea.offset().left+$panelArea.outerWidth());}else{side="right";$fakePanelArea.addClass("sfpc-right");
handles="w";$hider.css({right:$dataPanelHeader.outerWidth(),"background-color":settings.style[side].backgroundColor});
$fakePanelArea.css("right",$panelArea.outerWidth());}Spotfire.Touch.resizable($fakePanelArea,{minWidth:settings.editTableMode?550:150,handles:handles,drag:resizeFunc,stop:resizeEnd,containment:$page});
setHeight($page);setWidthImpl(settings.width,$fakePanelArea);$resizeHandle.css("color",settings.style.headerButtonColor);
Spotfire.getSvg("Images/Data/ResizeHandle.svg",function($svg){$resizeHandle.empty().append($svg);});$overviewContainer.css("background-color",settings.style[side].backgroundColor);
$overviewContainer.css("border-color",settings.style[side].borderColor);var onResizePage=_.debounce(function(){var changesH=setHeight($(this));
var changesW=setWidthImpl(settings.width,$(".sf-element-data-overview",$(this)));if(changesH||changesW){resizeFuncImpl();
}},100,false);$page.on("sf-resize.sf-data-overview",onResizePage);return $fakePanelArea;};var addHorizLine=function($parent,settings){var $container=$("<div/>").addClass("sf-dataoverview-HorizLineContainer").appendTo($parent);
$("<div/>").addClass("sf-dataoverview-HorizLine").css("background-color",settings.style[side].horizLineColor).appendTo($container);
};var updateColumnHeader=function(column,settings){var $columnHeader=Spotfire.Flex.item({shrink:false}).addClass("sf-dataoverview-ColumnHeader sf-element-data-overview-header").appendTo($overview);
var $columnName=$("<div/>").addClass("sf-dataoverview-ColumnName").appendTo($columnHeader);var $columnNameText=$("<div/>").addClass("sf-dataoverview-ColumnNameText").attr("title",column.name).text(column.name).appendTo($columnName);
var $columnNameInput=$("<input/>").attr("type","text");var $renameButton=$("<div/>").addClass("sf-dataoverview-HeaderButton sf-element sf-element-button").attr("title",Spotfire.Localization.resources.DataOverview_RenameColumnTooltip).appendTo($columnHeader);
Spotfire.getSvg("Images/Data/DataOverviewEdit.svg",function($svg){$renameButton.empty().append($svg);
});var buttonsWidth=$renameButton.outerWidth();var $deleteButton;if(column.allowDelete){$deleteButton=$("<div/>").addClass("sf-dataoverview-HeaderButton sf-element sf-element-button").attr("title",Spotfire.Localization.resources.DataOverview_DeleteColumnTooltip).appendTo($columnHeader);
Spotfire.getSvg("Images/Data/DataOverviewDelete.svg",function($svg){$deleteButton.empty().append($svg);
});buttonsWidth+=$deleteButton.outerWidth();}var $tableSelector=$("<span/>").addClass("sf-dataoverview-TableHeaderSelector").css("color",settings.style.accentColor).text(Spotfire.Localization.resources.DataOverview_NavigateToTable).attr("title",Spotfire.Localization.resources.DataOverview_NavigateToTable).appendTo($columnHeader);
$tableSelector.click(function(){Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,"ClearColumnSelection","");
});var resizeColumnName=function(){var maxSize=$columnHeader.width()-buttonsWidth-30;$columnName.css("max-width",maxSize+"px");
};resizeColumnName();resizeFuncs.push(resizeColumnName);var startEditingName=function(){$columnNameInput.val(column.name);
$columnNameInput.height($columnNameText.height());$columnNameInput.width($columnNameText.innerWidth());
$columnNameText.detach();$columnNameInput.appendTo($columnName);$columnNameInput.focus();$columnNameInput.select();
};$columnNameText.on("dblclick",startEditingName);$renameButton.on("click",startEditingName);$columnNameInput.on("keydown",function(e){if(e.keyCode===13){$(this).blur();
}else{var maxSize=$columnHeader.width()-buttonsWidth-30;var $tmp=$("<span/>").text($columnNameInput.val()).hide().appendTo($columnName);
var newWidth=Math.min(maxSize,$tmp.innerWidth());if(newWidth>$columnNameInput.innerWidth()){$columnNameInput.width(newWidth);
}$tmp.remove();}});$columnNameInput.on("blur",function(){var newColumnName=$.trim($columnNameInput.val());
if(newColumnName===""||newColumnName===column.name){$columnNameInput.detach();$columnNameText.appendTo($columnName);
return;}var args={tableId:settings.tableId,columnId:column.id,newName:newColumnName};Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,"RenameColumn",JSON.stringify(args));
});if($deleteButton){$deleteButton.on("click",function(){var args={tableId:settings.tableId,columnId:column.id};
if(Spotfire.isWebPlayer()){Spotfire.Dxp.Web.Forms.AjaxService.Read(viewId,"IsAnyCalculatedColumnDependentOnColumns",JSON.stringify(args),function(result){if(result){Spotfire.ConfirmDialog.showYesNoCancelDialog(Spotfire.Localization.resources.DataPanel_DeleteDialog_Title,Spotfire.Localization.resources.DataPanel_DeleteDialog_HideOrDelete,function(){Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,"HideColumn",JSON.stringify(args));
},function(){Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,"DeleteColumn",JSON.stringify(args));});
}else{var text=Spotfire.Utilities.formatString(Spotfire.Localization.resources.DataPanel_DeleteDialog_ColumnFormatString,column.name);
Spotfire.ConfirmDialog.showOkCancelDialog(Spotfire.Localization.resources.DataPanel_DeleteDialog_Title,text,function(){Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,"DeleteColumn",JSON.stringify(args));
});}});}else{Spotfire.PageBus.publish("spotfire.dataoverview.deletecolumn",args,viewId);}});}addHorizLine($overview,settings);
};var addBox=function(title,additionalClass){var $box=$("<div/>").addClass("sf-dataoverview-Box");if(additionalClass){$box.addClass(additionalClass);
}if(title){$("<div/>").addClass("sf-dataoverview-BoxHeader").text(title).appendTo($box);}return $box;
};var modalDialog;var showCalculatedColumnDialog=function(settings,editMode,column){if(Spotfire.isWebPlayer()){var $dialog=$("<div/>").addClass("CustomExpressionDialog");
var ok;var editor=Spotfire.Controls.CustomExpressionEditor.create({ApplyAndClose:function(){ok();},ExpressionFont:settings.expressionFont,InitialExpression:editMode?column.expression:"",ProvideIntellisense:function(args,callback){args.tableId=settings.tableId;
Spotfire.Dxp.Web.Forms.AjaxService.Read(viewId,"ProvideIntellisense",JSON.stringify(args),callback);}});
var $textBox=editor.TextBox;var $error=editor.Error;var $dialogContainer=Spotfire.Flex.item({container:"vertical",fill:true}).appendTo($dialog);
Spotfire.Flex.item({}).text(Spotfire.Localization.resources.DataOverview_ExpressionHeader).appendTo($dialogContainer);
var $expressionContainer=Spotfire.Flex.item({grow:true}).addClass("sf-dataoverview-expressioncontainer sf-element-input").appendTo($dialogContainer);
$expressionContainer.click(function(){editor.Focus();});$expressionContainer.append($textBox);$expressionContainer.append($error);
var $resultColumnNameInput;if(!editMode){var $resultColumnNameContainer=Spotfire.Flex.item({shrink:false}).css({width:"100%"}).appendTo($dialogContainer);
$resultColumnNameContainer.append($("<div/>").text(Spotfire.Localization.resources.DataOverview_ColumnName));
$resultColumnNameInput=$("<input/>").addClass("sf-element-input").attr("type","text").css({width:"100%","box-sizing":"border-box"});
$resultColumnNameContainer.append($resultColumnNameInput);}var showHelp=function(){Spotfire.Web.showHelp("5001037");
};ok=function(){$error.empty();var expr=editor.GetExpression();var args={tableId:settings.tableId,editMode:editMode,expression:expr};
if(editMode){args.columnId=column.id;}else{args.name=$resultColumnNameInput.val();}var tryParse=function(result){if(result.valid){if(!editMode){args.resultColumnName=result.resultColumnName;
}Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,"AddOrEditCalculatedColumn",JSON.stringify(args));modalDialog.close();
}else{$error.text(result.message);}};Spotfire.Dxp.Web.Forms.AjaxService.Read(viewId,"ValidateCalculatedColumnExpression",JSON.stringify(args),tryParse);
return true;};var onOpen=function(){editor.OnOpen();};var onClosed=function(){editor.OnClose();};var buttons=[{text:Spotfire.Localization.resources.Ok,click:ok,isDefault:true},{text:Spotfire.Localization.resources.Cancel,isCancel:true}];
var title=editMode?Spotfire.Localization.resources.DataOverview_EditExpression:Spotfire.Localization.resources.DataOverview_AddColumnFromExpression;
modalDialog=Spotfire.Controls.ModalDialog.initialize($dialog,{title:title,minWidth:593,minHeight:384,height:384,modal:true,resizable:true,buttons:buttons,open:onOpen,close:onClosed,help:showHelp,preventAutoClose:function(){return editor.HasFocus();
}});}else{var args={tableId:settings.tableId,editMode:editMode};if(editMode){args.columnId=column.id;
}Spotfire.PageBus.publish("spotfire.dataoverview.addoreditcalculatedcolumn",args,viewId);}};var createCategoryControl=function($parent,column,settings){var $category=addBox(Spotfire.Localization.resources.DataOverview_CategorizeColumnHeader,"sf-dataoverview-Category sfpc-first").appendTo($parent);
var $categoryLayout=Spotfire.Flex.item({container:"horizontal",fill:true,grow:true,"align-items":"center"}).appendTo($category);
var $categoryDropdownContainer=Spotfire.Flex.item({grow:true}).addClass("sf-dataoverview-Dropdown sfpc-last").appendTo($categoryLayout);
var $categoryDropdown=$("<div/>").appendTo($categoryDropdownContainer);var currentCategoryIndex=column.categoryIndex;
var onCategorySelected=function(item,index){if(index!==currentCategoryIndex){currentCategoryIndex=index;
var args={tableId:settings.tableId,columnId:column.id,category:column.categories[index].id};Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,"ColumnCategorization",JSON.stringify(args));
}};Spotfire.Controls.DropDown.initialize($categoryDropdown,{values:column.categories,useIndexAsValueId:true,selectedIndex:column.categoryIndex,onSelected:onCategorySelected});
return $category;};var createDataTypeControl=function($parent,column,settings){var $dataType=addBox(Spotfire.Localization.resources.DataOverview_DataTypeHeader,"sf-dataoverview-DataType").appendTo($parent);
if(column.allowChangeDataType){var $dataTypeLayout=Spotfire.Flex.item({container:"horizontal",fill:true,grow:true,"align-items":"center"}).appendTo($dataType);
var $dataTypeDropdownContainer=Spotfire.Flex.item({grow:true}).addClass("sf-dataoverview-Dropdown sfpc-last").appendTo($dataTypeLayout);
var $dataTypeDropdown=$("<div/>").appendTo($dataTypeDropdownContainer);var $dataTypeButton=Spotfire.Flex.item({shrink:false}).addClass("sf-dataoverview-SettingsButton").appendTo($dataTypeLayout);
var currentDataTypeIndex=column.dataTypeIndex;var updateDataTypeSettings;var onDataTypeSelected=function(item,index){if(index!==currentDataTypeIndex){currentDataTypeIndex=index;
var args={tableId:settings.tableId,columnId:column.id,dataType:column.dataTypes[index].id};Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,"ChangeDataType",JSON.stringify(args));
updateDataTypeSettings();}};var addOrignalDataType=function(settings){var i;var newTypes=[];for(i=0;i<settings.dataTypes.length;
++i){if(i!==currentDataTypeIndex&&i===settings.originalDataTypeIndex){newTypes.push({id:settings.dataTypes[i].id,text:Spotfire.Utilities.formatString(Spotfire.Localization.resources.DataOverview_OriginalDataType,settings.dataTypes[i].text)});
}else{newTypes.push(settings.dataTypes[i]);}}return newTypes;};var onSettingsClick=function(){var args={tableId:settings.tableId,columnId:column.id};
if(Spotfire.isWebPlayer()){Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,"ChangeDataTypeSettings",JSON.stringify(args));
}else{Spotfire.PageBus.publish("spotfire.dataoverview.changedatatypesettings",args,viewId);}};var comboBoxDataTypeSettings={values:addOrignalDataType(column),useIndexAsValueId:true,selectedIndex:column.dataTypeIndex,onSelected:onDataTypeSelected,maxVisibleValues:12};
Spotfire.Controls.DropDown.initialize($dataTypeDropdown,comboBoxDataTypeSettings);updateDataTypeSettings=function(){comboBoxDataTypeSettings.values=addOrignalDataType(column);
comboBoxDataTypeSettings.selectedIndex=currentDataTypeIndex;Spotfire.Controls.DropDown.update($dataTypeDropdown,comboBoxDataTypeSettings);
};Spotfire.Controls.PanelButton.initialize($dataTypeButton,Spotfire.Localization.resources.DataOverview_SettingsTooltip,"Images/Buttons/Properties.svg",onSettingsClick);
$dataTypeButton.css("color",settings.style.accentColor);}else{$("<div/>").text(column.dataType).addClass("sf-dataoverview-Dropdown sfpc-last").appendTo($dataType);
}return $dataType;};var createFormattingControl=function($parent,column,settings){var $formatting=addBox(Spotfire.Localization.resources.DataOverview_FormattingHeader,"sf-dataoverview-Formatting").appendTo($parent);
var $formattingLayout=Spotfire.Flex.item({container:"horizontal",fill:true,grow:true,"align-items":"center"}).appendTo($formatting);
var $formattingDropdownContainer=Spotfire.Flex.item({grow:true}).addClass("sf-dataoverview-Dropdown sfpc-last").appendTo($formattingLayout);
var $formattingDropdown=$("<div/>").appendTo($formattingDropdownContainer);var $formattingButton=Spotfire.Flex.item({shrink:false}).addClass("sf-dataoverview-SettingsButton").appendTo($formattingLayout);
var formattingCurrentIndex=column.formattingIndex;var onFormattingSelected=function(item,index){if(index!==formattingCurrentIndex){var args={tableId:settings.tableId,columnId:column.id};
Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,column.formattingOptions[index].commandId,JSON.stringify(args));
}};var onFormattingSettingsClick=function(){var args={tableId:settings.tableId,columnId:column.id};if(Spotfire.isWebPlayer()){Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,column.formattingSettingsCommandId,JSON.stringify(args));
}else{Spotfire.PageBus.publish("spotfire.dataoverview.columnformatting",args,viewId);}};Spotfire.Controls.DropDown.initialize($formattingDropdown,{values:column.formattingOptions,useIndexAsValueId:true,selectedIndex:column.formattingIndex,onSelected:onFormattingSelected});
Spotfire.Controls.PanelButton.initialize($formattingButton,Spotfire.Localization.resources.DataOverview_FormattingButtonTooltip,"Images/Buttons/Properties.svg",onFormattingSettingsClick);
$formattingButton.css("color",settings.style.accentColor);return $formatting;};var createSortOrderControl=function($parent,column,settings){var $sortOrder=addBox(Spotfire.Localization.resources.DataPanel_SortOrder,"sf-dataoverview-SortOrder").appendTo($parent);
var $layout=Spotfire.Flex.item({container:"horizontal",fill:true,grow:true,"align-items":"center"}).appendTo($sortOrder);
var $dropdownContainer=Spotfire.Flex.item({grow:true}).addClass("sf-dataoverview-Dropdown sfpc-last").appendTo($layout);
var $dropdown=$("<div/>").appendTo($dropdownContainer);var $button=Spotfire.Flex.item({shrink:false}).addClass("sf-dataoverview-SettingsButton").css("color",settings.style.accentColor).appendTo($layout);
var currentIndex=column.sortOrderIndex;var onSortOrderSelected=function(item,index){if(column.sortOrderOptions[index].settingsCommandId){$button.removeClass("disabled sfpc-disabled");
$button.css("cursor","pointer");}else{$button.addClass("disabled sfpc-disabled");$button.css("cursor","default");
}if(index!==currentIndex){currentIndex=index;var args={tableId:settings.tableId,columnId:column.id};Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,column.sortOrderOptions[index].commandId,JSON.stringify(args));
}};var onSettingsClick=function(){if(column.sortOrderOptions[currentIndex].settingsCommandId){var args={tableId:settings.tableId,columnId:column.id};
if(Spotfire.isWebPlayer()){Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,column.sortOrderOptions[currentIndex].settingsCommandId,JSON.stringify(args));
}else{Spotfire.PageBus.publish("spotfire.dataoverview.columnsortordercustomsettings",args,viewId);}}};
Spotfire.Controls.DropDown.initialize($dropdown,{values:column.sortOrderOptions,useIndexAsValueId:true,selectedIndex:column.sortOrderIndex,onSelected:onSortOrderSelected});
Spotfire.Controls.PanelButton.initialize($button,Spotfire.Localization.resources.DataOverview_SettingsTooltip,"Images/Buttons/Properties.svg",onSettingsClick);
onSortOrderSelected(null,column.sortOrderIndex);return $sortOrder;};var createButton=function(label,title,color,onClick){var $button=$("<button/>").addClass("sf-element sf-element-button").click(onClick);
$("<span style='width=100%'/>").css("color",color).text(label).appendTo($button);if(title){$button.attr("title",title);
}var mouseup=function(){$button.removeClass("sfpc-active");$(document.body).off("mouseup",mouseup);};
var mousedown=function(){$button.addClass("sfpc-active");$(document.body).on("mouseup",mouseup);};$button.on("mousedown",mousedown);
return $button;};var createExpressionControl=function($parent,column,settings){var $expression=addBox(Spotfire.Localization.resources.DataOverview_ExpressionHeader,"sf-dataoverview-Expression").appendTo($parent);
var $expressionLayout=Spotfire.Flex.item({container:"vertical",fill:true,grow:true}).appendTo($expression);
var $wrapper=$("<div/>").addClass("sf-dataoverview-ExpressionText").css("border-color",settings.style.buttonActiveColor).attr("title",column.expression).appendTo($expressionLayout);
CodeMirror.fromTextArea($("<textarea/>").val(column.expression).appendTo($wrapper)[0],{mode:"spotfire",theme:"spotfire",scrollbarStyle:null,lineWrapping:true,readOnly:true});
$(".CodeMirror",$wrapper).addClass("sf-element sf-element-text-box");createButton(Spotfire.Localization.resources.DataOverview_EditExpressionButton,Spotfire.Localization.resources.DataOverview_EditCalculatedColumnTooltip,settings.style.accentColor,function(){showCalculatedColumnDialog(settings,true,column);
}).appendTo($expressionLayout);return $expression;};var createExtraActionsControl=function($parent,column,settings){var $actions=addBox(Spotfire.Localization.resources.DataOverview_Actions,"sf-dataoverview-ExtraActions").appendTo($parent);
var $layout=Spotfire.Flex.item({container:"vertical",fill:true,grow:true}).appendTo($actions);var $lastButton;
column.extraActions.forEach(function(action){$lastButton=createButton(action.label,action.tooltip,settings.style.accentColor,function(){var args={tableId:settings.tableId,columnId:column.id};
if(Spotfire.isWebPlayer()){Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,action.method,JSON.stringify(args));
}else{Spotfire.PageBus.publish(action.topicId,args,viewId);}}).appendTo($layout);});$lastButton.addClass("sfpc-last");
return $actions;};var createColumnValuesControl=function($parent,column,settings){var $dummy=$("<div/>").addClass("sf-element sf-element-data-overview-content").css("width","100%").appendTo($parent);
var $buttonContainer=Spotfire.Flex.item({container:"horizontal",fill:true,shrink:false,"align-items":"stretch",wrap:true}).addClass("sf-dataoverview-ColumnValuesButtons").appendTo($dummy);
var activateButton=function($button){$button.addClass("sfpc-active").css({"border-bottom-width":"1px","background-color":settings.style[side].dodBackgroundColor});
};var deactivateButton=function($button){$button.removeClass("sfpc-active").css({"border-bottom-width":"","background-color":""});
};var createTableButton=function(text,tooltip,active,classes,action){var $div=Spotfire.Flex.item({container:"horizontal",grow:true,"auto-basis":false,shrink:false,"align-items":"center","justify-content":"center"}).addClass("sf-dataoverview-ColumnValuesButton").addClass(classes).css("border-bottom-color",settings.style.accentColor).attr("title",tooltip).appendTo($buttonContainer).click(action);
if(active){activateButton($div);}$("<span/>").text(text).appendTo($div);return $div;};var $allButton,$distinctButton;
$allButton=createTableButton(Spotfire.Localization.resources.DataOverview_AllValuesSelector,Spotfire.Localization.resources.DataOverview_ShowAllValuesTooltip,!settings.showDistinct,"sfpc-first sfpc-odd",function(){deactivateButton($distinctButton);
activateButton($allButton);var args={showDistinct:false};Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,"SetShowDistinct",JSON.stringify(args));
});$distinctButton=createTableButton(Spotfire.Localization.resources.DataOverview_UniqueValuesSelector,Spotfire.Localization.resources.DataOverview_ShowUniqueValuesTooltip,settings.showDistinct,"sfpc-last sfpc-even",function(){deactivateButton($allButton);
activateButton($distinctButton);var args={showDistinct:true};Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,"SetShowDistinct",JSON.stringify(args));
});var textWidth=20+Math.max($("span",$allButton).width(),$("span",$distinctButton).width());$allButton.css("min-width",textWidth+"px");
$distinctButton.css("min-width",textWidth+"px");var $previewData=Spotfire.Flex.item({grow:true}).addClass("sf-element sf-element-data-overview-content sfpc-first sfc-preview-table sf-dataoverview-ColumnValues").css("background-color",settings.style[side].dodBackgroundColor).appendTo($parent);
var plotBounds={Height:$previewData.height(),Width:$previewData.width()};Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,"GetTablePlot",JSON.stringify(plotBounds));
};var updateColumnView=function(column,settings){updateColumnHeader(column,settings);var $stats=null;
var statsTimer;if(column.statsType){$stats=Spotfire.Flex.item({shrink:false}).addClass("sf-dataoverview-StatsBox sf-element-data-overview-content").appendTo($overview);
var $statsProgress=$("<div/>").addClass("sf-dataoverview-StatsProgress").appendTo($stats);statsTimer=window.setTimeout(function(){$(Spotfire.Progress.createProgressAnimation(50,50)).appendTo($statsProgress);
statsTimer=null;},500);addHorizLine($overview,settings);}var $otherBoxes=Spotfire.Flex.item({grow:true}).addClass("sf-dataoverview-OtherBoxes sf-element-data-overview-content").appendTo($overview);
var $leftSideBoxes=$("<div/>").addClass("sf-dataoverview-LeftSideBoxes sf-element-data-overview-content").appendTo($otherBoxes);
var $scrollArea=$("<div/>").addClass("sf-dataoverview-LeftSideScrollArea").appendTo($leftSideBoxes);createCategoryControl($scrollArea,column,settings);
var $lastBox=createDataTypeControl($scrollArea,column,settings);if(column.formattingEnabled){$lastBox=createFormattingControl($scrollArea,column,settings);
}if(column.sortOrderEnabled){$lastBox=createSortOrderControl($scrollArea,column,settings);}if(column.expression!==undefined&&column.expression!==""){$lastBox=createExpressionControl($scrollArea,column,settings);
}if(column.extraActions.length){$lastBox=createExtraActionsControl($scrollArea,column,settings);}$lastBox.addClass("sfpc-last");
var scrollbar=$scrollArea.StyledScrollbar();var $previewContainer=$("<div/>").addClass("sf-dataoverview-ColumnValuesWrapper").appendTo($otherBoxes);
var $previewFlex=Spotfire.Flex.item({container:"vertical","auto-basis":false}).addClass("sf-dataoverview-ColumnValuesContainer sf-element-data-overview-content").appendTo($previewContainer);
createColumnValuesControl($previewFlex,column,settings);var layoutBoxes=function(){var totalWidth=$overview.width();
if(totalWidth>300){var lhsWidth=Math.min(250,totalWidth/2);$previewContainer.show();$leftSideBoxes.outerWidth(lhsWidth);
$previewContainer.width(totalWidth-lhsWidth);$previewContainer.css("left",lhsWidth);var $previewData=$(".sf-element-data-overview .sf-dataoverview-ColumnValues");
var currentPlotBounds={Height:$previewData.height(),Width:$previewData.width()};Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,"SetTablePlotSize",JSON.stringify(currentPlotBounds));
}else{$previewContainer.hide();$leftSideBoxes.css("width","100%");}$leftSideBoxes.outerHeight($otherBoxes.height());
$scrollArea.height($leftSideBoxes.height());$scrollArea.width($leftSideBoxes.width()-15);scrollbar.refresh();
};layoutBoxes();resizeFuncs.push(layoutBoxes);var statsCallback=function(bundle){if(statsTimer){clearTimeout(statsTimer);
statsTimer=null;}$stats.empty();var buildBigMeasuresTable=function(){var $measuresContainer=Spotfire.Flex.item({container:"horizontal",fill:true,"align-items":"stretch",wrap:true}).addClass("sf-dataoverview-MeasuresTable");
bundle.measures.forEach(function(m){var $m=Spotfire.Flex.item({grow:true}).appendTo($measuresContainer);
$("<div/>").text(m.measure).addClass("sf-dataoverview-measurename-big").appendTo($m);$("<div/>").text(m.value).addClass("sf-dataoverview-measurevalue-big").appendTo($m);
});return $measuresContainer;};var buildSmallMeasuresTable=function(){var $measuresContainer=Spotfire.Flex.item({container:"horizontal"}).addClass("sf-dataoverview-MeasuresTable");
var $measureTexts=Spotfire.Flex.item({shrink:false}).addClass("sf-dataoverview-measurename-small").appendTo($measuresContainer);
var $valueTexts=Spotfire.Flex.item({grow:true}).addClass("sf-dataoverview-measurevalue-small").appendTo($measuresContainer);
var sep="";bundle.measures.forEach(function(m){$measureTexts.append(sep);$valueTexts.append(sep);sep="\n";
$measureTexts.append($("<span/>").text(m.measure));$valueTexts.append($("<span/>").text(m.value).attr("title",m.value));
});return $measuresContainer;};switch(bundle.type){case"error":$("<div/>").addClass("sf-dataoverview-StatsError").text(bundle.message).appendTo($stats);
break;case"info":$("<div/>").addClass("sf-dataoverview-StatsInfo").text(bundle.message).appendTo($stats);
break;case"numeric":case"timespan":case"time":case"identifiers":var $container;if(bundle.measures.length<=2){$container=Spotfire.Flex.item({container:"vertical","align-items":"stretch"}).appendTo($stats);
buildBigMeasuresTable().appendTo($container);}else{$container=Spotfire.Flex.item({container:"horizontal","align-items":"stretch",wrap:true}).appendTo($stats);
buildSmallMeasuresTable().appendTo($container);}if(bundle.histogram){var $histogram=Spotfire.Flex.item({container:"horizontal",grow:true,shrink:false,"align-items":"end"}).addClass("sf-element-data-overview-content sf-dataoverview-histogram").attr("title",Spotfire.Localization.resources.DataOverview_AddHistogram).appendTo($container);
if(bundle.measures.length<=2){$histogram.addClass("sf-dataoverview-histogram-fixedheight");}var max=Math.max.apply(null,bundle.histogram);
var histogramheight=$histogram.innerHeight();bundle.histogram.forEach(function(count){var h=(count/max)*histogramheight;
if(h>0&&h<1){h=1;}Spotfire.Flex.item({grow:true}).addClass("sf-element-data-overview-histogram-bar").css("background-color",settings.style.accentColor).height(h+"px").appendTo($histogram);
});$histogram.click(function(){var histogramClickArgs={tableId:settings.tableId,columnId:column.id};Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,"AddHistogram",JSON.stringify(histogramClickArgs));
});}break;case"categories":var $categoryContainer=Spotfire.Flex.item({container:"horizontal","align-items":"stretch","justify-content":"center"}).appendTo($stats);
var $uniqueCountBox=Spotfire.Flex.item({container:"vertical",shrink:false,"align-items":"center"}).addClass("sf-dataoverview-CategoryBox").appendTo($categoryContainer);
$("<div/>").addClass("sf-dataoverview-StatsLabel").text(Spotfire.Localization.resources.DataOverview_UniqueCount).appendTo($uniqueCountBox);
var $circle=$("<div/>").addClass("sf-dataoverview-UniqueCountValueCircle").css("border-color",settings.style.uniqueCountColor).appendTo($uniqueCountBox);
var $uniqueCountText=$("<div/>").addClass("sf-dataoverview-UniqueCountValue").text(bundle.uniquecount).appendTo($circle);
var fontSize=20;var $tmp=$("<span/>").text(bundle.uniquecount).css("font-size",fontSize+"px").hide().appendTo($stats);
while($tmp.width()>$uniqueCountText.innerWidth()){fontSize-=1;$tmp.css("font-size",fontSize+"px");}$tmp.remove();
$uniqueCountText.css("font-size",fontSize+"px");var buildCategoryTable=function(categories,$parent){categories.forEach(function(elem){$("<div/>").text(elem.value).appendTo($parent).attr("title",Spotfire.Utilities.formatString(Spotfire.Localization.resources.DataOverview_CategoryTooltipFormat,elem.value,elem.count));
});};var resizeCategories;if(bundle.categories){var $categories=Spotfire.Flex.item({grow:true}).addClass("sf-dataoverview-CategoryBox sfpc-last");
$("<div/>").addClass("sf-dataoverview-StatsLabel").text(Spotfire.Localization.resources.DataOverview_Categories).appendTo($categories);
buildCategoryTable(bundle.categories,$categories);resizeCategories=function(){$categories.detach();if($overview.width()>200){$categories.appendTo($categoryContainer);
}};}else{var $mostCommon=Spotfire.Flex.item({grow:true,"auto-basis":false}).addClass("sf-dataoverview-CategoryBox");
$("<div/>").addClass("sf-dataoverview-StatsLabel").text(Spotfire.Localization.resources.DataOverview_MostCommon).appendTo($mostCommon);
buildCategoryTable(bundle.topCategories,$mostCommon);var $leastCommon=Spotfire.Flex.item({grow:true,"auto-basis":false}).addClass("sf-dataoverview-CategoryBox sfpc-last");
$("<div/>").addClass("sf-dataoverview-StatsLabel").text(Spotfire.Localization.resources.DataOverview_LeastCommon).appendTo($leastCommon);
buildCategoryTable(bundle.botCategories,$leastCommon);resizeCategories=function(){$mostCommon.detach();
$leastCommon.detach();if($overview.width()>300){$mostCommon.appendTo($categoryContainer);$leastCommon.appendTo($categoryContainer);
}else{if($overview.width()>200){$mostCommon.appendTo($categoryContainer);}}};}resizeCategories();resizeFuncs.push(resizeCategories);
break;}resizeFunc();};var nullSettingsCallback=function(bundle){if((bundle.nullValueCount===null||bundle.nullValueCount<=0)&&bundle.nullValueIndex===0){return;
}$lastBox.removeClass("sfpc-last");var $nullValues=addBox(Spotfire.Localization.resources.DataOverview_EmptyValuesHeader,"sf-dataoverview-NullValues").appendTo($scrollArea);
$nullValues.addClass("sfpc-last");if(bundle.nullValueCount!==null&&bundle.nullValueCount>0){$("<div/>").text(Spotfire.Utilities.formatString(Spotfire.Localization.resources.DataOverview_EmptyValueCount,bundle.nullValueCountFormatted)).addClass("sf-dataoverview-NullValuesLabel").appendTo($nullValues);
}if(bundle.allowChangeNullValue){$("<div/>").text(Spotfire.Localization.resources.DataOverview_EmptyReplacementMethodLabel).addClass("sf-dataoverview-DropdownLabel").appendTo($nullValues);
var $nullValuesLayout=Spotfire.Flex.item({container:"horizontal",fill:true,grow:true,"align-items":"center"}).appendTo($nullValues);
var $nullValuesDropdownContainer=Spotfire.Flex.item({grow:true}).addClass("sf-dataoverview-Dropdown sfpc-last").appendTo($nullValuesLayout);
var $nullValuesDropdown=$("<div/>").appendTo($nullValuesDropdownContainer);var currentNullValueIndex=bundle.nullValueIndex;
var currentSpecificValue;var $specificValueInput=$("<input/>").addClass("sf-element-text-box").attr("type","text").hide().appendTo($nullValues);
var $errorText=$("<div/>").addClass("sf-dataoverview-NullValuesError").hide().appendTo($nullValues);$specificValueInput.on("blur",function(){var newValue=$.trim($specificValueInput.val());
if(newValue===currentSpecificValue){return;}$specificValueInput.attr("disabled","disabled");var args={tableId:bundle.tableId,columnId:bundle.id,conversion:bundle.nullValueTypes[currentNullValueIndex].id,value:newValue};
var callback=function(result){$specificValueInput.removeAttr("disabled");$errorText.hide();if(result.ok){currentSpecificValue=newValue;
Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,"ReplaceNullValues",JSON.stringify(args));}else{if(result.error){$errorText.text(result.error).show();
$specificValueInput.focus().select();}}};Spotfire.Dxp.Web.Forms.AjaxService.Read(viewId,"ValidateNullSettings",JSON.stringify(args),callback);
});$specificValueInput.on("keydown",function(e){if(e.keyCode===13){$(this).blur();}});var onNullValueSelected=function(item,index){if(index!==currentNullValueIndex){$errorText.hide();
currentNullValueIndex=index;if(bundle.nullValueTypes[currentNullValueIndex].id==="ReplaceNullWithSpecificValue"){$specificValueInput.val(currentSpecificValue).show().focus().select();
}else{$specificValueInput.hide();var args={tableId:bundle.tableId,columnId:bundle.id,conversion:bundle.nullValueTypes[currentNullValueIndex].id};
Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,"ReplaceNullValues",JSON.stringify(args));}}};if(bundle.nullValueTypes[currentNullValueIndex].id==="ReplaceNullWithSpecificValue"){currentSpecificValue=bundle.nullValueSettings.value;
$specificValueInput.val(bundle.nullValueSettings.value).show();}Spotfire.Controls.DropDown.initialize($nullValuesDropdown,{values:bundle.nullValueTypes,useIndexAsValueId:true,selectedIndex:bundle.nullValueIndex,onSelected:onNullValueSelected});
}resizeFunc();};var req={tableId:settings.tableId,columnId:column.id};Spotfire.Dxp.Web.Forms.AjaxService.Read(viewId,"GetNullSettings",JSON.stringify(req),nullSettingsCallback);
if($stats){req.statsType=column.statsType;Spotfire.Dxp.Web.Forms.AjaxService.Read(viewId,"GetColumnStats",JSON.stringify(req),statsCallback);
}};var updateHierarchyControl=function(clientGeneration){var $hierarchyView=$(".sf-element-data-overview .CheckBoxHierarchyFilter");
var height=$hierarchyView.height();var itemHeight=20;var numItems=Math.floor(height/itemHeight);var hierarchySettings={HasFixedHeight:true,Height:numItems,TotalVisibleValues:0,ItemHeight:itemHeight,SearchFieldVisible:false,AllowCheck:false,ClientGeneration:clientGeneration};
Spotfire.Filters.CheckBoxHierarchyFilter.update(viewId,hierarchySettings,$hierarchyView);};var updateHierarchyView=function(hierarchyColumn,settings){updateColumnHeader(hierarchyColumn,settings);
var $boxContainer=$("<div/>").addClass("sf-dataoverview-BoxContainer").appendTo($overview);var $dataType=addBox(Spotfire.Localization.resources.DataOverview_CategorizeColumnHeader,"sf-dataoverview-DataType sfpc-first sfpc-last sf-element-data-overview-content").appendTo($boxContainer);
var $categoryLayout=Spotfire.Flex.item({container:"horizontal",fill:true,grow:true,"align-items":"center"}).appendTo($dataType);
var $categoryDropdownContainer=Spotfire.Flex.item({grow:true}).addClass("sf-dataoverview-Dropdown sfpc-last").appendTo($categoryLayout);
var $categoryDropdown=$("<div/>").appendTo($categoryDropdownContainer);var currentCategoryIndex=hierarchyColumn.categoryIndex;
var onCategorySelected=function(item,index){if(index!==currentCategoryIndex){currentCategoryIndex=index;
var args={tableId:settings.tableId,columnId:hierarchyColumn.id,category:hierarchyColumn.categories[index].id};
Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,"ColumnCategorization",JSON.stringify(args));}};Spotfire.Controls.DropDown.initialize($categoryDropdown,{values:hierarchyColumn.categories,useIndexAsValueId:true,selectedIndex:hierarchyColumn.categoryIndex,onSelected:onCategorySelected});
addHorizLine($overview,settings);var $hierarchyView=Spotfire.Flex.item({grow:true}).addClass("sf-dataoverview-HierarchyView").css({width:"100%"}).appendTo($overview);
var height=$hierarchyView.height();var itemHeight=20;var numItems=Math.floor(height/itemHeight);var hierarchySettings={HasFixedHeight:true,Height:numItems,TotalVisibleValues:0,ItemHeight:itemHeight,SearchFieldVisible:false,AllowCheck:false,ClientGeneration:0};
Spotfire.Filters.CheckBoxHierarchyFilter.create(dataOverviewId,hierarchySettings,$hierarchyView);resizeFuncs.push(updateHierarchyControl);
};var updateTableHeader=function(settings){var $tableHeader=Spotfire.Flex.item({shrink:false}).addClass("sf-dataoverview-TableHeader sf-element-data-overview-header").appendTo($overview);
var $tableName=$("<div/>").addClass("sf-dataoverview-TableName").appendTo($tableHeader);var $tableNameText=$("<div/>").addClass("sf-dataoverview-TableNameText").attr("title",settings.tableName).text(settings.tableName).appendTo($tableName);
var $tableNameInput=$("<input/>").attr("type","text");var $renameButton=$("<div/>").addClass("sf-dataoverview-HeaderButton sf-element sf-element-button").attr("title",Spotfire.Localization.resources.DataOverview_RenameTableTooltip).appendTo($tableHeader);
Spotfire.getSvg("Images/Data/DataOverviewEdit.svg",function($svg){$renameButton.empty().append($svg);
});var $modeSelector=$("<div/>").addClass("sf-dataoverview-HeaderButton sf-dataoverview-ModeSelector sf-element sf-element-button").attr("title",Spotfire.Localization.resources.DataOverview_SortDataPanelTooltip).appendTo($tableHeader);
Spotfire.getSvg("Images/Data/DataOverviewSortMode.svg",function($svg){$modeSelector.empty().append($svg);
});$modeSelector.click(function(){modeSelectorOnClick($modeSelector);});var buttonsWidth=$renameButton.outerWidth()+$modeSelector.outerWidth();
if(settings.allowReplaceDataTable){var $replaceButton=$("<div/>").addClass("sf-dataoverview-HeaderButton sf-dataoverview-ReplaceDataTable sf-element sf-element-button").attr("title",Spotfire.Localization.resources.DataOverview_ReplaceDataTable).appendTo($tableHeader);
Spotfire.getSvg("Images/Data/ReplaceDataTable.svg",function($svg){$replaceButton.empty().append($svg);
});$replaceButton.on("click",function(){var args={tableId:settings.tableId};if(Spotfire.isWebPlayer()){Spotfire.Data.Access.AddData.toggle(settings.tableId,$replaceButton,Spotfire.Data.DataDestination.ReplaceTable);
}else{Spotfire.PageBus.publish("spotfire.dataoverview.replacetable",args,viewId);}});buttonsWidth+=$replaceButton.outerWidth();
}if(settings.allowDeleteTable){var $deleteButton=$("<div/>").addClass("sf-dataoverview-HeaderButton sf-element sf-element-button").attr("title",Spotfire.Localization.resources.DataOverview_DeleteTableTooltip).appendTo($tableHeader);
Spotfire.getSvg("Images/Data/DataOverviewDelete.svg",function($svg){$deleteButton.empty().append($svg);
});$deleteButton.on("click",function(){var args={tableId:settings.tableId};if(Spotfire.isWebPlayer()){var text=Spotfire.Utilities.formatString(Spotfire.Localization.resources.DataPanel_DeleteDialog_TableFormatString,settings.tableName);
Spotfire.ConfirmDialog.showOkCancelDialog(Spotfire.Localization.resources.DataPanel_DeleteDialog_Title,text,function(){Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,"DeleteTable",JSON.stringify(args));
});}else{Spotfire.PageBus.publish("spotfire.dataoverview.deletetable",args,viewId);}});buttonsWidth+=$deleteButton.outerWidth();
}if(settings.tableMode){var $editTableModeButton=$("<div/>").addClass("sf-dataoverview-SwitchButton sf-element sf-element-button").text(Spotfire.Localization.resources.DataOverview_EditDataTableMode).appendTo($tableHeader);
var $regularTableModeButton=$("<div/>").addClass("sf-dataoverview-SwitchButton sf-element sf-element-button").text(Spotfire.Localization.resources.DataOverview_ViewDataTableMode).appendTo($tableHeader);
var onClick=function(){var args={};Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,"ToggleEditTableMode",JSON.stringify(args));
};if(settings.editTableMode){$editTableModeButton.addClass("sfpc-active");$regularTableModeButton.on("click",onClick);
}else{$regularTableModeButton.addClass("sfpc-active");$editTableModeButton.on("click",onClick);}buttonsWidth+=$editTableModeButton.outerWidth()+$regularTableModeButton.outerWidth();
}var resizeTableName=function(){var maxSize=$tableHeader.width()-buttonsWidth-30;$tableName.css("max-width",maxSize+"px");
};resizeTableName();resizeFuncs.push(resizeTableName);var startEditingName=function(){$tableNameInput.val(settings.tableName);
$tableNameInput.height($tableNameText.height());$tableNameInput.width($tableNameText.innerWidth());$tableNameText.detach();
$tableNameInput.appendTo($tableName);$tableNameInput.focus();$tableNameInput.select();};$tableNameText.on("dblclick",startEditingName);
$renameButton.on("click",startEditingName);$tableNameInput.on("keydown",function(e){if(e.keyCode===13){$(this).blur();
}else{var maxSize=$tableHeader.width()-buttonsWidth-30;var $tmp=$("<span/>").text($tableNameInput.val()).hide().appendTo($tableName);
var newWidth=Math.min(maxSize,$tmp.innerWidth());if(newWidth>$tableNameInput.innerWidth()){$tableNameInput.width(newWidth);
}$tmp.remove();}});$tableNameInput.on("blur",function(){var newTableName=$.trim($tableNameInput.val());
if(newTableName===""||newTableName===settings.tableName){$tableNameInput.detach();$tableNameText.appendTo($tableName);
return;}var args={tableId:settings.tableId,newName:newTableName};Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,"RenameTable",JSON.stringify(args));
});};var createEdgeButton=function(isVertical,title,appendTo,onClick,settings){var $buttonBox=Spotfire.Flex.item({container:isVertical?"vertical":"horizontal","justify-content":"center","align-items":"center",shrink:false}).addClass(isVertical?"sf-dataoverview-VerticalEdgeButton":"sf-dataoverview-HorizontalEdgeButton").css("color",settings.style.accentColor).attr("title",title).appendTo(appendTo);
var $buttonText=Spotfire.Flex.item().addClass(isVertical?"sf-dataoverview-VerticalEdgeButtonText":"sf-dataoverview-HorizontalEdgeButtonText").appendTo($buttonBox);
$buttonText.text(title);$buttonBox.click(function(){onClick();});var mouseup=function(){$buttonBox.removeClass("sfpc-active");
$(document.body).off("mouseup",mouseup);};var mousedown=function(){$buttonBox.addClass("sfpc-active");
$(document.body).on("mouseup",mouseup);};$buttonBox.on("mousedown",mousedown);var stylesheet="<style>\n";
var buttonClass=isVertical?".sf-element-data-overview .sf-dataoverview-VerticalEdgeButton":".sf-element-data-overview .sf-dataoverview-HorizontalEdgeButton";
stylesheet+=buttonClass+":hover { background-color: "+settings.style.buttonHoverColor+"; }\n";stylesheet+=buttonClass+".sfpc-active { background-color: "+settings.style.buttonActiveColor+"; }\n";
stylesheet+="</style>\n";$(stylesheet).appendTo(appendTo);return $buttonBox;};var updateTableView=function(settings){var $totalContainer=Spotfire.Flex.item({container:"vertical",fill:true,grow:true,"align-items":"stretch"}).addClass("sf-dataoverview-TotalContainer").appendTo($overview);
var $tableContainer=Spotfire.Flex.item({container:"horizontal",fill:true,grow:true,"align-items":"stretch"}).addClass("sf-dataoverview-TableValuesContainer sf-element-data-overview-content").appendTo($totalContainer);
var $previewData=Spotfire.Flex.item().addClass("sf-element sf-element-data-overview-content sfc-preview-table sf-dataoverview-ColumnValues").css("background-color",settings.style[side].dodBackgroundColor).appendTo($tableContainer);
createEdgeButton(true,Spotfire.Localization.resources.DataOverview_AddColumnFromExpression,$tableContainer,function(){showCalculatedColumnDialog(settings,false);
},settings);var $addRowsButton=null;if(settings.allowAddRows){var addRows=function(){var args={tableId:settings.tableId};
if(Spotfire.isWebPlayer()){Spotfire.Data.Access.AddData.toggle(settings.tableId,$addRowsButton,Spotfire.Data.DataDestination.AddRows);
}else{Spotfire.PageBus.publish("spotfire.dataoverview.addrows",args,viewId);}};var $secondRow=Spotfire.Flex.item({container:"horizontal"}).addClass("sf-dataoverview-TableValuesContainer sf-element-data-overview-content").appendTo($totalContainer);
$addRowsButton=createEdgeButton(false,Spotfire.Localization.resources.DataOverview_AddRows,$secondRow,addRows,settings);
$addRowsButton.css("width",$previewData.innerWidth());}var plotBounds={Height:$previewData.height(),Width:$previewData.width()};
Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,"GetTablePlot",JSON.stringify(plotBounds));resizeFuncs.push(function(){if($previewData.closest(".sf-element-page").length){if($addRowsButton!==null){$addRowsButton.css("width",$previewData.innerWidth());
}var currentPlotBounds={Height:$previewData.height(),Width:$previewData.width()};Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,"SetTablePlotSize",JSON.stringify(currentPlotBounds));
}});};var updateDataOverview=function(settings){$("#"+dataOverviewId).remove();if(settings.visible){var $overviewPanelArea=initializeContainer(settings);
$overviewPanelArea.show();$overview.empty();if(settings.invalidReason){var $invalidReason=$("<div/>").addClass("sf-dataoverview-InvalidReason").appendTo($overview);
$invalidReason.text(settings.invalidReason);}else{if(settings.externalCube){if(!settings.tableMode){var selected=settings.selectedColumn||settings.selectedHierarchy;
updateColumnHeader(selected,settings);}else{updateTableHeader(settings);}$("<div/>").addClass("sf-dataoverview-InvalidReason").text(settings.externalCubeDisabledText).appendTo($overview);
}else{if(!settings.tableMode){if(settings.selectedColumn){updateColumnView(settings.selectedColumn,settings);
}else{if(settings.selectedHierarchy){updateHierarchyView(settings.selectedHierarchy,settings);}}}else{updateTableHeader(settings);
if(settings.editTableMode){editTable.init(settings,$overview,resizeFuncs);}else{updateTableView(settings);
}}}}}};var updateEditTableLayout=function(settings){editTable.update(settings);};var initEditTablePreviewTable=function(id,html){editTable.initPreviewTable(id,html);
};var initTablePlot=function(tablePlotHtml){var $columnValues=$(".sf-element-data-overview .sf-dataoverview-ColumnValues");
$columnValues.empty();$columnValues.append($(tablePlotHtml));};var refreshTablePlot=function(){var $previewData=$(".sf-element-data-overview .sf-dataoverview-ColumnValues");
var plotBounds={Height:$previewData.height(),Width:$previewData.width()};Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,"GetTablePlot",JSON.stringify(plotBounds));
};var setWidth=function(width){var $overviewPanelArea=$(".sf-element-data-overview");if(setWidthImpl(width,$overviewPanelArea)){resizeFuncImpl();
}};return{update:updateDataOverview,initTablePlot:initTablePlot,refreshTablePlot:refreshTablePlot,setWidth:setWidth,updateHierarchy:updateHierarchyControl,updateEditTableLayout:updateEditTableLayout,initEditTablePreviewTable:initEditTablePreviewTable};
}});});$(function(){Spotfire.registerNameSpace("DataOverview.EditTable",{getDataCachingBehaviorIcon:function(behavior){switch(behavior.name){case"Linked":return"EditTable/CachingLinked.svg";
case"Cached":return"EditTable/CachingCached.svg";case"Embedded":return"EditTable/CachingEmbedded.svg";
default:return"";}},create:function(viewId){var debug=false;var $upperPaneScrollableContainer;var $treeLayoutContent;
var svg;var svgGroup;var tree;var $lowerPaneNodeSelectedContainer;var $lowerPaneNoNodeSelectedContainer;
var $lowerLeftPaneScrollableContainer;var lowerLeftPaneScrollbar;var $tabLayoutContentScrollableContainer;
var tabLayoutContentScrollbar;var $informationSettingsTab;var $previewSettingsTab;var updatePaneWidthsAndHeights;
var currentBundle;var styleBundle;var side="left";var getDataCachingBehaviorDisplayName=function(behavior){switch(behavior.name){case"Linked":return Spotfire.Localization.resources.DataOverview_CachingLinkedDisplayName;
case"Cached":return Spotfire.Localization.resources.DataOverview_CachingCachedDisplayName;case"Embedded":return behavior.linkable?Spotfire.Localization.resources.DataOverview_CachingEmbeddedDisplayName:Spotfire.Localization.resources.DataOverview_CachingNonLinkableEmbeddedDisplayName;
default:return"";}};var getSelectedDataCachingBehaviorDisplayName=function(behaviors){var behavior=_.findWhere(behaviors,{selected:true});
if(!behavior){return"";}return getDataCachingBehaviorDisplayName(behavior);};var getDataCachingBehaviorDescription=function(behavior){switch(behavior.name){case"Linked":return Spotfire.Localization.resources.DataOverview_CachingLinkedDescription;
case"Cached":return Spotfire.Localization.resources.DataOverview_CachingCachedDescription;case"Embedded":return behavior.linkable?Spotfire.Localization.resources.DataOverview_CachingEmbeddedDescription:Spotfire.Localization.resources.DataOverview_CachingNonLinkableEmbeddedDescription;
default:return"";}};var getSelectedDataCachingBehaviorIcon=function(behaviors){var behavior=_.findWhere(behaviors,{selected:true});
if(!behavior){return"";}return Spotfire.DataOverview.EditTable.getDataCachingBehaviorIcon(behavior);};
var getBadgeColor=function(node){return node.type==="table"?styleBundle.tableBadgeColor:styleBundle.producerBadgeColor;
};var showLoadOptionsPopout=function(settings,node,x,y){var $popover=$("<div>").addClass("sf-dataoverview-edit-table-popout");
function behaviorChangedHandler(name,value){if(name==="dataCachingBehavior"){var cachingArgs={tableId:settings.tableId,id:node.id,dataCachingBehavior:value};
Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,"SetDataCachingBehavior",JSON.stringify(cachingArgs));
}else{if(name==="reloadButton"){var refreshArgs={tableId:settings.tableId,id:node.id};if(Spotfire.isWebPlayer()){Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,"RefreshProducer",JSON.stringify(refreshArgs));
}else{Spotfire.PageBus.publish("spotfire.dataoverview.refreshproducer",refreshArgs,viewId);}}}}var args={x:x,y:y,alignment:"Left",arrowAlignment:"Center",dataCachingBehavior:node.dataCachingBehaviors?_.findWhere(node.dataCachingBehaviors,{selected:true}).name:true,reloadButton:true};
var id="DataOverviewLoadOptionsPopoutId";var builder=Spotfire.Visuals.ContextualPopout.builder(id,args,$popover,behaviorChangedHandler);
var createHeaderDescriptionNode=function(header,description,containerClassName){var $container=$("<div/>");
if(containerClassName){$container.addClass(containerClassName);}$("<div/>").text(header).addClass("sf-dataoverview-edit-table-popout-header").appendTo($container);
if(description){$("<div/>").text(description).addClass("sf-dataoverview-edit-table-popout-description").appendTo($container);
}return $container;};var result=builder;result=result.beginSection().beginRow().addNode("dataCachingBehavior",createHeaderDescriptionNode(Spotfire.Localization.resources.DataOverview_StoreData,node.dataLoadingDescription)).endRow();
if(node.dataCachingBehaviors){node.dataCachingBehaviors.forEach(function(behavior){result=result.beginRow().addRadioButton("dataCachingBehavior",behavior.name,{text:"",compactMode:true,enabled:behavior.enabled,iconOverride:"Images/Data/"+Spotfire.DataOverview.EditTable.getDataCachingBehaviorIcon(behavior)}).addNode("dataCachingBehavior",createHeaderDescriptionNode(getDataCachingBehaviorDisplayName(behavior),getDataCachingBehaviorDescription(behavior),"sf-dataoverview-edit-table-popout-radio-button-info")).endRow();
});}result=result.endSection();var hasSecondSection=node.dataLoadTimeStamp||node.refreshEnabled;if(hasSecondSection){result=result.beginSection().beginRow();
}if(node.refreshEnabled){result=result.addButton("reloadButton",Spotfire.Localization.resources.DataOverview_ReloadData,undefined,"Images/Data/EditTable/Reload.svg");
if(!node.dataLoadTimeStamp){result=result.addNode("reloadButton",$("<div/>").text(Spotfire.Localization.resources.DataOverview_ReloadData).addClass("sf-dataoverview-edit-table-popout-description"));
}}if(node.dataLoadTimeStamp){result=result.addNode("reloadButton",createHeaderDescriptionNode(Spotfire.Localization.resources.DataOverview_LastReload,node.dataLoadTimeStamp,"sf-dataoverview-edit-table-popout-radio-button-info"));
}if(hasSecondSection){result.endRow().endSection();}Spotfire.Visuals.ContextualPopout.showPropertiesPopover(id,args,$popover);
};var getSelectedNode=function(node){if(node.selected){return node;}if(node.children){var foundSelectedNode;
var i;for(i=0;i<node.children.length;i++){foundSelectedNode=getSelectedNode(node.children[i]);if(foundSelectedNode){return foundSelectedNode;
}}}return null;};var updateStepsLayout=function(settings,selectedNode){$lowerLeftPaneScrollableContainer.empty();
var $content=$("<div/>").addClass("sf-dataoverview-edit-table-steps-content").appendTo($lowerLeftPaneScrollableContainer);
var $detailsHeader=$("<div/>").addClass("sf-dataoverview-edit-table-header").appendTo($content);var nodeBackgroundColor=styleBundle.lowerRightPaneBackgroundColor;
var iconGrayColor=styleBundle.iconGrayColor;var $iconDiv=$("<div/>").addClass("sf-dataoverview-edit-table-header-icon-div").css("border-color",styleBundle.nodeBorderColor).css("background-color",nodeBackgroundColor).css("fill",iconGrayColor).appendTo($detailsHeader);
Spotfire.Data.Icons.get("Images/Data/"+selectedNode.iconName,function($svg){$svg.appendTo($iconDiv);});
$("<span/>").text(selectedNode.displayName).appendTo($detailsHeader);if(selectedNode.type==="table"&&selectedNode.groups.length===0){$("<div/>").addClass("sf-dataoverview-edit-table-text").text(Spotfire.Localization.resources.DataOverview_NoAdditionalOperationsPerformed).appendTo($content);
lowerLeftPaneScrollbar.refresh();return;}selectedNode.groups.forEach(function(g){var $groupContainerOuter=$("<div/>").addClass("sf-dataoverview-edit-table-steps-group").css("background-color",styleBundle.groupBackgroundColor).appendTo($content);
$groupContainerOuter.on("click",function(){var args={tableId:settings.tableId,id:g.id,type:g.type};Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,"SetSelectedGroup",JSON.stringify(args));
});if(g.selected){$groupContainerOuter.addClass("sfpc-selected");$groupContainerOuter.css("border-color",getBadgeColor(selectedNode));
}else{$groupContainerOuter.css("border-color",styleBundle.nodeBorderColor);}if(g.hasErrors){var $error=$("<div/>").addClass("sf-dataoverview-edit-table-steps-group-error-icon").appendTo($groupContainerOuter);
Spotfire.getSvg("Images/Data/EditTable/Error20x20.svg",function($svg){$svg.appendTo($error);});}var $groupContainer=Spotfire.Flex.item({container:"horizontal","align-items":"center"}).appendTo($groupContainerOuter);
var $group=Spotfire.Flex.item({grow:true}).appendTo($groupContainer);if(g.isEditable){var $editIcon=Spotfire.Flex.item({shrink:false}).css("width","14px").css("height","14px").appendTo($groupContainer);
$editIcon.attr("title","@@ Click to edit settings...");$editIcon.css("color",iconGrayColor);$editIcon.on("sf-touchmousedown",function(){var editArgs={id:g.id,tableId:settings.tableId};
if(Spotfire.isWebPlayer()){Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,"EditProducer",JSON.stringify(editArgs));
}else{Spotfire.PageBus.publish("spotfire.dataoverview.editproducer",editArgs,viewId);}});Spotfire.getSvg("Images/Data/EditTable/Settings14x14.svg",function($svg){$svg.appendTo($editIcon);
});}g.steps.forEach(function(s){$("<div/>").addClass("sf-dataoverview-edit-table-steps-step").text(s.displayName).appendTo($group);
});});lowerLeftPaneScrollbar.refresh();};var iconWidth=50;var iconHeight=50;var iconMarginWidth=10;var iconMarginHeight=5;
var nodePaddingWidth=8;var nodePaddingHeight=10;var nodeButtonHeight=24;var nodeBorderStroke=1;var selectedNodeBorderSize=3;
var nodeRadius=selectedNodeBorderSize;var badgeRadius=10;var badgeTextFontSize=10;var labelMarginTop=9;
var labelMarginBottom=9;var labelFontSize=12;var boxPadding=80;var topMargin=2;var editIconWidthHeight=14;
var dataCachingIconWidthHeight=16;var dataLoadingOrInfoButtonVisible=function(node){return node.dataCachingBehaviors||node.dataLoadingDescription;
};var nodeButtonVisible=function(node){return node.isEditable||dataLoadingOrInfoButtonVisible(node);};
var nodeWidth=iconWidth+iconMarginWidth*2+nodePaddingWidth*2;var nodeWithoutButtonHeight=iconHeight+iconMarginHeight*2+nodePaddingHeight*2;
var nodeWithButtonHeight=nodeWithoutButtonHeight+nodeBorderStroke+nodeButtonHeight;var actualNodeHeight=function(node){return nodeButtonVisible(node)?nodeWithButtonHeight:nodeWithoutButtonHeight;
};var boxWidth=nodeWidth+nodeBorderStroke*2+boxPadding*2;var boxHeight=topMargin+selectedNodeBorderSize+nodeWithButtonHeight+nodeBorderStroke*2+labelMarginTop+labelFontSize+labelMarginBottom;
var extraWidthForFinalTableNode=(321-63-boxWidth/2)+boxPadding;var isFinalTableNode=function(node){return node.x===0;
};var getExtraWidthIfFinalTable=function(node){return isFinalTableNode(node)?extraWidthForFinalTableNode:0;
};var nodeYOffset=function(node){return Math.ceil(actualNodeHeight(node)/2-boxHeight/2)+selectedNodeBorderSize+topMargin;
};var applySettingsForNewNodes=function(selection,settings,treeWidth){selection.attr("class","sf-dataoverview-edit-table-node").attr("transform",function(node){return"translate("+(treeWidth-Math.floor(boxWidth/2)-(node.x*boxWidth)-(isFinalTableNode(node)?0:extraWidthForFinalTableNode)+1)+","+(Math.floor(boxHeight/2)+(node.y*boxHeight)+1)+")";
}).on("click",function(node){if(node.selected){return;}var args={tableId:settings.tableId,id:node.id,type:node.type};
if(node.groups.length>=1){args.groupId=_.first(node.groups).id;}Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,"SetSelectedNode",JSON.stringify(args));
});};var setSelectedNode=function(selection){selection.classed("sfpc-selected",function(node){return node.selected;
});};var assignCoordinates=function(node,x,y,result){node.x=x;node.y=y;result.push(node);if(!node.children){return;
}assignCoordinates(node.children[0],x+1,y,result);if(node.children.length>1){assignCoordinates(node.children[1],x+0.5,y+1,result);
}};var updateTreeLayout=function(settings){var nodes=[];assignCoordinates(currentBundle.node,0,0,nodes);
var horizontalNodes=_.max(nodes,function(n){return n.x;}).x+1;var verticalNodes=_.max(nodes,function(n){return n.y;
}).y+1;var treeWidth=horizontalNodes*boxWidth+extraWidthForFinalTableNode;var treeHeight=verticalNodes*boxHeight;
svg.attr("width",treeWidth+2).attr("height",treeHeight+2);var updateNodeSelector=svgGroup.selectAll(".sf-dataoverview-edit-table-node").data(nodes,function(node){return node.id;
});updateNodeSelector.call(setSelectedNode);var newNodeGroupSelector=updateNodeSelector.enter().append("g");
newNodeGroupSelector.call(applySettingsForNewNodes,settings,treeWidth,treeHeight).call(setSelectedNode);
if(debug){var newDebugBoxSelector=newNodeGroupSelector.append("rect");newDebugBoxSelector.attr("x",function(node){return Math.floor(-boxWidth/2)-getExtraWidthIfFinalTable(node)-0.5+"px";
}).attr("y",Math.floor(-boxHeight/2)-0.5+"px").attr("width",function(node){return Math.floor(boxWidth)+getExtraWidthIfFinalTable(node)+"px";
}).attr("height",Math.floor(boxHeight)+"px").style("stroke","red");}var displayNameFontFamily=$treeLayoutContent.css("font-family");
var nodeBackgroundColor=styleBundle.lowerRightPaneBackgroundColor;var iconGrayColor=styleBundle.iconGrayColor;
var extraBadgeWidth=function(node){var n=Math.max(node.badgeCount,1);return Math.floor(Math.log(n)/Math.log(10))*badgeTextFontSize/2;
};var getBadgeY=function(node){return nodeYOffset(node)+Math.floor(-actualNodeHeight(node)/2)-(selectedNodeBorderSize+1)/2-2;
};var needsInfoButton=function(node){return node.topFrozen||node.topEmbed;};var updateMainNodes=function(){newNodeGroupSelector.append("clipPath").attr("id",function(node){return"node-clip"+node.id;
}).append("rect").attr("x",-(nodeWidth+nodeBorderStroke)/2+0.5+"px").attr("y",function(node){return nodeYOffset(node)+Math.floor(-actualNodeHeight(node)/2)+(nodeBorderStroke/2)+"px";
}).attr("width",nodeWidth+"px").attr("height",function(node){return actualNodeHeight(node)+nodeBorderStroke+"px";
}).attr("rx",nodeRadius+"px").attr("ry",nodeRadius+"px");var newNodeRectSelector=newNodeGroupSelector.append("rect");
newNodeRectSelector.attr("class","sf-dataoverview-edit-table-rect").attr("x",function(node){return -(nodeWidth+nodeBorderStroke)/2-getExtraWidthIfFinalTable(node)+"px";
}).attr("y",function(node){return nodeYOffset(node)+Math.floor(-actualNodeHeight(node)/2)+(nodeBorderStroke/2)+"px";
}).attr("width",function(node){return(nodeWidth+nodeBorderStroke)+getExtraWidthIfFinalTable(node)+"px";
}).attr("height",function(node){return actualNodeHeight(node)+nodeBorderStroke+"px";}).attr("rx",nodeRadius+"px").attr("ry",nodeRadius+"px").style("stroke",styleBundle.nodeBorderColor).style("stroke-width",nodeBorderStroke).style("fill",function(node){return isFinalTableNode(node)?styleBundle.finalTableBackgroundColor:nodeBackgroundColor;
});function nodeBorderX(node){return -(nodeWidth+nodeBorderStroke+selectedNodeBorderSize+1)/2-getExtraWidthIfFinalTable(node);
}function nodeBorderWidth(node){return(nodeWidth+nodeBorderStroke*2+selectedNodeBorderSize)+getExtraWidthIfFinalTable(node);
}var newNodeRectBorderHoverSelector=newNodeGroupSelector.append("rect");newNodeRectBorderHoverSelector.attr("class","sf-dataoverview-edit-table-node-hoverborder").attr("x",function(node){return nodeBorderX(node)+"px";
}).attr("y",function(node){return nodeYOffset(node)+Math.floor(-actualNodeHeight(node)/2)-(selectedNodeBorderSize+1)/2+(nodeBorderStroke/2)+"px";
}).attr("width",function(node){return nodeBorderWidth(node)+"px";}).attr("height",function(node){return actualNodeHeight(node)+nodeBorderStroke*2+selectedNodeBorderSize+"px";
}).attr("rx",selectedNodeBorderSize*1.6+"px").attr("ry",selectedNodeBorderSize*1.6+"px").style("stroke",styleBundle.hoverNodeBorderColor).style("stroke-width",selectedNodeBorderSize);
var newNodeRectBorderSelector=newNodeGroupSelector.append("rect");newNodeRectBorderSelector.attr("class","sf-dataoverview-edit-table-node-border").attr("x",function(node){return nodeBorderX(node)+"px";
}).attr("y",function(node){return nodeYOffset(node)+Math.floor(-actualNodeHeight(node)/2)-(selectedNodeBorderSize+1)/2+(nodeBorderStroke/2)+"px";
}).attr("width",function(node){return nodeBorderWidth(node)+"px";}).attr("height",function(node){return actualNodeHeight(node)+nodeBorderStroke*2+selectedNodeBorderSize+"px";
}).attr("rx",selectedNodeBorderSize*1.6+"px").attr("ry",selectedNodeBorderSize*1.6+"px").style("stroke",styleBundle.selectedNodeBorderColor).style("stroke-width",selectedNodeBorderSize);
var newNodeSeparatorLineSelector=newNodeGroupSelector.append("line");newNodeSeparatorLineSelector.attr("x1",-(nodeWidth+nodeBorderStroke)/2+"px").attr("y1",function(node){return nodeYOffset(node)+Math.ceil(-actualNodeHeight(node)/2)+(nodeBorderStroke/2)+nodeWithoutButtonHeight+"px";
}).attr("x2",(nodeWidth+nodeBorderStroke)/2+"px").attr("y2",function(node){return nodeYOffset(node)+Math.ceil(-actualNodeHeight(node)/2)+(nodeBorderStroke/2)+nodeWithoutButtonHeight+"px";
}).style("stroke",styleBundle.nodeBorderColor).style("stroke-width",nodeBorderStroke).style("visibility",function(node){return nodeButtonVisible(node)?"visible":"hidden";
});var finalTableIconPadding=6;var newNodeRectFinalTableRect=newNodeGroupSelector.filter(isFinalTableNode).append("rect");
newNodeRectFinalTableRect.attr("x",function(node){return Math.floor(-iconWidth/2)-getExtraWidthIfFinalTable(node)-finalTableIconPadding-0.5+"px";
}).attr("y",function(node){return nodeYOffset(node)+Math.floor(-actualNodeHeight(node)/2)+1+iconMarginHeight+nodePaddingHeight-finalTableIconPadding-0.5+"px";
}).attr("width",iconWidth+finalTableIconPadding*2+1+"px").attr("height",iconHeight+finalTableIconPadding*2+1+"px").style("stroke",styleBundle.nodeBorderColor).style("stroke-width",nodeBorderStroke).style("fill",nodeBackgroundColor).attr("rx",finalTableIconPadding/2+"px").attr("ry",finalTableIconPadding/2+"px");
newNodeGroupSelector.append(function(node){var x=document.createElementNS("http://www.w3.org/2000/svg","g");
Spotfire.Data.Icons.get("Images/Data/"+node.iconName,function($svg){var svgNode=$("<div>").append($svg).get(0).firstChild;
d3.select(svgNode).attr("class","sf-dataoverview-edit-table-icon").attr("x",Math.floor(-iconWidth/2)-getExtraWidthIfFinalTable(node)+"px").attr("y",nodeYOffset(node)+Math.floor(-actualNodeHeight(node)/2)+1+iconMarginHeight+nodePaddingHeight+"px").attr("width",iconWidth+"px").attr("height",iconHeight+"px").style("fill",iconGrayColor);
x.appendChild(svgNode);});return x;});var newNodeDisplayNameSelector=newNodeGroupSelector.append("g").attr("class","sf-dataoverview-edit-table-displayname").attr("fill","currentColor").attr("text-anchor",function(node){return isFinalTableNode(node)?"left":"middle";
});var generateDisplayNameTextElement=function(node){var x=isFinalTableNode(node)?(nodeWidth/2)+10-extraWidthForFinalTableNode:0;
var y;if(isFinalTableNode(node)){y=nodeYOffset(node)-Math.floor(actualNodeHeight(node)/2)-10+25+13;}else{y=nodeYOffset(node)+Math.floor(actualNodeHeight(node)/2)+labelMarginTop+labelFontSize-1;
}var maxWidth=isFinalTableNode(node)?boxWidth-(boxPadding/2+iconMarginWidth):boxWidth;return Spotfire.Svg.createTextElement(node.displayName,labelFontSize,displayNameFontFamily,x,y,maxWidth,1);
};var regenerateDisplayNameAndTitle=function(selection){var displayNameSelection=selection.select(".sf-dataoverview-edit-table-displayname");
displayNameSelection.selectAll("*").remove();displayNameSelection.append(generateDisplayNameTextElement).append("title").text(function(node){return node.displayName;
});};newNodeDisplayNameSelector.call(regenerateDisplayNameAndTitle);updateNodeSelector.call(regenerateDisplayNameAndTitle);
var finalTableNewNodeGroupSelector=newNodeGroupSelector.filter(function(node){return isFinalTableNode(node);
});finalTableNewNodeGroupSelector.append(function(node){var x=nodeWidth/2+10-extraWidthForFinalTableNode;
var dy=20;var y=nodeYOffset(node)-Math.floor(actualNodeHeight(node)/2)-10+25+13+dy;var maxWidth=boxWidth-(boxPadding/2+iconMarginWidth);
return Spotfire.Svg.createTextElement(Spotfire.Localization.resources.DataOverview_FinalDataTableDescription,labelFontSize,displayNameFontFamily,x,y,maxWidth,2);
}).attr("fill",styleBundle.textColorDimmed);};var updateInfoButtons=function(){var newNodeGroupInfoSelector=newNodeGroupSelector.filter(needsInfoButton);
newNodeGroupInfoSelector.append("line").attr("x1",function(node){return -boxWidth/2+0.5-getExtraWidthIfFinalTable(node)+"px";
}).attr("y1",function(node){return nodeYOffset(node)-20+"px";}).attr("x2",function(node){return -boxWidth/2+0.5-getExtraWidthIfFinalTable(node)+"px";
}).attr("y2",function(node){return nodeYOffset(node)+20+"px";}).attr("stroke",styleBundle.textColorDimmed).attr("stroke-width","1px");
var infoIconButtonWidth=28;var infoIconButtonHeight=28;var newButtonIconInfoSelector=newNodeGroupInfoSelector.append(function(node){var x=document.createElementNS("http://www.w3.org/2000/svg","g");
d3.select(x).attr("class","sf-dataoverview-edit-table-info-icon").append("circle").attr("r",infoIconButtonHeight/2+3).attr("cx",function(){return Math.floor(-boxWidth/2+1)-getExtraWidthIfFinalTable(node)+"px";
}).attr("cy",function(){return nodeYOffset(node)+30+infoIconButtonHeight/2+"px";}).attr("fill",nodeBackgroundColor).attr("stroke","#26a2ed").attr("stroke-width","2px").attr("class","sf-dataoverview-edit-table-info-icon-hoverborder");
Spotfire.getSvg("Images/Data/Info28x28.svg",function($svg){var svgNode=$("<div>").append($svg).get(0).firstChild;
d3.select(svgNode).attr("x",function(){return Math.floor(-boxWidth/2-infoIconButtonWidth/2+1)-getExtraWidthIfFinalTable(node)+"px";
}).attr("y",function(){return nodeYOffset(node)+30+"px";}).attr("width",infoIconButtonWidth+"px").attr("height",infoIconButtonHeight+"px");
x.appendChild(svgNode);});return x;});newButtonIconInfoSelector.append("title").text(function(node){if(node.topFrozen){return Spotfire.Localization.resources.DataOverview_FrozenColumnTooltip;
}if(node.topEmbed){return Spotfire.Localization.resources.DataOverview_EmbeddedTableTooltip;}return"";
});newButtonIconInfoSelector.on("click",function(node){var clientRect=this.getBoundingClientRect();var x=(clientRect.left+clientRect.right)/2;
var y=clientRect.bottom;var $popover=$("<div>").addClass("sf-dataoverview-edit-table-text-info-popout");
var args={x:x,y:y,alignment:"Top",dummy:true};var id="DataOverviewInfoPopoutId";var builder=Spotfire.Visuals.ContextualPopout.builder(id,args,$popover);
var header="";var text="";if(node.topFrozen){header=node.displayName;text=Spotfire.Localization.resources.DataOverview_FrozenColumnDescription;
}else{if(node.topEmbed){header=Spotfire.Localization.resources.DataOverview_EmbeddedTableHeader;text=Spotfire.Localization.resources.DataOverview_EmbeddedTableDescription;
}}var $container=$("<div/>");$("<div/>").text(header).addClass("sf-dataoverview-edit-table-text-info-popout-header").appendTo($container);
$("<div/>").text(text).addClass("sf-dataoverview-edit-table-text-info-popout-text").appendTo($container);
if(node.topEmbed&&node.canSetLinked){$("<div/>").text(Spotfire.Localization.resources.DataOverview_EmbeddedTableChangeToLinkedDescription).addClass("sf-dataoverview-edit-table-text-info-popout-text").appendTo($container);
}builder.beginSection().beginRow().addNode("dummy",$container).endRow().endSection();Spotfire.Visuals.ContextualPopout.showPropertiesPopover(id,args,$popover);
});};var updateNodeBadges=function(){var getBadgeX=function(node){return Math.floor(nodeWidth/2-badgeRadius-badgeRadius/2-extraBadgeWidth(node)/2+2);
};var newNodeBadgeRectSelector=newNodeGroupSelector.append("rect");newNodeBadgeRectSelector.attr("class","sf-dataoverview-edit-table-node-badge").attr("x",function(node){return getBadgeX(node)+"px";
}).attr("y",function(node){return getBadgeY(node)+"px";}).attr("width",function(node){return Math.floor(badgeRadius*2)+extraBadgeWidth(node)-2+"px";
}).attr("height",Math.floor(badgeRadius*2)-2+"px").attr("rx",badgeRadius+"px").attr("ry",badgeRadius+"px").style("fill",getBadgeColor).style("stroke",getBadgeColor).style("stroke-opacity",1).style("stroke-width","2px");
var newNodeBadgeTextSelector=newNodeGroupSelector.append("text");newNodeBadgeTextSelector.attr("class","sf-dataoverview-edit-table-node-badge-text").attr("x",Math.floor(nodeWidth/2-badgeRadius/2)+1+"px").attr("y",function(node){return nodeYOffset(node)+Math.floor(-actualNodeHeight(node)/2)+badgeTextFontSize*3/4+"px";
}).attr("fill","white").attr("text-anchor","middle").attr("font-size",badgeTextFontSize+"px");var badgeTooltip=function(node){return isFinalTableNode(node)?Spotfire.Localization.resources.DataOverview_AddedActions:Spotfire.Localization.resources.DataOverview_AddedTransformations;
};newNodeBadgeRectSelector.append("title").text(badgeTooltip);newNodeBadgeTextSelector.append("title").text(badgeTooltip);
var setBadgeVisibility=function(selection){selection.style("visibility",function(node){return node.badgeCount>=1?"visible":"hidden";
});};var setBadgeText=function(selection){selection.text(function(node){return node.badgeCount;}).style("visibility",function(node){return node.badgeCount>=1?"visible":"hidden";
});};updateNodeSelector.selectAll(".sf-dataoverview-edit-table-node-badge").data(function(d){return[d];
}).call(setBadgeVisibility);updateNodeSelector.selectAll(".sf-dataoverview-edit-table-node-badge-text").data(function(d){return[d];
}).call(setBadgeText);newNodeGroupSelector.selectAll(".sf-dataoverview-edit-table-node-badge").call(setBadgeVisibility);
newNodeGroupSelector.selectAll(".sf-dataoverview-edit-table-node-badge-text").call(setBadgeText);};var updateNodeNotifications=function(){var hasNotification=function(node){return node.hasErrors;
};var notificationSize=badgeRadius*2;var getNotificationX=function(){return Math.floor(nodeWidth/2-notificationSize/2-notificationSize/4+1);
};var getNotificationY=function(node){var y=getBadgeY(node)-1;if(node.badgeCount>0){y+=(badgeRadius*2)+2;
}return y;};var newNodeNotificationGroupSelector=newNodeGroupSelector.append("g").filter(hasNotification).attr("width",notificationSize+"px").attr("height",notificationSize+"px");
newNodeNotificationGroupSelector.append(function(node){var x=document.createElementNS("http://www.w3.org/2000/svg","g");
Spotfire.getSvg("Images/Data/EditTable/Error20x20.svg",function($svg){var svgNode=$("<div>").append($svg).get(0).firstChild;
d3.select(svgNode).attr("x",function(){return getNotificationX()+"px";}).attr("y",function(){return getNotificationY(node)+"px";
}).attr("width",notificationSize+"px").attr("height",notificationSize+"px");x.appendChild(svgNode);});
return x;});};var getNodeButtonWidth=function(node){return node.isEditable&&dataLoadingOrInfoButtonVisible(node)?nodeWidth/2:nodeWidth;
};var getNodeButtonX=function(node,type){if(node.isEditable&&type==="info"){return 0;}return -nodeWidth/2;
};var getNodeButtonY=function(node){return nodeYOffset(node)+Math.ceil(-actualNodeHeight(node)/2)+(nodeBorderStroke/2)+0.5+nodeWithoutButtonHeight;
};var getNodeButtonIconX=function(node,type){if(type==="info"){return node.isEditable?Math.floor(-dataCachingIconWidthHeight/2+nodeWidth/4):Math.floor(-dataCachingIconWidthHeight/2);
}return dataLoadingOrInfoButtonVisible(node)?Math.floor(-editIconWidthHeight/2-nodeWidth/4):Math.floor(-editIconWidthHeight/2);
};var getNodeButtonIconY=function(node,type){var iconSize=type==="info"?dataCachingIconWidthHeight:editIconWidthHeight;
return nodeYOffset(node)+Math.ceil(-actualNodeHeight(node)/2)+(nodeBorderStroke/2)+0.5+nodeWithoutButtonHeight+(nodeButtonHeight-iconSize)/2;
};var updateNodeDataLoadingButtons=function(){var setDataCachingBehavior=function(selection){selection.on("click",function(d){var clientRect=this.getBoundingClientRect();
showLoadOptionsPopout(settings,d,clientRect.right,clientRect.top+clientRect.height/2);});selection.select(".sf-dataoverview-edit-table-node-data-caching-title").text(function(d){if(d.dataCachingBehaviors){return getSelectedDataCachingBehaviorDisplayName(d.dataCachingBehaviors);
}if(d.dataLoadingDescription){return Spotfire.Localization.resources.DataOverview_InfoButtonTooltip;}return"";
});var iconSelection=selection.select(".sf-dataoverview-edit-table-node-data-caching-icon");iconSelection.selectAll("*").remove();
iconSelection.append(function(node){var x=document.createElementNS("http://www.w3.org/2000/svg","g");
if(dataLoadingOrInfoButtonVisible(node)){var nodeIcon="Images/Data/"+(node.dataCachingBehaviors?getSelectedDataCachingBehaviorIcon(node.dataCachingBehaviors):"EditTable/Info.svg");
Spotfire.getSvg(nodeIcon,function($svg){var svgNode=$("<div>").append($svg).get(0).firstChild;d3.select(svgNode).attr("x",function(){return getNodeButtonIconX(node,"info")+"px";
}).attr("y",function(){return getNodeButtonIconY(node,"info")+"px";}).attr("width",dataCachingIconWidthHeight+"px").attr("height",dataCachingIconWidthHeight+"px");
x.appendChild(svgNode);});}return x;});};var updateDataCachingSelector=updateNodeSelector.selectAll(".sf-dataoverview-edit-table-node-data-caching").data(function(d){return[d];
});updateDataCachingSelector.call(setDataCachingBehavior);var newDataCachingBehaviorButtonGroup=newNodeGroupSelector.append("g");
newDataCachingBehaviorButtonGroup.attr("class","sf-dataoverview-edit-table-node-data-caching").style("fill","url(#dataCachingButtonGradient)").on("mouseover",function(){d3.select(this).style("fill","url(#dataCachingButtonGradientHover)");
}).on("mouseleave",function(){d3.select(this).style("fill","url(#dataCachingButtonGradient)");});newDataCachingBehaviorButtonGroup.append("rect").attr("clip-path",function(d){return"url(#node-clip"+d.id+")";
}).attr("x",function(node){return getNodeButtonX(node,"info")+"px";}).attr("y",function(node){return getNodeButtonY(node)+"px";
}).attr("width",function(node){return getNodeButtonWidth(node)+"px";}).attr("height",nodeButtonHeight+"px").style("visibility",function(node){return dataLoadingOrInfoButtonVisible(node)?"visible":"hidden";
});newDataCachingBehaviorButtonGroup.append("title").attr("class","sf-dataoverview-edit-table-node-data-caching-title");
newDataCachingBehaviorButtonGroup.append("g").attr("class","sf-dataoverview-edit-table-node-data-caching-icon");
newDataCachingBehaviorButtonGroup.call(setDataCachingBehavior);};var updateNodeEditButtons=function(){var isEditable=function(node){return node.isEditable;
};var newEditButtonGroup=newNodeGroupSelector.filter(isEditable).append("g");newEditButtonGroup.attr("class","sf-dataoverview-edit-table-node-edit-button").style("fill","url(#dataCachingButtonGradient)").style("color",styleBundle.editButtonColor).on("mouseover",function(){d3.select(this).style("fill","url(#dataCachingButtonGradientHover)");
}).on("mouseleave",function(){d3.select(this).style("fill","url(#dataCachingButtonGradient)");}).on("click",function(node){var editArgs={id:node.id,tableId:settings.tableId};
if(Spotfire.isWebPlayer()){Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,"EditProducer",JSON.stringify(editArgs));
}else{Spotfire.PageBus.publish("spotfire.dataoverview.editproducer",editArgs,viewId);}});newEditButtonGroup.append("rect").attr("clip-path",function(d){return"url(#node-clip"+d.id+")";
}).attr("x",function(node){return getNodeButtonX(node,"edit")+"px";}).attr("y",function(node){return getNodeButtonY(node)+"px";
}).attr("width",function(node){return getNodeButtonWidth(node)+"px";}).attr("height",nodeButtonHeight+"px");
newEditButtonGroup.append("title").text(Spotfire.Localization.resources.DataOverview_EditSettingsTooltip);
newEditButtonGroup.append(function(node){var x=document.createElementNS("http://www.w3.org/2000/svg","g");
Spotfire.getSvg("Images/Data/EditTable/Settings14x14.svg",function($svg){var svgNode=$("<div>").append($svg).get(0).firstChild;
d3.select(svgNode).attr("x",function(){return getNodeButtonIconX(node,"edit")+"px";}).attr("y",function(){return getNodeButtonIconY(node,"edit")+"px";
}).attr("width",editIconWidthHeight+"px").attr("height",editIconWidthHeight+"px");x.appendChild(svgNode);
});return x;});};var updateSplitButtonBorder=function(){var hasSplitButton=function(node){return node.isEditable&&dataLoadingOrInfoButtonVisible(node);
};var splitButton=newNodeGroupSelector.filter(hasSplitButton);splitButton.append("line").attr("x1","-0.5px").attr("y1",function(node){return nodeYOffset(node)+Math.ceil(-actualNodeHeight(node)/2)+(nodeBorderStroke/2)+nodeWithoutButtonHeight+"px";
}).attr("x2","-0.5px").attr("y2",function(node){return nodeYOffset(node)+Math.ceil(-actualNodeHeight(node)/2)+(nodeBorderStroke/2)+nodeWithoutButtonHeight+nodeButtonHeight+1+"px";
}).style("stroke",styleBundle.nodeBorderColor).style("stroke-width",nodeBorderStroke);splitButton.append("line").attr("x1","0.5px").attr("y1",function(node){return nodeYOffset(node)+Math.ceil(-actualNodeHeight(node)/2)+(nodeBorderStroke/2)+nodeWithoutButtonHeight+0.5+"px";
}).attr("x2","0.5px").attr("y2",function(node){return nodeYOffset(node)+Math.ceil(-actualNodeHeight(node)/2)+(nodeBorderStroke/2)+nodeWithoutButtonHeight+nodeButtonHeight+0.5+"px";
}).style("stroke",nodeBackgroundColor).style("stroke-width",nodeBorderStroke);};var updateTreeLinks=function(){var links=tree.links(nodes);
var updateLinkSelector=svgGroup.selectAll(".sf-dataoverview-edit-table-link").data(links);var lineGenerator=d3.svg.line().x(function(node){return treeWidth-(isFinalTableNode(node)?0:extraWidthForFinalTableNode)-Math.floor(boxWidth/2)-(node.x*boxWidth)+0.5;
}).y(function(node){return(nodeYOffset(node)+Math.floor(boxHeight/2+node.y*boxHeight)+0.5+1);}).interpolate("basis");
var lineLength=0.5+((boxPadding-1)/boxWidth);var newLinkSelector=updateLinkSelector.enter().append("path");
var realLineLengthForStraightLine=boxWidth-nodeWidth;newLinkSelector.attr("class","sf-dataoverview-edit-table-link").attr("stroke",styleBundle.arrowColor).style("stroke-width",1+"px").attr("stroke-dasharray",function(d){if(needsInfoButton(d.source)){return(realLineLengthForStraightLine/2-13)+", 20, "+realLineLengthForStraightLine;
}return realLineLengthForStraightLine;}).attr("d",function(d){var lineData;if(d.target.y===0){lineData=[{x:(lineLength*d.source.x+(1-lineLength)*d.target.x),y:(lineLength*d.source.y+(1-lineLength)*d.target.y)},{x:((1-lineLength)*d.source.x+lineLength*d.target.x),y:((1-lineLength)*d.source.y+lineLength*d.target.y)}];
}else{lineData=[{x:d.source.x,y:d.source.isEditable?d.source.y+0.63:d.source.y+0.5},{x:d.source.x,y:d.source.isEditable?d.source.y+0.66:d.source.y+0.53},{x:d.target.x-0.5,y:d.target.y-0.1},{x:d.target.x-0.3,y:d.target.y-0.01},{x:d.target.x-(0.5-((boxPadding-1)/(boxWidth/2))/2),y:d.target.y+0.03}];
}return lineGenerator(lineData);}).attr("marker-start",function(d){if(isFinalTableNode(d.source)){return"url(#circleMarker)";
}return d.source.y===d.target.y?"url(#arrowRight)":"url(#arrowUp)";});};updateMainNodes();updateNodeDataLoadingButtons();
updateNodeEditButtons();updateSplitButtonBorder();updateNodeBadges();updateNodeNotifications();updateInfoButtons();
updateTreeLinks();};var initTreeLayout=function(settings){$upperPaneScrollableContainer.empty();$treeLayoutContent=$("<div/>").addClass("sf-dataoverview-edit-table-content-tree-layout").appendTo($upperPaneScrollableContainer);
svg=d3.select($treeLayoutContent.get(0)).append("svg").style("display","block").style("margin","auto");
svgGroup=svg.append("g");var defs=svg.append("defs");var arrows=[{name:"arrowRight",path:"M -10,-10 L 0,0 L -10,10",viewBox:"-10 -10 10 20"},{name:"arrowUp",path:"M -10,10 L 0,0 L 10,10",viewBox:"-10 0 20 10"}];
defs.selectAll("marker").data(arrows).enter().append("svg:marker").attr("id",function(d){return d.name;
}).attr("markerHeight",15+"px").attr("markerWidth",15+"px").attr("markerUnits","strokeWidth").attr("viewBox",function(d){return d.viewBox;
}).append("svg:path").attr("d",function(d){return d.path;}).attr("stroke",styleBundle.arrowColor).attr("stroke-width",1.5+"px");
defs.append("clipPath").attr("id","finalTableMarkerClipPath").append("rect").attr("x","1.5px").attr("y","-10px").attr("width","10px").attr("height","20px");
var circleMarker=defs.append("marker").attr("id","circleMarker").attr("markerHeight",19+"px").attr("markerWidth",20+"px").attr("viewBox","-9 -9 20 19");
circleMarker.append("svg:circle").attr("clip-path","url(#finalTableMarkerClipPath)").attr("cx","2.0px").attr("cy","0.0px").attr("r","8.5px").attr("fill",styleBundle[side].backgroundColor).attr("stroke",styleBundle.nodeBorderColor).attr("stroke-width","1px");
circleMarker.append("svg:circle").attr("cx","2.0px").attr("cy","0.0px").attr("r","5px").attr("fill",styleBundle[side].backgroundColor).attr("stroke",styleBundle.arrowColor);
var buttonGradient=defs.append("linearGradient").attr("id","dataCachingButtonGradient").attr("x1","0").attr("x2","0").attr("y1","0%").attr("y2","100%").attr("spreadMethod","pad");
buttonGradient.append("stop").attr("offset","0%").attr("stop-color",styleBundle.buttonGradientTop).attr("stop-opacity",1);
buttonGradient.append("stop").attr("offset","100%").attr("stop-color",styleBundle.buttonGradientBottom).attr("stop-opacity",1);
var buttonGradientHover=defs.append("linearGradient").attr("id","dataCachingButtonGradientHover").attr("x1","0").attr("x2","0").attr("y1","0%").attr("y2","100%").attr("spreadMethod","pad");
buttonGradientHover.append("stop").attr("offset","0%").attr("stop-color",styleBundle.buttonGradientTopHover).attr("stop-opacity",1);
buttonGradientHover.append("stop").attr("offset","100%").attr("stop-color",styleBundle.buttonGradientBottomHover).attr("stop-opacity",1);
tree=d3.layout.tree();updateTreeLayout(settings);};var updateInfoPreviewLayout=function(settings,selectedNode){var tabMode=settings.editTableModeSettings.tabMode;
if(selectedNode&&selectedNode.type==="producer"){$previewSettingsTab.show();}else{$previewSettingsTab.hide();
tabMode="";}$previewSettingsTab.removeClass("sfpc-selected");$previewSettingsTab.css("color","");$informationSettingsTab.removeClass("sfpc-selected");
$informationSettingsTab.css("color","");if(tabMode==="preview"){$previewSettingsTab.addClass("sfpc-selected");
$previewSettingsTab.css("color",styleBundle.producerBadgeColor);}else{$informationSettingsTab.addClass("sfpc-selected");
$informationSettingsTab.css("color",styleBundle.producerBadgeColor);}$tabLayoutContentScrollableContainer.empty();
if(tabLayoutContentScrollbar){tabLayoutContentScrollbar.destroy();tabLayoutContentScrollbar=null;}if(tabMode==="preview"){$tabLayoutContentScrollableContainer.css({"overflow-x":"hidden","overflow-y":"hidden"});
if(settings.editTableModeSettings.canShowPreview){var plotBounds={width:$tabLayoutContentScrollableContainer.width(),height:$tabLayoutContentScrollableContainer.height()};
Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,"GetPreviewTable",JSON.stringify(plotBounds));}else{$("<div/>").text(settings.editTableModeSettings.noPreviewReason).addClass("sf-dataoverview-edit-table-tab-layout-details-content sf-dataoverview-edit-table-details-message").appendTo($tabLayoutContentScrollableContainer);
}}else{$tabLayoutContentScrollableContainer.css({"overflow-x":"auto","overflow-y":"auto"});var $content=$("<div/>").addClass("sf-dataoverview-edit-table-tab-layout-details-content").appendTo($tabLayoutContentScrollableContainer);
var infoSettingsCallback=function(bundle){$content.empty();if(bundle.message){$content.text(bundle.message);
}else{if(bundle.infoItems){bundle.infoItems.forEach(function(infoItem){if(infoItem.type==="table"){var $table=$("<div/>").addClass("sf-dataoverview-edit-table-info-item").appendTo($content);
infoItem.rows.forEach(function(row){var $row=$("<div/>").addClass("sf-dataoverview-edit-table-info-table-row").appendTo($table);
$("<div/>").addClass("sf-dataoverview-edit-table-info-table-column sf-dataoverview-edit-table-info-table-column-key").text(row.Key).appendTo($row);
var $rightColumn=$("<div/>").addClass("sf-dataoverview-edit-table-info-table-column").appendTo($row);
row.Value.forEach(function(value){var $cell=value.preFormatted?$("<pre/>"):$("<div/>");$cell.text(value.value).appendTo($rightColumn);
});});}else{if(infoItem.type==="preformattedText"){$("<pre/>").addClass("sf-dataoverview-edit-table-info-item sf-dataoverview-edit-table-preformatted-text").text(infoItem.text).appendTo($content);
}}});}}tabLayoutContentScrollbar=$tabLayoutContentScrollableContainer.StyledScrollbar();tabLayoutContentScrollbar.refresh();
};var args={tableId:settings.tableId};Spotfire.Dxp.Web.Forms.AjaxService.Read(viewId,"GetProducerInformationAndSettings",JSON.stringify(args),infoSettingsCallback);
}};var updateStepsAndInfoPreviewLayout=function(settings,selectedNode){if(selectedNode){$lowerPaneNodeSelectedContainer.fadeIn(200);
$lowerPaneNoNodeSelectedContainer.hide();updatePaneWidthsAndHeights();updateStepsLayout(settings,selectedNode);
updateInfoPreviewLayout(settings,selectedNode);}else{updatePaneWidthsAndHeights();$lowerPaneNodeSelectedContainer.hide();
$lowerPaneNoNodeSelectedContainer.hide();$lowerPaneNoNodeSelectedContainer.fadeIn(200);}};var initEditTableLayout=function(settings){var callback=function(bundle){if(!bundle.node){return;
}currentBundle=bundle;initTreeLayout(settings);var selectedNode=getSelectedNode(currentBundle.node);updateStepsAndInfoPreviewLayout(settings,selectedNode);
};var args={tableId:settings.tableId};Spotfire.Dxp.Web.Forms.AjaxService.Read(viewId,"GetEditTableLayout",JSON.stringify(args),callback);
};var createMainLayout=function(settings,$dataOverviewContainer,resizeFuncs){styleBundle=settings.style;
var $editTableContainer=$("<div/>").addClass("sf-dataoverview-edit-table-container").appendTo($dataOverviewContainer);
$editTableContainer.height($editTableContainer.height());var $upperPane=$("<div/>").addClass("sf-dataoverview-edit-table-upper-pane").appendTo($editTableContainer);
$upperPaneScrollableContainer=$("<div/>").addClass("sf-dataoverview-edit-table-scrollable-container").appendTo($upperPane);
$upperPaneScrollableContainer.on("click",function(e){if(e.target===this||(svg&&e.target===svg.node())){var args={tableId:settings.tableId,id:"00000000-0000-0000-0000-000000000000",type:"table"};
Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,"SetSelectedNode",JSON.stringify(args));}});var upperPaneScrollbar=$upperPaneScrollableContainer.StyledScrollbar();
var $lowerPaneContainer=$("<div/>").addClass("sf-dataoverview-edit-table-lower-pane-container").css("border-color",styleBundle.lowerPaneBorderColor).appendTo($editTableContainer);
$lowerPaneNodeSelectedContainer=$("<div/>").appendTo($lowerPaneContainer).hide();$lowerPaneNoNodeSelectedContainer=$("<div/>").addClass("sf-dataoverview-edit-table-no-node-selected").appendTo($lowerPaneContainer).hide();
var $imgDiv=$("<div/>").addClass("sf-dataoverview-edit-table-no-node-selected-image").appendTo($lowerPaneNoNodeSelectedContainer);
Spotfire.getSvg("Images/Data/EditTable/NoNodeSelected.svg",function($svg){$svg.appendTo($imgDiv);});$("<div/>").addClass("sf-dataoverview-edit-table-no-node-selected-text").text(Spotfire.Localization.resources.DataOverview_SelectNode).appendTo($lowerPaneNoNodeSelectedContainer);
var $lowerLeftPane=$("<div/>").addClass("sf-dataoverview-edit-table-lower-left-pane").css("border-color",styleBundle.lowerPaneBorderColor).css("background-color",styleBundle.lowerLeftPaneBackgroundColor).appendTo($lowerPaneNodeSelectedContainer);
$lowerLeftPaneScrollableContainer=$("<div/>").addClass("sf-dataoverview-edit-table-scrollable-container").appendTo($lowerLeftPane);
lowerLeftPaneScrollbar=$lowerLeftPaneScrollableContainer.StyledScrollbar();var $lowerRightPane=$("<div/>").addClass("sf-dataoverview-edit-table-lower-right-pane").css("background-color",styleBundle.lowerRightPaneBackgroundColor).appendTo($lowerPaneNodeSelectedContainer);
var $tabLayoutTabs=$("<div/>").addClass("sf-dataoverview-edit-table-tab-layout-tabs").appendTo($lowerRightPane);
$informationSettingsTab=$("<div/>").addClass("sf-dataoverview-edit-table-tab-layout-tab").text(Spotfire.Localization.resources.DataOverview_Information).css("border-color",styleBundle.selectedTabLineColor).on("click",function(){var args={tabMode:"",tableId:settings.tableId};
Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,"SetTabMode",JSON.stringify(args));}).appendTo($tabLayoutTabs);
$previewSettingsTab=$("<div/>").addClass("sf-dataoverview-edit-table-tab-layout-tab").text(Spotfire.Localization.resources.DataOverview_Data).css("border-color",styleBundle.selectedTabLineColor).on("click",function(){var args={tabMode:"preview",tableId:settings.tableId};
Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,"SetTabMode",JSON.stringify(args));}).appendTo($tabLayoutTabs);
var $tabLayoutContent=$("<div/>").css("border-color",styleBundle.tabLineColor).addClass("sf-dataoverview-edit-table-tab-layout-content").appendTo($lowerRightPane);
$tabLayoutContentScrollableContainer=$("<div/>").addClass("sf-dataoverview-edit-table-scrollable-container").appendTo($tabLayoutContent);
var upperPaneHeightPercentage=settings.editTableModeSettings.upperPaneHeightPercentage;var lowerLeftPaneWidth=300;
var resizePreviewTableFunc=_.debounce(function(width,height){var plotBounds={width:width,height:height};
Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,"ResizePreviewTable",JSON.stringify(plotBounds));},100,false);
var onUpperPaneContainerResize=function(){var upperHeight=$upperPane.height();$upperPaneScrollableContainer.height(upperHeight);
if($treeLayoutContent&&svg){var top=Math.max(0,upperHeight-svg.attr("height"));$treeLayoutContent.css("position","relative");
$treeLayoutContent.css("top",top/2+"px");}var lowerHeight=$editTableContainer.height()-upperHeight-2;
$lowerPaneContainer.height(lowerHeight);$lowerLeftPane.height(lowerHeight);$lowerLeftPaneScrollableContainer.height(lowerHeight);
$lowerRightPane.innerHeight(lowerHeight);$tabLayoutContent.outerHeight($lowerRightPane.height()-$tabLayoutTabs.height());
$tabLayoutContentScrollableContainer.height($tabLayoutContent.height());var lowerTop=Math.max(0,lowerHeight-$lowerPaneNoNodeSelectedContainer.height());
$lowerPaneNoNodeSelectedContainer.css("top",lowerTop/2+"px");upperPaneScrollbar.refresh();lowerLeftPaneScrollbar.refresh();
if(tabLayoutContentScrollbar){tabLayoutContentScrollbar.refresh();}else{resizePreviewTableFunc($tabLayoutContentScrollableContainer.width(),$tabLayoutContentScrollableContainer.height());
}upperPaneHeightPercentage=upperHeight/$editTableContainer.height();};var resizeEnd=function(){var args={upperPaneHeightPercentage:upperPaneHeightPercentage};
Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,"SetUpperPaneHeightPercentage",JSON.stringify(args));
};Spotfire.Touch.resizable($upperPane,{handles:"s",minHeight:100,containment:$editTableContainer,drag:onUpperPaneContainerResize,stop:resizeEnd});
updatePaneWidthsAndHeights=function(){$upperPane.height(upperPaneHeightPercentage*$editTableContainer.height());
var upperPaneWidth=$editTableContainer.width();$upperPane.width(upperPaneWidth);$upperPaneScrollableContainer.width(upperPaneWidth);
var lowerRightPaneWidth=$lowerPaneContainer.width()-(lowerLeftPaneWidth+1);$lowerRightPane.innerWidth(lowerRightPaneWidth);
$tabLayoutContentScrollableContainer.width($tabLayoutContent.width());onUpperPaneContainerResize();};
var setInitialPaneWidthsAndHeights=function(){$lowerLeftPane.width(lowerLeftPaneWidth);$lowerLeftPaneScrollableContainer.width(lowerLeftPaneWidth);
updatePaneWidthsAndHeights();};setInitialPaneWidthsAndHeights();resizeFuncs.push(updatePaneWidthsAndHeights);
initEditTableLayout(settings);$editTableContainer.hide();$editTableContainer.fadeIn(200);};var updatePartial=function(settings){if(!svg){return;
}currentBundle=settings.newBundle;var selectedNode=getSelectedNode(currentBundle.node);updateTreeLayout(settings);
updateStepsAndInfoPreviewLayout(settings,selectedNode);};var initPreviewTable=function(id,html){if(!svg){return;
}$tabLayoutContentScrollableContainer.empty();var $html=$(html);$html.attr("viewid",id);$tabLayoutContentScrollableContainer.append($html);
$html.css("background-color",styleBundle[side].dodBackgroundColor);};return{init:createMainLayout,update:updatePartial,initPreviewTable:initPreviewTable};
}});});$(function(){Spotfire.registerNameSpace("DataPanel");var defaultParentId=null;var currentRightClickMenu=null;
var Command={CreateFilters:"CreateFilters",ShowColumnProperties:"ShowColumnProperties",SortColumns:"SortColumns",RenameColumn:"RenameColumn",DeleteColumn:"DeleteColumn",ColumnFormatting:"ColumnFormatting",ColumnCategorization:"ColumnCategorization"};
var onRightClick=function(viewId,args){if(Spotfire.isWebPlayer()){Spotfire.Dxp.Web.Forms.AjaxService.Read(viewId,"RightClick",JSON.stringify(args),function(menuItems){var onMenuClick=function(menuItem){if(menuItem.commandId===Command.RenameColumn){var $dialog=$("<div />").attr("title",Spotfire.Localization.resources.DataPanel_RenameDialog_Title);
$dialog.append("<p>"+Spotfire.Localization.resources.DataPanel_RenameDialog_NameLabel+"</p>");var $input=$("<input type='text' style='box-sizing: border-box; width: 100%' />").addClass("sf-element-input");
$input.attr("value",menuItem.columnName);$dialog.append($input);var onOk=function(){args.newName=$input.val();
Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,menuItem.commandId,JSON.stringify(args));};var buttons=[{id:"okButton",text:Spotfire.Localization.resources.Ok,click:onOk,isDefault:true},{id:"cancelButton",text:Spotfire.Localization.resources.Cancel,isCancel:true}];
$input.keyup(function(){var isValid=$.trim($input.val()).length>0;$("#okButton").prop("disabled",!isValid);
$("#okButton").toggleClass("sfpc-disabled",!isValid);});Spotfire.Controls.ModalDialog.initialize($dialog,{buttons:buttons,modal:true,resizable:true,minHeight:200,zIndex:10000});
}else{if(menuItem.commandId===Command.DeleteColumn){Spotfire.Dxp.Web.Forms.AjaxService.Read(viewId,"IsAnyCalculatedColumnDependentOnColumns",JSON.stringify(args),function(result){if(result){var dialog;
var buttons2=[{text:Spotfire.Localization.resources.DataPanel_DeleteDialog_Delete,isDefault:true,click:function(){Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,menuItem.commandId,JSON.stringify(args));
}},{text:Spotfire.Localization.resources.DataPanel_DeleteDialog_Hide,click:function(){Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,"HideColumn",JSON.stringify(args));
dialog.close();}},{text:Spotfire.Localization.resources.Cancel,isCancel:true}];dialog=Spotfire.ConfirmDialog.showDialog(Spotfire.Localization.resources.DataPanel_DeleteDialog_Title,Spotfire.Localization.resources.DataPanel_DeleteDialog_HideOrDelete,buttons2);
}else{var text=menuItem.columnCount>1?Spotfire.Utilities.formatString(Spotfire.Localization.resources.DataPanel_DeleteDialog_ColumnsFormatString,menuItem.columnCount):Spotfire.Utilities.formatString(Spotfire.Localization.resources.DataPanel_DeleteDialog_ColumnFormatString,menuItem.columnName);
Spotfire.ConfirmDialog.showOkCancelDialog(Spotfire.Localization.resources.DataPanel_DeleteDialog_Title,text,function(){Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,menuItem.commandId,JSON.stringify(args));
});}});}else{if(menuItem.commandId===Command.ColumnCategorization){args.category=menuItem.category;Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,menuItem.commandId,JSON.stringify(args));
}else{Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,menuItem.commandId,JSON.stringify(args));}}}return true;
};if(currentRightClickMenu!==null){currentRightClickMenu.close();}currentRightClickMenu=Spotfire.Controls.ContextMenu.create(menuItems,onMenuClick);
currentRightClickMenu.show(args.x,args.y);});}else{Spotfire.PageBus.publish("spotfire.rightclick",args,viewId);
}};function TooltipHandler(viewId){var tooltipDelay=500;var tooltipTimer;var hidden=false;this.hide=function(){hidden=true;
if(tooltipTimer){window.clearTimeout(tooltipTimer);}Spotfire.Visuals.Tooltip.hide();};this.show=function(tooltipArgs){hidden=false;
var showWebTooltip=function(){Spotfire.Dxp.Web.Forms.AjaxService.Read(viewId,"GetTooltip",JSON.stringify(tooltipArgs),function(str){if(!hidden){Spotfire.Visuals.Tooltip.show(str);
}});};tooltipTimer=window.setTimeout(showWebTooltip,tooltipDelay);};}var currentCommandId="";var sortMenuItems;
var showSortMenu=function(viewId,x,y,onNewSort){var onSort=function(menuItem){if(currentCommandId!==menuItem.commandId){currentCommandId=menuItem.commandId;
if(onNewSort){onNewSort();}}Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,menuItem.commandId,"");return true;
};var menu=Spotfire.Controls.ContextMenu.create(sortMenuItems,onSort);menu.show(x,y);};function DataPanelImpl(parent,viewId,tableDiv,dataTableDropDownId,columnListBox,relationalTableListBox,filterOverviewId,cubeHierarchyListBox,measureGroupsDiv,dataOverviewState){parent.empty().on("contextmenu",function(e){e.preventDefault();
});var container=$("<div></div>").addClass("DataPanel sfc-data-panel sf-element sf-element-panel-content");
var viewport=$("<div></div>").addClass("Viewport");var tableContainerDiv=$("<div/>").addClass("TableContainerDiv sf-element sf-element-data-panel-header").hide();
var measureGroupsContainerDiv=$("<div/>").addClass("MeasureGroupsContainer").hide();var reloading=false;
var curSelectedTableIndex=-1;tableDiv.appendTo(tableContainerDiv);measureGroupsDiv.appendTo(measureGroupsContainerDiv);
tableContainerDiv.appendTo(viewport);measureGroupsContainerDiv.appendTo(viewport);relationalTableListBox.appendTo(viewport);
columnListBox.appendTo(viewport);cubeHierarchyListBox.appendTo(viewport);container.append(viewport);parent.append(container);
var onKeyDown=function(e){if(e.keyCode===Keys.F1){var args={ctrlKey:e.ctrlKey,shiftKey:e.shiftKey,altKey:e.altKey,keyCode:e.keyCode};
Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,"KeyDown",JSON.stringify(args));}};Spotfire.Focus.handleKeyDown(container,onKeyDown);
var blockAllListBoxes=function(){if(reloading){columnListBox.block();relationalTableListBox.block();cubeHierarchyListBox.block();
}};var unblockAllListBoxes=function(){reloading=false;columnListBox.unblock();relationalTableListBox.unblock();
cubeHierarchyListBox.unblock();};var modeSelectorOnClick=function(modeSelector){var offset=modeSelector.offset();
if(Spotfire.isProfessional()){var args={x:offset.left,y:offset.top+modeSelector.height(),elementId:"ModeSelector"};
Spotfire.PageBus.publish("spotfire.leftclick",args,viewId);}else{showSortMenu(viewId,offset.left,offset.top+modeSelector.height(),function(){reloading=true;
blockAllListBoxes();});}};var dataOverview=Spotfire.DataOverview.create(parent,viewId,modeSelectorOnClick);
var updateDataOverviewButtonState=function($dataOverviewButton,settings){$dataOverviewButton.toggleClass("sfpc-expanded",settings.visible);
$dataOverviewButton.toggleClass("sfpc-collapsed",!settings.visible);if(settings.visible){$dataOverviewButton.attr("title",Spotfire.Localization.resources.DataOverview_CloseDataOverviewButtonTooltip);
}else{$dataOverviewButton.attr("title",Spotfire.Localization.resources.DataOverview_OpenDataOverviewButtonTooltip);
}};var updateDataOverview=function(settings){var $dataOverviewButton=$(".DataOverviewButton",parent);
updateDataOverviewButtonState($dataOverviewButton,settings);dataOverview.update(settings);};var updateDataOverviewButton=function(enabled,settings){var $dataOverviewButton=$(".DataOverviewButton",parent);
$dataOverviewButton.off();$dataOverviewButton.removeClass("disabled sfpc-disabled").removeAttr("title");
if(enabled){updateDataOverview(settings);$dataOverviewButton.click(function(){Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,"ToggleOverviewVisible","");
});}else{$dataOverviewButton.addClass("disabled sfpc-disabled").attr("title",Spotfire.Localization.resources.DataPanel_DataOverviewDisabledReason);
}};if(dataOverviewState.allowed){var $dataOverviewButton=$("<div/>").addClass("DataOverviewButton sf-element sf-element-button").appendTo(tableContainerDiv);
Spotfire.getSvg("Images/Data/OpenDataOverview.svg",function($svg){var $button=$("<div/>").addClass("OpenDataOverviewButton").appendTo($dataOverviewButton);
$svg.appendTo($button);});Spotfire.getSvg("Images/Data/CloseDataOverview.svg",function($svg){var $button=$("<div/>").addClass("CloseDataOverviewButton").appendTo($dataOverviewButton);
$svg.appendTo($button);});updateDataOverviewButtonState($dataOverviewButton,dataOverviewState.settings);
}var filterOverview;if(filterOverviewId){filterOverview=Spotfire.Filters.FilterOverview.initialize(filterOverviewId,viewport);
}var relationalTableListBoxMargins=new Margins(0,0,0,0);var columnListBoxMargins=new Margins(0,0,0,0);
var cubeHierarchyListBoxMargins=new Margins(0,0,0,0);var minItemCount=2;var visibleRelationalTableItemCount=minItemCount;
var cubeHierarchyItemCount=minItemCount;var visibleColumnItemCount=minItemCount;var filterOverviewHeight=0;
var columnListBoxHeight=0;var hierarchyListBoxHeight=0;var listItemHeight=columnListBox.getPreferredItemHeight();
var columnListGeneration;var setMargins=function(state,visibleListBoxes,remainingHeight){var leftMargin=0;
var listBoxRightMargin=0;var topListBoxMargin=0;var marginBetweenListBoxes=10;var isTopListBox=true;if(state.RelationalTableListBoxState.Visible===true){var relationalTableListBoxTopMargin=topListBoxMargin;
relationalTableListBoxMargins=new Margins(leftMargin,relationalTableListBoxTopMargin,listBoxRightMargin,0);
relationalTableListBox.setMargins(relationalTableListBoxMargins);remainingHeight-=relationalTableListBox.getNonItemHeight();
isTopListBox=false;}if(state.CubeHierarchyListBoxState.Visible===true){var cubeHierarchyListBoxTopMargins=!isTopListBox?marginBetweenListBoxes:topListBoxMargin;
cubeHierarchyListBoxMargins=new Margins(leftMargin,cubeHierarchyListBoxTopMargins,listBoxRightMargin,0);
cubeHierarchyListBox.setMargins(cubeHierarchyListBoxMargins);remainingHeight-=cubeHierarchyListBox.getNonItemHeight();
}else{var columnListBoxTopMargin=!isTopListBox?marginBetweenListBoxes:topListBoxMargin;columnListBoxMargins=new Margins(leftMargin,columnListBoxTopMargin,listBoxRightMargin,0);
columnListBox.setMargins(columnListBoxMargins);remainingHeight-=columnListBox.getNonItemHeight();}return remainingHeight;
};var calculateItemCountAndControlHeights=function(state,visibleListBoxes,remainingHeight){var visibleControlsCount=1;
var areRelationalTableItemsVisible=state.RelationalTableListBoxState.Visible&&!state.RelationalTableListBoxState.Collapsed;
var areCubeHierarchyItemsVisible=state.CubeHierarchyListBoxState.Visible;visibleControlsCount+=areRelationalTableItemsVisible?1:0;
if(areCubeHierarchyItemsVisible===true){visibleControlsCount=1;}var isEnoughSpace=true;if(filterOverview){filterOverviewHeight=filterOverview.getPreferredHeight();
var filterOverviewSpace=remainingHeight/(visibleControlsCount+1);if(filterOverviewHeight>filterOverviewSpace){filterOverviewHeight=filterOverviewSpace;
}remainingHeight-=filterOverviewHeight;}var extraVerticalSpace=0;var listBoxVerticalSpace=remainingHeight/visibleControlsCount;
if(areRelationalTableItemsVisible){var maxVisibleRelationalTableItemCount=Math.floor(listBoxVerticalSpace/listItemHeight);
visibleRelationalTableItemCount=Math.min(maxVisibleRelationalTableItemCount,state.RelationalTableListBoxState.ItemCount);
if(visibleRelationalTableItemCount<minItemCount){visibleRelationalTableItemCount=minItemCount;isEnoughSpace=false;
}extraVerticalSpace+=(listBoxVerticalSpace-(visibleRelationalTableItemCount*listItemHeight));}if(areCubeHierarchyItemsVisible){hierarchyListBoxHeight=listBoxVerticalSpace-measureGroupsDiv.outerHeight(true);
var maxCubeItemCount=Math.floor(hierarchyListBoxHeight/listItemHeight);cubeHierarchyItemCount=Math.min(maxCubeItemCount,state.CubeHierarchyListBoxState.ItemCount);
if(cubeHierarchyItemCount<minItemCount){cubeHierarchyItemCount=minItemCount;isEnoughSpace=false;}}else{var columnItemsSpace=listBoxVerticalSpace+extraVerticalSpace;
columnListBoxHeight=columnItemsSpace;visibleColumnItemCount=Math.ceil(columnItemsSpace/listItemHeight);
if(visibleColumnItemCount<minItemCount){visibleColumnItemCount=minItemCount;isEnoughSpace=false;}}return isEnoughSpace;
};var update=function(resetColumnListBoxScrolling,resetColumnListBoxAnchor,requestId,rebuildState,needsDataOverviewUpdate){var getStateCallback=function(state){if(state.ColumnListGeneration<columnListGeneration){return;
}columnListGeneration=state.ColumnListGeneration;sortMenuItems=state.ModeSelectorState;container.css({width:"100%",height:"100%"});
viewport.css({width:container.width()+"px",height:container.height()+"px"});var visibleListBoxes=1;var istableDropDownVisible=state.TableListBoxState.Items.length>1;
var isRelationalTableListBoxVisible=state.RelationalTableListBoxState.Visible;var isCubeHierarchyListBoxVisible=state.CubeHierarchyListBoxState.Visible;
visibleListBoxes+=isRelationalTableListBoxVisible?1:0;var remainingHeight=container.height();measureGroupsDiv.empty();
if(isCubeHierarchyListBoxVisible===true){visibleListBoxes=1;measureGroupsContainerDiv.show();var measureGroups=state.CubeHierarchyListBoxState.MeasureGroups;
if(measureGroups.length>0){var $measureGroupsContentDiv=$("<div/>").appendTo(measureGroupsDiv);remainingHeight-=measureGroupsContainerDiv.outerHeight(true);
if(measureGroups.length>1){var selectedMeasureGroup=state.CubeHierarchyListBoxState.SelectedMeasureGroup;
if(selectedMeasureGroup===undefined){selectedMeasureGroup=measureGroups[0].value;}var onSelectMeasureGroup=function(selectedValue,selectedIndex){var args={measureGroupName:measureGroups[selectedIndex].text,value:selectedValue,generation:columnListGeneration};
Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,"SelectMeasureGroup",JSON.stringify(args));};measureGroupsDiv.show();
Spotfire.Controls.DropDown.initialize($measureGroupsContentDiv,{values:measureGroups,selectedValue:selectedMeasureGroup,onSelected:onSelectMeasureGroup});
}else{$measureGroupsContentDiv.addClass("SingleLabel sf-element sf-element-text-box").text(measureGroups[0].text).attr("title",measureGroups.text);
measureGroupsDiv.show();}}else{measureGroupsContainerDiv.hide();measureGroupsDiv.hide();}}tableContainerDiv.show();
tableDiv.empty();var $tableContentDiv=$("<div/>").appendTo(tableDiv);tableDiv.show();if(istableDropDownVisible){var dataTables=[];
var selectedTable;$.each(state.TableListBoxState.Items,function(index,value){dataTables.push(value.Text);
if(value.Selected){selectedTable=value.Text;}});var onSelectTable=function(selectedTable,selectedIndex){var args={tableIndex:selectedIndex,tableName:selectedTable};
Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,"SelectTable",JSON.stringify(args));if(curSelectedTableIndex!==selectedIndex){if(curSelectedTableIndex>0){reloading=true;
blockAllListBoxes();}curSelectedTableIndex=selectedIndex;}};Spotfire.Controls.DropDown.initialize($tableContentDiv,{values:dataTables,selectedValue:selectedTable,onSelected:onSelectTable});
}else{$tableContentDiv.addClass("SingleLabel sf-element sf-element-text-box").text(state.TableListBoxState.Items.length===1?state.TableListBoxState.Items[0].Text:Spotfire.Localization.resources.DataPanel_NoVisibleTables).attr("title",state.TableListBoxState.Items.length===1?state.TableListBoxState.Items[0].Text:Spotfire.Localization.resources.DataPanel_NoVisibleTables);
}tableDiv.off("contextmenu.DataPanelTableDiv");tableDiv.on("contextmenu.DataPanelTableDiv",function(e){var args={elementId:dataTableDropDownId,x:e.pageX,y:e.pageY};
onRightClick(viewId,args);});remainingHeight-=tableContainerDiv.outerHeight(true);remainingHeight=setMargins(state,visibleListBoxes,remainingHeight);
calculateItemCountAndControlHeights(state,visibleListBoxes,remainingHeight);var itemsHeight;if(isRelationalTableListBoxVisible){relationalTableListBox.show();
itemsHeight=visibleRelationalTableItemCount*listItemHeight;relationalTableListBox.update(-1,state.RelationalTableListBoxState.ItemCount,visibleRelationalTableItemCount,listItemHeight,itemsHeight,state.RelationalTableListBoxState.Collapsed,state.RelationalTableListBoxState.CollapseText,false,false,requestId);
remainingHeight-=state.RelationalTableListBoxState.Collapsed?0:itemsHeight;}else{relationalTableListBox.hide();
}if(filterOverview){filterOverview.populateFilters(filterOverviewHeight);}if(isCubeHierarchyListBoxVisible){columnListBox.hide();
cubeHierarchyListBox.show();itemsHeight=hierarchyListBoxHeight;cubeHierarchyListBox.update(columnListGeneration,state.CubeHierarchyListBoxState.ItemCount,cubeHierarchyItemCount,listItemHeight,itemsHeight,false,"collaps text",resetColumnListBoxScrolling,resetColumnListBoxAnchor,requestId);
remainingHeight-=itemsHeight;}else{cubeHierarchyListBox.hide();columnListBox.show();itemsHeight=columnListBoxHeight;
measureGroupsDiv.hide();measureGroupsContainerDiv.hide();columnListBox.update(columnListGeneration,state.ColumnListBoxState.ItemCount,visibleColumnItemCount,listItemHeight,itemsHeight,false,undefined,resetColumnListBoxScrolling,resetColumnListBoxAnchor,requestId);
remainingHeight-=itemsHeight;}if(state.Options.AllowDataOverview&&needsDataOverviewUpdate){updateDataOverviewButton(state.Options.DataOverviewEnabled,state.DataOverviewSettings);
}unblockAllListBoxes();};Spotfire.Dxp.Web.Forms.AjaxService.Read(viewId,"GetState",JSON.stringify({rebuildColumnState:rebuildState}),getStateCallback);
};var updateSearchField=function(value){columnListBox.updateSearchField(value);cubeHierarchyListBox.updateSearchField(value);
};var resetListBoxScrolling=function(listBoxId){if(listBoxId===cubeHierarchyListBox.id){cubeHierarchyListBox.resetScrolling();
}};var resetListBoxSelectionAnchor=function(listBoxId){if(listBoxId===cubeHierarchyListBox.id){cubeHierarchyListBox.resetSelectionAnchor();
}};var updateListBoxItems=function(listBoxId,generation,requestId){if(listBoxId===columnListBox.id){columnListBox.updateItems(generation,requestId);
}else{if(listBoxId===cubeHierarchyListBox.id){cubeHierarchyListBox.updateItems(undefined,requestId);}else{if(listBoxId===relationalTableListBox.id){relationalTableListBox.updateItems(undefined,requestId);
}}}};var invokeRightClick=function(x,y){var args={elementId:"invalid",x:x,y:y};onRightClick(viewId,args);
};var forceRightClick=function(point){if(columnListBox.tryInvokeRightClick(point)){return;}invokeRightClick(point.x,point.y);
};viewport.mousedown(function(e){if(e.originalEvent.spMouseDownHandled){return;}if(Spotfire.Touch.rightMouseButtonDown(e)){invokeRightClick(e.clientX,e.clientY);
}});viewport.on("update",function(){update(false,false,undefined,false,false);});this.blockAllListBoxes=function(){reloading=true;
blockAllListBoxes();};this.update=update;this.updateSearchField=updateSearchField;this.updateListBoxItems=updateListBoxItems;
this.resetListBoxScrolling=resetListBoxScrolling;this.resetListBoxSelectionAnchor=resetListBoxSelectionAnchor;
this.forceRightClick=forceRightClick;this.updateDataOverview=updateDataOverview;this.setDataOverviewWidth=dataOverview.setWidth;
this.initTablePlot=dataOverview.initTablePlot;this.refreshTablePlot=dataOverview.refreshTablePlot;this.updateHierarchy=dataOverview.updateHierarchy;
this.updateDataOverviewEditTableLayout=dataOverview.updateEditTableLayout;this.initDataOverviewEditTablePreviewTable=dataOverview.initEditTablePreviewTable;
}var initialize=function(parent,viewId,settings){if(settings===undefined||settings===null){return;}var initialState=settings.state;
if(initialState===undefined||initialState===null){return;}var tooltip=new TooltipHandler(viewId);var tableDiv=$("<div>");
var measureGroupsDiv=$("<div>");var relationalTableListBoxSettings={title:Spotfire.Localization.resources.DataPanelRelationalTableListBoxTitle,searchField:undefined,allowMultiSelect:true,allowDragItem:false,allowListCollapse:true};
var relationalTableListBox=new Spotfire.Controls.ListBox.create(viewId,settings.relationalTableListBoxId,tooltip,relationalTableListBoxSettings,onRightClick);
var onSearchFieldChanged=function(value){parent.data("DataPanel").updateSearchField(value);};var searchField={id:settings.searchTextBoxId,name:"DataPanelSearchColumns",searchText:initialState.SearchExpression,emptyText:Spotfire.Localization.resources.DataPanelEmptySearchText,onChanged:onSearchFieldChanged};
var cubeHierarchyListBoxSettings={title:"",searchField:searchField,allowMultiSelect:true,allowDragItem:true,allowListCollapse:false,filterPopoutId:initialState.FilterPopoutId,showFilters:initialState.Options.ShowFilters,showContextMenus:initialState.Options.ShowContextMenus};
var cubeHierarchyListBox=new Spotfire.Controls.ListBox.create(viewId,settings.cubeListBoxId,tooltip,cubeHierarchyListBoxSettings,onRightClick);
var columnListBoxSettings={title:"",searchField:searchField,allowMultiSelect:true,allowDragItem:initialState.Options.AllowDragDrop,allowListCollapse:false,filterPopoutId:initialState.FilterPopoutId,showFilters:initialState.Options.ShowFilters,addToSelectionOnClick:initialState.Options.AddToSelectionOnClick,showContextMenus:initialState.Options.ShowContextMenus};
var dataOverviewState={allowed:initialState.Options.AllowDataOverview,enabled:initialState.Options.DataOverviewEnabled,settings:initialState.DataOverviewSettings};
var columnListBox=new Spotfire.Controls.ListBox.create(viewId,settings.columnListBoxId,tooltip,columnListBoxSettings,onRightClick);
sortMenuItems=initialState.ModeSelectorState;tableDiv.hide();measureGroupsDiv.hide();relationalTableListBox.hide();
columnListBox.hide();var dataPanel=new DataPanelImpl(parent,viewId,tableDiv,settings.dataTableDropDownId,columnListBox,relationalTableListBox,initialState.FilterId,cubeHierarchyListBox,measureGroupsDiv,dataOverviewState);
parent.data("DataPanel",dataPanel);dataPanel.update(false,false,undefined,true,true);};Spotfire.DataPanel.initialize=function(parent,dataPanelViewId){var viewId;
if(dataPanelViewId===undefined){viewId=Spotfire.DataPanel.viewId;if(parent.attr("id")!==undefined){defaultParentId=parent.attr("id");
}else{defaultParentId="dataPanel"+(new Date()).getTime();parent.attr("id",defaultParentId);}}else{viewId=dataPanelViewId;
}$("[viewId="+viewId+"]").removeAttr("viewId");parent.addClass("DataPanel");parent.attr("viewId",viewId);
parent.empty();var update=function(settings){initialize(parent,viewId,settings);};var invalidate=function(){var control=parent.data("DataPanel");
if(control){control.update(false,false,undefined,true,true);}};parent.bind("panelResize",invalidate);
Spotfire.Dxp.Web.Forms.AjaxService.Read(viewId,"GetPanel","",update);};var getDataPanel=function(parentId){if(parentId){return $("#"+parentId).data("DataPanel");
}if(defaultParentId){return $("#"+defaultParentId).data("DataPanel");}return null;};Spotfire.DataPanel.triggerSearch=function(commandId,viewId,parentId){var dataPanel=getDataPanel(parentId);
if(dataPanel){dataPanel.blockAllListBoxes();}Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,commandId,"");
};Spotfire.DataPanel.update=function(resetColumnListBoxScrolling,resetColumnListBoxAnchor,requestId,rebuildColumnState,parentId){var dataPanel=getDataPanel(parentId);
if(dataPanel){dataPanel.update(resetColumnListBoxScrolling,resetColumnListBoxAnchor,requestId,rebuildColumnState,true);
}};Spotfire.DataPanel.updateSearchField=function(value,parentId){var dataPanel=getDataPanel(parentId);
if(dataPanel){dataPanel.updateSearchField(value);}};Spotfire.DataPanel.updateListBoxItems=function(listBoxId,generation,requestId,parentId){var dataPanel=getDataPanel(parentId);
if(dataPanel){dataPanel.updateListBoxItems(listBoxId,generation,requestId);}};Spotfire.DataPanel.resetListBoxScrolling=function(listBoxId,parentId){var dataPanel=getDataPanel(parentId);
if(dataPanel){dataPanel.resetListBoxScrolling(listBoxId);}};Spotfire.DataPanel.resetListBoxSelectionAnchor=function(listBoxId,parentId){var dataPanel=getDataPanel(parentId);
if(dataPanel){dataPanel.resetListBoxSelectionAnchor(listBoxId);}};Spotfire.DataPanel.forceRightClick=function(point,parentId){var dataPanel=getDataPanel(parentId);
if(dataPanel){dataPanel.forceRightClick(point);}};Spotfire.DataPanel.initTablePlot=function(tablePlotHtml,parentId){var dataPanel=getDataPanel(parentId);
if(dataPanel){dataPanel.initTablePlot(tablePlotHtml);}};Spotfire.DataPanel.refreshTablePlot=function(parentId){var dataPanel=getDataPanel(parentId);
if(dataPanel){dataPanel.refreshTablePlot();}};Spotfire.DataPanel.updateDataOverview=function(settings,parentId){var dataPanel=getDataPanel(parentId);
if(dataPanel){dataPanel.updateDataOverview(settings);}else{$(".sf-element-data-overview").remove();}};
Spotfire.DataPanel.setDataOverviewWidth=function(width,parentId){var dataPanel=getDataPanel(parentId);
if(dataPanel){dataPanel.setDataOverviewWidth(width);}};Spotfire.DataPanel.updateHierarchy=function(newSettings,parentId){var dataPanel=getDataPanel(parentId);
if(dataPanel){dataPanel.updateHierarchy(newSettings.clientGeneration);}};Spotfire.DataPanel.updateDataOverviewEditTableLayout=function(settings,parentId){var dataPanel=getDataPanel(parentId);
if(dataPanel){dataPanel.updateDataOverviewEditTableLayout(settings);}};Spotfire.DataPanel.initDataOverviewEditTablePreviewTable=function(id,html,parentId){var dataPanel=getDataPanel(parentId);
if(dataPanel){dataPanel.initDataOverviewEditTablePreviewTable(id,html);}};});$(function(){function DataRecommendationsPromptControl(){var settings;
var handlers;var currentEditControlViewId;var $scrollableContainer;var scrollbar;var createRecommendationBoxContainer=function($parent){return Spotfire.Flex.item({container:"horizontal","align-items":"center",grow:true}).addClass("sf-element-data-recommendations-recommendation-box").appendTo($parent);
};var createIcon=function($container,url,size,containerClassName,onClick){var $iconContainer=Spotfire.Flex.item({container:"vertical",shrink:false,"align-items":"center"}).addClass(containerClassName).appendTo($container);
var $iconDiv=Spotfire.Flex.item({}).addClass("sf-element-data-recommendations-recommendation-icon").appendTo($iconContainer);
Spotfire.getSvg(url,function($svg){$svg.appendTo($iconDiv);});$iconDiv.css({width:size+"px",height:size+"px"});
if(onClick!==undefined){$iconDiv.on("sf-touchmousedown",onClick);}};var createRecommendationName=function($container,name){return Spotfire.Flex.item({shrink:false}).addClass("sf-datarecommendations-recommendation-name").text(name).appendTo($container);
};var createRecommendationOutputName=function($container,outputName){return Spotfire.Flex.item({grow:true}).addClass("sf-datarecommendations-output-name").text(outputName).attr("title",outputName).appendTo($container);
};var createAddRowsRecommendations=function(recommendations,$container,selectRecommendation,onEdit){createIcon($container,"Images/Data/EditTable/AddRows32x32.svg",32,"sf-datarecommendations-type-icon-container");
createRecommendationName($container,Spotfire.Localization.resources.DataRecommendationsAddRows);var numRecommendations=recommendations.length;
var currentRecommendationIndex=recommendations[0].recommendationIndex;if(recommendations.length===1){createRecommendationOutputName($container,recommendations[0].outputName);
}else{var $dropdown=Spotfire.Flex.item({grow:true}).appendTo($container);var recommendationNames=[];var dropDownRecommendationIndexToActualRecommendationIndex=[];
var i;for(i=0;i<numRecommendations;++i){recommendationNames.push(recommendations[i].outputName);dropDownRecommendationIndexToActualRecommendationIndex[i]=recommendations[i].recommendationIndex;
}Spotfire.Controls.DropDown.initialize($dropdown,{onSelected:function(value,index){currentRecommendationIndex=dropDownRecommendationIndexToActualRecommendationIndex[index];
selectRecommendation(currentRecommendationIndex);},values:recommendationNames,useIndexAsValueId:true,selectedIndex:0});
}Spotfire.Flex.item({shrink:false}).addClass("sf-element-data-recommendations-preview-text").text(Spotfire.Localization.resources.DataRecommendationsPreviewEdit).on("sf-touchmousedown",onEdit).appendTo($container);
return $container;};var createAddTableRecommendation=function(recommendation,$container){createIcon($container,"Images/Data/EditTable/DataTable32x32.svg",32,"sf-datarecommendations-type-icon-container");
createRecommendationName($container,Spotfire.Localization.resources.DataRecommendationsAddDataTable);
return $container;};var onResize=function($mainContainer){$scrollableContainer.css("width",$mainContainer.width()).css("height",$mainContainer.height());
scrollbar.refresh();};var init=function($container,newSettings,prompt){settings=newSettings;handlers={modify:function(method,args){args.editControlViewId=currentEditControlViewId;
prompt.modify(method,JSON.stringify(args));},read:function(method,args,callback){args.editControlViewId=currentEditControlViewId;
prompt.read(method,JSON.stringify(args),function(result){if(result.editControlViewId!==currentEditControlViewId){return;
}callback(result);});},onOk:function(){prompt.modify("okSettings",JSON.stringify({}));},onCancel:function(){prompt.modify("cancelSettings",JSON.stringify({}));
},onOkRecommendations:function(selectedRecommendations){prompt.modify("okRecommendations",JSON.stringify(selectedRecommendations));
prompt.confirm();},onCancelRecommendations:function(){prompt.cancel();}};$container.addClass("sf-element-data-recommendations");
$scrollableContainer=$("<div/>").addClass("sf-datarecommendations-gridview-scrollablecontainer").appendTo($container);
var $scrollableContent=$("<div/>").appendTo($scrollableContainer);$("<div/>").addClass("sf-datarecommendations-main-description").text(Spotfire.Localization.resources.DataRecommendationsMainDescription).appendTo($scrollableContent);
settings.inputs.forEach(function(input){var $input=$("<div/>").addClass("sf-datarecommendations-input-box").appendTo($scrollableContent);
var $inputNameContainer=Spotfire.Flex.item({container:"horizontal","align-items":"center"}).addClass("sf-datarecommendations-input-container").appendTo($input);
Spotfire.Flex.item().addClass("sf-datarecommendations-input-name").text(input.name).attr("title",input.name).appendTo($inputNameContainer);
var recommendationTypeToRecommendation={};input.recommendations.forEach(function(recommendation){if(!recommendationTypeToRecommendation.hasOwnProperty(recommendation.type)){recommendationTypeToRecommendation[recommendation.type]=[];
}recommendationTypeToRecommendation[recommendation.type].push(recommendation);});var createRecommendations=function(recommendationType,recommendations){var selected=false;
recommendations.forEach(function(r){if(settings.inputToSelectedRecommendation[input.inputIndex]===r.recommendationIndex){selected=true;
}});var $recommendationContainer=Spotfire.Flex.item({container:"horizontal","align-items":"center"}).addClass("sf-datarecommendations-recommendation").appendTo($input);
var $radioButtonContainer=Spotfire.Flex.item({shrink:false}).appendTo($recommendationContainer);var $radioButton=$("<input/>").attr({type:"radio",name:"inputrecommendations"+input.inputIndex,id:"inputrecommendations"+input.inputIndex+" "+recommendationType,checked:selected}).appendTo($radioButtonContainer);
Spotfire.Filters.StyledFilters.createStyledInput($radioButton,13,13);var currentRecommendationIndexForType=recommendations[0].recommendationIndex;
var $box=createRecommendationBoxContainer($recommendationContainer);var selectRecommendation=function(){$(".sf-element-data-recommendations-recommendation-box",$input).removeClass("sfpc-selected");
$radioButton.prop("checked",true);$box.addClass("sfpc-selected");settings.inputToSelectedRecommendation[input.inputIndex]=currentRecommendationIndexForType;
};if(selected){selectRecommendation();}$box.on("sf-touchmousedown",selectRecommendation);$radioButton.on("change",selectRecommendation);
var onRecommendationIndexChanged=function(newRecommendationIndex){currentRecommendationIndexForType=newRecommendationIndex;
selectRecommendation();};var onEdit=function(){selectRecommendation();ProgressBlocker.block($container,{showProgress:false});
handlers.modify("editRecommendation",{inputIndex:input.inputIndex,recommendationIndex:currentRecommendationIndexForType});
};if(recommendationType==="Rows"){createAddRowsRecommendations(recommendations,$box,onRecommendationIndexChanged,onEdit);
}else{if(recommendationType==="Table"){createAddTableRecommendation(recommendations[0],$box);}}};var recommendationType;
for(recommendationType in recommendationTypeToRecommendation){if(recommendationTypeToRecommendation.hasOwnProperty(recommendationType)){createRecommendations(recommendationType,recommendationTypeToRecommendation[recommendationType]);
}}});scrollbar=$scrollableContainer.StyledScrollbar();onResize($container);};var handleButtonClick=function(action){switch(action){case"OK":handlers.onOkRecommendations({selectedRecommendations:settings.inputToSelectedRecommendation});
break;case"Cancel":handlers.onCancelRecommendations();break;}};var showEditRecommendationDialog=function(editSettings){currentEditControlViewId=editSettings.editControlViewId;
if(editSettings.type==="Rows"){Spotfire.Controls.AddRowsPromptControl.showDialog(editSettings.viewId,editSettings,handlers);
}else{Spotfire.Controls.AddTablePromptControl.showDialog(editSettings.viewId,editSettings,handlers);}};
this.init=init;this.handleButtonClick=handleButtonClick;this.showEditRecommendationDialog=showEditRecommendationDialog;
this.onResize=onResize;}Spotfire.registerNameSpace("Controls.DataRecommendationsPromptControl",{handleButtonClick:function(viewId,action){var $view=$("#"+viewId);
if($view.length>0){var promptControl=$view.data("promptControl");promptControl.handleButtonClick(action);
}},initializePromptControl:function(viewId,settings){var promptControl=new DataRecommendationsPromptControl();
var prompt=Spotfire.Prompt.create(viewId);var $view=$("#"+viewId);$view.css("overflow","hidden");var buttons=[{text:Spotfire.Localization.resources.Ok,isDefault:true,actionName:"OK"},{text:Spotfire.Localization.resources.Cancel,isCancel:true,actionName:"Cancel"}];
prompt.setButtons(buttons,"Spotfire.Controls.DataRecommendationsPromptControl.handleButtonClick");$view.data("promptControl",promptControl);
prompt.setEnableSelection(false);$view.on("sf-resize",function(e){if($view.is(e.target)){promptControl.onResize($view);
}});promptControl.init($view,settings,prompt);if(settings.willAddAdditionalTables){var modalDialog=$view.closest(".promptingPopup");
if(modalDialog){var $footerContainer=Spotfire.Flex.item({container:"horizontal","align-items":"center"}).addClass("sf-datarecommendations-footer-container");
Spotfire.getSvg("Images/Data/Info28x28.svg",function($svg){$svg.addClass("sf-datarecommendations-footer-icon").appendTo($footerContainer);
Spotfire.Flex.item({}).addClass("sf-datarecommendations-footer-text sf-element-modal-dialog-footer-text").text(Spotfire.Localization.resources.DataRecommendationsUnmatchedData).attr("title",Spotfire.Localization.resources.DataRecommendationsUnmatchedData).appendTo($footerContainer);
Spotfire.Controls.ModalDialog.update(modalDialog,"extraFooterContent",$footerContainer);});}}},showEditRecommendationDialog:function(viewId,editSettings){var $view=$("#"+viewId);
if($view.length>0){var promptControl=$view.data("promptControl");ProgressBlocker.unblock($view);promptControl.showEditRecommendationDialog(editSettings);
}}});});$(function(){function Tray($parent,canChange,onChange,selectorBox,onClickCallback){var $container=$("<div/>").addClass("sf-element sf-element-axis-tray Tray");
if(!canChange){$container.addClass("sfpc-disabled");}var $trayItem=$("<div/>");var $labelDiv=$("<div/>");
var $colorDiv=$("<div/>");var itemBox;if(selectorBox){$container.addClass(selectorBox.classes);itemBox=selectorBox.children[0];
$trayItem.addClass(itemBox.classes);$trayItem.addClass("sf-nowrap");$labelDiv.addClass(itemBox.text.classes);
if(itemBox.icon){$colorDiv.addClass(itemBox.icon.classes);$colorDiv.addClass("sf-nowrap");$colorDiv.height(itemBox.icon.size.height);
$colorDiv.width(itemBox.icon.size.width);}}else{$trayItem.addClass("sf-element sf-element-axis-tray-item sf-nowrap");
$labelDiv.addClass("sf-element sf-element-text-box");$colorDiv.addClass("sf-nowrap TrayItemColor");}if(canChange){$trayItem.addClass("itemEditable");
}$container.append($trayItem);$trayItem.append($colorDiv).append($labelDiv);$parent.append($container);
var menuItems=[];var getContentWidth=function(w){return Math.max(0,w-(canChange?45:20));};var sizeBy=function(maxWidth){$labelDiv.css("max-width",getContentWidth(maxWidth)+"px");
};var setText=function(str,color,borderColor){$container.off("mouseover");$container.off("mouseout");
Spotfire.Visuals.Tooltip.addToolTip($container,Spotfire.htmlEncode(str));if(color){$colorDiv.css({"background-color":color,"border-color":borderColor,display:""});
}else{$colorDiv.css({display:"none"});}$labelDiv.text(str);};if(canChange){$trayItem.click(function(e){e.stopPropagation();
if(typeof onClickCallback==="function"){onClickCallback();return;}if(menuItems.length<1){menuItems=[{text:Spotfire.Localization.resources.DataTableTray_NoItemsText,enabled:false}];
}var onMenuItemClick=function(item){var val=item.text;setText(val,item.color,item.bordercolor);onChange(val);
return true;};var menu=Spotfire.Controls.ContextMenu.create(menuItems,onMenuItemClick);var offset=$trayItem.offset();
menu.show(offset.left,offset.top+$trayItem.outerHeight(false));});var $trayButton=$("<div/>");if(itemBox){$trayButton.addClass(itemBox.button.classes);
}else{$trayButton.addClass("sf-element sf-element-button");}Spotfire.getSvg("Images/AxisTrayControl/DownArrow.svg",function($svg){$svg.css({"vertical-align":"middle",width:"7px",height:"4px"});
$trayButton.append($svg);});$trayItem.append($trayButton);}sizeBy(getContentWidth($parent.width()));var trayControl={sizeBy:sizeBy,container:$container.get(0),setText:setText,setItems:function(items){menuItems=items;
}};$container.data("trayControl",trayControl);return trayControl;}Spotfire.registerNameSpace("Data.DataTableTray");
Spotfire.registerNameSpace("Data.MarkingTray");Spotfire.Data.MarkingTray.create=function(parentNode,settings,onChange,onClickCallback){var canChange=settings.canChange;
var tray=new Tray($(parentNode),canChange,onChange,settings.box,onClickCallback);$(tray.container).addClass("MarkingTray");
tray.update=function(s){var items=s.items;var text=s.text;var color=s.color;var borderColor=s.bordercolor;
tray.setText(text,color,borderColor);tray.setItems(items);};tray.update(settings);return tray;};Spotfire.Data.DataTableTray.create=function(parentNode,settings,onChange,onClickCallback){var canChange=settings.canChange;
var tray=new Tray($(parentNode),canChange,onChange,settings.box,onClickCallback);$(tray.container).addClass("DataTableTray");
tray.update=function(s){var items=s.items;var text=s.text;tray.setText(text);tray.setItems(items);};tray.update(settings);
return tray;};});$(function(){var proxy=null;var initialize=function(args){if(proxy!==null){throw"Already initialized";
}proxy=Spotfire.WebSocket.createProxy();var onWebSocketOpen=function(){Spotfire.WebAnalysis.initialize(args.params,proxy);
Spotfire.DragDrop.initializeWindowsIntegration(args.viewId);Spotfire.Visuals.CanvasVisualization.initializeWebSocket(proxy);
};var onWebSocketError=function(errorMsg){var $error=$("<div/>").text(errorMsg).css({position:"relative","margin-top":"5em",padding:"2em","text-align":"center","white-space":"pre","font-size":"1.5em"});
$(document.body).empty().append($error);};proxy.initialize(args.webSocketUri,onWebSocketOpen,onWebSocketError);
};Spotfire.registerNameSpace("DocumentWebView",{initialize:initialize});});$(function(){var $currentStyledDialog=null;
var $currentDropTargetArea=null;var $currentDropTargetDescription=null;var $currentOverlayDiv=null;var cleanUpFunctions=[];
var currentTransparentColor="#AAAAAA";var debugEnabled=false;var debugLog=function(message,$div){if(debugEnabled){var extra=$div===undefined||$div===null?"":" "+$div.attr("id")+", "+$div.attr("class");
Spotfire.log(message+extra);}};var removeDraggable=function($div){$div.attr("draggable",false);$div.off("dragstart dragend selectstart");
};var removeDroppable=function($div){$div.off("dragenter dragover dragend");};var removeCurrentDropTargetArea=function(){var $dropAreas=$(".sfc-drop-area");
debugLog("removeCurrentDropTargetArea called "+($currentDropTargetArea!==null)+"  sfc-drop-area: "+$dropAreas.length);
if($currentDropTargetArea!==null){debugLog("removing current drop target area");$currentDropTargetArea.remove();
$currentDropTargetArea=null;}if($currentDropTargetDescription!==null){debugLog("removing current drop target description");
$currentDropTargetDescription.remove();$currentDropTargetDescription=null;}if($currentStyledDialog!==null){$currentStyledDialog.remove();
$currentStyledDialog=null;}};var restoreTransparentDiv=function(){debugLog("restoreTransparentDiv called");
var $transparentDivs=$(".swiss-cheese-hole-filler");$transparentDivs.css("background-color",currentTransparentColor).css("background-image","");
if($currentOverlayDiv!==null){debugLog("Removing overlay div");$currentOverlayDiv.sfRemoveAsync();$currentOverlayDiv=null;
}};var addProperties=function(e){if(e.pageX===undefined){if(e.originalEvent.pageX!==undefined){e.pageX=e.originalEvent.pageX;
}}if(e.pageY===undefined){if(e.originalEvent.pageY!==undefined){e.pageY=e.originalEvent.pageY;}}if(e.originalEvent.getModifierState!==undefined){e.modifierKeys={shift:e.originalEvent.getModifierState("Shift"),control:e.originalEvent.getModifierState("Control")};
}else{e.modifierKeys={shift:e.originalEvent.shiftKey,control:e.originalEvent.ctrlKey};}return e;};var isIe=window.ActiveXObject||window.hasOwnProperty("ActiveXObject");
var currentDragData=null;var isInternalDrag;var globalOverlayVisible=false;var isCleanUpRequired=function(){return cleanUpFunctions.length>0;
};var requireCleanUp=function(){if(cleanUpFunctions.length===0){cleanUpFunctions.push($.noop);}};var cleanUp=function(){restoreTransparentDiv();
removeCurrentDropTargetArea();_.each(cleanUpFunctions,function(f){f();});cleanUpFunctions=[];};$(document.body).on("mousemove",function(){isInternalDrag=false;
if(Spotfire.ClientDragDrop.useDragImageWorkaround()){Spotfire.ClientDragDrop.clearDragImage();}if(isCleanUpRequired()){debugLog("Drag and drop cleanup code run from mouse move");
cleanUp();}});var $draggedElement=null;var $hiddenPagesElement=null;var handlePageChange=function(){if($draggedElement&&!$hiddenPagesElement){var $pagesElement=$(".PagesWebControl");
$pagesElement.hide();$pagesElement.removeAttr("id");$pagesElement.find("*").removeAttr("id");$hiddenPagesElement=$pagesElement;
return;}};var makeDraggable=function($div,settings){var draggingWithLeftMouseButton=false;$div.attr("draggable",true);
$div.on("mousedown",function(e){draggingWithLeftMouseButton=e.which===1;});$div.on("dragstart",function(e){if(!draggingWithLeftMouseButton){e.preventDefault();
return;}debugLog("dragStart",$div);if($div.attr("draggable")==="false"){return;}isInternalDrag=true;if(settings.abortOnModifierKeys&&(e.shiftKey||e.ctrlKey||e.metaKey)){e.preventDefault();
return;}var data={};var dragItemCount=1;if(settings.populateData){dragItemCount=settings.populateData(data);
dragItemCount=dragItemCount||1;}var effect="all";if(settings.effectAllowed){effect=settings.effectAllowed;
}var dataTransfer=e.originalEvent.dataTransfer;dataTransfer.effectAllowed=effect;var json=JSON.stringify(data);
dataTransfer.setData(isIe?"Text":"text/plain",json);if(Spotfire.ClientDragDrop.useDragImageWorkaround()){var $dummy=$("<span/>").appendTo($(document.body));
dataTransfer.setDragImage($dummy[0],0,0);$dummy.remove();Spotfire.ClientDragDrop.setDragImage(e.target,dragItemCount);
}else{if(dragItemCount>1){var $indicator=Spotfire.ClientDragDrop.createItemCountIndicator(dragItemCount);
var $target=$(e.target);$target.append($indicator);$indicator.sfRemoveAsync();}if(dataTransfer.setDragImage){var $scrollArea=$(e.target).find(".ScrollArea:visible").filter(function(){return $(this).height()>10000;
});$scrollArea.hide();dataTransfer.setDragImage(e.target,-10,-10);_.defer(function(){$scrollArea.show();
});}}currentDragData=data;$draggedElement=$div;if(settings.dragInProgressClass){$(".sf-element-document").addClass(settings.dragInProgressClass);
}});$div.on("dragend",function(){debugLog("dragend",$div);if(settings.dragEnd){settings.dragEnd();}currentDragData=null;
$draggedElement=null;if($hiddenPagesElement){$hiddenPagesElement.remove();$hiddenPagesElement=null;}if(Spotfire.ClientDragDrop.useDragImageWorkaround()){Spotfire.ClientDragDrop.clearDragImage();
}isInternalDrag=false;cleanUp();if(settings.dragInProgressClass){$(".sf-element-document").removeClass(settings.dragInProgressClass);
}});};var getSpotfireTransferData=function(dataTransfer){if(!dataTransfer){return null;}if(dataTransfer.files&&dataTransfer.files.length>0){debugLog("getSpotfireTransferData Dragging files: "+dataTransfer.files[0].name);
return null;}var text=null;try{text=dataTransfer.getData("text/plain");}catch(ex1){try{text=dataTransfer.getData("Text");
}catch(ignore){}}try{return JSON.parse(text);}catch(ignore){}return currentDragData;};var getSpotfireTransferDataFromEvent=function(event){var data=getSpotfireTransferData(event.originalEvent.dataTransfer);
return data!==null?data:{};};var makeDroppable=function($item,settings){debugLog("makeDroppable on",$item);
$item.on("dragenter",function(e){var handled;debugLog("dragenter",$item);$item.addClass("sfpc-dragover");
if(settings.onDragEnter){handled=settings.onDragEnter(addProperties(e));}if(handled!==false){e.preventDefault();
}});$item.on("dragleave",function(e){var handled;debugLog("dragleave",$item);$item.removeClass("sfpc-dragover");
if(settings.onDragLeave){handled=settings.onDragLeave(addProperties(e));}if(handled!==false){e.preventDefault();
}});$item.on("dragover",function(e){var handled;if(settings.onDragOver){handled=settings.onDragOver(addProperties(e),getSpotfireTransferDataFromEvent(e));
}if(handled!==false){e.preventDefault();}});$item.on("drop",function(e){debugLog("drop",$item);$item.removeClass("sfpc-dragover");
var handled;if(settings.onDrop){var data=getSpotfireTransferDataFromEvent(e);addProperties(e);data.modifierKeys=e.modifierKeys;
handled=settings.onDrop(e,data);}if(handled!==false){e.preventDefault();}cleanUp();});};var makeDroppableWithOverlay=function($item,supportsData,createHandler,global,customOverlaySize){debugLog("makeDroppableWithOverlay on",$item);
var $overlay=null;$item.on("dragenter",function(e,triggerEvent){debugLog("makeDroppableWithOverlay - dragenter.");
e=triggerEvent||e;var data=getSpotfireTransferData(e.originalEvent.dataTransfer);if(data===undefined||data===null){return;
}if(typeof supportsData==="function"&&!supportsData(data)){return;}if(isIe&&e.preventDefault){e.preventDefault();
}if($overlay){debugLog("makeDroppableWithOverlay - already showing.");return;}debugLog("makeDroppableWithOverlay - create new overlay.");
var width=customOverlaySize===undefined?"100%":customOverlaySize.width;var height=customOverlaySize===undefined?"100%":customOverlaySize.height;
$overlay=$("<div/>").css({position:"absolute",top:"0",left:"0",width:width,height:height});var $indicatorDiv=$("<div/>");
$overlay.append($indicatorDiv);cleanUpFunctions.push(function(){debugLog("makeDroppableWithOverlay - cleanup.");
$overlay.hide();$overlay.sfRemoveAsync(function(){debugLog("makeDroppableWithOverlay - removed overlay.");
});$overlay=null;});var resetGlobal=function(){if(global===true){globalOverlayVisible=false;}};var $dropArea=$("<div/>").css({"background-color":"gray",position:"absolute",top:"0",left:"0",width:"100%",height:"100%",opacity:"0.001"});
$overlay.append($dropArea);var handler=createHandler(addProperties(e),data,$indicatorDiv);$dropArea.on("dragenter",function(ev){debugLog("makeDroppableWithOverlay - dropArea.dragenter");
if(handler.onDragEnter){handler.onDragEnter(addProperties(ev),data);}ev.stopPropagation();});$dropArea.on("dragleave",function(ev){debugLog("makeDroppableWithOverlay - dropArea.dragLeave.");
if(handler.onDragLeave){handler.onDragLeave(addProperties(ev));}resetGlobal();cleanUp();});$dropArea.on("dragover",function(ev){if(handler.onDragOver){handler.onDragOver(addProperties(ev),data);
}ev.preventDefault();});$dropArea.on("drop",function(ev){debugLog("makeDroppableWithOverlay - dropArea.drop.");
if(handler.onDrop){addProperties(ev);data.modifierKeys=e.modifierKeys;handler.onDrop(ev,data);}ev.preventDefault();
resetGlobal();cleanUp();});globalOverlayVisible=global===true;requireCleanUp();$item.append($overlay);
});};var makeScrollableByDrag=function($item){var scrollDiff;var timeout=null;$item.off("dragover.dragdropScroll").on("dragover.dragdropScroll",function(e){addProperties(e);
var offset=$item.offset();var height=$item.outerHeight();var pointerPositionInItem=e.pageY-offset.top;
var scrollUpBreakpoint=height/4;var scrollDownBreakpoint=scrollUpBreakpoint*3;var scrolling=false;if(pointerPositionInItem<scrollUpBreakpoint){scrollDiff=Math.floor(-10*(1-(pointerPositionInItem/scrollUpBreakpoint)));
scrolling=true;}else{if(pointerPositionInItem>scrollDownBreakpoint){scrollDiff=Math.ceil(10*((pointerPositionInItem-scrollDownBreakpoint)/scrollUpBreakpoint));
scrolling=true;}}if(scrolling&&!timeout){timeout=setTimeout(function(){$item.scrollTop($item.scrollTop()+scrollDiff);
timeout=null;},16);}});};var moveIntoViewportVertically=function($el){var verticalMargin=30;var winHeight=$(window).height();
if($el.offset().top+$el.height()>=winHeight){$el.css("top",winHeight-$el.height()-verticalMargin);}if($el.offset().top<0){$el.css("top",verticalMargin);
}};var moveIntoViewportHorizontally=function($el){var horizontalMargin=10;var winWidth=$(window).width();
if($el.offset().left+$el.width()>=winWidth){$el.css("left",winWidth-$el.width()-horizontalMargin);}if($el.offset().left<0){$el.css("left",horizontalMargin);
}};var moveIntoViewport=function($el){moveIntoViewportHorizontally($el);moveIntoViewportVertically($el);
};var showDropTargetArea=function(selector,webViewId,areaSettings){var $body=$(document.body);var $div=$(selector);
if($div.length===0){debugLog("**** showDropTargetArea: no div selected by "+selector);return;}debugLog("showDropTargetArea",$div);
var $styledDialog=$("<div/>").addClass("sf-element sf-element-styled-dialog");var $area=$("<div/>").addClass(" sf-element sf-element-drop-area").css({width:areaSettings.size.width+"px",height:areaSettings.size.height+"px",position:"absolute"});
var $currentDescribedTarget=null;var updateDescription=function($described,text){$currentDescribedTarget=$described;
if($currentDropTargetDescription===null){$currentDropTargetDescription=$("<div/>").addClass("sf-element sf-element-drop-area sfc-drop-target-description").css({position:"absolute",visibility:"hidden"});
$styledDialog.append($currentDropTargetDescription);}$currentDropTargetDescription.text(text);var targetCenterX=$described.offset().left+($described.outerWidth()/2);
var targetTop=$area.offset().top;$currentDropTargetDescription.css({top:targetTop-$currentDropTargetDescription.outerHeight(true),left:targetCenterX-($currentDropTargetDescription.outerWidth(true)/2),visibility:"visible"});
moveIntoViewportHorizontally($currentDropTargetDescription);};var hideDescription=function(){if($currentDropTargetDescription!==null){$currentDropTargetDescription.css({visibility:"hidden"});
}};$.each(areaSettings.verticalElements,function(elemIndex,elem){var $elem=$("<div/>").css({width:elem.bounds.width+"px",height:elem.bounds.height+"px",top:elem.bounds.y+"px",left:elem.bounds.x+"px",position:"absolute"});
$area.append($elem);if(elem.isSeparator){$elem.addClass("sf-element sf-element-separator");return;}$.each(elem.rows,function(rowIndex,row){$.each(row.targets,function(targetIndex,target){var $target=$("<div/>").addClass("sf-element sf-element-drop-target").css({width:target.bounds.width+"px",height:target.bounds.height+"px",top:target.bounds.y+"px",left:target.bounds.x+"px",position:"absolute","background-image":"url("+target.imagePath+")","background-repeat":"no-repeat","background-position":"center"});
$area.append($target);if(!target.enabled){$target.css("opacity","0.25");return;}makeDroppable($target,{onDrop:function(e,data){var args={data:data,targetId:target.id};
if(data.tag){args.webViewId=webViewId;Spotfire.PageBus.publish("spotfire.visuals.droptag",args);}else{Spotfire.Dxp.Web.Forms.AjaxService.Modify(webViewId,"OnDrop",JSON.stringify(args));
}cleanUp();},onDragEnter:function(){updateDescription($target,target.description);},onDragLeave:function(){if($target===$currentDescribedTarget){hideDescription();
}}});});});});var outerWidth=$area.outerWidth(true);var outerHeight=$area.outerHeight(true);var top=$div.offset().top+($div.height()/2)-(outerHeight/2);
var left=$div.offset().left+($div.width()/2)-(outerWidth/2);$area.css({top:top+"px",left:left+"px"});
if($currentDropTargetArea!==null){debugLog("Assigning $currentDropTargetArea (pre assignment removal of $currentDropTargetArea)");
$currentDropTargetArea.remove();}if($currentStyledDialog!==null){$currentStyledDialog.remove();}debugLog("Assigning $currentDropTargetArea "+($currentDropTargetArea!==null));
$currentDropTargetArea=$area;$styledDialog.append($currentDropTargetArea);$currentStyledDialog=$styledDialog;
$body.append($currentStyledDialog);moveIntoViewport($area);};var onDragEnterInDroppableWithTargetArea=function(selector,img,transparentColor){debugLog("onDragEnterInDroppableWithTargetArea "+selector);
var $div=$(selector);$div.css("background-image",img);$div.addClass("swiss-cheese-hole-filler");currentTransparentColor=transparentColor;
requireCleanUp();};var getDropTargetAreaSettingsReadCount=0;var initializeDroppableWithTargetArea=function(selector,webViewId){var dropTargetAreaInitialized=false;
var $div=$(selector);makeDroppable($div,{onDragEnter:function(e){var data=getSpotfireTransferData(e.originalEvent.dataTransfer);
if(data===undefined||data===null||(!data.columnNames&&!data.tag)){return false;}e.stopPropagation();var count=getDropTargetAreaSettingsReadCount++;
if(dropTargetAreaInitialized){debugLog("onDragEnter dropTargetAreaInitialized aborting",$div);return false;
}var callback=function(settings){debugLog("Callback for Read GetDropTargetAreaSettings ("+count+") for ",$div);
if(!dropTargetAreaInitialized){return;}showDropTargetArea(selector,webViewId,settings);};debugLog("Performing Read GetDropTargetAreaSettings ("+count+") for ",$div);
Spotfire.Dxp.Web.Forms.AjaxService.Read(webViewId,"GetDropTargetAreaSettings",JSON.stringify(currentDragData),callback);
dropTargetAreaInitialized=true;cleanUpFunctions.push(function(){dropTargetAreaInitialized=false;});return true;
},onDragLeave:function(e){if(!dropTargetAreaInitialized){if(!globalOverlayVisible){cleanUp();}return;
}debugLog("onDragLeave",$div);if($currentDropTargetArea!==null){var tolerance=5;var top=$currentDropTargetArea.offset().top-tolerance;
var left=$currentDropTargetArea.offset().left-tolerance;var right=left+$currentDropTargetArea.sfBoxWidth()+(2*tolerance);
var bottom=top+$currentDropTargetArea.sfBoxHeight()+(2*tolerance);debugLog("**** left="+left+" e.pageX="+e.pageX+" right="+right+" top="+top+" e.pageY="+e.pageY+" bottom="+bottom+" ");
if(left<=e.pageX&&e.pageX<=right&&top<=e.pageY&&e.pageY<=bottom){debugLog("Assuming leave is when entering the drop target area.");
e.stopPropagation();return;}}debugLog("Assuming leave is when leaving the overlay. Cleaning up.");cleanUp();
},onDragOver:function(){return false;},onDrop:function(){if(!dropTargetAreaInitialized){return false;
}debugLog("onDrop",$div);cleanUp();return true;}});};var initializeDroppableWebPlotWithTargetArea=function(selector,webViewId){debugLog("initializeDroppableWebPlotWithTargetArea "+selector);
var $div=$(selector);debugLog("Found "+$div.length);makeDroppable($div,{onDragEnter:function(){debugLog("initializeDroppableWebPlotWithTargetArea.onDragEnter "+selector);
var id=$div.attr("id")+"overlay";if($currentOverlayDiv){if($currentOverlayDiv.prop("id")===id){return;
}$currentOverlayDiv.sfRemoveAsync();}var $overlay=$("<div/>").css({position:"absolute",top:"0",left:"0",width:$div.sfBoxWidth()+"px",height:$div.sfBoxHeight()+"px",opacity:0.001,"background-color":"gray"});
$overlay.attr("id",id);$overlay.addClass("sf-drop-area-overlay");$currentOverlayDiv=$overlay;$div.append($overlay);
requireCleanUp();initializeDroppableWithTargetArea("#"+id,webViewId,currentTransparentColor);},onDragOver:function(){return false;
},onDrop:function(){cleanUp();}});};var initializeWindowsIntegration=function(viewId){var pendingRequest=false;
var lastDragEnter=0;var handledByForms=false;Spotfire.DragDrop.dropFormsClosed=function(deferedToBrowser){debugLog("BrowserDragDropHandle forms closed, drag should be handled by browser = "+deferedToBrowser);
handledByForms=deferedToBrowser;if(!handledByForms){cleanUp();}};$(document.body).on("dragenter",function(){if(isInternalDrag){debugLog("initializeWindowsIntegration.dragenter - Windows does not handle internal drag.");
return;}var now=Date.now();var upToDate=now-lastDragEnter<500;lastDragEnter=now;if(handledByForms&&upToDate){debugLog("initializeWindowsIntegration.dragenter - drag should be handled by browser and drag data should be up to date.");
return;}if(pendingRequest){debugLog("initializeWindowsIntegration.dragenter - handleDragEnter request pending");
return;}pendingRequest=true;handledByForms=false;Spotfire.Dxp.Web.Forms.AjaxService.Read(viewId,"HandleDragEnter","",function(){debugLog("initializeWindowsIntegration.dragenter - handleDragEnter read done");
pendingRequest=false;});});};var handleWindowsDragData=function(args){currentDragData=args;};var populateBookmarkData=function(data,webControlId,attachmentId){if(!Spotfire.isProfessional()){return;
}var href=window.location.href;var attachmentUri=href.substr(0,href.indexOf("?")+1)+"attachment="+attachmentId;
Ajax.enqueueRequest(webControlId,"CreateAttachment",attachmentId);data.documentId=Ajax.DocumentId;data.bookmarkUri=attachmentUri;
};var isExternalBookmark=function(data){if(!data){return false;}if(data.bookmarkUri){return data.documentId!==Ajax.DocumentId;
}return false;};Spotfire.registerNameSpace("DragDrop",{makeDraggable:makeDraggable,makeDroppable:makeDroppable,makeDroppableWithOverlay:makeDroppableWithOverlay,initializeDroppableWithTargetArea:initializeDroppableWithTargetArea,initializeDroppableWebPlotWithTargetArea:initializeDroppableWebPlotWithTargetArea,onDragEnterInDroppableWithTargetArea:onDragEnterInDroppableWithTargetArea,removeDraggable:removeDraggable,removeDroppable:removeDroppable,makeScrollableByDrag:makeScrollableByDrag,getSpotfireTransferData:getSpotfireTransferData,initializeWindowsIntegration:initializeWindowsIntegration,handleWindowsDragData:handleWindowsDragData,populateBookmarkData:populateBookmarkData,isExternalBookmark:isExternalBookmark,dropFormsClosed:$.noop,handlePageChange:handlePageChange});
});$(function(){Spotfire.registerNameSpace("DragDropFiles");var uploadInProgress=false;var webViewId;
var timer;var filesToUpload=[];var dataTables=[];var $dropZoneBackground;var $dropZoneContent;var settings;
function reset(){uploadInProgress=false;filesToUpload=[];dataTables=[];$(".DragDropFiles-dropzone__label",$dropZoneContent).text(Spotfire.Localization.resources.DragDropFiles_DropFileToAddDataTable);
}function cancel(){reset();Spotfire.LightBox.hide();}function done(){Spotfire.Dxp.Web.Forms.AjaxService.Modify(webViewId,"AddDataFromFile",JSON.stringify(dataTables[0]));
}function showDropBackground(){$(document.body).trigger("close.contextMenu");$(document.body).off(".contextMenu");
Spotfire.MultipleViews.SetFocus();Spotfire.LightBox.show(null,null,true);$dropZoneBackground.removeClass("DragDropFiles-dropzone-close");
$dropZoneContent.removeClass("DragDropFiles-dropzone-close");$dropZoneBackground.removeClass("DragDropFiles-dropzone-fade");
$dropZoneContent.removeClass("DragDropFiles-dropzone-fade");$dropZoneBackground.appendTo(document.body);
$dropZoneContent.appendTo(document.body);}var uploadIdCounter=0;function createUploadIds(num){var ids=[],i;
for(i=0;i<num;i++){ids.push(Ajax.DocumentViewId+"-"+uploadIdCounter++);}return ids;}function startUploads(numUploads,dataTableToWorkOn,dataDestination){var uploadIds=createUploadIds(numUploads);
var error=false,uploadId=uploadIds[0];function uploadError(){error=true;}function uploadComplete(e){var status,uploadSucceded=false;
dataTables.push({FileUploadId:uploadId,TargetTableId:dataTableToWorkOn,DataDestination:dataDestination});
$dropZoneBackground.addClass("DragDropFiles-dropzone-close");$dropZoneContent.addClass("DragDropFiles-dropzone-close");
var contentType=e.getResponseHeader("content-type")||"";if(contentType.indexOf("html")>-1){status=e.responseText.replace(/(\r|\n|\r\n)/mg,"");
uploadSucceded=(status.indexOf("UPLOAD OK")>-1);}else{if(contentType.indexOf("json")>-1){status=JSON.parse(e.responseText);
uploadSucceded=(status.result===0);}}window.setTimeout(function(){$dropZoneBackground.detach();$dropZoneContent.detach();
if(uploadSucceded&&!error){done();}else{Spotfire.Framework.ErrorDialog.show(Spotfire.Localization.resources.AddDataFromFile_ErrorDialogTitle,{Message:Spotfire.Localization.resources.AddDataFromFile_UploadFailed,Details:null},cancel);
}},500);}function progress(e){var percentage=(Math.floor(e.loaded/e.total*100))+"%";if(!$dropZoneContent.is(":visible")){showDropBackground();
}$(".DragDropFiles-dropzone__label",$dropZoneContent).text(percentage);}var file=filesToUpload[0];var formData=new FormData();
formData.append("file",file,file.name);$.ajax({type:"POST",url:"Upload.aspx?waid="+Ajax.DocumentId+"&uploadId="+uploadId,data:formData,contentType:false,processData:false,error:uploadError,complete:uploadComplete,dataType:"html",xhr:function(){var xhr=$.ajaxSettings.xhr();
xhr.upload.addEventListener("progress",progress,false);return xhr;}});}function getExtension(fileName){var pathIndex=fileName.lastIndexOf("\\");
var tableName=(pathIndex>-1)?fileName.substring(pathIndex+1):fileName;var extensionIndex=tableName.lastIndexOf(".");
var extension=extensionIndex>-1?$.trim(tableName.substring(extensionIndex+1)):"";return extension;}function validateFile(file){var result={Result:false,Message:"",Details:null};
var found=false,i;var extension=getExtension(file.name);for(i=0;i<settings.Extensions.length;i++){if(settings.Extensions[i].toUpperCase()===extension.toUpperCase()){found=true;
break;}}if(!found){result.Message=Spotfire.Localization.resources.DragDropFiles_ExtensionNotSupported;
return result;}if(file.size===0){result.Message=Spotfire.Localization.resources.DragDropFiles_FileIsEmpty;
return result;}if(file.size>settings.MaxFileSize*Math.pow(10,6)){result.Message=Spotfire.Utilities.formatString(Spotfire.Localization.resources.DragDropFiles_FileIsTooBig,settings.MaxFileSize);
return result;}result.Result=true;return result;}function addFile(file){var validationResult=validateFile(file);
if(validationResult.Result===true){filesToUpload.push(file);}return validationResult;}function init(id,uploadFileSettings){settings=uploadFileSettings;
webViewId=id;$dropZoneBackground=$("<div/>").addClass("DragDropFiles-dropzone");$dropZoneContent=$("<div/>").html("<svg viewBox='0 0 50 50' enable-background='new 0 0 50 50' xml:space='preserve' class='DragDropFiles-dropzone__icon'><path fill='currentColor' d='M5,0v12v38h3h34h3V12V0H5z M42,47H8v-7h34V47z M42,37H8v-6h34V37z M42,28H8v-6h34V28z M42,19H8v-7h34V19z' /></svg><span class='DragDropFiles-dropzone__label'>"+Spotfire.Localization.resources.DragDropFiles_DropFileToAddDataTable+"</span>").addClass("DragDropFiles-dropzone__content");
function validDragEvent(event){var i;var modalBlockerVisible=$("#remoteModalBlocker").is(":visible");
var dialogIsShown=$(".ui-dialog").length>0;if(event.dataTransfer.types&&uploadInProgress===false&&!dialogIsShown&&!modalBlockerVisible){for(i=0;
i<event.dataTransfer.types.length;i++){if(event.dataTransfer.types[i]==="Files"){return true;}}}return false;
}function dragOver(event){event.preventDefault();if(validDragEvent(event)){if(timer){window.clearTimeout(timer);
timer=null;}var showDrop;try{showDrop=event.dataTransfer.types.indexOf("Files")>=0;}catch(ex1){showDrop=event.dataTransfer.types.contains("application/x-moz-file")||event.dataTransfer.types.contains("Files");
}if(!uploadInProgress){showDrop=showDrop&&!$dropZoneBackground.is(":visible");if(showDrop){showDropBackground(true);
}}}}function dragLeave(event){event.preventDefault();timer=window.setTimeout(function(){$dropZoneBackground.addClass("DragDropFiles-dropzone-fade");
$dropZoneContent.addClass("DragDropFiles-dropzone-fade");window.setTimeout(function(){$dropZoneBackground.detach();
$dropZoneContent.detach();if(!uploadInProgress){Spotfire.LightBox.hide();}},200);},100);return false;
}function drop(event){event.preventDefault();if(validDragEvent(event)){uploadInProgress=true;var validationResult=validateFile(event.dataTransfer.files[0]);
if(validationResult.Result===true){filesToUpload.push(event.dataTransfer.files[0]);}else{$dropZoneBackground.detach();
$dropZoneContent.detach();Spotfire.Framework.ErrorDialog.show(Spotfire.Localization.resources.AddDataFromFile_ErrorDialogTitle,validationResult,cancel);
return false;}if(filesToUpload.length>0){startUploads(filesToUpload.length,null,Spotfire.Data.DataDestination.AddData);
}}return false;}document.documentElement.ondragover=dragOver;document.documentElement.ondragleave=dragLeave;
document.documentElement.ondrop=drop;}Spotfire.DragDropFiles.reset=reset;Spotfire.DragDropFiles.startUploads=startUploads;
Spotfire.DragDropFiles.init=init;Spotfire.DragDropFiles.addFile=addFile;});$(function(){Spotfire.registerNameSpace("PageLayout");
Spotfire.PageLayout.DropZoneIndicator=function($parent){var rectangle={};var duration=100;var allowTransparency=Spotfire.capabilities.supportsDropShadow();
var foregroundColor=$(".sf-element-document").css("color");var updateBorderBased=function(bounds){var $dropZoneDiv=$parent.find(".dropZoneIndicator");
if(!bounds){$dropZoneDiv.remove();rectangle={};return;}bounds=new Rectangle(bounds);if(bounds.equals(rectangle)){return;
}rectangle=bounds;var borderWidth=2;if($dropZoneDiv.length===0){$dropZoneDiv=$("<div>").css({"border-style":"solid","border-width":borderWidth,"border-color":foregroundColor,position:"absolute",display:"none","pointer-events":"none"}).addClass("dropZoneIndicator").appendTo($parent);
}d3.select($dropZoneDiv.get(0)).transition().duration(duration).style("top",rectangle.y+"px").style("left",rectangle.x+"px").style("width",rectangle.width-2*borderWidth+"px").style("height",rectangle.height-2*borderWidth+"px").style("display","block");
};var updateTransparent=function(bounds){var parent=d3.select($parent.get(0));var dropZoneDiv=parent.select(".dropZoneIndicator");
if(!bounds){dropZoneDiv.transition().duration(duration).style("opacity",0.01).remove();rectangle={};return;
}bounds=new Rectangle(bounds);if(bounds.equals(rectangle)){return;}rectangle=bounds;if(dropZoneDiv.size()===0){d3.select($("<div>").css({"background-color":foregroundColor,position:"absolute",display:"block",opacity:"0.001",top:rectangle.y+"px",left:rectangle.x+"px",width:rectangle.width+"px",height:rectangle.height+"px","pointer-events":"none"}).addClass("dropZoneIndicator").appendTo(parent).get(0)).transition().duration(duration).style("opacity",0.2);
}else{dropZoneDiv.transition().duration(duration).style("top",rectangle.y+"px").style("left",rectangle.x+"px").style("width",rectangle.width+"px").style("height",rectangle.height+"px").style("opacity",0.2);
}};if(allowTransparency){return{update:updateTransparent,close:function(){updateTransparent();}};}return{update:updateBorderBased,close:function(){updateBorderBased();
}};};});$(function(){var showEditDialog=function(data,callback,texts,hasAdd,hasColor){var scrollContainer,addRow,updateVisibilityDeleteButtons;
var content=$("<div/>").addClass("sf-edit-dialog");var dialogHeight=350;var dialogWidth=350;var tableActions=function(items){var actions=[];
var itemsChangedEvent=jQuery.Event("actionItemsChangedEvent");var getAction=function(originalName,actionType){var i,action;
for(i=0;i<actions.length;i++){action=actions[i];if(action.originalName===originalName&&(actionType===undefined||action.action===actionType)){return action;
}}return null;};var removeActions=function(originalName){var i;for(i=actions.length-1;i>=0;i--){if(actions[i].originalName===originalName){actions.splice(i,1);
}}};var getOriginalAndAddedNames=function(){var names=[];var i,j;for(i=0;i<items.length;i++){names.push(items[i].name);
}for(j=0;j<actions.length;j++){if(actions[j].action==="add"){names.push(actions[j].originalName);}}return names;
};var getCurrentNames=function(){var names=[];var originalName,action;var i,del;for(i=0;i<items.length;
i++){originalName=items[i].name;del=getAction(originalName,"delete");if(del){continue;}action=getAction(originalName,"rename");
if(action){names.push(action.newName);}else{names.push(originalName);}}var j;for(j=0;j<actions.length;
j++){if(actions[j].action==="add"){originalName=actions[j].originalName;action=getAction(originalName,"rename");
if(action){names.push(action.newName);}else{names.push(originalName);}}}return names;};return{getActions:function(){return actions;
},rename:function(originalName,newName){var currentNames=getCurrentNames();var uniqueName=Spotfire.Data.NameString.createUniqueName(newName,currentNames);
var isValid=Spotfire.Data.NameString.isNameValid(uniqueName,currentNames);if(isValid){var action=getAction(originalName,"rename");
if(action){action.newName=uniqueName;}else{action={action:"rename",originalName:originalName,newName:uniqueName};
actions.push(action);}content.trigger(itemsChangedEvent);}return isValid?uniqueName:null;},newItem:function(){var originalItemNames=getOriginalAndAddedNames();
var uniqueName=Spotfire.Data.NameString.createUniqueName("tempMarking"+new Date().getTime(),originalItemNames);
var isValid=Spotfire.Data.NameString.isNameValid(uniqueName,originalItemNames);if(isValid){var action={action:"add",originalName:uniqueName};
actions.push(action);var newName=this.rename(uniqueName,texts.NewItemName);return{org:uniqueName,newName:newName};
}return null;},changeColor:function(originalName,newColor){var action=getAction(originalName,"changeColor");
if(action){action.newColor=newColor;}else{action={action:"changeColor",originalName:originalName,newColor:newColor};
actions.push(action);}content.trigger(itemsChangedEvent);},remove:function(originalName){var added=getAction(originalName,"add");
removeActions(originalName);if(!added){var action={action:"delete",originalName:originalName,newName:originalName};
actions.push(action);}content.trigger(itemsChangedEvent);},findColor:function(){var usedColors={};var i;
for(i=0;i<Spotfire.Colors.MarkingColorPalette.length;i++){usedColors[Spotfire.Colors.MarkingColorPalette[i].color]=0;
}var fromHex=function(color){return"rgb("+parseInt(color.substring(1,3),16)+","+parseInt(color.substring(3,5),16)+","+parseInt(color.substring(5),16)+")";
};var itemToColor={};var j;for(j=0;j<items.length;j++){itemToColor[items[j].name]=items[j].color;}for(j=0;
j<actions.length;j++){if(actions[j].action==="add"){itemToColor[actions[j].originalName]="#000000";}else{if(actions[j].action==="delete"){delete itemToColor[actions[j].originalName];
}else{if(actions[j].action==="changeColor"){itemToColor[actions[j].originalName]=actions[j].newColor;
}}}}var prop,color;for(prop in itemToColor){if(itemToColor.hasOwnProperty(prop)){color=fromHex(itemToColor[prop]);
if(color in usedColors){usedColors[color]=usedColors[color]+1;}}}var minCount=-1;var firstMinColor=null;
var k,currentColor,currentColorCount;for(k=0;k<Spotfire.Colors.MarkingColorPalette.length;k++){currentColor=Spotfire.Colors.MarkingColorPalette[k].color;
currentColorCount=usedColors[currentColor];if(minCount===-1||currentColorCount<minCount){minCount=currentColorCount;
firstMinColor=currentColor;}}if(firstMinColor===null){return null;}var first=firstMinColor.indexOf(",");
var second=firstMinColor.indexOf(",",first+1);var r=parseInt(firstMinColor.substring(4,first),10);var g=parseInt(firstMinColor.substring(first+1,second),10);
var b=parseInt(firstMinColor.substring(second+1,firstMinColor.length-1),10);return{r:r,g:g,b:b,toRgb:function(){return"rgb("+r+","+g+","+b+")";
},toHex:function(){return"#"+(r>15?"":"0")+r.toString(16)+(g>15?"":"0")+g.toString(16)+(b>15?"":"0")+b.toString(16);
}};}};}(data.items);var outerpadding=12;var innerpadding=5;var borderwidth=1;var label=$("<div></div>").addClass("EditDialogHeader");
label.text(texts.ListBoxLabel+":");var addButton=null;if(hasAdd){addButton=$("<div/>").addClass("EditDialogAddButton whiteButton").attr("title",texts.NewItemTooltip);
var add=function(){var name=tableActions.newItem();if(name!==null){var row={name:name.org,displayName:name.newName};
if(hasColor){var color=tableActions.findColor();tableActions.changeColor(name.org,color.toHex());row.color=color.toRgb();
row.bordercolor="rgb("+Math.round(color.r*3/4)+","+Math.round(color.g*3/4)+","+Math.round(color.b*3/4)+")";
}scrollContainer.append(addRow(row));updateVisibilityDeleteButtons();}};addButton.click(add);}var listBox=$("<div></div").addClass("EditDialogListBox");
listBox.css("overflow","auto");var createButton=function(text){var button=$("<span />");button.attr("title",text);
button.addClass("EditDialogButton");return button;};addRow=function(item){var nameItem,editButton;var startEdit=function(){var name=nameItem.text();
if(!name){return;}nameItem.text("");var input=$("<input type='text'/>").addClass("EditDialogEditName");
input.css("width",(editButton.position().left-30)+"px");input.css("font-size",nameItem.css("font-size"));
input.val(name);var endEdit=function(cancel){var newName=input.val();var originalName=nameItem.attr("name");
input.remove();if(newName!==name&&!cancel){newName=tableActions.rename(originalName,newName);}if(newName===null||cancel){newName=name;
}nameItem.text(newName);};input.blur(function(){endEdit();});input.keydown(function(e){if(e.which===13||e.which===9){endEdit();
}else{if(e.which===27){endEdit(true);e.stopPropagation();}}});nameItem.append(input);input.focus();};
var row=$("<div />");row.addClass("EditDialogRow");if(item.color){var colorItem=$("<div/>").addClass("colorSquare").css({"background-color":item.color,"border-color":item.bordercolor}).data("color",item.color).click(function(){var colorInfo={palette:Spotfire.Colors.MarkingColorPalette,current:colorItem.data("color"),top:3,width:120};
Spotfire.Picker.show(colorInfo,colorItem,"ColorPicker",function(result){var newColor=result.toRgb();var borderColor={r:Math.round(newColor.r*3/4),g:Math.round(newColor.g*3/4),b:Math.round(newColor.b*3/4)};
var rgbString=result.toRgbString();colorItem.data("color",rgbString);colorItem.css({"background-color":rgbString,"border-color":"rgb("+borderColor.r+","+borderColor.g+","+borderColor.b+")"});
tableActions.changeColor(item.name,result.toHexString(false));});});row.append(colorItem);}nameItem=$("<span />").addClass("EditDialogNameItem");
nameItem.text(item.displayName?item.displayName:item.name);nameItem.attr("name",item.name);nameItem.click(startEdit);
row.append(nameItem);var deleteButton=createButton(Spotfire.Localization.resources.EditMarkingsDialog_DeleteTooltip);
deleteButton.addClass("EditDialogDeleteButton");deleteButton.click(function(){var originalName=nameItem.attr("name");
tableActions.remove(originalName);row.remove();updateVisibilityDeleteButtons();});row.append(deleteButton);
editButton=createButton(Spotfire.Localization.resources.EditMarkingsDialog_EditTooltip);editButton.addClass("EditDialogEditButton");
editButton.click(startEdit);row.append(editButton);return row;};scrollContainer=$("<div></div>");listBox.append(scrollContainer);
$.each(data.items,function(index,item){scrollContainer.append(addRow(item));});updateVisibilityDeleteButtons=function(){var $deleteButtons=$(".EditDialogDeleteButton",listBox);
if($deleteButtons.length>1){$deleteButtons.show();}else{$deleteButtons.hide();}};updateVisibilityDeleteButtons();
content.append(label);if(hasAdd){content.append(addButton);}content.append(listBox);var onOkClicked=function(){var actions=tableActions.getActions();
if(actions.length>0){var args={actions:actions};Ajax.enqueueRequest(data.id,callback,JSON.stringify(args));
}};content.css("overflow","hidden");content.bind("actionItemsChangedEvent",function(){$("#EditDialogOkButton").prop("disabled",tableActions.getActions().length===0);
$("#EditDialogOkButton").toggleClass("sfpc-disabled",tableActions.getActions().length===0);});Spotfire.Controls.ModalDialog.initialize(content,{title:texts.DialogTitle,modal:true,width:dialogWidth,height:dialogHeight,minHeight:250,resizable:true,buttons:[{id:"EditDialogOkButton",text:Spotfire.Localization.resources.Ok,isDefault:true,click:onOkClicked,disabled:true},{text:Spotfire.Localization.resources.Cancel,isCancel:true}]});
};Spotfire.registerNameSpace("EditMarkingsDialog");Spotfire.EditMarkingsDialog.show=function(data){showEditDialog(data,"EditMarkings",{DialogTitle:Spotfire.Localization.resources.EditMarkingsDialog_DialogTitle,ListBoxLabel:Spotfire.Localization.resources.EditMarkingsDialog_ListBoxLabel,NewItemName:Spotfire.Localization.resources.EditMarkingsDialog_NewMarkingName,NewItemTooltip:Spotfire.Localization.resources.EditMarkingsDialog_NewItemTooltip},true,true);
};});$(function(){Spotfire.registerNameSpace("EmptyPage");Spotfire.EmptyPage.hide=function(id){var $page=$("#"+id);
var $content=$page.children(".sf-element-empty-page");if($content.length!==0){$content.remove();}};var getSvgImage=function($parent){return{parent:$parent,width:$parent.innerWidth(),height:$parent.innerHeight(),viewBox:"0 0 218 218",elements:[{type:"path",path:"M109,0C48.8,0,0,48.8,0,109s48.8,109,109,109s109-48.8,109-109S169.2,0,109,0z M114,43h9v14h-9V43z M103,32   h9v25h-9V32z M93,41h8v16h-8V41z M88,28h1.6v30.5H128V60H88V28z M45.9,98c5,0,9.6,1.9,13,5l-13.8,12.3H27 C27.2,105.4,35.6,98,45.9,98z M60.2,104.1c2.9,3.2,4.8,7.6,4.8,12.2c0,4.9-2.2,9.5-5.4,12.8l-12.9-12.7L60.2,104.1z M27,117.3l18,0   l13.1,13.4c-3.3,2.7-7.6,4.4-12.2,4.4C35.9,135,27.6,126.9,27,117.3z M63.8,162.8L52,172l9.3-11.7L73,151L63.8,162.8z M61.2,67.8 L52,56l11.7,9.3L73,77L61.2,67.8z M115.3,154h-12.5v-4.1h12.5V154z M119.4,145.6H98.5v-4.1h20.9V145.6z M127.3,115.6   c-6.2,10.2-8.2,8.1-8.6,21.4H99.3c-0.4-13.3-2.4-11.1-8.6-21.4c-3.4-4.6-4.7-11.4-4.7-14.6c-0.4-17.6,15.9-20.9,22.6-21.1h0.8 c6.6,0.2,22.9,3.4,22.6,21.1C132,104.2,130.7,111,127.3,115.6z M157.3,65.3L169,56l-9.2,11.8L148,77L157.3,65.3z M167.1,100.1v34   h-13.7v-34C153.3,100.1,167.1,100.1,167.1,100.1z M159.5,163.8L149,152l13.4,9.3L173,173L159.5,163.8z M187.5,134.1h-18.9v-9h18.9   V134.1z M168.5,123.2v-23h19v23H168.5z",fill:"currentColor"},{type:"path",path:"M65,116.4c0-4.6-2-9-4.8-12.2l-13.4,12.3l12.9,12.7 C62.8,125.9,65,121.2,65,116.4z",fill:"currentColor",opacity:0.3},{type:"path",path:"M45.1,117.3l-18,0c0.6,9.6,8.8,17.7,18.9,17.7 c4.7,0,9-1.7,12.2-4.4L45.1,117.3z",fill:"currentColor",opacity:0.8},{type:"rect",fill:"currentColor",opacity:0.8,x:168.6,y:125.1,rectWidth:19,rectHeight:9},{type:"rect",fill:"currentColor",opacity:0.3,x:103,y:32,rectWidth:9,rectHeight:25},{type:"rect",fill:"currentColor",opacity:0.8,x:114,y:43,rectWidth:9,rectHeight:14},{type:"rect",fill:"currentColor",opacity:0.3,x:168.5,y:100.2,rectWidth:19,rectHeight:23}]};
};Spotfire.EmptyPage.show=function(id){var $page=$("#"+id);var $content=$page.children(".sf-element-empty-page");
if($content.length!==0){return;}var onClick=function(){Ajax.enqueueRequest(id,"ShowRecommendationsDialog",JSON.stringify({}));
return false;};$content=$("<div />").addClass("sf-element-empty-page").appendTo($page);var $buttonWrapper=$("<div />").addClass("sf-element-empty-page-button-wrapper").appendTo($content);
var $image=$("<div />").addClass("sf-element-empty-page-image clickable").appendTo($buttonWrapper);var $suggestButton=$("<button />").attr("type","button").addClass("sf-element-empty-page-button clickable").html(Spotfire.Localization.resources.Recommendations_EmptyPageButtonText).appendTo($buttonWrapper);
Spotfire.Filters.StyledFilters.createStyledElement(getSvgImage($image));$suggestButton.css("left",-$suggestButton.outerWidth()/2+"px");
if(Spotfire.capabilities.supportsTouch()){$content.on("click touchstart",".clickable",onClick);}else{$content.on("click",".clickable",onClick);
}};});$(function(){Spotfire.registerNameSpace("ExportResult");Spotfire.ExportResult.open=function(url){if(!Spotfire.capabilities.supportsTouch()){var $iframe=$("<iframe/>").attr("src",url).hide();
$(document.body).append($iframe);}else{window.location.assign(url);}};});$(function(){Spotfire.registerNameSpace("Flex");
var item=function(options){return $("<div/>").sfFlex(options);};var sfFlex=function(options){var $item=this;
$item.addClass("flex-item");options=options||{};if(options["align-items"]===undefined){options["align-items"]="start";
}var handledOptions={};var addClass=function(option,value,className){if(options[option]===value){handledOptions[option]=value;
$item.addClass(className);}};addClass("container","horizontal","flex-container-horizontal");addClass("container","vertical","flex-container-vertical");
addClass("inline",true,"flex-inline-container");addClass("grow",true,"flex-grow");addClass("shrink",false,"flex-no-shrink");
addClass("justify-content","center","flex-justify-center");addClass("justify-content","start","flex-justify-start");
addClass("justify-content","end","flex-justify-end");addClass("justify-content","space-between","flex-justify-space-between");
addClass("align-items","center","flex-align-center");addClass("align-items","start","flex-align-start");
addClass("align-items","end","flex-align-end");addClass("align-items","stretch","flex-align-stretch");
addClass("wrap",true,"flex-wrap");addClass("auto-basis",false,"flex-no-auto-basis");var isHorizontal=options.container==="horizontal";
var isVertical=options.container==="vertical";if(options.fill!==undefined){if(isHorizontal){addClass("fill",true,"flex-fill-horizontal");
}else{if(isVertical){addClass("fill",true,"flex-fill-vertical");}else{throw"Spotfire.Flex.item was called with 'fill':true for a non-container.";
}}}var key;for(key in options){if(options.hasOwnProperty(key)&&!handledOptions.hasOwnProperty(key)){throw"Spotfire.Flex.item was called with an unrecognised option ("+key+", "+options[key]+")";
}}return $item;};$.fn.extend({sfFlex:sfFlex});Spotfire.Flex.item=item;});$(function(){var $popup=$("<div/>").addClass("sf-element-info-popup");
$(document.body).on("mousedown",function(e){if($(e.target).closest($popup).length===0){$popup.remove();
}});Spotfire.registerNameSpace("FloatingWindow",{showAt:function(html,x,y){var $parent=$(".sf-element-document");
$popup.html(html);var performLayout=function(){var offset=$parent.offset();var parentWidth=$parent.width();
var parentHeight=$parent.height();var left=x-offset.left;var top=y-offset.top;$popup.css("left",left+"px").css("top",top+"px");
var popupRight=$popup.outerWidth()+left;var popupBottom=$popup.outerHeight()+top;var extraPadding=5;var overflowX=popupRight-(parentWidth-extraPadding);
var overflowY=popupBottom-(parentHeight-extraPadding);if(overflowX>0){$popup.css("left",Math.max(0,left-overflowX)+"px");
}if(overflowY>0){$popup.css("top",Math.max(0,top-overflowY)+"px");}};if($popup.closest($parent).length===0){$popup.appendTo($parent);
}$popup.on("sf-layout-popup",performLayout);return $popup;},performLayout:function($popup){$popup.trigger("sf-layout-popup");
},hide:function(){$popup.remove();}});});$(function(){var $currentFocus;var setFocus=function(target){var $target=$(target);
if($target.is("input, select, textarea")){$currentFocus=null;return;}$currentFocus=$target.closest(".sf-focusable");
};var enableFocus=function(selector){return $(selector).css("outline","none").addClass("sf-focusable").attr("tabindex",0);
};$(document.body).on("mousedown",function(e){setFocus(e.target);});$(document.body).on("keydown keypress keyup",function(e){if($currentFocus&&$currentFocus.length){var cb=$currentFocus.data(e.type);
if(typeof cb==="function"){cb.call($currentFocus[0],e);}}});Spotfire.registerNameSpace("Focus",{handleContextMenu:function(selector){enableFocus(selector);
},handleKeyDown:function(selector,onKeyDown){return enableFocus(selector).data("keydown",onKeyDown);},handleKeyPress:function(selector,onKeyDown){return enableFocus(selector).data("keypress",onKeyDown);
},handleKeyUp:function(selector,onKeyUp){return enableFocus(selector).data("keyup",onKeyUp);},setFocus:function($target){setFocus($target);
},blur:function(){if(document.activeElement&&document.activeElement.blur){document.activeElement.blur();
}}});});$(function(){function FormattingControl($container,id){var initUpdateTime;var lastTime=0;var changeTimer;
var settings;var margin=40;var invalidate;var addDecimals=function($parent,includeAuto){$parent.append($("<div/>").text(Spotfire.Localization.resources.FormattingControl_Decimals).addClass("Header"));
var items=[];var selectedIndex=0;var i,text,item;for(i=includeAuto?0:1;i<=16;i++){text=i===0?Spotfire.Localization.resources.FormattingControl_Auto:i-1;
item={text:text,index:i};if(i===settings.decimals){selectedIndex=includeAuto?i:i-1;}items.push(item);
}var $dropDown=$("<div/>").appendTo($parent);Spotfire.Controls.DropDown.initialize($dropDown,{onSelected:function(selectedValue,selectedIndex){Ajax.enqueueRequest(id,"setDecimal",items[selectedIndex].index);
invalidate();},values:items,useIndexAsValueId:true,selectedIndex:selectedIndex,width:75});};var addNegativeNumbers=function($parent){$parent.append($("<div/>").text(Spotfire.Localization.resources.FormattingControl_NegativeNumbers).addClass("Header"));
var items=[];var selectedIndex=0;var i,text,item;for(i=0;settings.Negative&&i<settings.Negative.length;
i++){text=settings.Negative[i];item={text:text,index:i};if(i===settings.selectedNegativeIndex){selectedIndex=i;
}items.push(item);}var $dropDown=$("<div/>").appendTo($parent);Spotfire.Controls.DropDown.initialize($dropDown,{onSelected:function(selectedValue,selectedIndex){Ajax.enqueueRequest(id,"setNegative",items[selectedIndex].index);
invalidate();},values:items,useIndexAsValueId:true,selectedIndex:selectedIndex,width:150});};var addCurrency=function($parent){$parent.append($("<div/>").text(Spotfire.Localization.resources.FormattingControl_Currency).addClass("Header"));
var selectedIndex=0;var i;for(i=0;i<settings.currencies.length;++i){if(settings.currencies[i].text===settings.selectedCurrency.text){selectedIndex=i;
}}var $dropDown=$("<div/>").appendTo($parent);Spotfire.Controls.DropDown.initialize($dropDown,{onSelected:function(selectedValue,selectedIndex){var item=settings.currencies[selectedIndex];
Ajax.enqueueRequest(id,"setCurrency",item.value);invalidate();},values:settings.currencies,useIndexAsValueId:true,selectedIndex:selectedIndex,fixedListWidth:true,useCombobox:true});
};var addThousandsSep=function($parent){var $checkbox=$("<input />").attr("type","checkbox").attr("id","cbThousandsSep").addClass("sf-element-input").appendTo($parent).change(function(){Ajax.enqueueRequest(id,"thousandsSeparator",$checkbox.prop("checked")?"true":"false");
invalidate();});var $label=$("<label/>").attr("id","thousandsSep").attr("for","cbThousandsSep").appendTo($parent);
if(settings.thousandsSep){$checkbox.attr("checked","checked");}$label.append(document.createTextNode(Spotfire.Localization.resources.FormattingControl_ThousandsSep));
};var addSNF=function($parent){var $checkbox=$("<input />").attr("type","checkbox").attr("id","cbUseSnf").addClass("sf-element-input").appendTo($parent).change(function(){Ajax.enqueueRequest(id,"useSnf",$checkbox.prop("checked")?"true":"false");
invalidate();});var $label=$("<label/>").attr("id","useSnf").attr("for","cbUseSnf").appendTo($parent);
if(settings.SNFs.length>1){$label.append(document.createTextNode(Spotfire.Localization.resources.FormattingControl_UseSnf));
}else{$label.append(document.createTextNode(Spotfire.Localization.resources.FormattingControl_UseSnf));
}var checked=false;if(settings.selectedSNFindex!==-1){$checkbox.attr("checked","checked");checked=true;
}if(settings.SNFs.length>1){var selectedIndex=0;var items=[];var i,text,item;for(i=0;settings.SNFs&&i<settings.SNFs.length;
i++){text=settings.SNFs[i];item={text:text,index:text};if(i===settings.selectedSNFindex){selectedIndex=i;
}items.push(item);}var $dropDown=$("<div/>").appendTo($parent);Spotfire.Controls.DropDown.initialize($dropDown,{onSelected:function(selectedValue,selectedIndex){Ajax.enqueueRequest(id,"setSnf",items[selectedIndex].index);
invalidate();},values:items,useIndexAsValueId:true,selectedIndex:selectedIndex});if(!checked){$dropDown.attr("disabled","disabled");
}}};var addDate=function($parent){$parent.append($("<div/>").text(Spotfire.Localization.resources.FormattingControl_Type).addClass("Header"));
var selectedIndex=0;var items=[];var i,text,item;for(i=0;settings.dates&&i<settings.dates.length;i++){text=settings.dates[i];
item={text:text,index:settings.hasCustomOption?i-1:i};if(i===settings.selectedIndex){selectedIndex=i;
}items.push(item);}var $dropDown=$("<div/>").appendTo($parent);Spotfire.Controls.DropDown.initialize($dropDown,{onSelected:function(selectedValue,selectedIndex){Ajax.enqueueRequest(id,"setDate",items[selectedIndex].index);
invalidate();},values:items,useIndexAsValueId:true,selectedIndex:selectedIndex});};var addCustom=function($parent){$("<div/>").text(Spotfire.Localization.resources.FormattingControl_FormatString).addClass("Header").appendTo($parent);
var $customInput=$("<input type='text'/>").addClass("sf-element-input").val(settings.customString).css("width",($parent.width()-margin)+"px").change(function(){Ajax.enqueueRequest(id,"setCustom",$customInput.val());
invalidate();});$parent.append($customInput);if(settings.error){$customInput.addClass("error");$customInput.attr("title",Spotfire.Localization.resources.FormattingControl_InvalidFormat);
}};var addHelpText=function($parent){if(settings.customHelp){var $helpText=$("<div/>").addClass("helptext").html(settings.customHelp);
if(settings.customHelpId){var $link=$helpText.find("a");$link.attr("href",Spotfire.Web.getHelpTopicLink(settings.customHelpId)).attr("target",Spotfire.Web.helpTarget);
}$parent.append($helpText);}};var addSample=function($parent){$parent.append($("<div/>").text(Spotfire.Localization.resources.FormattingControl_Sample).addClass("Header"));
var $label=$("<div/>").addClass("Sample").text(settings.sample).css("width",($parent.width()-margin)+"px");
$parent.append($label);};var addBoolean=function($parent){$parent.append($("<div/>").text(Spotfire.Localization.resources.FormattingControl_Type).addClass("Header"));
var selectedIndex=0;var items=[];var i,text,item;for(i=0;settings.booleanValues&&i<settings.booleanValues.length;
i++){text=settings.booleanValues[i];item={text:text,index:i};if(i===settings.selectedIndex){selectedIndex=i;
}items.push(item);}var $dropDown=$("<div/>").appendTo($parent);Spotfire.Controls.DropDown.initialize($dropDown,{onSelected:function(selectedValue,selectedIndex){Ajax.enqueueRequest(id,"setBoolean",items[selectedIndex].index);
invalidate();},values:items,useIndexAsValueId:true,selectedIndex:selectedIndex});};var addDatePart=function($parent){$parent.append($("<div/>").text(Spotfire.Localization.resources.FormattingControl_Type).addClass("Header"));
var $dropDown=$("<div/>").appendTo($parent);Spotfire.Controls.DropDown.initialize($dropDown,{onSelected:function(selectedValue,selectedIndex){Ajax.enqueueRequest(id,"setTimeLevel",settings.timeLevels[selectedIndex].value);
invalidate();},values:settings.timeLevels,useIndexAsValueId:true,selectedIndex:settings.selectedTimeLevelIndex});
};var addFormatterType=function($parent,type){var $formatterType=$("<div />").addClass("FormatterType sf-element-formatter-item");
$parent.append($formatterType);var key=type.Key;if(settings.FormatterType===key){$formatterType.addClass("SelectedFormatter sfpc-selected");
}var formatterTypeClass="Formatting_"+key;var $imageContainer=$("<div/>").addClass("FormatterTypeImageContainer sf-element-icon").appendTo($formatterType);
var $image=$("<div/>").addClass("FormatterTypeImage").addClass(formatterTypeClass).appendTo($imageContainer);
Spotfire.getSvg("Images/Formatting/"+key+".svg",function($svg){$image.empty().append($svg);});$("<div/>").addClass("FormatterTypeText").text(type.Value).appendTo($formatterType);
if(settings.AvailableFormatterTypes.length>1){$formatterType.on("click",function(){Ajax.enqueueRequest(id,"setFormatterType",key);
invalidate();});}};var addFormatterTypes=function($parent){settings.AvailableFormatterTypes.forEach(function(type){addFormatterType($parent,type);
});};var layoutControl=function(){$container.empty();var $settingsContainer=$container;$settingsContainer.removeClass("FormatterSettings");
if(settings.IncludeFormatterTypes){var $formatterTypesAndSettings=$("<div />").addClass("flex-container-horizontal").addClass("FormatterTypesAndSettingsContainer");
$container.append($formatterTypesAndSettings);var $typesContainer=$("<div />").addClass("FormatterTypeMenu sf-element-modal-dialog-inner-body sfpc-left").appendTo($formatterTypesAndSettings);
$settingsContainer=$("<div />").appendTo($formatterTypesAndSettings).addClass("sf-element-modal-dialog-inner-body sfpc-right");
$settingsContainer.css("min-width","300px");addFormatterTypes($typesContainer);}$settingsContainer.addClass("FormatterSettings FormattingControlContent");
switch(settings.FormatterType){case"Percentage":addDecimals($settingsContainer,true);addThousandsSep($settingsContainer);
addSample($settingsContainer);break;case"Currency":addDecimals($settingsContainer,true);addThousandsSep($settingsContainer);
addCurrency($settingsContainer);addNegativeNumbers($settingsContainer);addSNF($settingsContainer);addSample($settingsContainer);
break;case"Scientific":addDecimals($settingsContainer,false);addSample($settingsContainer);break;case"Number":addDecimals($settingsContainer,true);
addThousandsSep($settingsContainer);addNegativeNumbers($settingsContainer);addSNF($settingsContainer);
addSample($settingsContainer);break;case"DatePart":addDatePart($settingsContainer);addSample($settingsContainer);
break;case"Time":case"DateTime":case"Date":case"TimeSpan":addDate($settingsContainer);if(!settings.IncludeFormatterTypes){addCustom($settingsContainer);
}addSample($settingsContainer);break;case"Custom":addCustom($settingsContainer);addSample($settingsContainer);
addHelpText($settingsContainer);break;case"Updating":$container.text(Spotfire.Localization.resources.FormattingControl_Updating);
break;case"Boolean":addBoolean($settingsContainer);addSample($settingsContainer);break;default:if(settings.IncludeFormatterTypes){$settingsContainer.append($("<div/>").text(Spotfire.Localization.resources.FormattingControl_NoSettings));
}else{$settingsContainer.text(Spotfire.Localization.resources.FormattingControl_NoSettings);}addSample($settingsContainer);
break;}Spotfire.Filters.StyledFilters.createStyledInput($settingsContainer);};var control={container:$container,layout:layoutControl,update:function(data){if(initUpdateTime){var now=new Date();
var thisTime=now-initUpdateTime;if(changeTimer){window.clearTimeout(changeTimer);}lastTime=lastTime===0?thisTime:(thisTime+lastTime)/2;
initUpdateTime=undefined;}settings=data;layoutControl();},getTopicId:function(){switch(settings.FormatterType){case"Percentage":return"5001040";
case"Currency":return"5001039";case"Scientific":return"5001041";case"Number":return"5001038";case"Time":case"DateTime":case"Date":case"TimeSpan":return"5001042";
case"Custom":return"5001044";case"Boolean":return"5001043";default:return"DefaultTopicId";}}};$container.data("control",control);
invalidate=function(){initUpdateTime=new Date();changeTimer=window.setTimeout(function(){control.update({FormatterType:"Updating"});
},(lastTime>=200)?0:200);};invalidate();return control;}Spotfire.registerNameSpace("Controls.FormattingControl");
Spotfire.Controls.FormattingControl.create=function(parent,id){return new FormattingControl(parent,id);
};Spotfire.Controls.FormattingControl.update=function(id,settings){var container=$("#"+id);if(container.length===1){container.data("control").update(settings);
}};Spotfire.Controls.FormattingControl.show=function(id,settings){var dialog=$("<div/>").attr("id",id).addClass("FormattingControl");
var buttons=[{text:Spotfire.Localization.resources.Close,isDefault:true}];var control=null;var options={modal:true,title:Spotfire.Localization.resources.PropertiesPopout_FormattingSetting,buttons:buttons,resize:function(){if(control!==null){control.layout();
}}};if(settings.IncludeFormatterTypes){options.minWidth=584;options.minHeight=500;options.modal=true;
options.type="compact";}dialog.css({height:"100%",position:"absolute"});var modalDialog=Spotfire.Controls.ModalDialog.initialize(dialog,options);
control=Spotfire.Controls.FormattingControl.create(dialog,id);control.update(settings);if(!settings.IncludeFormatterTypes){modalDialog.update({width:300,height:"auto"});
}};});$(function(){Spotfire.registerNameSpace("FormHelper");Spotfire.FormHelper.extractValues=function(formId){var form=document.getElementById(formId);
var getKey=function(element){if("name" in element&&element.name!==""){return element.name;}if("id" in element&&element.id!==""){return element.id;
}return null;};var foreach=function(col,executor){if(!("length" in col)){throw"Can't enumerate collection.";
}var i;for(i=0;i<col.length;i++){executor(col[i]);}};var result={};var key,values;var formElement;foreach(form.elements,function(formElement){key=getKey(formElement);
if(key===null){return;}values=[];switch(formElement.tagName){case"SELECT":if(formElement.multiple){foreach(formElement.options,function(option){if(option.selected){values.push(option.value);
}});}else{values.push(formElement.value);}break;case"INPUT":switch(formElement.type){case"checkbox":case"radio":if(formElement.checked){values.push("true");
}else{values.push("false");}break;case"text":case"password":case"hidden":values.push(formElement.value);
break;default:break;}break;default:if("value" in formElement){values.push(formElement.value);}break;}if(key in result){result[key]=result[key].concat(values);
}else{result[key]=values;}});return result;};});$(function(){Spotfire.registerNameSpace("Visuals.GroupFromMarked");
function GroupFromMarkedDialog($panel,id,items){var openState=0;var checkingStateState=1;var errorState=2;
var state=openState;var $contentPanel=$panel;var initialWidth=350;var dialog;$contentPanel.attr("title",Spotfire.Localization.resources.GroupFromMarked_Title);
var values=[];var i;for(i=0;i<items.length;i++){values.push(items[i].text);}var $selectBox=$("<div />");
var onSelect;window.setTimeout(function(){Spotfire.Controls.DropDown.initialize($selectBox,{useIndexAsValueId:true,values:values,selectedIndex:0,onSelected:onSelect});
dialog.update("height","auto");},0);var $newCategory=$("<input type='text' id='groupMarkedCategory' />").addClass("sf-element-input");
var $errorIndication=$("<span/>").addClass("group-marked-error-indication").attr("title",Spotfire.Localization.resources.GroupFromMarked_NameInUse);
var $chooseColumnDiv=$("<div/>").append(Spotfire.Localization.resources.GroupFromMarked_ChooseColumnsLabel).append("<br/>").append($selectBox).append("<br/><br/>").append(Spotfire.Localization.resources.GroupFromMarked_UsedAxisLabel).append("<br/>").append("<label id='axisLabel'/>").append("<br/><br/>");
$contentPanel.append($chooseColumnDiv).append(Spotfire.Localization.resources.GroupFromMarked_SelectedValuesLabel).append("<br/>").append("<label id='catLabel'/>").append("<br/><br/>").append(Spotfire.Localization.resources.GroupFromMarked_CategoryLabel).append($errorIndication).append("<br/>").append($newCategory);
$errorIndication.hide();$newCategory.change(function(){$("#okButton").prop("disabled",$.trim($newCategory.val())==="");
$("#okButton").toggleClass("sfpc-disabled",$.trim($newCategory.val())==="");if(state===errorState){$errorIndication.hide();
}if(state!==checkingStateState){state=openState;}});var okButtonCallback=function(){state=checkingStateState;
Spotfire.LightBox.show();Ajax.enqueueRequest(id,"PerformGrouping",JSON.stringify({index:parseInt($selectBox.val(),10),groupName:$newCategory.val()}));
return true;};var onCloseCallback=function(){if(state===openState||state===errorState){Ajax.enqueueRequest(id,"DialogClosed",null);
Spotfire.LightBox.hide();}};var onGroupMarkedKeyUp=function(event){var noCategoryName=$.trim($newCategory.val())==="";
$("#okButton").prop("disabled",noCategoryName);$("#okButton").toggleClass("sfpc-disabled",noCategoryName);
};$contentPanel.on("keyup",onGroupMarkedKeyUp);var buttons=[{id:"okButton",text:Spotfire.Localization.resources.Ok,disabled:true,click:okButtonCallback,isDefault:true},{id:"cancelButton",text:Spotfire.Localization.resources.Cancel,isCancel:true}];
this.modalDialog=Spotfire.Controls.ModalDialog.initialize($contentPanel,{width:initialWidth,height:"auto",buttons:buttons,resizable:true,modal:true,open:function(){$newCategory.select();
},close:onCloseCallback,dialogClass:"data-dialog"});dialog=this.modalDialog;onSelect=function(text,id){$("#catLabel").text(items[id].labels);
$("#axisLabel").text(items[id].usedBy);if(state===errorState){$errorIndication.hide();}state=openState;
};onSelect(null,0);this.nameInUse=function(){state=errorState;Spotfire.LightBox.hide();$errorIndication.show();
};}Spotfire.Visuals.GroupFromMarked.show=function(id,settings){var prev=$(".groupFromMarked").data("dialog");
if(prev){prev.modalDialog.close();}var $contentPanel=$("<div></div>").addClass("groupFromMarked");var dialog=new GroupFromMarkedDialog($contentPanel,id,settings);
$contentPanel.data("dialog",dialog);};Spotfire.Visuals.GroupFromMarked.nameUsed=function(){$(".groupFromMarked").data("dialog").nameInUse();
};Spotfire.Visuals.GroupFromMarked.close=function(){$(".groupFromMarked").data("dialog").modalDialog.close();
Spotfire.LightBox.hide();};});function GetId(){return("RandId"+Math.floor(Math.random()*999999999));}function showInfoPopUp(title,closeButtonText,contents){var id=GetId();
var iid="#"+id;$("<div />").css("word-wrap","break-word").attr("id",id).addClass("sf-enable-selection").appendTo($("body"));
$(iid).append(contents);Spotfire.Controls.ModalDialog.initialize($(iid),{title:title,resizable:true,buttons:[{text:closeButtonText,isDefault:true}]});
}var Keys={BACKSPACE:8,TAB:9,RETURN:13,SHIFT:16,CONTROL:17,CANCEL:27,ESCAPE:27,SPACE:32,PAGEUP:33,PAGEDOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,INSERT:45,DELETE:46,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,SLEEP:95,NUMPAD0:96,NUMPAD1:97,NUMPAD2:98,NUMPAD3:99,NUMPAD4:100,NUMPAD5:101,NUMPAD6:102,NUMPAD7:103,NUMPAD8:104,NUMPAD9:105,MULTIPLY:106,ADD:107,SEPARATOR:108,SUBTRACT:109,DECIMAL:110,DIVIDE:111,PLUS:187,DASH:189,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,F13:124,F14:125,F15:126,F16:127,F17:128,F18:129,F19:130,F20:131,F21:132,F22:133,F23:134,F24:135};
$(function(){Spotfire.registerNameSpace("Visuals.Legend");var legends={};function ImageCounter(doneCallback){var count=0;
var dirty=false;this.register=function($img){dirty=true;count++;$img.load(function(){count--;if(count===0){doneCallback();
}});};this.done=function(){if(dirty){return;}doneCallback();};}function Legend($parent,viewId){var seed=new Date().getTime();
var scrollbar;var createItem=function(item){var $item=$("<div/>");$item.addClass("sf-element sf-element-legend-item");
if(Spotfire.isProfessional()){Spotfire.Controls.ContextMenu.bindRightClick($item,viewId,{LegendItemId:item.Id});
}return $item;};var updateItem=function($item,item,imageCounter,createContents,itemIndex,itemsCount,configurationHash){Spotfire.StyleManager.setSequencePseudoClasses($item,itemIndex,itemsCount);
var elem;var d3ItemElements=[];var getAvailableWidth=function(){return $item.width();};if(item.Title){var updateTitle=function(div){$(div).text(item.Title+":");
};elem={id:"title",create:function(){var $title=$("<div/>").addClass("sf-element sf-element-title");updateTitle($title);
return $title.get(0);},update:updateTitle};d3ItemElements.push(elem);}if(item.Text){var updateText=function(div){$(div).html($("<div/>").text(item.Text).html().replace(/\r\n/g,"<br/>"));
};elem={id:"text",create:function(){var $title=$("<div/>").addClass("sf-element sf-element-text-box");
updateText($title);return $title.get(0);},update:updateText};d3ItemElements.push(elem);}var onClickCallback=null;
if(Spotfire.isProfessional()){onClickCallback=function(){var args={viewId:viewId,LegendItemId:item.Id};
Spotfire.PageBus.publish("spotfire.visuals.tray.showdropdownmenu",args);};}if(item.Marking){elem={id:"marking",create:function(){var $div=$("<div/>");
var markingTray=Spotfire.Data.MarkingTray.create($div,item.Marking,function(val){var args={itemId:item.itemId,value:val};
Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,"ChangeMarking",JSON.stringify(args));},onClickCallback);
$item.data("markingTray",markingTray);$parent.on("panelResize",function(){markingTray.sizeBy(getAvailableWidth());
});return $div.get(0);},update:function(div){var markingTray=$item.data("markingTray");markingTray.update(item.Marking);
}};d3ItemElements.push(elem);}if(item.AxisTrays){var i;var pushD3ItemElementsForAxisTraySettings=function(axisTraySettings){if(axisTraySettings.title){elem={id:"axis-tray-"+axisTraySettings.viewId+"-title",create:function(){var $div=$("<div/>").addClass("sf-element sf-element-title");
$div.text(axisTraySettings.title+":");return $div.get(0);},update:function(div){$(div).text(axisTraySettings.title+":");
}};d3ItemElements.push(elem);}elem={id:"axis-tray-"+axisTraySettings.viewId,create:function(){var $tray=$("<div/>").addClass("sf-legend-axis-tray");
$tray.height(axisTraySettings.AxisTrayHeight);Spotfire.Visuals.AxisTrayControl.initialize($tray,axisTraySettings.viewId,axisTraySettings.settings,true);
$parent.on("panelResize",function(){var pbm=axisTraySettings.PaddingBorderMargin;var pbmWidth=pbm?pbm.width:0;
$tray.width(getAvailableWidth()-pbmWidth);$tray.trigger("shown");});return $tray.get(0);},update:function(div){var $tray=$(div);
$tray.height(axisTraySettings.AxisTrayHeight);Spotfire.Visuals.AxisTrayControl.update(axisTraySettings.viewId,axisTraySettings.settings);
}};d3ItemElements.push(elem);};for(i=0;i<item.AxisTrays.length;i++){pushD3ItemElementsForAxisTraySettings(item.AxisTrays[i]);
}}if(item.DataTable){elem={id:"datatable",create:function(){var $div=$("<div/>");var dataTableTray=Spotfire.Data.DataTableTray.create($div,item.DataTable,function(val){var args={itemId:item.itemId,value:val};
Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,"ChangeDataTable",JSON.stringify(args));},onClickCallback);
$item.data("dataTableTray",dataTableTray);$parent.on("panelResize",function(){dataTableTray.sizeBy(getAvailableWidth());
});return $div.get(0);},update:function(div){var dataTableTray=$item.data("dataTableTray");dataTableTray.update(item.DataTable);
}};d3ItemElements.push(elem);}if(item.subItemSection){var updateSection=function(div){var $section=$(div);
$section.width(item.subItemSection.size.width);$section.css("position","relative");$section.css("display","block");
var groupCount=item.subItemSection.children.length;var groupScene=d3.select($section.get(0)).selectAll(".sf-element-sub-item-group").data(item.subItemSection.children);
groupScene.enter().append(function(group){var $group=$("<div/>").addClass("sf-element sf-element-sub-item-group");
$group.css("position","relative");$group.css("display","block");return $group.get(0);});groupScene.each(function(group,groupIndex){var $group=$(this);
Spotfire.StyleManager.setSequencePseudoClasses($group,groupIndex,groupCount);var d3Group=d3.select($group.get(0));
var subItemCount=group.children.length;var subItemScene=d3Group.selectAll(".sf-transition-wrapper").data(group.children,function(subItem){return subItem.tag?subItem.tag.identifier:"moreItemsIndicator";
});var exitCount=subItemScene.exit().size();var transitionDuration=Spotfire.useTransitions()?150:0;var fadeInTransitonAnchor=d3Group;
if(exitCount>0){fadeInTransitonAnchor=d3Group.transition().duration(transitionDuration*2).each(function(){subItemScene.exit().transition().duration(transitionDuration).style("opacity","0").transition().duration(transitionDuration).style("height","0px").remove();
});}subItemScene.enter().append(function(subItem){var $transitionWrapper=$("<div/>").addClass("sf-transition-wrapper");
var $subItem=$("<div/>").addClass("sf-element sf-element-sub-item").appendTo($transitionWrapper);$subItem.css("white-space","nowrap");
$transitionWrapper.css("position","relative");$transitionWrapper.css("display","block");$transitionWrapper.css("overflow","hidden");
$transitionWrapper.css("height","0");$transitionWrapper.css("opacity","0.001");return $transitionWrapper.get(0);
});subItemScene.each(function(subItem,subItemIndex){var $transitionWrapper=$(this);$transitionWrapper.data("configurationHash",configurationHash);
var $subItem=$(".sf-element-sub-item",$transitionWrapper);$subItem.empty();Spotfire.StyleManager.setSequencePseudoClasses($subItem,subItemIndex,subItemCount);
var icon,$icon;var tag=subItem.tag;var moreItemsIndicator=tag===undefined;if(moreItemsIndicator){$subItem.text(subItem.value);
$subItem.height(subItem.size.height);return;}icon=subItem.icon;$icon=$("<div/>").addClass("sf-element sf-element-icon");
$icon.css("position","relative");$icon.css("display","inline-block");$icon.css("vertical-align","top");
$icon.css({cursor:Spotfire.isAuthorMode()?"pointer":"default",height:icon.size.height,width:icon.size.width});
$subItem.append($icon);if(icon.svg){Spotfire.getSvg(icon.svg,function(svg){$icon.append(svg);});if(icon.currentColor){$icon.css("color",icon.currentColor);
}if(icon.solid!==undefined&&!icon.solid){$icon.addClass("outline-shape");}}else{if(icon.src){$("<img />").attr("src",icon.src).css({width:icon.size.width,height:icon.size.height}).appendTo($icon);
}}if(tag.type==="Color"){var circleBorderWidth=Math.max(1,Math.floor(icon.size.width/12));var $circle=$("<div/>").css({"margin-top":"1px",width:icon.size.width-2*circleBorderWidth-1,height:icon.size.height-2*circleBorderWidth-1,"border-width":circleBorderWidth,"border-style":"solid","border-color":icon.stroke,"border-radius":Math.max(icon.size.width,icon.size.height)/2,"background-color":icon.fill});
$icon.append($circle);}if(Spotfire.isAuthorMode()){if(tag.type==="Shape"||tag.type==="Shape3D"){$icon.on("click",function(e){var $element=$(this);
var onShowPopout=function(details){var settings={type:"ShapePicker",current:tag.currentvalue,palette:details.palette};
Spotfire.Picker.show(settings,$element,tag.type==="Shape3D"?"ShapePicker3D":"ShapePicker",function(result){Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,tag.type==="Shape3D"?"Set3DShape":"SetShape",JSON.stringify({key:tag.key,shapeid:result.id,legenditemid:tag.legenditemid}));
});};if(tag.type==="Shape3D"){Spotfire.Dxp.Web.Forms.AjaxService.Read(viewId,"Get3DShapes","",onShowPopout);
}else{Spotfire.Dxp.Web.Forms.AjaxService.Read(viewId,"GetShapes","",onShowPopout);}e.stopPropagation();
});}else{$icon.on("click",function(e){var $element=$(this);var onShowPopout=function(details){var settings={type:"ColorPicker",current:tag.currentvalue,palette:details.palette,series:tag.type==="Series"};
Spotfire.Picker.show(settings,$element,"ColorPicker",function(result){if(result.id==="Bar"||result.id==="Line"){Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,"Series",JSON.stringify({key:tag.key,seriestype:result.id}));
}else{Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,"Color",JSON.stringify({legenditemid:tag.legenditemid,identifier:tag.identifier,color:result.toHexString(false)}));
}});};Spotfire.Dxp.Web.Forms.AjaxService.Read(viewId,"GetColorPalette","",onShowPopout);e.stopPropagation();
});}}var text=subItem.text;var $t=$("<div/>").addClass("sf-element sf-element-text-box");$t.text(text.value);
$t.height(text.size.height);$t.hover(function(){Spotfire.Visuals.Tooltip.show(text.value,Spotfire.Visuals.Tooltip.defaultPauseTime);
},function(){Spotfire.Visuals.Tooltip.hide();});$t.toggleClass("sfpc-dimmed",tag.dimmed);$t.removeClass("sfpc-marked");
if(tag.interactive){$t.toggleClass("sfpc-marked",tag.marked);$t.addClass("sfpc-markable");$t.css("cursor","pointer");
$t.on("click",function(e){Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,"Mark",JSON.stringify({coloringid:tag.coloringid,legendId:item.legendId,key:tag.key,index:tag.index,axisname:tag.axisname,toggle:e.ctrlKey||e.metaKey,role:tag.role,configurationHash:$(this).closest(".sf-transition-wrapper").data("configurationHash")}));
e.stopPropagation();});}if(Spotfire.isProfessional()){$t.hover(function(){if(tag.interactive){Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,"Highlight",JSON.stringify({coloringid:tag.coloringid,legendId:item.legendId,key:tag.key,index:tag.index,axisname:tag.axisname,role:tag.role,configurationHash:$(this).closest(".sf-transition-wrapper").data("configurationHash")}));
}},function(){Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,"ClearHighlight",JSON.stringify({}));});
}$subItem.append($t);var textWidth=$t.sfBoxWidth();var maxWidth=$subItem.width()-$icon.sfBoxWidth();if(textWidth>maxWidth){$t.sfBoxWidth(maxWidth);
}});var debouncedScrollbarRefresh=_.debounce(scrollbar.refresh,transitionDuration/2);if(createContents){subItemScene.style("height",function(){return $(".sf-element-sub-item",$(this)).sfBoxHeight()+"px";
}).style("opacity","1");scrollbar.refresh();}else{fadeInTransitonAnchor.transition().duration(transitionDuration*2).each(function(){subItemScene.transition().duration(transitionDuration).style("height",function(){return $(".sf-element-sub-item",$(this)).sfBoxHeight()+"px";
}).transition().duration(transitionDuration).style("height",function(){return $(".sf-element-sub-item",$(this)).sfBoxHeight()+"px";
}).style("opacity","1");}).each("start",function(){subItemScene.order();}).each("end",debouncedScrollbarRefresh);
}});groupScene.exit().remove();groupScene.order();};elem={id:"sub-item-section",create:function(){var $div=$("<div/>").addClass("sf-element sf-element-sub-item-section");
_.defer(function(){updateSection($div);});return $div.get(0);},update:updateSection};d3ItemElements.push(elem);
}if(item.Image){var updateImg=function(div){var $div=$(div);var $img=$("img",$div);if($img.length===0){$img=$("<img/>").appendTo($div);
}$img.attr("src",item.Image+"&seed="+seed++);imageCounter.register($img);$img.css("display",item.ImageHidden?"none":"");
var pickTimer=null;var pickArgs=null;if(createContents){var onTimeout=function(){var onPick=function(details){Spotfire.Visuals.Tooltip.show(details.join("\r\n"));
};Spotfire.Dxp.Web.Forms.AjaxService.Read(viewId,"Pick",JSON.stringify(pickArgs),onPick);};$img.mousemove(function(e){var offset=$(this).offset();
var x=Math.round(e.pageX-offset.left);var y=Math.round(e.pageY-offset.top);Spotfire.Visuals.Tooltip.hide();
pickArgs={id:item.Id,x:x,y:y};if(pickTimer){window.clearTimeout(pickTimer);}pickTimer=window.setTimeout(onTimeout,Spotfire.Web.tooltipDelay);
});$img.mouseleave(function(){if(pickTimer){window.clearTimeout(pickTimer);}});}};elem={id:"image",create:function(){var $div=$("<div style='line-height:0'/>");
updateImg($div);return $div.get(0);},update:updateImg};d3ItemElements.push(elem);}var itemScene=d3.select($item.get(0)).selectAll(".sf-legend-item-elem").data(d3ItemElements,function(e){return e.id;
});itemScene.exit().remove();itemScene.each(function(e){e.update(this);});itemScene.enter().append(function(e){var $div=$(e.create());
$div.addClass("sf-legend-item-elem");return $div.get(0);});itemScene.order();};var renderLegend=function(legendBundle){var items=legendBundle.items;
var $container=$parent;var counter=new ImageCounter(function(){$parent.trigger("panelResize");});if(!scrollbar){scrollbar=$parent.StyledScrollbar({cssClass:"LegendScroll"});
}var scene=d3.select($container.get(0)).selectAll(".sf-element-legend-item").data(items,function(d,i){return d.Id;
});var itemsCount=items.length;scene.each(function(item,i){updateItem($(this),item,counter,false,i,itemsCount,legendBundle.configurationHash);
});scene.enter().append(function(item){var $item=createItem(item);return $item.get(0);}).each(function(item,i){updateItem($(this),item,counter,true,i,itemsCount,legendBundle.configurationHash);
});scene.exit().remove();scene.order();counter.done();};var getLegendTimer;this.update=function(){if(getLegendTimer){window.clearTimeout(getLegendTimer);
}var onTimeout=function(){Spotfire.Dxp.Web.Forms.AjaxService.Read(viewId,"GetLegend","",renderLegend);
};getLegendTimer=window.setTimeout(onTimeout,300);};$parent.on("sf-resize",function(){if(scrollbar){scrollbar.refresh();
}});$parent.on("mousedown",function(downEvent){var clickEventFunc=function(upEvent){$(document.body).off("mouseup",clickEventFunc);
if($(downEvent.target).closest(".sf-element-axis-tray").length){return;}if($(downEvent.target).hasClass("sfpc-markable")){return;
}if(!upEvent.ctrlKey){Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,"ClearMarking",JSON.stringify({}));
upEvent.stopPropagation();}};$(document.body).on("mouseup",clickEventFunc);});$parent.closest(".sf-element-visual").on("sf-update-legend",function(){Spotfire.Visuals.Legend.update(viewId);
});}Spotfire.Visuals.Legend.initialize=function(viewId,elementClass){var selector="[viewId='"+viewId+"']";
var $webViewControl=$(selector).addClass("Legend").empty();var $contentContainer=$("<div>").css({position:"absolute",left:"0",top:"0",width:"100%",height:"100%","overflow-y":"auto","overflow-x":"hidden"}).appendTo($webViewControl);
$webViewControl.on("sf-resize",function(e){if($(e.target).is($contentContainer)){return;}$contentContainer.trigger("sf-resize");
});$webViewControl.addClass(elementClass);$webViewControl.css("overflow-y","hidden");$webViewControl.css("overflow-x","hidden");
$webViewControl.css("position","absolute");if(Spotfire.isAuthorMode()){Spotfire.DragDrop.makeScrollableByDrag($webViewControl);
}if(Spotfire.isProfessional()){Spotfire.Controls.ContextMenu.bindRightClick(selector,viewId);}var legend=new Legend($contentContainer,viewId);
legends[viewId]=legend;legend.update();};Spotfire.Visuals.Legend.update=function(viewId){var legend=legends[viewId];
if(legend){legend.update();}};});$(function(){var instance=null;function LightBox(opacity,color,showBorder){if(typeof opacity!=="number"){opacity=0.97;
}var $styledDialog=$("<div/>").addClass("sf-element sf-element-styled-dialog").hide();var $lightBox=$("<div/>").addClass("sf-element sf-element-lightbox").css({position:"absolute",top:"0",left:"0"}).appendTo($styledDialog);
if(color){$lightBox.css("background-color",color);}if(showBorder){$lightBox.css({"-webkit-box-shadow":"inset 0px 0px 0px 1px #26a2ed","-moz-box-shadow":"inset 0px 0px 0px 1px #26a2ed","box-shadow":"inset 0px 0px 0px 1px #26a2ed"});
}var resetOpacity=function(){$lightBox.css("opacity",opacity===null?"initial":opacity);};var performResize=function(){var width=$(window).innerWidth();
var height=$(window).innerHeight();$lightBox.width(width);$lightBox.height(height-Spotfire.Web.customizableAreaHeight);
$lightBox.css("margin-top",Spotfire.Web.customizableAreaHeight+"px");};$(document.body).append($styledDialog);
$styledDialog.fadeIn(200);performResize();$(window).bind("resize",performResize);this.destroy=function(){$styledDialog.fadeOut(100,function(){$styledDialog.remove();
$(window).unbind("resize",performResize);});};this.show=function(){resetOpacity();$styledDialog.fadeIn(200);
};this.hide=function(){$styledDialog.hide();};this.makeInvisible=function(){$lightBox.css("opacity",0);
};this.makeVisible=function(){resetOpacity();$styledDialog.hide().fadeIn(200);};}Spotfire.registerNameSpace("LightBox");
Spotfire.LightBox.makeInvisible=function(){if(instance!==null){instance.makeInvisible();}};Spotfire.LightBox.makeVisible=function(){if(instance!==null){instance.makeVisible();
}};Spotfire.LightBox.show=function(opacity,color,showBorder){if(instance===null){$(document).trigger("show.spotfire.lightbox");
instance=new LightBox(opacity,color,showBorder);}};Spotfire.LightBox.hide=function(){if(instance!==null){$(document).trigger("hide.spotfire.lightbox");
instance.destroy();instance=null;}};});$(function(){var CLICK_MAX_MOUSEDOWN_TIME=400;var CLICK_MAX_DISTANCE=5;
function MarkingPolygonSVG(canvas,isZoom,markingType,clipRectangle,isYAxisMarking,isXAxisMarking,moveCallback,markingStyle){var svgns="http://www.w3.org/2000/svg";
var div=document.createElement("div");div.style.width=canvas.clientWidth+"px";div.style.height=canvas.clientHeight+"px";
div.style.position="absolute";div.style.top="0px";div.style.left="0px";div.style.visibility="hidden";
var svg=document.createElementNS(svgns,"svg");svg.setAttribute("class","markingTool");svg.setAttribute("width",canvas.clientWidth);
svg.setAttribute("height",canvas.clientHeight);var polygon;if(markingType===Spotfire.Visuals.Marking.Types.RECTANGLE){polygon=document.createElementNS(svgns,"rect");
}else{polygon=document.createElementNS(svgns,"path");}if(isZoom){polygon.setAttribute("fill","#808080");
}else{polygon.setAttribute("fill",markingStyle.backgroundColor);}polygon.setAttribute("fill-opacity","0.5");
polygon.setAttribute("stroke",markingStyle.borderColor);polygon.setAttribute("fill-rule","evenodd");var points=[];
var countPoints=0;var rectangle=new Rectangle(0,0,0,0);var path=new Path();var circle=new Circle();var distanceLineTriangle=new Triangle(8,7);
var distanceLine=document.createElementNS(svgns,"line");var distanceLineArrow=document.createElementNS(svgns,"path");
var distanceLineStart=document.createElementNS(svgns,"circle");var distanceLabel=document.createElementNS(svgns,"text");
var distanceText=document.createTextNode("");distanceLabel.appendChild(distanceText);var distanceLabelY=document.createElementNS(svgns,"text");
var distanceTextY=document.createTextNode("");distanceLabelY.appendChild(distanceTextY);this.setXAxisMarking=function(flag){isXAxisMarking=flag;
};this.setYAxisMarking=function(flag){isYAxisMarking=flag;};this.createPolygon=function(x,y){if(markingType===Spotfire.Visuals.Marking.Types.RECTANGLE){if(isYAxisMarking){if(x<clipRectangle.x){x=clipRectangle.x;
}else{x=clipRectangle.x+clipRectangle.width;}}else{if(isXAxisMarking){if(y<clipRectangle.y){y=clipRectangle.y;
}else{y=clipRectangle.y+clipRectangle.height;}}}polygon.setAttribute("x",x);polygon.setAttribute("y",y);
polygon.setAttribute("width",0);polygon.setAttribute("height",0);rectangle.x=x;rectangle.y=y;distanceLabel.setAttribute("fill",markingStyle.color);
distanceLabelY.setAttribute("fill",markingStyle.color);svg.appendChild(distanceLabel);svg.appendChild(distanceLabelY);
}else{if(markingType===Spotfire.Visuals.Marking.Types.CIRCLE){circle.x=x;circle.y=y;circle.radius=0;distanceLine.setAttribute("stroke",markingStyle.color);
distanceLineStart.setAttribute("r",3);distanceLineStart.setAttribute("fill",markingStyle.color);distanceLabel.setAttribute("fill",markingStyle.color);
distanceLineArrow.setAttribute("fill",markingStyle.color);distanceLineArrow.setAttribute("d",distanceLineTriangle.toPathString());
svg.appendChild(distanceLine);svg.appendChild(distanceLineStart);svg.appendChild(distanceLineArrow);svg.appendChild(distanceLabel);
}else{path.addPoint(x,y);polygon.setAttribute("d",path.toString());}}points[countPoints++]=new Point(x,y);
};this.updatePolygon=function(x,y,distance){if(div.style.visibility==="hidden"){div.style.visibility="visible";
}if(markingType===Spotfire.Visuals.Marking.Types.RECTANGLE){var setX=Math.min(x,points[0].x);var setY=Math.min(y,points[0].y);
var width=Math.abs(x-points[0].x);var height=Math.abs(y-points[0].y);if(isYAxisMarking){setX=clipRectangle.x;
width=clipRectangle.width;}else{if(isXAxisMarking){setY=clipRectangle.y;height=clipRectangle.height;}}rectangle.x=setX+0.5;
rectangle.y=setY+0.5;rectangle.width=width;rectangle.height=height;rectangle.clip(clipRectangle);polygon.setAttribute("x",rectangle.x);
polygon.setAttribute("y",rectangle.y);polygon.setAttribute("width",rectangle.width);polygon.setAttribute("height",rectangle.height);
if(moveCallback){var distanceDataXAxis=moveCallback(new Point(rectangle.left(),rectangle.bottom()),new Point(rectangle.right(),rectangle.bottom()));
var distanceDataYAxis=moveCallback(new Point(rectangle.right(),rectangle.top()),new Point(rectangle.right(),rectangle.bottom()));
if(distanceDataXAxis&&distanceDataYAxis){var labelXSize,labelYSize,labelXPos,labelYPos;distanceText.nodeValue=distanceDataXAxis.value+" "+distanceDataXAxis.label;
distanceTextY.nodeValue=distanceDataYAxis.value+" "+distanceDataYAxis.label;labelXSize=distanceLabel.getBBox();
labelYSize=distanceLabelY.getBBox();labelXPos=new Point(rectangle.centerX()-labelXSize.width/2,rectangle.bottom()+labelXSize.height);
labelYPos=new Point(rectangle.right()+5,rectangle.centerY()+labelYSize.height/2-3);if(y+30>labelXPos.y&&(x>rectangle.left()-0.5||rectangle.left()===rectangle.right())&&labelXPos.x+labelXSize.width+5>x){labelXPos.x=x-labelXSize.width-5;
}else{if(y+30>labelXPos.y&&x<rectangle.right()-0.5&&labelXPos.x<x+15){labelXPos.x=x+15;}}if(x+15>rectangle.right()&&y<rectangle.bottom()-0.5&&y+30>labelYPos.y){labelYPos.x+=10;
}distanceLabel.setAttribute("x",labelXPos.x);distanceLabel.setAttribute("y",labelXPos.y);distanceLabelY.setAttribute("x",labelYPos.x);
distanceLabelY.setAttribute("y",labelYPos.y);}else{distanceText.nodeValue="";distanceTextY.nodeValue="";
}}else{distanceText.nodeValue="";distanceTextY.nodeValue="";}}else{if(markingType===Spotfire.Visuals.Marking.Types.CIRCLE){var rotationAngle=Math.atan2((y-circle.y),(x-circle.x))*(180/Math.PI);
circle.radius=distance;distanceLine.setAttribute("style","opacity: 1");distanceLine.setAttribute("x1",circle.x);
distanceLine.setAttribute("y1",circle.y);distanceLine.setAttribute("x2",x);distanceLine.setAttribute("y2",y);
distanceLineStart.setAttribute("style","opacity: 1");distanceLineStart.setAttribute("cx",circle.x);distanceLineStart.setAttribute("cy",circle.y);
distanceLineArrow.setAttribute("style","opacity: 1");distanceLineArrow.setAttribute("transform","translate("+(x-distanceLineTriangle.width)+", "+(y-distanceLineTriangle.height/2)+") rotate("+rotationAngle+", "+distanceLineTriangle.width+", "+(distanceLineTriangle.height/2)+")");
var hideDistanceElements=function(hideLabel){distanceLineStart.setAttribute("style","opacity: 0");distanceLineArrow.setAttribute("style","opacity: 0");
distanceLine.setAttribute("style","opacity: 0");if(hideLabel){distanceText.nodeValue="";}};if(circle.radius<=10){hideDistanceElements();
}var moveData=moveCallback&&moveCallback(new Point(circle.x,circle.y),new Point(x,y),true);if(moveData&&moveData.polygons){points=[];
var pathString="";var i,polygonPath;for(i=0;i<moveData.polygons.length;i++){polygonPath=new Path(moveData.polygons[i]);
pathString+=polygonPath.toString()+"Z ";points.push(polygonPath.toArray());}polygon.setAttribute("d",pathString);
}else{points=circle.circleToPolygon().points;polygon.setAttribute("d",circle.circleToPolygon().pointsString);
}if(moveData&&moveData.value&&moveData.label){var labelWidth,labelHeight;distanceText.nodeValue=moveData.value+" "+moveData.label;
labelWidth=distanceLabel.getBBox().width;labelHeight=distanceLabel.getBBox().height;if(labelWidth>circle.radius){distanceLabel.setAttribute("transform","rotate(0, "+(circle.x+x)/2+", "+(circle.y+y)/2+")");
var pos=new Point(x,y);var vec=new Point(x-circle.x,y-circle.y);var dist=Math.sqrt(Math.pow(vec.x,2)+Math.pow(vec.y,2));
vec.x=vec.x/dist;vec.y=vec.y/dist;if(vec.x<0){pos.x=-labelWidth+x;}if(vec.y>0){pos.y=labelHeight+y;}if(vec.y>=0&&vec.x>=0){pos.x+=13;
}pos.x+=vec.x*6;pos.y+=vec.y*6;distanceLabel.setAttribute("x",pos.x);distanceLabel.setAttribute("y",pos.y);
}else{if(rotationAngle<=-90||rotationAngle>=90){rotationAngle+=180;}distanceLabel.setAttribute("x",(circle.x+x)/2-labelWidth/2);
distanceLabel.setAttribute("y",(circle.y+y)/2-5);distanceLabel.setAttribute("transform","rotate("+rotationAngle+", "+(circle.x+x)/2+", "+(circle.y+y)/2+")");
}}else{hideDistanceElements(true);}}else{path.addPoint(x,y);polygon.setAttribute("d",path.toString());
points[countPoints++]=new Point(x,y);}}};this.getPoints=function(){if(markingType===Spotfire.Visuals.Marking.Types.RECTANGLE){return[new Point(rectangle.x,rectangle.y),new Point(rectangle.x+rectangle.width,rectangle.y),new Point(rectangle.x+rectangle.width,rectangle.y+rectangle.height),new Point(rectangle.x,rectangle.y+rectangle.height)];
}return points;};this.getCircle=function(){return circle;};this.remove=function(){canvas.removeChild(div);
};svg.appendChild(polygon);div.appendChild(svg);canvas.appendChild(div);}function MarkingPolygonVML(canvas,isZoom,markingType,clipRectangle,isYAxisMarking,isXAxisMarking){var vmlns="urn:schemas-microsoft-com:vml";
if(!document.namespaces.v){var browserCheckDiv=document.createElement("div");browserCheckDiv.innerHTML="<!--[if gt IE 7]><i></i><![endif]-->";
var ie8=browserCheckDiv.getElementsByTagName("i").length>0;if(ie8){document.namespaces.add("v",vmlns,"#default#VML");
}else{document.namespaces.add("v",vmlns);}}if(!document.IsVmlRuleAdded){if(document.styleSheets.length>0){document.styleSheets[0].addRule("v\\:fill","behavior: url(#default#VML);");
document.styleSheets[0].addRule("v\\:stroke","behavior: url(#default#VML);");document.styleSheets[0].addRule("v\\:rect","behavior: url(#default#VML);");
document.styleSheets[0].addRule("v\\:polyline","behavior: url(#default#VML);");}else{var style=document.createStyleSheet();
style.addRule("v\\:fill","behavior: url(#default#VML);");style.addRule("v\\:stroke","behavior: url(#default#VML);");
style.addRule("v\\:rect","behavior: url(#default#VML);");style.addRule("v\\:polyline","behavior: url(#default#VML);");
}document.IsVmlRuleAdded=true;}var div=document.createElement("div");div.style.width=canvas.clientWidth+"px";
div.style.height=canvas.clientHeight+"px";div.style.position="absolute";div.style.top="0px";div.style.left="0px";
div.style.visibility="hidden";var vml=document.createElement("group");vml.setAttribute("width",canvas.clientWidth);
vml.setAttribute("height",canvas.clientHeight);var fill=document.createElement("v:fill");fill.setAttribute("opacity","0.5");
if(isZoom){fill.setAttribute("color","#808080");}else{fill.setAttribute("color","#8daddf");}var stroke=document.createElement("v:stroke");
stroke.setAttribute("color","#0a1530");stroke.setAttribute("opacity","0.5");var polygon=null;if(markingType===Spotfire.Visuals.Marking.Types.RECTANGLE){polygon=document.createElement("v:rect");
}else{polygon=document.createElement("v:polyline");}polygon.appendChild(fill);polygon.appendChild(stroke);
polygon.style.position="absolute";polygon.style.width="0px";polygon.style.height="0px";var points=[];
var countPoints=0;var rectangle=new Rectangle(0,0,0,0);var path=[];var countPath=0;this.setXAxisMarking=function(flag){isXAxisMarking=flag;
};this.setYAxisMarking=function(flag){isYAxisMarking=flag;};this.createPolygon=function(x,y){if(markingType===Spotfire.Visuals.Marking.Types.RECTANGLE){if(isYAxisMarking){if(x<clipRectangle.x){x=clipRectangle.x;
}else{x=clipRectangle.x+clipRectangle.width;}}else{if(isXAxisMarking){if(y<clipRectangle.y){y=clipRectangle.y;
}else{y=clipRectangle.y+clipRectangle.height;}}}if(polygon){polygon.style.left=x+"px";polygon.style.top=y+"px";
polygon.style.width="0px";polygon.style.height="0px";rectangle.x=x;rectangle.y=y;}}else{path[countPath++]=x;
path[countPath++]=y;if(!polygon.points){polygon.points=path;}polygon.points.value=path;}points[countPoints++]=new Point(x,y);
};this.updatePolygon=function(x,y){if(div.style.visibility==="hidden"){div.style.visibility="visible";
}if(markingType===Spotfire.Visuals.Marking.Types.RECTANGLE){var setX=Math.min(x,points[0].x);var setY=Math.min(y,points[0].y);
var width=Math.abs(x-(points[0].x));var height=Math.abs(y-(points[0].y));if(isYAxisMarking){setX=clipRectangle.x;
width=clipRectangle.width;}else{if(isXAxisMarking){setY=clipRectangle.y;height=clipRectangle.height;}}rectangle.x=setX;
rectangle.y=setY;rectangle.width=width;rectangle.height=height;rectangle.clip(clipRectangle);polygon.style.left=rectangle.x+"px";
polygon.style.top=rectangle.y+"px";polygon.style.width=rectangle.width+"px";polygon.style.height=rectangle.height+"px";
}else{path[countPath++]=x;path[countPath++]=y;polygon.points.value=path;}points[countPoints++]=new Point(x,y);
};this.getPoints=function(){if(markingType===Spotfire.Visuals.Marking.Types.RECTANGLE){return[new Point(rectangle.x,rectangle.y),new Point(rectangle.x+rectangle.width,rectangle.y),new Point(rectangle.x+rectangle.width,rectangle.y+rectangle.height),new Point(rectangle.x,rectangle.y+rectangle.height)];
}return points;};this.remove=function(){if(markingType!==Spotfire.Visuals.Marking.Types.RECTANGLE){polygon.points.value=[];
}points=[];path=[];canvas.removeChild(div);};vml.appendChild(polygon);div.appendChild(vml);canvas.appendChild(div);
}Spotfire.registerNameSpace("Visuals.Marking");Spotfire.Visuals.Marking.Types={RECTANGLE:0,LASSO:1,CIRCLE:2};
Spotfire.Visuals.Marking.onMouseDown=function(e,$trackedElement,canZoom,markCallback,onlyClicks,markingType,markingMoveCallback,markingStyle){markingType=markingType||Spotfire.Visuals.Marking.Types.RECTANGLE;
if(!Spotfire.capabilities.supportsTouch()&&e.which!==1){return;}var entryPoint=new Point(e.pageX,e.pageY);
var plotMarkMode="Replace";var isZoom=false;var altMarkMode=false;if(e.altKey&&(e.ctrlKey||e.metaKey)&&e.shiftKey){isZoom=true;
}else{if(e.altKey||Spotfire.capabilities.supportsTouch()){markingType=Spotfire.Visuals.Marking.Types.LASSO;
}else{if(e.shiftKey){markingType=Spotfire.Visuals.Marking.Types.CIRCLE;}}}if(isZoom&&!canZoom){return;
}if(e.ctrlKey||e.metaKey){plotMarkMode="Toggle";}if(e.shiftKey){altMarkMode=true;}var offset=$trackedElement.offset();
var globalMarkableArea=new Rectangle(offset.left,offset.top,$trackedElement.width(),$trackedElement.height());
var innerPlotBounds=$trackedElement.data("innerPlotBounds");if(!innerPlotBounds||(innerPlotBounds.width===0&&innerPlotBounds.height===0)){innerPlotBounds=new Rectangle(0,0,globalMarkableArea.width,globalMarkableArea.height);
}var isYAxisMarking=entryPoint.x<innerPlotBounds.x+globalMarkableArea.x||entryPoint.x>innerPlotBounds.x+globalMarkableArea.x+innerPlotBounds.width;
var isXAxisMarking=entryPoint.y<innerPlotBounds.y+globalMarkableArea.y||entryPoint.y>innerPlotBounds.y+globalMarkableArea.y+innerPlotBounds.height;
var startXAxisMarking=isXAxisMarking;var startYAxisMarking=isYAxisMarking;var markingPolygon;if(window.SVGAngle){markingPolygon=new MarkingPolygonSVG($trackedElement.get(0),isZoom,markingType,innerPlotBounds,isYAxisMarking,isXAxisMarking,markingMoveCallback,markingStyle);
}else{markingPolygon=new MarkingPolygonVML($trackedElement.get(0),isZoom,markingType,innerPlotBounds,isYAxisMarking,isXAxisMarking);
}markingPolygon.createPolygon(entryPoint.x-globalMarkableArea.x,entryPoint.y-globalMarkableArea.y);var prevPoint;
var abortMarking=false;var clickPoint=new Point(e.pageX-globalMarkableArea.x,e.pageY-globalMarkableArea.y);
var clickTime=new Date().getTime();var isSingleClick=function(x,y){var totalDistance=Math.sqrt(Math.pow(clickPoint.x-(x-globalMarkableArea.x),2)+Math.pow(clickPoint.y-(y-globalMarkableArea.y),2));
if(new Date().getTime()-clickTime<CLICK_MAX_MOUSEDOWN_TIME&&totalDistance<=CLICK_MAX_DISTANCE){return true;
}return false;};var onMouseMove=function(e1){if(onlyClicks){abortMarking=true;return;}var currentPos=new Point(e1.pageX,e1.pageY);
var x=currentPos.x;var y=currentPos.y;var distance;if((markingType===Spotfire.Visuals.Marking.Types.RECTANGLE||markingType===Spotfire.Visuals.Marking.Types.CIRCLE)&&isSingleClick(x,y)){return;
}if(markingType===Spotfire.Visuals.Marking.Types.RECTANGLE){if(startXAxisMarking){var xAxisMarking=y<innerPlotBounds.y+globalMarkableArea.y||y>innerPlotBounds.y+globalMarkableArea.y+innerPlotBounds.height;
if(isXAxisMarking!==xAxisMarking){isXAxisMarking=xAxisMarking;markingPolygon.setXAxisMarking(xAxisMarking);
}}else{if(startYAxisMarking){var yAxisMarking=x<innerPlotBounds.x+globalMarkableArea.x||x>innerPlotBounds.x+globalMarkableArea.x+innerPlotBounds.width;
if(isYAxisMarking!==yAxisMarking){isYAxisMarking=yAxisMarking;markingPolygon.setYAxisMarking(yAxisMarking);
}}}markingPolygon.updatePolygon(x-globalMarkableArea.x,y-globalMarkableArea.y);}else{if(markingType===Spotfire.Visuals.Marking.Types.CIRCLE){distance=Math.sqrt(Math.pow(markingPolygon.getCircle().x-(x-globalMarkableArea.x),2)+Math.pow(markingPolygon.getCircle().y-(y-globalMarkableArea.y),2));
if(Spotfire.capabilities.supportsTouch()){distance=distance*Math.pow(Touch.getBrowserZoom(),2);}markingPolygon.updatePolygon(x-globalMarkableArea.x,y-globalMarkableArea.y,distance);
}else{distance=11;if(prevPoint){distance=Math.sqrt(Math.pow(prevPoint.x-x,2)+Math.pow(prevPoint.y-y,2));
}if(Spotfire.capabilities.supportsTouch()){distance=distance*Math.pow(Touch.getBrowserZoom(),2);}if(distance>10){markingPolygon.updatePolygon(x-globalMarkableArea.x,y-globalMarkableArea.y);
prevPoint=new Point(x,y);}}}};var onMouseUp=function(e2){if(!abortMarking){var points=markingPolygon.getPoints();
if((markingType===Spotfire.Visuals.Marking.Types.RECTANGLE||markingType===Spotfire.Visuals.Marking.Types.CIRCLE)&&isSingleClick(e2.pageX,e2.pageY)){points=[clickPoint];
}var marking={AltMode:altMarkMode,AlongAxisMarking:isYAxisMarking||isXAxisMarking,Points:points,IsRectangleMarking:markingType===Spotfire.Visuals.Marking.Types.RECTANGLE};
if(isZoom){markCallback("MarkZoom",marking);}else{if((typeof points[0]==="object"&&points[0].hasOwnProperty("length"))){marking.Points=points;
markCallback(plotMarkMode==="Replace"?"MarkReplace":"MarkToggle",marking);}else{switch(plotMarkMode){case"Replace":markCallback("MarkReplace",marking);
break;case"Toggle":markCallback("MarkToggle",marking);break;default:break;}}}}markingPolygon.remove();
};var markImmediately=Spotfire.capabilities.supportsTouch()&&e.type!==undefined&&e.type==="mousedown";
if(markImmediately){onMouseUp();return;}Spotfire.Touch.legacyTouchMouseCapture($trackedElement,onMouseMove,onMouseUp,true);
};});$(function(){Spotfire.registerNameSpace("Overlay");var overlayData={hidden:{},visible:{}};var overlaysToDisplay;
var createdOverlays={};var delayedFunction;var delayTimer=50;var noVisibleOverlays=false;var prioSwitcher=null;
var updateFunction;var updateTimer=1200;var viewId;var switchOverlays=function(overlay1,overlay2){if(createdOverlays[overlay1.documentNodeId]){createdOverlays[overlay1.documentNodeId].remove();
delete createdOverlays[overlay1.documentNodeId];}if(createdOverlays[overlay2.documentNodeId]){createdOverlays[overlay2.documentNodeId].remove();
delete createdOverlays[overlay2.documentNodeId];}$.each(overlaysToDisplay,function(){$.each(this,function(){return $.each(this,function(){if(this.documentNodeId===overlay1.documentNodeId){overlaysToDisplay[overlay2.type][overlay2.prio][0]=overlay2;
return false;}if(this.documentNodeId===overlay2.documentNodeId){overlaysToDisplay[overlay1.type][overlay1.prio][0]=overlay1;
return false;}return true;});});});};var overlayExists=function(overlay){if((overlayData.visible[overlay.documentNodeId]&&overlay.prio!==overlayData.visible[overlay.documentNodeId].prio)||(overlayData.hidden[overlay.documentNodeId]&&overlay.prio!==overlayData.hidden[overlay.documentNodeId].prio)){if(prioSwitcher!==null){switchOverlays(overlay,prioSwitcher);
prioSwitcher=null;}else{prioSwitcher=overlay;}}if(overlayData.visible[overlay.documentNodeId]){if(overlay.visible){overlayData.visible[overlay.documentNodeId]=overlay;
}else{delete overlayData.visible[overlay.documentNodeId];overlayData.hidden[overlay.documentNodeId]=overlay;
}return true;}if(overlayData.hidden[overlay.documentNodeId]){if(overlay.visible){overlayData.visible[overlay.documentNodeId]=overlay;
delete overlayData.hidden[overlay.documentNodeId];}else{overlayData.hidden[overlay.documentNodeId]=overlay;
}return true;}return false;};var deleteCreatedOverlay=function(documentNodeId){if(createdOverlays[documentNodeId]){createdOverlays[documentNodeId].remove();
delete createdOverlays[documentNodeId];if($.isEmptyObject(createdOverlays)){noVisibleOverlays=true;}}};
var hideOverlay=function(documentNodeId){overlayData.hidden[documentNodeId]=overlayData.visible[documentNodeId];
deleteCreatedOverlay(documentNodeId);delete overlayData.visible[documentNodeId];};var hideOverlaysOfType=function(documentNodeId){var type=overlayData.visible[documentNodeId].type;
$.each(overlayData.visible,function(){if(this.type===type){hideOverlay(this.documentNodeId);}});};var deleteOverlay=function(documentNodeId){hideOverlaysOfType(documentNodeId);
delete overlayData.hidden[documentNodeId];};var returnHiddenOverlays=function(){$.each(overlayData.visible,function(){if($(this.selector).length<=0){delete overlayData.visible[this.documentNodeId];
}});$.each(overlayData.hidden,function(){if($(this.selector).length>0){overlayData.visible[this.documentNodeId]=this;
}delete overlayData.hidden[this.documentNodeId];});};var createOverlay=function(overlay){if(viewId&&overlay!==undefined&&overlay!==null){try{if(createdOverlays[overlay.documentNodeId]!==undefined&&createdOverlays[overlay.documentNodeId]!==null){createdOverlays[overlay.documentNodeId].update(overlay,true);
}else{var o=new T.OverlayBubble(overlay);createdOverlays[overlay.documentNodeId]=o;}noVisibleOverlays=false;
}catch(error){if(error.message!=="Hidden tooltip selector!"){deleteOverlay(overlay.documentNodeId);Ajax.enqueueRequest(viewId,"HideOverlay",overlay.type);
}else{if(createdOverlays[overlay.documentNodeId]){createdOverlays[overlay.documentNodeId].remove();delete createdOverlays[overlay.documentNodeId];
}}}}};var createOverlays=function(){var overlay,type,prio;if(overlaysToDisplay===null||overlaysToDisplay===undefined){overlaysToDisplay={};
for(overlay in overlayData.visible){if(overlayData.visible.hasOwnProperty(overlay)){if(!overlaysToDisplay[overlayData.visible[overlay].type]){overlaysToDisplay[overlayData.visible[overlay].type]=[];
overlaysToDisplay[overlayData.visible[overlay].type][overlayData.visible[overlay].prio]=[];overlaysToDisplay[overlayData.visible[overlay].type][overlayData.visible[overlay].prio].push(overlayData.visible[overlay]);
}else{if(!overlaysToDisplay[overlayData.visible[overlay].type][overlayData.visible[overlay].prio]){overlaysToDisplay[overlayData.visible[overlay].type][overlayData.visible[overlay].prio]=[];
overlaysToDisplay[overlayData.visible[overlay].type][overlayData.visible[overlay].prio].push(overlayData.visible[overlay]);
}}}}}for(type in overlaysToDisplay){if(overlaysToDisplay.hasOwnProperty(type)){for(prio=1;prio<=type.length;
prio++){if(overlaysToDisplay[type][prio]){createOverlay(overlayData.visible[overlaysToDisplay[type][prio][0].documentNodeId]);
break;}}}}if($.isEmptyObject(createdOverlays)){noVisibleOverlays=true;}};var removeCreatedOverlays=function(){$.each(createdOverlays,function(){this.remove();
});createdOverlays={};overlaysToDisplay={};};var updateOverlays=function(){if(noVisibleOverlays){return;
}if(delayedFunction){window.clearTimeout(delayedFunction);}delayedFunction=setTimeout(function(){createOverlays();
},delayTimer);if(!updateFunction){updateFunction=setTimeout(function(){updateFunction=null;updateOverlays();
},updateTimer);}};var refreshOverlayPriority=function(){removeCreatedOverlays();overlaysToDisplay=null;
createOverlays();updateOverlays();};var showOverlays=function(){returnHiddenOverlays();refreshOverlayPriority();
};var addOverlay=function(overlay){if(!overlayExists(overlay)){if(overlay.visible){overlayData.visible[overlay.documentNodeId]=overlay;
if(overlay.type==="axis"&&overlay.anchor==="top"&&overlaysToDisplay&&!overlaysToDisplay[overlay.type]){overlaysToDisplay[overlay.type]=[];
overlaysToDisplay[overlay.type][overlay.prio]=[];overlaysToDisplay[overlay.type][overlay.prio].push(overlay);
}}else{overlayData.hidden[overlay.documentNodeId]=overlay;}}this.updateOverlays();};var hidePanelOverlay=function(){if(noVisibleOverlays){return;
}$.each(createdOverlays,function(){if(this.type==="panel"){Ajax.enqueueRequest(viewId,"HideOverlay","panel");
hideOverlaysOfType(this.documentNodeId);updateOverlays();}});};var init=function(documentViewId){viewId=documentViewId;
$(document).on("tibco-bubble-remove",function(e){Ajax.enqueueRequest(viewId,"HideOverlay",e.originalEvent.detail.type);
hideOverlaysOfType(e.originalEvent.detail.documentNodeId);});$(document).on("onDropDownOpen",function(e,id){if(noVisibleOverlays){return;
}if(overlayData.visible[id]!==undefined&&overlayData.visible[id]!==null){Ajax.enqueueRequest(viewId,"HideOverlay",overlayData.visible[id].type);
hideOverlaysOfType(id);updateOverlays();}});$(document).on("onShowAxisSelector",function(e,selector){if(noVisibleOverlays){return;
}$.each(createdOverlays,function(){if(this.selector===selector){Ajax.enqueueRequest(viewId,"HideOverlay",this.type);
hideOverlaysOfType(this.documentNodeId);updateOverlays();}});});$(document).on("sf-onShowPoppedFilter",function(){hidePanelOverlay();
});$(document).on("sf-onListBoxDragStart",function(){hidePanelOverlay();});$(document).on("sf-onShowRecommendationsDialog",function(){removeCreatedOverlays();
});$(document).on("sf-onCloseRecommendationsDialog",function(){refreshOverlayPriority();});};Spotfire.Overlay.removeCreatedOverlays=removeCreatedOverlays;
Spotfire.Overlay.updateOverlays=updateOverlays;Spotfire.Overlay.showOverlays=showOverlays;Spotfire.Overlay.refreshOverlayPriority=refreshOverlayPriority;
Spotfire.Overlay.addOverlay=addOverlay;Spotfire.Overlay.init=init;});$(function(){Spotfire.registerNameSpace("PageLayout");
var page;var Panel=function(id,bounds){this.id=id;var swapZone=new Rectangle(bounds);this.bounds=bounds;
var isWideEnough=bounds.width>page.panelMinSize;var isHighEnough=bounds.height>page.panelMinSize;swapZone.inflate(Math.round(-bounds.width/3),Math.round(-bounds.height/3));
if(!isWideEnough){swapZone.width=bounds.width;swapZone.x=bounds.x;}if(!isHighEnough){swapZone.height=bounds.height;
swapZone.y=bounds.y;}var pointInsideTriangle=function(p,a,b,c){var sign=function(p1,p2,p3){return(p1.x-p3.x)*(p2.y-p3.y)-(p2.x-p3.x)*(p1.y-p3.y);
};var b1=sign(p,a,b)<0;var b2=sign(p,b,c)<0;var b3=sign(p,c,a)<0;return((b1===b2)&&(b2===b3));};this.isInSwapZone=function(point){return swapZone.containsPoint(point.x,point.y);
};var getSide=function(windowPoint){var point=new Point(windowPoint.x-bounds.x,windowPoint.y-bounds.y);
var center=new Point(bounds.width/2,bounds.height/2);var leftTop=new Point(0,0);var leftBottom=new Point(0,bounds.height);
var rightTop=new Point(bounds.width,0);var rightBottom=new Point(bounds.width,bounds.height);if(isWideEnough&&isHighEnough){if(pointInsideTriangle(point,center,leftTop,leftBottom)){return"left";
}if(pointInsideTriangle(point,center,leftTop,rightTop)){return"top";}if(pointInsideTriangle(point,center,rightTop,rightBottom)){return"right";
}return"bottom";}if(isWideEnough){if(point.x<center.x){return"left";}return"right";}if(isHighEnough){if(point.y<center.y){return"top";
}return"bottom";}return"top";};this.getDropZone=function(point){var side=getSide(point);return bounds.getHalf(side);
};this.getSide=getSide;};var Page=function(visualPageWebControlId,panelIdList,layout,panelMinimumSize){var getPanel=function(point){var panel=null;
var i,rect,rectangle;for(i=0;i<layout.length;i++){rect=layout[i];rectangle=new Rectangle(rect.x,rect.y,rect.width,rect.height);
if(rectangle.containsPoint(point.x,point.y)){panel=new Panel(panelIdList[i],rectangle);break;}}return panel;
};var containsPanel=function(panelId){return _.contains(panelIdList,panelId);};this.id=visualPageWebControlId;
this.panelMinSize=panelMinimumSize;this.getPanel=getPanel;this.isEmpty=layout.length===0;var $page=$("#"+this.id);
this.bounds=new Rectangle(0,0,$page.outerWidth(),$page.outerHeight());this.containsPanel=containsPanel;
};Spotfire.PageLayout.init=function(visualPageWebControlId,panelIdList,layout,panelMinimumSize){page=new Page(visualPageWebControlId,panelIdList,layout,panelMinimumSize);
};Spotfire.PageLayout.initSize=function(visualPageWebControlId,settings){var $page=$("#"+visualPageWebControlId);
$page.css({"overflow-x":settings.horizontalScrollBar?"scroll":"hidden","overflow-y":settings.verticalScrollBar?"scroll":"hidden"});
};Spotfire.PageLayout.onPageChanged=function(){Spotfire.PopoverPanel.close();Spotfire.FloatingWindow.hide();
$(document.body).trigger("mousedown.poppedFilter");};var dropHandler=function(evt,data,$indicator){var pageElement=$("#"+page.id);
var getPointFromEvent=function(event){var offset=pageElement.offset();return new Point(event.pageX-offset.left+pageElement.scrollLeft(),event.pageY-offset.top+pageElement.scrollTop());
};var dropzoneIndicator=new Spotfire.PageLayout.DropZoneIndicator($indicator);var showDropzoneIndicator=function(point,duplicate){if(page.isEmpty){dropzoneIndicator.update(page.bounds);
return;}var panel=page.getPanel(point);if(!panel||(panel.id===data.visualId&&!duplicate)){dropzoneIndicator.close();
return;}var bounds;if(!duplicate&&page.containsPanel(data.visualId)&&panel.isInSwapZone(point)){bounds=panel.bounds;
}else{bounds=panel.getDropZone(point);}dropzoneIndicator.update(bounds.round());};return{onDrop:function(e){var callbackId=page.id;
var visualId=data.visualId;var isExternalBookmark=Spotfire.DragDrop.isExternalBookmark(data);var duplicateVisualization=data.canBeDuplicated&&e.modifierKeys.control;
if(page.isEmpty){if(isExternalBookmark){Ajax.enqueueRequest(callbackId,"InsertBookmark",{bookmarkUri:data.bookmarkUri});
}else{Ajax.enqueueRequest(callbackId,"MovePanels",{sourceId:visualId,duplicate:duplicateVisualization});
}return;}var point=getPointFromEvent(e);var panel=page.getPanel(point);if(panel===undefined||panel===null){return;
}var targetId=panel.id;var side=panel.getSide(point);if(isExternalBookmark){Ajax.enqueueRequest(callbackId,"InsertBookmark",{bookmarkUri:data.bookmarkUri,targetId:targetId,side:side});
return;}if(!duplicateVisualization&&targetId===visualId){return;}if(!duplicateVisualization&&page.containsPanel(visualId)&&panel.isInSwapZone(point)){Ajax.enqueueRequest(callbackId,"SwapPanels",{sourceId:visualId,targetId:targetId});
}else{Ajax.enqueueRequest(callbackId,"MovePanels",{sourceId:visualId,targetId:targetId,side:side,duplicate:duplicateVisualization});
}},onDragOver:function(e){var duplicate=e.modifierKeys.control&&data.canBeDuplicated;e.originalEvent.dataTransfer.dropEffect=duplicate?"copy":"move";
showDropzoneIndicator(getPointFromEvent(e),duplicate);}};};var supportsData=function(data){return data.containsVisual!==undefined&&data.containsVisual;
};var dragDropCallbackId;Spotfire.PageLayout.initDragDrop=function(id){dragDropCallbackId=id;var $item=$("#"+id);
Spotfire.DragDrop.makeDroppableWithOverlay($item,supportsData,dropHandler,true,{width:$item.get(0).scrollWidth,height:$item.get(0).scrollHeight});
};Spotfire.PageLayout.initializeHeader=function(id,visualId,canBeDuplicated){var $header=$("#"+id);if(Spotfire.isAuthorMode()){$header.css("cursor","move");
Spotfire.DragDrop.makeDraggable($header,{effectAllowed:canBeDuplicated?"copyMove":"move",populateData:function(data){data.containsVisual=true;
data.visualId=visualId;data.canBeDuplicated=canBeDuplicated;Spotfire.DragDrop.populateBookmarkData(data,dragDropCallbackId,visualId);
}});}if(!Spotfire.capabilities.supportsTouch()){var findRightButtonGroup=function(){var $buttonGroup=$(".sf-element-button-group.sfpc-right",$header);
if($buttonGroup.length===0){throw"Expected one .sf-element-button-group.sfpc-right";}return $buttonGroup;
};var findLeftButtonGroup=function(){var $buttonGroup=$(".sf-element-button-group.sfpc-left",$header);
return $buttonGroup;};$header.hover(function(e){var $leftButtonGroup=findLeftButtonGroup();var $rightButtonGroup=findRightButtonGroup();
var leftEdgeOfRightButtonGroup=$rightButtonGroup.sfBoxOffset().left;var rightButtonGroupCoversLeftButtonGroup=false;
var isMouseOverishLeftButtonGroup=false;if($leftButtonGroup.length>0){var leftEdgeOfLeftButtonGroup=$leftButtonGroup.sfBoxOffset().left;
var rightEdgeOfleftButtonGroup=leftEdgeOfLeftButtonGroup+$leftButtonGroup.sfBoxWidth();rightButtonGroupCoversLeftButtonGroup=rightEdgeOfleftButtonGroup>leftEdgeOfRightButtonGroup;
var margin=15;isMouseOverishLeftButtonGroup=e.pageX>=(leftEdgeOfLeftButtonGroup-margin)&&e.pageX<=(rightEdgeOfleftButtonGroup+margin);
}if(isMouseOverishLeftButtonGroup&&rightButtonGroupCoversLeftButtonGroup){$rightButtonGroup.css("visibility","hidden");
return;}$rightButtonGroup.css("visibility","visible");var isMouseOverRightButtonGroup=e.pageX>=leftEdgeOfRightButtonGroup;
if(isMouseOverRightButtonGroup){Spotfire.Controls.ButtonGroup.showFast($rightButtonGroup);}else{Spotfire.Controls.ButtonGroup.show($rightButtonGroup);
}},function(){Spotfire.Controls.ButtonGroup.tryHide(findRightButtonGroup());});}};Spotfire.PageLayout.updatePanel=function(id,active){var $panel=$("#"+id);
if($panel.attr("activated")===undefined){$panel.on("mousedown",function(){if($panel.attr("activated")==="no"){Ajax.enqueueRequest(id,"SetActive","");
}});if(Spotfire.capabilities.supportsTouch()&&$panel.length>0){$panel.get(0).style.webkitTapHighlightColor="rgba(0,0,0,0)";
}}$panel.attr("activated",active?"yes":"no");if(active){$panel.addClass("sfpc-active");}else{$panel.removeClass("sfpc-active");
}};Spotfire.PageLayout.initScroll=function(id){$("#"+id).on("scroll",function(){Spotfire.PageBus.publish("spotfire.visuals.page.scroll",{x:$(this).scrollLeft(),y:$(this).scrollTop()});
});};Spotfire.PageLayout.initLastSiblingsContainer=function(id){var $orderedLastSiblingsContainer=$("<div></div>").attr("id",id+"_last-siblings-container");
$orderedLastSiblingsContainer.append($("<div></div>").attr("id",id+"_splitterContainer"));$orderedLastSiblingsContainer.append($("<div></div>").addClass("sf-annotations-container"));
$orderedLastSiblingsContainer.append($("<div></div>").addClass("sf-comments-container"));$("#"+id).append($orderedLastSiblingsContainer);
};Spotfire.PageLayout.updateLastSiblingsContainer=function(id){_.defer(function(){$("#"+id).append($("#"+id+"_last-siblings-container"));
});};});$(function(){Spotfire.registerNameSpace("Controls.PanelButton");Spotfire.Controls.PanelButton.initialize=function(selector,tooltip,svgUrl,onClick,pushedDown,text){var $button=$(selector);
$button.empty();$button.addClass("sf-element sf-element-button");if(pushedDown===true){$button.addClass("sfpc-active");
}$button.css({cursor:"pointer"});$button.attr("draggable","false");if(svgUrl!==null&&svgUrl!==undefined){Spotfire.getSvg(svgUrl,function($svg){$button.empty();
$button.append($svg);if(text){var paddingRight=3;$svg.css({width:"14px","padding-top":"2px","padding-right":paddingRight+"px"});
var $textDiv=$("<div></div>").addClass("PanelButtonTextIconText").css({"font-size":"14px"}).text(text);
$button.append($textDiv);$button.width($svg.width()+paddingRight+$textDiv.width());}});}else{if(text!==null&&text!==undefined){$button.text(text);
}else{var $imagediv=$("<div/>").addClass("PanelButtonImage");$button.append($imagediv);}}if(tooltip){$button.attr("title",tooltip);
}var mouseup=function(){if(pushedDown!==true){$button.removeClass("sfpc-active");}$(document.body).off("mouseup",mouseup);
};var mousedown=function(){if(!$button.hasClass("disabled")){if(pushedDown!==true){$button.addClass("sfpc-active");
}$(document.body).on("mouseup",mouseup);}};$button.on("mousedown",mousedown);if(onClick){$button.on("click",onClick);
}};Spotfire.Controls.PanelButton.onClick=function(id){var offset=$("#"+id).sfBoxOffset();var args={offset:new Point(offset.left,offset.top)};
Ajax.enqueueRequest(id,"click",args);};});$(function(){Spotfire.registerNameSpace("PanelLayout");var layout;
Spotfire.PanelLayout.init=function(panelLayout){if(Spotfire.capabilities.supportsTouch()){return;}var initDragDrop=layout===undefined;
layout=panelLayout;if(!initDragDrop){return;}var dropHandler=function(evt,data,$indicator){var dropzoneIndicator=new Spotfire.PageLayout.DropZoneIndicator($indicator);
var hiddenPanelAreas=[];var first=function(arr,predicate){var result;arr.every(function(item){if(predicate(item)){result=item;
return false;}return true;});return result;};var getHiddenArea=function(x,y){return first(hiddenPanelAreas,function(area){return area.bounds.containsPoint(x,y);
});};var getHitPanelInfo=function(x,y){var hitPanel=first(layout.panels,function(panel){return panel.bounds.containsPoint(x,y);
});var dropZoneBounds;var insertBefore;var bounds;if(hitPanel){bounds=hitPanel.bounds;if(hitPanel.region==="bottom"){insertBefore=x<bounds.centerX();
dropZoneBounds=bounds.getHalf(insertBefore?"left":"right").round();}else{insertBefore=y<bounds.centerY();
dropZoneBounds=bounds.getHalf(insertBefore?"top":"bottom").round();}return{panel:hitPanel,dropZoneBounds:dropZoneBounds,insertBefore:insertBefore};
}};var onDrop=function(e){var event=e.originalEvent;dropzoneIndicator.close();var draggedPagelId=data.pageId;
if(draggedPagelId!==layout.pageId){return;}var draggedPanelId=data.panelId;var args;var hitPanel=getHitPanelInfo(event.clientX,event.clientY);
if(hitPanel){args={panelId:draggedPanelId,targetRegion:hitPanel.panel.region,targetPanelId:hitPanel.panel.panelId,insertBefore:hitPanel.insertBefore};
Ajax.enqueueRequest(layout.pageControlId,"MovePanel",JSON.stringify(args));return;}var hitArea=getHiddenArea(event.clientX,event.clientY);
if(hitArea){args={panelId:draggedPanelId,targetRegion:hitArea.region};Ajax.enqueueRequest(layout.pageControlId,"MovePanel",JSON.stringify(args));
return;}};var onDragOver=function(e){if(layout.pageId!==data.pageId){dropzoneIndicator.close();return;
}var event=e.originalEvent;var draggedPanelId=data.panelId;var dropZoneBounds;var hitArea;var hitPanel=getHitPanelInfo(event.clientX,event.clientY);
if(hitPanel&&hitPanel.panel.panelId!==draggedPanelId){dropZoneBounds=hitPanel.dropZoneBounds;}else{hitArea=getHiddenArea(event.clientX,event.clientY);
if(hitArea){dropZoneBounds=hitArea.bounds;}}dropzoneIndicator.update(dropZoneBounds);};var getBounds=function($div){var offset=$div.offset();
var width=$div.outerWidth();var height=$div.outerHeight();return new Rectangle(offset.left,offset.top,width,height);
};layout.panels.forEach(function(panel){panel.bounds=getBounds($("#"+panel.controlId));});var visAreaBounds=getBounds($("#"+layout.visualPageControlId));
if(layout.leftAreaSpan){hiddenPanelAreas.push({region:"left",bounds:new Rectangle(visAreaBounds.x,visAreaBounds.y,layout.leftAreaSpan,visAreaBounds.height)});
}if(layout.bottomAreaSpan){hiddenPanelAreas.push({region:"bottom",bounds:new Rectangle(visAreaBounds.x,visAreaBounds.bottom()-layout.bottomAreaSpan,visAreaBounds.width,layout.bottomAreaSpan)});
}if(layout.rightAreaSpan){hiddenPanelAreas.push({region:"right",bounds:new Rectangle(visAreaBounds.right()-layout.rightAreaSpan,visAreaBounds.y,layout.rightAreaSpan,visAreaBounds.height)});
}return{onDragOver:onDragOver,onDrop:onDrop};};var supportsData=function(data){if(data.panelId){return true;
}return false;};Spotfire.DragDrop.makeDroppableWithOverlay($("body"),supportsData,dropHandler,true);};
Spotfire.PanelLayout.initializePanelHeader=function(headerId,panelId,pageId){var $header=$("#"+headerId);
if(Spotfire.isAuthorMode()){$header.css("cursor","move");Spotfire.DragDrop.makeDraggable($header,{effectAllowed:"move",populateData:function(data){data.panelId=panelId;
data.pageId=pageId;}});}};});$(function(){Spotfire.registerNameSpace("Picker");var $container;var lastSetResult;
var colorMru=[];var updateColorMru=function(){if(lastSetResult){var mruMaxLength=20;var colorRgb=lastSetResult.toRgbString();
colorMru=_.first([colorRgb].concat(_.without(colorMru,colorRgb)),mruMaxLength);}lastSetResult=undefined;
};Spotfire.Picker.close=function(e){var $oldpicker=$(".spectrumpicker");$oldpicker.each(function(){if(!e||!$(this).data("parent").is(e.target)){$(this).spectrum("destroy");
$(this).remove();$(document).unbind("mousedown",Spotfire.Picker.onBodyMouseDown);$(document).unbind("keyup",Spotfire.Picker.onKeyUp);
_.defer(updateColorMru);}});};Spotfire.Picker.onKeyUp=function(e){if(e.keyCode===27){Spotfire.Picker.close();
}};Spotfire.Picker.onBodyMouseDown=function(e){if($(".sp-container").has(e.target).length===0){Spotfire.Picker.close(e);
}};Spotfire.Picker.show=function(data,$offsetelement,type,callback){var makeSafeId=function(data){var str="picker_"+(data.id!==undefined?data.id:data.key);
return str.replace(/[^\w]/gi,"_");};var openNewPicker=$("#"+makeSafeId(data)).length===0;Spotfire.Picker.close();
if(!openNewPicker){return;}var moveIntoViewport=function($el){var winWidth=$(window).width();var winHeight=$(window).height();
if($el.offset().left+$el.width()>=winWidth){$el.css("left",winWidth-$container.width()-10);}if($el.offset().top+$el.height()>=winHeight){$el.css("top",winHeight-$el.height()-10);
}};var left=$offsetelement.offset().left;if(data.left!==undefined){left+=data.left;}var top=$offsetelement.offset().top;
if(data.top!==undefined){top+=data.top;}if(data.height!==undefined){top+=data.height;}else{top+=$offsetelement.height();
}var $picker=$("<input/>").attr("id",makeSafeId(data)).addClass("spectrumpicker");$(document.body).append($picker);
var palette=[];var paletterow=[];var col=0;var row=0;if(data.series){var showAsBarsRow=[];showAsBarsRow[0]="rgb(255,255,255)|Bar|Images/Legend/CombinationChartBar.png|"+Spotfire.Localization.resources.ShowSerieAsBar;
var showAsLineRow=[];showAsLineRow[0]="rgb(255,255,255)|Line|Images/Legend/CombinationChartLine.png|"+Spotfire.Localization.resources.ShowSerieAsLine;
palette[row++]=showAsBarsRow;palette[row++]=showAsLineRow;}var columns=Math.ceil(Math.sqrt(data.palette.length));
var i;for(i=0;i<data.palette.length;i++){paletterow[col++]=data.palette[i].color+"|"+(data.palette[i].id!==undefined?data.palette[i].id:"")+"|"+(data.palette[i].image!==undefined?data.palette[i].image:"")+"|"+(data.palette[i].id!==undefined&&Spotfire.Localization.resources[data.palette[i].id]!==undefined?Spotfire.Localization.resources[data.palette[i].id]:"");
if(((i+1)%columns)===0){palette[row++]=paletterow;paletterow=[];col=0;}}if(paletterow.length>0){palette[row++]=paletterow;
}if(data.useColorMru&&colorMru.length>0){palette[row++]=_.first(colorMru,columns);}$picker.data("parent",$offsetelement);
$picker.spectrum({flat:true,color:data.current,showButtons:false,cancel:Spotfire.Picker.close,showPalette:true,showInput:true,showMoreColorsButton:type==="ColorPicker",className:type,palette:palette,dragstopFiresChanges:true,maxSelectionSize:1,change:function(result,close){if(close){Spotfire.Picker.close();
}lastSetResult=result;callback(result);}});$container=$picker.spectrum("container");$container.css("position","absolute").css("top",Math.round(top)).css("left",Math.round(left));
$(document).bind("mousedown",Spotfire.Picker.onBodyMouseDown);$(document).bind("keyup",Spotfire.Picker.onKeyUp);
moveIntoViewport($container);$container.change(function(){moveIntoViewport($container);});};Spotfire.Picker.createColorPicker=function($element){var currentColor="rgb(0, 0, 0)";
var onChange=$.noop;$element.click(function(){var top=$element.height()/2;var colorInfo={palette:Spotfire.Colors.ColorPalette,current:currentColor,useColorMru:true,top:top};
Spotfire.Picker.show(colorInfo,$element,"ColorPicker",function(result){var color=result.toRgbString();
setColor(color);});});var setColor=function(color){currentColor=color;$element.css({"background-color":color});
onChange(color);};var instance={value:function(val){if(val===undefined){return currentColor;}setColor(val);
return instance;},onChange:function(callback){onChange=callback;return instance;}};return instance;};
});$(function(){Spotfire.registerNameSpace("Visuals.PlotInteraction");Spotfire.Visuals.PlotInteraction.showPropertiesPopover=function(id,clickPoint,showPoint,args){var $popover=$("<div/>");
var offset=$("#"+id).offset();args.x=showPoint.x+offset.left;args.y=showPoint.y+offset.top;args.arrowAlignment="Center";
args.dialogType=Spotfire.Visuals.Popout.DialogType.StyledDialog;var callback=function(name,value,checked){Spotfire.Dxp.Web.Forms.AjaxService.Modify(id,"PlotInteractionCallback",{x:clickPoint.x,y:clickPoint.y,property:name,active:checked,value:value});
};if(args.alignment==="Top"){args.alignment=["Top","Bottom"];}else{if(args.alignment==="Bottom"){args.alignment=["Bottom","Top"];
}else{if(args.alignment==="Left"){args.alignment=["Left","Right"];}else{if(args.alignment==="Right"){args.alignment=["Right","Left"];
}}}}var showFormsPropertyPage=function(path){Spotfire.PageBus.publish("spotfire.visuals.gotopropertypage",{viewId:id,path:path});
};var builder=Spotfire.Visuals.ContextualPopout.builder(id,args,$popover,callback);builder.beginSection().beginRow(true).addRadioButton("stackMode","Stack",{text:Spotfire.Localization.resources.PlotInteraction_StackedBars}).endRow().beginRow(true).addRadioButton("stackMode","None",{text:Spotfire.Localization.resources.PlotInteraction_SideBySideBars}).endRow().beginRow(true).addRadioButton("stackMode","Stack100Percent",{text:Spotfire.Localization.resources.PlotInteraction_StackedBarsFull}).endRow().endSection();
builder.beginSection().beginRow(true).addRadioButton("stackModeCC","Stack",{text:Spotfire.Localization.resources.PlotInteraction_StackedBars}).endRow().beginRow(true).addRadioButton("stackModeCC","None",{text:Spotfire.Localization.resources.PlotInteraction_SideBySideBars}).endRow().endSection();
builder.beginSection().beginRow(false).addHeading(Spotfire.Localization.resources.PlotInteraction_OrientationHeader,"PlotInteraction_Orientation",args.orientation).addRadioButton("orientation","Vertical",{text:Spotfire.Localization.resources.PlotInteraction_OrientationVertical,compactMode:true}).addRadioButton("orientation","Horizontal",{text:Spotfire.Localization.resources.PlotInteraction_OrientationHorizontal,compactMode:true}).endRow().endSection();
builder.beginSection().beginRow(true).addCheckBox("showGridlinesHorizontal",Spotfire.Localization.resources.PlotInteraction_ShowGridlines).addCheckBox("showGridlinesVertical",Spotfire.Localization.resources.PlotInteraction_ShowGridlines).endRow().endSection();
builder.beginSection().beginRow(true).addCheckBox("labelVisibilityShowAll",Spotfire.Localization.resources.PlotInteraction_ShowBarLables).endRow().endSection();
builder.beginSection().beginRow(true).addCheckBox("labelVisibilityShowAllBarsAndBlocks",Spotfire.Localization.resources.PlotInteraction_ShowBarsAndBlocksLables,args).endRow().endSection();
builder.beginSection().beginRow(true).addCheckBox("showMarkerLabels",Spotfire.Localization.resources.PlotInteraction_ShowMarkerLabels).endRow().endSection();
builder.beginSection().beginRow(true).addCheckBox("showMarkers",Spotfire.Localization.resources.PlotInteraction_ShowMarkers).endRow().endSection();
builder.beginSection().beginRow(true).addCheckBox("sortedBars",Spotfire.Localization.resources.PlotInteraction_SortedBars).endRow().endSection();
builder.beginSection().beginRow(true).addCheckBox("reversed",Spotfire.Localization.resources.PlotInteraction_Reversed).endRow().endSection();
builder.beginSection().beginRow(false).addNullableField("showTopX",Spotfire.Localization.resources.PlotInteraction_ShowTopX,false).endRow().endSection();
builder.beginSection().beginRow(true).addNullableField("showReferenceLine",Spotfire.Localization.resources.PlotInteraction_ShowReferenceLine,false).endRow().endSection();
builder.beginSection().beginRow(true).addSlider("xJitter",Spotfire.Localization.resources.PlotInteraction_XJitter,0,0.5).endRow().endSection();
builder.beginSection().beginRow(true).addSlider("yJitter",Spotfire.Localization.resources.PlotInteraction_YJitter,0,0.5).endRow().endSection();
builder.beginSection().beginRow(true).addSlider("markerSize",Spotfire.Localization.resources.PlotInteraction_MarkerSize,0,30).endRow().endSection();
builder.beginSection().beginRow(false).addHeading(Spotfire.Localization.resources.PlotInteraction_Formatting,"FormattingControl_",args.formatting?args.formatting.text:null).addFormatting("formatting").addButton("showFormattingSettings",Spotfire.Localization.resources.PlotInteraction_FormattingSettings,Spotfire.isProfessional()?function(){showFormsPropertyPage(Spotfire.Localization.resources.PropertiesPopout_Formatting);
}:null).endRow().endSection();builder.beginSection().beginRow(true).addButton("showColumnSelector",Spotfire.Localization.resources.PlotInteraction_ShowColumnSelector,function(){if(Spotfire.isProfessional()){showFormsPropertyPage("Columns");
}else{Spotfire.Visual.SelectColumnsDialog.show(args.selectColumnsSetting);}}).endRow().endSection();if($popover.children().last().hasClass("delimiter")){$popover.children().last().remove();
}if($popover.children().length>0){Spotfire.Visuals.ContextualPopout.showPropertiesPopover(id,args,$popover);
}};});$(function(){Spotfire.registerNameSpace("Visuals.Popout");function moveIntoViewport($el,padding,alignment){padding=padding||10;
var winWidth=$(window).width();var winHeight=$(window).height();if(!alignment||(alignment==="Bottom"||alignment==="Top")){if($el.offset().left+$el.width()>=winWidth-padding){$el.css("left",winWidth-$el.width()-padding);
}if($el.offset().left<padding){$el.css("left",padding);}}if(!alignment||(alignment==="Left"||alignment==="Right")){if($el.offset().top+$el.height()>=winHeight-padding){$el.css("top",winHeight-$el.height()-padding);
}if($el.offset().top<padding){$el.css("top",padding);}}}function canFitInWindow($el,padding){padding=padding||10;
var winWidth=$(window).width();var winHeight=$(window).height();if($el.width()>winWidth-padding){return false;
}if($el.height()>winHeight-padding){return false;}return true;}function inView($el,padding){padding=padding||10;
var winWidth=$(window).width();var winHeight=$(window).height();if($el.offset().left+$el.width()>winWidth-padding){return false;
}if($el.offset().left<padding){return false;}if($el.offset().top+$el.height()>winHeight-padding){return false;
}if($el.offset().top<padding){return false;}return true;}function getMiddlePoint(alignment,measurements){switch(alignment){case"Left":return{x:measurements.x+measurements.width,y:measurements.y+measurements.height/2};
case"Right":return{x:measurements.x,y:measurements.y+measurements.height/2};case"Top":return{x:measurements.x+measurements.width/2,y:measurements.y+measurements.height};
default:return{x:measurements.x+measurements.width/2,y:measurements.y};}}function getArrowPosition(alignment,pos){switch(alignment){case"Left":return{numberValue:1,x:pos.x,y:pos.y-10};
case"Right":return{numberValue:2,x:pos.x-9,y:pos.y-10};case"Top":return{numberValue:0,x:pos.x-12,y:pos.y};
default:return{numberValue:3,x:pos.x-12,y:pos.y-10};}}function getContainerPosition(alignment,pos,container,arrowAlignment){var divider=4;
if(arrowAlignment==="Center"){divider=2;}switch(alignment){case"Left":return{x:pos.x+11,y:pos.y-container.height/divider};
case"Right":return{x:pos.x-container.width-12,y:pos.y-container.height/divider};case"Top":return{x:pos.x-container.width/2,y:pos.y+11};
default:return{x:pos.x-container.width/2,y:pos.y-container.height-9};}}function positionPopover($body,$container,$content,$arrowContainer,args){var positionAgainst;
var alignment;var pos;var containerPosition;var arrowPosition;var alignmentsCopy=[].concat(args.alignment);
do{alignment=alignmentsCopy.shift();if(args.rectangle){pos=getMiddlePoint(alignment,{x:args.rectangle.x,y:args.rectangle.y,width:args.rectangle.width,height:args.rectangle.height});
}else{if(args.anchor){if(!args.anchor.is(":visible")){throw"The anchor is not visible.";}pos=getMiddlePoint(alignment,{x:args.anchor.offset().left,y:args.anchor.offset().top,width:args.anchor.outerWidth(),height:args.anchor.outerHeight()});
}else{if(args.hasSpecialPositioning!==undefined&&args.hasSpecialPositioning()){pos=args.doSpecialPositioning(alignment);
}else{pos={x:args.x,y:args.y};}}}positionAgainst={width:args.dialogType===Spotfire.Visuals.Popout.DialogType.ModalDialog?$body.outerWidth():$content.outerWidth(),height:$container.outerHeight()};
if(args.useForPositioning){positionAgainst={width:args.dialogType===Spotfire.Visuals.Popout.DialogType.ModalDialog?$body.outerWidth():$content.outerWidth(),height:args.useForPositioning.outerHeight()};
}containerPosition=getContainerPosition(alignment,pos,positionAgainst,args.arrowAlignment);if(args.verticalOffsetPositionFromArrow){containerPosition.y=pos.y-args.verticalOffsetPositionFromArrow;
}arrowPosition=getArrowPosition(alignment,pos);$arrowContainer.css({top:arrowPosition.y+"px",left:arrowPosition.x+"px"});
if(args.dialogType===Spotfire.Visuals.Popout.DialogType.StyledDialog){$container.css("width",Math.ceil($container[0].getBoundingClientRect().width));
}$container.css({left:containerPosition.x+"px",top:containerPosition.y+"px"});moveIntoViewport($container,3,alignment);
}while(canFitInWindow($container,3)&&!inView($container,3)&&alignmentsCopy.length>0);if(inView($container,3)){Spotfire.Filters.StyledFilters.createSvgArrow($arrowContainer,arrowPosition.numberValue,"sf-element sf-element-svg-element sfc-arrow-border");
if(args.dialogType===Spotfire.Visuals.Popout.DialogType.ModalDialog){$arrowContainer.find(".sfc-arrow-border").attr("stroke",$(".sf-element-modal-dialog").css("border-left-color"));
}}else{moveIntoViewport($container,3);}}function showPopout(id,args,$content){var $dialog;var $body=null;
var $container;var $arrowContainer;var $previousFocus=$(document.activeElement);var initiateStyledDialog=function(){$dialog=$("<div/>").addClass("sf-element-styled-dialog");
$container=$("<div/>").addClass("sf-element-contextual-popout").data("id",id);$arrowContainer=$("<div/>").addClass("sf-element-contextual-popout-arrow");
};var initiateModalDialog=function(){$dialog=$("<div/>");$body=$("<div/>").addClass("sf-element-modal-dialog-body");
$container=$("<div/>").addClass("sf-element-modal-dialog sfc-popout sf-popout-dialog").data("id",id);
$arrowContainer=$("<div/>").addClass("sf-popout-arrow");};if(args.dialogType===Spotfire.Visuals.Popout.DialogType.StyledDialog){initiateStyledDialog();
}else{if(args.dialogType===Spotfire.Visuals.Popout.DialogType.ModalDialog){initiateModalDialog();}else{initiateStyledDialog();
}}var closePopover;var updatePopover;var onMouseDown;var esc;if(Spotfire.capabilities.supportsDropShadow()){$container.addClass("RoundedDropShadow");
}onMouseDown=function(e){var $parent=$(e.target);while(true){if($parent.length===0){break;}if($parent.is($container)){return true;
}$parent=$parent.parent();}closePopover();return true;};esc=function(e){if(e.which===Keys.ESCAPE){closePopover();
e.stopPropagation();}};closePopover=function(){if(args.beforeClose){args.beforeClose();}$container.remove();
$arrowContainer.remove();$dialog.remove();$(document.body).off("keydown.popout",esc);$(document.body).unbind("sf-touchmousedown",onMouseDown);
$(window).off("resize",closePopover);Spotfire.MultipleViews.OffRemoteFocus(closePopover);if($previousFocus.is(":visible")){$previousFocus.focus();
}};Spotfire.MultipleViews.OnRemoteFocus(closePopover);if($body!==null){$body.append($content);$container.append($body);
}else{$container.append($content);}if($container.children().last().hasClass("delimiter")){$container.children().last().remove();
}$dialog.append($container);$dialog.append($arrowContainer);$(document.body).append($dialog);if(args.dialogType===Spotfire.Visuals.Popout.DialogType.ModalDialog){$arrowContainer.css("color",$container.css("background-color"));
}if(args.runAfterDomAdded){args.runAfterDomAdded();}updatePopover=function(){positionPopover($body,$container,$content,$arrowContainer,args);
};updatePopover();$container.on("close",closePopover);$(document.body).on("sf-touchmousedown",onMouseDown);
$(document.body).one("sf-touchhold",closePopover);$(window).on("resize",closePopover);Spotfire.Focus.handleKeyDown($container,esc);
Spotfire.Focus.setFocus($container);Spotfire.Prompt.suppressFormsAcceptCommandIfFocused($container);return{update:updatePopover,close:closePopover};
}Spotfire.Visuals.Popout.DialogType={ModalDialog:"modal-dialog",StyledDialog:"styled-dialog"};Spotfire.Visuals.Popout.showPopout=showPopout;
});$(function(){var popupPanels={};var currentInstance=null;var close=function(){if(currentInstance!==null){currentInstance.close();
}};var show=function(typeId,left,top){if(typeof left!=="number"||typeof top!=="number"){left=Spotfire.Cursor.getX();
top=Spotfire.Cursor.getY();}var panel=popupPanels[typeId];if(panel!==undefined&&panel!==null){panel.show(left,top);
}};var initialize=function(typeId,callbackId,displayName,initFunc){var $popup=$("<div/>").addClass("PopoverPanel sf-element-panel-area sfpc-floating");
if(Spotfire.capabilities.supportsDropShadow()){$popup.addClass("RoundedDropShadow");}var $panel=$("<div/>").addClass("sf-element sf-element-panel");
var $header=$("<div/>").addClass("sf-element sf-element-panel-header");var $title=$("<span/>").addClass("Title").text(displayName);
var $buttonGroup=$("<div/>").addClass("sf-element sf-element-button-group");var $dockButton=$("<div/>").addClass("sf-element sf-element-button");
var $closeButton=$("<div/>").addClass("sf-element sf-element-button");var $canvas=$("<div/>").addClass("Canvas sf-element sf-element-panel-content");
$buttonGroup.append($closeButton);$buttonGroup.append($dockButton);$header.append($title);$header.append($buttonGroup);
$panel.append($header);$panel.append($canvas);$popup.append($panel);var closePopup=null;var onBodyMouseDown=function(event){var keepOpenTargets=[".PopoverPanel",".contextMenu",".DatePicker",".ColorPicker",".ShapePicker",".AxisTrayPopout",".AxisExpressionPopout",".PoppedFilter",".ui-resizable-helper"].join(", ");
var target=$(event.target);while(true){if(target.length===0||target.is(document.body)){break;}if(target.is(keepOpenTargets)){return;
}target=target.parent();}closePopup();};var dockPanel=function(){Ajax.enqueueRequest(callbackId,"DockPanel",typeId);
closePopup();};var onDocumentKeyDown=function(event){if(event.which===Keys.ESCAPE){closePopup();}};closePopup=function(){$(document.body).off("mousedown",onBodyMouseDown);
$(document).off("keydown",onDocumentKeyDown);$popup.remove();currentInstance=null;};var layoutPopup=function(){$panel.sfBoxHeight($popup.height());
$panel.sfBoxWidth($popup.width());var panelWidth=$panel.width();$header.sfBoxWidth(panelWidth);$canvas.sfBoxWidth(panelWidth);
$canvas.css("top",$header.sfBoxHeight());$canvas.sfBoxHeight($panel.height()-$header.sfBoxHeight());};
var onPanelResize=function(){$canvas.trigger("panelResize");};return function(left,top){close();Spotfire.UI.resizable($popup,{minHeight:200,minWidth:200,helper:"ui-resizable-helper",stop:function(){layoutPopup();
onPanelResize();}});$header.css("cursor","move");$popup.draggable({containment:"window",handle:".sf-element-panel-header",cancel:".PanelButton"});
var $page=$(".sf-element-page");$page.append($popup);layoutPopup();initFunc($canvas);onPanelResize();
currentInstance={name:typeId,close:closePopup};$canvas.on("popupClose",closePopup);var margin=5;if(left+$popup.width()+margin>$(window).width()){left=$(window).width()-$popup.width()-margin;
}if(top+$popup.height()+margin>$(window).height()){top=$(window).height()-$popup.height()-margin;}$popup.css("left",left+"px");
$popup.css("top",top+"px");$header.on("dblclick",dockPanel);Spotfire.Controls.PanelButton.initialize($closeButton,Spotfire.Localization.resources.ClosePanel,"Images/Panel/Close.svg",closePopup);
Spotfire.Controls.PanelButton.initialize($dockButton,Spotfire.Localization.resources.DockPanel,"Images/Panel/PinUndocked.svg",dockPanel);
$(document.body).on("mousedown",onBodyMouseDown);$(document).on("keydown",onDocumentKeyDown);};};Spotfire.registerNameSpace("PopoverPanel",{getState:function(typeId){var panel=popupPanels[typeId];
if(panel===undefined||panel===null){return null;}return panel.settings;},update:function(settings){if(currentInstance!==null&&currentInstance.name===settings.Name&&!settings.IsPopped){currentInstance.close();
}var panel=popupPanels[settings.Name];if(panel!==undefined&&panel!==null){panel.settings=settings;}},show:show,toggle:function(buttonId,typeId){var $button=$("#"+buttonId);
var offset=$button.offset();offset.top+=$button.outerHeight();close();var panel=popupPanels[typeId];if(panel===undefined||panel===null){return;
}if(!panel.settings.HasPanel){Ajax.enqueueRequest(panel.callbackId,"CreatePanel",typeId);return;}if(panel.settings.IsDocked){Ajax.enqueueRequest(panel.callbackId,"TogglePanelVisibility",typeId);
return;}show(typeId,offset.left,offset.top);},close:close,showPopout:function($element){var container=$("body > .sf-element-dialog");
if(container.length===0){container=$("<div/>").addClass("sf-element-dialog");$(document.body).append(container);
}container.append($element);},initialize:function(callbackId,settings,initFunc){var typeId=settings.Name;
popupPanels[typeId]={show:initialize(typeId,callbackId,settings.DisplayName,initFunc),callbackId:callbackId,settings:settings};
}});});$(function(){Spotfire.registerNameSpace("Data.PreviewDialog",{show:function(title,viewId,previewTableId,previewTableHtml){var closed=false;
var $dialog=null;var $container=$("<div/>").attr("viewid",viewId);var $table=$(previewTableHtml).attr("viewid",previewTableId).appendTo($container).hide();
var resizeTable=_.debounce(function(w,h){Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,"Resize",JSON.stringify({width:w,height:h}));
},100);function onResize(){var w=$dialog.innerWidth();var h=$dialog.innerHeight();$container.outerHeight(h);
resizeTable(w,h);}var dialog=Spotfire.Controls.ModalDialog.initialize($container,{title:title,dialogClass:"sf-preview-dialog",minWidth:400,minHeight:300,width:640,height:480,buttons:[{isDefault:true,text:Spotfire.Localization.resources.Close}],resize:onResize,close:function(){closed=true;
Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,"Close","");}});$container.data("dialog",dialog);$dialog=$container.parent();
var $progress=Spotfire.Flex.item({container:"vertical",fill:true,"align-items":"center","justify-content":"center"});
$(Spotfire.Progress.createProgressAnimation(30,30)).css("position","relative").appendTo($progress);$container.append($progress);
$container.outerHeight($dialog.innerHeight());Spotfire.Dxp.Web.Forms.AjaxService.Read(viewId,"LoadTable","",function(result){if(closed){return;
}$progress.remove();if(result.success){$table.show();Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,"UpdateTable",JSON.stringify({width:$dialog.innerWidth(),height:$dialog.innerHeight()}));
}else{$("<div>").addClass("sf-error-title").text(result.errorMessage).appendTo($container);if(result.errorDetails){var showText=Spotfire.Localization.resources.ErrorDialog_ShowDetails;
var hideText=Spotfire.Localization.resources.ErrorDialog_HideDetails;var $details=null;$("<a href='#'>").text(showText).appendTo($container).click(function(){$details.toggle();
$(this).text($details.is(":visible")?hideText:showText);return false;});$details=$("<div>").addClass("sf-error-details").text(result.errorDetails).appendTo($container).hide();
}}});},close:function(viewId){var $preview=$("[viewid="+viewId+"]");if($preview.length){$preview.data("dialog").close();
}}});});$(function(){Spotfire.registerNameSpace("Visuals.PropertiesPopout");var addSubsets,addZoom,addTrellis,addTrellisWithTrellisLayer,addDataTable,addTitle,addLegend,addColorBy,addMarkerBy,addSizeBy,addCompensateMissing,addDrawingOrder,addErrorBars,addFormattingOptions,addLabelVisibility,addFormattingList,addOptionItems,spectrumPalette,addLegendItemElements,build,customDropDown,disableExpandable,enableExpandable,getSpacingBetween,escapeRegexp,searchDiv,handleUpdate,handleUpdateLists,handleUpdateTreeviews,cleanProperties,updateEnabledKpiVisualization,onMouseDown,performLayout,addSidePanel,addMapTypesAndStyling,populateMapChartImageLayer,populateKpiChart,populateKpiChartGeneral,populateKpiVisualization,populateMapChartStandardTileLayer,populateMapChartGeneral,populateMapChartWebMarkerLayer,populateMapChartWebFeatureLayer,populateMapChartTmsLayer,populateMapChartWebMapServiceLayer,populateMapChart,populateCrossTable,populateLineChart,populatePieChart,populateScatterPlot,populateTreemap,populateCombinationChart,populateTablePlot,populateParallelCoordinatePlot,populateBarChart,populateWaterfallChart,resizeWithContainer,showPropertiesPopout,tray,updateEnabled,performSearch,traverseToFirstSearchable,updateEnabledMapChart,updateEnabledMarkingCombinationMethod,updateEnabledCombinationChart,updateEnabledTrellis,updateEnabledScatterPlot,updateEnabledCrossTable,updateEnabledWaterfallChart,updateEnabledBarchart,updateEnabledKpiChart,updateEnabledPieChart,updateEnabledLineBasedChart,populateProperties;
var delay=200;Spotfire.Visuals.PropertiesPopout.show=function(id,settings){var args={id:id,settings:settings};
Spotfire.PageBus.publish("spotfire.visuals.showpropertiespopout",args);};if(Spotfire.isWebPlayer()){var onShowPropertiesPopout=function(subject,message){var data=JSON.parse(message);
showPropertiesPopout(data.id,data.settings);};Spotfire.PageBus.subscribe("spotfire.visuals.showpropertiespopout",onShowPropertiesPopout);
}var createButton=function(selector,tooltip,onClick){var parent=$(selector);parent.empty();var $div=$("<div/>").addClass("PanelButton ");
var $innerDiv=$("<div/>").addClass("PanelButtonInner");var $imagediv=$("<div/>").addClass("PanelButtonImage");
$div.attr("title",tooltip);$div.hover(function(){if(!$div.hasClass("disabled")){$div.addClass("mouseover");
}},function(){$div.removeClass("mouseover");});var mouseup=function(){$div.removeClass("active");$(document.body).off("mouseup",mouseup);
};var mousedown=function(){if(!$div.hasClass("disabled")){$(this).addClass("active");$(document.body).on("mouseup",mouseup);
}};$div.on("mousedown",mousedown);if(onClick){$div.on("click",onClick);}$innerDiv.append($imagediv);$div.append($innerDiv);
parent.append($div);};showPropertiesPopout=function(id,settings){var moved=false;var $button=$("#"+settings.ButtonId);
var pos=$.extend(($button.length===0)?settings.DefaultPosition:{left:$button.offset().left,top:$button.offset().top+$button.height()},$(document.body).data("pos"+id));
var $popout=$("<div/>").addClass("PropertiesPopout").data("id",id);if(Spotfire.capabilities.supportsDropShadow()){$popout.addClass("RoundedDropShadow");
}$popout.css({left:pos.left+"px",top:pos.top+"px"});var $titleBar=$("<div/>").addClass("TitleBar");$titleBar.append($("<div/>").addClass("TitleText").text(Spotfire.Localization.resources.PropertiesPopoutTitle));
var $container=$("<div/>").addClass("Container");var builderOrphans=[];var closePopout=function(){if(moved){$(document.body).data("pos"+id,$popout.offset());
}$(document.body).data("scrollPos"+id,$container.scrollTop());$(document.body).data("dimensions"+id,{width:$popout.width(),height:$popout.height()});
$(document.activeElement).blur();$popout.remove();$.each(builderOrphans,function(){$(this).remove();});
Ajax.enqueueRequest(id,"ClosePopout","");$(document.body).unbind("mousedown",onMouseDown);Spotfire.MultipleViews.OffRemoteFocus(closePopout);
};Spotfire.MultipleViews.OnRemoteFocus(closePopout);var $closeButton=$("<div/>").addClass("closeButton");
createButton($closeButton,Spotfire.Localization.resources.Close,closePopout);$titleBar.append($closeButton);
$popout.append($titleBar);var styledScrollbar;var $searchField=$("<input type='text'/>").addClass("searchField").attr("name","search");
$searchField.attr("placeholder",Spotfire.Localization.resources.TypeToSearchProperties);var $clearSearchButton=$("<img src='Images/PropertiesPopout/SearchValueClose.png'/>").addClass("clearSearch");
$clearSearchButton.hide();$searchField.keyup(function(){$(".searchResult",$container).contents().unwrap();
$(".treeview-container").each(function(index,el){var treeview=$(el).data("treeView");if(treeview){treeview.filter($(this).val());
if(treeview.filteredData.length===0){treeview.filter("");}}}.bind(this));if($(this).val()===""){$(".searchable",$container).show(delay);
$clearSearchButton.hide();enableExpandable();}else{disableExpandable();performSearch($container,$(this).val().toLowerCase());
$clearSearchButton.show();}setTimeout(function(){performLayout();},delay);});$clearSearchButton.click(function(){$(".searchable",$container).show();
$searchField.val("").keyup();});var $searchBar=$("<div/>").addClass("SearchBar");$searchBar.append($searchField);
$searchBar.append($clearSearchButton);$popout.append($searchBar);$popout.append($container);onMouseDown=function(e){var $parent=$(e.target);
while(true){if($(".CodeMirror").length>0){return;}if($parent.length===0){break;}if($parent.hasClass("ColorPicker")||$parent.hasClass("contextMenu")||($parent.hasClass("StyledScrollbar")&&$parent.children(".contextMenu").length)||$parent.hasClass("AxisTrayPopout")||$parent.hasClass("AxisExpressionPopout")||$parent.hasClass("ShapePicker")||$parent.hasClass("ui-dialog")||$parent.hasClass("ui-widget-overlay")||$parent.hasClass("RuleBuilder")||$parent.hasClass("sf-modal-dialog-backdrop")||$parent.hasClass("sf-element-modal-dialog")||$parent.hasClass("propertiesSidePanel")){return;
}if($parent.is($popout)){return;}$parent=$parent.parent();}closePopout();};$(document.body).bind("mousedown",onMouseDown);
$(".PropertiesPopout").remove();Spotfire.PopoverPanel.showPopout($popout);var dim=$(document.body).data("dimensions"+id);
if(dim!==undefined){$popout.width(dim.width).height(dim.height);}performLayout=function(){if(!styledScrollbar){styledScrollbar=$container.StyledScrollbar({cssClass:"ProperiesPopoutScroll",allowResize:true});
}var paddingX=$container.outerWidth()-$container.width();var paddingY=$container.outerHeight()-$container.height();
$container.width($popout.width()-paddingX);$container.height($popout.height()-paddingY-$titleBar.outerHeight(true)-$searchBar.outerHeight(true));
$searchField.width($popout.width()-getSpacingBetween($searchField,".PropertiesPopout"));var availableWidth=$container.first().width()-styledScrollbar.getVScrollbarSize();
$container.trigger("performLayout",[availableWidth]);Spotfire.Filters.StyledFilters.createStyledInput($(this),13,13);
styledScrollbar.refresh();};document.p=performLayout;$popout.draggable({handle:".TitleBar .TitleText",scroll:false,stop:function(){moved=true;
}});Spotfire.UI.resizable($popout,{minWidth:100,minHeight:100,resize:performLayout});$container.on("mousemove","textarea",function(e){if(e.which===1){performLayout();
}});var builder=new build(settings.controlId,$container,builderOrphans,id);if(settings.items){addSidePanel($popout,id,builder,settings);
}enableExpandable=function(){$container.addClass("expandMode");var $expandable=$(".expandable");$expandable.children(".expandableContent").hide();
$expandable.filter(".expanded").children(".expandableContent").show();};disableExpandable=function(){if($container.hasClass("expandMode")){$container.removeClass("expandMode");
$(".expandable").children(".expandableContent").show();}};populateProperties(builder,settings);updateEnabled(settings);
var toggleExpanded=function(header,delayToUse){var $div=header.parent();var sidePanelItem=$div.closest(".PropertiesPopout").find(".sidePanelItem.selected");
var panelData=sidePanelItem?"sidePanelItemHash"+sidePanelItem.data("hash"):"";if($div.hasClass("expanded")){$div.find(".expanded").removeClass("expanded").children(".expandableContent").slideUp(delayToUse);
$div.removeClass("expanded").children(".expandableContent").slideUp(delayToUse,performLayout);$(document.body).removeData("lastExpanded"+id+panelData);
}else{var $parent=$div.parent();$parent.children(".expanded").removeClass("expanded").children(".expandableContent").slideUp(delayToUse);
$div.addClass("expanded").children(".expandableContent").slideDown(delayToUse,performLayout);$(document.body).data("lastExpanded"+id+panelData,header.attr("id"));
}};$popout.on("click",".expandMode .expandableHeader",function(){toggleExpanded($(this),delay);});var sidePanelItem=$popout.find(".sidePanelItem.selected");
var panelData=sidePanelItem?"sidePanelItemHash"+sidePanelItem.data("hash"):"";var lastExpanded=$(document.body).data("lastExpanded"+id+panelData);
if(lastExpanded!==undefined){$(".expanded").removeClass("expanded");$("#"+lastExpanded).parent().addClass("expanded");
}enableExpandable();Spotfire.Utilities.moveIntoViewport($popout,true);if(!Spotfire.capabilities.supportsTouch()){$searchField.focus();
}performLayout();Spotfire.Filters.StyledFilters.createStyledInput($popout,13,13);var scrollPos=$(document.body).data("scrollPos"+id);
if(scrollPos){$container.scrollTop(scrollPos);}};getSpacingBetween=function($element,stopAt){if($element.is(stopAt)){return 0;
}var spacing=$element.outerWidth(true)-$element.width();return spacing+getSpacingBetween($element.parent(),stopAt);
};populateProperties=function(builder,settings){switch(settings.TypeId){case"Spotfire.BarChart":populateBarChart(builder,settings);
break;case"Spotfire.WaterfallChart":populateWaterfallChart(builder,settings);break;case"Spotfire.ScatterPlot":populateScatterPlot(builder,settings);
break;case"Spotfire.CrossTable":populateCrossTable(builder,settings);break;case"Spotfire.LineChart":populateLineChart(builder,settings);
break;case"Spotfire.Treemap":populateTreemap(builder,settings);break;case"Spotfire.PieChart":populatePieChart(builder,settings);
break;case"Spotfire.CombinationChart":populateCombinationChart(builder,settings);break;case"Spotfire.ParallelCoordinatePlot":populateParallelCoordinatePlot(builder,settings);
break;case"Spotfire.WebMapChart":case"Spotfire.WebMarkerLayerVisualization":case"Spotfire.StandardTileLayer":case"Spotfire.TmsLayer":case"Spotfire.WebFeatureLayerVisualization":case"Spotfire.WebMapServiceLayer":case"Spotfire.WebImageLayer":populateMapChart(builder,settings);
break;case"Spotfire.Table":populateTablePlot(builder,settings);break;case"Spotfire.KpiChart":case"Spotfire.KpiVisualization":populateKpiChart(builder,settings);
default:break;}};var maxNumberOfLabelsLimits={min:0,max:200};populatePieChart=function(builder,settings){addTitle(builder,settings);
addDataTable(builder,settings);builder.expandable(Spotfire.Localization.resources.PropertiesPopout_page_Size,"5001030").searchable().addHeader(Spotfire.Localization.resources.PropertiesPopout_SectorSizeBy).addAxisTray(settings.SectorSizeByExpression).end().searchable().addHeader(Spotfire.Localization.resources.PropertiesPopout_PieSize).addSlider("PieSizeValue",settings.PieSizeValue,0,100).end().searchable().addHeader(Spotfire.Localization.resources.PropertiesPopout_PieSizeBy).addAxisTray(settings.SizeByExpression).end().end();
addColorBy(builder,settings);builder.expandable(Spotfire.Localization.resources.PropertiesPopout_SortingSectionTitle,"5001032").addCheckBox("SortSectorsBySize",Spotfire.Localization.resources.PropertiesPopout_SortSectorsBySize,settings.SortSectorsBySize).end();
addTrellis(builder,settings);builder.expandable(Spotfire.Localization.resources.Labels,"5001019").div("grouping").addHeader(Spotfire.Localization.resources.PropertiesPopout_ShowInLabels).addCheckBox("LabelPercentage",Spotfire.Localization.resources.PropertiesPopout_SectorPercentage,settings.LabelPercentage).addCheckBox("LabelValue",Spotfire.Localization.resources.PropertiesPopout_SectorValue,settings.LabelValue).addCheckBox("LabelCategory",Spotfire.Localization.resources.PropertiesPopout_SectorCategory,settings.LabelCategory).end().div("grouping");
addLabelVisibility(builder,settings);builder.end().div("grouping").addHeader(Spotfire.Localization.resources.PropertiesPopout_LabelPosition,false).addRadioButton("LabelPosition",Spotfire.Localization.resources.PropertiesPopout_InsidePie,"Inside",settings.LabelPosition).addRadioButton("LabelPosition",Spotfire.Localization.resources.PropertiesPopout_OutsidePie,"Outside",settings.LabelPosition).end().div("grouping").addHeader(Spotfire.Localization.resources.MaxNumberOfLabels).addIntSpinner("MaxNumberOfLabels",settings.MaxNumberOfLabels,maxNumberOfLabelsLimits).end().div("grouping").addHeader(Spotfire.Localization.resources.PropertiesPopout_SectorPercentageThreshold).addIntSpinner("LabelPercentageLimit",settings.LabelPercentageLimit,{min:0,max:100}).end().div("grouping").addHeader(Spotfire.Localization.resources.PropertiesPopout_SectorPercentageDecimals).addIntSpinner("LabelPercentageDecimalDigits",settings.LabelPercentageDecimalDigits,{min:0,max:6}).end().end();
addLegend(builder,settings);addSubsets(builder,settings);};populateCrossTable=function(builder,settings){addTitle(builder,settings);
addDataTable(builder,settings);builder.expandable(Spotfire.Localization.resources.Axes,"5001003").searchable().addHeader(Spotfire.Localization.resources.Horizontal).addAxisTray(settings.ColumnAxis).end().searchable().addHeader(Spotfire.Localization.resources.Vertical).addAxisTray(settings.RowAxis).end().searchable().addHeader(Spotfire.Localization.resources.CellValues).addAxisTray(settings.MeasureAxis).end().end();
addFormattingList(Spotfire.Localization.resources.PropertiesPopout_CrossTableFormattingListTitle,builder,settings,5001012);
builder.expandable(Spotfire.Localization.resources.PropertiesPopout_GrandTotalsSectionTitle,"5001014").addCheckBox("GrandTotalsRows",Spotfire.Localization.resources.GrandTotalsForRows,settings.GrandTotalsRows).addCheckBox("GrandTotalsColumns",Spotfire.Localization.resources.GrandTotalsForColumns,settings.GrandTotalsColumns).end();
builder.expandable(Spotfire.Localization.resources.Subtotals,"5001033").searchable().addHeader(Spotfire.Localization.resources.PropertiesPopout_SubtotalsListTitle).addSelectableList("Subtotal",settings.Subtotal,{selectable:false,NoItems:Spotfire.Localization.resources.PropertiesPopout_NoSubtotals,checkboxes:true}).end().searchable().addHeader(Spotfire.Localization.resources.DisplaySubtotals).addRadioButton("SubtotalsLayout",Spotfire.Localization.resources.Before,"Before",settings.SubtotalsLayout).addRadioButton("SubtotalsLayout",Spotfire.Localization.resources.After,"After",settings.SubtotalsLayout).end().end();
addColorBy(builder,settings);addLegend(builder,settings);addSubsets(builder,settings);};addFormattingList=function(title,builder,settings,topicid){builder.expandable(Spotfire.Localization.resources.PropertiesPopout_Formatting,topicid);
var tag;var onSelect=function(elems){if(!tray){return;}var sameFormatterType=true;var sameDataType=true;
var formatterType=elems.length>0?elems.data("data")[2]:"";var dataType=elems.length>0?elems.data("data")[1]:"";
var extraData=[];elems.each(function(){var data=$(this).data("data");sameDataType=sameDataType&&data[1]===dataType;
sameFormatterType=sameFormatterType&&$(this).data("data")[2]===formatterType;extraData.push(data[0]);
});$(tray.container).data("extraData",extraData);tray.setDisabled(!sameDataType||formatterType==="Text");
tag=extraData;tray.setText(sameDataType?(formatterType!==""?formatterType:Spotfire.Localization.resources.PropertiesPopout_Default):Spotfire.Localization.resources.PropertiesPopout_FormattingDifferentType);
$("#FormattingSettings").setEnabled(sameDataType&&formatterType!==""&&formatterType!=="Default"&&formatterType!=="General"&&formatterType!=="Text",false);
};builder.div("grouping").addHeader(title).addSelectableList("FormattingOption",settings.FormattingOption,{selected:onSelect,multiSelect:true}).end().div("grouping").addHeader(Spotfire.Localization.resources.PropertiesPopout_ChooseFormatter);
tray=new customDropDown(builder.currentContainer,builder.id,builder.id+"formatting",100,null,null,{changeCallback:"SetFormattingOptions",showCallback:"ShowFormattingOptions"},Spotfire.Localization.resources.PropertiesPopout_NoFormattingOptions);
builder.rootContainer.on("performLayout",function(e,width){var $trayContainer=$(tray.container);if(!$trayContainer.is(":visible")){return;
}tray.sizeBy(width-getSpacingBetween($trayContainer,".Container"));});$(tray.container).addClass("FormattingDropDown");
builder.end();builder.div("grouping").addButton(Spotfire.Localization.resources.PropertiesPopout_FormattingSetting,"FormattingSettings",function(){Ajax.enqueueRequest(builder.id,"ShowFormattingDialog",JSON.stringify({key:"Formatting",tag:tag}));
},"whiteButton").end().end();onSelect($("#FormattingOption .selected"));};populateTreemap=function(builder,settings){addTitle(builder,settings);
addDataTable(builder,settings);builder.expandable(Spotfire.Localization.resources.Axes,"5001006").searchable().addHeader(Spotfire.Localization.resources.Hierarchy).addAxisTray(settings.HierarchyAxis).end().searchable().addHeader(Spotfire.Localization.resources.SizeBy).addAxisTray(settings.SizeAxis).end().end();
addColorBy(builder,settings);addTrellis(builder,settings);builder.expandable(Spotfire.Localization.resources.Labels,"5001021").searchable().addCheckBox("ShowLabels",Spotfire.Localization.resources.ShowLabels,settings.ShowLabels).end().searchable().addCheckBox("ShowHierarchyHeaders",Spotfire.Localization.resources.ShowHierarchyHeaders,settings.ShowHierarchyHeaders).end().end();
addLegend(builder,settings);addSubsets(builder,settings);};populateBarChart=function(builder,settings){addTitle(builder,settings);
builder.expandable(Spotfire.Localization.resources.PropertiesPopout_LayoutSectionTitle,"5001022").searchable().addHeader(Spotfire.Localization.resources.Orientation).addRadioButton("Orientation",Spotfire.Localization.resources.VerticalBars,"Vertical",settings.Orientation).addRadioButton("Orientation",Spotfire.Localization.resources.HorizontalBars,"Horizontal",settings.Orientation).end().searchable().addHeader(Spotfire.Localization.resources.Layout).addRadioButton("StackMode",Spotfire.Localization.resources.StackedBars,"Stack",settings.StackMode).addRadioButton("StackMode",Spotfire.Localization.resources.SideBySideBars,"None",settings.StackMode).addRadioButton("StackMode",Spotfire.Localization.resources.StackedBarsFull,"Stack100Percent",settings.StackMode).end().searchable().addHeader(Spotfire.Localization.resources.Sorting).addCheckBox("SortedBars",Spotfire.Localization.resources.SortBarsByValue,settings.SortedBars).addCheckBox("SortSegmentsBySize",Spotfire.Localization.resources.SortBarSegmentsByValue,settings.SortSegmentsBySize).addCheckBox("ReverseSegmentOrder",Spotfire.Localization.resources.ReverseBarSegmentOrder,settings.ReverseSegmentOrder).end().end();
addDataTable(builder,settings);builder.expandable(Spotfire.Localization.resources.Axes,"5001002").searchable().div("grouping").addHeader(Spotfire.Localization.resources.ValueAxis).addAxisTray(settings.YAxis).end().div("grouping").addCheckBox("YManualZoom",Spotfire.Localization.resources.ShowZoomSlider,settings.YManualZoom).end().div("grouping").addCheckBox("IndividualScaling",Spotfire.Localization.resources.IndividualScaling,settings.IndividualScaling).div("RadioButtonChoiceContent").addRadioButton("IndividualScalingMode",Spotfire.Localization.resources.OneScalePerColor,"Color",settings.IndividualScalingMode).addRadioButton("IndividualScalingMode",Spotfire.Localization.resources.OneScalePerTrellisPanel,"Trellis",settings.IndividualScalingMode).end().end().div("grouping").addFormattingOptions("YAxisFormatting",settings.YAxisFormatting,Spotfire.Localization.resources.PropertiesPopout_FormattingValueAxis,"FormatYButton","YAxisFormatting").end().end().div("separator").end().searchable("ExtraSpacing").div("grouping").addHeader(Spotfire.Localization.resources.CategoryAxis).addAxisTray(settings.XAxis).end().div("grouping").addCheckBox("XManualZoom",Spotfire.Localization.resources.ShowZoomSlider,settings.XManualZoom).end().div("grouping").addFormattingOptions("XAxisFormatting",settings.XAxisFormatting,Spotfire.Localization.resources.PropertiesPopout_FormattingCategoryAxis,"FormatXButton","XAxisFormatting").end().div("grouping").addCompensateMissing(settings).end().end().end();
addColorBy(builder,settings);addTrellis(builder,settings);builder.expandable(Spotfire.Localization.resources.Labels,"5001017").searchable().div("grouping");
addLabelVisibility(builder,settings);builder.end().searchable().addHeader(Spotfire.Localization.resources.LabelOrientation,false).addRadioButton("LabelOrientation",Spotfire.Localization.resources.Horizontal,"Horizontal",settings.LabelOrientation).addRadioButton("LabelOrientation",Spotfire.Localization.resources.Vertical,"Vertical",settings.LabelOrientation).end().searchable().addHeader(Spotfire.Localization.resources.TypesOfLabels,false).addCheckBox("LabelCompleteBar",Spotfire.Localization.resources.CompleteBar,settings.LabelCompleteBar).addCheckBox("LabelSegments",Spotfire.Localization.resources.BarSegments,settings.LabelSegments).div("RadioButtonChoiceContent").addRadioButton("SegmentLabelInformationType",Spotfire.Localization.resources.Percentage,"Percentage",settings.SegmentLabelInformationType).addRadioButton("SegmentLabelInformationType",Spotfire.Localization.resources.Value,"Value",settings.SegmentLabelInformationType).end().end();
builder.searchable().addHeader(Spotfire.Localization.resources.MaxNumberOfLabelsOnCompleteBars,false).addIntSpinner("MaxNumberOfLabels",settings.MaxNumberOfLabels,maxNumberOfLabelsLimits).end();
builder.searchable().addHeader(Spotfire.Localization.resources.BarPercentageDecimals,false).addIntSpinner("LabelPercentageDecimalDigits",settings.LabelPercentageDecimalDigits,false,{min:0,max:6}).end().end().end();
addLegend(builder,settings);addErrorBars(builder,settings);addSubsets(builder,settings);};var createToggleExpandButton=function(selector){var $button=$("<div/>").addClass("expandButtonContainer");
var collapseSvgPath="Images/Buttons/VerticalCollapse.svg";var expandSvgPath="Images/Buttons/VerticalExpand.svg";
var $collapseSvg=$("<div/>").addClass("expandButton");var $expandSvg=$("<div/>").addClass("expandButton");
Spotfire.getSvg(collapseSvgPath,function($svg){$collapseSvg.append($svg);});Spotfire.getSvg(expandSvgPath,function($svg){$expandSvg.append($svg);
});$button.append($expandSvg);$button.click(function(){if($button.hasClass("disabled")){return;}var $contentToToggle=$(selector);
if($contentToToggle.is(":visible")){$contentToToggle.hide(delay);$collapseSvg.remove();$button.append($expandSvg);
}else{$contentToToggle.show(delay);$expandSvg.remove();$button.append($collapseSvg);}performLayout();
});return $button;};populateWaterfallChart=function(builder,settings){addTitle(builder,settings);var $toggleExpandDetailsButton=createToggleExpandButton(".WaterfallOverTrellisDetailsContainer");
builder.expandable(Spotfire.Localization.resources.PropertiesPopout_WaterfallLayoutTitle,"5001022").searchable().addHeader(Spotfire.Localization.resources.Orientation).addRadioButton("Orientation",Spotfire.Localization.resources.Vertical,"Vertical",settings.Orientation).addRadioButton("Orientation",Spotfire.Localization.resources.Horizontal,"Horizontal",settings.Orientation).end().searchable().addHeader(Spotfire.Localization.resources.PropertiesPopout_WaterfallOverHeader).addRadioButton("WaterfallOver",Spotfire.Localization.resources.PropertiesPopout_WaterfallOverColorAndX,"ColorAndX",settings.WaterfallOver,false,"Images/PropertiesPopout/WaterfallOverAllCat.png").addRadioButton("WaterfallOver",Spotfire.Localization.resources.PropertiesPopout_WaterfallOverX,"X",settings.WaterfallOver,false,"Images/PropertiesPopout/WaterfallPerColor.png").addRadioButton("WaterfallOver",Spotfire.Localization.resources.PropertiesPopout_WaterfallOverColor,"Color",settings.WaterfallOver,false,"Images/PropertiesPopout/WaterfallPerCatValue.png").end().searchable().addCheckBox("WaterfallOverTrellis",Spotfire.Localization.resources.PropertiesPopout_WaterfallContinueOverTrellis,settings.WaterfallOverTrellis,$toggleExpandDetailsButton).div("InputContent WaterfallOverTrellisDetailsContainer").addCheckBox("WaterfallOverTrellisPages",Spotfire.Localization.resources.Pages,settings.WaterfallOverTrellisPages).addCheckBox("WaterfallOverTrellisPanels",Spotfire.Localization.resources.Panels,settings.WaterfallOverTrellisPanels).addCheckBox("WaterfallOverTrellisRows",Spotfire.Localization.resources.Rows,settings.WaterfallOverTrellisRows).addCheckBox("WaterfallOverTrellisColumns",Spotfire.Localization.resources.Columns,settings.WaterfallOverTrellisColumns).end().end().searchable().addHeader(Spotfire.Localization.resources.PropertiesPopout_WaterfallConnectingLines).addCheckBox("ShowConnectingLines",Spotfire.Localization.resources.PropertiesPopout_WaterfallShowConntectingLines,settings.ShowConnectingLines).div("InputContent").addRadioButton("ConnectingLinesColorIsDefault",Spotfire.Localization.resources.PropertiesPopout_WaterfallDefaultColor,"true",settings.ConnectingLinesColorIsDefault).addRadioButton("ConnectingLinesColorIsDefault",Spotfire.Localization.resources.PropertiesPopout_WaterfallManualColor,"false",settings.ConnectingLinesColorIsDefault).div("InputContent").addColorField("ConnectingLinesColor",settings.ConnectingLinesColor).end().end().end().searchable().addHeader(Spotfire.Localization.resources.PropertiesPopout_WaterfallSorting).addCheckBox("SortBlocksByValue",Spotfire.Localization.resources.PropertiesPopout_WaterfallSortingBlocksByValue,settings.SortSegmentsBySize).addCheckBox("ReverseBlockOrder",Spotfire.Localization.resources.PropertiesPopout_WaterfallSortingReverseBlockOrder,settings.ReverseSegmentOrder).end().end();
$(".WaterfallOverTrellisDetailsContainer").hide();builder.expandable(Spotfire.Localization.resources.PropertiesPopout_WaterfallTotalsTitle,"5001002").searchable().addCheckBox("TotalBarVisibility",Spotfire.Localization.resources.PropertiesPopout_WaterfallShowTotal,settings.TotalBarVisibility).div("InputContent").addColorField("TotalBarColor",settings.TotalBarColor).end().div("InputContent").addRadioButton("SubTotalsEnabled",Spotfire.Localization.resources.PropertiesPopout_WaterfallTotalEnabled,"false",settings.SubTotalsEnabled).div("InputContent").addHeader(Spotfire.Localization.resources.PropertiesPopout_WaterfallTotalName).addInputField("RootLevelTotalBarName",settings.RootLevelTotalBarName).end().addRadioButton("SubTotalsEnabled",Spotfire.Localization.resources.PropertiesPopout_WaterfallSubtotalsEnabled,"true",settings.SubTotalsEnabled).div("InputContent").addDropDown("SubTotalBarLevels",settings.SubTotalBarLevels,null).end().end().end().end();
addDataTable(builder,settings);var oneScalePerTrellisBool=settings.IndividualScaling&&settings.IndividualScalingMode==="Trellis";
builder.expandable(Spotfire.Localization.resources.Axes,"5001002").searchable().div("grouping").addHeader(Spotfire.Localization.resources.ValueAxis).addAxisTray(settings.YAxis).end().div("grouping").addCheckBox("YManualZoom",Spotfire.Localization.resources.ShowZoomSlider,settings.YManualZoom).end().div("grouping").addCheckBox("IndividualScaling",Spotfire.Localization.resources.OneScalePerTrellisPanel,oneScalePerTrellisBool).end().div("grouping").addFormattingOptions("YAxisFormatting",settings.YAxisFormatting,Spotfire.Localization.resources.PropertiesPopout_FormattingValueAxis,"FormatYButton","YAxisFormatting").end().end().div("separator").end().searchable("ExtraSpacing").div("grouping").addHeader(Spotfire.Localization.resources.CategoryAxis).addAxisTray(settings.XAxis).end().div("grouping").addCheckBox("XManualZoom",Spotfire.Localization.resources.ShowZoomSlider,settings.XManualZoom).end().div("grouping").addFormattingOptions("XAxisFormatting",settings.XAxisFormatting,Spotfire.Localization.resources.PropertiesPopout_FormattingCategoryAxis,"FormatXButton","XAxisFormatting").end().div("grouping").addCompensateMissing(settings).end().end().end();
addColorBy(builder,settings);addTrellis(builder,settings);builder.expandable(Spotfire.Localization.resources.Labels,"5001017").searchable().div("grouping");
addLabelVisibility(builder,settings);builder.end().searchable().addHeader(Spotfire.Localization.resources.LabelOrientation,false).addRadioButton("LabelOrientation",Spotfire.Localization.resources.Horizontal,"Horizontal",settings.LabelOrientation).addRadioButton("LabelOrientation",Spotfire.Localization.resources.Vertical,"Vertical",settings.LabelOrientation).end();
builder.searchable().addHeader(Spotfire.Localization.resources.TypesOfLabels,false).addCheckBox("LabelRunningTotals",Spotfire.Localization.resources.PropertiesPopout_WaterfallRunningTotals,settings.LabelRunningTotals).addCheckBox("LabelBlocks",Spotfire.Localization.resources.PropertiesPopout_WaterfallBlocks,settings.LabelBlocks).end().end().end();
addLegend(builder,settings);addErrorBars(builder,settings);addSubsets(builder,settings);};cleanProperties=function(builder){var $popout=$(".PropertiesPopout");
var $container=$(".Container",$popout);$container.empty();builder.currentId=0;};populateMapChart=function(builder,settings){var $popout=$(".PropertiesPopout");
cleanProperties(builder);if(settings.selectedItemIndex===0){populateMapChartGeneral(builder,settings);
}else{if(settings.selectedLayerType==="Spotfire.WebMarkerLayer"){populateMapChartWebMarkerLayer(builder,settings);
}else{if(settings.selectedLayerType==="Spotfire.WebFeatureLayer"){populateMapChartWebFeatureLayer(builder,settings);
}else{if(settings.selectedLayerType==="Spotfire.TmsLayer"){populateMapChartTmsLayer(builder,settings);
}else{if(settings.selectedLayerType==="Spotfire.WebMapServiceLayer"){populateMapChartWebMapServiceLayer(builder,settings);
}else{if(settings.selectedLayerType==="Spotfire.StandardTileLayer"){populateMapChartStandardTileLayer(builder,settings);
}else{if(settings.selectedLayerType==="Spotfire.WebImageLayer"){populateMapChartImageLayer(builder,settings);
}}}}}}}var sidePanelItem=$popout.find(".sidePanelItem.selected");var panelData=sidePanelItem?"sidePanelItemHash"+sidePanelItem.data("hash"):"";
var lastExpanded=$(document.body).data("lastExpanded"+builder.visualizationId+panelData);if(lastExpanded!==undefined){$(".expanded").removeClass("expanded");
$("#"+lastExpanded).parent().addClass("expanded");}updateEnabled(settings);enableExpandable();Spotfire.Utilities.moveIntoViewport($popout,true);
performLayout();Spotfire.Filters.StyledFilters.createStyledInput($popout,13,13);};populateMapChartImageLayer=function(builder,settings){builder.expandable(Spotfire.Localization.resources.Title,"5001034").currentContainer.parent().addClass("expanded");
builder.div("grouping").addHeader(Spotfire.Localization.resources.Title).addInputField("Title",settings.Title).end().end();
resizeWithContainer("#Title");};populateMapChartGeneral=function(builder,settings){addTitle(builder,settings);
addZoom(builder,settings);addTrellis(builder,settings);addLegend(builder,settings);};populateMapChartStandardTileLayer=function(builder,settings){builder.expandable(Spotfire.Localization.resources.LayerName,"5001034").currentContainer.parent().addClass("expanded");
builder.div("grouping").addHeader(Spotfire.Localization.resources.LayerName).addInputField("Title",settings.Title).end().end();
resizeWithContainer("#Title");builder.expandable(Spotfire.Localization.resources.PropertiesPopoutAppearance).div("grouping").addHeader(Spotfire.Localization.resources.PropertiesPopoutTransparency).addSlider("Transparency",settings.Transparency,0,1).end().end();
addMapTypesAndStyling(builder,settings);};populateMapChartWebMapServiceLayer=function(builder,settings){builder.expandable(Spotfire.Localization.resources.LayerName,"5001034").currentContainer.parent();
builder.div("grouping").addHeader(Spotfire.Localization.resources.LayerName).addInputField("Title",settings.Title).end().end();
builder.expandable(Spotfire.Localization.resources.PropertiesPopoutURL,"5001034").currentContainer.parent().addClass("expanded");
builder.div("grouping").addHeader(Spotfire.Localization.resources.PropertiesPopoutURL).addInputField("Uri",settings.Uri).end().end();
resizeWithContainer("#Title");resizeWithContainer("#Uri");builder.expandable(Spotfire.Localization.resources.PropertiesPopoutAppearance).div("grouping").addHeader(Spotfire.Localization.resources.PropertiesPopoutTransparency).addSlider("Transparency",settings.Transparency,0,1).end().end();
var treeSelectedItem,listSelectedItem,$list;var onTreeviewSelect=function(item){var selected=$("div[name=SubLayers] .treeview-selected");
if(selected.length>0){$("#AddSublayer").prop("disabled",false);}else{$("#AddSublayer").prop("disabled",true);
}if(item){treeSelectedItem=item;}};var offsetListItemIndex=function(offset){var clearBoolList=function(l){var i,currentIndex=-1;
for(i=0;i<l.length;i++){if(l[i]){currentIndex=i;}l[i]=false;}return currentIndex;};var inds=$list.data("selectedInds");
if(!inds){return;}var currentIndex=clearBoolList(inds);if(offset===undefined||currentIndex===-1){return;
}var index=currentIndex+offset;if(index>=0&&index<=inds.length-1){inds[index]=true;}else{if(index>inds.length-1){inds.push(true);
}}};var onSublayerAdd=function(){offsetListItemIndex(1);if(treeSelectedItem){Ajax.enqueueRequest(builder.id,"Sublayer",JSON.stringify({operation:"Add",sublayer:treeSelectedItem.value}));
}};var onSublayerRemove=function(){if(!listSelectedItem){return;}offsetListItemIndex();Ajax.enqueueRequest(builder.id,"Sublayer",JSON.stringify({operation:"Remove",sublayerIndex:listSelectedItem.ind}));
listSelectedItem=null;};var onSublayerMoveForward=function(){if(!listSelectedItem){return;}offsetListItemIndex(-1);
Ajax.enqueueRequest(builder.id,"Sublayer",JSON.stringify({operation:"MoveForward",sublayerIndex:listSelectedItem.ind}));
};var onSublayerMoveBackward=function(){if(!listSelectedItem){return;}offsetListItemIndex(1);Ajax.enqueueRequest(builder.id,"Sublayer",JSON.stringify({operation:"MoveBackward",sublayerIndex:listSelectedItem.ind}));
};var handleListButtonsState=function(){$("#RemoveSublayer").prop("disabled",true);$("#MoveForwardSublayer").prop("disabled",true);
$("#MoveBackwardSublayer").prop("disabled",true);if(!$list){return;}if($("li.selected",$list).length>0){$("#RemoveSublayer").prop("disabled",false);
}else{return;}var items=$("li",$list);if(!$(items[0]).hasClass("selected")){$("#MoveForwardSublayer").prop("disabled",false);
}if(!$(items[items.length-1]).hasClass("selected")){$("#MoveBackwardSublayer").prop("disabled",false);
}};var onListSelect=function(el){listSelectedItem=null;if(el.data()){listSelectedItem=el.data();}$list=el.parent();
handleListButtonsState();};builder.expandable(Spotfire.Localization.resources.PropertiesPopoutWMSLayerMap).div("grouping").searchable().addHeader(Spotfire.Localization.resources.PropertiesPopoutWMSLayerAvailableSublayers).addTreeView("SubLayers",settings.SubLayers,onTreeviewSelect,onSublayerAdd).end().div("grouping").addButton(Spotfire.Localization.resources.PropertiesPopoutWMSLayerAddButtonText,"AddSublayer",onSublayerAdd,"whiteButton").end().end().searchable().div("grouping").addHeader(Spotfire.Localization.resources.PropertiesPopoutWMSLayerSelectedSublayers).addSelectableList("SelectedSublayers",settings.SelectedSublayers,{selected:onListSelect}).end().div("grouping").addButton(Spotfire.Localization.resources.PropertiesPopoutWMSLayerRemoveButtonText,"RemoveSublayer",onSublayerRemove,"whiteButton extraSpacing").addButton(Spotfire.Localization.resources.PropertiesPopoutWMSLayerForwardButtonText,"MoveForwardSublayer",onSublayerMoveForward,"whiteButton extraSpacing").addButton(Spotfire.Localization.resources.PropertiesPopoutWMSLayerBackwardButtonText,"MoveBackwardSublayer",onSublayerMoveBackward,"whiteButton extraSpacing").end().end().end();
onTreeviewSelect();handleListButtonsState();builder.expandable(Spotfire.Localization.resources.PropertiesPopoutWMSRendering).div("grouping").addCheckBox("UseTileRendering",Spotfire.Localization.resources.PropertiesPopoutWMSUseTiles,settings.UseTileRendering).addCheckBox("CacheImagesFromWMS",Spotfire.Localization.resources.PropertiesPopoutWMSCacheImages,settings.CacheImagesFromWMS).addCheckBox("ShowWarnings",Spotfire.Localization.resources.PropertiesPopoutWMSShowWarnings,settings.ShowWarnings).end().end();
builder.expandable(Spotfire.Localization.resources.Legend,"5001024").searchable().addCheckBox("Legend",Spotfire.Localization.resources.ShowLegend,settings.Legend).end();
addLegendItemElements(builder,settings);builder.end();};populateMapChartWebMarkerLayer=function(builder,settings){builder.expandable(Spotfire.Localization.resources.LayerName,"5001034").currentContainer.parent().addClass("expanded");
builder.div("grouping").addHeader(Spotfire.Localization.resources.LayerName).addInputField("Title",settings.Title).end().end();
resizeWithContainer("#Title");builder.expandable(Spotfire.Localization.resources.PropertiesPopoutAppearance).div("grouping").addHeader(Spotfire.Localization.resources.PropertiesPopoutTransparency).addSlider("Transparency",settings.Transparency,0,1).end().end();
if(settings.PropertiesDataTable!==undefined){addDataTable(builder,settings);}builder.expandable(Spotfire.Localization.resources.PropertiesPopout_GeographicLocationSectionTitle,5001046).searchable().div("grouping").addRadioButton("PositioningMethod",Spotfire.Localization.resources.PropertiesPopout_PositioningRadioGeocoding,"Identifier",settings.PositioningMethod).div("InputContent").div("positioningMethodIdentifierContent").addHeader(Spotfire.Localization.resources.MarkerByLabel).addAxisTray(settings.MarkerByAxis).end().end().end().div("grouping").addRadioButton("PositioningMethod",Spotfire.Localization.resources.PropertiesPopout_PositioningRadioCoordinates,"LongitudeLatitude",settings.PositioningMethod).div("InputContent").div("positioningMethodLongitudeLatitudeContent").div("grouping").addHeader(Spotfire.Localization.resources.MapXColumnLabel).addAxisTray(settings.XAxis).end().div("grouping").addHeader(Spotfire.Localization.resources.MapYColumnLabel).addAxisTray(settings.YAxis).end().div("grouping").addHeader(Spotfire.Localization.resources.MarkerByLabel).addAxisTray(settings.FeatureByAxis).end().end().end().end().end().end();
builder.expandable(Spotfire.Localization.resources.Shape,"5001029").searchable().div("grouping").addRadioButton("ShapeByMode",Spotfire.Localization.resources.FixedShape,"FixedShape",settings.ShapeByMode).div("InputContent").addShapeField("DefaultShape",settings.DefaultShape).end().end().div("grouping").addRadioButton("ShapeByMode",Spotfire.Localization.resources.ShapeByColumnValues,"ShapeByColumn",settings.ShapeByMode).div("InputContent").addAxisTray(settings.ShapeByExpression).end().end().end().end();
builder.expandable(Spotfire.Localization.resources.Legend,"5001024").searchable().addCheckBox("Legend",Spotfire.Localization.resources.ShowLegend,settings.Legend).end();
addLegendItemElements(builder,settings);builder.end();addColorBy(builder,settings);addSizeBy(builder,settings);
addDrawingOrder(builder,settings);addJittering(builder,settings);addLineConnection(builder,settings);
addLabels(builder,settings);};populateMapChartWebFeatureLayer=function(builder,settings){builder.expandable(Spotfire.Localization.resources.LayerName,"5001034").currentContainer.parent().addClass("expanded");
builder.div("grouping").addHeader(Spotfire.Localization.resources.LayerName).addInputField("Title",settings.Title).end().end();
resizeWithContainer("#Title");builder.expandable(Spotfire.Localization.resources.PropertiesPopoutAppearance).div("grouping").addHeader(Spotfire.Localization.resources.PropertiesPopoutTransparency).addSlider("Transparency",settings.Transparency,0,1).end().end();
if(settings.PropertiesDataTable!==undefined){addDataTable(builder,settings);}builder.expandable(Spotfire.Localization.resources.PropertiesPopout_GeographicLocationSectionTitle,"5001047").addHeader(Spotfire.Localization.resources.FeatureByLabel).addAxisTray(settings.FeatureByAxis).end();
builder.expandable(Spotfire.Localization.resources.Legend,"5001024").searchable().addCheckBox("Legend",Spotfire.Localization.resources.ShowLegend,settings.Legend).end();
addLegendItemElements(builder,settings);builder.end();addColorBy(builder,settings);addLabels(builder,settings,true);
};populateMapChartTmsLayer=function(builder,settings){builder.expandable(Spotfire.Localization.resources.LayerName,"5001034").currentContainer.parent();
builder.div("grouping").addHeader(Spotfire.Localization.resources.LayerName).addInputField("Title",settings.Title).end().end();
builder.expandable(Spotfire.Localization.resources.PropertiesPopoutURL,"5001034").currentContainer.parent().addClass("expanded");
builder.div("grouping").addHeader(Spotfire.Localization.resources.PropertiesPopoutURL).addInputField("Uri",settings.Url).end().end();
builder.expandable(Spotfire.Localization.resources.PropertiesPopoutAppearance).div("grouping").addHeader(Spotfire.Localization.resources.PropertiesPopoutTransparency).addSlider("Transparency",settings.Transparency,0,1).end().end();
builder.expandable(Spotfire.Localization.resources.PropertiesPopoutTMSLayerCopyright).div("grouping").addHeader(Spotfire.Localization.resources.PropertiesPopoutTMSLayerCopyrightText).addInputField("CopyrightText",settings.CopyrightText).end().div("grouping").addHeader(Spotfire.Localization.resources.PropertiesPopoutTMSLayerCopyrightLink).addInputField("CopyrightLink",settings.CopyrightLink).end().end();
resizeWithContainer("#Title");resizeWithContainer("#Uri");resizeWithContainer("#CopyrightText");resizeWithContainer("#CopyrightLink");
};populateKpiChart=function(builder,settings){var $popout=$(".PropertiesPopout");cleanProperties(builder);
if(settings.selectedItemIndex===0){populateKpiChartGeneral(builder,settings);}else{populateKpiVisualization(builder,settings);
}var sidePanelItem=$popout.find(".sidePanelItem.selected");var panelData=sidePanelItem?"sidePanelItemHash"+sidePanelItem.data("hash"):"";
var lastExpanded=$(document.body).data("lastExpanded"+builder.visualizationId+panelData);if(lastExpanded!==undefined){$(".expanded").removeClass("expanded");
$("#"+lastExpanded).parent().addClass("expanded");}updateEnabled(settings);enableExpandable();Spotfire.Utilities.moveIntoViewport($popout,true);
performLayout();Spotfire.Filters.StyledFilters.createStyledInput($popout,13,13);};populateKpiChartGeneral=function(builder,settings){addTitle(builder,settings);
builder.expandable(Spotfire.Localization.resources.PropertiesPopout_TileWidth,"5001002").searchable().addHeader(Spotfire.Localization.resources.PropertiesPopout_MinimalTileWidth).addIntSpinner("PreferredTileWidth",settings.PreferredTileWidth,{min:10,max:9999}).end().end();
};populateKpiVisualization=function(builder,settings){builder.expandable(Spotfire.Localization.resources.PropertiesPopout_Name,"5001034").currentContainer.parent().addClass("expanded");
builder.div("grouping").addHeader(Spotfire.Localization.resources.PropertiesPopout_Name).addInputField("TitleExpression",settings.TitleExpression).end().end();
resizeWithContainer("#TitleExpression");addDataTable(builder,settings);builder.expandable(Spotfire.Localization.resources.PropertiesPopout_Values,"5001002").searchable().div("grouping").addHeader(Spotfire.Localization.resources.PropertiesPopout_ValueAxis).addAxisTray(settings.YAxis).addFormattingOptions("YAxisFormatting",settings.YAxisFormatting,Spotfire.Localization.resources.PropertiesPopout_FormattingCategoryAxis,"FormatYButton","YAxisFormatting").div("separator").end().end().div("grouping").addHeader(Spotfire.Localization.resources.PropertiesPopout_TimeAxis).addAxisTray(settings.XAxis).end().div("grouping").addCheckBox("ShowTimeLableInTile",Spotfire.Localization.resources.PropertiesPopout_ShowTimeLabelInTile,settings.ShowTimeLableInTile).end().div("grouping").addCompensateMissing(settings).end().div("separator").end().end().div("grouping").addHeader(Spotfire.Localization.resources.PropertiesPopout_TileByAxis).addAxisTray(settings.TileAxis).div("separator").end().end().div("grouping").addHeader(Spotfire.Localization.resources.PropertiesPopout_ComparativeAxis).addAxisTray(settings.ComparativeAxis).addFormattingOptions("ComparativeAxisFormatting",settings.ComparativeAxisFormatting,Spotfire.Localization.resources.PropertiesPopout_FormattingCategoryAxis,"FormatComparativeButton","ComparativeAxisFormatting").end().end();
addColorBy(builder,settings);builder.expandable(Spotfire.Localization.resources.PropertiesPopout_Sparkline,"5001002").searchable().addCheckBox("ShowSparkline",Spotfire.Localization.resources.PropertiesPopout_ShowSparkline,settings.ShowSparkline).div("InputContent").addCheckBox("ShowSparklineScale",Spotfire.Localization.resources.PropertiesPopout_ShowSparklineScale,settings.ShowSparklineScale).addCheckBox("IncludeSparklineOrigin",Spotfire.Localization.resources.PropertiesPopout_IncludeSparklineOrigin,settings.IncludeSparklineOrigin).addRadioButton("IndividualSparklineScaling",Spotfire.Localization.resources.PropertiesPopout_OneScaleForAllKpiSparklines,"false",settings.IndividualSparklineScaling).addRadioButton("IndividualSparklineScaling",Spotfire.Localization.resources.PropertiesPopout_OneScalePerKpiSparkline,"true",settings.IndividualSparklineScaling).end().end().end();
builder.expandable(Spotfire.Localization.resources.Sorting,"5001002").searchable().div("grouping").addHeader(Spotfire.Localization.resources.PropertiesPopout_SortTilesBy).addAxisTray(settings.SortColumn).addExplainingText(Spotfire.Localization.resources.PropertiesPopout_SortTilesByExplanation).end().end();
};populateTablePlot=function(builder,settings){addTitle(builder,settings);addDataTable(builder,settings);
builder.expandable(Spotfire.Localization.resources.PropertiesPopout_ColumnsSectionHeader,"5001008").searchable().addButton(Spotfire.Localization.resources.PropertiesPopout_SelectColumnsButton,"SelectColumns",function(){Spotfire.Visual.SelectColumnsDialog.show(settings.selectColumnsSettings);
},"whiteButton").end().end();addLegend(builder,settings);};populateParallelCoordinatePlot=function(builder,settings){addTitle(builder,settings);
addDataTable(builder,settings);builder.expandable(Spotfire.Localization.resources.Axes,"5001005").searchable().addHeader(Spotfire.Localization.resources.LineBy).addAxisTray(settings.LineByAxis).end().end();
addFormattingList(Spotfire.Localization.resources.PropertiesPopout_PCPFormatingListTile,builder,settings,"5001013");
builder.expandable(Spotfire.Localization.resources.PropertiesPopout_ColumnsSectionHeader,"5001008").searchable().addButton(Spotfire.Localization.resources.PropertiesPopout_SelectColumnsButton,"SelectColumns",function(){Spotfire.Visual.SelectColumnsDialog.show(settings.selectColumnsSettings);
},"whiteButton").end().end();addColorBy(builder,settings);addTrellis(builder,settings);builder.expandable(Spotfire.Localization.resources.Labels,"5001016").searchable().addHeader(Spotfire.Localization.resources.ShowInLabels).addCheckBox("ShowLineLabels",Spotfire.Localization.resources.LineIdentifier,settings.ShowLineLabels).addCheckBox("ShowMarkerLabels",Spotfire.Localization.resources.IndividualValues,settings.ShowMarkerLabels).end().searchable();
addLabelVisibility(builder,settings);builder.end().searchable().addHeader(Spotfire.Localization.resources.MaxNumberOfLabels).addIntSpinner("MaxNumberOfLabels",settings.MaxNumberOfLabels,maxNumberOfLabelsLimits).end().end();
addLegend(builder,settings);addSubsets(builder,settings);};populateCombinationChart=function(builder,settings){addTitle(builder,settings);
addDataTable(builder,settings);builder.expandable(Spotfire.Localization.resources.Axes,"5001001");builder.searchable().div("grouping").addHeader(Spotfire.Localization.resources.XAxis).addAxisTray(settings.XAxis).end().div("grouping").addCheckBox("XManualZoom",Spotfire.Localization.resources.ShowZoomSlider,settings.XManualZoom).end().div("grouping").addFormattingOptions("XAxisFormatting",settings.XAxisFormatting,Spotfire.Localization.resources.PropertiesPopout_FormattingCategoryAxis,"FormatXButton","XAxisFormatting").end().end().div("separator").end();
builder.searchable("ExtraSpacing").div("grouping").addHeader(Spotfire.Localization.resources.YAxis).addAxisTray(settings.YAxis).end().div("grouping").addCheckBox("YManualZoom",Spotfire.Localization.resources.ShowZoomSlider,settings.YManualZoom).end().div("grouping").addCheckBox("IndividualScaling",Spotfire.Localization.resources.IndividualScaling,settings.IndividualScaling).div("RadioButtonChoiceContent").addRadioButton("IndividualScalingMode",Spotfire.Localization.resources.OneScalePerColor,"Color",settings.IndividualScalingMode).addRadioButton("IndividualScalingMode",Spotfire.Localization.resources.OneScalePerTrellisPanel,"Trellis",settings.IndividualScalingMode).end().end().div("grouping").addFormattingOptions("YAxisFormatting",settings.YAxisFormatting,Spotfire.Localization.resources.PropertiesPopout_FormattingValueAxis,"FormatYButton","YAxisFormatting").end().end().end();
builder.expandable(Spotfire.Localization.resources.Series,"5001028").searchable().addHeader(Spotfire.Localization.resources.SeriesBy).addAxisTray(settings.ColorAxis).end().searchable().addHeader(Spotfire.Localization.resources.PropertiesPopout_SeriesBoxes,false).addColorBoxes("Colors",settings.Colors).end().end();
builder.expandable(Spotfire.Localization.resources.PropertiesPopout_LayoutSectionTitle,"5001023").searchable().addHeader(Spotfire.Localization.resources.Layout).addRadioButton("StackMode",Spotfire.Localization.resources.StackedBars,"Stack",settings.StackMode).div("RadioButtonChoiceContent").addCheckBox("ReverseSegmentOrder",Spotfire.Localization.resources.ReverseBarSegmentOrder,settings.ReverseSegmentOrder).end().addRadioButton("StackMode",Spotfire.Localization.resources.SideBySideBars,"None",settings.StackMode).end().searchable().addHeader(Spotfire.Localization.resources.PropertiesPopout_CombinationChart_BarWidth).addSlider("BarWidth",settings.BarWidth,0,100).end().searchable().addHeader(Spotfire.Localization.resources.PropertiesPopout_CombinationChart_SortBy,false).addDropDown("SortBy",settings.SortBy,null).end().end();
addTrellis(builder,settings);builder.expandable(Spotfire.Localization.resources.Labels,"5001018");builder.searchable();
addLabelVisibility(builder,settings);builder.end().end();addLegend(builder,settings);addSubsets(builder,settings);
};addLabelVisibility=function(builder,settings){builder.addHeader(Spotfire.Localization.resources.ShowLabelsFor).addRadioButton("LabelVisibility",Spotfire.Localization.resources.All,"All",settings.LabelVisibility).addRadioButton("LabelVisibility",Spotfire.Localization.resources.MarkedRows,"Marked",settings.LabelVisibility).addRadioButton("LabelVisibility",Spotfire.Localization.resources.None,"None",settings.LabelVisibility);
};populateLineChart=function(builder,settings){addTitle(builder,settings);addDataTable(builder,settings);
builder.expandable(Spotfire.Localization.resources.Axes,"5001004");builder.searchable().div("grouping").addHeader(Spotfire.Localization.resources.XAxis).addAxisTray(settings.XAxis).end().div("grouping").addCheckBox("XManualZoom",Spotfire.Localization.resources.ShowZoomSlider,settings.XManualZoom).end().div("grouping").addFormattingOptions("XAxisFormatting",settings.XAxisFormatting,Spotfire.Localization.resources.PropertiesPopout_FormattingXAxis,"FormatXButton","XAxisFormatting").end().addCompensateMissing(settings).end().div("separator").end().searchable("ExtraSpacing").div("grouping").addHeader(Spotfire.Localization.resources.YAxis).addAxisTray(settings.YAxis).end().div("grouping").addCheckBox("YManualZoom",Spotfire.Localization.resources.ShowZoomSlider,settings.YManualZoom).end().div("grouping").addCheckBox("IndividualScaling",Spotfire.Localization.resources.IndividualScaling,settings.IndividualScaling).div("RadioButtonChoiceContent").addRadioButton("IndividualScalingMode",Spotfire.Localization.resources.OneScalePerColor,"Color",settings.IndividualScalingMode).addRadioButton("IndividualScalingMode",Spotfire.Localization.resources.OneScalePerTrellisPanel,"Trellis",settings.IndividualScalingMode).addRadioButton("IndividualScalingMode",Spotfire.Localization.resources.OneScalePerLine,"Line",settings.IndividualScalingMode).end().end().div("grouping").addFormattingOptions("YAxisFormatting",settings.YAxisFormatting,Spotfire.Localization.resources.PropertiesPopout_FormattingYAxis,"FormatYButton","YAxisFormatting").end().searchable().addHeader(Spotfire.Localization.resources.LineBy).addAxisTray(settings.LineByAxis).end().end().end();
addColorBy(builder,settings);builder.expandable(Spotfire.Localization.resources.PropertiesPopout_MarkerAndLineSectionTitle,"5001027").searchable().addCheckBox("ShowMarkers",Spotfire.Localization.resources.ShowMarkers,settings.ShowMarkers).end().searchable().addHeader(Spotfire.Localization.resources.MarkerSize).addSlider("MarkerSize",settings.MarkerSize,1,100,settings.ShowMarkers,"ShowMarkers").end().searchable().addCheckBox("SteppedLines",Spotfire.Localization.resources.DrawAsSteppedLines,settings.SteppedLines).end().end();
addTrellis(builder,settings);builder.expandable(Spotfire.Localization.resources.Labels,"5001016").searchable().addHeader(Spotfire.Localization.resources.ShowInLabels).addCheckBox("ShowLineLabels",Spotfire.Localization.resources.LineIdentifier,settings.ShowLineLabels).addCheckBox("ShowMarkerLabels",Spotfire.Localization.resources.IndividualValues,settings.ShowMarkerLabels).end().searchable();
addLabelVisibility(builder,settings);builder.end().searchable().addHeader(Spotfire.Localization.resources.MaxNumberOfLabels).addIntSpinner("MaxNumberOfLabels",settings.MaxNumberOfLabels,maxNumberOfLabelsLimits).end().end();
addLegend(builder,settings);addErrorBars(builder,settings);addSubsets(builder,settings);};addCompensateMissing=function(builder,settings){builder.searchable().addHeader(Spotfire.Localization.resources.TimeSeries).addCheckBox("CompensateMissing",Spotfire.Localization.resources.PropertiesPopout_CompensateMissing,settings.CompensateMissing).end();
};populateScatterPlot=function(builder,settings){addTitle(builder,settings);addDataTable(builder,settings);
builder.expandable(Spotfire.Localization.resources.Axes,"5001001").searchable().div("grouping").addHeader(Spotfire.Localization.resources.XAxis).addAxisTray(settings.XAxis).end().div("grouping").addCheckBox("XManualZoom",Spotfire.Localization.resources.ShowZoomSlider,settings.XManualZoom).end().div("grouping").addFormattingOptions("XAxisFormatting",settings.XAxisFormatting,Spotfire.Localization.resources.PropertiesPopout_FormattingXAxis,"FormatXButton","XAxisFormatting").end().end().div("separator").end();
builder.searchable("ExtraSpacing").div("grouping").addHeader(Spotfire.Localization.resources.YAxis).addAxisTray(settings.YAxis).end().div("grouping").addCheckBox("YManualZoom",Spotfire.Localization.resources.ShowZoomSlider,settings.YManualZoom).end().div("grouping").addCheckBox("IndividualScaling",Spotfire.Localization.resources.IndividualScaling,settings.IndividualScaling).div("RadioButtonChoiceContent").addRadioButton("IndividualScalingMode",Spotfire.Localization.resources.OneScalePerColor,"Color",settings.IndividualScalingMode).addRadioButton("IndividualScalingMode",Spotfire.Localization.resources.OneScalePerTrellisPanel,"Trellis",settings.IndividualScalingMode).end().end().div("grouping").addFormattingOptions("YAxisFormatting",settings.YAxisFormatting,Spotfire.Localization.resources.PropertiesPopout_FormattingYAxis,"FormatYButton","YAxisFormatting").end().end().end();
builder.expandable(Spotfire.Localization.resources.Shape,"5001029").searchable().div("grouping").addRadioButton("ShapeByMode",Spotfire.Localization.resources.FixedShape,"FixedShape",settings.ShapeByMode).div("InputContent").addShapeField("DefaultShape",settings.DefaultShape).end().end().div("grouping").addRadioButton("ShapeByMode",Spotfire.Localization.resources.ShapeByColumnValues,"ShapeByColumn",settings.ShapeByMode).div("InputContent").addAxisTray(settings.ShapeByExpression).end().end().div("grouping").addRadioButton("ShapeByMode",Spotfire.Localization.resources.TiledMarkers,"Tile",settings.ShapeByMode).addRadioButton("ShapeByMode",Spotfire.Localization.resources.Pies,"Chart",settings.ShapeByMode).end().end().end();
addMarkerBy(builder,settings);addColorBy(builder,settings);addSizeBy(builder,settings);addDrawingOrder(builder,settings);
addJittering(builder,settings);addTrellis(builder,settings);addLineConnection(builder,settings);addLabels(builder,settings);
addLegend(builder,settings);addErrorBars(builder,settings);addSubsets(builder,settings);};addLegend=function(builder,settings){builder.expandable(Spotfire.Localization.resources.Legend,"5001024").searchable().addCheckBox("Legend",Spotfire.Localization.resources.ShowLegend,settings.Legend).end().searchable().addHeader(Spotfire.Localization.resources.Position).addRadioButton("LegendPosition",Spotfire.Localization.resources.Right,"right",settings.LegendPosition).addRadioButton("LegendPosition",Spotfire.Localization.resources.Left,"left",settings.LegendPosition).end();
addLegendItemElements(builder,settings);builder.end();};addLegendItemElements=function(builder,settings){builder.searchable().div("grouping");
builder.addHeader(Spotfire.Localization.resources.DisplayTheFollowingLegendItems);var onSelect=function(elems){var data=elems.data("data");
if(!data){return;}var ind=elems.data("ind");var showTitleEnabled="LegendItemShowTitle" in data;$("#LegendItemShowTitle").setEnabled(showTitleEnabled,true).prop("checked",showTitleEnabled&&data.LegendItemShowTitle).data("checkBoxId",ind);
var showAxisSelectorEnabled="LegendItemShowAxisSelector" in data;$("#LegendItemShowAxisSelector").setEnabled(showAxisSelectorEnabled,true).prop("checked",showAxisSelectorEnabled&&data.LegendItemShowAxisSelector).data("checkBoxId",ind);
};builder.addSelectableList("LegendItem",settings.LegendItem,{selected:onSelect,checkboxes:true});var $selectedItem=$("#LegendItem .selected",builder.currentContainer);
builder.end().div("grouping").addHeader(Spotfire.Localization.resources.PropertiesPopout_LegendSettingsHeader).addCheckBox("LegendItemShowTitle",Spotfire.Localization.resources.ShowTitle,false).addCheckBox("LegendItemShowAxisSelector",Spotfire.Localization.resources.ShowAxisSelector,false).end().end();
onSelect($selectedItem);};addDataTable=function(builder,settings){builder.expandable(Spotfire.Localization.resources.Data,"5001010").searchable().addHeader(Spotfire.Localization.resources.DataTable);
var dataTableSettings=settings.PropertiesDataTable;var dataTableTray=Spotfire.Data.DataTableTray.create(builder.currentContainer,dataTableSettings,function(val){Ajax.enqueueRequest(builder.id,"ChangeDataTable",val);
});var dataTableContainer=$(dataTableTray.container);dataTableContainer.attr("name","PropertiesDataTable");
builder.end().searchable().div("grouping").addHeader(Spotfire.Localization.resources.PropertiesPopout_Marking);
var markingSettings=settings.PropertiesMarking;var markingTray=Spotfire.Data.MarkingTray.create(builder.currentContainer,markingSettings,function(val){Ajax.enqueueRequest(builder.id,"ChangeMarking",val);
});var markingContainer=$(markingTray.container);markingContainer.attr("name","PropertiesMarking");builder.end().end().searchable().div("grouping").addHeader(Spotfire.Localization.resources.PropertiesPopout_MarkingLimitsHeader).addSelectableList("MarkingLimits",settings.MarkingLimits,{selectable:false,checkboxes:true}).end().div("grouping").addHeader(Spotfire.Localization.resources.PropertiesPopout_MarkingCombinationHeader).addRadioButton("MarkingCombinationMethod",Spotfire.Localization.resources.PropertiesPopout_MarkingCombination_All,"Intersection",settings.MarkingCombinationMethod).addRadioButton("MarkingCombinationMethod",Spotfire.Localization.resources.PropertiesPopout_MarkingCombination_Any,"Union",settings.MarkingCombinationMethod).end().end().end();
var sizeBy=function(e,width){if(dataTableContainer.is(":visible")){dataTableTray.sizeBy(width-getSpacingBetween(dataTableContainer,".Container"));
}if(markingContainer.is(":visible")){markingTray.sizeBy(width-getSpacingBetween(markingContainer,".Container"));
}};$(".PropertiesPopout .Container").on("performLayout",sizeBy);};var openpicker=function(id,data,item,$colorarea){item.palette=data.palette;
item.current=item.color;item.top=3;Spotfire.Picker.show(item,$colorarea,"ColorPicker",function(result){if(result.id==="Bar"||result.id==="Line"){Ajax.enqueueRequest(id,"Series",JSON.stringify({key:item.key,seriestype:result.id}));
}else{Ajax.enqueueRequest(id,"Color",JSON.stringify({legenditemid:item.legenditemid,identifier:item.id,key:item.key,color:result.toHexString(false)}));
}});};resizeWithContainer=function(selector){$(".PropertiesPopout .Container").on("performLayout",function(e,width){var $element=$(selector);
if(!$element.is(":visible")){return;}$element.width(width-getSpacingBetween($element,".Container"));});
};addTitle=function(builder,settings){builder.expandable(Spotfire.Localization.resources.PropertiesPopout_TitleSectionTitle,"5001034").currentContainer.parent().addClass("expanded");
builder.div("grouping").addHeader(Spotfire.Localization.resources.Title).addInputField("TitleExpression",settings.TitleExpression).addCheckBox("ShowTitleBar",Spotfire.Localization.resources.ShowTitleBar,settings.ShowTitleBar).end().div("grouping").addHeader(Spotfire.Localization.resources.Description).addInputBox("DescriptionExpression",settings.DescriptionExpression).addCheckBox("ShowDescription",Spotfire.Localization.resources.ShowDescription,settings.ShowDescription).end().end();
resizeWithContainer("#TitleExpression");resizeWithContainer("#DescriptionExpression");};addZoom=function(builder,settings){builder.expandable(Spotfire.Localization.resources.PropertiesPopout_MapChartZoomSectionTitle,"5001026").div("grouping").addCheckBox("AutoZoom",Spotfire.Localization.resources.PropertiesPopout_MapChartAutoZoom,settings.AutoZoom).end().end();
};addMarkerBy=function(builder,settings){builder.expandable(Spotfire.Localization.resources.PropertiesPopout_MarkersSectionTitle,"5001026").addHeader(Spotfire.Localization.resources.MarkerByLabel).addAxisTray(settings.MarkerByAxis).end();
};addColorBy=function(builder,settings){builder.expandable(Spotfire.Localization.resources.Color,"5001007").searchable().addHeader(Spotfire.Localization.resources.ColorBy).addAxisTrayOrDropDown(settings.ColorAxis,settings.ColorByMeasure).end();
if(settings.EnableMultipleColorScales){builder.searchable().addHeader(Spotfire.Localization.resources.PropertiesPopout_EvaluateColorRuleBy,false).addDropDown("EvaluateColorRuleBy",settings.EvaluateColorRuleBy,Spotfire.Localization.resources.PropertiesPopout_NotApplicable).end();
}builder.searchable().addHeader(Spotfire.Localization.resources.PropertiesPopout_SetColorScheme,false).addColorSchemePicker("ColorSchemes",settings.ColorSchemes).end().searchable().addHeader(Spotfire.Localization.resources.PropertiesPopout_ColorBoxes,false,null,builder.addColorRuleResetButton()).addColorBoxes("Colors",settings.Colors).end().end();
};addSizeBy=function(builder,settings){builder.expandable(Spotfire.Localization.resources.PropertiesPopout_page_Size,"5001031").searchable().addHeader(Spotfire.Localization.resources.SizeBy).addAxisTray(settings.SizeAxis).end().searchable().addHeader(Spotfire.Localization.resources.MarkerSize).addSlider("MarkerSize",settings.MarkerSize,0,30).end().end();
};addJittering=function(builder,settings){builder.expandable(Spotfire.Localization.resources.PropertiesPopout_Jittering,"5001015").searchable().addHeader(Spotfire.Localization.resources.JitterX).addSlider("XJitter",settings.XJitter,0,0.5).end().searchable().addHeader(Spotfire.Localization.resources.JitterY).addSlider("YJitter",settings.YJitter,0,0.5).end().end();
};addTrellis=function(builder,settings){builder.expandable(Spotfire.Localization.resources.Trellis,"5001035").addTrellisLayers(settings.TrellisLayers).div("grouping").addRadioButton("TrellisMode",Spotfire.Localization.resources.RowsAndColumns,"RowsColumns",settings.TrellisMode,true).div("RadioButtonChoiceContent").div("grouping").addHeader(Spotfire.Localization.resources.Rows,false).addAxisTray(settings.TrellisRows).end().div("grouping").addHeader(Spotfire.Localization.resources.Columns,false).addAxisTray(settings.TrellisColumns).end().div("grouping").addHeader(Spotfire.Localization.resources.Pages,false).addAxisTray(settings.TrellisPages).end().end().end().div("grouping").addRadioButton("TrellisMode",Spotfire.Localization.resources.Panels,"Panels",settings.TrellisMode,true).div("RadioButtonChoiceContent").div("grouping").addHeader(Spotfire.Localization.resources.SplitBy,false).addAxisTray(settings.TrellisPanels).end().div("grouping").addCheckBox("TrellisManual",Spotfire.Localization.resources.ManualLayout,settings.TrellisManual).end().div("grouping").addHeader(Spotfire.Localization.resources.MaxNumberOfRows,false).addIntSpinner("TrellisManualRows",settings.TrellisManualRows,{min:1,max:1000}).end().div("grouping").addHeader(Spotfire.Localization.resources.MaxNumberOfColumns,false).addIntSpinner("TrellisManualColumns",settings.TrellisManualColumns,{min:1,max:1000}).end().end().end().end();
};addLineConnection=function(builder,settings){builder.expandable(Spotfire.Localization.resources.LineConnection,"5001025").searchable().addHeader(Spotfire.Localization.resources.DrawASeparateLine).addAxisTray(settings.ConnectionAxis).end().searchable().addHeader(Spotfire.Localization.resources.OrderEachLineBy).addAxisTray(settings.OrderAxis).end().searchable().addHeader(Spotfire.Localization.resources.Color).addRadioButton("UseMarkerColor",Spotfire.Localization.resources.SameAsMarker,"UseMarkerColor",settings.UseMarkerColor).addRadioButton("UseMarkerColor",Spotfire.Localization.resources.CustomColor,"UseCustomColor",settings.UseMarkerColor).div("InputContent").addColorField("LineConnectionColor",settings.LineConnectionColor).end().end().searchable().addHeader(Spotfire.Localization.resources.Width).addIntSpinner("LineConnectionWidth",settings.LineConnectionWidth,{min:1,max:10}).end().searchable().addCheckBox("IsBackground",Spotfire.Localization.resources.PropertiesPopout_PlaceInBackground,settings.IsBackground).end().searchable().addCheckBox("ShowArrows",Spotfire.Localization.resources.ShowArrowsToIndicateOrder,settings.ShowArrows).end().end();
};addLabels=function(builder,settings,isFeatureLayer){builder.expandable(Spotfire.Localization.resources.Labels,"5001020").searchable().addHeader(Spotfire.Localization.resources.LabelBy).addAxisTray(settings.LabelColumn).end();
builder.searchable().addHeader(Spotfire.Localization.resources.ShowLabelsFor).addRadioButton("LabelVisibility",Spotfire.Localization.resources.All,"All",settings.LabelVisibility).addRadioButton("LabelVisibility",Spotfire.Localization.resources.MarkedRows,"Marked",settings.LabelVisibility).addRadioButton("LabelVisibility",Spotfire.Localization.resources.None,"None",settings.LabelVisibility).end();
if(!isFeatureLayer){builder.searchable().addHeader(Spotfire.Localization.resources.MaxNumberOfLabels).addIntSpinner("MaxNumberOfLabels",settings.MaxNumberOfLabels,maxNumberOfLabelsLimits).end().searchable().addCheckBox("CenterLabels",Spotfire.Localization.resources.CenterLabelsOnItems,settings.CenterLabels).end().searchable().addCheckBox("ShowEmptyLabels",Spotfire.Localization.resources.ShowEmptyLabels,settings.ShowEmptyLabels).end();
}builder.end();};addDrawingOrder=function(builder,settings){builder.expandable(Spotfire.Localization.resources.DrawingOrder,"999999").searchable().addHeader(Spotfire.Localization.resources.DrawingOrderBy).addAxisTray(settings.DrawingOrderAxis).end().searchable().addCheckBox("ReverseDrawingOrder",Spotfire.Localization.resources.DrawingOrderReverse,settings.ReverseDrawingOrder).end().end();
};addSubsets=function(builder,settings){builder.expandable(Spotfire.Localization.resources.SelectSubsetsToCompare,"5001009").addSelectableList("Subset",settings.Subset,{selectable:false,checkboxes:true});
builder.end();};addErrorBars=function(builder,settings){if("ErrorBar" in settings){var onselect=function(elems){var ind=elems.data("ind");
var data=elems.data("data");var $div=$("#UpperErrorExpression");var $div2=$("#LowerErrorExpression");
if(data!==undefined&&data!==null){Spotfire.Visuals.AxisTrayControl.initialize($div,data.UpperErrorExpression.viewId,data.UpperErrorExpression.settings,true);
Spotfire.Visuals.AxisTrayControl.initialize($div2,data.LowerErrorExpression.viewId,data.LowerErrorExpression.settings,true);
$("#ShowEndCaps").prop("checked",data.ShowEndCaps).data("checkBoxId",ind).setEnabled(true,true);$("#IncludeInAxisRange").prop("checked",data.IncludeInAxisRange).data("checkBoxId",ind).setEnabled(true,true);
var $useMarkerColorRadioButtons=$("[name='ErrorBarUseMarkerColor']");$useMarkerColorRadioButtons.data("radioButtonId",ind).setEnabled(true,false);
handleUpdate($useMarkerColorRadioButtons,data.ErrorBarUseMarkerColor);$("#ErrorBarColor").setEnabled(data.ErrorBarUseMarkerColor==="UseCustomColor",true).data("colorFieldId",ind).spectrum("set",data.ErrorBarColor);
}else{$div.empty();$div2.empty();$("#UpperErrorExpression, #LowerErrorExpression, #ShowEndCaps, #IncludeInAxisRange, [name='ErrorBarUseMarkerColor'], #ErrorBarColor").setEnabled(false,true);
}};builder.expandable(Spotfire.Localization.resources.ErrorBars,"5001011").div("grouping").addHeader(Spotfire.Localization.resources.PropertiesPopout_VisibleErrorBars).addSelectableList("ErrorBar",settings.ErrorBar,{selected:onselect,checkboxes:true});
var $selected=$("#ErrorBar .selected",builder.currentContainer);builder.end().div("grouping").addHeader(Spotfire.Localization.resources.Settings).div("grouping").addHeader(Spotfire.Localization.resources.UpperError).div("","UpperErrorExpression").currentContainer.width(200).height(20);
builder.end().end().div("grouping").addHeader(Spotfire.Localization.resources.LowerError).div("","LowerErrorExpression").currentContainer.width(200).height(20);
builder.end().end().div("grouping").addHeader(Spotfire.Localization.resources.Color).addRadioButton("ErrorBarUseMarkerColor",Spotfire.Localization.resources.UseMarkerColor,"UseMarkerColor","UseMarkerColor").addRadioButton("ErrorBarUseMarkerColor",Spotfire.Localization.resources.CustomColor,"UseCustomColor","UseMarkerColor").div("InputContent grouping").addColorField("ErrorBarColor","rgb(0,0,0)").end().end().div("grouping").addCheckBox("ShowEndCaps",Spotfire.Localization.resources.ShowEndCaps,false).end().div("grouping").addCheckBox("IncludeInAxisRange",Spotfire.Localization.resources.IncludeInAxisRange,false).end().end().end();
onselect($selected);}};build=function(id,$container,orphans,visualizationId){this.rootContainer=$container;
this.currentContainer=$container;this.id=id;this.visualizationId=visualizationId;this.searchable=function(classes){this.div("grouping searchable "+(typeof classes!=="undefined"?classes:""));
return this;};this.currentId=0;this.expandable=function(title,topicId){this.div("searchable expandable");
this.addHeader(title,true,topicId);this.div("expandableContent");return this;};this.div=function(classes,id){var $newContainer=$("<div/>");
if(classes){$newContainer.addClass(classes);}if(id){$newContainer.attr("id",id);}this.currentContainer.append($newContainer);
this.currentContainer=$newContainer;return this;};this.end=function(){if(this.currentContainer.is(".expandableContent")){this.currentContainer=this.currentContainer.parent();
}this.currentContainer=this.currentContainer.parent();return this;};this.addColorRuleResetButton=function(){var $resetButton=$("<div/>").addClass("header-reset-button").attr("title",Spotfire.Localization.resources.ResetButton);
Spotfire.getSvg("Images/PropertiesPopout/cirklearrow.svg",function($svg){$svg.css({position:"relative",width:"14px",height:"14px"});
$resetButton.append($svg);});var mouseup=function(){$resetButton.removeClass("active");$(document.body).off("mouseup",mouseup);
};var mousedown=function(){$resetButton.addClass("active");$(document.body).on("mouseup",mouseup);};$resetButton.on("mousedown",mousedown);
$resetButton.click(function(){Ajax.enqueueRequest(id,"ResetColorRules");});return $resetButton;};this.addHeader=function(text,expandable,topicId,$button){var $text=$("<span/>").text(text).addClass("highlightText");
var $header=$("<div/>").append($text).append($button).addClass("Header");if(expandable){if(!topicId){topicId="0";
}$header.addClass("expandableHeader");$header.attr("id","exp"+this.currentId++);}this.currentContainer.append($header);
return this;};this.addExplainingText=function(text){var $text=$("<span/>").text(text).addClass("highlightText");
var $header=$("<div/>").append($text).addClass("ExplainingText");this.currentContainer.append($header);
return this;};this.addTrellisLayers=function(trellisLayers){if(trellisLayers){this.div("grouping");this.addHeader(Spotfire.Localization.resources.TrellisLayer,false);
this.addDropDown("TrellisLayers",trellisLayers,Spotfire.Localization.resources.AxisTrayNoneItem);this.end();
}return this;};this.addButton=function(text,name,onClickCallback,cssClass){var $button=$("<input type='button'/>").val(text).attr("id",name);
$button.click(onClickCallback);if(cssClass){$button.addClass(cssClass);}this.currentContainer.append($button);
return this;};this.addRadioButton=function(name,text,value,actualValue,header,img,callback){var inputId=name+"_"+value;
var $containingDiv=$("<div/>").addClass("RadioButtonItemContainer");var $input=$("<input type='radio'/>").attr("name",name).val(value).attr("id",inputId);
if(value===actualValue){$input.prop("checked",true);}$input.change(function(){if(typeof $(this).data("radioButtonId")!=="undefined"){if(callback){callback(id,name,JSON.stringify({radioButtonValue:$(this).val(),radioButtonId:$(this).data("radioButtonId")}));
}Ajax.enqueueRequest(id,name,JSON.stringify({radioButtonValue:$(this).val(),radioButtonId:$(this).data("radioButtonId")}));
}else{if(callback){callback(id,name,$(this).val());}Ajax.enqueueRequest(id,name,$(this).val());}});var $label=$("<label/>").attr("for",inputId);
if(img){$label.append($("<img/>").attr("src",img));}$label.append($("<span/>").text(text).addClass("highlightText"));
if(header){$label.addClass("RadioButtonHeader");}$containingDiv.append($input);$containingDiv.append($label);
$containingDiv.append($("<br/>"));this.currentContainer.append($containingDiv);return this;};this.addCheckBox=function(name,text,checked,$button){var $input=$("<input type='checkbox'/>").attr("name",name).attr("id",name);
$input.prop("checked",checked);$input.change(function(){if(typeof $(this).data("checkBoxId")!=="undefined"){Ajax.enqueueRequest(id,name,JSON.stringify({checkBoxId:$(this).data("checkBoxId"),isChecked:$(this).is(":checked")}));
}else{Ajax.enqueueRequest(id,name,$(this).is(":checked"));}});var $label=$("<label/>").text(text).attr("for",name).addClass("highlightText");
this.currentContainer.append($input);this.currentContainer.append($label);this.currentContainer.append($button);
this.currentContainer.append($("<br/>"));return this;};this.addCustom=function(name,settings,createfunction,updatefunction){if(typeof createfunction!=="function"){return;
}if(typeof updatefunction!=="function"){updatefunction=function($element,data){$element.empty();createfunction($element,data);
};}var $customcontrolcontainer=$("<div />").attr("name",name).addClass("CustomPropertyControl").data("updatefunction",updatefunction);
this.currentContainer.append($customcontrolcontainer);createfunction($customcontrolcontainer,settings);
return $customcontrolcontainer;};this.addDropDown=function(name,options,noItemsText){var tray=new customDropDown(this.currentContainer,this.id,name,$container.get(0).clientWidth-18,options.items,options.text,{changeCallback:name},noItemsText);
$(tray.container).attr("name",name);$container.on("performLayout",function(e,width){var $trayContainer=$(tray.container);
if(!$trayContainer.is(":visible")){return;}tray.sizeBy(width-getSpacingBetween($trayContainer,".Container"));
});return this;};this.addOptions=function(name,settings){var $select=$("<select/>").attr("id",name).attr("name",name);
addOptionItems($select,settings);$select.change(function(){var val=$("#"+name+" option:selected").val();
Ajax.enqueueRequest(id,name,val);});this.currentContainer.append($select);return this;};this.addColorBoxes=function(name,settings){var create=function($element,data,initialScrollpositions){var colorItemHeight=14;
var colorItemMargin=6;var itemSize=colorItemHeight+colorItemMargin;if(!$element.data("onclick")){$element.data("onclick",true);
$element.on("click",".clickablecolor",function(){openpicker(id,$(this).data("data"),$(this).data("item"),$(this));
});}function textWidth(colorarea){colorarea.find(".colortext").width(colorarea.innerWidth()-23);colorarea.find(".poppoutrulesarea").find(".colortext").width(colorarea.innerWidth()-57);
}var updateLayoutCallback=function(colorarea,scroll){return function(e,width){if(!colorarea.is(":visible")){return;
}colorarea.width(width-getSpacingBetween(colorarea,".Container"));scroll.refresh();textWidth(colorarea);
};};function addColorRuleButtons($coloritem,item,$rulesarea){var iconMargin=5;var iconSize=12;Spotfire.getSvg("Images/PropertiesPopout/Close_12x12.svg",function($svg){$coloritem.append($("<span/>").addClass("icon").css({position:"absolute",top:0,right:iconMargin+"px",height:iconSize+"px",width:iconSize+"px"}).append($svg).click(function(){var subscriberData=item;
subscriberData.pos=$(this).parents(".coloritem").offset();Ajax.enqueueRequest(id,"DeleteRule",JSON.stringify(subscriberData));
}));});Spotfire.getSvg("Images/PropertiesPopout/Settings_12x12.svg",function($svg){$coloritem.append($("<span/>").addClass("icon").css({position:"absolute",top:0,right:(iconMargin+iconSize+iconMargin)+"px",height:iconSize+"px",width:iconSize+"px"}).append($svg.clone()).click(function(){var subscriberData=item;
subscriberData.pos=$(this).parents(".coloritem").offset();Ajax.enqueueRequest(id,"ShowColorRuleDialog",JSON.stringify(subscriberData));
}));$coloritem.append($("<br>"));});if(Spotfire.capabilities.supportsTouch()){return;}var getPosition=function(index){return(index*itemSize);
};$coloritem.css({position:"absolute",top:getPosition(item.ruleIndex)+"px",width:"100%"});var totalSize=(itemSize*(item.ruleIndex+1));
$rulesarea.css({height:totalSize+"px",position:"relative","-webkit-transition":"top 2s"});var $items;
var indicatePos;Spotfire.Touch.draggable($coloritem,{start:function(){$items=$rulesarea.find(".coloritem");
totalSize=(itemSize*$items.length);indicatePos=item.ruleIndex;},drag:function(p){indicatePos=item.ruleIndex+Math.floor((p.top/itemSize)+0.5);
if(indicatePos>$items.length){indicatePos=$items.length-1;}var i,$it,top;for(i=0;i<$items.length;i++){if(i===item.ruleIndex){continue;
}$it=$($items[i]);$it.css("position","absolute");if(i<indicatePos&&i<item.ruleIndex){top=getPosition(i);
}else{if(i<indicatePos&&i>item.ruleIndex){top=getPosition(i-1);}else{if(i===indicatePos){top=getPosition(i+(i>item.ruleIndex?-1:1));
}else{if(i>indicatePos&&i>item.ruleIndex){top=getPosition(i);}else{if(i>indicatePos&&i<item.ruleIndex){top=getPosition(i+1);
}}}}}if(top!==undefined){$it.css({top:top+"px"});}}},stop:function(e){if(indicatePos!==item.ruleIndex){item.moveTo=indicatePos;
$coloritem.css("top",indicatePos*itemSize+"px");Ajax.enqueueRequest(id,"MoveColorRule",JSON.stringify(item));
var $colorAreaProgress=$("<div/>").addClass("colorAreaProgress").attr("id","propertiesPopoutColoring");
$colorarea.append($colorAreaProgress);setTimeout(function(){Progress.showPlotOverlay("propertiesPopoutColoring");
},2000);}else{$coloritem.css("top",getPosition(indicatePos)+"px");}},containment:$rulesarea});}function addColorRule(){var coloring=$(this).data("coloring");
Ajax.enqueueRequest(id,"AddColorRule",JSON.stringify(coloring));}var i,j,color,coloring,$colorarea,item,$coloritem,$colorbox,scrollbar,$rulesarea,$addButton,listSize;
for(i=0;i<data.colorings.length;i++){if(i>0){$element.append($("<hr/>"));}coloring=data.colorings[i];
$colorarea=$("<div />").addClass("popoutcoloring").attr("id","popoutcoloring_"+coloring.key).css({position:"relative"});
$rulesarea=$("<div />").addClass("poppoutrulesarea");$rulesarea.appendTo($colorarea);for(j=0;j<coloring.items.length;
j++){item=coloring.items[j];$coloritem=$("<div />").addClass("coloritem").css({height:colorItemHeight,margin:colorItemMargin+"px 0 0 0"});
if(j===coloring.items.length-1){$coloritem.css("margin-bottom",colorItemMargin+"px");}$colorbox=$("<span />").addClass("clickablecolor").data("item",item).data("data",data);
if(item.img!==undefined&&item.img.length>0){$colorbox.append($("<img />").addClass("seriesimage").attr("src",item.img)).css("background-color",item.color);
}else{color=new Spotfire.Utilities.SafeColor(item.color);color.adjustBrightness(-100);$colorbox.css("background-color",item.color).css("border","solid "+color.toHexString()+" 1px");
}$coloritem.append($colorbox);$coloritem.append($("<span />").addClass("colortext").text(item.text).attr("title",item.text));
if(item.ruleIndex!==undefined){$coloritem.css("cursor","move");addColorRuleButtons($coloritem,item,$rulesarea);
$rulesarea.append($coloritem);}else{$coloritem.append($("<br>"));$colorarea.append($coloritem);}}if($rulesarea.find(".colortext").length<=1){$rulesarea.find(".colortext").css("cursor","default");
}if(data.ShowAddColorRules){$addButton=$($("<input type='button'/>"));$addButton.attr("id","AddColorRulesButton").addClass("whiteButton");
$addButton.css({"margin-top":"10px"});$addButton.val(Spotfire.Localization.resources.PropertiesPopout_AddColorRule);
$addButton.data("coloring",coloring);$addButton.on("click",addColorRule);}listSize=coloring.items.length*itemSize+colorItemMargin;
$colorarea.css("height",listSize);if(coloring.truncated){$colorarea.append($("<div>").text("..."));}$element.append($colorarea);
if($colorarea.height()<listSize){$colorarea.addClass("withlines");}$element.append($addButton);$("#AddColorRulesButton").setEnabled(data.EnableAddColorRules,false);
scrollbar=$colorarea.StyledScrollbar({scrollTop:initialScrollpositions?initialScrollpositions[$colorarea.attr("id")]:0,allowResize:true});
textWidth($colorarea);$container.on("performLayout",updateLayoutCallback($colorarea,scrollbar));}};var makeSafeId=function(str){if(typeof str==="string"){return str.replace(/^[^a-z]+|[^\w:.\-]+/gi,"_");
}return str;};var update=function($element,data){var scrollpos=[];$element.find(".popoutcoloring").each(function(){scrollpos[makeSafeId($(this).attr("id"))]=$(this).scrollTop();
});$element.empty();create($element,data,scrollpos);performLayout();};this.addCustom(name,settings,create,update);
return this;};this.addSelectableList=function(name,items,options){var settings=$.extend({selectable:true,multiSelect:false,checkboxes:false},options);
var $list=$("<ul/>").attr("id",name).attr("name",name).addClass("selectableList").data("settings",settings);
this.addListItems($list,name,items);if(settings.selectable){$list.addClass("cursorPointer");}$list.on("change","input[type='checkbox']",function(){Ajax.enqueueRequest(id,name,JSON.stringify({checkBoxId:$(this).parent().data("ind"),isChecked:$(this).is(":checked"),text:$(this).parent().data("text")}));
});if(settings.selectable){$list.on("click","li:not(.DummyItem)",function(e){var clearBoolList=function(l){var i;
for(i=0;i<l.length;i++){l[i]=false;}};var inds=$list.data("selectedInds");if(!$(this).hasClass("selected")){if(!settings.multiSelect||!e.ctrlKey){$(this).parent().find(".selected").removeClass("selected");
clearBoolList(inds);}$(this).addClass("selected");inds[$(this).data("ind")]=true;}else{if(settings.multiSelect&&e.ctrlKey){$(this).removeClass("selected");
$list.data("selectedInds")[$(this).data("ind")]=false;}else{$(this).parent().find(".selected").removeClass("selected");
clearBoolList(inds);$(this).addClass("selected");inds[$(this).data("ind")]=true;}}if(settings.selected){settings.selected($(this).parent().find(".selected"));
}});}var $scrollDiv=$("<div />").addClass("selectableListContainer").append($list);this.currentContainer.append($scrollDiv);
$container.on("performLayout",function(e,width){if(!$scrollDiv.is(":visible")){return;}$scrollDiv.height($list.height());
$scrollDiv.width(width-getSpacingBetween($scrollDiv,".Container"));$scrollDiv.StyledScrollbar({cssClass:"SelectableListScroll",allowResize:true}).refresh();
});return this;};this.addListItems=function($list,name,items){var settings=$list.data("settings");var selectedInd=$list.data("selectedInds");
var hasSelection=!$.isEmptyObject(selectedInd);selectedInd=hasSelection?selectedInd:[];var i,$item,$checkBox;
var j,$columnText,$text;for(i=0;i<items.length;i++){$item=$("<li/>").attr("id",name+"_"+i).data("ind",i).data("data",items[i].Data).data("text",items[i].Text);
if("Checked" in items[i]&&settings.checkboxes){$checkBox=$("<input>").attr("type","checkbox");if(items[i].Checked){$checkBox.prop("checked",true);
}$item.append($checkBox);$item.append($checkBox);}if("Columns" in items[i]){$item.data("Columns",items[i].Columns);
for(j=0;j<items[i].Columns.length;j++){$columnText=$("<div/>").text(items[i].Columns[j]).addClass("highlightText").attr("title",items[i].Columns[j]);
$columnText.css({height:"17px","float":"left",width:1/items[i].Columns.length*100+"%","text-overflow":"ellipsis",overflow:"hidden"});
$item.append($columnText);}}else{if(items[i].Color){$("<div/>").css({"background-color":items[i].Color,"border-color":items[i].Bordercolor}).addClass("colorSquare").appendTo($item);
}$text=$("<span/>").text(items[i].Text).addClass("highlightText ").attr("title",items[i].Text);$item.append($text);
}$list.append($item);if(settings.selectable){if(!hasSelection){selectedInd.push(0===i);}if(selectedInd[i]){$item.addClass("selected");
}}}if(!hasSelection){$list.data("selectedInds",selectedInd);}if(items.length===0){var dummyItem=$("<li/>").addClass("DummyItem");
if(typeof(settings.NoItems)!=="undefined"){dummyItem.text(settings.NoItems).attr("title",settings.NoItems);
}else{dummyItem.html("&nbsp;");}$list.append(dummyItem);}if(settings.selected){settings.selected($list.find(".selected"));
}Spotfire.Filters.StyledFilters.createStyledInput($list,13,13);return this;};this.addInputField=function(name,value){var $input=$("<input type='text'/>").attr("name",name).attr("id",name).val(value);
$input.change(function(){if(typeof $(this).data("expressionId")!=="undefined"){Ajax.enqueueRequest(id,name,JSON.stringify({expressionId:$(this).data("expressionId"),expression:$(this).val()}));
}else{Ajax.enqueueRequest(id,name,$(this).val());}});this.currentContainer.append($input);this.currentContainer.append($("<br/>"));
return this;};this.addInputBox=function(name,value){var $input=$("<textarea/>").attr("name",name).attr("rows",5).attr("id",name).val(value);
$input.change(function(){if(typeof $(this).data("expressionId")!=="undefined"){Ajax.enqueueRequest(id,name,JSON.stringify({expressionId:$(this).data("expressionId"),expression:$(this).val()}));
}else{Ajax.enqueueRequest(id,name,$(this).val());}});this.currentContainer.append($input);this.currentContainer.append($("<br/>"));
return this;};this.addAxisTrayOrDropDown=function(colorAxis,colorByMeasure){if(colorByMeasure){return this.addDropDown("ColorByMeasure",colorByMeasure);
}return this.addAxisTray(colorAxis);};this.addAxisTray=function(settings){var $div=$("<div/>").width(200).height(24).addClass("AxisTrayElement");
this.currentContainer.append($div);$container.on("performLayout",function(e,width){if(!$div.is(":visible")){return;
}$div.width(width-getSpacingBetween($div,".Container"));$div.trigger("shown");});Spotfire.Visuals.AxisTrayControl.initialize($div,settings.viewId,settings.settings,true);
return this;};this.addIntSpinner=function(name,value,options){var $input=$("<input />").attr("name",name).attr("id",name).val(value).attr("size",3).addClass("IntSpinnerInputElement");
this.currentContainer.append($input);var changeFunc=function(){var sValue=$(this).spinner("value");var min=$(this).spinner("option","min");
var max=$(this).spinner("option","max");if((String(sValue)).match(/^\d+$/)&&(min===null||sValue>=min)&&(max===null||sValue<=max)){$(this).css({color:""});
Ajax.enqueueRequest(id,name,sValue);}else{$(this).css({color:"red"});}};var settings=$.extend({},options,{start:function(event){if(event.originalEvent.type==="keydown"){switch(event.which){case $.ui.keyCode.PAGE_UP:case $.ui.keyCode.PAGE_DOWN:case $.ui.keyCode.UP:case $.ui.keyCode.DOWN:case $.ui.keyCode.ENTER:return true;
default:return false;}}return true;},change:changeFunc,stop:changeFunc});$input.spinner(settings);this.currentContainer.append($("<br/>"));
return this;};this.addSlider=function(name,value,min,max,enabled,enableBy){var $slider=$("<div/>").attr("name",name);
this.currentContainer.append($slider);var onStop=function(e,ui){Ajax.enqueueRequest(id,name,ui.value);
};Spotfire.Slider.create($slider,{min:min,max:max,value:value,stop:onStop,enabled:enabled});$container.on("performLayout",function(){if($slider.is(":visible")){Spotfire.Slider.update($slider);
}return true;});$slider.data("EnableBy",enableBy);return this;};this.addTreeView=function(name,data,onSelectCallback,onDoubleClickCallback){var $treeView=$("<div/>").attr("name",name);
var onSelect=function(item){if(onSelectCallback){onSelectCallback(item);}};var onNodeToggle=function(){$treeView.parent().css("height",$treeView.height()+"px");
performLayout();};var onDoubleClick=function(item){if(onDoubleClickCallback){onDoubleClickCallback(item);
}};var $scrollDiv=$("<div />").addClass("scrollableTreeviewContainer").append($treeView);this.currentContainer.append($scrollDiv);
Spotfire.TreeView.create($treeView,{data:data,hideDots:false,selectionHandlingStrategy:"radio",itemRenderer:function(item){return $("<div>").addClass("treeview-label-container").append($("<span>").addClass("treeview-label highlightText").attr("title",item.label).text(item.label));
},onSelect:onSelect,onNodeToggle:onNodeToggle,onDoubleClick:onDoubleClick});$container.on("performLayout",function(e,width){if(!$scrollDiv.is(":visible")){return;
}$scrollDiv.height($treeView.height());$scrollDiv.width(width-getSpacingBetween($scrollDiv,".Container"));
$scrollDiv.StyledScrollbar({cssClass:"SelectableListScroll",allowResize:true}).refresh();});return this;
};this.addCompensateMissing=function(settings){this.searchable().addHeader(Spotfire.Localization.resources.TimeSeries).addCheckBox("CompensateMissing",Spotfire.Localization.resources.PropertiesPopout_CompensateMissing,settings.CompensateMissing).end();
return this;};this.addShapeField=function(name,data){var $picker=$("<input/>").attr("id",name).attr("name",name).addClass("inputShape");
this.currentContainer.append($picker);var onPick=function(color){Ajax.enqueueRequest(id,name,color.id);
};$picker.spectrum({flat:false,showInput:true,color:data.current,change:onPick,showButtons:true,clickoutFiresChange:true,showPalette:true,showPaletteOnly:true,className:"ShapePicker",showMoreColorsButton:false,cancelText:"Cancel",chooseText:"OK",palette:spectrumPalette(data.palette,7)});
var $pickerContainer=$picker.spectrum("container");orphans.push($pickerContainer);Spotfire.Utilities.moveIntoViewport($pickerContainer);
$pickerContainer.change(function(){Spotfire.Utilities.moveIntoViewport($pickerContainer);});return this;
};this.addColorSchemePicker=function(name,settings){this.addCustom(name,settings,function($continer,data){var $picker=$("<div />").addClass("colorschemepicker").attr("id","ColorSchemePicker_"+id);
$continer.append($picker);$continer.append($("<br/>"));Spotfire.Visual.ColorScheme.show($picker,data,function(value){Ajax.enqueueRequest(id,"ColorScheme",JSON.stringify({coloringid:value.coloringid,schemeid:value.schemeid}));
return true;});});return this;};this.addFormattingOptions=function(id,options,header,buttonName,buttonKey){this.div("grouping").addHeader(header).addDropDown(id,options,Spotfire.Localization.resources.PropertiesPopout_NoFormattingOptions).end();
if(buttonName){id=this.id;this.div("grouping").addButton(Spotfire.Localization.resources.PropertiesPopout_FormattingSetting,buttonName,function(){Ajax.enqueueRequest(id,"ShowFormattingDialog",JSON.stringify({key:buttonKey}));
},"whiteButton").end();}return this;};this.addColorField=function(name,value){var $picker=$("<input/>").attr("id",name).attr("name",name).addClass("inputColor");
this.currentContainer.append($picker);var onPick=function(color){if(typeof $(this).data("colorFieldId")!=="undefined"){Ajax.enqueueRequest(id,name,JSON.stringify({color:color.toHexString(false),colorFieldId:$(this).data("colorFieldId")}));
}else{Ajax.enqueueRequest(id,name,color.toHexString(false));}};$picker.spectrum({flat:false,showInput:true,color:value,change:onPick,showButtons:false,clickoutFiresChange:true,showPalette:true,showPaletteOnly:true,className:"ColorPicker",showMoreColorsButton:true,dragstopFiresChanges:true,maxSelectionSize:1,cancelText:"Cancel",chooseText:"OK",palette:spectrumPalette(Spotfire.Colors.ColorPalette,8)});
var $pickerContainer=$picker.spectrum("container");orphans.push($pickerContainer);Spotfire.Utilities.moveIntoViewport($pickerContainer);
$pickerContainer.change(function(){Spotfire.Utilities.moveIntoViewport($pickerContainer);});return this;
};};spectrumPalette=function(colors,itemsPerRow){var palette=[];var paletterow=[];var col=0;var row=0;
var i;for(i=0;i<colors.length;i++){paletterow[col++]=colors[i].color+"|"+(colors[i].id!==undefined?colors[i].id:"")+"|"+(colors[i].image!==undefined?colors[i].image:"")+"|"+(colors[i].id!==undefined?Spotfire.Localization.resources[colors[i].id]:"");
if(((i+1)%itemsPerRow)===0){palette[row++]=paletterow;paletterow=[];col=0;}}if(paletterow.length>0){palette[row]=paletterow;
}return palette;};addOptionItems=function($select,settings){var i,$option;for(i=0;i<settings.items.length;
i++){$option=$("<option/>").text(settings.items[i]);if(settings.items[i]===settings.selectedValue){$option.prop("selected",true);
}$select.append($option);}};addSidePanel=function($element,id,builder,settings){var titleSuffix="";if(settings.selectedItemIndex===0){titleSuffix=settings.generalTitle;
}else{titleSuffix=settings.items[settings.selectedItemIndex-1].title;}$(".PropertiesPopout .TitleText").text(Spotfire.Localization.resources.PropertiesPopoutTitle+" - "+titleSuffix);
var $panel=$("<div/>");$panel.data("selectedItemHash",settings.selectedItemHash);$panel.addClass("propertiesSidePanel");
if(Spotfire.capabilities.supportsDropShadow()){$panel.addClass("SimpleDropShadow");}$panel.css("width",240);
$element.append($panel);$panel.css("top",$(".TitleBar",$element).height()+1);$panel.css("left",-$panel.width()-1);
var sidePanelItems=[];function disableSidePanelItemsInteraction(){sidePanelItems.forEach(function($sidePanelItem){var $itemRemoveIcon=$(".layerRemoveButton",$sidePanelItem);
var $itemVisibilityIcon=$(".layerVisibilityButton",$sidePanelItem);if(!$itemRemoveIcon||!$itemVisibilityIcon){return;
}$sidePanelItem.off("click");$sidePanelItem.removeClass("draggable");Spotfire.DragDrop.removeDraggable($sidePanelItem);
$itemRemoveIcon.off("click");$itemRemoveIcon.addClass("disabled");$itemVisibilityIcon.off("click");$itemVisibilityIcon.addClass("disabled");
});}function dragDropDone(fromIndex,toIndex){fromIndex--;toIndex--;if(fromIndex<toIndex){toIndex--;}if(fromIndex===toIndex){return;
}disableSidePanelItemsInteraction();Ajax.enqueueRequest(id,"MoveItem",{fromIndex:fromIndex,toIndex:toIndex});
}function addItem(info){var $item=$("<div/>");sidePanelItems.push($item);if(info.className){$item.addClass(info.className);
}$item.addClass("sidePanelItem");$item.attr("index",info.index);$item.data("hash",info.hash);if(info.selected===true){$item.addClass("selected");
}if(info.iconImageUrl){$icon=$("<div/>");$icon.append($("<img src='"+info.iconImageUrl+"'>"));if(info.iconTooltip){$icon.prop("title",info.iconTooltip);
}$item.append($icon);}$item.hover(function(){$(this).addClass("hovered");},function(){$(this).removeClass("hovered");
});if(info.removeHandler){$icon=$("<div/>");$icon.addClass("layerRemoveButton");Spotfire.getSvg("Images/Buttons/Close.svg",function($svg){$icon.append($svg);
});$icon.click(function(e){e.preventDefault();e.stopPropagation();disableSidePanelItemsInteraction();
info.removeHandler(e,id,info.index-1);});$icon.prop("title",info.removeTooltip);$item.append($icon);}if(info.visibilityHandler){var $eyeIcon=$("<div/>");
$eyeIcon.addClass("layerVisibilityButton");if(info.visible===true){Spotfire.getSvg("Images/Plots/WebMapChart/eye.svg",function($svg){$eyeIcon.append($svg);
});}else{Spotfire.getSvg("Images/Plots/WebMapChart/eye_close.svg",function($svg){$eyeIcon.append($svg);
});}$eyeIcon.click(function(e){info.visibilityHandler(e,id,info.index-1);e.preventDefault();e.stopPropagation();
});$eyeIcon.prop("title",Spotfire.Localization.resources.PropertiesPopout_MapChartToggleLayerVisibility);
$item.append($eyeIcon);}var calculateWidth=function(info){if(!info.iconImageUrl&&!info.visibilityHandler){return 200;
}return 142;};var width=calculateWidth(info);$title=$("<div class='sidePanelItemTitle'/>").css({width:width+"px"});
$title.text(info.title);$item.append($title);$item.prop("title",info.title);$panel.append($item);if(info.clickHandler){$item.click(function(e){info.clickHandler(e,id,info);
});}if(info.isDraggable){Spotfire.DragDrop.makeDraggable($item,{effectAllowed:"move",abortOnModifierKeys:true,populateData:function(data){data.dragItemIndex=parseInt($item.attr("index"));
data.dragObjectType="sidePanelItem";}});$item.addClass("draggable");}var acceptDraggedObject=function(e){var data=Spotfire.DragDrop.getSpotfireTransferData(e.originalEvent.dataTransfer);
if(data===undefined||data===null||(data.dragObjectType!=="sidePanelItem")){return false;}return true;
};if(info.isDroppable){Spotfire.DragDrop.makeDroppable($item,{onDragOver:function(e){if(!acceptDraggedObject(e)){return false;
}$(e.currentTarget).addClass("dragover");},onDrop:function(e,data){if(!acceptDraggedObject(e)){return false;
}var $el=$(e.currentTarget);$el.removeClass("dragover");dragDropDone(data.dragItemIndex,parseInt($el.attr("index")));
},onDragLeave:function(e){if(!acceptDraggedObject(e)){return false;}$(e.currentTarget).removeClass("dragover");
}});}}function itemClickHandler(e,id,info){$(".sidePanelItem",$panel).removeClass("selected");$(e.currentTarget).addClass("selected");
Ajax.enqueueRequest(id,"PropertiesItemChanged",info.index);}var addNewItem=function(settings){if(settings){if(settings.typeId==="Spotfire.WebMarkerLayer"||settings.typeId==="Spotfire.WebFeatureLayer"){if(settings.guid){Ajax.enqueueRequest(id,"AddItem",{TypeId:settings.typeId,GeocodingTableId:settings.guid});
}else{Ajax.enqueueRequest(id,"AddItem",{TypeId:settings.typeId,DataTable:settings.text});}}else{Ajax.enqueueRequest(id,"AddItem",{TypeId:settings.typeId});
}return true;}Ajax.enqueueRequest(id,"AddItem");};var addNewLayerMenu=Spotfire.Controls.ContextMenu.create(settings.addNewItemMenuItems,addNewItem);
var itemVisibilityHandler=function(e,id,index){Ajax.enqueueRequest(id,"ToggleItemVisibility",index);};
var itemRemoveHandler=function(e,id,index){Ajax.enqueueRequest(id,"RemoveItem",index);};addItem({index:0,title:settings.generalTitle,hash:settings.hashCode,selected:settings.selectedItemIndex===0,clickHandler:itemClickHandler,iconImageUrl:settings.generalIconImageUrl,iconTooltip:settings.generalIconTooltip});
for(var i=0;i<settings.items.length;i++){addItem({index:i+1,hash:settings.items[i].hash,title:settings.items[i].title,type:settings.items[i].type,visible:settings.items[i].enabled,iconImageUrl:settings.items[i].iconImageUrl,iconTooltip:settings.items[i].iconTooltip,isDraggable:true,isDroppable:true,selected:settings.selectedItemIndex===i+1,clickHandler:itemClickHandler,visibilityHandler:settings.visibilityEnabled?itemVisibilityHandler:undefined,removeHandler:itemRemoveHandler,removeTooltip:settings.removeTooltip});
}var addNewItemClickHandler=function(e){if(settings.addNewItemMenuItems){addNewLayerMenu.show(e.clientX,e.clientY);
}else{addNewItem();return true;}};addItem({index:settings.items.length+1,title:settings.addNewItemButtonText,className:settings.addNewItemButtonClass,isDroppable:true,clickHandler:addNewItemClickHandler});
};addMapTypesAndStyling=function(builder,settings){var allStyles=[];var selectedMapStyle="";var selectedService={};
var style="";if(settings.services===null||settings.services.length===0){return;}builder=builder.expandable(Spotfire.Localization.resources.PropertiesPopoutStandardLayerMapType).searchable().div("grouping").addHeader(Spotfire.Localization.resources.PropertiesPopoutMapType);
for(var service in settings.services){if(settings.services.hasOwnProperty(service)){var supportedStyles=settings.services[service].styles;
var serviceJson={serviceName:service,serviceDisplayName:settings.services[service].displayName,styleName:selectedMapStyle,supportedStyles:supportedStyles};
var value=JSON.stringify(serviceJson);if((settings.serviceId===""&&settings.services[service].isDefault)||settings.serviceId===service){selectedService=serviceJson;
builder=builder.addRadioButton("ChangeMapType",settings.services[service].displayName,value,value,false,"",mapTypeChanged);
}else{builder=builder.addRadioButton("ChangeMapType",settings.services[service].displayName,value,null,false,"",mapTypeChanged);
}if(supportedStyles){for(style in supportedStyles){if(supportedStyles.hasOwnProperty(style)){if(!allStyles.hasOwnProperty(style)){allStyles[style]=supportedStyles[style];
}}}}}}builder.end();builder.searchable().div("grouping").addHeader(Spotfire.Localization.resources.PropertiesPopoutMapStyle);
var $mapStylesContainer=$("<div/>").addClass("mapStyles");var styleSelected=false;for(style in allStyles){if(allStyles.hasOwnProperty(style)){if(!isStyleSupportedByService(selectedService,allStyles[style])){addMapStyleItem(builder.id,style,allStyles[style],false,true);
}else{if(settings.styleName&&settings.styleName===allStyles[style].name){styleSelected=true;addMapStyleItem(builder.id,style,allStyles[style],true,false);
}else{addMapStyleItem(builder.id,style,allStyles[style],false,false);}}}}builder.currentContainer.append($mapStylesContainer);
if(!styleSelected){$(".mapStyles #Auto").addClass("selected");}builder.end();builder.end();builder.end();
function isStyleSupportedByService(theService,theStyle){if(!theService.supportedStyles||theService.supportedStyles.length===0){return false;
}for(var supportedStyle in theService.supportedStyles){if(theService.supportedStyles.hasOwnProperty(supportedStyle)){if(theService.supportedStyles[supportedStyle].name===theStyle.name){return true;
}}}return false;}function addMapStyleItem(id,styleId,styleItem,selected,disabled){var $item=$("<div/>").addClass("styleItem");
$item.attr("id",styleId);if(styleItem.image){$item.append($("<div/>").append($("<img/>").attr("src",styleItem.image).attr("width","40px").attr("onerror",'this.style.display = "none"')));
}if(styleItem.name){$item.append($("<div/>").html(styleItem.name).addClass("highlightText"));}if(selected){$item.addClass("selected");
}if(disabled){$item.addClass("disabled");}$item.click(function(){if($(this).hasClass("disabled")||this.innerText===selectedMapStyle){return;
}$(".mapStyles>.styleItem.selected").removeClass("selected");$(this).addClass("selected");selectedMapStyle=this.id!=="Auto"?this.innerText:"";
mapStyleChanged();Ajax.enqueueRequest(id,"ChangeMapStyle",JSON.stringify({serviceName:selectedService.serviceName,serviceDisplayName:selectedService.serviceDisplayName,styleName:selectedMapStyle}));
});$mapStylesContainer.append($item);}function mapTypeChanged(id,name,theSelectedService){selectedService=JSON.parse(theSelectedService);
if(!selectedService.supportedStyles||selectedService.supportedStyles.length===0){$(".mapStyles>.styleItem").addClass("disabled");
return;}$(".mapStyles .styleItem").each(function(){if(!selectedService.supportedStyles.hasOwnProperty(this.id)){$(this).addClass("disabled");
}else{$(this).removeClass("disabled");}});}function mapStyleChanged(){$("input:radio[name=ChangeMapType]").each(function(){var radioBtnValue=JSON.parse($(this).val());
if(radioBtnValue&&radioBtnValue.hasOwnProperty("styleName")){radioBtnValue.styleName=selectedMapStyle;
$(this).val(JSON.stringify(radioBtnValue));}});}};Spotfire.Visuals.PropertiesPopout.update=function(id,settings){var $popout=$(".PropertiesPopout");
var $container=$(".Container",$popout);var $sidePanel=$(".propertiesSidePanel");var newSelection=false;
if($sidePanel.length){var builder=new build(settings.controlId,$container,[],id);var selectedHash=$sidePanel.data("selectedItemHash");
$sidePanel.remove();addSidePanel($popout,id,builder,settings);if(selectedHash!==settings.selectedItemHash){populateProperties(builder,settings);
newSelection=true;$(".SearchBar .searchField").val("");}}if(newSelection){return;}if($popout.length===1&&$popout.data("id")===id){$.each(settings,function(key,value){var $element=$("[name="+key+"]");
if($.isArray(value)){if($element.hasClass("treeview-container")){handleUpdateTreeviews($element,value);
}else{handleUpdateLists(id,key,value,settings);}}else{if($element.length>0){handleUpdate($element,value,settings);
}}});updateEnabled(settings);}};handleUpdate=function($element,value,settings){if($element.is("input")){if($element.hasClass("inputColor")){$element.spectrum("set",value);
}else{if($element.hasClass("inputShape")){$element.spectrum("set",value.current);}else{switch($element.attr("type")){case"text":$element.val(value);
break;case"radio":$element.each(function(){$(this).prop("checked",value===$(this).val());});break;case"checkbox":$element.each(function(){$(this).prop("checked",value);
});break;default:if($element.hasClass("ui-spinner-input")){$element.val(value);}break;}}}}else{if($element.is("textarea")){$element.val(value);
}else{if($element.is("select")){$element.empty();addOptionItems($element,value);}else{if($element.hasClass("DropDown")){if("items" in value){$element.get(0).DropDownControl.setItems(value.items);
}if("text" in value){var dropDownControl=$element.get(0).DropDownControl;dropDownControl.setText(value.text);
}}else{if($element.hasClass("Tray")){var trayControl=$element.data("trayControl");if("items" in value){trayControl.setItems(value.items);
}if("text" in value){trayControl.setText(value.text,value.color,value.bordercolor);}}else{if($element.hasClass("CustomPropertyControl")){var updatefunction=$element.data("updatefunction");
if(typeof updatefunction==="function"){updatefunction($element,value);}}else{if($element.hasClass("Slider")){Spotfire.Slider.update($element,{value:value,enabled:settings[$element.data("EnableBy")]});
}}}}}}}};handleUpdateLists=function(id,key,value){var $list=$("#"+key);if($list.hasClass("selectableList")){$list.empty();
new build(id,$list).addListItems($list,key,value);if($list.is(":visible")){$list.parent().height($list.height());
performLayout();}}};handleUpdateTreeviews=function($treeview,value){Spotfire.TreeView.update($treeview,{data:value,keepOldState:true});
if($treeview.is(":visible")){$treeview.parent().height($treeview.height());performLayout();}};$.fn.setEnabled=function(enabled,label){return this.each(function(){if(typeof enabled!=="boolean"){return;
}if($(this).is("input")){if($(this).hasClass("ui-spinner-input")){$(this).spinner("option","disabled",!enabled).parent().prev().toggleClass("disabled",!enabled);
}else{if($(this).hasClass("inputColor")){$(this).spectrum(enabled?"enable":"disable");}else{$(this).prop({disabled:!enabled});
Spotfire.Filters.StyledFilters.createStyledInput($(this),13,13);if($(this).attr("type")==="radio"||$(this).attr("type")==="checkbox"){$("label[for='"+$(this).attr("id")+"']").toggleClass("disabled",!enabled);
}if(label){var prev=$(this).prev();if($(this).attr("type")==="text"){if(prev.hasClass("Header")){prev.toggleClass("disabled",!enabled);
}}if($(this).attr("type")==="checkbox"||$(this).attr("type")==="button"){if(prev.hasClass("Header")){prev.toggleClass("disabled",!enabled);
}}else{if($(this).attr("type")==="radio"){prev=$(this).parents(".RadioButtonItemContainer").prev();if(prev.hasClass("Header")){prev.toggleClass("disabled",!enabled);
}}else{$(this).next().toggleClass("disabled",!enabled);}}}}}}else{if($(this).hasClass("ui-slider")){Spotfire.Slider.update($(this),{enabled:enabled});
}else{if($(this).is("h3")){$(this).toggleClass("disabled",!enabled);}else{if($(this).hasClass("DropDown")){this.DropDownControl.setDisabled(!enabled);
}}}}});};updateEnabled=function(settings){switch(settings.TypeId){case"Spotfire.BarChart":updateEnabledBarchart(settings);
break;case"Spotfire.WaterfallChart":updateEnabledWaterfallChart(settings);break;case"Spotfire.ScatterPlot":updateEnabledScatterPlot(settings);
break;case"Spotfire.CrossTable":updateEnabledCrossTable(settings);break;case"Spotfire.LineChart":updateEnabledLineBasedChart(settings,true);
break;case"Spotfire.ParallelCoordinatePlot":updateEnabledLineBasedChart(settings);break;case"Spotfire.Treemap":updateEnabledTrellis(settings);
break;case"Spotfire.PieChart":updateEnabledPieChart(settings);break;case"Spotfire.CombinationChart":updateEnabledCombinationChart(settings);
break;case"Spotfire.WebMarkerLayerVisualization":case"Spotfire.WebFeatureLayerVisualization":updateEnabledMapChart(settings);
case"Spotfire.KpiVisualization":updateEnabledKpiVisualization(settings);break;}};updateEnabledCrossTable=function(settings){updateEnabledMarkingCombinationMethod(settings);
};updateEnabledCombinationChart=function(settings){updateEnabledMarkingCombinationMethod(settings);updateEnabledTrellis(settings);
$("#FormatYButton").setEnabled(settings.YAxisFormattingEnabled,false);$("#FormatXButton").setEnabled(settings.XAxisFormattingEnabled,false);
$("[name='IndividualScalingMode']").setEnabled(settings.IndividualScaling,true);var isStacked=settings.StackMode!=="None";
$("#ReverseSegmentOrder").setEnabled(isStacked,false);};updateEnabledPieChart=function(settings){updateEnabledMarkingCombinationMethod(settings);
updateEnabledTrellis(settings);var hasLabels=settings.LabelPercentage||settings.LabelValue||settings.LabelCategory;
$("[name='LabelVisibility']").setEnabled(hasLabels,true);$("#MaxNumberOfLabels, [name='LabelPosition']").setEnabled(hasLabels&&settings.LabelVisibility!=="None",true);
$("#LabelPercentageLimit, #LabelPercentageDecimalDigits").setEnabled(hasLabels&&settings.LabelVisibility!=="None"&&settings.LabelPercentage,true);
$("#AddColorRulesButton").setEnabled(settings.Colors.EnableAddColorRules,false);};updateEnabledBarchart=function(settings){updateEnabledMarkingCombinationMethod(settings);
updateEnabledTrellis(settings);$("#CompensateMissing").setEnabled(settings.TimeSeries||settings.CompensateMissing,true);
var hasLabels=settings.LabelVisibility!=="None";$("[name='LabelOrientation'], #LabelCompleteBar, #LabelSegments").setEnabled(hasLabels,true);
$("[name='SegmentLabelInformationType']").setEnabled(hasLabels&&settings.LabelSegments,true);$("[name='IndividualScalingMode']").setEnabled(settings.IndividualScaling,true);
$("#MaxNumberOfLabels").setEnabled(hasLabels&&settings.LabelCompleteBar,true);$("#LabelPercentageDecimalDigits").setEnabled(hasLabels&&settings.LabelSegments&&settings.SegmentLabelInformationType==="Percentage",true);
$("#FormatYButton").setEnabled(settings.YAxisFormattingEnabled,false);$("#FormatXButton").setEnabled(settings.XAxisFormattingEnabled,false);
$("#AddColorRulesButton").setEnabled(settings.Colors.EnableAddColorRules,false);var isStacked=settings.StackMode!=="None";
$("#SortSegmentsBySize").setEnabled(isStacked,false);$("#ReverseSegmentOrder").setEnabled(isStacked,false);
};updateEnabledWaterfallChart=function(settings){updateEnabledMarkingCombinationMethod(settings);updateEnabledTrellis(settings);
$("#CompensateMissing").setEnabled(settings.TimeSeries||settings.CompensateMissing,true);var hasLabels=settings.LabelVisibility!=="None";
$("#WaterfallOver_X").setEnabled(!settings.ColorAxisIsContinuous,false);$("#WaterfallOver_Color").setEnabled(!settings.ColorAxisIsContinuous,false);
$("#SortBlocksByValue").setEnabled(!settings.ColorAxisIsContinuous,true);$("#ReverseBlockOrder").setEnabled(!settings.ColorAxisIsContinuous,true);
$("#WaterfallOverTrellis").setEnabled(settings.IsTrellising,false);$(".expandButtonContainer, .expandButton").toggleClass("disabled",!settings.IsTrellising);
$("[name='LabelOrientation'], #LabelRunningTotals, #LabelBlocks").setEnabled(hasLabels,true);$("[name='IndividualScalingMode']").setEnabled(settings.IndividualScaling,true);
$("#FormatYButton").setEnabled(settings.YAxisFormattingEnabled,false);$("#FormatXButton").setEnabled(settings.XAxisFormattingEnabled,false);
$("#AddColorRulesButton").setEnabled(settings.Colors.EnableAddColorRules,false);$("#SubTotalsEnabled_false").setEnabled(settings.TotalBarVisibility,true);
$("#TotalBarName").setEnabled(settings.TotalBarVisibility,true);$("#TotalBarColor").setEnabled(settings.TotalBarVisibility,true);
$("#ConnectingLinesColorIsDefault_false").setEnabled(settings.ShowConnectingLines,false);$("#ConnectingLinesColorIsDefault_true").setEnabled(settings.ShowConnectingLines,false);
$("#ConnectingLinesColor").setEnabled(settings.ShowConnectingLines,false);var enableSubTotalBarRelated=settings.TotalBarVisibility&&settings.SubTotalBarLevels.items.length>0;
$("#SubTotalBarLevels").setEnabled(enableSubTotalBarRelated,true);$("#SubTotalsEnabled_true").setEnabled(enableSubTotalBarRelated,true);
};updateEnabledKpiVisualization=function(settings){$("#IndividualSparklineScaling_false").setEnabled(settings.ShowSparkline,false);
$("#IndividualSparklineScaling_true").setEnabled(settings.ShowSparkline,false);$("#ShowSparklineScale").setEnabled(settings.ShowSparkline,false);
$("#IncludeSparklineOrigin").setEnabled(settings.ShowSparkline,false);$("#FormatYButton").setEnabled(settings.YAxisFormattingEnabled,false);
$("#FormatComparativeButton").setEnabled(settings.ComparativeAxisFormattingEnabled,false);resizeWithContainer("#TitleExpression");
};updateEnabledLineBasedChart=function(settings,compensateMissing){updateEnabledMarkingCombinationMethod(settings);
updateEnabledTrellis(settings);if(compensateMissing){$("#CompensateMissing").setEnabled(settings.TimeSeries||settings.CompensateMissing,true);
}var hasLabels=settings.ShowLineLabels||settings.ShowMarkerLabels;$("[name='IndividualScalingMode']").setEnabled(settings.IndividualScaling||settings.IndividualScalingMode=="Line",true);
$("[name='LabelVisibility']").setEnabled(hasLabels,true);$("#MaxNumberOfLabels").setEnabled(hasLabels&&settings.LabelVisibility!=="None",true);
$("#FormatYButton").setEnabled(settings.YAxisFormattingEnabled,false);$("#FormatXButton").setEnabled(settings.XAxisFormattingEnabled,false);
$("#AddColorRulesButton").setEnabled(settings.Colors.EnableAddColorRules,false);};updateEnabledScatterPlot=function(settings){updateEnabledMarkingCombinationMethod(settings);
updateEnabledTrellis(settings);var hasLabelBy=settings.LabelBy!=="";$("[name='LabelVisibility']").setEnabled(hasLabelBy,true);
$("#MaxNumberOfLabels, #CenterLabels, #ShowEmptyLabels").setEnabled(hasLabelBy&&settings.LabelVisibility!=="None",true);
$("[name='IndividualScalingMode']").setEnabled(settings.IndividualScaling,true);$("#ShapeByExpression").setEnabled(settings.ShapeByMode==="ShapeByColumn",true);
$("#ShapeByMode_Chart").setEnabled(false,false);$("#LineConnectionColor").setEnabled(settings.UseMarkerColor==="UseCustomColor",false);
$("#FormatYButton").setEnabled(settings.YAxisFormattingEnabled,false);$("#FormatXButton").setEnabled(settings.XAxisFormattingEnabled,false);
$("#ReverseDrawingOrder").setEnabled(settings.ReverseDrawingOrderEnabled,false);$("#AddColorRulesButton").setEnabled(settings.Colors.EnableAddColorRules,false);
};updateEnabledMapChart=function(settings){if(!settings.LayerVisualizationType){return;}updateEnabledMarkingCombinationMethod(settings);
updateEnabledTrellis(settings);var hasLabelBy=settings.LabelBy!=="";$("[name='LabelVisibility']").setEnabled(hasLabelBy,true);
if(settings.LayerVisualizationType==="Spotfire.WebMarkerLayer"){$("#MaxNumberOfLabels, #CenterLabels, #ShowEmptyLabels").setEnabled(hasLabelBy&&settings.LabelVisibility!=="None",true);
$("#ShapeByExpression").setEnabled(settings.ShapeByMode==="ShapeByColumn",true);$("#LineConnectionColor").setEnabled(settings.UseMarkerColor==="UseCustomColor",false);
$("#ReverseDrawingOrder").setEnabled(settings.ReverseDrawingOrderEnabled,false);updateShowPositioningMethod(settings);
}$("#AddColorRulesButton").setEnabled(settings.Colors.EnableAddColorRules,false);};var updateShowPositioningMethod=function(settings,duration){if(duration===undefined){duration=delay;
}if(settings.PositioningMethod==="Identifier"){$(".positioningMethodIdentifierContent").show(duration);
$(".positioningMethodLongitudeLatitudeContent").hide(duration);}else{$(".positioningMethodIdentifierContent").hide(duration);
$(".positioningMethodLongitudeLatitudeContent").show(duration);}};updateEnabledTrellis=function(settings){var trellisPanels=settings.TrellisMode==="Panels";
$("#TrellisManual").setEnabled(trellisPanels,true);$("#TrellisManualRows, #TrellisManualColumns").setEnabled(trellisPanels&&settings.TrellisManual,true);
};updateEnabledMarkingCombinationMethod=function(settings){var nr=0,i;for(i=0;i<settings.MarkingLimits.length;
i++){if(settings.MarkingLimits[i].Checked){nr++;if(nr>1){break;}}}$("[name='MarkingCombinationMethod']").setEnabled(nr>1,true);
};performSearch=function($container,search){var trimmed=$.trim(search);if(trimmed===""){return;}var filter=trimmed.split(" ");
var map=[];var i;for(i=0;i<filter.length;i++){map.push(escapeRegexp(filter[i]));}var pattern=new RegExp(map.join("|"),"ig");
traverseToFirstSearchable($container,undefined,function($elem){searchDiv($elem,filter,pattern);});};escapeRegexp=function(str){return(str+"").replace(/([.?*+\^$\[\]\\(){}|\-])/g,"\\$1");
};searchDiv=function($div,search,pattern){var searchText="";traverseToFirstSearchable($div,function($elem){if($elem.hasClass("highlightText")){searchText=searchText+$elem.text().toLowerCase()+" ";
}},function(){});var matches=true;var i;for(i=0;i<search.length&&matches;i++){matches=searchText.indexOf(search[i])>-1;
}if(matches){$div.show(delay);$div.find(".highlightText").each(function(){$(this).html($(this).html().replace(pattern,"<span class='searchResult'>$&</span>"));
});$div.find(".searchable").each(function(){$(this).show(delay);});return true;}var foundInAnyChild=false;
traverseToFirstSearchable($div,undefined,function($elem){foundInAnyChild=searchDiv($elem,search,pattern)||foundInAnyChild;
});if(foundInAnyChild){$div.show(delay);return true;}$div.hide(delay);return false;};traverseToFirstSearchable=function($div,func1,func){$div.children().each(function(){if($(this).hasClass("searchable")){func($(this));
}else{if(func1){func1($(this));}traverseToFirstSearchable($(this),func1,func);}});};customDropDown=function(parentNode,eventReceiverId,id,width,items,text,callbackIdentifiers,noItemsText){this.NoItemsText=noItemsText;
if(!text&&(!items||items.length<1)){text=noItemsText;}this.disabled=false;this.width=width;var $container=$("<div/>").attr("id",id).addClass("DropDown");
var parent=parentNode;$(parent).append($container);this.container=$container.get(0);this.container.DropDownControl=this;
var $dropContainer=$("<div/>").addClass("DropDownContainer");$container.append($dropContainer);this.$labelDiv=$("<div/>").addClass("DropDownText");
$dropContainer.append(this.$labelDiv);this.$button=$("<div/>").addClass("DropDownButton");var getValueOrText=function(value){var val="";
if("value" in value){val=value.value;}else{val=value.text;}return val;};$dropContainer[0].callback=function(value){var val=getValueOrText(value);
var args=[val];if(value.tag!==undefined){args.push(value.tag);}Ajax.enqueueRequest(eventReceiverId,callbackIdentifiers.changeCallback,JSON.stringify(args));
return true;};this.$button.click(function(e){if($container.hasClass("disabledDropDown")){return true;
}var items=$container.data("items");if(items!==null){if(items.length<1){items=[{text:$container.get(0).DropDownControl.NoItemsText,enabled:false}];
}var onClick=function(item){var val=getValueOrText(item);Ajax.enqueueRequest(eventReceiverId,callbackIdentifiers.changeCallback,val);
return true;};var menu=Spotfire.Controls.ContextMenu.create(items,onClick);var offset=$dropContainer.offset();
menu.show(offset.left,offset.top+$dropContainer.outerHeight(true));}else{var args=[$container.attr("id")];
var extraData=$container.data("extraData");if(extraData!==undefined){args.push(extraData);}Ajax.enqueueRequest(eventReceiverId,callbackIdentifiers.showCallback,JSON.stringify(args));
}e.stopPropagation();});$dropContainer.append(this.$button);this.setText(text);if(items){this.setItems(items);
}else{$container.data("items",null);}this.sizeBy(this.width);};customDropDown.prototype.sizeBy=function(width){var useWidth=width-2;
var $container=$(this.container);var actualWidth=Math.min(this.preferedWidth,Math.floor(useWidth));var contentWidth=this.getContentWidth(actualWidth);
this.$labelDiv.css({maxWidth:contentWidth});$container.find(".DropDownContainer").width(actualWidth);
$container.width(width);this.width=width;};customDropDown.prototype.setText=function(text){Spotfire.Visuals.Tooltip.addToolTip(this.container,text);
this.$labelDiv.text(text);this.updateToolTip();var test=$("<span/>").text(text);$(document.body).append(test);
this.preferedWidth=test.width()+6+6+20+1;test.remove();this.sizeBy(this.width);};customDropDown.prototype.setItems=function(items){$(this.container).data("items",items);
var disabled=this.disabled||(items!==null&&items!==undefined&&items.length<1);$(this.container).toggleClass("disabledDropDown",disabled);
this.updateToolTip();};customDropDown.prototype.updateToolTip=function(){if($(this.container).hasClass("disabledDropDown")){Spotfire.Visuals.Tooltip.addToolTip(this.container,this.NoItemsText);
}else{Spotfire.Visuals.Tooltip.addToolTip(this.container,this.$labelDiv.text());}};customDropDown.prototype.setDisabled=function(disabled){this.disabled=disabled;
this.setItems($(this.container).data("items"));};customDropDown.prototype.getContentWidth=function(width){return width-(6+6+20+1);
};Spotfire.Visuals.PropertiesPopout.customDropDown=customDropDown;Spotfire.Visuals.PropertiesPopout.customDropDown.showItems=function(id,items){var $container=$(".DropDownContainer","#"+id);
var container=$container.get(0);var contextitems=items;if(contextitems.length<1){contextitems=[{text:container.DropDownControl.NoItemsText,enabled:false}];
}var menu=Spotfire.Controls.ContextMenu.create(contextitems,container.callback);var offset=$container.offset();
menu.show(offset.left,offset.top+$container.outerHeight(false));};});$(function(){Spotfire.registerNameSpace("Visuals.HeatMap");
Spotfire.Visuals.HeatMap.showPruneSlider=function(parentId,plotCanvasId,pruneLineBounds,dendrogramBounds,color){var onMouseUp;
var parent=document.getElementById(parentId);var isMouseDown=false;var plotCanvasOffset=$("#"+plotCanvasId).offset();
var parentOffset=$(parent).offset();var offsetPoint={x:plotCanvasOffset.left-parentOffset.left,y:plotCanvasOffset.top-parentOffset.top};
var isHorizontal=false;if(pruneLineBounds.width>pruneLineBounds.height){isHorizontal=true;}var lineWidth=pruneLineBounds.width;
var pos=pruneLineBounds.x+lineWidth/2;var previous;if(isHorizontal){lineWidth=pruneLineBounds.height;
pos=pruneLineBounds.y+lineWidth/2;}var div=document.createElement("div");div.style.position="absolute";
var line=document.createElement("div");line.style.position="absolute";if(isHorizontal){div.style.left=dendrogramBounds.x+offsetPoint.x+"px";
div.style.top=pruneLineBounds.y+offsetPoint.y+"px";div.style.height=pruneLineBounds.height+"px";div.style.width=dendrogramBounds.width+"px";
line.style.left="0px";line.style.top=(pruneLineBounds.height/2)-1.5+"px";line.style.height="3px";line.style.width=dendrogramBounds.width+"px";
}else{div.style.left=pruneLineBounds.x+offsetPoint.x+"px";div.style.top=dendrogramBounds.y+offsetPoint.y+"px";
div.style.height=dendrogramBounds.height+"px";div.style.width=pruneLineBounds.width+"px";line.style.left=(pruneLineBounds.width/2)-1.5+"px";
line.style.top="0px";line.style.height=dendrogramBounds.height+"px";line.style.width="3px";}line.style.backgroundColor=color;
line.style.opacity="0.4";line.style.filter="alpha(opacity:40)";line.style.visibility="hidden";if(isHorizontal){div.style.cursor="row-resize";
}else{div.style.cursor="col-resize";}div.ondragstart=function(){return false;};var onMouseMove=function(e){if(isHorizontal){if(!previous){previous=e.pageY;
}var deltaY=e.pageY-previous;pos+=deltaY;if(!isMouseDown&&(pos<pruneLineBounds.y||pos>pruneLineBounds.y+pruneLineBounds.height)){div.removeChild(line);
parent.removeChild(div);$(parent).unbind("mousemove",onMouseMove);$(parent).unbind("mouseup",onMouseUp);
}else{if(pos>dendrogramBounds.y+dendrogramBounds.height){pos=dendrogramBounds.y+dendrogramBounds.height;
}else{if(pos<dendrogramBounds.y){pos=dendrogramBounds.y;}else{previous=e.clientY;}}div.style.top=pos+offsetPoint.y-lineWidth/2+"px";
}}else{if(!previous){previous=e.pageX;}var deltaX=e.pageX-previous;pos+=deltaX;if(!isMouseDown&&(pos<pruneLineBounds.x||pos>pruneLineBounds.x+pruneLineBounds.width)){div.removeChild(line);
parent.removeChild(div);$(parent).unbind("mousemove",onMouseMove);$(parent).unbind("mouseup",onMouseUp);
}else{if(pos>dendrogramBounds.x+dendrogramBounds.width){pos=dendrogramBounds.x+dendrogramBounds.width;
}else{if(pos<dendrogramBounds.x){pos=dendrogramBounds.x;}else{previous=e.clientX;}}div.style.left=pos+offsetPoint.x-lineWidth/2+"px";
}}};onMouseUp=function(){isMouseDown=false;$(parent).unbind("mousemove",onMouseMove);$(parent).unbind("mouseup",onMouseUp);
var x=0;var y=0;if(isHorizontal){y=Math.round(pos);}else{x=Math.round(pos);}var point=new Point(x,y);
if(isIE&&div.children.length===0){return;}Ajax.enqueueRequest(parentId,"PruneDendrogram",JSON.stringify(point));
div.removeChild(line);parent.removeChild(div);};var onMouseDown=function(e){isMouseDown=true;line.style.visibility="visible";
if(isHorizontal){previous=e.pageY;}else{previous=e.pageX;}$(parent).bind("mouseup",onMouseUp);};$(div).bind("mousedown",onMouseDown);
$(parent).bind("mousemove",onMouseMove);parent.appendChild(div);div.appendChild(line);};});$(function(){Spotfire.registerNameSpace("Framework.Recommendations");
function RecommendationsDialog($panel,id,viewid,settings){var $contentPanel=$panel;var footerElements=[];
var requestImagesWaitHandle=null;var dialogWidth=Math.round(Math.min(1300,$(window).outerWidth()*0.8));
var dialogHeight=Math.round(Math.min(800,$(window).outerHeight()*0.9));var plotWidth=0;var plotHeight=0;
var noOfColumns=2;var noOfRows=2;var pageIndex=0;var $leftPanel,$rightPanel,$recommendationsResultDiv,$progressIndicationDiv,$instructionsDiv,$instructionsOverlay,$errorPage,$errorPageOverlay,$topButtonsDiv,$backButton,$dashboardToggle,$dashboardToggleCb;
var scrollbar;var requestCounter=0;var dashboard=false;var resizeTimer;var useTouchHover=Spotfire.capabilities.supportsTouch();
var doubleClickTime=500;var stylizedPreviews=["Images/Recommendations/PieChart.svg","Images/Recommendations/BarChart.svg","Images/Recommendations/Treemap.svg","Images/Recommendations/TrellisedPlot.svg"];
var pageSize=function(){return noOfColumns*noOfRows;};var showImage=function(itemid,url){var $item=$("#Recommendation_"+itemid);
var $preview=$item.children(".PreviewImage");$preview.children("img").attr("src",url);$preview.removeClass("ProgressImage");
$preview.children("svg").remove();};var pendingRequests=[];var createRecommendationTimer;var sendPendingCreateRequests=function(){if(createRecommendationTimer){window.clearTimeout(createRecommendationTimer);
createRecommendationTimer=0;}while(pendingRequests.length>0){Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewid,"CreateRecommendation",JSON.stringify({Id:pendingRequests.shift()}));
}};var addCreateRequest=function(recommendationId){if(recommendationId){pendingRequests.push(recommendationId);
if(!createRecommendationTimer){createRecommendationTimer=window.setTimeout(sendPendingCreateRequests,doubleClickTime);
}}};var createCopyrightInfoItem=function(copyrightInfo,$copyright){if(!copyrightInfo||copyrightInfo.length===0){return;
}$copyright.show();var $infoText=$("<div />").addClass("CopyrightText");var i=0;for(i=0;i<copyrightInfo.length;
i++){$("<div />").text(copyrightInfo[i]).appendTo($infoText);}$infoText.appendTo($copyright).hide();var $infoIcon=$("<div />").addClass("CopyrightIcon").text("i").appendTo($copyright);
$infoIcon.click(function(evt){evt.stopPropagation();$infoText.toggle();});};var createMiniLegendItem=function(item,axisType,$miniLegend,axisName){if(!item.LegendAxisColumns[axisType]){return;
}axisName=axisName||axisType;var title=Spotfire.Localization.resources["Recommendations_MiniLegend"+axisName+"By"];
var $axisWrapper=$("<span />").attr("title",Spotfire.Utilities.formatString(title,item.LegendAxisColumns[axisType])).appendTo($miniLegend);
var $icon=$("<span />").addClass(axisName+"Axis AxisIcon").appendTo($axisWrapper);$("<span />").addClass("AxisExpression").text(item.LegendAxisColumns[axisType]).appendTo($axisWrapper);
Spotfire.getSvg("Images/Recommendations/"+axisName+".svg",function(svg){$icon.append(svg);});};var updateItem=function(item,$item){if(!$item){$item=$("#Recommendation_"+item.Id);
if($item.length===0){return;}}$item.children(".RecommendationTitle").text(item.Title);$item.toggleClass("NoDrill",!item.CanDrill);
var $miniLegend=$item.children(".MiniLegend");$miniLegend.empty();var $copyright=$item.children(".Copyright");
$copyright.empty();if(item.CopyrightInfo){createCopyrightInfoItem(item.CopyrightInfo,$copyright);}if(item.LegendAxisColumns){createMiniLegendItem(item,"Color",$miniLegend);
createMiniLegendItem(item,"Shape",$miniLegend);createMiniLegendItem(item,"Size",$miniLegend);createMiniLegendItem(item,"Marker",$miniLegend);
createMiniLegendItem(item,"Panels",$miniLegend,"Trellis");}if(!$miniLegend.is(":empty")){$miniLegend.show();
var $expressions=$miniLegend.find(".AxisExpression");if($expressions.length>0){var maxWidth=$item.innerWidth()/$expressions.length-13-16;
$expressions.css("max-width",maxWidth+"px");}}};var createItem=function(item){var $item=$("<div />").addClass("RecommendationResult");
$item.css({height:plotHeight+60+"px",width:plotWidth+"px"});var $title=$("<div />").addClass("RecommendationTitle");
var $preview=$("<div />").addClass("PreviewImage").css({width:plotWidth,height:plotHeight}).appendTo($item);
var $minilegend=$("<div />").addClass("MiniLegend").hide();var $copyright=$("<div />").addClass("Copyright").hide();
$item.append($title).append($minilegend).append($copyright);if(item){$item.attr("id","Recommendation_"+item.Id).data("id",item.Id);
$("<img />").css({width:plotWidth,height:plotHeight}).data("id",item.Id).appendTo($preview);var $createArea=$("<div />").addClass("CreateRecommendation").insertAfter($preview);
$("<button />").attr("type","button").addClass("CreateRecommendationButton").append($("<span />").text(Spotfire.Localization.resources.Recommendations_AddThisVisualization)).appendTo($createArea);
var $drillArea=$("<div />").addClass("DrillRecommendation").insertAfter($preview);$("<button />").attr("type","button").addClass("DrillRecommendationButton").append($("<span />").text(Spotfire.Localization.resources.Recommendations_MoreLikeThisVisualization)).appendTo($drillArea);
var $createdEffect=$("<div />").addClass("CreatedRecommendation").insertAfter($preview);$createdEffect.css("padding-top",$item.innerHeight()/2-8+"px");
$preview.addClass("ProgressImage");window.setTimeout(function(){if($preview.hasClass("ProgressImage")){Spotfire.getSvg("images/Progress/CircularProgressAnimation.svg",function(svg){if($preview.hasClass("ProgressImage")){$preview.append(svg);
}});}},1000);}if(item){updateItem(item,$item);}return $item;};var createStylizedPlot=function(index,$parent){var $stylizedItem=createItem(null).appendTo($parent);
var $imgWrapper=$stylizedItem.children(".PreviewImage");var $paddedImage=$("<div />").addClass("StylizedPreview").appendTo($imgWrapper);
var svgUrl=stylizedPreviews[index%stylizedPreviews.length];Spotfire.getSvg(svgUrl,function(svg){$paddedImage.append(svg);
$imgWrapper.css({top:"50%","margin-top":-plotHeight/2});});$paddedImage.css("margin","auto");};var applyLayout=function(){var resultPanelWidth=Math.floor($contentPanel.innerWidth()-$leftPanel.outerWidth());
var resultPanelHeight=$recommendationsResultDiv.innerHeight();$recommendationsResultDiv.outerHeight($contentPanel.outerHeight());
$recommendationsResultDiv.outerWidth(resultPanelWidth);$rightPanel.outerHeight($contentPanel.outerHeight());
$rightPanel.outerWidth(resultPanelWidth);var noOfVisibleRows=resultPanelHeight>400?2:1;noOfColumns=resultPanelWidth>600?2:1;
noOfRows=noOfVisibleRows+1;var verticalMargin=15+30+2;var horizontalMargin=80;var rightmargin=15+(scrollbar?scrollbar.getVScrollbarSize(true):13);
var nextRowPixels=60;plotWidth=Math.floor((resultPanelWidth-rightmargin)/noOfColumns)-verticalMargin;
plotHeight=Math.floor((resultPanelHeight-nextRowPixels)/noOfVisibleRows)-horizontalMargin;$instructionsDiv.children(".StylizedPlots").remove();
$instructionsDiv.outerHeight($contentPanel.outerHeight());$errorPage.outerHeight($contentPanel.outerHeight());
var $stylizedPlots=$("<div />").addClass("StylizedPlots").prependTo($instructionsDiv);var index;for(index=0;
index<pageSize();index++){createStylizedPlot(index,$stylizedPlots);}var scrollbarWidth=scrollbar?scrollbar.getVScrollbarSize(true):0;
$instructionsOverlay.css("left",0);$instructionsOverlay.css("top",($instructionsDiv.innerHeight()-$instructionsOverlay.outerHeight())/2+"px");
$instructionsOverlay.css("left",($instructionsDiv.innerWidth()-$instructionsOverlay.outerWidth()-scrollbarWidth)/2+"px");
$errorPageOverlay.css("top",($errorPage.innerHeight()-$errorPageOverlay.outerHeight())/2+"px");$errorPageOverlay.css("left",($errorPage.innerWidth()-$errorPageOverlay.outerWidth()-scrollbarWidth)/2+"px");
if(scrollbar){scrollbar.refresh();}$topButtonsDiv.outerWidth($rightPanel.innerWidth()-(scrollbar?scrollbar.getVScrollbarSize():0));
};var createSetting=function(name,type,json,onChange,classname,text){var $setting=$("<div />").addClass(classname);
var $input=$("<input />").attr("name",name).attr("id",name).val(json[name]).appendTo($setting);$setting.append($("<label />").text(text||name).attr("for",name));
$input.on("change",onChange);if(type==="bool"){$input.attr("type","checkbox");if(json[name]){$input.attr("checked","checked");
}}return $setting;};var showMoreButton=function(show){if(show){$recommendationsResultDiv.children(".MoreRecommendationsButton").remove();
var $more=$("<button />").attr("type","button").text(Spotfire.Localization.resources.Recommendations_MoreRecommendations).addClass("MoreRecommendationsButton");
$recommendationsResultDiv.append($more);$more.css("left",-($more.outerWidth()+(scrollbar?scrollbar.getVScrollbarSize(true):13))/2+"px");
}else{$recommendationsResultDiv.children(".MoreRecommendationsButton").remove();}};var showTopArea=function(showBackButton,showDashboardMode){$topButtonsDiv.toggle(showBackButton||showDashboardMode);
$dashboardToggle.toggle(showDashboardMode);$backButton.toggle(showBackButton);$recommendationsResultDiv.css("padding-top","0");
var height=0;if(showBackButton||showDashboardMode){height=$topButtonsDiv.outerHeight()-12;}$recommendationsResultDiv.outerHeight($contentPanel.innerHeight()-height);
$recommendationsResultDiv.css("padding-top",height+"px");};var showProgress=function(){$progressIndicationDiv.show();
};var update=function(result){if(!result){return;}if(result.Generation<requestCounter){return;}if(result.containsErrors){$recommendationsResultDiv.find(".RecommendationResult").remove();
$instructionsDiv.hide();$progressIndicationDiv.hide();$errorPage.show();applyLayout();return;}pageIndex=result.NextPageIndex-1;
$errorPage.hide();$instructionsDiv.hide();$progressIndicationDiv.hide();dashboard=result.InDashboardMode;
$dashboardToggleCb.attr("checked",dashboard?undefined:"checked");if(result.PageIndex===0){$recommendationsResultDiv.find(".RecommendationResult").remove();
$recommendationsResultDiv.scrollTop(0);if(!result.Recommendations||result.Recommendations.length===0){$instructionsDiv.show();
dashboard=false;applyLayout();}}$recommendationsResultDiv.find(".BottomPadding").remove();var i;for(i=0;
i<result.Recommendations.length;i++){$recommendationsResultDiv.append(createItem(result.Recommendations[i]));
}$recommendationsResultDiv.append($("<div />").addClass("BottomPadding"));if(scrollbar){scrollbar.refresh();
}$topButtonsDiv.outerWidth($rightPanel.innerWidth()-(scrollbar?scrollbar.getVScrollbarSize():0));showMoreButton(result.HasMore);
showTopArea(result.DrillDepth>0,result.SuggestDashboardMode||dashboard);};var requestRecommendations=function(requestAll,useServerState,action,data){applyLayout();
var requestPageSize=pageSize();var requstPageIndex=pageIndex;var args={Generation:++requestCounter,NoOfPlots:requestPageSize,Width:plotWidth,Height:plotHeight,PageIndex:requstPageIndex,Dashboard:dashboard,UseServerState:useServerState};
args.Action=action;if(action==="drilldown"){args.DrilldownFrom=data;}Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewid,"GenerateRecommendations",JSON.stringify(args));
};var onAutoShowDialog=function(){Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewid,"DoNotAutoShowRecommendationsUi",JSON.stringify({Val:$("#DoNotAutoShowRecommendationsUi").prop("checked")}));
};var closeDialog=function(){$contentPanel.dialog("close");};var onCloseCallback=function(){sendPendingCreateRequests();
Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewid,"CloseDialog",null);$(document).triggerHandler("sf-onCloseRecommendationsDialog");
Spotfire.MultipleViews.UnregisterUnlockCallback(closeDialog);$contentPanel.remove();};Spotfire.MultipleViews.RegisterUnlockCallback(closeDialog);
var resetPage=function(){dashboard=false;pageIndex=0;};var toggleDashboardMode=function(dashboardMode){resetPage();
dashboard=dashboardMode;requestRecommendations(false,false,"reload");};var getCurrentId=function($el){return $el.closest(".RecommendationResult").data("id");
};var onResize=function(){applyLayout();if(resizeTimer){window.clearTimeout(resizeTimer);}resizeTimer=window.setTimeout(function(){if(requestImagesWaitHandle){window.clearTimeout(requestImagesWaitHandle);
}$("#"+settings.DataPanelCanvasWebControlId).trigger("panelResize");requestRecommendations(true,true,"reload");
},500);};$leftPanel=$("<div/>").addClass("Panel Left").appendTo($contentPanel);$leftPanel.addClass("sf-element sf-element-styled-dialog");
$leftPanel.css("height","100%");$("<div />").appendTo($leftPanel).attr("id",settings.DataPanelCanvasWebControlId).css("height","100%").css("overflow","hidden");
$rightPanel=$("<div />").addClass("Panel Right").appendTo($contentPanel);$errorPage=$("<div />").addClass("Error").appendTo($rightPanel).hide();
$errorPageOverlay=$("<div />").addClass("ErrorOverlay").appendTo($errorPage);var $errorPageIcon=$("<div />").addClass("ErrorIcon").appendTo($errorPageOverlay);
Spotfire.getSvg("Images/Recommendations/NoRecommendations.svg",function(svg){$errorPageIcon.append(svg);
});$("<div />").html(Spotfire.Localization.resources.Recommendations_ErrorText).appendTo($errorPageOverlay);
$instructionsDiv=$("<div />").addClass("Instructions").appendTo($rightPanel).hide();$instructionsOverlay=$("<div />").addClass("InstructionsOverlay").html(Spotfire.Localization.resources.Recommendations_HelpText).appendTo($instructionsDiv);
var $instructionsArrow=$("<div />").addClass("Arrow").appendTo($instructionsOverlay);Spotfire.getSvg("Images/Recommendations/ExplanationArrow.svg",function(svg){$instructionsArrow.append(svg);
});$recommendationsResultDiv=$("<div />").addClass("Recommendations").appendTo($rightPanel);if(useTouchHover){$recommendationsResultDiv.addClass("NoHover");
}window.setTimeout(function(){scrollbar=$recommendationsResultDiv.StyledScrollbar();},0);$topButtonsDiv=$("<div />").addClass("TopButtonArea").appendTo($rightPanel).hide();
$backButton=$("<span />").addClass("Back").appendTo($topButtonsDiv);var $backButtonArrow=$("<span />").addClass("DrillUpButtonArrow").appendTo($backButton);
Spotfire.getSvg("Images/Recommendations/Back.svg",function(svg){$backButtonArrow.append(svg);});$("<span />").text(Spotfire.Localization.resources.Recommendations_BackButtonText).addClass("DrillUpButton").appendTo($backButton);
$dashboardToggle=$("<span />").addClass("DashboardButton").attr("title",Spotfire.Localization.resources.Recommendations_ToggleDashboardModeTooltip).appendTo($topButtonsDiv);
$dashboardToggleCb=$("<input />").attr("type","checkbox").attr("id","toggleDashboardMode");var $dashboardToggleLabel=$("<label />").attr("for","toggleDashboardMode").text(Spotfire.Localization.resources.Recommendations_ToggleDashboardMode);
$dashboardToggle.append($dashboardToggleCb).append($dashboardToggleLabel);$progressIndicationDiv=$("<div />").addClass("RecommendationProgressOverlay").appendTo($rightPanel);
var $progressSpinner=$("<div />").addClass("RecommendationProgress").appendTo($progressIndicationDiv);
Spotfire.getSvg("images/Progress/CircularProgressAnimation.svg",function(svg){$progressSpinner.append(svg);
});$contentPanel.attr("title",Spotfire.Localization.resources.Recommendations_Title);$recommendationsResultDiv.on("click",".MoreRecommendationsButton",function(){$(this).attr("disabled","disabled");
pageIndex++;requestRecommendations(false,false,"more");});$topButtonsDiv.on("click",".Back",function(){pageIndex=0;
requestRecommendations(false,false,"back");});$dashboardToggleCb.on("change",function(){toggleDashboardMode(!$dashboardToggleCb.is(":checked"));
});if(useTouchHover){$contentPanel.on("click",".RecommendationResult",function(){$(".DrillRecommendationTouchHover").removeClass("DrillRecommendationTouchHover");
$(".CreateRecommendationTouchHover").removeClass("CreateRecommendationTouchHover");$(this).children(".DrillRecommendation").addClass("DrillRecommendationTouchHover");
$(this).children(".CreateRecommendation").addClass("CreateRecommendationTouchHover");});}$contentPanel.on("click",(useTouchHover?".DrillRecommendationTouchHover":".DrillRecommendation"),function(){pageIndex=0;
requestRecommendations(false,false,"drilldown",getCurrentId($(this)));return false;});var isWithinDoubleClickTime=function(startTime){return Date.now()-startTime<doubleClickTime;
};$contentPanel.on("mouseenter",".HideUntilReEnter",function(){var createdAt=$(this).data("CreatedAt");
if(createdAt&&!isWithinDoubleClickTime(createdAt)){$(this).removeClass("HideUntilReEnter");}});$contentPanel.on("click",".HideUntilReEnter",function(){var createdAt=$(this).data("CreatedAt");
if(createdAt&&isWithinDoubleClickTime(createdAt)){closeDialog();}});$contentPanel.on("click",(useTouchHover?".CreateRecommendationTouchHover":".CreateRecommendation"),function(){var time=500;
var $item=$(this).closest(".RecommendationResult").addClass("Created");if(useTouchHover){$(".DrillRecommendationTouchHover").removeClass("DrillRecommendationTouchHover");
$(".CreateRecommendationTouchHover").removeClass("CreateRecommendationTouchHover");}else{$item.addClass("HideUntilReEnter");
$item.data("CreatedAt",new Date().getTime());}addCreateRequest(getCurrentId($(this)));var $img=$item.find("img").first();
var width=$img.outerWidth();var height=$img.outerHeight();var $animation=$img.clone();$animation.insertAfter($img);
$animation.animate({left:width/2,top:height/2,width:0,height:0,opacity:0.6},time);window.setTimeout(function(){$animation.remove();
},time);return false;});var buttons=[{id:"okButton",text:Spotfire.Localization.resources.Close,disabled:false,click:closeDialog}];
footerElements.push(createSetting("DoNotAutoShowRecommendationsUi","bool",settings,onAutoShowDialog,"AutoShowRecommendationsUi",Spotfire.Localization.resources.Recommendations_AutoShow));
var modal=!Spotfire.isProfessional();$contentPanel.dialog({resizable:true,resize:onResize,width:dialogWidth,height:dialogHeight,buttons:buttons,modal:modal,close:onCloseCallback,stack:false,minWidth:700,minHeight:400,dialogClass:modal?"RecommendationsDialog framework-dialog":"RecommendationsDialog framework-dialog non-modal"});
var $dialog=$contentPanel.closest(".ui-dialog");$dialog.css("top",Math.round($dialog.offset().top)+"px");
$dialog.css("left",Math.round($dialog.offset().left)+"px");var splitterDragWaitHandle;Spotfire.UI.resizable($leftPanel,{handles:"e",minWidth:"160",resize:function(){$leftPanel.css("height","100%");
applyLayout();$("#"+settings.DataPanelCanvasWebControlId).trigger("panelResize");if(splitterDragWaitHandle){window.clearTimeout(splitterDragWaitHandle);
}splitterDragWaitHandle=window.setTimeout(function(){requestRecommendations(true,true,"reload");},300);
}});Spotfire.DataPanel.initialize($("#"+settings.DataPanelCanvasWebControlId),settings.DataPanelWebViewId);
var $buttonPane=$contentPanel.siblings(".ui-dialog-buttonpane");var elementIndex;for(elementIndex=0;elementIndex<footerElements.length;
elementIndex++){$buttonPane.append(footerElements[elementIndex]);}var addedToPage=function(itemid,pageid){var time=500;
var $createOverlay=$("#Recommendation_"+itemid).find(".CreatedRecommendation");$createOverlay.toggleClass("Failed",false).text(Spotfire.Localization.resources.Recommendations_AddedToPage);
$createOverlay.animate({opacity:0},time).animate({opacity:1},time);};var failedToCreate=function(itemid){var time=500;
var $createOverlay=$("#Recommendation_"+itemid).find(".CreatedRecommendation");$createOverlay.toggleClass("Failed",true).text(Spotfire.Localization.resources.Recommendations_FailedToCreateVisualization);
$createOverlay.animate({opacity:0},time).animate({opacity:1},time);};window.setTimeout(function(){applyLayout();
requestRecommendations(true,true,"reload");},0);Spotfire.Filters.StyledFilters.createStyledInput($buttonPane,13,13);
Spotfire.Filters.StyledFilters.createStyledInput($contentPanel,13,13);this.updateItem=updateItem;this.showImage=showImage;
this.update=update;this.showProgress=showProgress;this.addedToPage=addedToPage;this.failedToCreate=failedToCreate;
}Spotfire.Framework.Recommendations.showDialog=function(id,viewid,settings){if($(".RecommendationsDialogContent").length!==0){$(".RecommendationsDialogContent").dialog("destroy").remove();
}var $contentPanel=$("<div></div>").addClass("RecommendationsDialogContent");var dialog=new RecommendationsDialog($contentPanel,id,viewid,settings);
$(document).triggerHandler("sf-onShowRecommendationsDialog");$contentPanel.data("dialog",dialog);};Spotfire.Framework.Recommendations.closeDialog=function(){$(".RecommendationsDialogContent").dialog("close");
};Spotfire.Framework.Recommendations.updateDialog=function(viewid,settings){var $dialog=$(".RecommendationsDialogContent");
if($dialog.length===0){return;}$dialog.data("dialog").update(settings);};Spotfire.Framework.Recommendations.showImage=function(itemid,url){var $dialog=$(".RecommendationsDialogContent");
if($dialog.length===0){return;}$dialog.data("dialog").showImage(itemid,url);};Spotfire.Framework.Recommendations.updateResult=function(item){var $dialog=$(".RecommendationsDialogContent");
if($dialog.length===0){return;}$dialog.data("dialog").updateItem(item);};Spotfire.Framework.Recommendations.showAddedToPage=function(itemid,pageid){var $dialog=$(".RecommendationsDialogContent");
if($dialog.length===0){return;}$dialog.data("dialog").addedToPage(itemid,pageid);};Spotfire.Framework.Recommendations.showFailedToCreate=function(itemid){var $dialog=$(".RecommendationsDialogContent");
if($dialog.length===0){return;}$dialog.data("dialog").failedToCreate(itemid);};Spotfire.Framework.Recommendations.showProgress=function(){var $dialog=$(".RecommendationsDialogContent");
if($dialog.length===0){return;}$dialog.data("dialog").showProgress();};});$(function(){var generation=-1;
var startValuePicker;var endValuePicker;var updateRuleDialog=function(settings){var ruleBuilder=$(".RuleBuilder").data("RuleBuilder");
generation=settings.generation;ruleBuilder.update(settings);};var setOkEnabled=function(val){var enabled=false;
if(startValuePicker.isVisible(val)&&endValuePicker.isVisible(val)){enabled=startValuePicker.isValid(val)&&endValuePicker.isValid(val);
}else{if(startValuePicker.isVisible(val)){enabled=startValuePicker.isValid(val);}else{if(endValuePicker.isVisible(val)){enabled=endValuePicker.isValid(val);
}}}$("#okButton").prop("disabled",!enabled).toggleClass("sfpc-disabled",!enabled);};var closeRuleDialog=function(){Spotfire.Controls.ModalDialog.close($(".RuleBuilder"));
};var showRuleDialog=function(settings){generation=settings.generation;var $rule=$("<div/>").addClass("RuleBuilder");
var buttons=[{id:"okButton",text:Spotfire.Localization.resources.Ok,isDefault:true,click:function(){Ajax.enqueueRequest(settings.controlId,"commit",JSON.stringify({generation:generation}));
return true;}},{text:Spotfire.Localization.resources.Cancel,isCancel:true}];var dialog=Spotfire.Controls.ModalDialog.initialize($rule,{modal:true,type:"wrapped",title:settings.Add?Spotfire.Localization.resources.RuleBuilder_AddRule:Spotfire.Localization.resources.RuleBuilder_EditRule,buttons:buttons,resizable:true,minWidth:350,minHeight:352,close:function(){Ajax.enqueueRequest(settings.controlId,"close",JSON.stringify({generation:generation}));
},preventAutoClose:function(){Spotfire.Focus.blur();window.setTimeout(function(){Ajax.enqueueRequest(settings.controlId,"commit",JSON.stringify({generation:generation}));
},0);return true;},height:"auto",width:400});$("<div/>").text(Spotfire.Localization.resources.RuleBuilder_RuleType).css("height","11px").appendTo($rule);
var $dropdown=$("<div />");$rule.append($dropdown);Spotfire.Controls.DropDown.initialize($dropdown,{values:settings.options,selectedIndex:settings.index,useIndexAsValueId:true,onSelected:function(item,index){Ajax.enqueueRequest(settings.controlId,"setOption",JSON.stringify({generation:generation,index:index}));
}});var $pickerContainers=Spotfire.Flex.item({container:"horizontal",fill:true});$rule.append($pickerContainers);
var $startValuePicker=$("<div/>").appendTo($pickerContainers);startValuePicker=Spotfire.Visuals.ValuePicker.initialize($startValuePicker,setOkEnabled);
var $endValuePicker=$("<div/>").css("margin-left","6px").appendTo($pickerContainers);endValuePicker=Spotfire.Visuals.ValuePicker.initialize($endValuePicker,setOkEnabled);
var $color;var color=settings.color;if(settings.color!==undefined){$("<div/>").addClass("sf-color-rule-color-label").text(Spotfire.Localization.resources.RuleBuilder_Color).appendTo($rule);
$color=$("<div/>").addClass("sf-color-rule-color-picker").appendTo($rule).css({width:"16px",height:"16px"}).on("click",function(){var item=settings.colorPalette;
item.current=color;item.top=3;Spotfire.Picker.show(item,$(this),"ColorPicker",function(result){Ajax.enqueueRequest(settings.controlId,"Color",JSON.stringify({generation:generation,color:result.toHexString(false)}));
});});}var $displayName;if(settings.manualDisplayName!==undefined){$("<div/>").addClass("sf-color-rule-color-label").text(Spotfire.Localization.resources.RuleBuilder_DisplayName).appendTo($rule);
var $displyNameContainer=Spotfire.Flex.item({container:"horizontal",fill:true});$rule.append($displyNameContainer);
$displayName=$("<input type='text'/>").addClass("sf-element-input sf-color-rule-display-name-label").css({width:"100%","-ms-flex-align":"start","-ms-flex-negative":"1","-ms-flex-positive":"1"});
$displayName.appendTo($displyNameContainer);$displayName.blur(function(){Ajax.enqueueRequest(settings.controlId,"setDisplayName",JSON.stringify({generation:generation,displayName:$displayName.val()}));
});}var ruleModel={update:function(newSettings){generation=newSettings.generation;if(settings.manualDisplayName!==undefined&&!$displayName.is(":focus")){$displayName.val(newSettings.manualDisplayName);
}if(settings.color!==undefined){color=newSettings.color;var borderColor=new Spotfire.Utilities.SafeColor(color);
borderColor.adjustBrightness(-100);$color.css({"background-color":color,border:"solid "+borderColor.toHexString()+" 1px"});
}startValuePicker.update(newSettings.startValuePickerSettings);endValuePicker.update(newSettings.endValuePickerSettings);
dialog.update("height","auto");}};ruleModel.update(settings);setOkEnabled();$rule.data("RuleBuilder",ruleModel);
return ruleModel;};Spotfire.registerNameSpace("Visuals.RuleBuilder",{showRuleDialog:showRuleDialog,updateRuleDialog:updateRuleDialog,closeRuleDialog:closeRuleDialog});
});(function($){function eventHandler(e){var event=$.event.fix(e||window.event);event.type="scrollwheel";
if(e!==undefined){event.pageX=e.pageX;event.pageY=e.pageY;}else{event.pageX=window.event.pageX;event.pageY=window.event.pageY;
}if(event.originalEvent.wheelDeltaX!==undefined){var scrollDeltaX=event.originalEvent.wheelDeltaX;var scrollDeltaY=event.originalEvent.wheelDeltaY;
event.scrollWheel=-scrollDeltaY/120;event.scrollWheelX=-scrollDeltaX/120;event.scrollWheelY=-scrollDeltaY/120;
}else{if(event.originalEvent.wheelDelta!==undefined){var wheelDelta=event.originalEvent.wheelDelta;event.scrollWheel=-wheelDelta/120;
event.scrollWheelX=0;event.scrollWheelY=-wheelDelta/120;}else{if(event.originalEvent.detail!==undefined){var detail=event.originalEvent.detail;
if(event.originalEvent.axis===1){event.scrollWheel=0;event.scrollWheelX=detail/3;event.scrollWheelY=0;
}else{event.scrollWheel=detail/3;event.scrollWheelX=0;event.scrollWheelY=detail/3;}}}}return $.event.dispatch.call(this,event);
}$.event.special.scrollwheel={setup:function(){if(this.addEventListener){this.addEventListener("DOMMouseScroll",eventHandler,false);
this.addEventListener("mousewheel",eventHandler,false);}else{this.onmousewheel=eventHandler;}},teardown:function(){if(this.removeEventListener){this.removeEventListener("DOMMouseScroll",eventHandler,false);
this.removeEventListener("mousewheel",eventHandler,false);}else{this.onmousewheel=null;}}};$.fn.extend({scrollwheel:function(fn){return fn?this.bind("scrollwheel",fn):this.trigger("scrollwheel");
},unscrollwheel:function(fn){return this.unbind("scrollwheel",fn);}});})(jQuery);$(function(){var dialogClass=function(){var controls={};
var serverSettings=null;var additionalSettingsGeneration=0;var searchExpression="";var userInput=function(){var inputEnabled=true;
var inputEnabledEvent=jQuery.Event("inputEnabled");return{enabled:function(enabled){if(enabled!==undefined){inputEnabled=enabled;
controls.dialog.trigger(inputEnabledEvent);}return inputEnabled;}};}();var selectedIndicesClass=function(){var indices=[];
var columnCount=0;this.add=function(ranges){var j,i,range;for(j=0;j<ranges.length;j++){range=ranges[j];
if(range.operation==="remove"){indices=[];return;}if(range.operation==="replace"){indices=[];}for(i=Math.max(0,range.low);
i<=Math.min(range.high,this.columnCount()-1);i++){if(!contains(i)){indices.push(i);}}}};this.set=function(selectedIndices){indices=selectedIndices;
};this.clear=function(){indices=[];};this.get=function(){return indices;};this.move=function(move){var newIndices=[];
var i;for(i=0;i<indices.length;i++){indices[i]=indices[i]+move;}return newIndices;};this.count=function(){return indices.length;
};this.columnCount=function(count){if(count!==undefined){columnCount=count;}return columnCount;};var contains=function(index){var i;
for(i=0;i<indices.length;i++){if(indices[i]==index){return true;}}return false;};this.contains=contains;
};this.show=function(settings){serverSettings=settings;var padding=0;var columnWidth=210;var buttonsColumnWidth=120;
var dialogWidth=2*padding+2*columnWidth+buttonsColumnWidth;var dataTableHeight=49;var dialogHeight=531;
dialogHeight=(serverSettings.dataTables.length>0)?dialogHeight:(dialogHeight-dataTableHeight);var columnTop=(serverSettings.dataTables.length>0)?dataTableHeight:5;
var leftSelected=new selectedIndicesClass();var rightSelected=new selectedIndicesClass();var setAggregationMethodAction=function(){var selectedIndices=rightSelected.get();
if(selectedIndices.length>0){var methodId=controls.aggregationMethod.val();var args={methodId:methodId,selectedIndices:selectedIndices};
Spotfire.Dxp.Web.Forms.AjaxService.Modify(serverSettings.viewId,"SetAggregationMethod",JSON.stringify(args));
userInput.enabled(false);}};var addSettingsPanel=function(parentContainer,data){var panel=$("<div></div>");
var showInfoText=function(text){var info=$("<div></div>");info.text(text);info.css({"margin-top":"17px",color:"#909090"});
panel.append(info);};if(data&&(data.methods.length>0||data.autoBinning.enabled)){var aggregationContainer=$("<div></div>");
aggregationContainer.css("padding-top","17px");var label=$("<p></p>");label.text(Spotfire.Localization.resources.SelectColumnsDialog_Aggregation+":");
label.addClass("SelectColumnsDialogLabel");label.css("margin-top","0px");if(data.methods.length===0){label.addClass("SelectColumnsLabelDisabled");
}aggregationContainer.append(label);controls.aggregationMethod=addAggregationMethodDropdown(data.methods,data.selectedMethod,aggregationContainer);
panel.append(aggregationContainer);enableControl(controls.aggregationMethod,data.methods.length>0);var autoBinContainer=$("<div></div>");
autoBinContainer.css("padding-top","6px");var autoBinCheckBox=$("<input type='checkbox'></input>");autoBinCheckBox.addClass("SelectColumnsCheckbox");
var autoBinLabel=$("<label></label>");autoBinLabel.append($("<span/>").text(Spotfire.Localization.resources.SelectColumnsDialog_AutoBinColumn));
autoBinLabel.prepend(autoBinCheckBox);autoBinContainer.append(autoBinLabel);panel.append(autoBinContainer);
enableControl(autoBinCheckBox,data.autoBinning.checkBoxEnabled);autoBinCheckBox.prop("checked",data.autoBinning.checked);
if(!data.autoBinning.checkBoxEnabled){autoBinLabel.addClass("SelectColumnsLabelDisabled");}var numberOfBinsContainer=$("<div></div>");
var indent=$("<input type='checkbox'></input>");indent.css("visibility","hidden");numberOfBinsContainer.append(indent);
var span=$("<span></span>");span.text(Spotfire.Localization.resources.SelectColumnsDialog_NumberOfBins+":");
if(!data.autoBinning.numberOfBinsEnabled){span.addClass("SelectColumnsLabelDisabled");}var numberOfBins=$("<input type='text'></input>");
numberOfBins.css("width","25px");numberOfBins.css("margin-left","4px");numberOfBins.val(data.autoBinning.numberOfBins);
enableControl(numberOfBins,data.autoBinning.numberOfBinsEnabled);span.append(numberOfBins);numberOfBinsContainer.append(span);
panel.append(numberOfBinsContainer);var autoBinningChanged=function(){var bins=parseInt(numberOfBins.val(),10);
if(isNaN(bins)){bins=-1;}var args={enable:autoBinCheckBox.prop("checked"),numberOfBins:bins,selectedIndices:rightSelected.get()};
Spotfire.Dxp.Web.Forms.AjaxService.Modify(serverSettings.viewId,"SetAutoBinning",JSON.stringify(args));
userInput.enabled(false);};autoBinCheckBox.change(autoBinningChanged);numberOfBins.change(autoBinningChanged);
controls.autoBinCheckBox=autoBinCheckBox;controls.numberOfBins=numberOfBins;}else{if(rightSelected.count()===0&&serverSettings.isAdditionalSettingsEnabled){showInfoText(Spotfire.Localization.resources.SelectColumnsDialog_SelectColumnAbove);
}else{showInfoText(Spotfire.Localization.resources.SelectColumnsDialog_NoCommonSettings);}}parentContainer.append(panel);
Spotfire.Filters.StyledFilters.createStyledInput($(".SelectColumnsCheckbox",panel));};var addAggregationMethodDropdown=function(methods,selectedMethod,parent){var $select=$("<select/>");
$select.css("width","100%");$select.css("margin","0px");$.each(methods,function(index,method){var option=$("<option></option>");
option.val(method.id);option.text(method.display);if(selectedMethod&&method.id==selectedMethod){option.attr("selected","selected");
}$select.append(option);});enableControl($select,false);$select.change(setAggregationMethodAction);parent.append($select);
if(!selectedMethod){$select.prop("selectedIndex",-1);}return $select;};var addAction=function(){if(!userInput.enabled()){return;
}if(leftSelected.count()>0){Spotfire.Dxp.Web.Forms.AjaxService.Modify(serverSettings.viewId,"Add",JSON.stringify(leftSelected.get()));
leftSelected.clear();userInput.enabled(false);}};var removeAction=function(){if(!userInput.enabled()){return;
}var selectedIndices=rightSelected.get();if(selectedIndices.length>0){Spotfire.Dxp.Web.Forms.AjaxService.Modify(serverSettings.viewId,"Remove",JSON.stringify(selectedIndices));
rightSelected.clear();userInput.enabled(false);}};var enableControl=function(control,enabled){if(!control){return;
}if(enabled){control.removeAttr("disabled");}else{control.attr("disabled","disabled");}};var enableControls=function(){if(userInput.enabled()){var hasSelectedLeft=leftSelected.count()>0;
var hasSelectedRight=rightSelected.count()>0;var hasRightItems=rightSelected.columnCount()>0;var rightColumnCount=rightSelected.columnCount();
enableControl(controls.addButton,hasSelectedLeft);enableControl(controls.removeButton,hasSelectedRight);
enableControl(controls.removeAllButton,hasRightItems);enableControl(controls.moveUpButton,hasSelectedRight&&rightColumnCount>1&&!rightSelected.contains(0));
enableControl(controls.moveDownButton,hasSelectedRight&&rightColumnCount>1&&!rightSelected.contains(rightColumnCount-1));
controls.rightListBox.dblclick(removeAction);controls.leftListBox.dblclick(addAction);}else{enableControl(controls.aggregationMethod,false);
enableControl(controls.addButton,false);enableControl(controls.removeButton,false);enableControl(controls.removeAllButton,false);
enableControl(controls.moveUpButton,false);enableControl(controls.moveDownButton,false);controls.rightListBox.unbind("dblclick",removeAction);
controls.leftListBox.unbind("dblclick",addAction);}enableControl(controls.autoBinCheckBox,userInput.enabled());
enableControl(controls.numberOfBins,userInput.enabled());};var handleSettings=function(){if(rightSelected.count()>0){if(serverSettings.isAdditionalSettingsEnabled){enableControl(controls.aggregationMethod,false);
var args={generation:++additionalSettingsGeneration,selectedIndices:rightSelected.get()};Spotfire.Dxp.Web.Forms.AjaxService.Read(serverSettings.viewId,"GetAdditionalSettings",JSON.stringify(args),function(data){if(data.generation==additionalSettingsGeneration){controls.settingsPanel.empty();
addSettingsPanel(controls.settingsPanel,data);if(data.methods.length>0){enableControl(controls.aggregationMethod,true);
}}});}}else{controls.settingsPanel.empty();addSettingsPanel(controls.settingsPanel,null);enableControl(controls.aggregationMethod,false);
}};var addButton=function(text,visibility,action,parentContainer,margin,additionalClass){var $button=$("<button/>");
$button.append($("<span style='width=100%'/>").text(text)).attr("title",text);$button.addClass("whiteButton "+additionalClass);
$button.attr("disabled","disabled");$button.css("visibility",visibility);$button.click(action);$button.css("width","100px");
$button.css("height","25px");$button.css("margin-bottom",margin?"8px":"0");parentContainer.append($button);
return $button;};var addDataTableDropdown=function(tables,selectedTableName){if(tables.length>0){var $select=$("<select/>");
$select.css("width",columnWidth+"px");$select.css("display","block");$.each(tables,function(index,table){var option=$("<option></option>");
option.val(table);option.text(table);if(selectedTableName==table){option.attr("selected","selected");
}$select.append(option);});var setDataTableAction=function(){var dataTableName=controls.dataTable.val();
var args={dataTableName:dataTableName};Spotfire.Dxp.Web.Forms.AjaxService.Modify(serverSettings.viewId,"SetDataTable",JSON.stringify(args));
leftSelected.clear();userInput.enabled(false);};$select.change(setDataTableAction);return $select;}return null;
};var $content=$("<div/>");$content.addClass("SelectColumnsDialog sf-element-dialog");$content.css("width",dialogWidth+"px");
controls.dialog=$content;controls.topPanel=$("<div/>");controls.topPanel.css("padding","12px 8px 8px 8px");
controls.topPanel.append($("<p></p>").addClass("SelectColumnsDialogLabel"));controls.topPanel.text(Spotfire.Localization.resources.SelectColumnsDialog_DataTable+":");
if(serverSettings.dataTables.length>0){controls.dataTable=addDataTableDropdown(serverSettings.dataTables,serverSettings.dataTables[0]);
if(controls.dataTable!==null){controls.topPanel.append(controls.dataTable);}}else{controls.topPanel.css("display","none");
}$content.append(controls.topPanel);controls.leftListBoxContainer=$("<div/>");controls.leftListBoxContainer.css("position","absolute");
controls.leftListBoxContainer.css("left",padding+"px");controls.leftListBoxContainer.css("top",columnTop+"px");
controls.leftListBoxContainer.css("width",columnWidth+"px");controls.leftListBoxContainer.append($("<p></p>").addClass("SelectColumnsDialogLabel topLabel").text(Spotfire.Localization.resources.SelectColumnsDialog_AvailableColumns+":"));
$content.append(controls.leftListBoxContainer);var $middleDiv=$("<div/>");$middleDiv.css("position","absolute");
$middleDiv.css("top",columnTop+"px");$middleDiv.css("left",(padding+columnWidth)+"px");$middleDiv.css("width",buttonsColumnWidth+"px");
$middleDiv.css("padding-top","31px");$middleDiv.css("padding-left","10px");$middleDiv.css("padding-right","10px");
$content.append($middleDiv);var $rightListBoxDiv=$("<div/>");$rightListBoxDiv.css("position","absolute");
$rightListBoxDiv.css("top",columnTop+"px");$rightListBoxDiv.css("left",(padding+columnWidth+buttonsColumnWidth)+"px");
$rightListBoxDiv.css("width",columnWidth+"px");controls.rightListBoxContainer=$("<div></div>");$rightListBoxDiv.append(controls.rightListBoxContainer);
controls.rightListBoxContainer.append($("<p></p>").addClass("SelectColumnsDialogLabel").text(Spotfire.Localization.resources.SelectColumnsDialog_SelectedColumns+":"));
controls.settingsPanel=$("<div></div>");$rightListBoxDiv.append(controls.settingsPanel);$content.append($rightListBoxDiv);
var removeAllAction=function(){Spotfire.Dxp.Web.Forms.AjaxService.Modify(serverSettings.viewId,"RemoveAll","");
rightSelected.clear();userInput.enabled(false);};var noAction=function(){};var moveUpAction=function(){if(rightSelected.count()>0){var selectedIndices=rightSelected.get();
var indicesInRange=true;$.each(selectedIndices,function(index,item){if(item===0){indicesInRange=false;
}});if(indicesInRange){Spotfire.Dxp.Web.Forms.AjaxService.Modify(serverSettings.viewId,"MoveUp",JSON.stringify(selectedIndices));
rightSelected.move(-1);userInput.enabled(false);}}};var moveDownAction=function(){if(rightSelected.count()>0){var selectedIndices=rightSelected.get();
var indicesInRange=true;$.each(selectedIndices,function(index,item){if(item>=rightSelected.columnCount()-1){indicesInRange=false;
}});if(indicesInRange){Spotfire.Dxp.Web.Forms.AjaxService.Modify(serverSettings.viewId,"MoveDown",JSON.stringify(selectedIndices));
rightSelected.move(1);userInput.enabled(false);}}};controls.addButton=addButton(Spotfire.Localization.resources.SelectColumnsDialog_Add,"visible",addAction,$middleDiv,true,"rightArrow");
controls.removeButton=addButton(Spotfire.Localization.resources.SelectColumnsDialog_Remove,"visible",removeAction,$middleDiv,true,"leftArrow");
controls.removeAllButton=addButton(Spotfire.Localization.resources.SelectColumnsDialog_RemoveAll,"visible",removeAllAction,$middleDiv);
addButton("","hidden",noAction,$middleDiv);controls.moveUpButton=addButton(Spotfire.Localization.resources.SelectColumnsDialog_MoveUp,"visible",moveUpAction,$middleDiv,true);
controls.moveDownButton=addButton(Spotfire.Localization.resources.SelectColumnsDialog_MoveDown,"visible",moveDownAction,$middleDiv);
controls.rightListBox=$("<div/>");controls.rightListBoxContainer.append(controls.rightListBox);controls.leftListBox=$("<div/>");
controls.leftListBoxContainer.append(controls.leftListBox);var invalidateLeftListBox=function(){leftListBox.update();
var args={searchExpression:searchExpression,low:0,high:0};Spotfire.Dxp.Web.Forms.AjaxService.Read(serverSettings.viewId,"GetColumns",JSON.stringify(args),function(data){leftSelected.columnCount(data.ColumnCount);
leftListBox.update({totalVisibleValues:leftSelected.columnCount()});});};var invalidateRightListBox=function(){rightListBox.update();
var args={low:0,high:0};Spotfire.Dxp.Web.Forms.AjaxService.Read(serverSettings.viewId,"GetSelectedColumns",JSON.stringify(args),function(data){rightSelected.columnCount(data.ColumnCount);
rightListBox.update({totalVisibleValues:rightSelected.columnCount()});if(data.ColumnCount===0){userInput.enabled(true);
}});};controls.dialog.bind("inputEnabled",enableControls);Spotfire.Controls.ModalDialog.initialize($content,{title:Spotfire.Localization.resources.SelectColumnsDialog_DialogTitle,modal:true,width:dialogWidth+40,height:dialogHeight+10,resizable:false,buttons:[{text:Spotfire.Localization.resources.Close,isDefault:true}]});
var leftListBox=Spotfire.Controls.VirtualListBox.create(controls.leftListBox,{showSearchField:true,multiSelect:true,height:18,onGetValues:function(low,high,generation,callback){var args={searchExpression:searchExpression};
args.low=low;args.high=high;Spotfire.Dxp.Web.Forms.AjaxService.Read(serverSettings.viewId,"GetColumns",JSON.stringify(args),callback);
},onSelectionChanged:function(selectedIndices){leftSelected.add(selectedIndices);enableControls();},onSearch:function(pattern){searchExpression=pattern;
invalidateLeftListBox();}});var rightListBox=Spotfire.Controls.VirtualListBox.create(controls.rightListBox,{showSearchField:false,multiSelect:true,height:13,onGetValues:function(low,high,generation,callback){var args={};
args.low=low;args.high=high;var ready=function(data){var selectedIndices=rightSelected.get();var topIndex=data.TopIndex;
var i,index;for(i=0;i<data.Items.length;i++){index=topIndex+i;if($.inArray(index,selectedIndices)>-1){data.Items[i].Selected=true;
}}rightSelected.columnCount(data.ColumnCount);userInput.enabled(true);callback(data);handleSettings();
};Spotfire.Dxp.Web.Forms.AjaxService.Read(serverSettings.viewId,"GetSelectedColumns",JSON.stringify(args),ready);
},onSelectionChanged:function(selectedIndices){rightSelected.add(selectedIndices);enableControls();handleSettings();
}});invalidateLeftListBox();invalidateRightListBox();this.update=function(updateSettings){serverSettings=updateSettings;
invalidateLeftListBox();invalidateRightListBox();};};return this;};Spotfire.registerNameSpace("Visual.SelectColumnsDialog");
Spotfire.Visual.SelectColumnsDialog.update=function(settings){var content=$(".SelectColumnsDialog");if(content.length>0){var dialog=content.data("dialog");
dialog.update(settings);}};Spotfire.Visual.SelectColumnsDialog.show=function(settings){var dialog=new dialogClass();
dialog.show(settings);var content=$(".SelectColumnsDialog");content.data("dialog",dialog);};});function ShareLinkTool(params){var checkBoxIds=params.checkBoxIds;
var viewAnalysisUrl=params.viewAnalysisUrl;var embedUrl=params.embedUrl;var bookmarkLabel=params.bookmarkLabel;
var categories=params.categories;var categoryMapping=params.categoryMapping;var activePageIndex=params.activePageIndex;
var $controlDiv=null;var $snippetTextArea=null;var $sizeInputWidth=null;var $sizeInputHeight=null;var $shareLinkInput=null;
var $checkBoxesTable=null;var $presetSelect=null;var $bookmarkSelector=null;var styling={label:{display:"inline-block","margin-bottom":"0.5em","margin-top":"0.5em","font-weight":"bold"},help:{"margin-bottom":"1em"},helpText:{"line-height":"1.3em","margin-bottom":"0.5em"},helpLink:{color:"#26a2ed"},linkInput:{"box-sizing":"border-box",width:"100%","margin-bottom":"1em",padding:"0.75em"},snippetArea:{"box-sizing":"border-box",width:"100%",height:"8em","margin-bottom":"1em"}};
var CUSTOM_PRESET_ID=99;var checkBoxes={};var getPresetMatchingSelection=function(){var matchedPreset=null;
if(!isNaN($sizeInputWidth.val())){var presetIndex;for(presetIndex in params.presets){var preset=params.presets[presetIndex];
if(preset.hasOwnProperty("width")&&preset.width==$sizeInputWidth.val()&&preset.hasOwnProperty("height")&&preset.height==$sizeInputHeight.val()){matchedPreset=presetIndex;
break;}}}if(matchedPreset!==null){var currentCheckboxSelection={};var trueCount=0;var checkBoxCount=0;
$("#sharelinktool input").each(function(){if(this.type==="checkbox"&&!this.disabled){checkBoxCount+=1;
currentCheckboxSelection[this.name]=this.checked;if(this.checked){trueCount+=1;}}});var mPreset=params.presets[matchedPreset];
if(!mPreset.hasOwnProperty("customization")){return null;}var customization=mPreset.customization;if(trueCount==checkBoxCount&&customization[0]===true){return matchedPreset;
}if(trueCount===0&&customization[0]===false&&Object.size(customization)==1){return matchedPreset;}var customizationIndex;
for(customizationIndex in currentCheckboxSelection){if(customization.hasOwnProperty(customizationIndex)){if(customization[customizationIndex]!=currentCheckboxSelection[customizationIndex]){return null;
}}else{if(currentCheckboxSelection[customizationIndex]){return null;}}}return matchedPreset;}return null;
};var updateUri=function(){var s="",first=true,additionalQueryString="";if($bookmarkSelector!==null){var bookmarkIndex=$bookmarkSelector[0].options.selectedIndex;
var bookmarkOption=$bookmarkSelector[0].options[bookmarkIndex];if(bookmarkOption.value!=CUSTOM_PRESET_ID){additionalQueryString+="&bookmark="+bookmarkOption.value;
}else{additionalQueryString+="&configurationBlock=SetPage%28pageIndex%3D"+activePageIndex+"%29%3B";}}$("#sharelinktool input").each(function(){if(this.type==="checkbox"){s+=(first?"":",")+this.name+"-"+(this.checked?1:0);
first=false;}});additionalQueryString+="&options="+s;$shareLinkInput.val(viewAnalysisUrl+additionalQueryString+"\n");
if(isNaN($sizeInputWidth.val())){$sizeInputWidth.css("background-color","#FFB3C6");return;}$sizeInputWidth.css("background-color","");
if(isNaN($sizeInputHeight.val())){$sizeInputHeight.css("background-color","#FFB3C6");return;}$sizeInputHeight.css("background-color","");
if(typeof($presetSelect[0])!=="undefined"&&[$presetSelect[0].selectedIndex].value!=CUSTOM_PRESET_ID){var matchingPreset=getPresetMatchingSelection();
var $options=$("option",$presetSelect[0]);matchingPreset=(matchingPreset===null?CUSTOM_PRESET_ID:matchingPreset);
$options.each(function(){if(this.value==matchingPreset){$(this).attr("selected",true);}});}var snippetCode='<iframe src="'+embedUrl+additionalQueryString+'" width="'+$sizeInputWidth.val()+'" height="'+$sizeInputHeight.val()+'" ></iframe>';
$snippetTextArea.val(snippetCode+"\n");};var initTable=function(){var cat,$catBox,$list;for(cat in categories){$catBox=$("<div>");
$catBox.append($("<div>").text(categories[cat]));$list=$("<ul>").css("list-style","none");var categoryIndex,optionId,$checkBox;
for(categoryIndex in categoryMapping[cat]){optionId=categoryMapping[cat][categoryIndex];if(!checkBoxIds.hasOwnProperty(optionId)){continue;
}$checkBox=$(document.createElement("input")).attr("type","checkbox").attr("name",optionId).attr("id","sharelinkId"+optionId).change(updateUri);
var $label=$("<label>").attr("for","sharelinkId"+optionId).text(checkBoxIds[optionId][0]);if(!checkBoxIds[optionId][1]){$checkBox.attr("disabled","true");
$label.css("color","gray");}else{$checkBox.prop("checked",true);}checkBoxes[optionId]=$checkBox;$list.append($("<li>").append($checkBox).append($label));
}$catBox.append($list);$checkBoxesTable.append($catBox);}};var selectAllSnippet=function(){$snippetTextArea.focus();
$snippetTextArea.select();};var selectAllLink=function(){$shareLinkInput.focus();$shareLinkInput.select();
};var processPresetChange=function(){var $selectedOption=$(":selected",$presetSelect);var preset=params.presets[$selectedOption.val()];
var checkBox,checkBoxId;if(preset!==null&&preset.customization!==null&&preset.customization.hasOwnProperty(0)){for(checkBox in checkBoxes){if(!checkBoxes[checkBox].is(":disabled")){if(preset.customization[0]===false){checkBoxes[checkBox].prop("checked",false);
}else{checkBoxes[checkBox].prop("checked",true);}}}for(checkBoxId in preset.customization){if(typeof(checkBoxes[checkBoxId])!=="undefined"&&!checkBoxes[checkBoxId].is(":disabled")){if(preset.customization[checkBoxId]){checkBoxes[checkBoxId].prop("checked",true);
}else{checkBoxes[checkBoxId].prop("checked",false);}}}if(preset.hasOwnProperty("width")){$sizeInputWidth.val(preset.width);
}if(preset.hasOwnProperty("height")){$sizeInputHeight.val(preset.height);}}updateUri();};var showAdvanced=function(){var $option=$(":selected",$presetSelect);
var index=$(":selected",$presetSelect).index();if($option.val()==CUSTOM_PRESET_ID&&!$controlDiv.is(":visible")){showOptions(true);
}processPresetChange();};var previousHeight;var showOptions=function(forceShow){if($controlDiv.is(":visible")){$controlDiv.hide("fast");
$controlDiv.closest(".sf-modal-dialog-content").dialog("option","height",previousHeight);}else{previousHeight=$controlDiv.closest(".sf-element-modal-dialog").outerHeight();
$controlDiv.show("slow");$controlDiv.closest(".sf-modal-dialog-content").dialog("option","height","auto");
}return false;};var initPresetOptions=function(){var $presetOptionLabel=$("<label>").attr("for","sharelinkPresetSelect").css("margin-right","5pt").css("font-weight","bold").text(params.presetOptionLabel);
$presetSelect=$("<select>").attr("name","sharelinkPresetSelect").css("margin-bottom","1em").change(showAdvanced);
var preset;var presets=params.presets;for(preset in presets){$presetSelect.append($("<option>").val(preset).text(presets[preset].label));
}$presetSelect.append($("<option>").val(CUSTOM_PRESET_ID).text(params.customLabel));$(":nth-child(3)",$presetSelect).attr("selected",true);
var $optionDiv=$("<div>").append($presetOptionLabel).append("<br />").append($presetSelect);return $optionDiv;
};var initBookmarkSelector=function(){var $bookmarkLabel=$("<label>").attr("for","bookmarkSelector").css(styling.label).text(bookmarkLabel);
$bookmarkSelector=$("<select>").attr("name","bookmarkSelector").css("margin-bottom","1em").change(updateUri);
$bookmarkSelector.append($("<option>").val(CUSTOM_PRESET_ID).text(""));if(params.bookmarks!==null&&params.bookmarks.length>0){var bookmarkIndex,bookmarks=params.bookmarks;
for(bookmarkIndex in bookmarks){$bookmarkSelector.append($("<option>").val(bookmarks[bookmarkIndex].id).text(bookmarks[bookmarkIndex].name));
}}else{$bookmarkLabel.css("color","gray");$bookmarkSelector.css("width","150px");$bookmarkSelector.attr("disabled","true");
}return $("<div>").append($bookmarkLabel).append("<br />").append($bookmarkSelector);};this.init=function(){Object.size=function(o){var count=0;
var index;for(index in o){if(o.hasOwnProperty(index)){count+=1;}}return count;};if(viewAnalysisUrl===null||viewAnalysisUrl===""||embedUrl===null||embedUrl===""){var queryCharIndex=document.URL.indexOf("?");
var analysisUrl=document.URL.substring(0,queryCharIndex);var queryString=document.URL.substring(queryCharIndex+1,document.URL.length);
var webplayerBaseUri=analysisUrl.substring(0,analysisUrl.lastIndexOf("/"));var analysisPath="";var parameters=queryString.split("&");
var i,parts;for(i=0;i<parameters.length;i++){parts=parameters[i].split("=");if(parts.length==2&&parts[0]=="file"){analysisPath=parts[1];
break;}}if(analysisPath!==null){embedUrl=webplayerBaseUri+"/Embed.aspx?file="+analysisPath;viewAnalysisUrl=webplayerBaseUri+"/ViewAnalysis.aspx?file="+analysisPath;
}else{embedUrl="ERROR!";viewAnalysisUrl="ERROR!";}}var $helpText=$("<div>").css(styling.help);$helpText.append($("<span>").css(styling.helpText).text(params.consumerHelp));
if(window.Spotfire.isCloud()){var cloudText=$("<a/>").attr("href",window.Spotfire.Web.getHelpTopicLink("5001051")).attr("target",window.Spotfire.Web.helpTarget).css(styling.helpLink).text(params.helpLinkText)[0].outerHTML;
$helpText.append($("<span> </span>"));$helpText.append($("<span>").css(styling.helpText).html(Spotfire.Utilities.formatString(params.cloudHelp,cloudText)));
}var $linkInputLabel=$("<label>").attr("for","shareLinkInput").css(styling.label).text(params.linkInputLabel);
$shareLinkInput=$("<input>").css(styling.linkInput).click(selectAllLink);var $widthInputLabel=$("<label>").css(styling.label).text(params.widthInputLabel);
$sizeInputWidth=$("<input>").attr("type","text").attr("size",params.sizeInputLength).attr("name","sizeInputWidth").val(params.defaultEmbedWidth).css("margin-bottom","1em").css("margin-right","30px").change(updateUri);
var $heightInputLabel=$("<label>").css(styling.label).text(params.heightInputLabel);$sizeInputHeight=$("<input>").attr("type","text").attr("size",params.sizeInputLength).attr("name","sizeInputHeight").val(params.defaultEmbedHeight).css("margin-bottom","1em").css("margin-right","30px").change(updateUri);
var $snippetTextAreaLabel=$("<label>").css(styling.label).text(params.snippetTextAreaLabel);$snippetTextArea=$("<textarea>").css(styling.snippetArea).click(selectAllSnippet);
$checkBoxesTable=$("<div>").css("margin-top","1em");var $showAdvancedLink=$("<a>").text(params.advancedOptionsLabel).attr("href","#").click(showOptions);
var $showAdvancedDiv=$("<div>").append($showAdvancedLink);$controlDiv=$("<div>").hide().attr("id","shareLinkControls").append("<br />").append($snippetTextAreaLabel).append("<br />").append($snippetTextArea);
var $bookmarks=initBookmarkSelector();if($bookmarks!==null){$controlDiv.append($bookmarks);}$controlDiv.append(initPresetOptions()).append($("<span>").css("margin-right","1em;").append($widthInputLabel).append("<br />").append($sizeInputWidth)).append("<br />").append($("<span>").append($heightInputLabel).append("<br />").append($sizeInputHeight)).append("<br />").append($checkBoxesTable);
$("#sharelinktool").append($linkInputLabel).append($shareLinkInput).append($helpText).append($showAdvancedDiv).append($controlDiv);
initTable();showAdvanced();};}$(function(){Spotfire.registerNameSpace("Slider");Spotfire.Slider.create=function($element,settings){function Slider($slider){var DRAGSTATE_NONE=0;
var DRAGSTATE_BEGIN=1;var dragState=DRAGSTATE_NONE;var min=0,max=100,value=0;var enabled=true;var onSlide,onStop;
var clientX;var thumbX;var thumbWidth;var innerWidth;$slider.empty().addClass("Slider").attr("draggable",false);
var $thumb=$("<div></div>").addClass("Thumb");$slider.append($thumb);var moveThumb=function(val){if(val===undefined){val=value;
}innerWidth=$slider.innerWidth();thumbWidth=$thumb.outerWidth();var fullWidth=innerWidth?100*(1-thumbWidth/innerWidth):100;
var percent=innerWidth?(val-min)/(max-min)*fullWidth:0;if(innerWidth){percent=Math.min(Math.max(0,percent),fullWidth);
}$thumb.css("left",percent+"%");};var onMouseMove=function(e){if(!enabled){return;}var dx=e.clientX-clientX;
clientX=e.clientX;thumbX=Math.max(0,Math.min(innerWidth-thumbWidth,thumbX+dx));value=min+(thumbX/(innerWidth-thumbWidth))*(max-min);
moveThumb();if(onSlide){onSlide(this,{value:value});}};var onClick=function(e){if(e.target===$thumb.get(0)||!enabled||e.which!==1){return;
}innerWidth=$slider.innerWidth();thumbWidth=$thumb.outerWidth();thumbX=e.clientX-$slider.offset().left-$thumb.outerWidth()/2;
thumbX=Math.max(0,Math.min(innerWidth-thumbWidth,thumbX));value=min+(thumbX/(innerWidth-thumbWidth))*(max-min);
moveThumb();if(onStop){onStop(this,{value:value});}};var onMouseUp=function(){if(dragState!==DRAGSTATE_BEGIN){return;
}dragState=DRAGSTATE_NONE;if(onStop&&enabled){onStop(this,{value:value});}};var onMouseDown=function(e){if(e.which!==1){return;
}innerWidth=$slider.innerWidth();thumbWidth=$thumb.outerWidth();thumbX=(value-min)/(max-min)*(innerWidth-thumbWidth);
clientX=e.clientX;dragState=DRAGSTATE_BEGIN;};var setEnabled=function(val){$slider.toggleClass("disabled",val!==undefined&&!val);
enabled=val;};var update=function(args){if(dragState!==DRAGSTATE_NONE){return;}args=args||{};if(args.hasOwnProperty("min")&&typeof args.min==="number"){min=args.min;
}if(args.hasOwnProperty("max")&&typeof args.max==="number"){max=args.max;}if(args.hasOwnProperty("enabled")&&typeof args.enabled==="boolean"){setEnabled(args.enabled);
}if(args.hasOwnProperty("stop")&&typeof args.stop==="function"){onStop=args.stop;}if(args.hasOwnProperty("slide")&&typeof args.slide==="function"){onSlide=args.slide;
}if(args.hasOwnProperty("value")&&typeof args.value==="number"){value=args.value;}moveThumb();};this.getSettings=function(){return{min:min,max:max,value:value,enabled:enabled};
};$slider.on("click",onClick);Spotfire.Touch.registerTouchEvents($thumb,onMouseDown,onMouseMove,onMouseUp);
update(settings);this.update=update;}var slider=new Slider($element);$element.data("slider",slider);};
Spotfire.Slider.update=function($element,settings){var slider=$element.data("slider");if(slider){slider.update(settings);
}};Spotfire.Slider.getSettings=function($element){var slider=$element.data("slider");if(slider){return slider.getSettings();
}return{};};});$(function(){function SplitColumnControl(){var viewId;var settings;var $preview;var $dialog;
var resizePreview=_.debounce(function(){$dialog.height($dialog.parent().innerHeight());var plotBounds={width:$preview.width(),height:$preview.height()};
Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,"ResizePreview",JSON.stringify(plotBounds));},100);this.handleResize=function(){resizePreview();
};var modelUpdaters=[];var updatePreview=function(){var callback=function(key){Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,"GetPreview",JSON.stringify(key));
};Spotfire.Dxp.Web.Forms.AjaxService.Read(viewId,"UpdatePreview",JSON.stringify(settings),callback);};
this.initInPlace=function($d,theViewId,newSettings){$dialog=$d;viewId=theViewId;settings=newSettings;
var blurOnEnter=function(e){if(e.keyCode===13){$(this).blur();}};var addSettingBox=function(classes){var $box=$("<div/>").addClass("sf-SplitColumn-Box");
if(classes){$box.addClass(classes);}return $box;};var addBox=function($parent,classes,property,$input){$input.val(String(settings[property]).split(" ").join("\u2423"));
$input.on("keydown",blurOnEnter);var updateModel=function(){var newValue=$input.val().split("\u2423").join(" ");
if(newValue===settings[property]){return false;}settings[property]=newValue;return true;};modelUpdaters.push(updateModel);
var updateSettings=function(previewUpdater){if(updateModel()){previewUpdater();}};$input.on("blur",function(){updateSettings(updatePreview);
$input.val($input.val().split(" ").join("\u2423"));});$input.on("focus",function(){$input.val($input.val().split("\u2423").join(" "));
});$input.on("change",_.partial(updateSettings,_.debounce(updatePreview,1000)));return addSettingBox(classes).appendTo($parent);
};var addRadioButton=function($parent,classes,text,property,checked){var $input=$("<input/>").attr({type:"radio",name:"r"+property,id:"r"+property+checked});
$input.prop("checked",settings[property]===checked);$input.on("keydown",blurOnEnter);var updateModel=function(){var newValue=$input.prop("checked")===checked;
if(newValue===settings[property]){return false;}settings[property]=newValue;return true;};modelUpdaters.push(updateModel);
var updateSettings=function(previewUpdater){if(updateModel()){previewUpdater();}};$input.on("blur",_.partial(updateSettings,updatePreview));
$input.on("change",_.partial(updateSettings,_.debounce(updatePreview,1000)));var $box=$("<div/>").addClass("sf-SplitColumn-WideBox").appendTo($parent);
if(classes){$box.addClass(classes);}var $layout=Spotfire.Flex.item({container:"horizontal",grow:true}).attr("display","block").appendTo($box);
$input.appendTo($layout);$("<label/>").attr("for","r"+property+checked).text(text).appendTo($layout);
Spotfire.Filters.StyledFilters.createStyledInput($input,13,13);return $box;};var addTextBox=function($parent,classes,textBoxHeader,property,$input){var $box=addBox($parent,classes,property,$input);
$("<div/>").text(textBoxHeader).appendTo($box);$input.appendTo($box);return $box;};var $vertLayout=Spotfire.Flex.item({container:"vertical",fill:true,grow:true,"align-items":"stretch"}).css("height","100%").appendTo($dialog);
var $boxes=Spotfire.Flex.item({shrink:false}).addClass("sf-SplitColumnSettings").appendTo($vertLayout);
addTextBox($boxes,"sfpc-left",Spotfire.Localization.resources.SplitColumn_Separator,"separator",$("<input/>").attr("type","text").addClass("sf-element-input"));
var $numColumnsInput=$("<input/>").addClass("sf-element-input");addTextBox($boxes,"sfpc-right",Spotfire.Localization.resources.SplitColumn_NumColumns,"numColumns",$numColumnsInput.attr("type","number").attr("min",1).attr("max",settings.maxColumns));
if(settings.supportsTrim){$("<div/>").text(Spotfire.Localization.resources.SplitColumn_TrimDescription).addClass("sf-SplitColumn-WideBox sf-SplitColumn-HeaderBox").appendTo($boxes);
addTextBox($boxes,"sfpc-left",Spotfire.Localization.resources.SplitColumn_TrimLeft,"ltrim",$('<input type="number" min="0" max="1000"/>').addClass("sf-element-input"));
addTextBox($boxes,"sfpc-right",Spotfire.Localization.resources.SplitColumn_TrimRight,"rtrim",$('<input type="number" min="0" max="1000"/>').addClass("sf-element-input"));
}addRadioButton($boxes,"sf-SplitColumn-HeaderBox",Spotfire.Localization.resources.SplitColumn_FirstN,"reverseSplit",false);
addRadioButton($boxes,"",Spotfire.Localization.resources.SplitColumn_LastN,"reverseSplit",true);Spotfire.Flex.item({shrink:false}).text(Spotfire.Localization.resources.SplitColumn_Preview).addClass("sf-SplitColumnPreviewLabel").appendTo($vertLayout);
$preview=Spotfire.Flex.item({grow:true}).addClass("sf-SplitColumnPreview").appendTo($vertLayout);$preview.css("width","100%");
$dialog.height($dialog.parent().innerHeight());var plotBounds={width:$preview.width(),height:$preview.height(),numColumns:settings.numColumns};
Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,"InitPreview",JSON.stringify(plotBounds));};this.show=function(theViewId,newSettings){viewId=theViewId;
settings=newSettings;var dialog;var $d=$("<div/>").addClass("sf-SplitColumnControl");var buttons=[{text:Spotfire.Localization.resources.Ok,isDefault:true,click:function(){modelUpdaters.forEach(function(f){f();
});var bundle=JSON.stringify(settings);var callback=function(result){if(result.status){Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,"CreateColumns",bundle);
dialog.close();}else{Spotfire.Framework.ErrorDialog.show(Spotfire.Localization.resources.SplitColumn_DialogTitle,{Message:result.error,Details:null},_.noop);
}};Spotfire.Dxp.Web.Forms.AjaxService.Read(viewId,"ValidateSettings",bundle,callback);return true;}},{text:Spotfire.Localization.resources.Cancel,isCancel:true}];
dialog=Spotfire.Controls.ModalDialog.initialize($d,{modal:true,title:Spotfire.Localization.resources.SplitColumn_DialogTitle,buttons:buttons,resizable:true,minWidth:500,minHeight:480,resize:resizePreview,resizeStop:resizePreview});
$d.parent().css("overflow","hidden");this.initInPlace($d,theViewId,newSettings);};this.update=function(newSettings){settings=newSettings;
};this.initPreview=function(id,html){$preview.empty();var $html=$(html);$html.attr("viewid",id);$preview.append($html);
updatePreview();};this.createColumns=function(){modelUpdaters.forEach(function(f){f();});var bundle=JSON.stringify(settings);
Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,"CreateColumns",bundle);};return this;}Spotfire.registerNameSpace("Controls.SplitColumnControl",{show:function(viewId,settings){var dialog=new SplitColumnControl();
dialog.show(viewId,settings);$(".sf-SplitColumnControl").data("dialog",dialog);},initInPlace:function(viewId,settings){$(document.body).css("overflow","hidden");
var $dialog=$("#"+viewId);$dialog.width(settings.width);$dialog.height(settings.height);var dialog=new SplitColumnControl();
dialog.initInPlace($dialog,viewId,settings);$dialog.data("dialog",dialog);},handleResize:function(viewId,args){var $content=$(".sf-SplitColumnControl");
if($content.length>0){$content.width(args.width);$content.height(args.height);var dialog=$content.data("dialog");
dialog.handleResize();}},update:function(settings){var $content=$(".sf-SplitColumnControl");if($content.length>0){var dialog=$content.data("dialog");
dialog.update(settings);}},initPreview:function(id,html){var $content=$(".sf-SplitColumnControl");if($content.length>0){var dialog=$content.data("dialog");
dialog.initPreview(id,html);}},createColumns:function(){var $content=$(".sf-SplitColumnControl");if($content.length>0){var dialog=$content.data("dialog");
dialog.createColumns();}}});});Splitter={};Splitter.create=function(containerId,id,rectangle,isVertical,lowerLimit,upperLimit,callback,snapIdentifiers,snapList){var containerDiv=document.getElementById(containerId);
if(!containerDiv){return;}var splitterDiv=document.createElement("div");splitterDiv.id=id;splitterDiv.lowerLimit=lowerLimit;
splitterDiv.upperLimit=upperLimit;splitterDiv.callback=callback;splitterDiv.isVertical=isVertical;splitterDiv.snapList=snapList||[];
splitterDiv.snapIdentifiers=snapIdentifiers||[];splitterDiv.currentSnapIndexList=[];splitterDiv.rectangle=rectangle;
splitterDiv.style.position="absolute";splitterDiv.style.height=rectangle.height+"px";splitterDiv.style.width=rectangle.width+"px";
splitterDiv.style.top=rectangle.y+"px";splitterDiv.style.left=rectangle.x+"px";splitterDiv.style.background="#666666";
$(splitterDiv).css("opacity",0);splitterDiv.style.overflow="hidden";splitterDiv.style.fontSize="0px";
if(isVertical){splitterDiv.style.cursor="col-resize";}else{splitterDiv.style.cursor="row-resize";}_.defer(function(){containerDiv.appendChild(splitterDiv);
containerDiv.splitterList=containerDiv.splitterList||[];containerDiv.splitterList.push(splitterDiv);var $splitterDiv=$(splitterDiv);
$splitterDiv.on("mousedown",Splitter.event.onmousedown);$splitterDiv.on("sf-touchhold",function(eHold){Splitter.event.onmousedown(eHold);
Touch.showTouchHoldImage(eHold.pageX,eHold.pageY);Touch.clickBlocker();Spotfire.Visuals.CanvasVisualization.Dragging.begin({mouseMove:function(eMove){Touch.moveTouchHoldImage(eMove.pageX,eMove.pageY);
},mouseUp:function(){Touch.removeTouchHoldImage();}},$splitterDiv);});});};Splitter.removeSplitters=function(containerId){var containerDiv=document.getElementById(containerId);
if(containerDiv&&containerDiv.splitterList){while(containerDiv.splitterList.length>0){var splitter=containerDiv.splitterList.pop();
$(splitter).remove();}}};Splitter.event={onmousedown:function(e){var splitterDiv=e.target;if(Spotfire.isProfessional()){Spotfire.Visuals.CanvasVisualization.MouseButtons.reset();
var $splitterDiv=$(splitterDiv);var offset=$splitterDiv.offset();Spotfire.PageBus.publish("spotfire.splitter.show",{id:splitterDiv.id,rectangle:new Rectangle(offset.left,offset.top,$splitterDiv.width(),$splitterDiv.height()),isVertical:splitterDiv.isVertical,lowerLimit:splitterDiv.lowerLimit,upperLimit:splitterDiv.upperLimit,snapIdentifiers:splitterDiv.snapIdentifiers,snapList:splitterDiv.snapList});
return;}Spotfire.Touch.legacyTouchMouseCapture($(document.body),Splitter.event.onmousemove,Splitter.event.onmouseup);
Splitter.current=splitterDiv;Splitter.current.localLeftBoundary=e.pageX-Splitter.current.offsetLeft;Splitter.current.localTopBoundary=e.pageY-Splitter.current.offsetTop;
Splitter.current.initOffsetLeft=Splitter.current.offsetLeft;Splitter.current.initOffsetTop=Splitter.current.offsetTop;
$(Splitter.current).css("opacity",0.3);},onmouseup:function(){Splitter.removeCursorDiv();var splitter=Splitter.current;
var displacement;if(splitter.isVertical){displacement=splitter.offsetLeft-splitter.initOffsetLeft;}else{displacement=splitter.offsetTop-splitter.initOffsetTop;
}if(displacement!==0){splitter.callback(displacement,splitter.currentSnapIndexList);}else{$(splitter).css("opacity",0);
}},onmousemove:function(e){Splitter.moveCursorDiv(e.clientX,e.clientY);var splitter=Splitter.current;
var newPos;var i;splitter.currentSnapIndexList=[];if(splitter.isVertical){newPos=e.clientX-splitter.localLeftBoundary;
for(i=0;i<splitter.snapList.length;i++){if(Math.abs(newPos-(splitter.initOffsetLeft+splitter.snapList[i]))<10){newPos=splitter.initOffsetLeft+splitter.snapList[i];
splitter.currentSnapIndexList.push(splitter.snapIdentifiers[i]);}}newPos=Math.max(splitter.initOffsetLeft-splitter.lowerLimit,newPos);
newPos=Math.min(splitter.initOffsetLeft+splitter.upperLimit,newPos);splitter.style.left=newPos+"px";}else{newPos=e.clientY-splitter.localTopBoundary;
for(i=0;i<splitter.snapList.length;i++){if(Math.abs(newPos-(splitter.initOffsetTop+splitter.snapList[i]))<10){newPos=splitter.initOffsetTop+splitter.snapList[i];
splitter.currentSnapIndexList.push(splitter.snapIdentifiers[i]);}}newPos=Math.max(splitter.initOffsetTop-splitter.lowerLimit,newPos);
newPos=Math.min(splitter.initOffsetTop+splitter.upperLimit,newPos);splitter.style.top=newPos+"px";}}};
Splitter.moveCursorDiv=function(centerX,centerY){var cursorDiv=Splitter.current.cursorDiv;if(!cursorDiv){cursorDiv=document.createElement("div");
cursorDiv.style.position="absolute";cursorDiv.style.width="100px";cursorDiv.style.height="100px";cursorDiv.style.cursor=Splitter.current.style.cursor;
cursorDiv.style.background="hotpink";$(cursorDiv).css("opacity",0);Splitter.current.cursorDiv=cursorDiv;
document.body.appendChild(cursorDiv);}cursorDiv.style.left=(centerX-50)+"px";cursorDiv.style.top=(centerY-50)+"px";
};Splitter.removeCursorDiv=function(){var cursorDiv=Splitter.current.cursorDiv;if(cursorDiv){Splitter.current.cursorDiv=null;
$(cursorDiv).remove();}};$(function(){var sfBoxHeight=function(value){if(typeof value==="number"){return this.each(function(){var $item=$(this);
$item.height(Math.max(0,value-($item.outerHeight(true)-$item.height())));});}return this.outerHeight(true);
};var sfBoxWidth=function(value){if(typeof value==="number"){return this.each(function(){var $item=$(this);
var width=Math.max(0,value-($item.outerWidth(true)-$item.width()));$item.width(width);});}return this.outerWidth(true);
};var sfBoxOffset=function(){var o=this.offset();var topMargin=parseInt(this.css("margin-top"),10);var leftMargin=parseInt(this.css("margin-left"),10);
var bo={top:o.top-topMargin,left:o.left-leftMargin};return bo;};var sfContentOffset=function(){var o=this.offset();
var topBorder=parseInt(this.css("border-top-width"),10);var leftBorder=parseInt(this.css("border-left-width"),10);
var topPadding=parseInt(this.css("padding-top"),10);var leftPadding=parseInt(this.css("padding-left"),10);
var co={top:o.top+topBorder+topPadding,left:o.left+leftBorder+leftPadding};return co;};var sfContentOrigin=function(){var topPadding=parseInt(this.css("padding-top"),10);
var leftPadding=parseInt(this.css("padding-left"),10);var co={top:topPadding,left:leftPadding};return co;
};var sfRemoveAsync=function(callback){var $element=this;window.setTimeout(function(){$element.remove();
if(typeof callback==="function"){callback();}});};var sfTooltip=function(text){return this.each(function(){var $item=$(this);
var hasTooltip=typeof($item.data("sfToolTipText"))==="string";$item.data("sfToolTipText",Spotfire.htmlEncode(text));
if(!hasTooltip){$item.hover(function(){var textToShow=$item.data("sfToolTipText");if(textToShow===""){return;
}Spotfire.Visuals.Tooltip.showHtml(textToShow,Spotfire.Web!==undefined?Spotfire.Web.tooltipDelay:500);
},function(){Spotfire.Visuals.Tooltip.hide();});}});};var sfSetTextWithEllipsis=function(text,maxLineCount){maxLineCount=maxLineCount||1;
return this.each(function(){var $item=$(this);$item.text("a");var lineHeight=$item.height();var maxHeight=maxLineCount*lineHeight;
$item.text(text);var divHeight=$item.height();if(divHeight<=maxHeight){return;}var charsPerLine=text.length/(divHeight/lineHeight);
var length=Math.round(charsPerLine*(maxLineCount+1));while(divHeight>maxHeight&&length>0){$item.text(text.substring(0,length)+"...");
divHeight=$item.height();length--;}if(length===0){text=text.substring(0,1)+"...";length=4;while(divHeight>maxHeight&&length>0){$item.text(text.substring(0,length));
divHeight=$item.height();length--;}}});};var longClickTimer;var sfLongClick=function(onClick){if(typeof onClick!=="function"){return;
}var clearClickTimer=function(){window.clearTimeout(longClickTimer);};var wrappedOnClick=function(){clearClickTimer();
onClick();longClickTimer=window.setTimeout(wrappedOnClick,150);};this.on("mousedown",wrappedOnClick).on("mouseup",clearClickTimer);
};var sfFitInside=function(selector){var $other=$(selector);var pbmX=this.outerWidth(true)-this.width();
var pbmY=this.outerHeight(true)-this.height();this.width($other.width()-pbmX);this.height($other.height()-pbmY);
return this;};var sfSetSequencePseudoClasses=function(){var count=this.length;this.each(function(index,child){Spotfire.StyleManager.setSequencePseudoClasses($(child),index,count);
});};$.fn.extend({sfBoxHeight:sfBoxHeight,sfBoxWidth:sfBoxWidth,sfBoxOffset:sfBoxOffset,sfContentOffset:sfContentOffset,sfContentOrigin:sfContentOrigin,sfRemoveAsync:sfRemoveAsync,sfTooltip:sfTooltip,sfLongClick:sfLongClick,sfSetTextWithEllipsis:sfSetTextWithEllipsis,sfFitInside:sfFitInside,sfSetSequencePseudoClasses:sfSetSequencePseudoClasses});
});$(function(){function StatusBar(viewId){var $parent=$("#"+viewId).css("width","100%");var $container=$("<div />").addClass("sf-element sf-element-status-bar").appendTo($parent);
var createLabel=function(text,floated){return $("<div/>").addClass("sf-element sf-element-text-box").css("float",floated).attr("title",text).addClass(floated==="left"?"sfpc-left":"sfpc-right").text(text);
};var updateLabel=function($label,text){$label.text(text).attr("title",text);};var $statusLabel=createLabel("","left").appendTo($container);
var $progressAnimation=$("<div />").addClass("sf-element sf-element-icon").css("float","left").appendTo($container);
var $workingSvg;Spotfire.getSvg("Images/Progress/CircularProgressAnimation.svg",function($svg){$svg.attr("class","sf-svg-loader-12x12");
$workingSvg=$svg;$progressAnimation.append($svg);$workingSvg.hide();});var $readySvg;Spotfire.getSvg("Images/Progress/AnalysisReady.svg",function($svg){$svg.attr("class","sf-svg-loader-12x12");
$readySvg=$svg;$progressAnimation.append($svg);});var $progressLabel=createLabel("","left").appendTo($container);
var setProgressText=function(text){updateLabel($progressLabel,text);};var setLoadingAnimation=function(loading){if(loading){if($workingSvg&&$readySvg){$readySvg.hide();
$workingSvg.show();}}else{if($workingSvg&&$readySvg){$workingSvg.hide();$readySvg.show();}}};var hasScrollbar=function(){return $parent.outerHeight(true)>$parent.parent().height();
};var updateLabels=function(labels){$(".sfpc-right",$container).remove();$.each(labels,function(index,label){var $label=createLabel(label.text,"right");
if(typeof label.tooltip==="string"){$label.attr("title",label.tooltip);}$container.prepend($label);});
if(hasScrollbar()){var $rightLabels;do{$rightLabels=$(".sfpc-right",$container);if($rightLabels.length===0){break;
}$rightLabels.first().remove();}while(hasScrollbar());}};var $asyncProgress=createLabel("","left").css("cursor","pointer").hover(function(){$(this).css("text-decoration","underline");
},function(){$(this).css("text-decoration","none");}).appendTo($container).click(function(){Spotfire.PageBus.publish("spotfire.showasyncprogress");
}).hide();var $notificationIcon=$("<div/>").css("float","left").appendTo($container).hide();var $notificationLabel=createLabel("","left").css("cursor","pointer").hover(function(){$(this).css("text-decoration","underline");
},function(){$(this).css("text-decoration","none");}).appendTo($container).hide();var $messageDialog=$("<div/>").attr("title",Spotfire.Localization.resources.StatusBar_Title).css("overflow-x","hidden");
var notificationClickHandler=function(){if(Spotfire.isProfessional()){Spotfire.PageBus.publish("spotfire.shownotifications");
}else{var dismiss=function(){Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,"ClearNotifications","");
$notificationIcon.hide();$notificationLabel.hide();};var pos=$notificationLabel.offset();Spotfire.Controls.ModalDialog.initialize($messageDialog,{modal:true,width:400,height:300,resizable:true,position:[pos.left,pos.top-311],buttons:[{text:Spotfire.Localization.resources.Dismiss,click:dismiss,isDefault:true}]});
}};$notificationLabel.click(notificationClickHandler);var createNotificationItem=function(notification){function format(text){return Spotfire.htmlEncode(text).replace(/\r?\n|\r/g,"<br />");
}var $item=$("<div></div>").addClass("notificationItem").addClass("sf-enable-selection");$item.css({width:"100%","margin-bottom":"5px"});
var $title=$("<div></div>");$title.css({"font-weight":"bold"});$title.html(format(notification.Title));
$item.append($title);if(notification.HasSummary){var $summary=$("<div/>").html(format(notification.Summary));
$item.append($summary);}if(notification.HasDetails){var $details=$("<div/>").html(format(notification.Details));
$item.append($details);}return $item;};var updateNoticationIcon=function($icon,notifications){var $notficationButton=$("<div/>").css("width","14px").css("height","14px");
var buttonClass="sfc-info-button";var buttonImage="Info.svg";var severity=_.max(notifications,function(item){return item.NotificationType;
}).NotificationType;if(severity>1){buttonClass="sfc-error-button";buttonImage="Error.svg";}else{if(severity===1){buttonClass="sfc-warning-button";
buttonImage="Warning.svg";}}$notficationButton.addClass(buttonClass);Spotfire.Controls.PanelButton.initialize($notficationButton,"","Images/Buttons/"+buttonImage,notificationClickHandler);
$notficationButton.appendTo($icon);};var printf=function(format){var i;for(i=1;i<arguments.length;i++){format=format.replace("{"+(i-1)+"}",arguments[i]);
}return format;};var webAnalysisState=Ajax.readyState;var pendingImageCount=0;var loadingAnimationStateBusy=false;
var updateProgressInformation=function(){if(webAnalysisState===Ajax.readyState){setLoadingAnimation(false);
loadingAnimationStateBusy=false;}else{if(!loadingAnimationStateBusy){setLoadingAnimation(true);loadingAnimationStateBusy=true;
}}var imageProgressText=function(){if(pendingImageCount===1){return"("+pendingImageCount+" "+Spotfire.Localization.resources.ImageLeft+")";
}if(pendingImageCount>1){return"("+pendingImageCount+" "+Spotfire.Localization.resources.ImagesLeft+")";
}return"";};switch(webAnalysisState){case Ajax.readyState:setProgressText(Spotfire.Localization.resources.Ready+" "+imageProgressText());
break;case Ajax.pollState:setProgressText(Spotfire.Localization.resources.Polling+" "+imageProgressText());
break;case Ajax.popupPollState:break;case Ajax.updateState:setProgressText(Spotfire.Localization.resources.Updating+" "+imageProgressText());
break;case Ajax.connectingState:setProgressText(Spotfire.Localization.resources.Connecting+" "+imageProgressText());
break;}};Spotfire.WebAnalysis.onStateChanged(function(state){webAnalysisState=state;updateProgressInformation();
});Spotfire.Visuals.CanvasVisualization.onActivity(function(count){pendingImageCount=count;updateProgressInformation();
});if(Spotfire.isProfessional()){$progressAnimation.hide();$progressLabel.hide();}else{$statusLabel.hide();
}return{updateAsyncProgress:function(count){if(count>0){updateLabel($asyncProgress,printf(Spotfire.Localization.resources.AsyncProgressProgressTasks,count));
$asyncProgress.show();}else{$asyncProgress.hide();}},updateLabels:function(){Spotfire.Dxp.Web.Forms.AjaxService.Read(viewId,"GetLabels","",updateLabels);
},updateNotifications:function(){var callback=function(notifications){$notificationIcon.empty();$messageDialog.empty();
var length=notifications.length;if(length===0){$notificationIcon.hide();$notificationLabel.hide();return;
}updateNoticationIcon($notificationIcon,notifications);updateLabel($notificationLabel,printf(Spotfire.Localization.resources.NotificationServiceUnreadMessages,length));
$.each(notifications,function(){$messageDialog.append(createNotificationItem(this));});$notificationIcon.show();
$notificationLabel.show();};Spotfire.Dxp.Web.Forms.AjaxService.Read(viewId,"GetNotifications","",callback);
},updateOnlineStatus:function(status){$statusLabel.text(status.text);$statusLabel.attr("title",status.tooltip);
}};}var instance=null;Spotfire.registerNameSpace("StatusBar",{updateAsyncProgress:function(count){if(instance!==null){instance.updateAsyncProgress(count);
}},updateLabels:function(){if(instance!==null){instance.updateLabels();}},updateNotifications:function(){if(instance!==null){instance.updateNotifications();
}},updateOnlineStatus:function(status){if(instance!==null){instance.updateOnlineStatus(status);}},initialize:function(id){instance=new StatusBar(id);
}});});$(function(){Spotfire.registerNameSpace("Data.Upload");Spotfire.Data.Upload.createStyledFileInput=function($originalFileInputField,buttonText){if(!$originalFileInputField.is("input[type=file]")){return $originalFileInputField;
}var $outercontainer=$("<div />");$originalFileInputField.addClass("invisible-file-input");var $buttoncontainer=$("<div />").addClass("file-button-container");
var $inputcontainer=$("<div >").addClass("file-input-container");var $filenameInputField=$('<input type="text">').attr("readonly","true").addClass("filename");
$originalFileInputField.change(function(){$filenameInputField.val($originalFileInputField.val().split("/").pop().split("\\").pop());
});var $styledBrowseButton=$("<button />").attr("type","button").text(buttonText).addClass("fileInputButton whiteButton");
if($originalFileInputField.is(":disabled")){$styledBrowseButton.prop("disabled",true);}$buttoncontainer.append($styledBrowseButton).append($originalFileInputField);
$inputcontainer.append($filenameInputField);$outercontainer.append($inputcontainer).append($buttoncontainer);
var browseButtonWidth=0;$buttoncontainer.mousemove(function(ev){var left=ev.pageX-$buttoncontainer.offset().left-browseButtonWidth+10;
$originalFileInputField.css({left:left});return false;});this.resize=function(totalwidth,totalmargin){var width=$styledBrowseButton.outerWidth();
var height=$styledBrowseButton.outerHeight();$originalFileInputField.width(width);$originalFileInputField.height(height);
browseButtonWidth=$originalFileInputField.outerWidth();$filenameInputField.width(totalwidth-totalmargin-browseButtonWidth);
};$originalFileInputField.mouseenter(function(){$styledBrowseButton.addClass("whiteButton-hover");});
$originalFileInputField.mouseleave(function(){$styledBrowseButton.removeClass("whiteButton-hover");if(isIE){$styledBrowseButton.removeClass("whiteButton-active");
}});$originalFileInputField.mousedown(function(){var removeActive=function(){$(document.body).off("mouseup",removeActive);
$styledBrowseButton.removeClass("whiteButton-active");};$styledBrowseButton.addClass("whiteButton-active");
if(!isIE){$(document.body).on("mouseup",removeActive);}});this.container=$outercontainer;return this;
};Spotfire.Data.Upload.createStyledFileInput2=function($originalFileInputField,$parentElement,allowedExtensions){if(!$originalFileInputField.is("input[type=file]")){return $originalFileInputField;
}$originalFileInputField.attr("accept",allowedExtensions);$originalFileInputField.css({position:"absolute",left:-1000,top:-1000,"z-index":-1});
var inputId=$originalFileInputField.attr("id");var $label=$("<label/>").attr("for",inputId).addClass("sf-file-input-label").append($originalFileInputField).css({position:"absolute",left:0,top:0,width:"100%",height:"100%",cursor:"pointer"});
$parentElement.append($originalFileInputField);$parentElement.append($label);return this;};});$(function(){Spotfire.registerNameSpace("Visuals.CustomStylingDialog");
Spotfire.Visuals.CustomStylingDialog.SectionBuilder=function(rule,resources,addControlReference){var instance;
var section;var isPropertySupported=false;var anyDefined=function(box,names){return _.any(names,function(propertyName){return box.hasOwnProperty(propertyName);
});};var internalSimpleControl=function(parent,propertyName,control){if(anyDefined(rule.box,[propertyName])){var mainControl=Spotfire.Visuals.BoxEditor.control(null,control,propertyName);
addControlReference(rule,propertyName,mainControl);parent.append(mainControl.element());return true;}return instance;
};var createSection=function(propertyNames){section=Spotfire.Flex.item({container:"vertical"}).addClass("Control");
isPropertySupported=propertyNames===undefined||anyDefined(rule.box,propertyNames);return instance;};var addTitle=function(propertyHeader){if(!isPropertySupported){return instance;
}section.append(Spotfire.Flex.item().text(propertyHeader).addClass("Title"));return instance;};var addResetButton=function(callback,sectionName,nodes){var $resetButton=$('<button type="button"/>').addClass("ResetButton whiteButton").text(resources.StyleEditor_Reset);
$resetButton.click(function(){callback(sectionName,nodes);});section.append($resetButton);return instance;
};var addExpandableControl=function(collapsedPropertyName,expandedPropertyNames,controlFunc){if(!isPropertySupported){return instance;
}var mainControl=Spotfire.Visuals.BoxEditor.allSidesControl(null,controlFunc,collapsedPropertyName,expandedPropertyNames);
addControlReference(rule,collapsedPropertyName,mainControl);section.append(mainControl.element());return instance;
};var addSimpleControl=function(propertyName,control){internalSimpleControl(section,propertyName,control);
return instance;};var addFontControl=function(){if(!isPropertySupported){return instance;}var rowContent=Spotfire.Flex.item({container:"vertical"});
var horizontalContent=Spotfire.Flex.item({container:"horizontal"}).addClass("sf-element-styling-editor-verticalGrouping");
var hasFontFamily=internalSimpleControl(horizontalContent,"font-family",Spotfire.Visuals.BoxEditor.comboBox(resources.StyleEditor_FontList,false));
var hasFontSize=internalSimpleControl(horizontalContent,"font-size",Spotfire.Visuals.BoxEditor.comboBox(resources.StyleEditor_FontSizeList,true));
var hasColor=internalSimpleControl(horizontalContent,"color",Spotfire.Visuals.BoxEditor.colorField());
if(hasFontFamily||hasFontSize||hasColor){rowContent.append(horizontalContent);horizontalContent=Spotfire.Flex.item({container:"horizontal"}).addClass("sf-element-styling-editor-verticalGrouping");
}var hasFontWeight=internalSimpleControl(horizontalContent,"font-weight",Spotfire.Visuals.BoxEditor.boldButtonBox());
var hasFontStyle=internalSimpleControl(horizontalContent,"font-style",Spotfire.Visuals.BoxEditor.italicButtonBox());
var hasTextAlign=internalSimpleControl(horizontalContent,"text-align",Spotfire.Visuals.BoxEditor.textAlignButtonGroupBox());
if(hasFontWeight||hasFontStyle||hasTextAlign){rowContent.append(horizontalContent);}section.append(rowContent);
return instance;};var addRadioAccordionControl=function(propertyName,valueChangeCallback,firstOptionValue,firstOptionHeader,secondOptionValue,secondOptionHeader){if(!isPropertySupported){return instance;
}var content=Spotfire.Flex.item();$.each(Array.prototype.slice.call(arguments,6),function(index,subControl){content.append(subControl);
});var $control=Spotfire.Flex.item({container:"vertical"});var radioAccordion=Spotfire.Visuals.BoxEditor.radioAccordion($control,{groupName:rule.containmentNode+":"+propertyName,items:[{title:firstOptionHeader,onActive:function(){valueChangeCallback(rule,firstOptionValue);
}},{title:secondOptionHeader,onActive:function(){valueChangeCallback(rule,secondOptionValue);},content:arguments.length>6?content:undefined}]});
addControlReference(rule,propertyName,radioAccordion);section.append($control);return instance;};var addBackgroundControls=function(setValueCallback,disableTransparentBackground){if(!isPropertySupported){return instance;
}disableTransparentBackground=disableTransparentBackground||false;var $control=Spotfire.Flex.item({container:"vertical"});
var lastKnownColor;var $solidFillControl=Spotfire.Flex.item({container:"vertical"});var control=Spotfire.Visuals.BoxEditor.colorField();
internalSimpleControl($solidFillControl,"background-color",control);var radioAccordion=Spotfire.Visuals.BoxEditor.radioAccordion($control,{groupName:rule.containmentNode+":background",items:[{title:resources.StyleEditor_BackgroundNone,onActive:function(){lastKnownColor=control.value();
setValueCallback(rule,"transparent");},disabled:disableTransparentBackground},{title:resources.StyleEditor_BackgroundSolid,onActive:function(){control.value(lastKnownColor);
},content:$solidFillControl}]});addControlReference(rule,"background",radioAccordion);section.append($control);
return instance;};var createStrokeControl=function(){var $control=Spotfire.Flex.item({container:"vertical"});
var lastKnownColor;var onChange=$.noop;var isUpdating;var settings={};var handleChange=function(){if(isUpdating){return;
}onChange();};var updateValue=function(value){if(!isUpdating){settings.stroke=value;handleChange();}};
var colorChanged=function(value){lastKnownColor=value;updateValue(value);};var $strokeColorControl=Spotfire.Flex.item({container:"vertical"});
var colorField=Spotfire.Visuals.BoxEditor.colorField().onChange(colorChanged);$strokeColorControl.append(colorField.element());
var radioAccordion=Spotfire.Visuals.BoxEditor.radioAccordion($control,{groupName:rule.containmentNode+":stroke",items:[{title:resources.StyleEditor_StrokeNone,onActive:function(){updateValue("none");
}},{title:resources.StyleEditor_StrokeColor,onActive:function(){colorField.value(lastKnownColor||"rgb(127, 126, 127)");
},content:$strokeColorControl}]});var properties=function(propertyOverrides,calculatedProperties){settings=propertyOverrides;
isUpdating=true;var stroke=propertyOverrides.stroke||calculatedProperties.stroke;var isNone=stroke.toUpperCase()==="NONE";
radioAccordion.selected(isNone?0:1);if(!isNone){colorField.value(stroke);}isUpdating=false;};return{onChange:function(callback){onChange=callback;
},properties:properties,element:function(){return $control;}};};var addStrokeControl=function(){if(!isPropertySupported){return instance;
}var strokeControl=createStrokeControl();addControlReference(rule,"stroke",strokeControl);section.append(strokeControl.element());
return instance;};var element=function(){return isPropertySupported?section:null;};instance={createSection:createSection,addTitle:addTitle,addResetButton:addResetButton,addExpandableControl:addExpandableControl,addSimpleControl:addSimpleControl,addFontControl:addFontControl,addRadioAccordionControl:addRadioAccordionControl,addBackgroundControls:addBackgroundControls,addStrokeControl:addStrokeControl,element:element};
return instance;};});$(function(){Spotfire.registerNameSpace("StyleEditorDialog");Spotfire.StyleEditorDialog=function(){var instance,getStartedTab,boxMenuContainer,boxContainer,outerBoxMenuContainer,getStartedContent,showSection;
var resources=Spotfire.Localization.resources;var defaultContainmentNodes={document:{displayName:resources.StyleEditor_ContainmentNodeDocument},"page-navigation-bar":{displayName:resources.StyleEditor_ContainmentNodePageNavigationBar},"visualization-area":{displayName:resources.StyleEditor_ContainmentNodeVisualizationArea},"visual-section":{displayName:resources.StyleEditor_ContainmentNodeVisual},"visual-title":{displayName:resources.StyleEditor_ContainmentNodeVisualTitle},legend:{displayName:resources.StyleEditor_ContainmentNodeLegend},scale:{displayName:resources.StyleEditor_ContainmentNodeScaleArea},"axis-tray":{displayName:resources.StyleEditor_ContainmentNodeAxisTrayItem},annotation:{displayName:resources.StyleEditor_ContainmentNodeAnnotations}};
var container=$("<div/>").addClass("StyleEditorDialog");var currentSectionName;var firstSectionName;var makeSureDialogIsVisible=function($container){$container.css("width",Math.min($container.width(),$(window).width())+"px");
$container.css("height",Math.min($container.height(),$(window).height())+"px");var top=parseInt($container.css("top").replace("px"),10);
var left=parseInt($container.css("left").replace("px"),10);var maxLeft=$(window).width()-parseInt($container.css("width").replace("px"),10);
var maxTop=$(window).height()-parseInt($container.css("height").replace("px"),10);$container.css("top",Math.min(Math.max(top,0),maxTop)+"px");
$container.css("left",Math.min(Math.max(left,0),maxLeft)+"px");};var oldDialogSettings=$("body").prop("StyleEditorDialogSettings");
if(oldDialogSettings){container.css(oldDialogSettings);makeSureDialogIsVisible(container);}else{container.css({top:"200px",left:"200px",width:"530px",height:"500px"});
}var dragStopped=function(){makeSureDialogIsVisible(container);};container.draggable({handle:".sf-element-style-editor-title",scroll:false,stop:dragStopped});
Spotfire.UI.resizable(container,{minWidth:380,minHeight:250});var getStartedTabButton;var detailsTabButton;
getStartedTab=Spotfire.Flex.item({grow:true}).addClass("sf-element-style-editor-section sf-element-style-editor-main");
outerBoxMenuContainer=Spotfire.Flex.item({shrink:false}).addClass("sf-element-style-editor-containment-node-menu");
boxMenuContainer=Spotfire.Flex.item({shrink:false,"align-items":"stretch"});boxContainer=Spotfire.Flex.item({grow:true}).addClass("sf-element-style-editor-section sf-elment-style-editor-section__details");
var boxTab=Spotfire.Flex.item({container:"horizontal","align-items":"stretch",grow:true}).addClass("sf-element-style-editor-main").append(outerBoxMenuContainer.append(boxMenuContainer),boxContainer);
var showGetStarted=function(){currentSectionName=undefined;getStartedTab.show();boxTab.hide();getStartedTabButton.addClass("sf-element-style-editor-tab_active");
detailsTabButton.removeClass("sf-element-style-editor-tab_active");};var showBoxTab=function(){boxTab.show();
getStartedTab.hide();if(!currentSectionName){showSection(firstSectionName);}getStartedTabButton.removeClass("sf-element-style-editor-tab_active");
detailsTabButton.addClass("sf-element-style-editor-tab_active");};var onClose;var close=function(){$("body").prop("StyleEditorDialogSettings",{left:container.css("left"),top:container.css("top"),width:container.width()+"px",height:container.height()+"px"});
container.remove();Spotfire.PopoverPanel.close();if(onClose){onClose();}};getStartedTabButton=Spotfire.Flex.item({container:"horizontal","justify-content":"center",grow:true}).addClass("sf-element-style-editor-tab").text(resources.StyleEditor_GeneralPageTitle).click(showGetStarted);
detailsTabButton=Spotfire.Flex.item({container:"horizontal","justify-content":"center",grow:true}).addClass("sf-element-style-editor-tab").text(resources.StyleEditor_DetailsPageTitle).click(showBoxTab);
var closeButton=Spotfire.Flex.item().addClass("sf-element-style-editor-close").click(close);getStartedContent=$("<div/>");
container.append(Spotfire.Flex.item({container:"vertical",fill:true,"align-items":"stretch"}).addClass("sf-element-style-editor").append(Spotfire.Flex.item({container:"horizontal","align-items":"stretch","justify-content":"center",shrink:false}).addClass("sf-element-style-editor-title").append(Spotfire.Flex.item({grow:true}).text(resources.StyleEditor_DialogTitle),closeButton),Spotfire.Flex.item({container:"horizontal","justify-content":"center",shrink:false}).addClass("sf-element-style-editor-tab-section").append(getStartedTabButton,detailsTabButton),getStartedTab.append(getStartedContent),boxTab));
Spotfire.getSvg("Images/StyleEditor/CloseBtn_16x16canvas.svg",function($svg){$svg.css({width:"16px",height:"16px"});
closeButton.append($svg.addClass("closeSvg"));});showGetStarted();Spotfire.PopoverPanel.showPopout(container);
var setGetStartedSection=function(section){getStartedContent.append(section.addClass("Section"));Spotfire.Filters.StyledFilters.createStyledInput(section,13,13);
return instance;};var addDetailsSection=function(sectionName,generateSection,updateSection,lazy){if(!firstSectionName){firstSectionName=sectionName;
lazy=false;}var section;var menuItem=Spotfire.Flex.item().addClass("sf-element-style-editor-containment-node-menu-item").text(defaultContainmentNodes[sectionName].displayName);
boxMenuContainer.append(menuItem);menuItem.attr("menuNode",sectionName);var createSection=function(){section=generateSection(sectionName);
section.attr("sectionName",sectionName).addClass("Section");boxContainer.append(section);section.hide();
updateSection(sectionName);};if(!lazy){createSection();}menuItem.click(function(){if(lazy&&boxContainer.find("[sectionName='"+sectionName+"']").length===0){createSection();
}showSection(sectionName);});};var visibleContainmentNode=function(){return currentSectionName;};showSection=function(sectionName){$(".sf-element-style-editor-containment-node-menu-item__active").removeClass("sf-element-style-editor-containment-node-menu-item__active");
var menuItem=$("[menuNode='"+sectionName+"']");var section=$("[sectionName='"+sectionName+"']");menuItem.addClass("sf-element-style-editor-containment-node-menu-item__active");
currentSectionName=sectionName;$.each(boxContainer.children(),function(){$(this).hide();});section.show();
};var showSectionOrGeneral=function(sectionName){if(sectionName&&sectionName!==String.EMPTY){showBoxTab();
showSection(sectionName);}else{showGetStarted();}};var setOnClose=function(closeHandler){onClose=closeHandler;
return instance;};instance={close:close,setGetStartedSection:setGetStartedSection,addDetailsSection:addDetailsSection,onClose:setOnClose,visibleContainmentNode:visibleContainmentNode,showSection:showSectionOrGeneral};
return instance;};});$(function(){Spotfire.registerNameSpace("StyleManager");var buildCssString=function(settings){var classNames=settings.classNames;
var pseudoClassNames=settings.pseudoClassNames;var properties=settings.properties;var values=settings.values;
var selectorNodes=settings.selectorNodes;var rules=settings.rules;var builder=[];var buildSelector=function(selector){var build=function(nodeId,classMap,pseudoClassMap){if(nodeId<0){return 0;
}var node=selectorNodes[nodeId];var depth=build(node[1],classMap,pseudoClassMap)+1;if(depth>1){builder.push(" ");
}var s=node[0];if(s==="*"){builder.push(".sf-element");}else{if(s.charAt(0)==="#"){builder.push(s);}else{builder.push(".sf-element-"+s);
}}var classes=classMap[depth];if(classes){$.each(classes,function(i,cId){builder.push(".sfc-"+classNames[cId]);
});}var pClasses=pseudoClassMap[depth];if(pClasses){$.each(pClasses,function(i,cId){var pc=pseudoClassNames[cId];
if(pc==="hover"){builder.push(":hover");}else{if(pc==="focus"){builder.push(":focus");}else{if(pc==="cssactive"){builder.push(":active");
}else{builder.push(".sfpc-"+pseudoClassNames[cId]);}}}});}return depth;};if(typeof selector==="number"){build(selector,{},{});
return;}var toDictionary=function(depthAndIdsArray){var dictionary={};$.each(depthAndIdsArray,function(i,depthAndIds){dictionary[depthAndIds[0]]=depthAndIds[1];
});return dictionary;};build(selector[0],toDictionary(selector[1]),toDictionary(selector[2]));};if(!rules){builder.push("/* What? */\r\n");
}$.each(rules,function(i,rule){if(typeof rule==="string"){builder.push("/* "+rule+" */\r\n");return;}var index;
var numberOfSelectors=rule.length-1;for(index=0;index<numberOfSelectors;index++){if(index>0){builder.push(",\r\n");
}buildSelector(rule[index]);}builder.push("\r\n{");var declarations=rule[numberOfSelectors];var property;
var value;var value2;for(index=0;index<declarations.length;index=index+2){property=properties[declarations[index]];
value=values[declarations[index+1]];if(property==="background-image"&&value.indexOf("linear-gradient(to ")===0){value2=value.substring(19);
builder.push(property+": -o-linear-gradient("+value2+";");builder.push(property+": -moz-linear-gradient("+value2+";");
builder.push(property+": -webkit-linear-gradient("+value2+";");builder.push(property+": -ms-linear-gradient("+value2+";");
}builder.push(property);builder.push(":");builder.push(value);builder.push(";");}builder.push("}\r\n");
});return builder.join("");};Spotfire.StyleManager.update=function(settings,ignoreBackgroundColor){var cssString=buildCssString(settings);
var $style=$("#styleManager");$style.remove();$("<style/>").attr("id","styleManager").html(cssString).appendTo(document.body).trigger("changed");
var $document=$(".sf-element-document");if($document.length===0){return;}if(!ignoreBackgroundColor){var bgColor=$document.css("background-color");
$(document.body).css("background-color",bgColor);}};Spotfire.StyleManager.updateOverrideCss=function(containerSelector,cssString){var $container=$(containerSelector);
var $style=$("style",$container);$style.remove();$style=$("<style/>").html(cssString);$container.append($style);
};Spotfire.StyleManager.updateOverride=function(containerSelector,settings){var cssString=buildCssString(settings);
Spotfire.StyleManager.updateOverrideCss(containerSelector,cssString);};Spotfire.StyleManager.removeOverride=function(containerSelector){var $container=$(containerSelector);
var $style=$("style",$container);$style.remove();};var pseudoClasses={First:"sfpc-first",Last:"sfpc-last",Odd:"sfpc-odd",Even:"sfpc-even"};
Spotfire.StyleManager.setSequencePseudoClasses=function($target,index,count){if(index===0){$target.addClass(pseudoClasses.First);
}else{$target.removeClass(pseudoClasses.First);}if(index===(count-1)){$target.addClass(pseudoClasses.Last);
}else{$target.removeClass(pseudoClasses.Last);}if((index&1)===0){$target.addClass(pseudoClasses.Odd);
$target.removeClass(pseudoClasses.Even);}else{$target.addClass(pseudoClasses.Even);$target.removeClass(pseudoClasses.Odd);
}};});$(function(){Spotfire.registerNameSpace("Visuals.CustomStylingDialog");Spotfire.Visuals.CustomStylingDialog.create=function(args,defaultSectionNameToShow){var clientGeneration=0;
var id;var settings;var defaultValues;var controlReferences={};var dialog;var logSettings=false;var resources=Spotfire.Localization.resources;
var updateCurrentSettings=function(newSettings){id=newSettings.id;settings=newSettings.settings;defaultValues=newSettings.defaultValues;
if(args.fontList){resources.StyleEditor_FontList=args.fontList;resources.StyleEditor_FontSizeList=[6,7,8,9,10,11,12,14,16,18,20,22,24,28,36,48,72];
}settings.rules=settings.rules||[];settings.general=settings.general||{};if(logSettings){Spotfire.log("Style editor settings:\r\nsettings = "+JSON.stringify(settings,null,"  ")+"\r\ndefaultValues = "+JSON.stringify(defaultValues,null,"  "));
}};var addControlReference=function(rule,propertyName,control){controlReferences[rule.containmentNode]=controlReferences[rule.containmentNode]||{};
controlReferences[rule.containmentNode][propertyName]=control;};var getControl=function(rule,propertyName){var controls=controlReferences[rule.containmentNode];
if(controls){return controls[propertyName];}return null;};var getGeneralControl=function(propertyName){var nullControl={properties:$.noop,selected:$.noop,onChange:$.noop};
return getControl({containmentNode:"general"},propertyName)||nullControl;};var handleNewValue=function(){clientGeneration++;
Ajax.enqueueRequest(id,"StyleChange",JSON.stringify({generation:clientGeneration,settings:settings}));
};var indexForContainment=function(settingsObj,containmentName){var settingsIndex=-1;$.each(settingsObj.rules,function(index,node){if(node.containmentNode===containmentName){settingsIndex=index;
}});return settingsIndex;};var ui=(function(){var section=function(sectionName){var nodes=[];var s={name:sectionName,addNodes:function(){nodes=nodes.concat(Array.prototype.splice.call(arguments,0));
return s;},nodes:function(){return nodes;}};return s;};var node=function(nodeName){var generalPropertyNames=[];
var n={name:nodeName,addGeneralProperties:function(){generalPropertyNames=generalPropertyNames.concat(Array.prototype.splice.call(arguments,0));
return n;},generalProperties:function(){return generalPropertyNames;}};return n;};var generalTab=["baseTheme","baseColor","accentColor","defaultFont"];
var detailsTab=[section("page-navigation-bar").addNodes(node("page-navigation-bar").addGeneralProperties("activePageTabBackgroundColor")),section("visualization-area").addNodes(node("visualization-area").addGeneralProperties("visualizationMargin")),section("visual-section").addNodes(node("visual").addGeneralProperties("activeVisualizationBorderColor"),node("table-cell:odd-row")),section("visual-title").addNodes(node("visual-title")),section("scale").addNodes(node("scale-area"),node("scale-line"),node("scale-tick")),section("axis-tray").addNodes(node("axis-tray")),section("annotation").addNodes(node("annotation"))];
var findSection=function(sectionName){return _.find(detailsTab,function(s){return s.name===sectionName;
});};var getContainmentNodeNames=function(sectionName){var s=findSection(sectionName);return s?_.map(s.nodes(),function(n){return n.name;
}):[];};var getGeneralPropertyNames=function(sectionName,containmentNodeName){if(sectionName==="general"){return generalTab;
}var s=findSection(sectionName);if(s){var nodes=s.nodes();if(containmentNodeName!==undefined){nodes=_.filter(nodes,function(n){return n.name===containmentNodeName;
});}return _.flatten(_.map(nodes,function(n){return n.generalProperties();}));}return[];};var getSectionNames=function(){return _.map(detailsTab,function(s){return s.name;
});};return{containmentNodeNames:getContainmentNodeNames,generalPropertyNames:getGeneralPropertyNames,sectionNames:getSectionNames};
}());var generalProperties={baseTheme:{create:function(sectionBuilder){var baseThemeCallback=function(rule,value){settings.general.baseTheme=value;
handleNewValue();};sectionBuilder.createSection().addTitle(resources.StyleEditor_BaseThemeOn).addRadioAccordionControl("baseTheme",baseThemeCallback,"Light",resources.StyleEditor_LightTheme,"Dark",resources.StyleEditor_DarkTheme);
return sectionBuilder.element();},update:function(propertyOverrides,calculatedProperties){var baseTheme=propertyOverrides.baseTheme||calculatedProperties.baseTheme;
getGeneralControl("baseTheme").selected(baseTheme==="Dark"?1:0);},reset:function(){delete settings.general.baseTheme;
}},baseColor:{create:function(sectionBuilder){sectionBuilder.createSection().addTitle(resources.StyleEditor_BaseColor).addSimpleControl("baseColor",Spotfire.Visuals.BoxEditor.colorField());
controlReferences.general.baseColor.onChange(handleNewValue);return sectionBuilder.element();},update:function(propertyOverrides,calculatedProperties){getGeneralControl("baseColor").properties(propertyOverrides,propertyOverrides.hasOwnProperty("baseColor")?propertyOverrides:calculatedProperties);
},reset:function(){delete settings.general.baseColor;}},accentColor:{create:function(sectionBuilder){sectionBuilder.createSection().addTitle(resources.StyleEditor_AccentColor).addSimpleControl("accentColor",Spotfire.Visuals.BoxEditor.colorField());
controlReferences.general.accentColor.onChange(handleNewValue);return sectionBuilder.element();},update:function(propertyOverrides,calculatedProperties){getGeneralControl("accentColor").properties(propertyOverrides,calculatedProperties);
},reset:function(){delete settings.general.accentColor;}},activeVisualizationBorderColor:{create:function(sectionBuilder){sectionBuilder.createSection().addTitle(resources.StyleEditor_ActiveVisualizationBorderColor).addSimpleControl("activeVisualizationBorderColor",Spotfire.Visuals.BoxEditor.colorField());
controlReferences.general.activeVisualizationBorderColor.onChange(handleNewValue);return sectionBuilder.element();
},update:function(propertyOverrides,calculatedProperties){getGeneralControl("activeVisualizationBorderColor").properties(propertyOverrides,calculatedProperties);
},reset:function(){delete settings.general.activeVisualizationBorderColor;}},activePageTabBackgroundColor:{create:function(sectionBuilder){sectionBuilder.createSection().addTitle(resources.StyleEditor_ActivePageTabBackgroundColor).addSimpleControl("activePageTabBackgroundColor",Spotfire.Visuals.BoxEditor.colorField());
controlReferences.general.activePageTabBackgroundColor.onChange(handleNewValue);return sectionBuilder.element();
},update:function(propertyOverrides,calculatedProperties){getGeneralControl("activePageTabBackgroundColor").properties(propertyOverrides,calculatedProperties);
},reset:function(){delete settings.general.activePageTabBackgroundColor;}},defaultFont:{create:function(sectionBuilder){sectionBuilder.createSection().addTitle(resources.StyleEditor_FontFamily).addFontControl();
controlReferences.general["font-family"].onChange(handleNewValue);controlReferences.general.color.onChange(handleNewValue);
return sectionBuilder.element();},update:function(propertyOverrides,calculatedProperties){getGeneralControl("font-family").properties(propertyOverrides,calculatedProperties);
getGeneralControl("color").properties(propertyOverrides,calculatedProperties);},reset:function(){delete settings.general.color;
delete settings.general["font-family"];}},visualizationMargin:{create:function(sectionBuilder){sectionBuilder.createSection().addTitle(resources.StyleEditor_DistanceBetweenVisualizations).addSimpleControl("visualizationMargin",Spotfire.Visuals.BoxEditor.intSpinner());
controlReferences.general.visualizationMargin.onChange(handleNewValue);return sectionBuilder.element();
},update:function(propertyOverrides,calculatedProperties){getGeneralControl("visualizationMargin").properties(propertyOverrides,calculatedProperties);
},reset:function(){delete settings.general.visualizationMargin;}}};var handleResetCallback=function(sectionName){var resetGeneralProperty=function(propertyName){generalProperties[propertyName].reset();
};if(sectionName==="general"){settings.general.baseTheme="Light";}else{var nodeNames=ui.containmentNodeNames(sectionName);
_.each(nodeNames,function(nodeName){var settingsRuleIndex=indexForContainment(settings,nodeName);if(settingsRuleIndex>-1){settings.rules[settingsRuleIndex].box={};
}});}_.each(ui.generalPropertyNames(sectionName),resetGeneralProperty);handleNewValue();};var createGeneralTab=function(){var $element=Spotfire.Flex.item({container:"vertical"});
var sectionBuilder=Spotfire.Visuals.CustomStylingDialog.SectionBuilder({containmentNode:"general",box:defaultValues.general},resources,addControlReference);
$element.append(_.map(ui.generalPropertyNames("general"),function(generalPropertyName){return generalProperties[generalPropertyName].create(sectionBuilder);
}));sectionBuilder.createSection().addResetButton(handleResetCallback,"general");$element.append(sectionBuilder.element());
return $element;};var getRule=function(containmentName){return _.find(settings.rules,function(rule){return rule.containmentNode===containmentName;
});};var getCalculatedRule=function(containmentName){var foundRule=_.find(defaultValues.rules,function(rule){return rule.containmentNode===containmentName;
});if(foundRule){return foundRule;}return{containmentNode:containmentName,box:{}};};var getWritableRule=function(containmentName){var rule=getRule(containmentName);
if(rule){return rule;}rule={containmentNode:containmentName,box:{}};settings.rules.push(rule);return rule;
};var getRulePropertyValue=function(defaultRule,propertyName){var rule=getRule(defaultRule.containmentNode);
if(rule&&rule.hasOwnProperty(propertyName)){return rule.box[propertyName];}return defaultRule.box[propertyName];
};var setBackgroundCallback=function(rule,value){getWritableRule(rule.containmentNode).box["background-color"]=value;
handleNewValue();};var setBorderStyle=function(rule,value){getWritableRule(rule.containmentNode).box["border-style"]=value;
handleNewValue();};var createSectionContent=function(sectionName,rule){var sectionBuilder=Spotfire.Visuals.CustomStylingDialog.SectionBuilder(rule,resources,addControlReference);
var generalSectionBuilder=Spotfire.Visuals.CustomStylingDialog.SectionBuilder({containmentNode:"general",box:defaultValues.general},resources,addControlReference);
var createGeneralPropertyControl=function(generalPropertyName){if(_.contains(ui.generalPropertyNames(sectionName,rule.containmentNode),generalPropertyName)){return generalProperties[generalPropertyName].create(generalSectionBuilder);
}return null;};return[sectionBuilder.createSection(["font-family","font-size"]).addTitle(rule.box.font_title||resources.StyleEditor_FontFamily).addFontControl().element(),sectionBuilder.createSection(["background-color"]).addTitle(rule.box.background_title||resources.StyleEditor_Background).addBackgroundControls(setBackgroundCallback,rule.box.background_disable_transparent===true).element(),createGeneralPropertyControl("activePageTabBackgroundColor"),sectionBuilder.createSection(["margin","margin-top","margin-right","margin-bottom","margin-left"]).addTitle(rule.box.margin_title||resources.StyleEditor_Margin).addExpandableControl("margin",["margin-top","margin-right","margin-bottom","margin-left"],Spotfire.Visuals.BoxEditor.intSpinner).element(),createGeneralPropertyControl("visualizationMargin"),sectionBuilder.createSection(["padding","padding-top","padding-right","padding-bottom","padding-left"]).addTitle(rule.box.padding_title||resources.StyleEditor_Padding).addExpandableControl("padding",["padding-top","padding-right","padding-bottom","padding-left"],Spotfire.Visuals.BoxEditor.intSpinner).element(),sectionBuilder.createSection(["border-style"]).addTitle(rule.box["border-style_title"]||resources.StyleEditor_Borders).addRadioAccordionControl("border-style",setBorderStyle,"none",resources.StyleEditor_BorderNone,"solid",resources.StyleEditor_BorderSolid,Spotfire.Visuals.CustomStylingDialog.SectionBuilder(rule,resources,addControlReference).createSection(["border-width","border-top-width","border-right-width","border-bottom-width","border-left-width"]).addTitle(rule.box["border-width_title"]||resources.StyleEditor_BorderWidth).addExpandableControl("border-width",["border-top-width","border-right-width","border-bottom-width","border-left-width"],Spotfire.Visuals.BoxEditor.intSpinner).element(),Spotfire.Visuals.CustomStylingDialog.SectionBuilder(rule,resources,addControlReference).createSection(["border-color","border-top-color","border-right-color","border-bottom-color","border-left-color"]).addTitle(rule.box["border-color_title"]||resources.StyleEditor_BorderColor).addExpandableControl("border-color",["border-top-color","border-right-color","border-bottom-color","border-left-color"],Spotfire.Visuals.BoxEditor.colorField).element(),createGeneralPropertyControl("activeVisualizationBorderColor")).element(),sectionBuilder.createSection(["border-radius","border-top-left-radius","border-top-right-radius","border-bottom-right-radius","border-bottom-left-radius"]).addTitle(rule.box["border-radius_title"]||resources.StyleEditor_CornerRadius).addExpandableControl("border-radius",["border-top-left-radius","border-top-right-radius","border-bottom-right-radius","border-bottom-left-radius"],Spotfire.Visuals.BoxEditor.intSpinner).element(),sectionBuilder.createSection(["stroke"]).addTitle(rule.box.stroke_title||resources.StyleEditor_StrokeTitle).addStrokeControl().element()];
};var updateControl=function(defaultValueRule,propertyName){var mainControl=getControl(defaultValueRule,propertyName);
if(mainControl){var rule=getRule(defaultValueRule.containmentNode);var box=rule?rule.box:{};var onValueChange=function(){getWritableRule(defaultValueRule.containmentNode).box=box;
handleNewValue();};mainControl.onChange(onValueChange);mainControl.properties(box,defaultValueRule.box);
}};var updateRadioControl=function(rule,propertyName,firstOptionValue){var mainControl=getControl(rule,propertyName);
if(mainControl){mainControl.selected(getRulePropertyValue(rule,propertyName)===firstOptionValue?0:1);
}};var updateBackgroundControls=function(defaultValueRule){var control=getControl(defaultValueRule,"background");
if(!control){return;}var backgroundColor=getRulePropertyValue(defaultValueRule,"background-color");var selectedIndex=backgroundColor==="transparent"?0:1;
control.selected(selectedIndex);updateControl(defaultValueRule,"background-color");};var updateSection=function(rule){updateControl(rule,"font-family");
updateControl(rule,"font-size");updateControl(rule,"font-weight");updateControl(rule,"font-style");updateControl(rule,"text-align");
updateControl(rule,"color");updateBackgroundControls(rule);updateControl(rule,"margin");updateControl(rule,"padding");
updateRadioControl(rule,"border-style","none");updateControl(rule,"border-width");updateControl(rule,"border-color");
updateControl(rule,"border-radius");updateControl(rule,"stroke");};var updateAllBoxesInSection=function(sectionName){_.each(ui.containmentNodeNames(sectionName),function(containmentNode){var rule=getCalculatedRule(containmentNode);
updateSection(rule);});var generalPropertyNames=ui.generalPropertyNames(sectionName);_.each(generalPropertyNames,function(generalPropertyName){generalProperties[generalPropertyName].update(settings.general,defaultValues.general);
});};var populateDetailsTab=function(defaultSectionName){var generateSection=function(sectionName){var section=$("<div/>");
_.each(ui.containmentNodeNames(sectionName),function(containmentNode){var rule=getCalculatedRule(containmentNode);
section.append(createSectionContent(sectionName,rule));});var resetSectionBuilder=Spotfire.Visuals.CustomStylingDialog.SectionBuilder(null,resources,null);
resetSectionBuilder.createSection().addResetButton(handleResetCallback,sectionName);section.append(resetSectionBuilder.element());
return section;};_.each(ui.sectionNames(),function(sectionName){dialog.addDetailsSection(sectionName,generateSection,updateAllBoxesInSection,defaultSectionName!==sectionName);
});dialog.showSection(defaultSectionName);};var updateGetStarted=function(propertyOverrides,calculatedProperties){var pg=propertyOverrides.general;
var cg=calculatedProperties.general;_.map(ui.generalPropertyNames("general"),function(generalPropertyName){generalProperties[generalPropertyName].update(pg,cg);
});};var show=function(args,sectionName){if(dialog){return;}updateCurrentSettings(args);var onClose=function(){Ajax.enqueueRequest(id,"CloseEditor",JSON.stringify({currentNode:dialog.visibleContainmentNode()}));
dialog=undefined;};dialog=new Spotfire.StyleEditorDialog().onClose(onClose);dialog.setGetStartedSection(createGeneralTab());
populateDetailsTab(sectionName);Spotfire.Visuals.CustomStylingDialog.instance.update();};var close=function(){if(dialog){dialog.close();
dialog=undefined;}};var update=function(updateArgs){if(!dialog){return;}if(updateArgs&&updateArgs.generation<clientGeneration){return;
}if(updateArgs){updateCurrentSettings(updateArgs);}updateGetStarted(settings,defaultValues);_.each(ui.sectionNames(),updateAllBoxesInSection);
};var isOpen=function(){return dialog!==undefined;};var instance={close:close,update:update,isOpen:isOpen};
if(Spotfire.Visuals.CustomStylingDialog.instance&&Spotfire.Visuals.CustomStylingDialog.instance.isOpen()){return Spotfire.Visuals.CustomStylingDialog.instance;
}Spotfire.Visuals.CustomStylingDialog.instance=instance;show(args,defaultSectionNameToShow);return instance;
};});$(function(){Spotfire.registerNameSpace("Svg");Spotfire.Svg.createTextElement=function(originalText,fontSize,fontFamily,x,y,maxWidth,maxRows){var canvas=document.createElement("canvas");
var displayNameFont=fontSize+"px "+fontFamily;var context=canvas.getContext("2d");context.font=displayNameFont;
var getTextWidth=function(text){var metrics=context.measureText(text);return metrics.width;};var getTruncatedText=function(text){var len=text.length;
var truncatedText=text;while(len>1&&getTextWidth(truncatedText)>=maxWidth){len=len-1;truncatedText=text.substr(0,len)+"...";
}return truncatedText;};var getResultRows=function(){if(maxRows===1){return[getTruncatedText(originalText)];
}var rowWords=[];var words=originalText.split(/\s+/).reverse();var word;var currentRowNumber=0;var currentRowText;
var resultRows=[];while(words.length>0){word=words.pop();rowWords.push(word);currentRowText=rowWords.join(" ");
resultRows[currentRowNumber]=currentRowText;if(getTextWidth(currentRowText)>=maxWidth){if(currentRowNumber===(maxRows-1)||rowWords.length===1){resultRows[currentRowNumber]=getTruncatedText(currentRowText);
break;}rowWords.pop();resultRows[currentRowNumber]=rowWords.join(" ");rowWords=[word];currentRowNumber++;
if(getTextWidth(word)>=maxWidth){resultRows[currentRowNumber]=getTruncatedText(word);break;}resultRows[currentRowNumber]=word;
}}return resultRows;};var i;var span;var resultRows=getResultRows();var svgTextElement=document.createElementNS("http://www.w3.org/2000/svg","text");
for(i=0;i<resultRows.length;++i){span=document.createElementNS("http://www.w3.org/2000/svg","tspan");
svgTextElement.appendChild(span).appendChild(document.createTextNode(resultRows[i]));d3.select(span).attr("x",x).attr("dy",i===0?"0px":fontSize+2+"px");
}d3.select(svgTextElement).attr("x",x+"px").attr("y",y+"px").attr("font-size",fontSize+"px").attr("font-family",fontFamily);
return svgTextElement;};});$(function(){CodeMirror.defineMode("spotfire",function(){var keywords={as:true,distinct:true,"case":true,when:true,then:true,"else":true,end:true,is:true,not:true,"null":true,and:true,or:true,xor:true,over:true,nest:true,cross:true,cast:true,"in":true,"true":true,"false":true};
var operators=/^[*+\-%<>!=&|~\^]/;function tokenBase(stream,state){var ch=stream.next();if(ch==="0"&&stream.match(/^[xX][0-9a-fA-F]+/)){return"number";
}if(ch.charCodeAt(0)>47&&ch.charCodeAt(0)<58){stream.match(/^[0-9]*\.?[0-9]+([eE][\-+]?[0-9]+)?[lmf]?/);
return"number";}if(ch==="'"&&stream.match(/[^']*['](['][^']*['])*/)){return"string";}if(ch==='"'&&stream.match(/[^\"]*[\"]([\"][^\"]*[\"])*/)){return"string";
}if(ch==="'"||ch==='"'){return"string";}if(operators.test(ch)){return"operator";}if(ch==="["&&stream.match(/[^\]]*[\]]([\]][^\]]*[\]])*/)){return"def";
}if(!ch.match(/^[_\w\d]/)){return null;}stream.eatWhile(/^[_\w\d]/);var word=stream.current().toLowerCase();
if(keywords.hasOwnProperty(word)){return"keyword";}return null;}return{startState:function(){return{tokenize:tokenBase};
},token:function(stream,state){if(stream.eatSpace()){return null;}return state.tokenize(stream,state);
}};});});$(function(){Spotfire.registerNameSpace("Visuals.TabControl");var currentInstance=null;var currentId=null;
function TabControl(id,settings){var isAuthor=Spotfire.isAuthorMode();var showAddPageTab=isAuthor&&Spotfire.Licenses.licensedFeatures.CreatePage;
var box=settings.box;var $parent=$("#"+id).addClass(box.classes).sfFlex({container:"horizontal","align-items":"stretch"});
$parent.addClass("sf-element-tab-control");var $viewport=$("<div/>").addClass("viewport");var $tabContainer=$("<div/>").addClass("sf-element-tab-group").sfFlex({container:"horizontal","align-items":"stretch"});
var $pageTitle=$("<div/>").addClass("pageTitle");var $linkContainer=$("<div/>").addClass("linkContainer");
var layout=$.noop;var spawnedWindows=[];var currentIndex=settings.currentIndex;var goLeft=function(){return Math.max(0,currentIndex-1);
};var goRight=function(){return Math.min(settings.pages.length-1,currentIndex+1);};Spotfire.Focus.handleKeyDown($parent,function(e){var index=currentIndex;
if($("input",$parent).length>0){return;}switch(e.keyCode){case Keys.LEFT:index=goLeft();break;case Keys.RIGHT:index=goRight();
break;}if(index!==currentIndex){Ajax.enqueueRequest(id,"TabChange",index);}});var spawnedWindowLocationReplace=function(index,url){if(spawnedWindows.length<=index){return;
}var otherWindow=spawnedWindows[index];if(otherWindow){otherWindow.location.replace(url);spawnedWindows[index]=null;
}};if(Spotfire.isWebPlayer()&&settings.isMultipleViewsEnabled){var onContextMenuClick=function(item){var windowIndex=spawnedWindows.push(window.open("about:blank"))-1;
Ajax.enqueueRequest(id,"SpawnView",JSON.stringify({pageIndex:item.pageIndex,windowIndex:windowIndex}));
return true;};var onShowNavigationContextMenu=function(subject,message){var data=JSON.parse(message);
if(data.tabIndex>=0){var items=[{text:Spotfire.Localization.resources.TabControlOpenPageInNewWindow,enabled:true,pageIndex:data.tabIndex}];
var menu=Spotfire.Controls.ContextMenu.create(items,onContextMenuClick);menu.show(data.x,data.y);}};Spotfire.PageBus.subscribe("spotfire.visuals.shownavigationcontextmenu",onShowNavigationContextMenu);
}$parent.on("contextmenu",function(e){e.preventDefault();var $tab=$(e.target).closest("[tabIndex]");var tabIndex=-1;
if($tab.length===1){tabIndex=$tab.attr("tabIndex");}var position={x:e.pageX,y:e.pageY,tabIndex:parseInt(tabIndex,10)};
Spotfire.PageBus.publish("spotfire.visuals.shownavigationcontextmenu",position);});var createButton=function(tooltip,svgUrl,onClick,enableLongClick){var $button=$("<div/>");
Spotfire.Controls.PanelButton.initialize($button,tooltip,svgUrl);if(enableLongClick){$button.sfLongClick(onClick);
}else{$button.click(onClick);}return $button;};var createLeftButton=function(onClick,enableLongClick){return createButton(Spotfire.Localization.resources.TabControlHistoryBack,"Images/TabControl/LeftArrow.svg",onClick,enableLongClick).sfFlex();
};var createRightButton=function(onClick,enableLongClick){return createButton(Spotfire.Localization.resources.TabControlHistoryForward,"Images/TabControl/RightArrow.svg",onClick,enableLongClick).sfFlex();
};var getLeftMostVisibleTab=function(){var $result=$();$(".sf-element-page-tab",$tabContainer).each(function(){var $tab=$(this);
if(0<=$tab.position().left){$result=$tab;return false;}return true;});return $result;};var scrollTabsLeft=function(){var $prev=getLeftMostVisibleTab().prev();
$viewport.scrollLeft($prev.length>0?$viewport.scrollLeft()+$prev.position().left:0);};var scrollTabsRight=function(){var $next=getLeftMostVisibleTab().next();
$viewport.scrollLeft($next.length>0?$viewport.scrollLeft()+$next.position().left:$tabContainer.width());
};var addNewPage=function(){Ajax.enqueueRequest(id,"NewPage","");};var createAddPageTabButton=function(includeClickHandler){return createButton(Spotfire.Localization.resources.ToolBar_NewPage,"Images/TabControl/AddPage.svg",includeClickHandler?addNewPage:undefined);
};var handleSelectPageButtonClick=function(e,$button){if(Spotfire.isProfessional()){var position={x:e.pageX,y:e.pageY};
Spotfire.PageBus.publish("spotfire.tabcontrol.showselectpagedropdownmenu",position);}else{var onMenuItemClicked=function(menuItem){Ajax.enqueueRequest(id,"TabChange",menuItem.index);
return true;};var pageMenuItems=[];$.each(settings.pages,function(index,page){pageMenuItems.push({enabled:true,checked:index===currentIndex,text:page.title,index:index});
});var offset=$button.offset();var menu=Spotfire.Controls.ContextMenu.create(pageMenuItems,onMenuItemClicked);
menu.show(offset.left,offset.top+$button.outerHeight());}};var createSelectPageDropDownButton=function(){var $button;
var onClick=function(e){handleSelectPageButtonClick(e,$button);};$button=createButton(Spotfire.Localization.resources.TabControlSelectPageDropdown,"Images/TabControl/DownArrow.svg",onClick);
return $button;};var createAddPageTab=function(){var $tab=$("<div/>").addClass("newPageTab sf-element sf-element-page-tab").attr("title",Spotfire.Localization.resources.ToolBar_NewPage);
createAddPageTabButton(false).appendTo($tab);$tab.click(addNewPage);return $tab;};var createInputField=function(page,index,$tab,$tabTitle){var $input=$("<input type='text'/>").addClass("sf-element-text-box").val(page.expression);
Spotfire.Controls.InputField.handleDraggable($input);$input.on("keydown",function(e){if(e.keyCode===13){$(this).blur();
}});$input.on("blur",function(){var value=$input.val();if(value===""||value===page.expression){$input.remove();
$tab.prepend($tabTitle);layout();return;}var args={index:index,newName:value};Ajax.enqueueRequest(id,"TabRename",JSON.stringify(args));
});return $input;};var createTabs=function(){var pageRequester=(function(){var requestedPageIndex=-1;
var requestPageTimer=null;var requestPage=function(){Spotfire.DragDrop.handlePageChange();Ajax.enqueueRequest(id,"TabChange",requestedPageIndex);
requestPageTimer=null;requestedPageIndex=-1;};var setPage=function(pageIndex){if(pageIndex===currentIndex||pageIndex===requestedPageIndex){return;
}requestedPageIndex=pageIndex;if(requestPageTimer){window.clearTimeout(requestPageTimer);}requestPageTimer=window.setTimeout(requestPage,500);
};return{setPage:setPage};}());var createTab=function(index,page){var closeTab=function(){Ajax.enqueueRequest(id,"TabClose",index);
return false;};var $tab=Spotfire.Flex.item({container:"horizontal","align-items":"center"}).addClass(box.children[0].children[0].children[index].classes).attr("title",page.title).attr("tabIndex",index).appendTo($tabContainer).on("click",function(e){if(e.which===2&&isAuthor){closeTab();
return;}if(e.which===1&&index!==currentIndex){Ajax.enqueueRequest(id,"TabChange",index);}});var $tabTitle=$("<span/>").addClass("sf-element sf-element-text-box").text(page.title).appendTo($tab);
if(page.title===""){$tabTitle.html("&nbsp;");}if(!isAuthor){return;}createButton(Spotfire.Localization.resources.TabControlRemoveLabel,"Images/TabControl/RemoveTab.svg",closeTab).appendTo($tab);
$tab.on("dblclick",function(){if($("input",$tab).length>0){return;}var $input=createInputField(page,index,$tab,$tabTitle);
$input.height($tabTitle.height());$tabTitle.detach();$tab.prepend($input);$input.focus();$input.select();
});Spotfire.DragDrop.makeDraggable($tab,{populateData:function(data){data.containsPage=true;data.pageIndex=index;
Spotfire.DragDrop.populateBookmarkData(data,id,page.id);},dragEnd:function(){$(".dropTarget",$parent).remove();
}});Spotfire.DragDrop.makeDroppable($tab,{onDrop:function(e,data){if(_.isUndefined(data.pageIndex)||data.pageIndex===index){return false;
}var args={index:data.pageIndex,to:index};Ajax.enqueueRequest(id,"TabMove",JSON.stringify(args));return true;
},onDragOver:function(e,data){$(".dropTarget",$parent).remove();if(data.visualId){pageRequester.setPage(index);
return true;}if(_.isUndefined(data.pageIndex)||data.pageIndex===index){return false;}var $dropTarget=$("<div/>").text("\u2193").addClass("dropTarget");
if(index<data.pageIndex){$tab.before($dropTarget);}else{$tab.after($dropTarget);}return true;}});};$.each(settings.pages,createTab);
var $overflowWrap=$("<div/>").addClass("overflowWrap");$parent.append($viewport);$viewport.append($overflowWrap);
$overflowWrap.append($tabContainer);if(isAuthor){$viewport.on("dblclick",function(e){if($(this).is(e.target)){Ajax.enqueueRequest(id,"NewPage","");
}});}};var createLinksInLinkContainer=function(){var onLinkClicked=function(index){if(index===-1){index=goLeft();
}else{if(index===-2){index=goRight();}}if(index!==currentIndex){Ajax.enqueueRequest(id,"TabChange",index);
}};var lastPageIndex=settings.pages.length-1;var firstVisibleLinkIndex=Math.max(0,currentIndex-2-(Math.max(0,2-(lastPageIndex-currentIndex))));
var lastVisibleLinkIndex=Math.min(firstVisibleLinkIndex+4,lastPageIndex);var createLink=function(index){if(index>=0&&(index<firstVisibleLinkIndex||index>lastVisibleLinkIndex)){return null;
}var $item=$("<span/>").addClass("link").text(index+1).appendTo($linkContainer).on("click",function(){onLinkClicked(index);
});var isActive=index===currentIndex;if(isActive){$item.addClass("activeLink");}return $item;};createLink(-1).text(Spotfire.Localization.resources.TabControlBackLabel);
$.each(settings.pages,createLink);createLink(-2).text(Spotfire.Localization.resources.TabControlNextLabel);
};var createLinks=function(){createLinksInLinkContainer();$parent.append($pageTitle);$parent.append($linkContainer);
};var renameActivePage=function(){$(".sfpc-active",$tabContainer).dblclick();};var setActivePage=function(){if(currentIndex<0){return;
}$pageTitle.text(settings.pages[currentIndex].title);if($tabContainer.children().hasClass("compactTab")){$(".sf-element-text-box",$tabContainer.children(".compactTab")).text(settings.pages[currentIndex].title);
return;}$(".sf-element-page-tab",$tabContainer).each(function(j,elem){var $tab=$(elem);var isActive=j===currentIndex;
$tab.toggleClass("sfpc-active",isActive);if(isActive){var left=$tab.position().left;var scrollLeft=$viewport.scrollLeft();
var width=$viewport.width();if(left<0||width<left){$viewport.scrollLeft(scrollLeft+left);}else{if(left+$tab.width()>width){$viewport.scrollLeft(scrollLeft+$tab.width());
}}}});if(settings.mode==="Links"){$linkContainer.empty();createLinksInLinkContainer();}};var createHistoryButtons=function(){var historyBack=function(){Ajax.enqueueRequest(id,"HistoryBack","");
};var historyForward=function(){Ajax.enqueueRequest(id,"HistoryForward","");};var $buttons=Spotfire.Flex.item({container:"horizontal","align-items":"stretch"}).addClass("sf-element-button-group").append(createLeftButton(historyBack)).append(createRightButton(historyForward));
$parent.append($buttons);$parent.append($pageTitle);};var createCompactPageTab=function(){if(settings.pages.length===0){return;
}var index=currentIndex;var page=settings.pages[index];var $tab=Spotfire.Flex.item({container:"horizontal"}).addClass(box.children[0].children[0].children[index].classes).attr("title",page.title).attr("tabIndex",index).appendTo($tabContainer).addClass("compactTab").on("click",function(e){handleSelectPageButtonClick(e,$tab);
});var $tabTitle=Spotfire.Flex.item({grow:true}).addClass("sf-element sf-element-text-box").css("flex-basis","0").text(page.title).appendTo($tab);
if(page.title===""){$tabTitle.html("&nbsp;");}var closeTab=function(e){handleSelectPageButtonClick(e,$tab);
};createButton("Remove","Images/TabControl/DownArrow.svg",closeTab).appendTo($tab).css("flex-basis","1em");
};var assignPseudoClassesToTabChildren=function(){$tabContainer.children().each(function(){var tabChildren=$(this).children(".sf-element");
var tabChildCount=tabChildren.length;tabChildren.each(function(index,child){Spotfire.StyleManager.setSequencePseudoClasses($(child),index,tabChildCount);
});});};layout=function(){$viewport=$("<div/>").addClass("viewport");$tabContainer=$("<div/>").addClass("sf-element-tab-group").sfFlex({container:"horizontal","align-items":"stretch"});
$pageTitle=$("<div/>").addClass("pageTitle");$linkContainer=$("<div/>").addClass("linkContainer");$parent.empty();
if(!isAuthor&&$parent.width()<170&&(settings.mode==="Tabs"||settings.mode==="Links")){createCompactPageTab();
$parent.append($tabContainer);}else{switch(settings.mode){case"Tabs":createTabs();break;case"Links":createLinks();
break;case"None":createHistoryButtons();break;}$pageTitle.css("line-height",$parent.height()+"px");$linkContainer.css("line-height",$parent.height()+"px");
if(settings.mode==="Tabs"){$(".sf-element-button-group",$parent).remove();$(".newPageTab",$parent).remove();
var buttonGroupFlex={container:"horizontal","align-items":"stretch",shrink:false};var buttonFlex={container:"horizontal","align-items":"center"};
if(showAddPageTab){$tabContainer.append(createAddPageTab().sfFlex(buttonFlex));}var $buttons=$("<div/>").addClass("sf-element-button-group").sfFlex(buttonGroupFlex);
if(isAuthor){$buttons.append(createSelectPageDropDownButton().sfFlex(buttonFlex));}assignPseudoClassesToTabChildren();
var parentWidth=$parent.width();$parent.append($buttons);$viewport.width(parentWidth-$buttons.outerWidth(true));
var showScrollButtons=($tabContainer.width()>$viewport.width());if(showScrollButtons){$(".newPageTab",$parent).remove();
$buttons.prepend(createRightButton(scrollTabsRight,true).sfFlex(buttonFlex));$buttons.prepend(createLeftButton(scrollTabsLeft,true).sfFlex(buttonFlex));
if(showAddPageTab){$buttons.prepend(createAddPageTabButton(true).sfFlex(buttonFlex));}}var buttonCount=$buttons.children().length;
buttonCount+=isAuthor?0:1;$buttons.children().each(function(index){Spotfire.StyleManager.setSequencePseudoClasses($(this),index,buttonCount);
});$viewport.width(parentWidth-$buttons.outerWidth(true));}}setActivePage();};var update=function(state){currentIndex=state.currentIndex;
setActivePage();};layout();$parent.on("sf-resize",function(){layout();});return{update:update,close:$parent.empty,renameActivePage:renameActivePage,spawnedWindowLocationReplace:spawnedWindowLocationReplace};
}Spotfire.Visuals.TabControl.spawnedWindowLocationReplace=function(id,url){if(currentInstance!==null){currentInstance.spawnedWindowLocationReplace(id,url);
}};Spotfire.Visuals.TabControl.initialize=function(id,settings){if(currentInstance!==null){currentInstance.close();
currentId=null;}currentInstance=new TabControl(id,settings);currentId=id;};Spotfire.Visuals.TabControl.update=function(settings){if(currentInstance!==null){currentInstance.update(settings);
}};Spotfire.Visuals.TabControl.renameActivePage=function(){if(currentInstance!==null){currentInstance.renameActivePage();
}};var dropHandler=function(){return{onDrop:function(e,data){var bookmarkUri=data.bookmarkUri;if(bookmarkUri){Ajax.enqueueRequest(currentId,"InsertBookmark",{bookmarkUri:bookmarkUri});
return;}}};};var supportsData=function(data){if(currentId===null){return false;}if(data.containsPage!==undefined&&data.containsPage){return Spotfire.DragDrop.isExternalBookmark(data);
}return false;};Spotfire.DragDrop.makeDroppableWithOverlay($(document.body),supportsData,dropHandler);
});$(function(){if(Spotfire.capabilities.supportsTouch()){$(document.body).css({"user-select":"none"});
return;}var supportsSelectStart="onselectstart" in document.body;var whitelist=["[draggable='true']","select","input","option","textarea",".sf-enable-selection",".HtmlTextArea"].join(", ");
var blacklist=["[draggable='false']","body",".HtmlTextAreaControl"].join(", ");var $body=$(document.body);
$body.on("mousedown",function(e){var $target=$(e.target);var $parent=$target;while(true){if($parent.length===0){break;
}if($parent.is(whitelist)){return;}if($parent.is(blacklist)){break;}$parent=$parent.parent();}try{var $activeElement=$(document.activeElement);
if($activeElement.is("input, textarea")&&!$activeElement.is(e.target)){$activeElement.blur();}}catch(ex){}if(supportsSelectStart){var $both=$body.add($target);
var nope=function(event){event.preventDefault();};var onMouseUp=function(){$both.off("selectstart",nope).removeAttr("unselectable");
$body.off("mouseup",onMouseUp);};$both.on("selectstart",nope).attr("unselectable","on");$body.on("mouseup",onMouseUp);
}e.preventDefault();});var ctrlDown=false;$body.on("keydown",function(e){if(e.keyCode===Keys.CONTROL){ctrlDown=true;
}if(ctrlDown&&e.keyCode===Keys.A){if(!$(document.activeElement).is("textarea, input[type=text], input[type=password]")){e.preventDefault();
}}});$body.on("keyup",function(e){if(e.keyCode===Keys.CONTROL){ctrlDown=false;}});});var T=T||{};(function(exports){var OverlayBubbles=function(){this._tooltips=[];
this._dict={};document.addEventListener("tibco-bubble-remove",$.proxy(function(e){this._removeFromDict(e.detail);
},this));};OverlayBubbles._ERRORS={INVALID_OPTIONS:"Invalid Overlay options!",INVALID_TARGET_ELEMENTS:"Invalid target elements. Selector is mandatory!"};
OverlayBubbles.prototype={style:null,filterByPriority:true,add:function(toAdd){if($.isArray(toAdd)){$.each(toAdd,$.proxy(function(index,value){value.style=this.style;
var tt=this._createTooltip(value);this._addToDict(tt);},this));}else{var tt=this._createTooltip(toAdd);
this._addToDict(tt);}},_createTooltip:function(fromObj){return new T.OverlayBubble(fromObj);},_addToDict:function(bubble){if(!this.filterByPriority){return;
}if(bubble.type){if(this._dict[bubble.type]){if(this._dict[bubble.type].priority>bubble.priority){this._dict[bubble.type].remove();
this._dict[bubble.type]=bubble;}else{bubble.remove();}}else{this._dict[bubble.type]=bubble;}}},_removeFromDict:function(bubble){if(this._dict[bubble.type]===bubble){delete this._dict[bubble.type];
}}};var SingletonEnforcer=function(){var instance;return{getInstance:function(){if(instance===undefined){instance=new OverlayBubbles();
}return instance;}};};exports.OverlayBubbles=new SingletonEnforcer();}(T));(function(exports){var OverlayBubble=function(options){this._setup(options);
this._init();};OverlayBubble._ERRORS={NOT_INITIALIZED:"Overlay tooltip not initialized properly!",MISSING_OPTIONS:"Invalid tooltip options!",ELEMENT_NOT_FOUND:"Invalid tooltip selector!",ELEMENT_NOT_VISIBLE:"Hidden tooltip selector!"};
OverlayBubble.prototype={style:{bubble:{position:"absolute"},tooltip:{position:"relative"},pointer:{position:"absolute"},closeButton:{position:"absolute"}},_setup:function(options){if(options){this.selector=options.selector;
this.documentNodeId=options.documentNodeId;this.text=options.text;this.anchor=options.anchor||"bottom";
this.closeCallback=options.closeCallback;this.type=options.type;this.priority=options.priority;this.verticalOffsetMultiplier=options.offset||1;
this.el=$(this.selector);this.hasExtras=(options.hasExtras!==null&&options.hasExtras!==undefined?options.hasExtras:true);
if(this.el.parent().css("display")==="none"){throw new Error(OverlayBubble._ERRORS.ELEMENT_NOT_VISIBLE);
}if(this.el.length<=0){throw new Error(OverlayBubble._ERRORS.ELEMENT_NOT_FOUND);}if(options.style){this._updateStyle(options.style);
}}},_init:function(){this.add();this._addEventListeners();},_updateStyle:function(style){var self=this;
if(style.bubble){$.each(style.bubble,function(key,value){self.style.bubble[key]=value;});}if(style.pointer){$.each(style.pointer,function(key,value){self.style.pointer[key]=value;
});}if(style.closeButton){$.each(style.closeButton,function(key,value){self.style.closeButton[key]=value;
});}},add:function(){this._addTooltip();this._addTooltipText();this._addCloseButton();this._addPointer();
this._setStyle();if(!this.hasExtras){this._noExtras();}this._position();},_addEventListeners:function(){this.closeButton.bind("click",$.proxy(function(){var event=new CustomEvent("tibco-bubble-remove",{detail:this});
document.dispatchEvent(event);this.remove();},this));},remove:function(){this._removeEventListeners();
if(this.wrapper!==null&&this.wrapper!==undefined){if(this.hasExtras){this.wrapper.fadeOut(200,function(){this.remove();
});}else{this.wrapper.remove();}}},_removeEventListeners:function(){this.closeButton.unbind("click");
},update:function(options,animate,duration){animate=animate||false;duration=duration||300;this._setup(options);
this._position(animate,duration);},_addTooltip:function(){this.wrapper=$("<div>");this.tooltip=$("<div>");
this.wrapper.addClass("OverlayWrapper");this.tooltip.addClass("OverlayWrapper-tooltip");$("body").append(this.wrapper);
this.wrapper.append(this.tooltip);this.wrapper.attr("data-type",this.type);this.wrapper.attr("data-priority",this.priority);
},_addTooltipText:function(){this.tooltiptext=$("<div>");this.tooltiptext.text(this.text);this.tooltip.prepend(this.tooltiptext);
},_addPointer:function(){this.pointer=$("<div>");this.pointer.addClass("OverlayWrapper-pointer");this.wrapper.prepend(this.pointer);
},_addCloseButton:function(){this.closeButton=$("<div>&times;</div>");this.closeButton.addClass("OverlayWrapper-close-button");
this.tooltip.append(this.closeButton);},_noExtras:function(){this.wrapper.addClass("OverlayWrapper-noExtras");
this.tooltip.addClass("OverlayWrapper-noExtras");this.pointer.addClass("OverlayWrapper-noExtras");this.pointer.css("background","none");
},_drawPointer:function(){var i;this.pointer.empty();if(this.anchor==="top"){for(i=0;i<=10;i++){$("<div>").css({width:20-i*2+"px",height:"4px",top:9+i+"px",left:i+"px"}).appendTo(this.pointer);
}}else{if(this.anchor==="right"){for(i=0;i<=10;i++){$("<div>").css({width:"4px",height:i*2+"px",top:10-i+"px",left:-2+i+"px"}).appendTo(this.pointer);
}}else{if(this.anchor==="bottom"){for(i=0;i<=10;i++){$("<div>").css({width:i*2+"px",height:"4px",top:-2+i+"px",left:10-i+"px"}).appendTo(this.pointer);
}}else{for(i=0;i<=10;i++){$("<div>").css({width:"4px",height:i*2+"px",top:10-i+"px",left:18-i+"px"}).appendTo(this.pointer);
}}}}},_setStyle:function(){this.wrapper.css(this.style.bubble);this.tooltip.css(this.style.tooltip);this.pointer.css(this.style.pointer);
this.closeButton.css(this.style.closeButton);},_position:function(animate,duration){animate=animate||false;
duration=duration||300;var offset=this.el.offset(),h=this.el.outerHeight(),w=this.el.outerWidth(),th=this.wrapper.outerHeight(),tw=this.wrapper.outerWidth(),top,left;
if(!this.hasExtras){this._drawPointer();}switch(this.anchor){case"right":top=offset.top+(h/2)*this.verticalOffsetMultiplier-th/2;
left=offset.left+w+8;this.pointer.css("top",th/2-10+"px");this.pointer.css("left","-8px");break;case"left":top=offset.top+(h/2)*this.verticalOffsetMultiplier-th/2;
left=offset.left-tw-8;this.pointer.css("top",th/2-10+"px");this.pointer.css("left",tw-12+"px");break;
case"top":top=offset.top-th*this.verticalOffsetMultiplier+-8;left=offset.left+w/2-(tw/2);this.pointer.css("top",th-12+"px");
this.pointer.css("left",tw/2-10+"px");break;case"bottom":top=offset.top+h*this.verticalOffsetMultiplier+8;
left=offset.left+w/2-(tw/2);this.pointer.css("top",-8+"px");this.pointer.css("left",tw/2-10+"px");break;
}if(animate&&this.hasExtras){if(Math.floor(this.wrapper.offset().left)!==Math.floor(left)||Math.floor(this.wrapper.offset().top)!==Math.floor(top)){this.wrapper.animate({top:top+"px",left:left+"px"},duration);
}}else{this.wrapper.css("top",top+"px");this.wrapper.css("left",left+"px");}}};exports.OverlayBubble=OverlayBubble;
}(T));(function(){function CustomEvent(event,params){params=params||{bubbles:false,cancelable:false,detail:undefined};
var evt=document.createEvent("CustomEvent");evt.initCustomEvent(event,params.bubbles,params.cancelable,params.detail);
return evt;}CustomEvent.prototype=window.Event.prototype;window.CustomEvent=CustomEvent;})();$(function(){var isDirty=false;
var hasDocument=false;var userPressedF5=false;$(window).keydown(function(event){userPressedF5=(event.keyCode===116);
});Spotfire.registerNameSpace("ToolBar");Spotfire.ToolBar.menuOffsetY=30;var setEnabledButton=function(selector,enabled){selector.toggleClass("DisabledButton",!enabled);
};var setActiveButton=function(selector,active){if(active){$(".toolBarImage",selector).css({"background-position":("-24px "+selector.data("img")+"px")});
selector.addClass("active");}else{$(".toolBarImage",selector).css({"background-position":("0px "+selector.data("img")+"px")});
selector.removeClass("active");}};var createDivider=function(parent,floatRight,noMargin,showWhenNoDocument){var $divider=$("<div/>").addClass("divider").toggleClass("hide-when-no-doc",!showWhenNoDocument);
parent.append($divider);if(floatRight){$divider.addClass("floatRight");}if(noMargin){$divider.addClass("noDividerMargin");
}return $divider;};var createButton=function(parent,callbackId,callback,options,showWhenNoDocument){var $div=$("<div/>").addClass("toolBarButton").toggleClass("hide-when-no-doc",!showWhenNoDocument);
$div.data("img",options.img);var $innerDiv=$("<div/>").addClass("toolBarButtonInner");$div.append($innerDiv);
setEnabledButton($div,options.enabled);if(options.id){$div.attr("id",options.id);}if(options.img!==undefined){var $imagediv=$("<div/>").addClass("toolBarImage").css({position:"relative","float":"left","background-image":"url(Images/ToolBar/Toolbar-icons-image-map.png)","background-position":"0 "+options.img+"px","background-repeat":"no-repeat",width:"24px",height:"24px"});
$innerDiv.append($imagediv);if(options.margins){$imagediv.css("margin","0 "+options.margins+"px");}}$div.hover(function(){if(!$div.hasClass("DisabledButton")){$div.addClass("mouseover");
}},function(){$div.removeClass("mouseover");});if(options.text){$div.attr("title",options.text);var span=$("<div/>").addClass("ToolBarButtonText").text(options.text);
$innerDiv.append(span);$div.addClass("textButton");}if(options.tooltip){$div.attr("title",options.tooltip);
}if(options.dropDown&&options.items){var $img=$("<div/>").addClass("arrowDown");$innerDiv.append($img);
$div.addClass("ToolBarDropDown");}var mouseup=function(){$div.removeClass("active");$(".toolBarImage",$div).css({"background-position":"0px "+options.img+"px"});
$(".arrowDown",$div).removeClass("arrowDownMouseover");$(document.body).off("mouseup",mouseup);};var mousedown=function(){if(!$div.hasClass("DisabledButton")){$(".toolBarImage",this).css({"background-position":("-24px "+options.img+"px")});
$(this).addClass("active");$(".arrowDown",this).addClass("arrowDownMouseover");$(document.body).on("mouseup",mouseup);
}};$div.on("mousedown",mousedown);if(options.items){$div.click(function(){if(!$(this).hasClass("DisabledButton")){var point=new Point(options.dropDownXAdjust!==undefined?options.dropDownXAdjust:-10,Spotfire.ToolBar.menuOffsetY);
Spotfire.Controls.DropDownMenu.initialize(options.id,options.items,point,callbackId).on("remove",Spotfire.ToolBar.onMenuClose);
$(document).trigger("onDropDownOpen",options.id);}});}else{if(options.onClick){$div.click(function(){if(!$(this).hasClass("DisabledButton")){options.onClick.call(this);
}});}else{$div.click(function(){if(!$(this).hasClass("DisabledButton")){Ajax.enqueueRequest(callbackId,callback,"");
}});}}parent.append($div);return $div;};Spotfire.ToolBar.initialize=function(id,settings){if(window.initLibrary){window.initLibrary();
}this.settings=settings;isDirty=settings.isDirty;$(window).off("beforeundload.spotfire").on("beforeunload.spotfire",function(){Spotfire.MultipleViews.OnClosing();
if(!userPressedF5&&isDirty&&Spotfire.MultipleViews.GetSiblings().length===0){return Spotfire.Localization.resources.ClosingBrowserWindowWarning;
}});this.settings.activePropertiesButton=null;var i,j;var $toolbar=$("#"+id).empty();var $toolbarDimmer=$("<div/>").addClass("dimmer").css("opacity",0.55);
var timer=null;var onHoverOut=function(){$toolbar.data("over",false);if(timer!==null){window.clearTimeout(timer);
}if(!Spotfire.ToolBar.ToolsMenu.isPopoutOpen()){timer=setTimeout(function(){$toolbarDimmer.stop().fadeTo(400,0.55);
},200);}};$toolbar.data("onHoverOut",onHoverOut);$toolbar.hover(function(){$toolbar.data("over",true);
if(timer!==null){window.clearTimeout(timer);}$toolbarDimmer.stop().fadeOut(0);},onHoverOut);var button=createButton($toolbar,id,"CloseAnalysis",{enabled:true,tooltip:Spotfire.Localization.resources.ToolBar_CloseAnalysis,img:-336,margins:-3},true);
button.addClass("floatRight lastButton");createDivider($toolbar,true,false,true);if(settings.showHelpMenu){var helpMenu=createButton($toolbar,id,"HelpDropDownClick",{id:settings.helpMenuId,enabled:true,tooltip:Spotfire.Localization.resources.Help,img:-432,margins:0},true);
helpMenu.addClass("floatRight");}var menu=createButton($toolbar,id,"AnalysisDropDownClick",{id:settings.menuId,enabled:true,tooltip:Spotfire.Localization.resources.ToolBar_Menu,img:-312,margins:0},true);
menu.addClass("floatRight");createDivider($toolbar,true,true,true);var $parent=$toolbar;var buttons=[];
var moreButtons=[];var buttonGroups=[];if(Spotfire.Licenses.licensedFeatures.SaveToLibrary){buttons.push(createButton($parent,id,"SaveClick",{id:"SaveDropDown",enabled:true,text:Spotfire.Localization.resources.ToolBar_Save,tooltip:Spotfire.Localization.resources.ToolBar_Save,dropDown:true,items:[{text:Spotfire.Localization.resources.ToolBar_Save,enabled:true,tag:"SaveClick"},{text:Spotfire.Localization.resources.ToolBar_SaveAs,enabled:true,tag:"SaveAsClick"},{separator:true},{text:Spotfire.Localization.resources.ToolBar_RevertState,tag:"RevertToLastSaved",enabled:settings.isRevertToSavedEnabled}]}));
buttons.push(createDivider($parent).attr("id","AddDataMenuAnchor"));buttonGroups.push(buttons);buttons=[];
}if(Spotfire.Licenses.licensedFeatures.UndoRedo){buttons.push(createButton($parent,id,"Undo",{id:"UndoButton",enabled:settings.canUndo,tooltip:Spotfire.Localization.resources.ToolBar_Undo,img:-144,margins:-3}));
buttons.push(createButton($parent,id,"Redo",{id:"RedoButton",enabled:settings.canRedo,tooltip:Spotfire.Localization.resources.ToolBar_Redo,img:-168,margins:-3}));
buttons.push(createDivider($parent));buttonGroups.push(buttons);buttons=[];}if(settings.showManageData){buttons.push(createButton($parent,id,null,{id:"AddDataButton",enabled:settings.hasDocument,tooltip:Spotfire.Localization.resources.ToolBar_ShowAddDataMenu,img:-600,onClick:function(){Spotfire.Data.Access.AddData.toggle();
}}));}if(settings.showDataOverview){buttons.push(createButton($parent,id,"ShowDataOverview",{id:"ShowDataOverview",enabled:settings.hasDocument,tooltip:Spotfire.Localization.resources.ToolBar_MenuItemViewAndModify,img:-624}));
}if(buttons.length>0){buttonGroups.push(buttons);buttons=[];buttons.push(createDivider($parent));}if(settings.visualizationItems.length>0){if(Spotfire.Licenses.licensedFeatures.Recommendations){settings.visualizationItems.push({separator:true});
settings.visualizationItems.push({checked:false,enabled:settings.recommendationsEnabled,tag:"ShowRecommendations",text:Spotfire.Localization.resources.ToolBar_Suggestions,imageUrl:"Images/Visualizations/Recommendations.png"});
}buttons.push(createButton($parent,id,"NewVisualization",{id:"NewVisualization",enabled:true,tooltip:Spotfire.Localization.resources.ToolBar_NewVisualization,dropDown:true,img:-505,items:settings.visualizationItems,margins:-3,dropDownXAdjust:-14}));
if(Spotfire.Licenses.licensedFeatures.Recommendations){buttons.push(createButton($parent,id,"ShowRecommendations",{id:"ShowRecommendations",enabled:true,tooltip:Spotfire.Localization.resources.ToolBar_Suggestions,img:-528}));
}if(!Spotfire.Licenses.licensedFeatures.AdvancedVisualizationProperties){buttons.push(createDivider($parent));
}buttonGroups.push(buttons);buttons=[];}if(Spotfire.Licenses.licensedFeatures.CreateAnnotations){buttons.push(createButton($parent,id,null,{id:"annotationsButton",tooltip:Spotfire.Localization.resources.AnnotationsAddAnnotation,enabled:settings.canAddAnnotations,img:-552,margins:-4,onClick:function(){Spotfire.Annotations.add();
}}));buttonGroups.push(buttons);buttons=[];}if(Spotfire.Licenses.licensedFeatures.AdvancedVisualizationProperties){buttons.push(createButton($parent,id,"ShowProperties",{id:"PropertiesLauncher",enabled:settings.propertiesButtonEnabled,tooltip:Spotfire.Localization.resources.PropertiesPopoutTitle,img:-288,margins:-5}));
buttons.push(createDivider($parent));buttonGroups.push(buttons);buttons=[];}buttons.push(createButton($parent,id,"FilterPanelClick",{id:"filterPanelButton",tooltip:Spotfire.Localization.resources.ToolBar_Filter,enabled:settings.hasPage,img:-120,margins:-3,onClick:function(){Spotfire.PopoverPanel.toggle("filterPanelButton","Spotfire.FilterPanel");
}}));var bookmarkLast=!Spotfire.Licenses.licensedFeatures.CollaborationPanel;var dodLast=bookmarkLast&&!Spotfire.Licenses.licensedFeatures.BookmarkPanel;
var dataLast=dodLast&&!Spotfire.Licenses.licensedFeatures.ShowDOD;var filterLast=dataLast&&!Spotfire.Licenses.licensedFeatures.DataPanel;
if(filterLast){buttons.push(createDivider($parent));}buttonGroups.push(buttons);buttons=[];if(Spotfire.Licenses.licensedFeatures.DataPanel){buttons.push(createButton($parent,id,"DataPanelClick",{id:"dataPanelButton",tooltip:Spotfire.Localization.resources.ToolBar_DataPanel,enabled:settings.hasPage,img:-456,margins:-3,onClick:function(){Spotfire.PopoverPanel.toggle("dataPanelButton","Spotfire.DataPanel");
}}));if(dataLast){buttons.push(createDivider($parent));}buttonGroups.push(buttons);buttons=[];}if(Spotfire.Licenses.licensedFeatures.ShowDOD){buttons.push(createButton($parent,id,"DODPanelClick",{id:"detailsOndemandPanelButton",tooltip:Spotfire.Localization.resources.ToolBar_DetailsOnDemand,enabled:settings.hasPage,img:-96,margins:-2}));
if(dodLast){buttons.push(createDivider($parent));}buttonGroups.push(buttons);buttons=[];}if(Spotfire.Licenses.licensedFeatures.BookmarkPanel){buttons.push(createButton($parent,id,"BookmarkPanelClick",{id:"bookmarkPanelButton",tooltip:Spotfire.Localization.resources.BookmarksHeader,enabled:settings.hasPage,img:-72,margins:-5,onClick:function(){Spotfire.PopoverPanel.toggle("bookmarkPanelButton","Spotfire.BookmarkPanel2");
}}));}if(settings.isCommentsAvailableForCurrentUserAndAnalysis){buttons.push(createDivider($parent).attr("id","commentsButtonDivider"));
buttons.push(createButton($parent,id,"CommentsPanelClick",{id:"commentsButton",tooltip:Spotfire.Localization.resources.Comments_FeatureName,enabled:settings.hasPage,img:-576,margins:-1}));
}if(Spotfire.Licenses.licensedFeatures.CollaborationPanel&&settings.hasConfiguredCollaborationPanel){buttons.push(createDivider($parent));
buttons.push(createButton($parent,id,"CollabPanelClick",{id:"collaborationPanelButton",tooltip:Spotfire.Localization.resources.ToolBar_Collaboration,enabled:settings.activeCollaborationPanelButton,img:-48,margins:-1,onClick:function(){Spotfire.PopoverPanel.toggle("collaborationPanelButton","Spotfire.CollaborationPanel");
}}));}buttons.push(createDivider($parent));buttonGroups.push(buttons);buttons=[];var switchThemeEnabled=true;
if(switchThemeEnabled){buttons.push(createButton($parent,id,"SwitchTheme",{id:"Themes",enabled:true,tooltip:Spotfire.Localization.resources.ToolBar_Theme,img:-480,margins:-3,dropDown:true,items:settings.themeItems,dropDownXAdjust:-14}));
buttons.push(createDivider($parent));}buttons.push(createButton($parent,id,"ArrangeVisualizations",{id:"ArrangeVisualization",enabled:settings.hasPage,tooltip:Spotfire.Localization.resources.ToolBar_ArrangeVisualizations,img:-264,margins:-3,dropDown:true,items:settings.arrangeItems,dropDownXAdjust:-14}));
buttons.push(createDivider($parent));buttonGroups.push(buttons);buttons=[];var moreOptionsButton;var onClick=function(){var offset=moreOptionsButton.offset();
offset.top+=moreOptionsButton.outerHeight()+7;offset.left+=20;var appendMoreButtons=function($container){$.each(moreButtons,function(index,$button){$container.append($button);
});};Spotfire.ToolBar.ToolsMenu.showPopout(offset,appendMoreButtons,"moreOptionsDiv");};moreOptionsButton=createButton($toolbar,null,null,{id:"MoreOptionsButton",enabled:true,tooltip:Spotfire.Localization.resources.ToolBar_MoreOptionsToolTip,img:-384,margins:-5,onClick:onClick});
moreOptionsButton.addClass("moreOptionsButton");$toolbar.append($toolbarDimmer);this.layoutToolbar=function(){if(!hasDocument){return;
}moreButtons=[];var overflow=false;moreOptionsButton.hide();$.each(buttonGroups,function(){$.each(this,function(){this.insertBefore(moreOptionsButton);
});});for(i=buttonGroups.length-1;i>=0;i--){buttons=buttonGroups[i];if(buttons.length<1){continue;}if((!overflow&&buttons[buttons.length-1].position().top===0)||(overflow&&moreOptionsButton.position().top===0)){break;
}for(j=buttons.length-1;j>=0;j--){buttons[j].detach();moreButtons.push(buttons[j]);}if(!overflow){overflow=true;
moreOptionsButton.show();}}Spotfire.ToolBar.ToolsMenu.hidePopout();};this.layoutToolbar();};Spotfire.ToolBar.update=function(id,enabledChange){var $toolbar=$("#"+id);
isDirty=enabledChange.isDirty;hasDocument=enabledChange.hasDocument;this.settings.canUndo=enabledChange.canUndo;
this.settings.canRedo=enabledChange.canRedo;this.settings.hasPage=enabledChange.hasPage;this.settings.hasTable=enabledChange.hasTable;
this.settings.isDirty=enabledChange.isDirty;this.settings.activeCollaborationPanelButton=enabledChange.activeCollaborationPanelButton;
this.settings.canAddAnnotations=enabledChange.canAddAnnotations;if(this.settings.visualizationItems){var recommendationsItem=this.settings.visualizationItems.filter(function(value){return value.tag==="ShowRecommendations";
});if(recommendationsItem&&recommendationsItem.length===1){recommendationsItem[0].enabled=enabledChange.recommendationsEnabled;
}}$toolbar.toggleClass("sf-no-document",!enabledChange.hasDocument);$("#"+this.settings.menuId).toggle(enabledChange.showMenu);
$("#commentsButton, #commentsButtonDivider").toggleClass("sf-hidden",!enabledChange.isCommentsAvailableForCurrentUserAndAnalysis);
setEnabledButton($("#commentsButton"),enabledChange.isCommentsAvailableForCurrentUserAndAnalysis);setEnabledButton($("#collaborationPanelButton"),enabledChange.activeCollaborationPanelButton);
setEnabledButton($("#UndoButton"),enabledChange.canUndo);setEnabledButton($("#RedoButton"),enabledChange.canRedo);
setEnabledButton($("#RenamePage, #ArrangeVisualization"+(this.settings.dodId!==""?", #"+this.settings.dodId:"")),enabledChange.hasPage);
setEnabledButton($("#AddDataButton"),enabledChange.hasDocument);setEnabledButton($("#ShowDataOverview"),enabledChange.hasDocument);
setEnabledButton($("#ShowRecommendations"),enabledChange.recommendationsEnabled);setEnabledButton($("#PropertiesLauncher"),enabledChange.propertiesButtonEnabled);
setEnabledButton($("#annotationsButton"),enabledChange.canAddAnnotations);setActiveButton($("#commentsButton"),enabledChange.isInCommentsMode);
setEnabledButton($("#filterPanelButton"),enabledChange.hasPage);setEnabledButton($("#dataPanelButton"),enabledChange.hasPage);
setEnabledButton($("#detailsOndemandPanelButton"),enabledChange.hasPage);setEnabledButton($("#bookmarkPanelButton"),enabledChange.hasPage);
setEnabledButton($("#NewVisualization"),enabledChange.hasDocument);setEnabledButton($("#Themes"),enabledChange.hasDocument);
setEnabledButton($("#SaveDropDown"),enabledChange.hasDocument);this.layoutToolbar();};Spotfire.ToolBar.onMenuClose=function(){var $toolbar=$(".sf-element-toolbar");
if(!$toolbar.data("over")){$toolbar.data("onHoverOut")();}};Spotfire.ToolBar.onResize=function(){this.layoutToolbar();
};Spotfire.ToolBar.confirmCloseAnalysis=function(id,siblings){var clientSiblings=Spotfire.MultipleViews.GetSiblings();
var hasSibling=false;$.each(siblings,function(index,sibling){if($.inArray(sibling,clientSiblings)>=0){hasSibling=true;
}});if(hasSibling){Ajax.close();return;}var closeCallback=function(){Ajax.close();};var cancelCallback=function(){Spotfire.LightBox.hide();
};if(Spotfire.Licenses.licensedFeatures.SaveToLibrary){var saveCallback=function(){Ajax.enqueueRequest(id,"SaveAndClose","");
};Spotfire.ConfirmDialog.showYesNoCancelDialog(Spotfire.Localization.resources.CloseConfirmationDialogTitle,Spotfire.Localization.resources.AskWhetherToSaveMessage,saveCallback,closeCallback,cancelCallback);
}else{Spotfire.ConfirmDialog.showOkCancelDialog(Spotfire.Localization.resources.CloseConfirmationDialogTitle,Spotfire.Localization.resources.ProceedWithoutSaveMessage,closeCallback,cancelCallback);
}};Spotfire.ToolBar.confirmLogout=function(id,settings){var logoutCallback=function(){Ajax.logoutByUser();
};var cancelCallback=function(){Spotfire.LightBox.hide();};if(isDirty){if(Spotfire.Licenses.licensedFeatures.SaveToLibrary){var saveCallback=function(){Ajax.enqueueRequest(id,"SaveAndLogout","");
};Spotfire.ConfirmDialog.showYesNoCancelDialog(Spotfire.Localization.resources.LogoutConfirmationDialogTitle,Spotfire.Localization.resources.AskWhetherToSaveMessage,saveCallback,logoutCallback,cancelCallback);
}else{Spotfire.ConfirmDialog.showOkCancelDialog(Spotfire.Localization.resources.LogoutConfirmationDialogTitle,Spotfire.Localization.resources.ProceedWithoutSaveMessage,logoutCallback,cancelCallback);
}}else{Spotfire.ConfirmDialog.showOkCancelDialog(Spotfire.Localization.resources.LogoutConfirmationDialogTitle,Spotfire.Localization.resources.LogoutConfirmationText,logoutCallback,cancelCallback);
}};Spotfire.ToolBar.confirmRevert=function(id){var revertCallback=function(){Spotfire.LightBox.show();
Ajax.enqueueRequest(id,"RevertToLastSavedConfirmed",null);};Spotfire.ConfirmDialog.showYesNoDialog(Spotfire.Localization.resources.RevertConfirmationTitle,Spotfire.Localization.resources.RevertConfirmationMessage,revertCallback);
};});$(function(){Spotfire.registerNameSpace("ToolBar.ToolsMenu");Spotfire.ToolBar.ToolsMenu.isPopoutOpen=function(){var $menu=$(document.body).children(".toolBarToolsMenu");
return $menu.length>0;};Spotfire.ToolBar.ToolsMenu.hidePopout=function(){$(document.body).children(".toolBarToolsMenu").remove();
};Spotfire.ToolBar.ToolsMenu.showPopout=function(offset,appendButtonsCallback,cssClass){var $moreButtonsDiv=$("<div />").addClass("toolBarToolsMenu "+cssClass).css("position","absolute");
var $buttonContainer=$("<div />").appendTo($moreButtonsDiv);var onmouseup=function(e){if($(e.target).is($moreButtonsDiv)){return;
}var $node=$(e.target);while($node.length>0){if($node.hasClass("DisabledButton")){return;}if($node.hasClass("ToolBarDropDown")){return;
}if($node.is($moreButtonsDiv)){break;}$node=$node.parent();}setTimeout(function(){$moreButtonsDiv.detach();
},0);$(document.body).off("mouseup",onmouseup);};appendButtonsCallback($buttonContainer);$(document.body).on("mouseup",onmouseup);
$moreButtonsDiv.css({top:offset.top+"px",left:offset.left+"px"}).appendTo($(document.body)).show();return $moreButtonsDiv;
};});var Touch={};Touch.addTouchTarget=function(button,left,top,right,bottom){if(button instanceof jQuery){button=button.get(0);
}$(".touchtarget",$(button)).remove();button.style.overflow="visible";var div=document.createElement("div");
div.className="touchtarget";div.style.width=(left+right)+"px";div.style.height=(top+bottom)+"px";div.style.zIndex="10";
div.style.position="absolute";var leftOffset=-(left-button.clientWidth/2);var topOffset=-(top-button.clientHeight/2);
div.style.left=leftOffset+"px";div.style.top=topOffset+"px";button.appendChild(div);return div;};Touch.getBrowserZoom=function(){return document.body.scrollWidth/window.innerWidth;
};Touch.clickBlocker=function(){var $div=$("#clickBlocker");if($div.length!==0){return $div;}$div=$("<div/>").prop("id","clickBlocker").css({backgroundColor:"blue",width:$(window).innerWidth()+"px",height:$(window).innerHeight()+"px",position:"absolute",left:0,top:0,opacity:0});
$("body").append($div);document.addEventListener("touchend",Touch.removeClickBlocker,true);};Touch.removeClickBlocker=function(){var $clickBlocker=$("#clickBlocker");
window.setTimeout(function(){$clickBlocker.remove();document.removeEventListener("touchend",Touch.removeClickBlocker,true);
},0);};Touch.showTouchHoldImage=function(x,y){var img=document.getElementById("touchholdimage");if(!img){img=document.createElement("img");
img.alt="touchhold";img.src="./Images/touchAndHold.png";img.id="touchholdimage";img.style.position="absolute";
img.style.top="0px";img.style.left="0px";img.style.WebkitUserSelect="none";img.style.visibility="hidden";
document.body.appendChild(img);}Touch.moveTouchHoldImage(x,y);img.style.visibility="visible";};Touch.moveTouchHoldImage=function(x,y){var img=document.getElementById("touchholdimage");
if(img){var zoom=Touch.getBrowserZoom();var offset=59;var scale=1/zoom;var xt=x-offset;var yt=y-offset;
img.style.webkitTransform="translate3d("+xt+"px, "+yt+"px, 0px) scale("+scale+")";}};Touch.removeTouchHoldImage=function(){var img=document.getElementById("touchholdimage");
if(img){img.style.visibility="hidden";}};Touch.allowZoom=function(){var intervalId;var setViewPort=function(){if(document.querySelector){var viewport=document.querySelector("meta[name=viewport]");
if(viewport){viewport.setAttribute("content","width=device-width, initial-scale = 1.0, maximum-scale = 2.0, user-scalable = yes");
}}};var onTimeout=function(){if(!Spotfire.WebAnalysis.isReady()){return;}window.clearInterval(intervalId);
setViewPort();};var isAndroid=navigator.appVersion.match(/android/gi)?true:false;if(isAndroid){intervalId=window.setInterval(onTimeout,0);
var initialScreenHeight=window.innerHeight;var initialScreenWidth=window.innerWidth;var enablezoomOnHideKeyboard=function(){if(window.innerHeight<initialScreenHeight){window.removeEventListener("resize",enablezoomOnHideKeyboard);
document.querySelector('meta[name="viewport"]').content="width=device-width, minimum-scale = 1.0, maximum-scale = 2.0, user-scalable = yes";
}return true;};$(document.body).on("blur","input",function(){window.addEventListener("resize",enablezoomOnHideKeyboard);
document.querySelector('meta[name="viewport"]').content="width=device-width, minimum-scale = 1.0, maximum-scale = 2.0, user-scalable = yes";
return true;});$(document.body).on("click","input",function(){var ratio=initialScreenWidth/window.innerWidth;
document.querySelector('meta[name="viewport"]').content="width=device-width, initial-scale = "+ratio+", minimum-scale = "+ratio+",maximum-scale = "+ratio+", user-scalable = no";
window.addEventListener("resize",enablezoomOnHideKeyboard);});}else{setViewPort();}};$(function(){var isMobileTouch=function(){return Spotfire.capabilities.supportsTouch();
};function isLeftMouse(event){if(event.which===1){return true;}return false;}var getScrollbarWidth=function(){return isMobileTouch()?0:18;
};var touchTargetAppendTo=function($elem){$elem.addClass("TouchTarget");if(!isMobileTouch()){return $elem;
}var $touchTarget=$("<div></div>").css({position:"absolute",top:"-8px",right:"-8px",bottom:"-8px",left:"-8px"});
$elem.append($touchTarget);return $touchTarget;};var registerTouchEvents=function($elem,onMouseDown,onMouseMove,onMouseUp){var onTouchDown=function(e){onMouseDown(e);
e.preventDefault();Spotfire.Visuals.CanvasVisualization.Dragging.begin({preventContextMenuOnRelease:true,mouseMove:onMouseMove,mouseUp:onMouseUp},$elem);
};var $target=touchTargetAppendTo($elem);$target.bind("sf-touchmousedown",onTouchDown);};var draggable=function($elem,options){var defaultOptions={start:$.noop,drag:$.noop,stop:$.noop,click:$.noop,containment:null,handle:null,parent:$elem.parent(),dragThreshold:0};
var mouseDownX;var mouseDownY;var positionX;var positionY;var dx;var dy;var pos={};var movements;var validClick;
var startFlag=false;$.extend(defaultOptions,options);function onMouseDown(e){validClick=true;if($(e.target).hasClass("sf-resize-handle")){validClick=false;
return;}startFlag=true;mouseDownX=e.clientX;mouseDownY=e.clientY;positionY=parseInt($elem.css("top"),10);
positionX=parseInt($elem.css("left"),10);movements=Spotfire.Utilities.availableMovementWithinContainer($elem,Spotfire.Utilities.containerDimensions(defaultOptions.containment),true);
$elem.on("scroll",function(){validClick=false;});}function dragPredicate(e){return Math.abs(e.clientX-mouseDownX)>defaultOptions.dragThreshold||Math.abs(e.clientY-mouseDownY)>defaultOptions.dragThreshold;
}function onMouseMove(e){if(!validClick){return;}e.preventDefault();if(startFlag&&dragPredicate(e)){startFlag=false;
defaultOptions.start(e);}dx=e.clientX-mouseDownX;dy=e.clientY-mouseDownY;if(startFlag){return;}if(dx<0){pos.left=movements.left>Math.abs(dx)?dx:-movements.left;
}else{pos.left=movements.right>Math.abs(dx)?dx:movements.right;}if(dy<0){pos.top=movements.up>Math.abs(dy)?dy:-movements.up;
}else{pos.top=movements.down>Math.abs(dy)?dy:movements.down;}var translate="translate("+pos.left+"px, "+pos.top+"px)";
$elem[0].style.webkitTransform=translate;$elem[0].style.transform=translate;defaultOptions.drag(pos);
}function onMouseUp(e){$elem.off("scroll");if(!validClick){return;}pos.transform="none";pos["-webkit-transform"]="none";
pos.left=positionX+pos.left;pos.top=positionY+pos.top;$elem.css(pos);defaultOptions.stop(e);}var $dragHandle=defaultOptions.handle||$elem;
$dragHandle.on("sf-touchmousedown",function(downEvent){if(!isLeftMouse(downEvent)){return;}Spotfire.Visuals.CanvasVisualization.Dragging.begin({mouseMove:onMouseMove,mouseUp:onMouseUp,click:defaultOptions.click,dragPredicate:dragPredicate,cursor:"move"},$elem);
onMouseDown(downEvent);});};var resizable=function($elem,options){var defaultOptions={start:$.noop,drag:$.noop,stop:$.noop,minWidth:null,maxWidth:null,minHeight:null,maxHeight:null,containment:null,handles:"e",parent:$elem.parent(),resize:$.noop};
var mouseDownX;var mouseDownY;var startWidth;var startHeight;var startPos;var previousWidth=null;var previousHeight=null;
var movements;var validClick;var startFlag=false;$.extend(defaultOptions,options);var availableMovements=function($element,$container,handle){var result={up:0,down:0,left:0,right:0,allowedRight:0,allowedDown:0};
var isW=/sw|w|nw/.test(handle);var isE=/se|e|ne/.test(handle);var isN=/nw|n|ne/.test(handle);var isS=/sw|s|se/.test(handle);
if(!$container){if(isN||isS){result.up=2147483647;result.down=2147483647;}if(isE||isW){result.left=2147483647;
result.right=2147483647;}result.allowedRight=2147483647;result.allowedDown=2147483647;}else{var containerOffset=$container.offset()||{left:0,top:0};
var elementOffset=$element.offset();result.allowedRight=$container.outerWidth()-((elementOffset.left-containerOffset.left)+$element.outerWidth());
result.allowedDown=$container.outerHeight()-((elementOffset.top-containerOffset.top)+$element.outerHeight());
if(isN){result.up=elementOffset.top-containerOffset.top;result.down=$element.outerHeight();}else{if(isS){result.down=$container.outerHeight()-((elementOffset.top-containerOffset.top)+$element.outerHeight());
result.up=$element.outerHeight();}}if(isW){result.left=elementOffset.left-containerOffset.left;result.right=$element.outerWidth();
}else{if(isE){result.right=$container.outerWidth()-((elementOffset.left-containerOffset.left)+$element.outerWidth());
result.left=$element.outerWidth();}}}if(isN){if(defaultOptions.maxHeight){result.up=Math.min(result.up,defaultOptions.maxHeight-$element.outerHeight());
}if(defaultOptions.minHeight){result.down=Math.min(result.down,$element.outerHeight()-defaultOptions.minHeight);
}}else{if(isS){if(defaultOptions.maxHeight){result.down=Math.min(result.down,defaultOptions.maxHeight-$element.outerHeight());
}if(defaultOptions.minHeight){result.up=Math.min(result.up,$element.outerHeight()-defaultOptions.minHeight);
}}}if(isW){if(defaultOptions.maxWidth){result.left=Math.min(result.left,defaultOptions.maxWidth-$element.outerWidth());
}if(defaultOptions.minWidth){result.right=Math.min(result.right,$element.outerWidth()-defaultOptions.minWidth);
}}else{if(isE){if(defaultOptions.maxWidth){result.right=Math.min(result.right,defaultOptions.maxWidth-$element.outerWidth());
}if(defaultOptions.minWidth){result.left=Math.min(result.left,$element.outerWidth()-defaultOptions.minWidth);
}}}if(defaultOptions.maxWidth){result.allowedRight=Math.min(result.allowedRight,defaultOptions.maxWidth-$element.outerWidth());
}if(defaultOptions.maxHeight){result.allowedDown=Math.min(result.allowedDown,defaultOptions.maxHeight-$element.outerHeight());
}return result;};function onMouseDown(handle,e){validClick=true;if(!isLeftMouse(e)){validClick=false;
return;}startFlag=true;mouseDownX=e.clientX;mouseDownY=e.clientY;startWidth=parseInt($elem.css("width"),10);
startHeight=parseInt($elem.css("height"),10);startPos=$elem.position();movements=availableMovements($elem,defaultOptions.containment,handle);
}function onMouseMove(handle,e){if(!validClick){return;}e.preventDefault();if(startFlag){defaultOptions.start(e);
startFlag=false;}var dx=e.clientX-mouseDownX;var isW=/sw|w|nw/.test(handle);var isHoriz=isW||/se|e|ne/.test(handle);
if(dx>0){dx=Math.min(dx,movements.right);}else{dx=Math.max(dx,-movements.left);}if(isW){dx=-dx;}var dy=e.clientY-mouseDownY;
var isN=/nw|n|ne/.test(handle);var isVert=isN||/sw|s|se/.test(handle);var retval=true;if(dy>0){dy=Math.min(dy,movements.down);
}else{dy=Math.max(dy,-movements.up);}if(isN){dy=-dy;}if(/w|e/.test(handle)&&dx<0){var proposedWidth=startWidth+dx;
previousWidth=previousWidth||proposedWidth;$elem.css("width",proposedWidth);if($elem.outerHeight()>startHeight+movements.allowedDown){$elem.css("width",previousWidth);
}else{previousWidth=proposedWidth;if(isW){$elem.css("left",startPos.left-dx);}}defaultOptions.drag(e);
retval=false;}if(/n|s/.test(handle)&&dy<0){var proposedHeight=startHeight+dy;previousHeight=previousHeight||proposedHeight;
$elem.css("height",proposedHeight);if($elem.outerWidth()>startWidth+movements.allowedRight){$elem.css("height",previousHeight);
}else{previousHeight=proposedHeight;if(isN){$elem.css("top",startPos.top-dy);}}defaultOptions.drag(e);
retval=false;}if(isHoriz&&dx!==0){$elem.css("width",startWidth+dx);if(isW){$elem.css("left",startPos.left-dx);
}}if(isVert&&dy!==0){$elem.css("height",startHeight+dy);if(isN){$elem.css("top",startPos.top-dy);}}defaultOptions.drag(e);
defaultOptions.resize({width:$elem.outerWidth(),height:$elem.outerHeight()});return retval;}function onMouseUp(e){if(!validClick){return;
}defaultOptions.stop(e);}var validHandles=["e","w","n","s","ne","se","sw","nw"];var isMobile=isMobileTouch();
defaultOptions.handles.split(",").forEach(function(el){var h=el.trim();if(validHandles.indexOf(h)<0){return;
}var $handle=$("<div>").addClass("sf-resize-handle"+(isMobile?" sf-resize-handle-mobile":"")+" sf-resize-handle-"+h).appendTo($elem);
$handle.on("sf-touchmousedown",function(downEvent){Spotfire.Visuals.CanvasVisualization.Dragging.begin({preventContextMenuOnRelease:true,mouseMove:_.partial(onMouseMove,h),mouseUp:_.partial(onMouseUp,h),cursor:h+"-resize"},$handle);
onMouseDown(h,downEvent);});});};Spotfire.registerNameSpace("Touch",{getScrollbarWidth:getScrollbarWidth,registerTouchEvents:registerTouchEvents,draggable:draggable,resizable:resizable,leftMouseButtonDown:function(e){if(Spotfire.capabilities.supportsTouch()){return true;
}return(e.which||e.button)===1;},rightMouseButtonDown:function(e){if(Spotfire.capabilities.supportsTouch()){return false;
}return(e.which||e.button)===3;},legacyTouchMouseCapture:function(element,handleMouseMove,handleMouseUp,attachOnWindow){if(Spotfire.capabilities.supportsTouch()){var touchMoveCallback=function(event){event.preventDefault();
handleMouseMove(event.touches[0]);};var touchEndCallback=function(e){$(window).off("sf-touchmouseup",touchEndCallback);
$(window).off("sf-touchmousemove",touchMoveCallback);handleMouseUp(e.changedTouches[0]);};$(window).on("sf-touchmouseup",touchEndCallback);
$(window).on("sf-touchmousemove",touchMoveCallback);}else{var $target=$(document.body);if(attachOnWindow){$target=$(window);
}var mouseUp=function(e){$target.off("mousemove",handleMouseMove);$target.off("mouseup",mouseUp);handleMouseUp(e);
};$target.on("mousemove",handleMouseMove);$target.on("mouseup",mouseUp);}}});});$(function(){var setupCustomEvents=function(supportsTouch){var touchMouseEventName={DOWN:"sf-touchmousedown",UP:"sf-touchmouseup",MOVE:"sf-touchmousemove",HOLD:"sf-touchhold"};
var modifyTouchEvent=function(e){var touch=e.touches[0]||e.changedTouches[0];e.clientX=touch.pageX;e.clientY=touch.pageY;
e.pageX=touch.pageX;e.pageY=touch.pageY;e.which=1;};var isSingleTouch=function(e){return e.touches!==undefined&&(e.touches.length<2&&e.changedTouches.length<2);
};var copyEvent=function(event){return{changedTouches:event.changedTouches,touches:event.touches,which:event.which,pageX:event.pageX,pageY:event.pageY,clientX:event.clientX,clientY:event.clientY,altKey:event.altKey,ctrlKey:event.ctrlKey,shiftKey:event.shiftKey};
};var trigger=function(elem,type,artificialEvent,originalEvent){var e=jQuery.Event(type,artificialEvent);
$(elem).trigger(e);if(e.isPropagationStopped()){originalEvent.stopPropagation();}if(e.isDefaultPrevented()){originalEvent.preventDefault();
}};var onMouseEvent=function(event){var type;switch(event.type){case"mousedown":type=touchMouseEventName.DOWN;
break;case"mouseup":type=touchMouseEventName.UP;break;case"mousemove":type=touchMouseEventName.MOVE;break;
default:return;}trigger(event.target,type,copyEvent(event),event);};var createDelayedTouchStart=function(event,artificialEvent){var timer=null;
var dispatch=function(type){type=type||touchMouseEventName.HOLD;trigger(event.target,type,artificialEvent,event);
timer=null;};timer=window.setTimeout(dispatch,300);var forget=function(){window.clearTimeout(timer);timer=null;
};var executeIfNotExecuted=function(){if(timer){forget();dispatch(touchMouseEventName.DOWN);}};return{executeIfNotExecuted:executeIfNotExecuted,forget:forget};
};var delayedTouchStart={executeIfNotExecuted:$.noop,forget:$.noop};var onTouchEvent=function(event){if(!isSingleTouch(event)){delayedTouchStart.forget();
return;}var artificialEvent=copyEvent(event);modifyTouchEvent(artificialEvent);switch(event.type){case"touchstart":delayedTouchStart=createDelayedTouchStart(event,artificialEvent);
break;case"touchend":delayedTouchStart.executeIfNotExecuted();trigger(event.target,touchMouseEventName.UP,artificialEvent,event);
break;case"touchmove":delayedTouchStart.executeIfNotExecuted();trigger(event.target,touchMouseEventName.MOVE,artificialEvent,event);
break;default:return;}};if(supportsTouch){window.addEventListener("touchstart",onTouchEvent,true);window.addEventListener("touchmove",onTouchEvent,true);
window.addEventListener("touchend",onTouchEvent,true);}else{window.addEventListener("mousedown",onMouseEvent,true);
window.addEventListener("mouseup",onMouseEvent,true);window.addEventListener("mousemove",onMouseEvent,true);
}};Spotfire.registerNameSpace("Touch",{setupCustomEvents:setupCustomEvents});});function TouchPageSelector(ownerId,buttonUpId,buttonDownId,centerAreaId,scrollbarThumbId,scrollbarThumbSize,numberOfPages){this.ownerId=ownerId;
this.buttonUpId=buttonUpId;this.buttonDownId=buttonDownId;this.centerAreaId=centerAreaId;this.scrollbarThumbId=scrollbarThumbId;
this.scrollbarThumbSize=scrollbarThumbSize;this.numberOfPages=numberOfPages;var buttonUp=document.getElementById(this.buttonUpId);
var buttonDown=document.getElementById(this.buttonDownId);var centerArea=document.getElementById(this.centerAreaId);
var scrollThumb=document.getElementById(scrollbarThumbId);this.maxScroll=centerArea.clientHeight-this.scrollbarThumbSize;
scrollThumb.style.height=this.scrollbarThumbSize+"px";scrollThumb.addEventListener("touchstart",this,false);
buttonUp.addEventListener("click",this,false);buttonDown.addEventListener("click",this,false);centerArea.addEventListener("click",this,false);
$("#"+ownerId).data("pageSelector",this);}TouchPageSelector.prototype={y:0,setCurrentPage:function(pageNo){this.currentPage=pageNo;
var position=this.currentPage*this.maxScroll/(this.numberOfPages-1);this.setPosition(position);},serverScrollRequest:function(pageNo){if(pageNo>=0&&pageNo<this.numberOfPages){Ajax.enqueueRequest(this.ownerId,"PageChange",pageNo);
}},handleEvent:function(e){switch(e.type){case"touchstart":this.onTouchStart(e);break;case"touchmove":this.onTouchMove(e);
break;case"touchend":this.onTouchEnd(e);break;case"click":this.onClick(e);break;}},onTouchStart:function(e){if(e.touches.length!=1){return false;
}this.distanceMoved=0;this.touchStartY=e.touches[0].pageY;this.scrollStartY=this.y;var scrollThumb=document.getElementById(this.scrollbarThumbId);
scrollThumb.addEventListener("touchmove",this,false);scrollThumb.addEventListener("touchend",this,false);
this.showTooltip();e.stopPropagation();},onTouchMove:function(e){if(e.touches.length!=1){return false;
}Touch.clickBlocker();e.preventDefault();var pageY=e.touches[0].pageY;var topDelta=pageY-this.touchStartY;
var newY=this.scrollStartY+topDelta;this.distanceMoved+=Math.abs(this.touchStartY-pageY);if(this.distanceMoved>5){this.setPosition(newY);
}this.showTooltip();},onTouchEnd:function(e){var scrollThumb=document.getElementById(this.scrollbarThumbId);
scrollThumb.removeEventListener("touchmove",this,false);scrollThumb.removeEventListener("touchend",this,false);
this.serverScrollRequest(this.calculatePageNo());Spotfire.Visuals.Tooltip.hide();},onClick:function(e){var targetId=e.target.id?e.target.id:e.target.parentNode.id;
switch(targetId){case this.buttonUpId:this.serverScrollRequest(this.currentPage-1);break;case this.buttonDownId:this.serverScrollRequest(this.currentPage+1);
break;case this.centerAreaId:var centerArea=document.getElementById(this.centerAreaId);var baseY=$(centerArea).offset();
this.setPosition(e.clientY-baseY-this.scrollbarThumbSize/2);this.serverScrollRequest(this.calculatePageNo());
break;}},calculatePageNo:function(){return Math.round((this.numberOfPages-1)*(this.y/this.maxScroll));
},showTooltip:function(){var scrollThumb=document.getElementById(this.scrollbarThumbId);var offset=$(scrollThumb).offset();
var yPos=offset.top-50;var xPos=offset.left-20;Spotfire.Visuals.Tooltip.showAt((this.calculatePageNo()+1)+"&nbsp;("+this.numberOfPages+")",xPos,yPos);
},setPosition:function(yPos){yPos=Math.round(yPos);if(yPos<0){yPos=0;}else{if(yPos>this.maxScroll){yPos=this.maxScroll;
}}this.y=yPos;var scrollThumb=document.getElementById(this.scrollbarThumbId);scrollThumb.style.top=this.y+"px";
}};$(function(){Spotfire.registerNameSpace("TreeView");Spotfire.TreeView.create=function($element,settings){var TreeView=function(options){options.container=$(options.container);
this.options=options;this.renderWithStrategy();};TreeView.goThroughAllItems=function(data,callback){var i;
for(i=0;i<data.length;i+=1){callback(data[i]);if(data[i].children&&data[i].children.length>0){TreeView.goThroughAllItems(data[i].children,callback);
}}};TreeView.Strategies={RadioSelectionStrategy:{shouldReRender:false,parse:function(data,selectedValue){TreeView.goThroughAllItems(data,function(item){if(!selectedValue){item.isChecked=String(item.isChecked)==="true";
return;}item.isChecked="false";item.selected=false;if(item.value===selectedValue){item.isChecked="true";
item.selected=true;}});}},CheckboxSelectionStrategy:{shouldReRender:true,checkAllItems:function(items,check){if(!items||items.length===0){return;
}TreeView.goThroughAllItems(items,function(item){item.isChecked=check;item.selected=false;});},parse:function(data,selectedValue){var checkCount=0,atLeastOneUndetermined=false,i,isChecked;
for(i=0;i<data.length;i+=1){data[i].selected=false;if(data[i].value===selectedValue){isChecked=String(data[i].isChecked)==="undefined"||String(data[i].isChecked)==="false"||String(data[i].isChecked)==="undetermined";
data[i].isChecked=isChecked;data[i].selected=true;this.checkAllItems(data[i].children,isChecked);}else{if(data[i].children&&data[i].children.length>0){data[i].isChecked=this.parse(data[i].children,selectedValue);
}}if(String(data[i].isChecked)==="true"){checkCount+=1;}else{if(String(data[i].isChecked)==="undetermined"){atLeastOneUndetermined=true;
}else{if(String(data[i].isChecked)==="undefined"){data[i].isChecked=false;}}}}if(checkCount===data.length){return true;
}if(checkCount===0&&!atLeastOneUndetermined){return false;}return"undetermined";}}};TreeView.prototype={renderWithStrategy:function(){var strategy=this.getStrategy();
strategy.parse(this.options.data,this.oldSelectedValue);this.oldSelectedValue=null;if(this.filterText||this.filterText===""){this.filter(this.filterText);
}else{this.render();}},render:function(){var data=this.filteredData!==null&&this.filteredData!==undefined?this.filteredData:this.options.data;
this.options.container.empty();this.options.container.html(this.createTreeNode(data,true,true));$($(".treeview-root")[0]).parent().addClass("treeview-container");
if(this.options.onSelect){this.options.onSelect();}$(".treeview-content",this.options.container).click(function(evt){var target=$(evt.currentTarget),selectedItem=this.findItemByValue(this.options.data,target.parent().data("value")),strategy=this.getStrategy();
$(".treeview-content",this.options.container).removeClass("treeview-selected");target.addClass("treeview-selected");
strategy.parse(this.options.data,selectedItem.value);if(strategy.shouldReRender){this.render();}if(this.options.onSelect){this.options.onSelect(selectedItem);
}}.bind(this));if(this.options.onDoubleClick){$(".treeview-content",this.options.container).dblclick(function(evt){var target=$(evt.currentTarget),selectedItem=this.findItemByValue(this.options.data,target.parent().data("value"));
this.options.onDoubleClick(selectedItem);}.bind(this));}$(".treeview-arrow",this.options.container).click(function(evt){var arrow=$(evt.currentTarget),selectedItem=this.findItemByValue(this.options.data,arrow.parent().data("value"));
if(arrow.hasClass("treeview-arrow-collapsed")){selectedItem.expanded=true;arrow.removeClass("treeview-arrow-collapsed");
arrow.addClass("treeview-arrow-expanded");}else{selectedItem.expanded=false;arrow.removeClass("treeview-arrow-expanded");
arrow.addClass("treeview-arrow-collapsed");}$(".treeview-root",arrow.parent()).first().toggle(100,function(){if(this.options.onNodeToggle){this.options.onNodeToggle();
}}.bind(this));}.bind(this));},update:function(options){if(options.keepOldState){this.mergeOldState(options.data,this.options.data);
}$.extend(this.options,options);this.renderWithStrategy();},filter:function(text){this.filterText=text.toLowerCase();
this.filteredData=$.extend(true,[],this.options.data);this.filterData(this.filterText,this.filteredData);
this.render();},filterData:function(text,nodes){var i;var toRemove=[];for(i=0;i<nodes.length;i++){if(nodes[i].label.toLowerCase().indexOf(text)===-1){if(nodes[i].children&&nodes[i].children.length>0){this.filterData(text,nodes[i].children);
if(nodes[i].children.length===0){toRemove.push(i);}}else{toRemove.push(i);}}}for(i=toRemove.length-1;
i>=0;i--){nodes.splice(toRemove[i],1);}},mergeOldState:function(data,oldData){if(!data||!this.options.data||data.length!==oldData.length){return;
}var i;for(i=0;i<data.length;i++){if(oldData[i]&&oldData[i].value===data[i].value){data[i].selected=oldData[i].selected;
data[i].expanded=oldData[i].expanded;if(oldData[i].selected){this.oldSelectedValue=oldData[i].value;}}if(data[i].children&&oldData[i].children){this.mergeOldState(data[i].children,oldData[i].children);
}}},getStrategy:function(){if(this.options.selectionHandlingStrategy==="checkbox"){return TreeView.Strategies.CheckboxSelectionStrategy;
}return TreeView.Strategies.RadioSelectionStrategy;},findItemByValue:function(node,value){var i,item;
for(i=0;i<node.length;i+=1){if(node[i].value===value){return node[i];}if(node[i].children&&node[i].children.length>0){item=this.findItemByValue(node[i].children,value);
if(item){return item;}}}return null;},createTreeNode:function(dataNode,isRoot,isFirstRoot){var parent=$("<ul />"),i,child,dotsContainer,vDots,hDots,content,arrowIcon,isLastNode;
parent.addClass("treeview-root");if(!isRoot&&!this.options.hideDots){parent.addClass("treeview-dots-line");
}for(i=0;i<dataNode.length;i+=1){child=$("<li />");dotsContainer=$("<div />");vDots=$("<div />");hDots=$("<div />");
content=$("<div />");arrowIcon=$("<div />");isLastNode=i===dataNode.length-1;child.addClass("treeview-child");
dotsContainer.addClass("treeview-dots");vDots.addClass("treeview-v-dots");hDots.addClass("treeview-h-dots");
content.addClass("treeview-content");arrowIcon.addClass("treeview-arrow");if(isFirstRoot){child.css("margin-left",0);
if(i===0){if(!isLastNode){vDots.addClass("treeview-half-dots");vDots.css("position","absolute");vDots.css("top","12px");
}else{vDots.hide();}}}child.data("value",dataNode[i].value);if(this.options.itemRenderer){content.html(this.options.itemRenderer(dataNode[i]));
}else{content.text(dataNode[i].label);}if(isLastNode){vDots.addClass("treeview-half-dots");}if(dataNode[i].selected){content.addClass("treeview-selected");
}if(!this.options.hideDots){dotsContainer.append(vDots);dotsContainer.append(hDots);}child.append(dotsContainer);
child.append(content);if(dataNode[i].children&&dataNode[i].children.length>0){child.addClass("treeview-has-children");
child.append(this.createTreeNode(dataNode[i].children,isLastNode));child.append(arrowIcon);if(dataNode[i].expanded){arrowIcon.addClass("treeview-arrow-expanded");
$($(".treeview-root",child)[0]).show();}else{arrowIcon.addClass("treeview-arrow-collapsed");$($(".treeview-root",child)[0]).hide();
}}parent.append(child);}return parent;},expandAll:function(animation){var expandables=$(".treeview-has-children",this.options.container);
$(".treeview-arrow",expandables).removeClass("treeview-arrow-collapsed");$(".treeview-arrow",expandables).addClass("treeview-arrow-expanded");
$(".treeview-root",expandables.parent()).show(animation);TreeView.goThroughAllItems(this.options.data,function(item){if(item.children){item.expanded=true;
}});},collapseAll:function(animation){var expandables=$(".treeview-has-children",this.options.container);
$(".treeview-arrow",expandables).removeClass("treeview-arrow-expanded");$(".treeview-arrow",expandables).addClass("treeview-arrow-collapsed");
$(".treeview-root",expandables.parent()).hide(animation);TreeView.goThroughAllItems(this.options.data,function(item){if(item.children){item.expanded=false;
}});}};settings.container=$element;var treeView=new TreeView(settings);$element.data("treeView",treeView);
};Spotfire.TreeView.update=function($element,settings){var treeView=$element.data("treeView");if(treeView){treeView.update(settings);
}};Spotfire.TreeView.getSettings=function($element){var treeView=$element.data("treeView");if(treeView){return treeView.options;
}return{};};});$(function(){Spotfire.registerNameSpace("Visuals.Trellis.PageSelector",{initialize:function(id,scrollBarDivId,numberOfPages){var scrollBarDiv=document.getElementById(scrollBarDivId);
var $scrollBarDiv=$(scrollBarDiv);var scrollTimer=null;var currentPageNumber=function(){return Math.round(numberOfPages*(scrollBarDiv.scrollTop/scrollBarDiv.scrollHeight));
};var serverScrollRequest=function(){Spotfire.Visuals.Tooltip.hide();var pageNo=currentPageNumber();Ajax.enqueueRequest(id,"PageChange",pageNo);
};$scrollBarDiv.on("scroll",function(){var pageNo=currentPageNumber()+1;var offset=$scrollBarDiv.offset();
var x=offset.left+scrollBarDiv.offsetWidth;var y=Math.round(offset.top+(scrollBarDiv.offsetHeight/2));
Spotfire.Visuals.Tooltip.showAtFixed(pageNo+" ("+numberOfPages+")",x,y);window.clearTimeout(scrollTimer);
scrollTimer=setTimeout(serverScrollRequest,500);});$scrollBarDiv.StyledScrollbar({cssClass:"TrellisPageSelector",lineSize:function(){return scrollBarDiv.scrollHeight/numberOfPages;
},pageSize:new Size(0,scrollBarDiv.scrollHeight/numberOfPages),mouseWheelLines:1});$("#"+id).data("pageSelector",{setCurrentPage:function(pageNo){var position=pageNo*scrollBarDiv.scrollHeight/numberOfPages;
scrollBarDiv.scrollTop=position;}});}});});$(function(){Spotfire.registerNameSpace("Twitter");Spotfire.Twitter.share=function(url){var width=575,height=450,left=($(window).width()-width)/2,top=($(window).height()-height)/2,opts="status=1,width="+width+",height="+height+",top="+top+",left="+left;
window.open(url,"twitter",opts);};});$(function(){var usejQueryUI=true;Spotfire.registerNameSpace("UI",{resizable:function($element,settings){if(usejQueryUI){$element.resizable(settings);
return;}$element.addClass("sf-element-ui-resizable");var minWidth=typeof settings.minWidth==="number"?settings.minWidth:0;
var minHeight=typeof settings.minHeight==="number"?settings.minWidth:0;$("<div/>").addClass("sf-element-ui-resize-handle").appendTo($element).on("mousedown",function(downEvent){var $indicator=$("<div/>").addClass("sf-element-ui-resize-indicator").appendTo(document.body).hide();
var elementOffset=$element.offset();var elementWidth=$element.width();var elementHeight=$element.height();
var resultWidth;var resultHeight;$(window).on("mousemove.sf-element-ui-resize",function(moveEvent){var dx=downEvent.pageX-moveEvent.pageX;
var dy=downEvent.pageY-moveEvent.pageY;resultWidth=Math.max(minWidth,elementWidth-dx);resultHeight=Math.max(minHeight,elementHeight-dy);
if(typeof settings.resize==="function"){$element.width(resultWidth);$element.height(resultHeight);settings.resize();
}else{$indicator.css("left",elementOffset.left+"px").css("top",elementOffset.top+"px").width(resultWidth).height(resultHeight).show();
}});$(window).on("mouseup.sf-element-ui-resize",function(){$element.width(resultWidth);$element.height(resultHeight);
$indicator.remove();$(window).off("mousemove.sf-element-ui-resize");$(window).off("mouseup.sf-element-ui-resize");
if(typeof settings.stop==="function"){settings.stop();}});});}});});$(function(){Spotfire.registerNameSpace("Data.Upload");
Spotfire.Data.Upload.uploadProgress=false;var removeUploadProgressCancelCallback=function(){var $popup=$(".progressDialog");
var $cancelLink=$(".progressCancel",$popup);var onCancelClick=function(){Ajax.cancelOperation();if($popup.length>0){Spotfire.MultipleViews.UnlockSiblingViews();
}$popup.trigger("sf-progress-dialog-close");$popup.remove();};$cancelLink.unbind("click");$cancelLink.click(onCancelClick);
};var upload=function($form,uploadId,$contentPanel,onUploadOk,onUploadError,onProgressCancel,progress,elm){var disposed=false;
var formData=new FormData(),xhr=new XMLHttpRequest();if((document.getElementById(elm)===null)||(document.getElementById(elm)===undefined)){return;
}this.dispose=function(){if(!disposed){disposed=true;}};xhr.onreadystatechange=function(){if((xhr.readyState==4)&&!disposed){var ct=xhr.getResponseHeader("content-type")||"";
var uploadSucceded=false;if(ct.indexOf("html")>-1){var status=xhr.responseText.replace(/(\r|\n|\r\n)/mg,"");
uploadSucceded=(status.indexOf("UPLOAD OK")>-1);}else{if(ct.indexOf("json")>-1){var status=JSON.parse(xhr.responseText);
uploadSucceded=(status.result===0);}}if(!uploadSucceded){Spotfire.LightBox.hide();Spotfire.Data.Upload.uploadProgress=false;
Spotfire.Progress.closePopupProgress();onUploadError();}else{removeUploadProgressCancelCallback();Spotfire.Data.Upload.uploadProgress=false;
onUploadOk();}}};var onCancel=function(){if(!disposed){Spotfire.LightBox.hide();removeUploadProgressCancelCallback();
Spotfire.Data.Upload.uploadProgress=false;if(xhr){xhr.abort();}onProgressCancel();}};Spotfire.LightBox.show();
Spotfire.Data.Upload.uploadProgress=true;Progress.setPopupUploadProgressText(progress,onCancel);formData.append("uploadFile",document.getElementById(elm).files[0]);
xhr.open("POST","Upload.aspx?waid="+Ajax.DocumentId+"&uploadId="+uploadId,true);if(document.cookie&&document.cookie.match(/XSRF-TOKEN=([^\;]+).*/)){xhr.setRequestHeader("X-XSRF-TOKEN",document.cookie.match(/XSRF-TOKEN=([^\;]+).*/)[1]);
}xhr.send(formData);};Spotfire.Data.Upload.createUploadForm=function(){var $form=$("<form></form>");$form.attr("method","POST");
$form.attr("enctype","multipart/form-data");return $form;};Spotfire.Data.Upload.submitUpload=function($form,uploadId,$contentPanel,onUploadOk,onUploadError,onProgressCancel,progress,elm){return new upload($form,uploadId,$contentPanel,onUploadOk,onUploadError,onProgressCancel,progress,elm);
};});$(function(){Spotfire.registerNameSpace("Utilities");Spotfire.Utilities.formatString=function(str){var i,reg;
for(i=0;i<arguments.length-1;i++){reg=new RegExp("\\{"+i+"\\}","gm");str=str.replace(reg,arguments[i+1]);
}return str;};Spotfire.Utilities.containerDimensions=function($container){if(!$container){return{offset:{top:0,left:0},position:{top:0,left:0},scrollWidth:Infinity,scrollHeight:Infinity,scrollTop:0,scrollLeft:0,width:Infinity,outerWidth:Infinity,height:Infinity,outerHeight:Infinity};
}return{offset:$container.offset(),position:$container.position(),scrollWidth:$container.prop("scrollWidth"),scrollHeight:$container.prop("scrollHeight"),scrollTop:$container.prop("scrollTop"),scrollLeft:$container.prop("scrollLeft"),width:$container.width(),outerWidth:$container.outerWidth(),height:$container.height(),outerHeight:$container.outerHeight()};
};Spotfire.Utilities.escapeIdForCss=function(id){return $.isNumeric(id[0])?("#\\3"+id[0]+" "+id.substring(1)):("#"+id);
};Spotfire.Utilities.moveIntoViewport=function($el,resize,vmargin,hmargin){if(vmargin===undefined){vmargin=10;
}if(hmargin===undefined){hmargin=10;}var winWidth=$(window).width();var winHeight=$(window).height();
var toWide=$el.width()>=winWidth,toHigh=$el.height()>=winHeight;if($el.offset().left+$el.width()>=winWidth){$el.css("left",winWidth-$el.width()-hmargin);
}if($el.offset().left<0){$el.css("left",hmargin);}if($el.offset().top+$el.height()>=winHeight){$el.css("top",winHeight-$el.height()-vmargin);
}if($el.offset().top<0){$el.css("top",vmargin);}if(resize){if(toWide){$el.width(winWidth-hmargin*2);}if(toHigh){$el.height(winHeight-vmargin*2);
}}return toWide||toHigh;};Spotfire.Utilities.elementFitsInsideContainer=function($element,$container){var containerOffset=$container.offset(),elementOffset=$element.offset();
if(elementOffset.left<containerOffset.left){return false;}if(elementOffset.top<containerOffset.top){return false;
}if(elementOffset.left+$element.outerWidth()>containerOffset.left+$container.outerWidth()){return false;
}if(elementOffset.top+$element.outerHeight()>containerOffset.top+$container.outerHeight()){return false;
}return true;};Spotfire.Utilities.elementFitsInsideMeasurement=function($element,containerMeasurements,overflowAllowed){var elementOffset=$element.offset();
var measuredOffset=$.extend({},containerMeasurements.offset);var measuredWidth=containerMeasurements.outerWidth;
var measuredHeight=containerMeasurements.outerHeight;if(overflowAllowed){measuredOffset.left=containerMeasurements.offset.left-containerMeasurements.scrollLeft;
measuredOffset.top=containerMeasurements.offset.top-containerMeasurements.scrollTop;measuredWidth=containerMeasurements.scrollWidth;
measuredHeight=containerMeasurements.scrollHeight;}if(elementOffset.left<measuredOffset.left){return false;
}if(elementOffset.top<measuredOffset.top){return false;}if(elementOffset.left+$element.outerWidth()>measuredOffset.left+measuredWidth){return false;
}if(elementOffset.top+$element.outerHeight()>measuredOffset.top+measuredHeight){return false;}return true;
};Spotfire.Utilities.elementFitsInsideParent=function($element){var $parent=$element.parent();return Spotfire.Utilities.elementFitsInsideContainer($element,$parent);
};Spotfire.Utilities.availableMovementWithinContainer=function($element,containerMeasurements,overflowAllowed){var result={up:0,down:0,left:0,right:0};
var elementOffset=$element.offset();var measuredOffset=$.extend({},containerMeasurements.offset);var measuredWidth=containerMeasurements.outerWidth;
var measuredHeight=containerMeasurements.outerHeight;if(overflowAllowed){measuredOffset.left=containerMeasurements.offset.left-containerMeasurements.scrollLeft;
measuredOffset.top=containerMeasurements.offset.top-containerMeasurements.scrollTop;measuredWidth=containerMeasurements.scrollWidth;
measuredHeight=containerMeasurements.scrollHeight;}result.left=elementOffset.left-measuredOffset.left;
result.up=elementOffset.top-measuredOffset.top;result.right=(measuredOffset.left+measuredWidth)-(elementOffset.left+$element.outerWidth());
result.down=(measuredOffset.top+measuredHeight)-(elementOffset.top+$element.outerHeight());return result;
};Spotfire.Utilities.placeWithinContainer=function($element,containerMeasurements,allowOverflow,deform){$element.css("height","");
$element.css("bottom","");var counter=0;var movements=Spotfire.Utilities.availableMovementWithinContainer($element,containerMeasurements,allowOverflow);
if(movements.left<0||movements.right<0||movements.up<0||movements.down<0){do{if(movements.up<0||(movements.up===0&&movements.down<0)){$element.css("top",Math.max(parseInt($element.css("top"),10)+Math.abs(movements.up),0));
}else{if(movements.down<0){$element.css("top",Math.max(parseInt($element.css("top"),10)-Math.abs(movements.down),0));
}}if(movements.left<0||(movements.left===0&&movements.right<0)){$element.css("left",parseInt($element.css("left"),10)+Math.abs(movements.left));
}else{if(movements.right<0){$element.css("left",parseInt($element.css("left"),10)-Math.abs(movements.right));
}}counter++;movements=Spotfire.Utilities.availableMovementWithinContainer($element,containerMeasurements,allowOverflow);
}while((movements.left<0||movements.right<0||movements.up<0||movements.down<0)&&counter<8);if(deform){if(movements.right<0){$element.css({width:containerMeasurements.width});
}movements=Spotfire.Utilities.availableMovementWithinContainer($element,containerMeasurements,allowOverflow);
if(movements.down<0){$element.css({top:"0",bottom:"","max-height":containerMeasurements.scrollHeight,"overflow-y":"auto"});
}}}return(movements.left>=0&&movements.right>=0&&movements.up>=0&&movements.down>=0);};Spotfire.Utilities.tryScrollElementToCenter=function($pageElement,$scrollToCenterElement){var viewPortWidth=$pageElement.innerWidth();
var viewPortHeight=$pageElement.innerHeight();var pageWidth=$pageElement.prop("scrollWidth");var pageHeight=$pageElement.prop("scrollHeight");
if(viewPortHeight===pageHeight&&viewPortWidth===pageWidth){return;}var scrollToCenterElementPosition={top:parseInt($scrollToCenterElement.css("top"),10),left:parseInt($scrollToCenterElement.css("left"),10)};
var scrollTop=scrollToCenterElementPosition.top-viewPortHeight/2;var scrollLeft=scrollToCenterElementPosition.left-viewPortWidth/2;
$pageElement.scrollTop(scrollTop);$pageElement.scrollLeft(scrollLeft);};});$(function(){Spotfire.registerNameSpace("Visuals.ValuePicker",{initialize:function($div,setOkEnabledCallback){var lastSettings;
var setOkEnabled=setOkEnabledCallback;$div.sfFlex({grow:true,"auto-basis":false});var dropdown=Spotfire.Controls.DropDown.initialize($div,{values:[],onSelected:function(item,index){Ajax.enqueueRequest(lastSettings.controlId,"selectQuickItem",item);
},onDetachedComboboxBlur:function(){Ajax.enqueueRequest(lastSettings.controlId,"setValue",dropdown.val());
},onCharAdd:function(val){setOkEnabled(val);dropdown.setError($div,false);}});var modalDialog;var intelisenseCallback;
var editor;var showExpressionDialog=function(){var dropDownList=$(".DropdownListContainer");if(dropDownList.length>0){dropDownList.remove();
}var $dialog=$("<div/>").addClass("CustomExpressionDialog");var ok=function(){editor.Error.empty();var expr=editor.GetExpression();
var args={expression:expr};Ajax.enqueueRequest(lastSettings.controlId,"ValidateAndSetExpression",args);
return true;};editor=Spotfire.Controls.CustomExpressionEditor.create({ApplyAndClose:function(){ok();},InitialExpression:lastSettings.expression,ProvideIntellisense:function(args,callback){intelisenseCallback=callback;
Ajax.enqueueRequest(lastSettings.controlId,"provideIntellisense",args);}});var $dialogContainer=Spotfire.Flex.item({container:"vertical",fill:true}).appendTo($dialog);
Spotfire.Flex.item({}).text(Spotfire.Localization.resources.RuleBuilder_Expression).appendTo($dialogContainer);
var $expressionContainer=Spotfire.Flex.item({grow:true}).addClass("sf-dataoverview-expressioncontainer sf-element-input").appendTo($dialogContainer);
$expressionContainer.click(function(){editor.Focus();});$expressionContainer.append(editor.TextBox);$expressionContainer.append(editor.Error);
var showHelp=function(){Spotfire.Web.showHelp("5001037");};var onOpen=function(){editor.OnOpen();};var onClosed=function(){editor.OnClose();
setOkEnabled();};var buttons=[{text:Spotfire.Localization.resources.Ok,click:ok,isDefault:true},{text:Spotfire.Localization.resources.Cancel,isCancel:true}];
var title=Spotfire.Localization.resources.RuleBuilder_EditExpression;modalDialog=Spotfire.Controls.ModalDialog.initialize($dialog,{title:title,minWidth:593,minHeight:384,height:384,modal:true,resizable:true,buttons:buttons,open:onOpen,close:onClosed,help:showHelp,preventAutoClose:function(){return editor.HasFocus();
}});editor.Focus();};var control={update:function(newSettings){if(newSettings&&!lastSettings){$div.attr("id",newSettings.controlId);
}lastSettings=newSettings;if(!newSettings){$div.hide();return;}$div.show();var detachedComboboxSvg=null,detachedErrorSvg=null;
if(newSettings.isExpression===false){if(newSettings.showPercentButton){detachedComboboxSvg="Images/RuleBuilderDialog/Percentage_15x10.svg";
}if(newSettings.showPercentileButton){detachedComboboxSvg="Images/RuleBuilderDialog/Pn_15x10.svg";}if(!newSettings.validValue){detachedErrorSvg="Images/RuleBuilderDialog/!14x14.svg";
}dropdown.update({useCombobox:newSettings.editable,detachedDropdownButton:false,detachedDropdownButtonClick:$.noop,detachedDropdownButtonSvg:undefined,detachedDropdownButtonText:undefined,detachedCombobox:newSettings.editable,detachedComboboxValue:newSettings.value,detachedComboboxDisabled:false,detachedComboboxClick:$.noop,detachedComboboxSvg:detachedComboboxSvg,detachedErrorSvg:detachedErrorSvg,detachedComboboxPlaceholder:Spotfire.Localization.resources.RuleBuilder_EnterValue,values:newSettings.quickList,selectedValue:newSettings.quickListSelected,showDropdownArrow:newSettings.quickList!==undefined&&newSettings.quickList.length!==undefined});
setOkEnabled();}else{if(newSettings.isExpression===true){dropdown.update({useCombobox:false,detachedDropdownButton:true,detachedDropdownButtonClick:showExpressionDialog,detachedDropdownButtonSvg:"Images/RuleBuilderDialog/Edit_15x10.svg",detachedDropdownButtonText:newSettings.expressionDisplayName,detachedCombobox:false,detachedComboboxValue:false,detachedComboboxDisabled:false,detachedComboboxClick:$.noop,detachedComboboxSvg:undefined,detachedComboboxPlaceholder:undefined,values:newSettings.quickList,selectedValue:newSettings.quickListSelected,showDropdownArrow:newSettings.quickList!==undefined&&newSettings.quickList.length!==undefined});
if(newSettings.popExpressionsDialog){showExpressionDialog();}else{setOkEnabled();}}}},provideIntellisense:function(settings){if(intelisenseCallback){intelisenseCallback(settings);
}},handleExpressionResult:function(result){if(editor){if(result.valid){modalDialog.close();modalDialog=null;
editor=null;}else{editor.Error.text(result.message);}}},setOkEnabledAndError:function($picker,settings){lastSettings=settings;
var detachedErrorSvg=null;if(!settings.validValue){detachedErrorSvg="Images/RuleBuilderDialog/!14x14.svg";
}dropdown.setError($picker,detachedErrorSvg);setOkEnabled();},isValid:function(val){if(val!==null&&val!==undefined){return val.length>0;
}if(!lastSettings.isExpression){return lastSettings.value.length>0&&lastSettings.validValue;}return lastSettings.expression.length>0;
},isVisible:function(){if(lastSettings){return true;}return false;}};$div.data("value-picker-control",control);
return control;},update:function(settings){var $picker=$("#"+settings.controlId);var picker=$picker.data("value-picker-control");
if(picker){picker.update(settings);}},provideIntellisense:function(settings){var $picker=$("#"+settings.controlId);
var picker=$picker.data("value-picker-control");if(picker){picker.provideIntellisense(settings);}},handleExpressionResult:function(settings){var $picker=$("#"+settings.controlId);
var picker=$picker.data("value-picker-control");if(picker){picker.handleExpressionResult(settings);}},setOkEnabledAndError:function(settings){var $picker=$("#"+settings.controlId);
var picker=$picker.data("value-picker-control");if(picker){picker.setOkEnabledAndError($picker,settings);
}}});});$(function(){var editText=function(id,callback,expression){var container=$("#"+id);if(container.data("edit")===true){return;
}container.data("edit",true);var oldText=container.text();var textToEdit=expression||oldText;var $inputField=$("<input type='text'/>").addClass("titleOrDescriptionInputField").val(textToEdit);
container.text("");Spotfire.Controls.InputField.handleDraggable($inputField);container.append($inputField);
$inputField.focus();$inputField.select();var handleUpdate=function(){var currentText=$.trim($inputField.val());
if(currentText===textToEdit||currentText===""){$inputField.remove();container.text(oldText);}else{callback(id,$inputField.val());
}container.removeData("edit");};$inputField.blur(function(){handleUpdate();});$inputField.keydown(function(e){if(e.which===$.ui.keyCode.ENTER){handleUpdate();
}if(e.which===$.ui.keyCode.ESCAPE){container.text(oldText);$inputField.remove();container.removeData("edit");
}});};var buildButtons=function($buttonGroup,callbackId,buttons){var buttonCount=buttons.length;$.each(buttons,function(index,button){var $button=$("<div/>").addClass("sf-element sf-element-button").addClass(button.classes).css({display:"inline-block","float":"left",cursor:"pointer"}).appendTo($buttonGroup);
Spotfire.StyleManager.setSequencePseudoClasses($button,index,buttonCount);$button.height($button.css("font-size"));
$button.width($button.height());var defaultOnClick=function(){var offset=$button.offset();var absoluteBounds={x:offset.left,y:offset.top,width:$button.sfBoxWidth(),height:$button.sfBoxHeight()};
var args={buttonId:button.id,absoluteBounds:absoluteBounds};Ajax.enqueueRequest(callbackId,"ButtonClick",JSON.stringify(args));
};var onClick=defaultOnClick;if(typeof button.onClickScript==="function"){onClick=button.onClickScript;
}else{if(typeof button.onClickScript==="string"){onClick=function(){Spotfire.evaluate(button.onClickScript);
};}}Spotfire.Controls.PanelButton.initialize($button,button.tooltip,button.svgUrl,onClick,false,button.text);
});};var onUpdateLegend=function($plotChild){var $visual=$plotChild.closest(".sf-element-visual");$visual.trigger("sf-update-legend",{});
};var onPlotIssues=function($plotChild,data){var $visual=$plotChild.closest(".sf-element-visual");if(data!==undefined){$visual.data("sf-plot-issues",data);
}else{data=$visual.data("sf-plot-issues");}if(data!==undefined){$visual.trigger("sf-plot-issues",data);
}};var initializeTitle=function(id,settings){var title=settings.title;var titleExpression=settings.titleExpression;
var $visualizationTitle=$("#"+id);var justifyContent="start";var textAlign=$visualizationTitle.css("text-align");
if(textAlign==="center"){justifyContent="center";}else{if(textAlign==="right"){justifyContent="end";}}$visualizationTitle.sfFlex({container:"horizontal","align-items":"center","justify-content":justifyContent});
var textBoxId=id+"_tb";var $textBox=Spotfire.Flex.item().addClass("sf-element sf-element-text-box").css({"white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis"}).attr("id",textBoxId).attr("title",title).text(title).append("&nbsp;&nbsp;");
$textBox.appendTo($visualizationTitle);var $buttonGroup=Spotfire.Flex.item({shrink:false}).addClass("sf-element sf-element-button-group sfpc-left").appendTo($visualizationTitle).css({cursor:"pointer"});
buildButtons($buttonGroup,id,settings.buttons);$visualizationTitle.closest(".sf-element-visual").on("sf-plot-issues",function(e,data){$buttonGroup.empty();
var buttons=settings.buttons.slice(0);var getUrl=function(severity){switch(severity){case"Error":return"Images/Buttons/Error.svg";
case"Warning":return"Images/Buttons/Warning.svg";default:return"Images/Buttons/Info.svg";}};var getClasses=function(severity){switch(severity){case"Error":return"sfc-error-button";
case"Warning":return"sfc-warning-button";default:return"sfc-info-button";}};var getHighestSeverityIssue=function(){var getRank=function(severity){switch(severity){case"Error":return 3;
case"Warning":return 2;default:return 1;}};var candidate=null;$.each(data.issues,function(i,issue){if(candidate===null||getRank(candidate.rank)<getRank(issue.rank)){candidate=issue;
}});return candidate;};var firstIssue=getHighestSeverityIssue(data.issues);if(firstIssue!==undefined&&firstIssue!==null){buttons.push({svgUrl:getUrl(firstIssue.rank),classes:getClasses(firstIssue.rank),tooltip:firstIssue.title,onClickScript:function(){var $button=$(this);
var offset=$button.offset();var bounds={x:offset.left,y:offset.top,width:$button.sfBoxWidth(),height:$button.sfBoxHeight()};
var $popup=Spotfire.FloatingWindow.showAt("",bounds.x,bounds.y+bounds.height);$.each(data.issues,function(i,issue){var $icon=$("<div/>").addClass("sf-element-button").addClass(getClasses(issue.rank)).appendTo($popup);
$("<div/>").addClass("sf-element-title").text(issue.title).appendTo($popup);$("<div/>").addClass("sf-element-text-box").text(issue.message).appendTo($popup);
if(i<data.issues.length-1){$("<div/>").addClass("sf-element-separator").appendTo($popup);}var link=issue.link;
if(link!==undefined&&link!==null&&Spotfire.isProfessional()){link.viewId=data.viewId;var $linkContainer=$("<div/>").addClass("sf-element-text-box").appendTo($popup);
$("<a/>").attr("href","#").text(link.text).appendTo($linkContainer).click(function(){Spotfire.PageBus.publish("spotfire.visuals.gotopropertypage",link);
Spotfire.FloatingWindow.hide();});}Spotfire.getSvg(getUrl(issue.rank),function($svg){$svg.appendTo($icon);
});});Spotfire.FloatingWindow.performLayout($popup);}});}buildButtons($buttonGroup,id,buttons);});onPlotIssues($visualizationTitle);
var callback=function(idToChange,str){Ajax.enqueueRequest(id,"TitleExpression",str);};if(Spotfire.isAuthorMode()){$visualizationTitle.on("dblclick",function(){editText(textBoxId,callback,titleExpression,null);
});}};var initializeDescription=function(id){var $visualizationDescription=$("#"+id);var callback=function(idToChange,str){Ajax.enqueueRequest(idToChange,"Description",str);
};if(Spotfire.isAuthorMode()){$visualizationDescription.on("dblclick",function(){editText(id,callback,null,null);
});}};Spotfire.registerNameSpace("Visuals",{initializeTitle:initializeTitle,initializeDescription:initializeDescription,onPlotIssues:onPlotIssues,onUpdateLegend:onUpdateLegend,replaceClasses:function(id,newClasses){$("#"+id).prop("class","").addClass(newClasses);
}});});$(function(){var setButtonStatus=function($button,button){$button.css("visibility",button.visible?"visible":"hidden");
$button.toggleClass("disabled sfpc-disabled",!button.enabled);$button.toggleClass("sfpc-active",button.pressed);
};var appendButton=function(id,button){var onClick=function(){Ajax.enqueueRequest(id,button.id,"click");
};var $button=$("<div/>").attr("id",button.id);setButtonStatus($button,button);if(button.hasOwnProperty("box")){$button.css("width",button.box.width).css("flex-basis",button.box.width).css("height",button.box.height).addClass(button.box.classes);
}if(button.hasOwnProperty("dropDown")){$button.addClass("ToolBarDropDown");}Spotfire.Controls.PanelButton.initialize($button,button.toolTip,button.svgUrl,onClick,button.pressed,button.buttonText);
return $button;};var init=function(settings){this.settings=settings;var $toolbar=$("#"+settings.id);$toolbar.empty();
$toolbar.sfFlex({container:"horizontal","justify-content":"end","align-items":"stretch"});$.each(settings.buttons,function(index,button){var $button=appendButton(settings.id,button);
$toolbar.append($button);});Spotfire.ToolBar.ToolsMenu.hidePopout();};var updateButton=function(button){var $button=$("#"+button.id);
setButtonStatus($button,button);};var showPopout=function(menuSettings){var $toolsMenuButton=$("#"+menuSettings.id);
var ownerId=this.settings.id;var appendMoreButtons=function($container){$.each(menuSettings.buttons,function(index,button){$container.append(appendButton(ownerId,button));
});};var offset=$toolsMenuButton.offset();offset.top+=$toolsMenuButton.outerHeight()+7;var $menu=Spotfire.ToolBar.ToolsMenu.showPopout(offset,appendMoreButtons,"sf-element sf-element-styled-dialog");
$menu.children().addClass("sf-element sf-element-web-player-toolbar");};var analysisContentExpired=function(args){var performRefresh=function(){Spotfire.LightBox.show(0.5);
Ajax.enqueueRequest(args.ownerId,"RefreshWebAnalysis","");};if(args.canHaveDocumentStateForRefresh){performRefresh();
}else{Spotfire.ConfirmDialog.showOkCancelDialog(args.promptOpenUpdatedAnalysisTitle,args.promptOpenUpdatedAnalysis,performRefresh);
}};var scheduledUpdatedRefreshFailed=function(title,error){Spotfire.Framework.ErrorDialog.show(title,error,function(){Spotfire.LightBox.hide();
});};Spotfire.registerNameSpace("WebPlayerToolBar",{init:init,updateButton:updateButton,showPopout:showPopout,analysisContentExpired:analysisContentExpired,scheduledUpdatedRefreshFailed:scheduledUpdatedRefreshFailed});
});$(function(){Spotfire.registerNameSpace("Visuals.ZoomSlider");function ZoomSlider($parent,viewId,settings){var horizontal=settings.horizontal;
var $slider=$("<div/>").addClass("sf-element-zoom-slider");var $range=$("<div/>").addClass("sf-element-range sfc-outer");
var $innerRange=$("<div/>").addClass("sf-element-range sfc-inner");var $leftThumb=$("<div/>").addClass("sf-element-thumb");
var $rightThumb=$("<div/>").addClass("sf-element-thumb");var $rotate=$("<div/>").addClass("rotate");$slider.append($range);
$slider.append($innerRange);$slider.append($leftThumb);$slider.append($rightThumb);$rotate.append($slider);
$parent.append($rotate);var forceUpdate=false;$parent.on("contextmenu",function(e){e.stopPropagation();
e.preventDefault();var onMenuItemClick=function(item){switch(item.tag){case"reset":forceUpdate=true;Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,"ResetZoom","");
break;default:break;}return true;};var items=[{text:Spotfire.Localization.resources.ResetZoom,tag:"reset",enabled:true}];
var menu=Spotfire.Controls.ContextMenu.create(items,onMenuItemClick);menu.show(e.pageX,e.pageY);});var leftThumbWidth;
var rightThumbWidth;var innerRangeMaxWidth;var normalizedRange={low:0,high:1};var normalizedDraggedRange={low:0,high:1};
var normalizedDragStartRange={low:0,high:1};var NO_DRAG=0;var LEFT_THUMB_DRAG=1;var INNER_RANGE_DRAG=2;
var RIGHT_THUMB_DRAG=3;var currentDrag=NO_DRAG;var stickyGuid=null;var isDragging=function(){if(forceUpdate){return false;
}return currentDrag!==NO_DRAG;};var calculateThumbPositions=function(){var totalWidth=$rotate.width();
leftThumbWidth=$leftThumb.outerWidth(true);rightThumbWidth=$leftThumb.outerWidth(true);$range.width(totalWidth-leftThumbWidth/2-rightThumbWidth/2);
$range.css("left",leftThumbWidth/2);innerRangeMaxWidth=totalWidth-leftThumbWidth-rightThumbWidth;var nr=isDragging()?normalizedDraggedRange:normalizedRange;
var low=nr.low*innerRangeMaxWidth;var high=nr.high*innerRangeMaxWidth;var result={};result.leftThumb={left:low,width:leftThumbWidth};
result.rightThumb={left:high+leftThumbWidth,width:rightThumbWidth};result.innerRange={left:leftThumbWidth+low,width:high-low,maxWidth:innerRangeMaxWidth};
return result;};var render=function(){var positions=calculateThumbPositions();$innerRange.css({left:positions.innerRange.left+"px",width:positions.innerRange.width+"px"});
$leftThumb.css("left",positions.leftThumb.left+"px");$rightThumb.css("left",positions.rightThumb.left+"px");
};var onGetSlider=function(sliderArgs){normalizedRange=sliderArgs.normalizedRange;render();forceUpdate=false;
};var update=function(){if(isDragging()){return;}Spotfire.Dxp.Web.Forms.AjaxService.Read(viewId,"GetSlider","",onGetSlider);
};var setRange=_.throttle(function(r){var args={normalizedRange:r};Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,"SetRange",JSON.stringify(args),stickyGuid);
},200,false);var onParentResize=function(){var w=horizontal?$parent.width():$parent.height();var h=horizontal?$parent.height():$parent.width();
$rotate.width(w);$rotate.height(h);if(!horizontal){$rotate.addClass("rotate270deg");var h2=Math.round(h/2);
var w2=Math.round(w/2);$rotate.css("margin-left",(h2-w2)+"px");$rotate.css("margin-top",(w2-h2)+"px");
}$slider.css("height",h+"px");$slider.css("width",w+"px");render();};var dragStartX=0;var dragDeltaMin;
var dragDeltaMax;var onMouseMove=function(e){if(currentDrag===NO_DRAG){return;}var dx=horizontal?e.clientX-dragStartX:dragStartX-e.clientY;
dx=Math.max(dragDeltaMin,Math.min(dx,dragDeltaMax));var dnx=dx/innerRangeMaxWidth;switch(currentDrag){case LEFT_THUMB_DRAG:normalizedDraggedRange.low=normalizedDragStartRange.low+dnx;
break;case RIGHT_THUMB_DRAG:normalizedDraggedRange.high=normalizedDragStartRange.high+dnx;break;case INNER_RANGE_DRAG:normalizedDraggedRange.low=normalizedDragStartRange.low+dnx;
normalizedDraggedRange.high=normalizedDragStartRange.high+dnx;break;default:break;}var minWidth=1/innerRangeMaxWidth;
if(normalizedDraggedRange.high-normalizedDraggedRange.low<minWidth){switch(currentDrag){case LEFT_THUMB_DRAG:normalizedDraggedRange.low=normalizedDraggedRange.high-minWidth;
break;case RIGHT_THUMB_DRAG:normalizedDraggedRange.high=normalizedDraggedRange.low+minWidth;break;}}setRange(normalizedDraggedRange);
render();};var onMouseUp=function(){if(currentDrag===NO_DRAG){return;}Spotfire.Visuals.Tooltip.hide();
normalizedRange.low=normalizedDraggedRange.low;normalizedRange.high=normalizedDraggedRange.high;currentDrag=NO_DRAG;
setRange(normalizedDraggedRange);update();};var onMouseDown=function(e){if(e.which!==1){return;}normalizedDraggedRange.low=normalizedRange.low;
normalizedDraggedRange.high=normalizedRange.high;normalizedDragStartRange.low=normalizedRange.low;normalizedDragStartRange.high=normalizedRange.high;
dragStartX=horizontal?e.clientX:e.clientY;var leftThumbPos=normalizedRange.low*innerRangeMaxWidth;var rightThumbPos=normalizedRange.high*innerRangeMaxWidth;
switch(currentDrag){case LEFT_THUMB_DRAG:dragDeltaMin=-leftThumbPos;dragDeltaMax=rightThumbPos-leftThumbPos;
break;case RIGHT_THUMB_DRAG:dragDeltaMin=leftThumbPos-rightThumbPos;dragDeltaMax=innerRangeMaxWidth-rightThumbPos;
break;case INNER_RANGE_DRAG:dragDeltaMin=-leftThumbPos;dragDeltaMax=innerRangeMaxWidth-rightThumbPos;
break;default:dragDeltaMin=0;dragDeltaMax=0;break;}};var beginDrag=function(e,action){if(e.which!==1){return;
}currentDrag=action;stickyGuid=Spotfire.newFakeGuid();};Spotfire.Touch.registerTouchEvents($innerRange,function(e){beginDrag(e,INNER_RANGE_DRAG);
onMouseDown(e);},onMouseMove,onMouseUp);Spotfire.Touch.registerTouchEvents($rightThumb,function(e){beginDrag(e,RIGHT_THUMB_DRAG);
onMouseDown(e);},onMouseMove,onMouseUp);Spotfire.Touch.registerTouchEvents($leftThumb,function(e){beginDrag(e,LEFT_THUMB_DRAG);
onMouseDown(e);},onMouseMove,onMouseUp);$parent.on("sf-resize",onParentResize);onParentResize();return{update:update};
}Spotfire.Visuals.ZoomSlider.initialize=function(parentSelector,viewId,settings){var $parent=$(parentSelector).attr("viewId",viewId).empty();
var zoomSlider=new ZoomSlider($parent,viewId,settings);$parent.data("zoomSlider",zoomSlider);zoomSlider.update();
};Spotfire.Visuals.ZoomSlider.update=function(viewId){var $parent=$("[viewId="+viewId+"]");var zoomSlider=$parent.data("zoomSlider");
if(zoomSlider){zoomSlider.update();}};});jQuery(function($){Spotfire.registerNameSpace("Comments");var $newOrReplyingAnchor=null;
var newOrReplyingCommentData=null;var replyEnabled=false;var ID_PREFIX="Comments";var comment;var savedScrollTop;
var savedScrollThread=null;var currentId;var repliesToHide=0;var onlyShowAnchor;var DIRECTION={up:0,left:1,right:2,down:3};
function clearComments(removeEditingOrNewComment){if(!removeEditingOrNewComment&&$("#"+Spotfire.Comments.visualPageId).children(".sf-element-visible-comment.editing-comment").length>0){return;
}if(comment&&(!newOrReplyingCommentData||removeEditingOrNewComment)){comment.remove();comment=null;}if(removeEditingOrNewComment){$newOrReplyingAnchor=null;
newOrReplyingCommentData=null;$("#"+Spotfire.Comments.visualPageId).children(".sf-element-visible-comment.new-comment, .sf-element-comment-anchor").remove();
}}function pagePosition($visualPage,x,y){$visualPage=$visualPage||$(window);if(x===undefined){x=$visualPage.outerWidth()/2/$visualPage.prop("scrollWidth");
}if(y===undefined){y=$visualPage.outerHeight()/2/$visualPage.prop("scrollHeight");}var width=$visualPage.prop("scrollWidth"),height=$visualPage.prop("scrollHeight");
return{x:x*width,y:y*height};}function relativePosition($visualPage,windowPosition,pointInViewPortCoordinates){$visualPage=$visualPage||$(window);
var x=windowPosition.left||0.5;var y=windowPosition.top||0.5;if(pointInViewPortCoordinates){x=x+$visualPage.scrollLeft();
y=y+$visualPage.scrollTop();}var width=$visualPage.prop("scrollWidth");var height=$visualPage.prop("scrollHeight");
return{x:x/width,y:y/height};}function create(commentData,overridePos){var thread=commentData.Thread;
if($(".sf-comments-container").children(".sf-element-visible-comment.editing-comment").length>0&&commentData.Thread){if(newOrReplyingCommentData&&newOrReplyingCommentData.Thread&&newOrReplyingCommentData.Thread.Start.ThreadId===commentData.Thread.Start.ThreadId&&commentData.Replying){comment.updateThread(commentData);
return;}}if(!commentData.Replying&&newOrReplyingCommentData){$newOrReplyingAnchor=null;newOrReplyingCommentData=null;
}clearComments(true);var makeSureCurrentVisible=function(){var i;for(i=0;i<thread.Replies.length;i++){if(i>repliesToHide){break;
}if(thread.Replies[i].Id===commentData.CurrentId){repliesToHide=i;break;}}};if(thread){if(savedScrollThread===null||savedScrollThread!==thread.Start.Id){repliesToHide=Math.max(thread.Replies.length-5,0);
savedScrollThread=null;savedScrollTop=0;}makeSureCurrentVisible();}var $thread;var $replyDiv;var handleScrollOnDelete=function(event,$overlay){var offset=$overlay.position();
var height=$overlay.outerHeight();$thread.scrollTop(offset.top+height/2-$thread.height()/2);};var $commentAnchor=$("<div/>").addClass("sf-element sf-element-comment-anchor");
$commentAnchor.on("contextmenu",function(e){e.preventDefault();});var svgPath="Images/Comments/AnchorBubble.svg";
Spotfire.getSvg(svgPath,function($svg){$commentAnchor.append($svg);});$(".sf-comments-container").append($commentAnchor);
var $commentContainer=$("<div/>").addClass("sf-element sf-element-visible-comment");var $arrow=$("<div>").addClass("sf-element sf-element-visible-comment-arrow");
var $shadow=$("<div>");var anchorCenter;var positionAnchor=function(overridingPos){anchorCenter=pagePosition($("#"+Spotfire.Comments.visualPageId),commentData.x,commentData.y);
if(overridingPos){$commentAnchor.css({left:+overridingPos.left+"px",top:overridingPos.top+"px"});}else{$commentAnchor.css({left:(anchorCenter.x-$commentAnchor.outerWidth()/2)+"px",top:(anchorCenter.y-$commentAnchor.outerHeight()/2)+"px"});
}var isDirty=commentData.anchorClean===false||commentData.Moved===true;$commentAnchor.toggleClass("sfpc-is-dirty",isDirty);
$(".sf-element-comment-item .sf-comment-state").toggleClass("sfpc-is-dirty",isDirty);};positionAnchor(overridePos);
if(commentData.Replying){$commentContainer.addClass("editing-comment");$newOrReplyingAnchor=$commentAnchor;
newOrReplyingCommentData=commentData;}if(Spotfire.capabilities.supportsDropShadow()){$commentContainer.addClass("RoundedDropShadow");
$commentAnchor.addClass("sfc-comment-anchor-shadow");$shadow.addClass("sf-element-comment-shadow");}onlyShowAnchor=commentData.OnlyShowAnchor;
$commentContainer.sfFlex({container:"vertical","align-items":"stretch"});var positionArrow=function(arrowDirection){var containerPosition=$commentContainer.position();
var containerWidth=$commentContainer.innerWidth();var containerHeight=$commentContainer.innerHeight();
var anchorPosition=$commentAnchor.position();var anchorWidth=$commentAnchor.width();var anchorHeight=$commentAnchor.height();
var arrowWidth=arrowDirection===DIRECTION.up||arrowDirection===DIRECTION.down?24:12;var arrowHeight=arrowDirection===DIRECTION.up||arrowDirection===DIRECTION.down?12:24;
var arrowOverlap=2;var shadowDimension=14;var arrowPos={};var shadowPos={};$arrow.toggleClass("sfc-down",false);
if(arrowDirection===DIRECTION.right){arrowPos.left=containerPosition.left+containerWidth-arrowOverlap;
arrowPos.top=Math.min(Math.max(containerPosition.top,anchorPosition.top+(anchorHeight/2)-(arrowHeight/2)),containerPosition.top+containerHeight-arrowHeight/2);
shadowPos.left=containerPosition.left+containerWidth-shadowDimension/2;shadowPos.top=Math.min(Math.max(containerPosition.top,anchorPosition.top+(anchorHeight/2)-(shadowDimension/2)),containerPosition.top+containerHeight-shadowDimension);
}else{if(arrowDirection===DIRECTION.up){arrowPos.left=Math.min(Math.max(containerPosition.left,anchorPosition.left+(anchorWidth/2)-(arrowWidth/2)),containerPosition.left+containerWidth-arrowWidth);
arrowPos.top=containerPosition.top-arrowHeight+arrowOverlap;shadowPos.left=Math.min(Math.max(containerPosition.left,anchorPosition.left+(anchorWidth/2)-(shadowDimension/2)),containerPosition.left+containerWidth-shadowDimension);
shadowPos.top=containerPosition.top-shadowDimension/2;}else{if(arrowDirection===DIRECTION.down){$arrow.toggleClass("sfc-down",true);
arrowPos.left=Math.min(Math.max(containerPosition.left,anchorPosition.left+(anchorWidth/2)-(arrowWidth/2)),containerPosition.left+containerWidth-arrowWidth);
arrowPos.top=containerPosition.top+containerHeight-arrowOverlap;shadowPos.left=Math.min(Math.max(containerPosition.left,anchorPosition.left+(anchorWidth/2)-(shadowDimension/2)),containerPosition.left+containerWidth-shadowDimension);
shadowPos.top=containerPosition.top+containerHeight-shadowDimension/2;}else{arrowPos.left=containerPosition.left-arrowWidth+arrowOverlap;
arrowPos.top=Math.min(Math.max(containerPosition.top,anchorPosition.top+(anchorHeight/2)-(arrowHeight/2)),containerPosition.top+containerHeight-arrowHeight);
shadowPos.left=containerPosition.left-shadowDimension/2;shadowPos.top=Math.min(Math.max(containerPosition.top,anchorPosition.top+(anchorHeight/2)-(shadowDimension/2)),containerPosition.top+containerHeight-shadowDimension);
}}}$arrow.css({left:(arrowPos.left-containerPosition.left)+"px",top:(arrowPos.top-containerPosition.top)+"px"});
$shadow.css({left:(shadowPos.left-containerPosition.left)+"px",top:(shadowPos.top-containerPosition.top)+"px"});
Spotfire.Filters.StyledFilters.createSvgArrow($arrow,arrowDirection,"sf-element sf-element-svg-element sfc-arrow-border");
};var storeScrollPosition=function(){if(thread&&(thread.Start.Id!==savedScrollThread||savedScrollTop!==-1)){savedScrollTop=$thread.scrollTop();
savedScrollThread=thread.Start.Id;}};var updateAnchorIssuesImpl=function(){if(thread){Spotfire.CommentsPanel.updateWithIssues(function(issues){$(".sfc-issues-icon",$commentContainer).attr("title","").removeClass("visible");
$.each(issues,function(i,anchorIssue){var issueText=anchorIssue.Issue==="Missing"?Spotfire.Localization.resources.Comments_MissingVisualizationTooltip:"";
var $item=$(".sf-element-visible-comment #"+ID_PREFIX+anchorIssue.Id);$item.find(".sfc-issues-icon").attr("title",issueText).addClass("visible");
});});}};var performLayout=function(){$thread.StyledScrollbar("close");$commentContainer.css("height","auto");
$thread.css("height","auto");$thread.css("width","auto");$thread.css("overflow","");updateAnchorIssuesImpl();
Spotfire.CommentThreadElement.resize($commentContainer);if($commentContainer.height()>300){$commentContainer.height(300);
$thread.height($thread.height());if(thread){var scrollbar=$thread.StyledScrollbar({allowResize:false,cssClass:"sf-inplace-comment-scrollbar"});
scrollbar.scrollend(storeScrollPosition);$thread.off("scroll.comments mousewheel.comments").on("scroll.comments mousewheel.comments",_.debounce(storeScrollPosition,10));
}}else{$thread.StyledScrollbar("refresh");}Spotfire.CommentThreadElement.resize($commentContainer);};
var restoreScrollPosition=function(){if(savedScrollTop!==0&&thread&&thread.Start.Id===savedScrollThread){if(savedScrollTop===-1){$thread.scrollTop(5000000);
savedScrollTop=$thread.scrollTop();}else{$thread.scrollTop(savedScrollTop);}}};var getCenterPosition=function($element){var position={top:parseInt($element.css("top"),10),left:parseInt($element.css("left"),10)};
return{left:position.left+$element.outerWidth()/2,top:position.top+$element.outerHeight()/2};};var hideBox=function(){$commentContainer.hide();
};var positionAnchorAndContainer=function(){if(!onlyShowAnchor){$commentContainer.show();}var $visualPage=$("#"+Spotfire.Comments.visualPageId);
var measurements=Spotfire.Utilities.containerDimensions($visualPage);Spotfire.Utilities.placeWithinContainer($commentContainer,measurements,true,false);
var distance=11;var anchorPosition={top:parseInt($commentAnchor.css("top"),10),left:parseInt($commentAnchor.css("left"),10)};
var outerHeight=$commentContainer.outerHeight();var outerWidth=$commentContainer.outerWidth();var anchorOuterWidth=$commentAnchor.outerWidth();
var anchorOuterHeight=$commentAnchor.outerHeight();$commentContainer.css({top:anchorPosition.top-outerHeight-distance,left:anchorPosition.left+(anchorOuterWidth-outerWidth)/2});
if(Spotfire.Utilities.elementFitsInsideMeasurement($commentContainer,measurements,true)){return DIRECTION.down;
}$commentContainer.css({top:anchorPosition.top+anchorOuterHeight+distance,left:anchorPosition.left+(anchorOuterWidth-outerWidth)/2});
if(Spotfire.Utilities.elementFitsInsideMeasurement($commentContainer,measurements,true)){return DIRECTION.up;
}$commentContainer.css({top:anchorPosition.top,left:anchorPosition.left+anchorOuterWidth+distance});if(Spotfire.Utilities.elementFitsInsideMeasurement($commentContainer,measurements,true)){return DIRECTION.left;
}$commentContainer.css({top:anchorPosition.top,left:anchorPosition.left-outerWidth-distance});if(Spotfire.Utilities.elementFitsInsideMeasurement($commentContainer,measurements,true)){return DIRECTION.right;
}var isOnLeftHalf=(anchorPosition.left<measurements.scrollWidth/2);if(isOnLeftHalf){$commentContainer.css({top:anchorPosition.top,left:anchorPosition.left+anchorOuterWidth+distance});
}else{$commentContainer.css({top:anchorPosition.top,left:anchorPosition.left-outerWidth-distance});}Spotfire.Utilities.placeWithinContainer($commentContainer,measurements,true,false);
return isOnLeftHalf?DIRECTION.left:DIRECTION.right;};var positionAll=function(){var arrowDirection=positionAnchorAndContainer();
positionArrow(arrowDirection);};var moveBoxAndModifyPosition=function(){positionAll();restoreScrollPosition();
if(thread){$commentAnchor.addClass("sfpc-is-dirty");$(".sf-element-comment-item .sf-comment-state").addClass("sfpc-is-dirty");
commentData.Moved=true;var relative=relativePosition($("#"+Spotfire.Comments.visualPageId),getCenterPosition($commentAnchor));
Spotfire.Dxp.Web.Forms.AjaxService.Modify(Spotfire.CommentsPanel.viewId,"CurrentPositionedManually",JSON.stringify({CommentId:commentData.CurrentId,X:relative.x,Y:relative.y}));
}};var moveAnchor=function(toPosition){$commentAnchor.css({top:toPosition.top+"px",left:toPosition.left+"px"});
};var moveAnchorAndModifyPosition=function(){moveBoxAndModifyPosition();};var onClose=function(){newOrReplyingCommentData=null;
$newOrReplyingAnchor=null;Spotfire.Dxp.Web.Forms.AjaxService.Modify(Spotfire.CommentsPanel.viewId,"CurrentClosed","");
$commentAnchor.remove();$commentContainer.remove();};var threadSettings={idPrefix:ID_PREFIX,onShowMore:function(){storeScrollPosition();
performLayout();positionAll();restoreScrollPosition();},oninput:function($replySection,thread,val){if(newOrReplyingCommentData){newOrReplyingCommentData.ReplyText=val;
}comment.updateEnabled();},onCaptureChecked:function(thread,val){newOrReplyingCommentData.CaptureChecked=val;
comment.updateEnabled();},onfocus:function(){var firstEdit=!$commentContainer.hasClass("editing-comment");
$commentContainer.addClass("editing-comment");$newOrReplyingAnchor=$commentAnchor;newOrReplyingCommentData=commentData;
newOrReplyingCommentData.Replying=true;if(firstEdit){if($commentAnchor.is(".sfpc-is-dirty")){$replyDiv.find("input[type='checkbox']").prop("checked",true).change();
}Spotfire.Dxp.Web.Forms.AjaxService.Modify(Spotfire.CommentsPanel.viewId,"EditingComment",JSON.stringify({isEditing:true}));
}},onReply:function(thread,reply,captureState){var relativePos=relativePosition($("#"+Spotfire.Comments.visualPageId),getCenterPosition($commentAnchor));
if(thread){savedScrollTop=-1;savedScrollThread=thread.Start.ThreadId;var args={Comment:reply,ThreadId:thread.Start.ThreadId,Capture:captureState,ResetIsEditing:true};
if(captureState){args.X=relativePos.x;args.Y=relativePos.y;}Spotfire.Dxp.Web.Forms.AjaxService.Modify(Spotfire.CommentsPanel.viewId,"CaptureComment",JSON.stringify(args));
}else{Spotfire.Dxp.Web.Forms.AjaxService.Modify(Spotfire.CommentsPanel.viewId,"CaptureComment",JSON.stringify({Comment:reply,Capture:true,X:relativePos.x,Y:relativePos.y}));
}},onShowMoreReplies:function($thread,thread){repliesToHide=0;var commentThread=Spotfire.CommentThreadElement.createCommentThread(thread,true,"",repliesToHide,commentData.CurrentId,threadSettings).addClass("sfpc-selected");
$thread.replaceWith(commentThread);commentThread.on("scrollDeleteIntoFocus",handleScrollOnDelete);performLayout();
},onCancel:function(thread){if(!thread){onClose();}else{$commentContainer.removeClass("editing-comment");
$newOrReplyingAnchor=null;newOrReplyingCommentData=null;Spotfire.Dxp.Web.Forms.AjaxService.Modify(Spotfire.CommentsPanel.viewId,"EditingComment",JSON.stringify({isEditing:false}));
}},onResized:function(){performLayout();positionAll();restoreScrollPosition();}};var toggleOnlyShowAnchor=function(){onlyShowAnchor=!onlyShowAnchor;
$commentContainer.toggle(!onlyShowAnchor);$arrow.toggle(!onlyShowAnchor);if(!onlyShowAnchor){performLayout();
positionAll();restoreScrollPosition();}Spotfire.Dxp.Web.Forms.AjaxService.Modify(Spotfire.CommentsPanel.viewId,"ChangeOnlyShowAnchor",JSON.stringify({OnlyShowAnchor:onlyShowAnchor}));
};var $handle=Spotfire.Flex.item({grow:true}).addClass("sf-comment-header-handle");var $closeButton=$("<div/>").sfFlex({shrink:false});
Spotfire.Controls.PanelButton.initialize($closeButton,Spotfire.Localization.resources.ClosePanel,"Images/Comments/CloseBtn_10x10.svg",onClose);
var $header=Spotfire.Flex.item({shrink:false,container:"horizontal","justify-content":"end","align-items":"center"}).addClass("sf-element sf-element-visible-comment-header RoundedCorners");
$header.append($handle);if(thread){var $minimizeButton=$("<div/>").sfFlex({shrink:false});Spotfire.Controls.PanelButton.initialize($minimizeButton,Spotfire.Localization.resources.Comments_Minimize,"Images/Comments/InplaceMinimize.svg",toggleOnlyShowAnchor);
$header.append($minimizeButton);}$header.append($closeButton);$thread=Spotfire.Flex.item({grow:true}).addClass("sf-inplace-comment-thread");
$replyDiv=Spotfire.CommentThreadElement.createReplyElement(thread,threadSettings,commentData.ReplyText,false,commentData.Replying,commentData.CaptureChecked);
$commentContainer.append($header,$thread,$replyDiv);if(!Spotfire.CommentsPanel.accessRights.canCreate){$replyDiv.hide();
}var $visualPage=$("#"+Spotfire.Comments.visualPageId);var dragStart=function(){hideBox();};var startPos;
Spotfire.Touch.draggable($commentContainer,{containment:$visualPage,dragThreshold:3,handle:$handle,start:function(){startPos={top:parseInt($commentAnchor.css("top"),10),left:parseInt($commentAnchor.css("left"),10)};
},drag:function(dPos){var newPosition={top:startPos.top+dPos.top,left:startPos.left+dPos.left};moveAnchor(newPosition);
},stop:function(){moveAnchorAndModifyPosition();}});var updateContent=function(){var commentThread=Spotfire.CommentThreadElement.createCommentThread(thread,true,"",repliesToHide,commentData.CurrentId,threadSettings).addClass("sfpc-selected");
$thread.empty().append(commentThread);commentThread.on("scrollDeleteIntoFocus",handleScrollOnDelete);
};if(thread){Spotfire.Touch.draggable($commentAnchor,{containment:$visualPage,dragThreshold:3,start:dragStart,click:toggleOnlyShowAnchor,stop:moveBoxAndModifyPosition});
updateContent();Spotfire.CommentThreadElement.handleCommentEvents($commentContainer,threadSettings);}else{Spotfire.Touch.draggable($commentAnchor,{containment:$visualPage,dragThreshold:3,start:hideBox,stop:positionAll});
$commentContainer.addClass("new-comment sfc-new-conversation");$newOrReplyingAnchor=$commentAnchor;newOrReplyingCommentData=commentData;
}$commentContainer.prepend($arrow);$commentContainer.prepend($shadow);$(".sf-comments-container").append($commentContainer);
performLayout();positionAll();restoreScrollPosition();$commentContainer.toggle(!onlyShowAnchor);var scrollCurrentIntoView=function(){if(thread){if(commentData.CurrentId!==currentId){currentId=commentData.CurrentId;
var $currentCommentElement=$("#"+ID_PREFIX+commentData.CurrentId);var offset=$currentCommentElement.position();
var height=$currentCommentElement.outerHeight();if(offset.top+(height/3)<$thread.scrollTop()){$thread.scrollTop(offset.top);
}else{if(offset.top+2*(height/3)>$thread.scrollTop()+$thread.height()){$thread.scrollTop(offset.top-$thread.height()+height);
}}}}Spotfire.Utilities.tryScrollElementToCenter($visualPage,$commentAnchor);};scrollCurrentIntoView();
comment={remove:function(){$commentAnchor.remove();$commentContainer.remove();},updateEnabled:function(){var replyTextIsEmpty=newOrReplyingCommentData===null||newOrReplyingCommentData.ReplyText===undefined||newOrReplyingCommentData.ReplyText.length===0;
var enabled=(replyEnabled||(commentData.CaptureChecked!==true&&thread))&&!replyTextIsEmpty;var $replyButton=$(".sfc-comments-reply-button",$replyDiv);
$replyButton.toggleClass("sfpc-disabled",!enabled);},updateAnchor:function(isValid){var anchorValid=isValid;
if(thread){commentData.anchorClean=isValid;anchorValid=anchorValid&&commentData.Moved!==true;}else{if(newOrReplyingCommentData){newOrReplyingCommentData.anchorClean=isValid;
}}$commentAnchor.toggleClass("sfpc-is-dirty",!anchorValid);},updateAnchorIssues:updateAnchorIssuesImpl,updateThread:function(newCommentData){var old=commentData;
commentData=$.extend(old,newCommentData);thread=commentData.Thread;onlyShowAnchor=commentData.OnlyShowAnchor;
makeSureCurrentVisible();positionAnchor();updateContent();performLayout();positionAll();restoreScrollPosition();
}};comment.updateEnabled();updateAnchorIssuesImpl();}function updateComments(id){if(id){Spotfire.Comments.visualPageId=id;
}var callback=function(comments){if(!comments){return;}var $anchor;var $visualPage=$("#"+Spotfire.Comments.visualPageId);
if($visualPage.length){if($newOrReplyingAnchor){$anchor=$visualPage.find(".sf-element-comment-anchor");
if(!$anchor.length){var position={top:parseInt($newOrReplyingAnchor.css("top"),10),left:parseInt($newOrReplyingAnchor.css("left"),10)};
if(position.top>$visualPage.outerHeight()/2){position.top=$visualPage.outerHeight()/2;}if(position.left>$visualPage.outerWidth()/2){position.left=$visualPage.outerWidth()/2;
}create(newOrReplyingCommentData,position);return;}}if(comments.Comments){create(comments.Comments);}else{var removeAll=newOrReplyingCommentData&&newOrReplyingCommentData.Thread!==undefined;
clearComments(removeAll);}}};Spotfire.Dxp.Web.Forms.AjaxService.Read(Spotfire.CommentsPanel.viewId,"GetCurrentComment",JSON.stringify({}),callback);
}var replyAtPoint=function(settings){clearComments(true);var pos=relativePosition($("#"+Spotfire.Comments.visualPageId),{left:settings.x,top:settings.y});
var data=$.extend(settings,{x:pos.x,y:pos.y,onlyShowAnchor:false,Replying:true,CaptureChecked:true});
create(data);};var captureAtPoint=function(settings){clearComments(true);var pos=relativePosition($("#"+Spotfire.Comments.visualPageId),{left:settings.x,top:settings.y},settings.pointInViewPortCoordinates);
var data={x:pos.x,y:pos.y,Replying:true};create(data);};var closeComment=function(){clearComments(true);
};var replyEnabledImpl=function(enabled){replyEnabled=enabled;if(comment){comment.updateEnabled();}};
var updateAnchor=function(isValid){if(comment){comment.updateAnchor(isValid);}};var updateAnchorIssues=function(){if(comment){comment.updateAnchorIssues();
}};Spotfire.Comments={updateComments:updateComments,captureAtPoint:captureAtPoint,replyAtPoint:replyAtPoint,closeComment:closeComment,replyEnabled:replyEnabledImpl,updateAnchor:updateAnchor,updateAnchorIssues:updateAnchorIssues};
});$(function(){var ID_PREFIX="CommentsPanel";var $dropdownItem;var dropDownComment;var $dropDownButton;
var lastAnchorIssues;var visualFilterIndexToId={};var $visualFilterDropDown;var $visualFilterSection;
var currentData;var dropDownPosition;var deleteComment=function($itemElement,comment,doDelete){var $oldOverlay=$(".sf-element-comments-delete-thread-overlay");
$oldOverlay.parent().css("height","auto");$oldOverlay.remove();if(!comment.IsFirst){doDelete();}else{var $overlay=Spotfire.Flex.item({container:"vertical","justify-content":"center",fill:true}).addClass("sf-element sf-element-comments-delete-thread-overlay").click(function(e){if(!$(e.target).hasClass("sf-element-button")){e.stopPropagation();
}});var $threadElement=$itemElement.closest(".sf-element-comment-thread");$threadElement.append($overlay);
var $text=Spotfire.Flex.item({shrink:false}).text(Spotfire.Localization.resources.Comments_ConfirmDeletion).css({cursor:"default",width:"100%","white-space":"normal"});
var $buttonOk=$("<div/>").addClass("sf-element sf-element-button sfc-comments-delete-thread-ok-button");
var onClickedOk=function(){doDelete();$overlay.remove();};Spotfire.Controls.PanelButton.initialize($buttonOk,Spotfire.Localization.resources.Ok,null,onClickedOk,false,Spotfire.Localization.resources.Ok);
var $buttonCancel=$("<div/>").addClass("sf-element sf-element-button sfc-comments-delete-thread-cancel-button");
var onClickedCancel=function(){$overlay.remove();$threadElement.css("height","auto");};Spotfire.Controls.PanelButton.initialize($buttonCancel,Spotfire.Localization.resources.Cancel,null,onClickedCancel,false,Spotfire.Localization.resources.Cancel);
var $buttons=Spotfire.Flex.item({container:"horizontal","justify-content":"center",fill:true,wrap:true});
$buttons.append($buttonOk);$buttons.append($buttonCancel);$overlay.append($text);$overlay.append($buttons);
if($buttonCancel.position().top+$buttonCancel.outerHeight()>$overlay.height()){$threadElement.height($threadElement.height()+$buttonCancel.position().top+$buttonCancel.outerHeight()-$overlay.height()+10);
}$threadElement.trigger("scrollDeleteIntoFocus",[$overlay]);}};var showDropDownMenu=function($itemElement,$button,comment,position){dropDownPosition=position||$button.offset();
$dropdownItem=$itemElement;dropDownComment=comment;$dropDownButton=$button;if(Spotfire.isProfessional()){var location={top:dropDownPosition.top,left:dropDownPosition.left};
Spotfire.PageBus.publish("spotfire.visuals.comments.showDropDownMenu",{location:location,bookmarkId:comment.Id},Spotfire.CommentsPanel.viewId);
return;}var args=JSON.stringify({CommentId:comment.Id});Spotfire.Dxp.Web.Forms.AjaxService.Modify(Spotfire.CommentsPanel.viewId,"ShowContextMenu",args);
};var initializeDropDown=function(data){if($dropDownButton&&$dropdownItem&&dropDownComment&&dropDownPosition&&dropDownComment.Id===data.CommentId){var canModify=dropDownComment.Modifiable&&Spotfire.CommentsPanel.accessRights.canCreate;
var copyUrlEnabled=data.CommentHasState&&data.CopyUrlEnabled;var copyUrlTooltip=copyUrlEnabled?Spotfire.Localization.resources.Comments_CopyUrl:Spotfire.Localization.resources.Comments_CopyUrlTooltip;
var items=[{text:Spotfire.Localization.resources.Comments_CopyUrl,tag:"copyUrl",enabled:copyUrlEnabled,tooltip:copyUrlTooltip},{separator:true},{text:Spotfire.Localization.resources.Comments_Delete,tag:"delete",enabled:canModify}];
var onMenuItemClick=function(item){switch(item.tag){case"delete":var doDelete=function(){Spotfire.Dxp.Web.Forms.AjaxService.Modify(Spotfire.CommentsPanel.viewId,"DeleteComment",dropDownComment.Id);
};deleteComment($dropdownItem,dropDownComment,doDelete);break;case"copyUrl":Spotfire.Dxp.Web.Forms.AjaxService.Modify(Spotfire.CommentsPanel.viewId,"GetCopyUrl",dropDownComment.Id);
break;default:break;}return true;};var menu=Spotfire.Controls.ContextMenu.create(items,onMenuItemClick);
menu.show(dropDownPosition.left,dropDownPosition.top+($dropDownButton?$dropDownButton.height():0));}};
var updateAnchorIssuesCallback=function(anchorIssues){lastAnchorIssues=anchorIssues;Spotfire.Comments.updateAnchorIssues();
$(".sfc-comments-panel .sf-element-comments-list .sfc-issues-icon").attr("title","").removeClass("visible");
$.each(anchorIssues,function(i,anchorIssue){var issueText=anchorIssue.Issue==="Missing"?Spotfire.Localization.resources.Comments_MissingVisualizationTooltip:"";
var $item=$(".sfc-comments-panel .sf-element-comments-list #"+ID_PREFIX+anchorIssue.Id);$item.find(".sfc-issues-icon").attr("title",issueText).addClass("visible");
});};var updateVisualFilterInfoCallback=function(visualFilterInfo){var visualFilterValues=[];visualFilterValues.push(Spotfire.Localization.resources.Comments_NoVisualFilterDropDownItemText);
visualFilterIndexToId={};visualFilterIndexToId[0]="";var listIndex=1;var selectedListIndex=visualFilterInfo.SelectedIndex;
$.each(visualFilterInfo.PagesInfo,function(pageIndex,pageValue){$.each(pageValue.visuals,function(visualIndex,visualValue){visualFilterValues.push(visualValue.title);
visualFilterIndexToId[listIndex]=visualValue.id;listIndex++;});});Spotfire.Controls.DropDown.update($visualFilterDropDown,{values:visualFilterValues,selectedIndex:selectedListIndex,disabled:listIndex<2});
};var updateCurrentData=function(newCurrentData){currentData=newCurrentData;var $commentList=$(".sfc-comments-panel .sf-element-comments-list");
$commentList.find(".sfpc-selected").removeClass("sfpc-selected");if(currentData&&currentData.currentThreadId){var $threadStart=$commentList.find("#"+ID_PREFIX+currentData.currentThreadId);
var $thread=$threadStart.closest(".sf-element-comment-thread");var $item=$thread.find("#"+ID_PREFIX+currentData.currentId).addClass("sfpc-selected");
$thread.addClass("sfpc-selected");if($item.length===0){var $moreReplies=$thread.find(".sfc-show-more-replies");
if($moreReplies.length>0){$moreReplies.addClass("sfpc-selected");}}}};var updateStateColor=function(isValid){$(".sf-element-comment-item .sf-comment-state").toggleClass("sfpc-is-dirty",!isValid);
};var updateAnchorIssues=function(){Spotfire.Dxp.Web.Forms.AjaxService.Read(Spotfire.CommentsPanel.viewId,"GetAnchorIssues",JSON.stringify({}),updateAnchorIssuesCallback);
};var updateVisualFilterInfo=function(){if(!$visualFilterDropDown){return;}Spotfire.Dxp.Web.Forms.AjaxService.Read(Spotfire.CommentsPanel.viewId,"GetVisualFilterInfo",JSON.stringify({}),updateVisualFilterInfoCallback);
};var initialize=function($parent,toggleUpdate,onClosePanel){var threadIdToThread;var threads;var low=0;
var windowSize=50;var high=windowSize-1;var numberOfThreads;var expandedThreads={};var showAllReplies={};
var draftReplies={};var getCommentsCallback,update,performLayout,afterPartialUpdate;$parent.empty();$parent.addClass("sfc-comments-panel");
if(!(Spotfire.CommentsPanel.accessRights&&Spotfire.CommentsPanel.eachComponent)){throw"CommentsPanel not properly initialized";
}var isEditing=false;var pendingCommentUpdate=false;$visualFilterSection=$("<div/>").addClass("sf-element sf-element-comments-panel-filter").appendTo($parent);
$visualFilterDropDown=$("<div/>").appendTo($visualFilterSection);var onSelectedVisualFilter=function(text,index){Spotfire.Dxp.Web.Forms.AjaxService.Modify(Spotfire.CommentsPanel.viewId,"FilterToVisual",JSON.stringify({VisualId:visualFilterIndexToId[index]}));
};var values=[];values.push(Spotfire.Localization.resources.Comments_NoVisualFilterDropDownItemText);
Spotfire.Controls.DropDown.initialize($visualFilterDropDown,{useIndexAsValueId:true,values:values,selectedIndex:0,onSelected:onSelectedVisualFilter,disabled:true});
var $viewport=$("<div></div>").addClass("sf-element sf-element-comments-list");$viewport.css("overflow-y","auto");
$viewport.css("overflow-x","hidden");var $panelBackground=$("<div>").addClass("sf-element-comments-panel-bg");
Spotfire.getSvg("Images/Comments/CommentsPanelEmpty.svg",function(svg){$panelBackground.append(svg);$viewport.prepend($panelBackground);
});var $list=$("<div></div>");$viewport.append($list);var performSearch=function(value){Spotfire.Dxp.Web.Forms.AjaxService.Modify(Spotfire.CommentsPanel.viewId,"Search",value);
};var $searchField=$("<div/>").addClass("SearchField sf-element sf-element-search-field").sfFlex({container:"horizontal"});
var $searchImage=$("<div/>").addClass("CommentsPanelMagnifier");var $searchInput=$("<input type='text'/>").addClass("sf-element sf-element-input").css("width","100%");
$searchField.append($searchImage);$searchField.append($searchInput).sfFlex();$parent.append($searchField);
$searchField.on("mouseenter",function(){$searchImage.addClass("Hover");});$searchField.on("mouseleave",function(){$searchImage.removeClass("Hover");
});$searchInput.on("focus",function(){$searchImage.addClass("Focus");});$searchInput.on("blur",function(){$searchImage.removeClass("Focus");
});var searchInput=Spotfire.Controls.InputField.initialize($searchInput,Spotfire.Localization.resources.Comments_SearchPlaceholderText,performSearch);
var updateSearchField=function(data){searchInput.update(data);};$parent.append($searchField);if(!Spotfire.Filters.StyledFilters.createMagnifierGlass($searchImage)){$searchImage.addClass("Fallback");
}$parent.append($viewport);var scrollbar=$viewport.StyledScrollbar({cssClass:"BookmarkScroll",allowResize:true});
var resize=function(width,height){var listPbmWidth=$viewport.outerWidth(true)-$viewport.width();width=width-listPbmWidth;
$viewport.width(width);var listPbmHeight=$viewport.outerHeight(true)-$viewport.height();$viewport.height(height-$searchField.outerHeight(true)-$visualFilterSection.outerHeight(true)-listPbmHeight);
Spotfire.CommentThreadElement.resize($list);};performLayout=function(){resize($parent.width(),$parent.height());
if(Spotfire.capabilities.supportsTouch()){$.each($(".sf-context-menu-button",$parent),function(i,button){Touch.addTouchTarget(button,15,15,15,15);
});}scrollbar.refresh();};afterPartialUpdate=function(){if(lastAnchorIssues){updateAnchorIssuesCallback(lastAnchorIssues);
}if(currentData){updateCurrentData(currentData);}};var threadSettings;var handleScrollOnDelete=function(event,overlay){var $offsetParent=overlay.offsetParent();
var top=$offsetParent.position().top+overlay.position().top;var height=overlay.outerHeight();$viewport.scrollTop(top+height/2-$viewport.height()/2);
};var onShowMoreReplies=function($thread,thread){var threadId=thread.Start.ThreadId;showAllReplies[threadId]=true;
var $commentThread=Spotfire.CommentThreadElement.createCommentThread(thread,expandedThreads[threadId]===true,draftReplies[threadId],showAllReplies[threadId],null,threadSettings);
$thread.replaceWith($commentThread);$commentThread.on("scrollDeleteIntoFocus",handleScrollOnDelete);performLayout();
afterPartialUpdate();};var ensureReplyFieldVisible=function($replySection){var $thread=$replySection.parent(".sf-element-comment-thread");
var scrollTop=$viewport.scrollTop();var viewHeight=$viewport.height();var position=$replySection.position().top+$thread.position().top;
var bottom=position+$replySection.outerHeight();if(scrollTop>position){$viewport.scrollTop(position);
}if(scrollTop+viewHeight<bottom){$viewport.scrollTop(bottom-viewHeight);}};threadSettings={idPrefix:"CommentsPanel",AddReply:function(){return Spotfire.CommentsPanel.accessRights.canCreate;
},onShowMore:performLayout,onShowMoreReplies:onShowMoreReplies,onfocus:function(thread,$replySection){isEditing=true;
ensureReplyFieldVisible($replySection);},onblur:function(){isEditing=false;if(pendingCommentUpdate){pendingCommentUpdate=false;
update(false,null,true);}},oninput:function($replySection,thread,replyText){var $replyButton=$(".sfc-comments-reply-button",$replySection);
$replyButton.toggleClass("sfpc-disabled",replyText.length===0);if(replyText!==""){draftReplies[thread.Start.ThreadId]=replyText;
}else{delete draftReplies[thread.Start.ThreadId];}},onReply:function(thread,reply){delete draftReplies[thread.Start.ThreadId];
Spotfire.Dxp.Web.Forms.AjaxService.Modify(Spotfire.CommentsPanel.viewId,"CaptureComment",JSON.stringify({Comment:reply,ThreadId:thread.Start.ThreadId,Capture:false}));
},onExpandCollapse:function(thread){var threadId=thread.Start.ThreadId;expandedThreads[threadId]=!expandedThreads[threadId];
var newThread=Spotfire.CommentThreadElement.createCommentThread(thread,expandedThreads[threadId]===true,draftReplies[threadId],showAllReplies[threadId],null,threadSettings);
$("#"+ID_PREFIX+threadId,$list).closest(".sf-element-comment-thread").replaceWith(newThread);newThread.on("scrollDeleteIntoFocus",handleScrollOnDelete);
var replySection=newThread.find(".sf-element-comment-reply-section");if(replySection.length===1){ensureReplyFieldVisible(replySection);
}performLayout();afterPartialUpdate();},onCancel:function(thread,$replySection){var $replyButton=$(".sfc-comments-reply-button",$replySection);
$replyButton.toggleClass("sfpc-disabled",true);delete draftReplies[thread.Start.ThreadId];},onResized:function(){performLayout();
},onClosePanel:onClosePanel};Spotfire.CommentThreadElement.handleCommentEvents($viewport,threadSettings);
var $progressIndicator;var progressTimer;var showProgress=function(){if(!$progressIndicator&&!progressTimer){progressTimer=setTimeout(function(){$progressIndicator=$(Spotfire.Progress.createProgressAnimation($parent.innerWidth(),$parent.innerHeight()));
$parent.append($progressIndicator);progressTimer=null;},1000);}};var hideProgress=function(){if(progressTimer){clearTimeout(progressTimer);
progressTimer=null;}if($progressIndicator){$progressIndicator.remove();$progressIndicator=null;}};var populate=function(){var $currentVisibleItemsContainer=$("<div/>").css({position:"relative"});
var j;var bookmarkElement;var thread;var threadId;for(j=0;j<threads.length;j++){thread=threads[j];threadId=thread.Start.ThreadId;
bookmarkElement=Spotfire.CommentThreadElement.createCommentThread(thread,expandedThreads[threadId]===true,draftReplies[threadId],showAllReplies[threadId],null,threadSettings);
bookmarkElement.on("scrollDeleteIntoFocus",handleScrollOnDelete);$currentVisibleItemsContainer.append(bookmarkElement);
}if(numberOfThreads>high+1){var remainingThreads=numberOfThreads-high-1;var additionalThreadsString=Spotfire.Utilities.formatString(Spotfire.Localization.resources.Comments_AdditionalThreadsMessage,remainingThreads,(windowSize<remainingThreads?windowSize:remainingThreads));
var $postDiv=$("<div/>").addClass("sf-more-threads").text(additionalThreadsString).click(function(){high=high+(windowSize<remainingThreads?windowSize:remainingThreads);
update(false,null,true);});$currentVisibleItemsContainer.append($postDiv);}$list.remove();$list=$currentVisibleItemsContainer;
$viewport.append($currentVisibleItemsContainer);performLayout();};getCommentsCallback=function(settings){if(!settings){return;
}if(settings.Threads){numberOfThreads=settings.NumberOfThreads;if(numberOfThreads>0){$panelBackground.hide();
}else{$panelBackground.show();}if(isEditing){pendingCommentUpdate=true;return;}pendingCommentUpdate=false;
updateVisualFilterInfoCallback(settings.VisualFilterInfo);threads=settings.Threads;threadIdToThread={};
var i;for(i=0;i<threads.length;i++){threadIdToThread[threads[i].Start.ThreadId]=threads[i];}populate();
updateAnchorIssuesCallback(settings.AnchorIssues);updateCurrentData(settings.CurrentThread);hideProgress();
}};update=function(doUpdate,updateAvailiable,doRead){if(doUpdate){expandedThreads={};showAllReplies={};
high=windowSize-1;if(scrollbar){scrollbar.scrollTop(0);}}if(updateAvailiable!==null&&updateAvailiable!==undefined){toggleUpdate(updateAvailiable);
}if(doUpdate||doRead){Spotfire.Dxp.Web.Forms.AjaxService.Read(Spotfire.CommentsPanel.viewId,"GetComments",JSON.stringify({low:low,high:high,showAllFor:Object.keys(showAllReplies)}),getCommentsCallback);
}};$parent.bind("panelResize",function(){performLayout();});Spotfire.CommentsPanel.updateCallback=update;
performLayout();Spotfire.Dxp.Web.Forms.AjaxService.Read(Spotfire.CommentsPanel.viewId,"Search","",updateSearchField);
showProgress();update(true,null,true);return{refresh:function(){Spotfire.Dxp.Web.Forms.AjaxService.Modify(Spotfire.CommentsPanel.viewId,"RefreshCommentsPanel","");
},hide:function(){$list.empty();},show:function(){performLayout();Spotfire.Dxp.Web.Forms.AjaxService.Read(Spotfire.CommentsPanel.viewId,"Search","",updateSearchField);
showProgress();update(false,null,true);}};};var updateComments=function(doUpdate,updateAvailiable,doRead){if(Spotfire.CommentsPanel.updateCallback){Spotfire.CommentsPanel.updateCallback(doUpdate,updateAvailiable,doRead);
}};var showCopyBookmarkUrlDialog=function(webPlayerUrl){var container=$("<div></div>");container.css({overflow:"hidden"});
var label2=$("<div></div>");label2.text(Spotfire.Localization.resources.LinkToComment);container.append(label2);
var field2=$("<input type='text'/>").addClass("sf-element-input");field2.val(webPlayerUrl);field2.css({width:"100%","box-sizing":"border-box"});
container.append(field2);var onFocus=function(){$(this).select();};field2.click(onFocus);var buttons=[{text:Spotfire.Localization.resources.BookmarksClose,isDefault:true}];
var options={title:Spotfire.Localization.resources.Comments_CopyUrlTitle,resizable:true,buttons:buttons,width:350,height:150,minWidth:300,minHeight:200};
Spotfire.Controls.ModalDialog.initialize(container,options);};var initializeAccessRights=function(canCreate){Spotfire.CommentsPanel.accessRights={canCreate:canCreate};
};var updateAccessRights=function(canCreate){if(!Spotfire.CommentsPanel.accessRights){return;}if(Spotfire.CommentsPanel.accessRights.canCreate===canCreate){return;
}Spotfire.CommentsPanel.accessRights.canCreate=canCreate;var $newCommentButton=$(".sfc-new-comment-button");
if(canCreate){$newCommentButton.show();}else{$newCommentButton.hide();}};var initializeComponents=function(flags,displayNames){Spotfire.CommentsPanel.eachComponent=function(callback){var i=0;
var flag;for(flag in flags){if(flags.hasOwnProperty(flag)){callback(displayNames[i],flags[flag]);i++;
}}};};var showErrorDialog=function(title,message){if(Spotfire.isProfessional()){Spotfire.PageBus.publish("spotfire.visuals.comments.showErrorDialog",{title:title,message:message},Spotfire.CommentsPanel.viewId);
return;}var container=$("<div></div>");var label1=$("<div></div>");label1.text(message);container.append(label1);
var buttons=[{text:Spotfire.Localization.resources.BookmarksClose,isDefault:true}];var options={title:title,buttons:buttons,width:350,height:200,resizable:false};
Spotfire.Controls.ModalDialog.initialize(container,options);};var updateWithIssues=function(updateFunc){if(lastAnchorIssues){updateFunc(lastAnchorIssues);
}};Spotfire.registerNameSpace("CommentsPanel",{initializeComponents:initializeComponents,initializeAccessRights:initializeAccessRights,updateAccessRights:updateAccessRights,initialize:initialize,update:updateComments,showDropDown:showDropDownMenu,initializeDropDown:initializeDropDown,showErrorDialog:showErrorDialog,showCopyBookmarkUrlDialog:showCopyBookmarkUrlDialog,setCurrent:updateCurrentData,updateAnchorIssues:updateAnchorIssues,updateVisualFilterInfo:updateVisualFilterInfo,updateWithIssues:updateWithIssues,updateStateColor:updateStateColor,deleteComment:function(){if($dropdownItem&&dropDownComment){deleteComment($dropdownItem,dropDownComment,function(){Spotfire.PageBus.publish("spotfire.visuals.comments.deleteComment",{location:location,bookmarkId:dropDownComment.Id},Spotfire.CommentsPanel.viewId);
});}}});});$(function(){var instance;var $container;var $panel;var control;var toTheRight;var standardViewPort=$("meta[name=viewport]").attr("content");
var showPopover=function($element){var $styledDialogContainer=$(".sf-comments-dialog-container");if(!$styledDialogContainer.length){$styledDialogContainer=$("<div/>").addClass("sf-element sf-element-styled-dialog sf-comments-dialog-container");
$(document.body).append($styledDialogContainer);}$("."+$element.attr("class").split(" ").join("."),$styledDialogContainer).remove();
$styledDialogContainer.append($element);};var handleAddInteractionCallback=function(enable){$(".sf-element-comments-toolbar .sfc-new-comment-button").toggleClass("sfpc-disabled",!enable);
Spotfire.Comments.replyEnabled(enable);};var handleAddInteraction=function(){Spotfire.Dxp.Web.Forms.AjaxService.Read(Spotfire.CommentsPanel.viewId,"EnableAddInteraction","",handleAddInteractionCallback);
};var createDialog=function(panelMinimized,updateAvailable){standardViewPort=$("meta[name=viewport]").attr("content");
$("meta[name=viewport]").attr("content","width=device-width,initial-scale=1,maximum-scale=1");$container=Spotfire.Flex.item({container:"vertical","align-items":"center"}).addClass("sf-element sf-element-comments-toolbar");
if(Spotfire.capabilities.supportsDropShadow()){$container.addClass("RoundedDropShadow");}var oldDialogSettings=$("body").prop("CommentPanelSettings");
if(oldDialogSettings){$container.css(oldDialogSettings);$container.css({width:"52px"});}else{$container.css({top:"40px",left:($(window).width()-62)+"px",width:"52px"});
}var TOOLBAR_PANEL_DISTANCE=2;var movePanel=function(){if($panel){var offset2=$container.position();$panel.css("width",Math.min($panel.width(),$(window).width())+"px");
$panel.css("height",Math.min($panel.height(),$(window).height())+"px");var handleHeight=$container.find(".sf-element-comments-toolbar-header").height();
var borderWidth=parseInt($container.find(".sf-element-comments-toolbar-header").css("border-bottom-width"),10);
var top=offset2.top+handleHeight+borderWidth;var left=offset2.left-TOOLBAR_PANEL_DISTANCE-parseInt($panel.css("width").replace("px"),10);
var rightPos=offset2.left+TOOLBAR_PANEL_DISTANCE+$container.width();toTheRight=(toTheRight||left<0)&&!(rightPos+$panel.width()>=$(window).width());
$panel.toggleClass("sf-comments-panel-to-right",toTheRight);var maxLeft=$(window).width()-parseInt($panel.css("width").replace("px"),10);
var maxTop=$(window).height()-parseInt($panel.css("height").replace("px"),10);$panel.css("top",Math.min(Math.max(top,0),maxTop)+"px");
$panel.css("left",Math.min(Math.max(toTheRight?rightPos:left,0),maxLeft)+"px");}};var moveToolbar=function(keepPanelPosition){var top=parseInt($container.css("top").replace("px"),10);
var left=parseInt($container.css("left").replace("px"),10);var maxLeft=$(window).width()-parseInt($container.css("width").replace("px"),10);
var maxTop=$(window).height()-parseInt($container.css("height").replace("px"),10);$container.css("top",Math.min(Math.max(top,0),maxTop)+"px");
$container.css("left",Math.min(Math.max(left,0),maxLeft)+"px");if(!keepPanelPosition){movePanel();}};
var moveToolbarRelativePanel=function(){var width=$panel.width();var newPos=$panel.position();var panelToleftPos=newPos.left+width+TOOLBAR_PANEL_DISTANCE;
var containerWidth=$container.width();var panelToRightPos=newPos.left-TOOLBAR_PANEL_DISTANCE-containerWidth;
var handleHeight=$container.find(".sf-element-comments-toolbar-header").height();var borderWidth=parseInt($container.find(".sf-element-comments-toolbar-header").css("border-bottom-width"),10);
toTheRight=(toTheRight||panelToleftPos+containerWidth>=$(window).width())&&!(panelToRightPos<0);$panel.toggleClass("sf-comments-panel-to-right",toTheRight);
$container.css({left:(toTheRight?panelToRightPos:panelToleftPos)+"px",top:(newPos.top-handleHeight-borderWidth)+"px"});
moveToolbar(true);};var hidePanel=function(){if(control){control.hide();$panel.hide();}};var close=function(){$("meta[name=viewport]").attr("content",standardViewPort);
if($container){$("body").prop("CommentPanelSettings",{left:$container.css("left"),top:$container.css("top")});
$container.remove();}if($panel){$("body").prop("CommentPanelSize",{width:$panel.css("width"),height:$panel.css("height")});
$panel.remove();$panel=undefined;control=undefined;}$container=undefined;$(".sf-comments-dialog-container").remove();
Spotfire.CommentsPanel.updateCallback=null;};showPopover($container);var $handle=Spotfire.Flex.item({grow:true}).addClass("sf-comment-header-handle");
var $exitButton=$("<div/>").addClass("sfc-close-button").sfFlex({shrink:false});Spotfire.Controls.PanelButton.initialize($exitButton,Spotfire.Localization.resources.ClosePanel,"Images/Comments/CloseBtn_7x7.svg",function(){Spotfire.Dxp.Web.Forms.AjaxService.Modify(Spotfire.CommentsPanel.viewId,"ExitCommentsMode","");
});var $header=Spotfire.Flex.item({container:"horizontal","justify-content":"end"}).addClass("sf-element sf-element-comments-toolbar-header");
$header.append($handle);$header.append($exitButton);$container.append($header);var $newCommentButton=Spotfire.Flex.item({container:"horizontal","justify-content":"center"}).addClass("sf-element sf-element-button sfc-new-comment-button");
$newCommentButton.attr("title",Spotfire.Localization.resources.Comments_AddCommentButtonTooltip);var $threadsButton=Spotfire.Flex.item({container:"horizontal","justify-content":"center"}).addClass("sf-element sf-element-button sfc-threads-button");
$threadsButton.attr("title",Spotfire.Localization.resources.Comments_BrowseConversationsButtonTooltip);
Spotfire.getSvg("Images/Comments/add_comment_34x34.svg",function($svg){$newCommentButton.append($svg);
});Spotfire.getSvg("Images/Comments/open_all_comments_small_panel_24x24.svg",function($svg){$threadsButton.append($svg);
});$container.append($newCommentButton);$container.append($threadsButton);var updatePanelMinimized=function(panelMinimizedNew){$threadsButton.toggleClass("sfpc-active",!panelMinimizedNew);
if(panelMinimized!==panelMinimizedNew){panelMinimized=panelMinimizedNew;Spotfire.Dxp.Web.Forms.AjaxService.Modify(Spotfire.CommentsPanel.viewId,"ChangePanelMinimized",JSON.stringify({PanelMinimized:panelMinimized}));
}};$threadsButton.on("click",function(){updatePanelMinimized(!panelMinimized);});var newComment=function(e){if($(e.target).closest(".sfc-new-comment-button").hasClass("sfpc-disabled")){return;
}Spotfire.Dxp.Web.Forms.AjaxService.Modify(Spotfire.CommentsPanel.viewId,"InitiateNewComment","");};$newCommentButton.on("click",newComment);
var showPanel=function(){if(!control){var onClose=function(){updatePanelMinimized(true);};var $updateButton=Spotfire.Flex.item().addClass("sf-element sf-element-button sfc-comments-panel-refresh-button");
var $closeButton=Spotfire.Flex.item().addClass("sf-element sf-element-button sfc-comments-panel-close-button").click(onClose).attr("title",Spotfire.Localization.resources.Close);
var $content=Spotfire.Flex.item().css({position:"relative",height:"100%"});var $title=Spotfire.Flex.item({grow:true}).text(Spotfire.Localization.resources.Comments_BrowseConversationsTitle).addClass("sf-element sf-element-text-box");
var $titleRow=Spotfire.Flex.item({container:"horizontal","align-items":"center",shrink:false}).addClass("sf-element sf-element-comments-panel-title").append($title,$updateButton,$closeButton);
$panel=Spotfire.Flex.item({container:"vertical",fill:true,"align-items":"stretch"}).addClass("sf-element sf-element-comments-panel").append($titleRow,$content);
if(Spotfire.capabilities.supportsDropShadow()){$panel.addClass("RoundedDropShadow");}Spotfire.getSvg("Images/Comments/ClosePanel.svg",function($svg){$svg.css({width:"14px",height:"14px"});
$closeButton.append($svg);});Spotfire.getSvg("Images/Comments/ReloadPanel.svg",function($svg){$svg.css({width:"12px",height:"12px"});
$updateButton.append($svg);});var panelSettings=$("body").prop("CommentPanelSize");if(panelSettings){$panel.css(panelSettings);
}else{$panel.css({width:"250px",height:"500px"});}showPopover($panel);Spotfire.Touch.draggable($panel,{containment:$(".sf-element-document"),handle:$title,dragThreshold:3,start:function(){$container.hide();
},stop:function(){$container.show();moveToolbarRelativePanel();}});Spotfire.Touch.resizable($panel,{containment:$(".sf-element-document"),minWidth:150,minHeight:100,handles:"e, s, w, n, ne, nw, se, sw",start:function(){$container.hide();
},stop:function(){$container.show();moveToolbarRelativePanel();$content.trigger("panelResize");}});movePanel();
var toggleUpdate=function(visible){$updateButton.toggle(visible);};control=Spotfire.CommentsPanel.initialize($content,toggleUpdate,onClose);
var onRefresh=function(){control.refresh();};$updateButton.click(onRefresh);toggleUpdate(updateAvailable);
}else{$panel.show();control.show();}};Spotfire.Touch.draggable($(".sf-element-comments-toolbar"),{containment:$(".sf-element-document"),handle:$handle,dragThreshold:3,start:function(){if(panelMinimized===false){$threadsButton.toggleClass("sfpc-active");
hidePanel();}},stop:function(){movePanel();if(panelMinimized===false){$threadsButton.toggleClass("sfpc-active");
showPanel();}}});instance={container:$container,close:close,invalidate:function(panelMinimizedNew){$newCommentButton.toggle(Spotfire.CommentsPanel.accessRights.canCreate);
$threadsButton.toggleClass("sfpc-active",!panelMinimizedNew);panelMinimized=panelMinimizedNew;if(!panelMinimized){showPanel();
}else{hidePanel();}handleAddInteraction();}};moveToolbar();instance.invalidate(panelMinimized);};var closeDialog=function(){$("meta[name=viewport]").attr("content",standardViewPort);
if(instance){instance.close();}};var ensureVisible=function(settings){if(instance){instance.close();}if(settings.visible){createDialog(settings.panelMinimized,settings.updateAvailable);
}};var invalidate=function(mode){if(instance){instance.invalidate(mode);}};Spotfire.registerNameSpace("CommentsToolbar",{ensureVisible:ensureVisible,createDialog:createDialog,closeDialog:closeDialog,invalidate:invalidate,handleAddInteraction:handleAddInteraction});
});$(function(){var createCommentElement=function(comment,isThreadStart,replyCount,settings,threadLatestModifiedDate,order){var $item;
var $title;var $author;var $hasState;var $button;var tooltipText=settings.idPrefix==="CommentsPanel"?Spotfire.Localization.resources.Comments_OpenConversationTooltip:Spotfire.Localization.resources.Comments_ClickOnCommentTooltip;
$item=$("<div class='sf-element sf-element-comment-item'></div>");if(comment.HasState){$item.attr("title",tooltipText);
}Spotfire.StyleManager.setSequencePseudoClasses($item,order,replyCount+1);$title=$("<div class='sf-element sf-element-title'></div>");
$author=$("<div class='sf-element sf-element-text-box'></div>").sfFlex();var $issues=$("<div class='sf-element sf-element-icon sfc-issues-icon'></div>").sfFlex();
$hasState=$("<div class='sf-element sf-element-icon sf-comment-state'></div>").attr("title",Spotfire.Localization.resources.Comments_CommentContainsStateTooltip);
Spotfire.getSvg("Images/Comments/indication_reply_with_state_small.svg",function($svg){$svg.css({width:"100%",height:"100%"});
$hasState.append($svg);});var $anchor=$(".sf-element-comment-anchor");var isDirty=$anchor.length>0?$anchor.is(".sfpc-is-dirty"):true;
$hasState.toggleClass("sfpc-is-dirty",isDirty);Spotfire.getSvg("Images/Buttons/Warning_small.svg",function($svg){$svg.css({width:"100%",height:"100%"});
$issues.append($svg);});var $authorAndModifiedDiv=Spotfire.Flex.item({container:"horizontal","align-items":"center","justify-content":"space-between"});
var $authorDiv=Spotfire.Flex.item({container:"horizontal","justify-content":"start","align-items":"center",grow:true});
$authorDiv.append($hasState);$authorDiv.append($author);$authorDiv.append($issues);$authorAndModifiedDiv.append($authorDiv);
$item.append($authorAndModifiedDiv);var $titleRow=Spotfire.Flex.item({container:"horizontal","align-items":"center"}).css("background-color","inherit");
$titleRow.append($title.sfFlex({grow:true}));$button=$("<div class='sf-element sf-element-button sf-context-menu-button'></div>").css({height:"16px",width:"16px"}).sfFlex({shrink:false}).attr("title",Spotfire.Localization.resources.Comments_ContextMenuButtonTooltip);
Spotfire.getSvg("Images/Comments/More.svg",function($svg){$svg.css({width:"16px",height:"16px"});$button.append($svg);
});$titleRow.append($button);$item.append($titleRow);$item.attr("id",settings.idPrefix+comment.Id);var $readMore=$("<div class='sf-element-text-box sfc-read-more'>[...]</div>").attr("title",Spotfire.Localization.resources.Comments_ReadMore);
$title.text(comment.Name).append($readMore);if(comment.ShowWholeText){$title.addClass("sf-read-all");
}if(comment.MatchesSearch){$title.addClass("sfpc-matches-search");}var $threadLatestModifiedDate=Spotfire.Flex.item().addClass("sf-element sf-element-text-box sfc-comment-date sfpc-last");
if(threadLatestModifiedDate){$threadLatestModifiedDate.text(threadLatestModifiedDate);$authorAndModifiedDiv.append($threadLatestModifiedDate);
}else{$threadLatestModifiedDate.text(comment.Created);$authorDiv.append($threadLatestModifiedDate);}var aboutText=comment.Author!==undefined?comment.Author:"";
$author.text(aboutText);if(!comment.HasState){$hasState.hide();}else{$item.addClass("sfc-interactive-comment");
}if(isThreadStart){var $otherInfo=Spotfire.Flex.item({container:"horizontal","justify-content":"end"}).addClass("sf-element sf-element-button-group thread-options");
if(settings.onExpandCollapse){var $expandButton=$("<div class='sf-element sf-element-expand-collapse-button'/>").sfFlex({container:"horizontal","justify-content":"end","align-items":"center"});
$expandButton.append($("<div class='sf-element sf-element-text-box'/>").text(replyCount).sfFlex());$expandButton.addClass("sf-comment-thread-expandable");
if(threadLatestModifiedDate){$expandButton.attr("title",Spotfire.Localization.resources.Comments_ShowFullConversationTooltip);
var $expandSvg=$("<div/>").addClass("expand-svg").sfFlex();$expandButton.append($expandSvg);Spotfire.getSvg("Images/Comments/ExpandReplies.svg",function($svg){$svg.css({width:"100%",height:"100%"});
$expandSvg.append($svg);});}else{$expandButton.attr("title",Spotfire.Localization.resources.Comments_HideFullConversationTooltip);
var $collapseSvg=$("<div/>").addClass("expand-svg").sfFlex();$expandButton.append($collapseSvg);Spotfire.getSvg("Images/Comments/CollapseReplies.svg",function($svg){$svg.css({width:"100%",height:"100%"});
$collapseSvg.append($svg);});}$expandButton.appendTo($otherInfo);}$otherInfo.appendTo($item);}$item.data("comment",comment);
return $item;};var createReplyElement=function(thread,settings,replyText,showReplyInlineButton,focus,captureInitial){var $replySection=$("<div class='sf-element sf-element-comment-reply-section RoundedCorners'/>").sfFlex({container:"vertical","align-items":"stretch",shrink:false});
var $replyButtonsRowDiv1=$("<div class='reply-buttons-div'/>").sfFlex({container:"horizontal","justify-content":"start","align-items":"center"});
var $replyButtonsRowDiv2=$("<div class='reply-buttons-div'/>").sfFlex({container:"horizontal","justify-content":"end","align-items":"center"});
var hasBeenFocused=false;var $replyTextField=$("<textarea/>");var $cancelButton;var $postButton;var replyTextFocusChanged=function(newValue){if(hasBeenFocused===newValue){return;
}hasBeenFocused=newValue;$replyButtonsRowDiv1.toggle(hasBeenFocused);$replyButtonsRowDiv2.toggle(hasBeenFocused);
$replyTextField.attr("rows",hasBeenFocused?3:1);if(settings.onResized){settings.onResized();}};var updatePlaceholder=function(){if($replyTextField[0].textLength===0){$replyTextField[0].placeholder=thread?Spotfire.Localization.resources.Comments_ReplyFieldPlaceholder:Spotfire.Localization.resources.Comments_WriteFieldPlaceholder;
}else{$replyTextField[0].placeholder="";}};$replyTextField.addClass("sf-element sf-element-textarea sf-input-with-placeholder").attr("placeholder",thread?Spotfire.Localization.resources.Comments_ReplyFieldPlaceholder:Spotfire.Localization.resources.Comments_WriteFieldPlaceholder).attr("rows",3).keyup(function(e){updatePlaceholder();
if(e.which===Keys.RETURN&&e.ctrlKey){$postButton.click();e.preventDefault();}else{if(e.which===Keys.ESCAPE){$cancelButton.click();
$(this).blur();}}}).focus(function(){replyTextFocusChanged(true);if(settings.onfocus){settings.onfocus(thread,$replySection);
}}).blur(function(){updatePlaceholder();if(settings.onblur){settings.onblur();}}).bind("keyup input paste",function(){var maxLength=1000;
var text=$(this).val();var length=text.length;if(length>maxLength){$(this).val(text.substr(0,maxLength));
}});var replyTextFieldValue=replyText||"";$replyTextField.on("input",function(){if(settings.oninput){settings.oninput($replySection,thread,$.trim($replyTextField.val()));
}}).val(replyTextFieldValue);var captureState=!thread;if(typeof captureInitial==="boolean"){captureState=captureInitial;
}var $replyInlineButton=$("<div/>").addClass("sf-element sf-element-button sfc-comment-inline").sfFlex({shrink:false});
var replyInlineButtonText=Spotfire.Localization.resources.Comments_ContinueReplyingInlineTooltip;var onClickReplyInlineButton=function(){var reply=$.trim($replyTextField.val());
$replyTextField.val("");$replyTextField.blur();Spotfire.Dxp.Web.Forms.AjaxService.Modify(Spotfire.CommentsPanel.viewId,"ReplyInplaceComment",JSON.stringify({ThreadId:thread.Start.Id,Reply:reply}));
if(settings.onCancel){settings.onCancel(thread,$replySection);}replyTextFocusChanged(false);};Spotfire.Controls.PanelButton.initialize($replyInlineButton,replyInlineButtonText,"Images/Comments/ReplyInContext.svg",onClickReplyInlineButton);
$replyTextField.sfFlex({grow:true});$postButton=$("<div/>").addClass("sf-element sf-element-button sfc-comments-reply-button").sfFlex({container:"horizontal","align-items":"center"});
var postButtonText=thread?Spotfire.Localization.resources.Comments_ReplyButtonText:Spotfire.Localization.resources.Comments_NewButtonText;
var onClickPostButton=function(){if($(this).is(".sfpc-disabled")){return;}var reply=$.trim($replyTextField.val());
if(reply===""){return;}settings.onReply(thread,reply,captureState);$replyTextField.blur();};Spotfire.Controls.PanelButton.initialize($postButton,postButtonText,null,onClickPostButton,false,postButtonText);
$postButton.toggleClass("sfpc-disabled",replyTextFieldValue.length===0);$cancelButton=$("<div/>").addClass("sf-element sf-element-button sfc-comments-cancel-button").sfFlex({container:"horizontal","align-items":"center"});
var cancelButtonText=Spotfire.Localization.resources.Comments_CancelAddButtonText;var onClickCancelButton=function(){if(settings.onCancel){settings.onCancel(thread,$replySection);
}if(thread){$replyTextField.val("");updatePlaceholder();if(showReplyInlineButton){replyTextFocusChanged(false);
}}};Spotfire.Controls.PanelButton.initialize($cancelButton,cancelButtonText,null,onClickCancelButton,false,cancelButtonText);
var $captureStateCheckBox=$("<input type='checkbox' id='captureStateButton' class='replyStateButton'/>").sfFlex({container:"horizontal","align-items":"center"}).attr("checked",captureState).change(function(){captureState=$captureStateCheckBox.is(":checked");
$(".sfc-reply-with-state-icon",$replyButtonsRowDiv1).toggleClass("sfc-is-on",captureState);settings.onCaptureChecked(thread,captureState);
});var $captureStateLabel=$("<label>").addClass("sf-element sf-element-text-box sfc-reply-with-state-text").sfFlex({container:"horizontal","align-items":"center"}).attr("for","captureStateButton").text(Spotfire.Localization.resources.Comments_CaptureStateButtonText);
if(thread&&!focus){$replyButtonsRowDiv1.hide();$replyButtonsRowDiv2.hide();$replyTextField.attr("rows",1);
}$replyButtonsRowDiv2.append($postButton);$replyButtonsRowDiv2.append($cancelButton);var $replyFieldRow=Spotfire.Flex.item({container:"horizontal","justify-content":"start","align-items":"start"});
if(showReplyInlineButton){$replyFieldRow.append($replyInlineButton);}$replyFieldRow.append($replyTextField);
$replySection.append($replyFieldRow);if(thread&&!showReplyInlineButton){$replyButtonsRowDiv1.append($captureStateCheckBox);
Spotfire.Filters.StyledFilters.createStyledInput($captureStateCheckBox,13,13);var $replyWithStateIcon=$("<div class='sf-element sf-element-icon sfc-reply-with-state-icon'/>").toggleClass("sfc-is-on",captureState).css({width:"8px",height:"9px"});
Spotfire.getSvg("Images/Comments/indication_reply_with_state_small.svg",function($svg){$svg.css({width:"8px",height:"9px"});
$replyWithStateIcon.append($svg);});$replyButtonsRowDiv1.append($replyWithStateIcon);$replyButtonsRowDiv1.append($captureStateLabel);
$replySection.append($replyButtonsRowDiv1);}$replySection.append($replyButtonsRowDiv2);hasBeenFocused=focus;
if(focus&&!Spotfire.capabilities.supportsTouch()){setTimeout(function(){$replyTextField.focus();var textlength=$replyTextField.val().length;
$replyTextField[0].setSelectionRange(textlength,textlength);},0);}return $replySection;};var resize=function($list){$(".sf-element-title",$list).filter(function(i,v){return v.scrollHeight-1>v.clientHeight;
}).addClass("sf-show-read-more");};var createCommentThread=function(thread,expanded,replyText,repliesToHide,currentId,settings){var $thread;
var $item;var $startItem;$thread=$("<div class='sf-element sf-element-comment-thread'/>");var addReply=typeof settings.AddReply==="function"&&settings.AddReply();
$startItem=createCommentElement(thread.Start,true,thread.ReplyCount,settings,expanded?null:thread.LatestModified,0);
if(currentId&&thread.Start.Id===currentId){$startItem.addClass("sfpc-selected");}$startItem.appendTo($thread);
$thread.data("thread",thread);if(expanded||thread.AnySearchMatches){var cutoff=Math.max(thread.Replies.length-5,0);
if(typeof repliesToHide==="number"){cutoff=repliesToHide;}else{if(typeof repliesToHide==="boolean"&&repliesToHide){cutoff=0;
}}var i;var renderedReplies=0;for(i=0;i<thread.Replies.length;i++){if((expanded&&i>=cutoff)||thread.Replies[i].MatchesSearch){$item=createCommentElement(thread.Replies[i],false,thread.ReplyCount,settings,null,i+1);
$item.appendTo($thread);renderedReplies++;}if(currentId&&thread.Replies[i].Id===currentId){$item.addClass("sfpc-selected");
}}if(renderedReplies>0){$thread.addClass("sfc-comment-thread-with-replies");}$thread.addClass(expanded?"sfpc-expanded":"sfpc-collapsed");
if(expanded&&thread.Replies.length>renderedReplies){var viewMoreRepliesText=Spotfire.Utilities.formatString(Spotfire.Localization.resources.Comments_ViewMoreRepliesText,(thread.Replies.length-renderedReplies));
var $showMoreRepliesContainer=Spotfire.Flex.item({container:"horizontal","justify-content":"end"});var $showMoreReplies=Spotfire.Flex.item().attr("title",viewMoreRepliesText).addClass("sf-element sf-element-text-box sfc-show-more-replies");
$showMoreReplies.text(viewMoreRepliesText);$showMoreRepliesContainer.append($showMoreReplies);$startItem.after($showMoreRepliesContainer);
}if(addReply&&expanded){var $reply=createReplyElement(thread,settings,replyText,true);$reply.appendTo($thread);
}}return $thread;};var handleCommentEvents=function($handler,settings){var getTarget=function(ev){var targets=".sf-context-menu-button, .sf-element-comment-item, .sfc-read-more, .sf-element-comment-thread, .sfc-comments-reply-button, .sfc-comments-cancel-button, .replyStateButton, .sfc-show-more-replies";
if(settings.onExpandCollapse){targets+=", .sf-element-expand-collapse-button";}var $target=$(ev.target);
if($target.is("input, textarea")){return $();}if(!$target.is(targets)){$target=$target.closest(targets);
}return $target;};var handleClick=function(ev){var $target=getTarget(ev);if($target.length){if($target.is(".sfc-comments-reply-button, .replyStateButton, .sfc-comments-cancel-button")){return;
}var $item,$thread;var comment,thread;if($target.is(".sf-context-menu-button")){$item=$target.closest(".sf-element-comment-item");
comment=$item.data("comment");Spotfire.CommentsPanel.showDropDown($item,$target,comment);}else{if($target.is(".sf-element-comment-item")){comment=$target.data("comment");
if(comment.HasState){Spotfire.Dxp.Web.Forms.AjaxService.Modify(Spotfire.CommentsPanel.viewId,"ApplyComment",JSON.stringify({BookmarkId:comment.Id,value:-1}));
}}else{if($target.is(".sfc-read-more")){$item=$target.closest(".sf-element-comment-item");comment=$item.data("comment");
comment.ShowWholeText=true;$target.parent().closest(".sf-element-title").addClass("sf-read-all");settings.onShowMore(comment.ThreadId);
}else{if($target.is(".sf-element-expand-collapse-button")){if(settings.onExpandCollapse){thread=$target.closest(".sf-element-comment-thread").data("thread");
settings.onExpandCollapse(thread);}}else{if($target.is(".sfc-show-more-replies")){$thread=$target.closest(".sf-element-comment-thread");
thread=$thread.data("thread");if(settings.onShowMoreReplies){settings.onShowMoreReplies($thread,thread);
}}}}}}}};var handleDblClick=function(ev){var $target=getTarget(ev);if($target.length&&$target.is(".sf-element-comment-item")){var comment=$target.data("comment");
if(comment.HasState){settings.onClosePanel();}}};$handler.off("click.commentHandler").on("click.commentHandler",handleClick);
$handler.off("dblclick.commentHandler");if(settings.onClosePanel){$handler.on("dblclick.commentHandler",handleDblClick);
}$handler.off("contextmenu.commentHandler").on("contextmenu.commentHandler",function(e){e.preventDefault();
var position={top:e.pageY,left:e.pageX};var $item=$(e.target).closest(".sf-element-comment-item");if($item.length){var $button=$item.children(".sf-context-menu-button");
var comment=$item.data("comment");Spotfire.CommentsPanel.showDropDown($item,$button,comment,position);
}});};Spotfire.registerNameSpace("CommentThreadElement",{createCommentThread:createCommentThread,createReplyElement:createReplyElement,handleCommentEvents:handleCommentEvents,resize:resize});
});$(function(){Spotfire.registerNameSpace("Controls.Accordion");function builder($parent,showExpandIcon){var $accordion=Spotfire.Flex.item({container:"vertical","align-items":"stretch"}).addClass("sf-element-accordion").css("height","100%").appendTo($parent);
var $currentButton;var $currentContent;var onFinish;var addAccordionButton=function(header,description,additionalIconUrl,additionalIconDescription){var $button=Spotfire.Flex.item({container:"horizontal",shrink:false,"align-items":"center"}).addClass("sf-element-accordion-button").appendTo($accordion);
var $buttonTextPart=Spotfire.Flex.item({container:"vertical",grow:true}).appendTo($button);Spotfire.Flex.item().css("width","100%").addClass("sf-element-accordion-button-header").text(header).appendTo($buttonTextPart);
var updateDescription=$.noop;if(description){var $desc=Spotfire.Flex.item().css("width","100%").addClass("sf-element-accordion-button-description").appendTo($buttonTextPart);
updateDescription=function(description){$desc.text(description).attr("title",description);};updateDescription(description);
}var addIcon=function(iconUrl,iconDesc,className){var $iconDiv=Spotfire.Flex.item({shrink:false}).addClass(className).appendTo($button);
if(iconDesc!==undefined){$iconDiv.attr("title",iconDesc);}Spotfire.getSvg(iconUrl,function($svg){$svg.css("display","block").appendTo($iconDiv);
});return $iconDiv;};var showAdditionalIcon=$.noop;var hideAdditionalIcon=$.noop;if(additionalIconUrl!==undefined){var $additionalIcon=addIcon(additionalIconUrl,additionalIconDescription,"sf-element-additional-icon");
showAdditionalIcon=function(){$additionalIcon.show();};hideAdditionalIcon=function(){$additionalIcon.hide();
};}if(showExpandIcon){addIcon("Images/Data/DataAccessSettingsExpand.svg",undefined,"sf-element-expand-icon");
}return{content:$button,updateDescription:updateDescription,additionalIcon:{show:showAdditionalIcon,hide:hideAdditionalIcon}};
};var setCollapsed=function($button){$button.removeClass("sfpc-expanded");$button.addClass("sfpc-collapsed");
};var setExpanded=function($button){$button.removeClass("sfpc-collapsed");$button.addClass("sfpc-expanded");
};var expand=function($newButton,$newContent,onExpanded,delay){if($newButton===$currentButton){return;
}setCollapsed($currentButton);$currentButton=$newButton;setExpanded($currentButton);$currentContent.slideUp(delay);
$currentContent=$newContent;$currentContent.slideDown(delay,onExpanded);};var addSection=function(settings){var button=addAccordionButton(settings.header,settings.description,settings.additionalIconUrl,settings.additionalIconDescription);
var $buttonContent=button.content;var $content=Spotfire.Flex.item({container:"vertical",grow:true,"align-items":"stretch"}).css("height","100%").addClass("sf-element-accordion-content").appendTo($accordion);
if($currentButton===undefined){$currentButton=$buttonContent;$currentContent=$content;onFinish=settings.onExpanded;
}$buttonContent.on("click",function(){expand($buttonContent,$content,settings.onExpanded,100);});return{content:$content,updateDescription:button.updateDescription,additionalIcon:button.additionalIcon};
};var finish=function(){var $collapsedButtons=$(".sf-element-accordion-button",$accordion).not(":first");
var $collapsedContents=$(".sf-element-accordion-content",$accordion).not(":first");setCollapsed($collapsedButtons);
$collapsedContents.hide();if($currentButton!==undefined){setExpanded($currentButton);onFinish();}};return{addSection:addSection,finish:finish};
}Spotfire.Controls.Accordion.builder=builder;});$(function(){Spotfire.registerNameSpace("Controls.CustomExpressionEditor");
var getSettings=function(newSettings){var defaultSettings={InitialExpression:"",ProvideIntellisense:$.noop,ExpressionFont:null,ApplyAndClose:$.noop};
var properties=["InitialExpression","ProvideIntellisense","ExpressionFont","ApplyAndClose"];var i,name,value;
for(i=0;i<properties.length;i++){name=properties[i];value=newSettings[name];if(value!==undefined){defaultSettings[name]=value;
}}return defaultSettings;};var CustomExpressionEditor=function(settings){settings=getSettings(settings);
var useIntellisense=!Spotfire.capabilities.supportsTouch();if(!useIntellisense){settings.ProvideIntellisense=$.noop;
}var $textBox=$("<textarea/>").val(settings.InitialExpression);var $error=$("<p/>").addClass("error");
var editor={};var focus=function(){$textBox.focus();editor.focus();};var hintGeneration=0;var closeCompletion=function(){$(".CompletionHelpContainer").remove();
};var spotfireHint=function(hintEditor,callback,options){var $tooltip,$tooltipPointer,$tooltipText;var cursor=hintEditor.getCursor();
var query=hintEditor.getLine(cursor.line);hintGeneration++;var datas={expression:query,location:cursor.ch,line:cursor.line,generation:hintGeneration};
var $currentCompletion;var positionTooltip=function(event){if($currentCompletion){if(event){var $area=$(event.currentTarget);
var centerPoint=$currentCompletion.offset().top+$currentCompletion.outerHeight()/2;if(centerPoint<$area.position().top||centerPoint>$area.position().top+$area.outerHeight()){$tooltip.hide();
return;}}$tooltipPointer.css({top:($tooltip.outerHeight()-$tooltipPointer.outerHeight())/2});$tooltip.css({top:$currentCompletion.offset().top-($tooltip.outerHeight()-$currentCompletion.outerHeight())/2,left:$currentCompletion.offset().left+$currentCompletion.outerWidth()+10});
$tooltip.show();}};var selectCompletion=function(completion,elem){if(completion.tooltip){if(!$tooltip){$tooltip=$("<div/>").addClass("CompletionHelpContainer").appendTo(document.body);
$tooltipPointer=$("<div/>").addClass("CompletionHelpPointer").appendTo($tooltip);$tooltipText=$("<div/>").addClass("CompletionHelp").appendTo($tooltip);
}$currentCompletion=$(elem);$tooltipText.text(completion.tooltip);positionTooltip();}else{if($tooltip){$tooltip.hide();
}}};options.onScroll=_.throttle(positionTooltip,50);var handleHintResult=function(result){if(result.valid&&result.generation===hintGeneration){var suggestions=[];
var pre=result.expression.substring(0,result.location);if(result.partialWord){pre=pre.substring(0,pre.length-result.partialWord.length);
}var i;for(i=0;i<result.result.length;++i){suggestions[i]={text:result.result[i],tooltip:result.tooltips[i]};
}var toChar=pre.length+result.partialWord.length;var post=result.expression.substring(result.location);
var endBracketPos=post.indexOf("]");if(result.inColumn&&endBracketPos!==-1&&(post.indexOf("[")===-1||endBracketPos<post.indexOf("["))){toChar=result.location+endBracketPos;
}else{var re=/^\w+/;var matches=post.match(re);if(matches!==null&&matches.length===1){toChar=result.location+matches[0].length;
}}var resultOb={list:suggestions,from:{line:result.line,ch:pre.length},to:{line:result.line,ch:toChar}};
CodeMirror.on(resultOb,"select",selectCompletion);CodeMirror.on(resultOb,"close",closeCompletion);callback(resultOb);
}else{$error.text(result.message);}};settings.ProvideIntellisense(datas,handleHintResult);};spotfireHint.async=true;
var $hintContainer=$("<div></div>");var onOpen=function(){$hintContainer.addClass("sf-element-dialog");
$(document.body).append($hintContainer);var autocompleteSpotfire=function(cm){cm.showHint({completeSingle:false,hint:spotfireHint,container:$hintContainer.get()[0]});
};editor=CodeMirror.fromTextArea($textBox[0],{mode:"spotfire",theme:"spotfire",autofocus:"true",scrollbarStyle:null,matchBrackets:true,autoCloseBrackets:true,extraKeys:{"Ctrl-Space":autocompleteSpotfire,"Ctrl-Enter":settings.ApplyAndClose},lineWrapping:true});
if(settings.ExpressionFont){$(".CustomExpressionDialog .cm-s-spotfire").css(settings.ExpressionFont);
$hintContainer.css(settings.ExpressionFont);}editor.on("inputRead",function(cm,object){autocompleteSpotfire(cm);
});focus();editor.execCommand("goDocEnd");};var onClose=function(){$hintContainer.remove();closeCompletion();
};var getExpression=function(){return editor.getValue();};$textBox.click(focus);this.TextBox=$textBox;
this.Error=$error;this.GetExpression=getExpression;this.OnOpen=onOpen;this.OnClose=onClose;this.Focus=focus;
this.HasFocus=function(){return editor&&editor.state.focused;};};Spotfire.Controls.CustomExpressionEditor.create=function(settings){var editor=new CustomExpressionEditor(settings);
return editor;};Spotfire.Controls.CustomExpressionEditor.setStyle=function(style){var $style=$("#codemirrorStyle");
$style.remove();var stylesheet=".CustomExpressionDialog .sf-dataoverview-expressioncontainer { background-color: "+style.syntaxHighlightBackgroundColor+" ; }\r\n.cm-s-spotfire div.CodeMirror-cursor { border-color: "+style.syntaxHighlightCursorColor+"; }\r\n.cm-s-spotfire span.cm-number { color: "+style.syntaxHighlightNumberColor+";}\r\n.cm-s-spotfire span.cm-string { color: "+style.syntaxHighlightStringColor+";}\r\n.cm-s-spotfire span.cm-def { color: "+style.syntaxHighlightDefColor+";}\r\n.cm-s-spotfire span.cm-operator { color: "+style.syntaxHighlightOperatorColor+";}\r\n.cm-s-spotfire span.cm-keyword { color: "+style.syntaxHighlightKeywordColor+";}\r\n.cm-s-spotfire .CodeMirror-matchingbracket {background-color:"+style.syntaxHighlightMatchingbracketBackgroundColor+"!important; color:"+style.syntaxHighlightMatchingbracketColor+" !important; }\r\n.cm-s-spotfire .CodeMirror-nonmatchingbracket {background-color:"+style.syntaxHighlightNonmatchingbracketBackgroundcolor+"!important; color:"+style.syntaxHighlightNonmatchingbracketColor+" !important; }\r\n";
$("<style/>").attr("id","codemirrorStyle").text(stylesheet).appendTo(document.body);};});$(function(){Spotfire.registerNameSpace("Controls.ExpandingTextarea");
Spotfire.Controls.ExpandingTextarea.initialize=function($textAreaContainer,settings){var options,$text,$mirrorText,defaultSettings;
defaultSettings={content:"",placeholder:"",editAllowed:true,click:$.noop,styleSettings:{},textChange:$.noop,classes:""};
options=$.extend({},defaultSettings,settings);$textAreaContainer.empty().addClass("expanding-textarea");
$text=$("<textarea>").addClass("expanding-textarea__text "+options.classes).css(options.styleSettings).val(options.content).attr("placeholder",options.placeholder);
$mirrorText=$("<span>").text(options.content===""?options.placeholder:options.content);$textAreaContainer.append($("<pre>").addClass("expanding-textarea__mirror "+options.classes).css(options.styleSettings).append($mirrorText).append($("<br>").addClass("expanding-textarea__newline-fix")).append($("<br>"))).append($("<div>").addClass("expanding-textarea__text-wrapper").append($text));
if(options.editAllowed){$text.click(options.click);$text.on("input",function(){$mirrorText.text($text.val()===""?options.placeholder:$text.val());
options.textChange($text.val());});$text.on("sf-touchmousedown",function(e){if($textAreaContainer.hasClass("edit")){e.stopPropagation();
}});}else{$text.attr("readonly",true);}return $textAreaContainer;};});$(function(){Spotfire.registerNameSpace("Controls.InputField");
Spotfire.Controls.InputField.handleDraggable=function($input){$input.on("focus",function(){var $inputRef=$(this);
var $draggableParents=$inputRef.parents("[draggable='true']");if($draggableParents.length>0){var onParentsMouseDown;
$draggableParents.attr("draggable",false);var enableParents=function(){$draggableParents.attr("draggable",true);
$inputRef.off("blur",enableParents);$draggableParents.off("mousedown",onParentsMouseDown);$draggableParents=null;
};onParentsMouseDown=function(e){if(!$inputRef.is(e.target)){enableParents();}};$inputRef.on("blur",enableParents);
$draggableParents.on("mousedown",onParentsMouseDown);}$inputRef.select();});};Spotfire.Controls.InputField.initialize=function($input,emptyText,callback){return Spotfire.Controls.InputField.initializeWithTimeout($input,emptyText,callback,Spotfire.isProfessional()?300:undefined);
};Spotfire.Controls.InputField.initializeWithTimeout=function($input,emptyText,callback,callbackTimeout){var lastSubmittedValue=$input.val();
var timer;$input.addClass("sf-input-with-placeholder").prop("placeholder",emptyText);var submit=function(){var currentValue=$input.val();
if(currentValue!==lastSubmittedValue){callback(currentValue);lastSubmittedValue=currentValue;}};var onBlur=function(e){submit();
_.defer(function(){var $clone=$input.clone(true,true).insertAfter($input);$input.remove();$input=$clone;
});};var onKeyPress=function(e){if(e.which===13){submit();}};var onTimer=function(){submit();};var onInput=function(){if(callbackTimeout===undefined){return;
}if(callbackTimeout===0){submit();}else{if(timer){clearTimeout(timer);}timer=setTimeout(onTimer,callbackTimeout);
}};var update=function(value){var shouldUpdate=$input.val()!==value&&!$input.is(document.activeElement);
if(shouldUpdate){$input.val(value);lastSubmittedValue=value;}};var element=function(){return $input;};
$input.on("keypress",onKeyPress);$input.on("blur",onBlur);$input.on("input",onInput);Spotfire.Controls.InputField.handleDraggable($input);
$input.on("focus",function(){$(this).addClass("Focus");});$input.on("blur",function(){$(this).removeClass("Focus");
});return{submit:submit,update:update,element:element};};});$(function(){Spotfire.registerNameSpace("Controls");
Spotfire.Controls.intSpinner=function(){var changeTimer;var options={};var onChange=$.noop;var $inputElement=$("<input/>");
var spinner;var instance;var defaultValue=0;var mostRecentValidValue=defaultValue;var setValue=function(value){if(changeTimer&&$inputElement.is(":focus")){return;
}spinner.spinner("value",value);};var getValue=function(){return spinner.spinner("value");};var isValidValue=function(value){var min=spinner.spinner("option","min");
var max=spinner.spinner("option","max");if(value===null||value===undefined){return false;}if(!value.toString().match(/^[\-]?[0-9]+$/)){return false;
}if(value<min||value>max){return false;}return true;};var updateValidityIndication=function(){var valueString=$inputElement.val();
var isValidString=isValidValue(valueString);$inputElement.css({color:isValidString?"":"red"});};var spinnerChanged=function(){var value=getValue();
var isValid=isValidValue(value);if(isValid){mostRecentValidValue=value;onChange();if(changeTimer){clearTimeout(changeTimer);
}changeTimer=setTimeout(function(){changeTimer=null;},1000);}updateValidityIndication();};var settings=$.extend({},options,{start:function(event){if(event.originalEvent.type==="keydown"){switch(event.which){case $.ui.keyCode.PAGE_UP:case $.ui.keyCode.PAGE_DOWN:case $.ui.keyCode.UP:case $.ui.keyCode.DOWN:case $.ui.keyCode.ENTER:return true;
}return false;}return true;},change:spinnerChanged,stop:spinnerChanged,min:0,max:999});var getSetOption=function(name,val){if(val===undefined){return spinner.spinner("option",name);
}spinner.spinner("option",name,val);return instance;};$("<div/>").append($inputElement);spinner=$inputElement.spinner(settings);
$inputElement.width(20);$inputElement.on("keyup",updateValidityIndication);instance={value:function(val){if(val===undefined){return mostRecentValidValue;
}setValue(val);return instance;},element:function(){return $inputElement.parents(".ui-spinner").eq(0);
},onChange:function(callback){onChange=callback;return instance;},min:function(val){return getSetOption("min",val);
},max:function(val){return getSetOption("max",val);}};instance.value(defaultValue);return instance;};
});$(function(){Spotfire.registerNameSpace("Controls.ListBox");var ACTION_NONE="none";var ACTION_ADD="add";
var ACTION_REPLACE="replace";var ACTION_REMOVE="remove";var DIV_MAXHEIGHT=1000000;var EMPTY_TEXT="...";
var appendSvgTo=function(icon,path){Spotfire.getSvg(path,function($svg){icon.empty().append($svg);});
};var stickyGuid=Spotfire.newFakeGuid();function ListBox(viewId,listBoxId,tooltip,settings,onRightClick){this.id=listBoxId;
var title=settings.title;var searchFieldSettings=settings.searchField;var allowMultiSelect=settings.allowMultiSelect;
var allowDragItem=settings.allowDragItem;var allowListCollapse=settings.allowListCollapse;var filterPopoutId=settings.filterPopoutId;
var generation=0;var selectAction=ACTION_NONE;var currentMarkItem=-1;var anchorMarkItem=-1;var collapsed;
var collapseText;var showHorizontalBorders;var itemsClientHeight;var itemHeight;var itemCount;var visibleItemCount;
var renderItemCount;var items;var selection;var selectedItems;var lastRequestId=0;var pendingServerSelection=null;
var ignorePendingServerSelection=false;var activeItem=null;var scrollTimer;var scrollDelay=0;var isMaxScroll=false;
var margins=new Margins(0,0,0,0);var allowedCategoriesForDrop=[];var searchInputFieldPadding=new Margins(5,1,20,1);
var layout={};var onMouseUpForAddToSelectionClick;var selectionRange;layout.itemHeight=25;layout.listItemPadding=new Margins(0,5,7,1);
var listBox=$("<div></div>").attr("id",listBoxId).addClass("ListBox sf-element sf-element-data-panel-list");
var viewport=$("<div></div>").addClass("Viewport sf-element sf-element-data-panel-list-content");var scrollableDiv=$("<div></div>").addClass("Scrollable");
var itemsDiv=$("<div></div>").addClass("ListItems");var clearSelectionsDiv=$("<div />").addClass("ClearSelections").html(Spotfire.Localization.resources.DataPanel_ClearSelections);
var block=function(){var $cssParent=listBox.closest(".sf-element-document");if($cssParent.length===0){$cssParent=$(".RecommendationsDialog");
}var dimColor=$cssParent.css("background-color");ProgressBlocker.block(viewport,{bgColor:dimColor,bgOpacity:0.5,delay:1000});
};var unblock=function(){ProgressBlocker.unblock(viewport);};this.block=block;this.unblock=unblock;listBox.data("parent",this);
if(title!==undefined&&title.length>0){var titleDiv=$("<div></div>").addClass("TitleBar sf-element sf-element-data-panel-list-header");
var titleTextDiv=$("<span></span>").addClass("Title sf-element sf-element-title");titleTextDiv.text(title);
titleDiv.append(titleTextDiv);if(allowListCollapse){var expandCollapseIcon=$("<div/>").addClass("ExpandCollapseIcon sf-element sf-element-button");
expandCollapseIcon.click(function(){var args={elementId:listBoxId};Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,"ToggleListCollapse",JSON.stringify(args));
});var collapseTextDiv=$("<span></span>").addClass("CollapseText sf-element sf-element-text-box");collapseTextDiv.mouseover(function(){tooltip.hide();
var tooltipArgs={elementId:listBoxId,generation:generation,type:"CollapseText"};tooltip.show(tooltipArgs);
});titleDiv.append(collapseTextDiv);titleDiv.append(expandCollapseIcon);}listBox.append(titleDiv);}var $searchField;
var $searchImage;var $searchInput;var searchInput;var searchFieldHeight=0;var invokeRightClick;if(searchFieldSettings!==undefined){var searchFieldCallback=function(expression){if(searchFieldSettings.onChanged!==undefined){searchFieldSettings.onChanged(expression);
}var args={expression:expression};_.debounce(function(){Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,"SearchExpression",JSON.stringify(args),stickyGuid);
},500)();block();};var onMouseDownSearchField=function(e){if(e.originalEvent.spMouseDownHandled){return;
}if(Spotfire.Touch.rightMouseButtonDown(e)){e.originalEvent.spMouseDownHandled=true;invokeRightClick(e.clientX,e.clientY,{isSearchFieldClick:true});
}};$searchInput=$("<input class='sf-element sf-element-input' type='text'/>");$searchField=$("<div/>").attr("id",searchFieldSettings.id).addClass("SearchField sf-element sf-element-search-field");
$searchImage=$("<div/>").addClass("ListBoxMagnifier");$searchField.append($searchImage);$searchField.append($searchInput);
$searchInput.val(searchFieldSettings.searchText);$searchField.on("mouseenter",function(){$searchImage.addClass("Hover");
});$searchField.on("mouseleave",function(){$searchImage.removeClass("Hover");});$searchField.on("mousedown",onMouseDownSearchField);
searchInput=Spotfire.Controls.InputField.initialize($searchInput,Spotfire.Localization.resources.DataPanelEmptySearchText,searchFieldCallback);
$searchInput.on("blur",function(){stickyGuid=Spotfire.newFakeGuid();_.defer(function(){if(selectionRange!==undefined){searchInput.element()[0].setSelectionRange(selectionRange.low,selectionRange.high);
}selectionRange=undefined;});});searchFieldHeight=25+6+1;listBox.append($searchField);$searchImage.on("click",function(){searchInput.submit();
});}listBox.append(viewport);viewport.append(scrollableDiv);scrollableDiv.append(itemsDiv);var scrollIfNeeded=function(e){var distanceToContainerBottom=viewport.offset().top+viewport.height()-e.pageY;
var distanceToContainerTop=e.pageY-viewport.offset().top;if(distanceToContainerBottom<25){viewport.scrollTop(viewport.scrollTop()+10);
}else{if(distanceToContainerTop<25){viewport.scrollTop(viewport.scrollTop()-10);}}};Spotfire.DragDrop.makeDroppable(viewport,{onDragEnter:function(e){e.preventDefault();
scrollIfNeeded(e);},onDragOver:function(e){e.preventDefault();scrollIfNeeded(e);},onDrop:function(e){e.preventDefault();
},onDragLeave:function(e){e.preventDefault();}});listBox.append(clearSelectionsDiv);clearSelectionsDiv.on("click",function(){var args={elementId:listBoxId,generation:generation,operation:ACTION_REPLACE,from:-1,to:-1,requestId:++lastRequestId};
Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,"Select",JSON.stringify(args));});var getTitleHeight=function(){return title!==undefined?$(".TitleBar",listBox).outerHeight(true):0;
};var getNonItemHeight=function(){return getTitleHeight()+searchFieldHeight+margins.vertical();};var setSize=function(div,width,height){div.css({width:Math.max(0,width)+"px",height:Math.max(0,height)+"px"});
};var getTextWidth=function(textDiv){if(textDiv.length===0){return 0;}var measureDiv=$("<div style='position: absolute; visibility: hidden;'></div>");
measureDiv.css({fontSize:textDiv.css("fontSize"),fontWeight:textDiv.css("fontWeight"),fontFamily:textDiv.css("fontFamily")});
$(document.body).append(measureDiv);var text=textDiv.text();measureDiv.text(text);var textWidth=measureDiv.width();
measureDiv.remove();return textWidth;};var styledScrollbar;var performLayout=function(){var itemsHeight=collapsed?0:itemsClientHeight;
var listBoxHeight=itemsHeight+getTitleHeight()+searchFieldHeight;setSize(listBox,listBox.parent().width()-margins.horizontal(),listBoxHeight);
listBox.css("margin",margins.toCss());if(showHorizontalBorders){viewport.addClass("sfc-other-list");}else{viewport.addClass("sfc-column-list");
}if($searchField){var searchFieldWidth=$searchField.width();searchInput.element().width(searchFieldWidth-searchInputFieldPadding.horizontal());
$searchImage.empty().attr("style","");Spotfire.Filters.StyledFilters.createMagnifierGlass($searchImage);
}if(allowListCollapse){listBox.attr("CollapseState",collapsed?"collapsed":"expanded");viewport.toggleClass("Collapsed",collapsed);
var collapseMargin=14;var iconDiv=$(".ExpandCollapseIcon",listBox);var textDiv=$(".CollapseText",listBox);
appendSvgTo(iconDiv,collapsed?"Images/Data/smallarrowup.svg":"Images/Data/smallarrowdown.svg");textDiv.css("visiblity",collapsed?"inherit":"hidden");
textDiv.text(collapsed?collapseText:"");var titleWidth=getTextWidth($(".Title",listBox));var collapseTextPosition=titleWidth+collapseMargin;
var iconPosition=iconDiv.position().left;$(".Title",listBox).width(titleWidth);textDiv.css({left:collapseTextPosition+"px",width:((iconPosition-collapseMargin)-collapseTextPosition)+"px"});
}var lastItemBorderVisible=showHorizontalBorders;setSize(viewport,listBox.width(),itemsHeight-(lastItemBorderVisible?1:0)-(clearSelectionsDiv.is(":visible")?clearSelectionsDiv.outerHeight():0));
var scrollBarWidth=10;var scrollAreaWidth=Math.max(0,viewport.width()-((itemCount*itemHeight>itemsClientHeight)&&!Spotfire.capabilities.supportsTouch()?scrollBarWidth+3:0));
setSize(scrollableDiv,scrollAreaWidth,(isMaxScroll?DIV_MAXHEIGHT:itemCount*itemHeight-(lastItemBorderVisible?1:0)));
if(!styledScrollbar&&!collapsed){var cssClass=showHorizontalBorders?"ListBoxScroll":"ListBoxScrollNoBorder";
styledScrollbar=viewport.StyledScrollbar({allowResize:true,cssClass:cssClass,width:scrollBarWidth,lineSize:function(){return itemHeight;
}});}if(!allowListCollapse||!collapsed){viewport.StyledScrollbar("refresh");}else{viewport.StyledScrollbar("close");
styledScrollbar=null;}};var updateServerSelection=function(from,to,operation){var args={elementId:listBoxId,generation:generation,operation:operation,from:from,to:to,requestId:++lastRequestId};
Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,"Select",JSON.stringify(args));};var sendPendingServerSelection=function(){if(pendingServerSelection!==null){updateServerSelection(pendingServerSelection.from,pendingServerSelection.to,pendingServerSelection.operation);
}};var setScrollPosition=function(pos){viewport.scrollTop(pos);};var getNormalizedScroll=function(){return viewport.scrollTop()/(scrollableDiv.height()-viewport.height());
};var getScrollPosition=function(){return viewport.scrollTop();};var addDragAndDropIfEnabled=function(itemDiv,hasValue,item){var getAllowedCategoriesForDropCallback=function(result){if(result&&result.allowedCategories.length>0){allowedCategoriesForDrop=result.allowedCategories;
}};var dropIsAllowed=function(e){var allowDrop=allowedCategoriesForDrop.length>0&&allowedCategoriesForDrop.indexOf(item.Category)>-1;
if(allowDrop){e.preventDefault();}return allowDrop;};if(Spotfire.isAuthorMode()&&allowDragItem){Spotfire.DragDrop.removeDraggable(itemDiv);
if(hasValue&&item.hasOwnProperty("QualifiedColumnName")){Spotfire.DragDrop.makeDraggable(itemDiv,{effectAllowed:"copy",abortOnModifierKeys:true,populateData:function(data){if(!item.Selected||settings.addToSelectionOnClick){data.columnNames=[];
data.columnNames.push(item.QualifiedColumnName);}else{data.columnNames=[];$.each(selectedItems.data,function(i,d){data.columnNames.push(d);
});}$(document).triggerHandler("sf-onListBoxDragStart");ignorePendingServerSelection=item.Selected&&!settings.addToSelectionOnClick;
tooltip.hide();var args={data:data};Spotfire.Dxp.Web.Forms.AjaxService.Read(viewId,"GetAllowedCategoriesForDrop",JSON.stringify(args),getAllowedCategoriesForDropCallback);
itemDiv.addClass("divBeingDragged");return data.columnNames.length;},dragInProgressClass:function(){return !settings.addToSelectionOnClick?"sfpc-highlight-axis-trays":undefined;
},dragEnd:function(){if(viewport.find(".divBeingDragged").length){viewport.remove(".divBeingDragged");
}itemDiv.removeClass("divBeingDragged");allowedCategoriesForDrop=[];if(!settings.addToSelectionOnClick){$(document.body).mouseup();
}else{$(document.body).unbind("mouseup",onMouseUpForAddToSelectionClick);}}});if(!settings.addToSelectionOnClick){itemDiv.addClass("ShowDragCursor");
}}else{Spotfire.DragDrop.makeDroppable(itemDiv,{onDragEnter:function(e){e.preventDefault();scrollIfNeeded(e);
},onDragOver:function(e){e.preventDefault();scrollIfNeeded(e);if(dropIsAllowed(e)){itemDiv.children(".ListItemContent").addClass("sfpc-dragover");
}},onDrop:function(e,data){e.preventDefault();var args={data:data,category:item.Category};Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,"OnDrop",JSON.stringify(args));
itemDiv.children(".ListItemContent").removeClass("sfpc-dragover");},onDragLeave:function(e){e.preventDefault();
itemDiv.children(".ListItemContent").removeClass("sfpc-dragover");}});}}};var getTopIndex=function(){if(isMaxScroll){return Math.max(0,Math.floor(getNormalizedScroll()*itemCount)-visibleItemCount);
}return Math.floor(getScrollPosition()/itemHeight);};var getTopIndexWithScrollOffset=function(){return Math.max(getTopIndex()-Math.floor((renderItemCount-visibleItemCount)/2),0);
};var getDefinedValue=function(value,defaultValue){if(value!==undefined){return value;}return defaultValue;
};var getItemIndex=function(y){var offsetY=y-viewport.offset().top;if(isMaxScroll){return getTopIndex()+Math.floor(offsetY/itemHeight);
}return Math.floor((offsetY+getScrollPosition())/itemHeight);};var isHeaderItem=function(index){var isHeader=false;
if(items[index]!==undefined){isHeader=items[index].IsHeader;}return isHeader;};var isSelectableItem=function(index){var isSelectable=false;
if(items[index]!==undefined){isSelectable=items[index].IsSelectable;}return isSelectable;};var isSelected=function(index){var selected=false;
if(items[index]!==undefined){selected=items[index].Selected;if(viewport.find(".divBeingDragged").length){return selected;
}}if(selection[index]!==undefined){selected=selection[index];}if(selectAction!==ACTION_NONE){var low=Math.min(anchorMarkItem,currentMarkItem);
var high=Math.max(anchorMarkItem,currentMarkItem);if(index>=low&&index<=high){return selectAction!==ACTION_REMOVE;
}return selected&&selectAction!==ACTION_REPLACE;}return selected;};var updateSelectState=function(e,itemIndex){if(anchorMarkItem===-1){anchorMarkItem=itemIndex;
}if((allowMultiSelect&&e.shiftKey)&&!settings.addToSelectionOnClick){if(e.ctrlKey||e.metaKey){selectAction=ACTION_ADD;
}else{selectAction=ACTION_REPLACE;}currentMarkItem=itemIndex;}else{if(allowMultiSelect&&((e.ctrlKey||e.metaKey)||settings.addToSelectionOnClick)){selectAction=isSelected(itemIndex)?ACTION_REMOVE:ACTION_ADD;
anchorMarkItem=itemIndex;currentMarkItem=itemIndex;}else{selectAction=ACTION_REPLACE;anchorMarkItem=itemIndex;
currentMarkItem=itemIndex;}}};var updateItemDivSelection=function(itemDiv,selected){$(".ListItemContent",itemDiv).toggleClass("SelectedListItem",selected);
$(".ListItemContent",itemDiv).toggleClass("sfpc-selected",selected);};var refreshSelection=function(){var topIndex=getTopIndexWithScrollOffset();
$(".ListItem",itemsDiv).each(function(i,elem){var itemDiv=$(elem);var index=i+topIndex;var hasValue=items[index]!==undefined;
if(hasValue){var selected=isSelected(index);var isSelectable=isSelectableItem(index);updateItemDivSelection(itemDiv,selected&&isSelectable);
}});};var selectItem=function(itemIndex){selection={};selection[itemIndex]=true;refreshSelection();anchorMarkItem=itemIndex;
pendingServerSelection={from:itemIndex,to:itemIndex,operation:ACTION_REPLACE};};var selectItems=function(fromIndex,toIndex){var low=Math.min(fromIndex,toIndex);
var high=Math.max(fromIndex,toIndex);var i;var newSelection={};for(i=0;i<itemCount;i++){if(i>=low&&i<=high){newSelection[i]=selectAction!==ACTION_REMOVE;
}else{if(selectAction===ACTION_ADD||selectAction===ACTION_REMOVE){newSelection[i]=isSelected(i);}}}selection=newSelection;
refreshSelection();};var updateSelection=function(e,itemIndex){var ignoreUpdateSelection=isSelected(itemIndex)&&selectAction!==ACTION_REMOVE&&!settings.addToSelectionOnClick;
updateSelectState(e,itemIndex);if(allowMultiSelect){pendingServerSelection={from:anchorMarkItem,to:currentMarkItem,operation:selectAction};
if(ignoreUpdateSelection){return;}if(anchorMarkItem===currentMarkItem&&selectAction===ACTION_NONE){selectItem(itemIndex);
}else{selectItems(anchorMarkItem,currentMarkItem);}}else{pendingServerSelection={from:itemIndex,to:itemIndex,operation:ACTION_REPLACE};
if(!ignoreUpdateSelection){selectItem(itemIndex);}}selectAction=ACTION_NONE;};var toggleItemExpansion=function(y){var itemIndex=getItemIndex(y);
var args={elementId:listBoxId,generation:generation,itemIndex:itemIndex};Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,"ToggleListItemCollapse",JSON.stringify(args));
};var createListItem=function(){var $listItem;$listItem=$("<div></div>").addClass("ListItem");var itemContentDiv=$("<div></div>").addClass("ListItemContent sf-element");
var itemIcon=$("<div/>").addClass("ListItemIcon sf-element sf-element-expand-collapse-button");itemIcon.css("visibility","hidden");
var itemIcon2=$("<div/>").addClass("ListItemIcon2 sf-element sf-element-icon");itemIcon2.css("display","none");
var itemText=$("<div></div>").addClass("ListItemText sf-element sf-element-text-box");var filterButton=$("<div/>").addClass("ListItemButton sf-element sf-element-button").attr("title",Spotfire.Localization.resources.DataPanel_ShowFilterTooltip);
Spotfire.getSvg("Images/Data/filter.svg",function($svg){filterButton.append($svg);});$listItem.append(itemContentDiv);
itemContentDiv.append(itemIcon);itemContentDiv.append(itemIcon2);itemContentDiv.append(itemText);itemContentDiv.append(filterButton);
return $listItem;};var listItemToClone;Spotfire.getSvg("Images/Data/filter.svg",function(){listItemToClone=createListItem().get(0);
});var cloneListItem=function(){var $listItem;if(listItemToClone!==undefined){$listItem=$(listItemToClone.cloneNode(true));
}else{$listItem=createListItem();}return $listItem;};var refresh=function(){var i;var topIndex=getTopIndexWithScrollOffset();
var newItemsDiv=$("<div/>").addClass("ListItems");var scrollPosition=getScrollPosition();var remainder=isMaxScroll?0:Math.floor(scrollPosition%itemHeight);
var overlappingItems=Math.max(0,getTopIndex()-Math.max(getTopIndex()-Math.floor((renderItemCount-visibleItemCount)/2),0));
var newScrollPosition=scrollPosition-remainder-overlappingItems*itemHeight;newItemsDiv.css("top",(newScrollPosition<0?0:newScrollPosition)+"px");
var scrollAreaWidth=viewport.width();var toggleItemExpansionfunction=function(e){toggleItemExpansion(e.pageY);
};var top=0;var $previousItemDiv=null;var itemDiv;var itemContentDiv;var itemIcon;var itemIcon2;var itemText;
var filterButton;var index;var item;var hasValue;var itemIconWidth=21;var itemIconRightMargin=7;var indentSteps;
var indentPx;var text;var selected;var isSelectable;var isExpanded;var hasButton;var hasIcon;var isHeader;
var buttonWidth;var itemIcon2Width;var appendCategorySvg=function(icon,category){appendSvgTo(icon,"Images/Data/"+category+".svg");
};for(i=0;i<renderItemCount;i++){itemDiv=cloneListItem();itemContentDiv=itemDiv.children(".ListItemContent");
itemIcon=itemContentDiv.children(".ListItemIcon");itemIcon2=itemContentDiv.children(".ListItemIcon2");
itemText=itemContentDiv.children(".ListItemText");filterButton=itemContentDiv.children(".ListItemButton");
filterButton.mousemove(tooltip.hide);itemDiv.css("top",top+"px");index=i+topIndex;item=items[index];hasValue=item!==undefined;
indentSteps=hasValue?getDefinedValue(item.IndentSteps,0):0;indentPx=Math.max(0,(itemIconWidth*indentSteps)-itemIconRightMargin);
itemContentDiv.css("padding-left",indentPx+"px");text=hasValue?item.Text:EMPTY_TEXT;itemText.text(text);
if(item!==undefined&&item.IsBold===true){itemText.addClass("sf-element-data-panel-hierarchy-found-text");
}selected=hasValue?isSelected(index):false;isSelectable=hasValue?isSelectableItem(index):false;if(selected&&isSelectable){updateItemDivSelection(itemDiv,selected&&isSelectable);
}isExpanded=hasValue?item.IsExpanded:undefined;if(isExpanded!==undefined){itemIcon.css("visibility","visible");
$(".ListItemContent",$previousItemDiv).addClass("Last");if(item.IsHierarchy){if(isExpanded){appendSvgTo(itemIcon,"Images/Data/hierarchyexpanded.svg");
}else{appendSvgTo(itemIcon,"Images/Data/hierarchycollapsed.svg");}}else{if(isExpanded){appendSvgTo(itemIcon,"Images/Data/expanded.svg");
}else{appendSvgTo(itemIcon,"Images/Data/collapsed.svg");}}}if(hasValue&&item.IsAlwaysExpanded){itemIcon.hide();
}hasButton=hasValue&&item.FilterData!==undefined&&settings.showFilters;if(hasButton){filterButton.data("FilterData",item.FilterData);
if(!item.FilterData.enabled){filterButton.attr("title",item.FilterData.tooltip).addClass("disabled sfpc-disabled");
}}else{filterButton.css("display","none");}hasIcon=hasValue&&item.Category!==undefined;if(hasIcon){itemIcon2.css("display","block");
appendCategorySvg(itemIcon2,item.Category);}isHeader=hasValue?isHeaderItem(index):false;if(hasValue){itemContentDiv.addClass(isHeader?"sf-element-data-panel-list-header-item":"sf-element-data-panel-list-item");
if(!isHeader){if(item.First){itemContentDiv.addClass("sfpc-first");}if(item.Last){itemContentDiv.addClass("sfpc-last");
}}}if(isHeader){itemContentDiv.on("click",toggleItemExpansionfunction);}else{if(isExpanded!==undefined){itemIcon.on("click",toggleItemExpansionfunction);
}}if(isHeader){itemText.addClass("HeaderListItemText");itemContentDiv.addClass("ListItemHeaderContent");
itemIcon2Width=hasIcon?14+5-2:0;}else{itemIcon2Width=hasIcon?14+5:0;}setSize(itemDiv,scrollAreaWidth,itemHeight);
setSize(itemContentDiv,scrollAreaWidth,itemHeight);buttonWidth=28+1-layout.listItemPadding.right;itemText.css("width",(scrollAreaWidth-itemIconWidth-itemIcon2Width-layout.listItemPadding.horizontal()-indentPx-(hasButton?buttonWidth:0)+"px"));
addDragAndDropIfEnabled(itemDiv,hasValue,item);newItemsDiv.append(itemDiv);top=top+itemHeight;if(hasValue){$previousItemDiv=itemDiv;
}}$(".ListItemContent",$previousItemDiv).addClass("Last");if(filterPopoutId){newItemsDiv.on("click",".ListItemButton",function(){tooltip.hide();
var filterData=$(this).data("FilterData");if(filterData.enabled){Spotfire.Filters.FilterPopout.showPoppedFilter(filterPopoutId,{data:filterData,$element:$(this),$scrollParent:viewport});
}});}itemsDiv.before(newItemsDiv);var draggedDivSavedFromRefresh=itemsDiv.find(".divBeingDragged");if(draggedDivSavedFromRefresh.length){draggedDivSavedFromRefresh.hide();
viewport.append(draggedDivSavedFromRefresh);}itemsDiv.remove();itemsDiv=newItemsDiv;};var fetchData=function(requestId){var getVisibleValuesCallback=function(result){unblock();
if(requestId===lastRequestId){selection={};}selectedItems=result.selectedItems;var i;for(i=0;i<result.Items.length;
i++){items[i+result.TopIndex]=result.Items[i];}if(settings.addToSelectionOnClick){clearSelectionsDiv.toggle(result.selectedItemsCount>0);
}performLayout();refresh();};var low=Math.max(getTopIndex()-Math.floor((renderItemCount-visibleItemCount)/2),0);
var high=Math.min(itemCount-1,low+renderItemCount);var args={elementId:listBoxId,generation:generation,low:low,high:high};
Spotfire.Dxp.Web.Forms.AjaxService.Read(viewId,"GetVisibleItems",JSON.stringify(args),getVisibleValuesCallback);
};invokeRightClick=function(x,y,params){if(!settings.showContextMenus){return;}if(params===undefined||params===null){params={};
}var isItemClick=params.isItemClick===undefined?false:params.isItemClick;var isSearchFieldClick=params.isSearchFieldClick===undefined?false:params.isSearchFieldClick;
var itemIndex=params.itemIndex===undefined?-1:params.itemIndex;var selected=params.selected===undefined?false:params.selected;
var type=isItemClick?"ListItem":"";var args={generation:generation,type:type,x:x,y:y,itemIndex:itemIndex,isSelected:selected};
if(isSearchFieldClick&&searchFieldSettings!==undefined){selectionRange=new Range(searchInput.element()[0].selectionStart,searchInput.element()[0].selectionEnd);
var searchFieldArgs={elementId:searchFieldSettings.id,text:searchInput.element().val(),low:selectionRange.low,high:selectionRange.high};
args=$.extend(args,searchFieldArgs);}else{args.elementId=listBoxId;}onRightClick(viewId,args);tooltip.hide();
};var selectionUpdatedByModifierKeyAndRightClick=false;var onMouseUp=function(e){$(document.body).unbind("mouseup",onMouseUp);
if(!ignorePendingServerSelection){sendPendingServerSelection();}if(!activeItem){return false;}var itemIndex=getItemIndex(e.pageY);
var rightClick=Spotfire.Touch.rightMouseButtonDown(e);if(rightClick&&activeItem.index===itemIndex&&itemIndex>=0){invokeRightClick(e.clientX,e.clientY,{isItemClick:true,itemIndex:itemIndex,selected:activeItem.selected||selectionUpdatedByModifierKeyAndRightClick});
}activeItem=null;pendingServerSelection=null;ignorePendingServerSelection=false;selectAction=ACTION_NONE;
return false;};onMouseUpForAddToSelectionClick=function(e){$(document.body).unbind("mouseup",onMouseUpForAddToSelectionClick);
if(!settings.addToSelectionOnClick){return;}var itemIndex=getItemIndex(e.pageY);if(Spotfire.Touch.leftMouseButtonDown(e)&&!isSelectableItem(itemIndex)){return;
}var selected=isSelected(itemIndex);var point=new Point(e.pageX,e.pageY);activeItem={index:itemIndex,selected:selected,downPoint:point};
if(Spotfire.Touch.rightMouseButtonDown(e)){ignorePendingServerSelection=selected;selectionUpdatedByModifierKeyAndRightClick=e.shiftKey||e.ctrlKey||e.metaKey;
}else{updateSelection(e,itemIndex);}onMouseUp(e);};var onMouseDown=function(e){if(settings.addToSelectionOnClick){$(document.body).bind("mouseup",onMouseUpForAddToSelectionClick);
e.originalEvent.spMouseDownHandled=true;return;}if($(e.target).is(".ListItemButton, .ListItemButton *")){return;
}var itemIndex=getItemIndex(e.pageY);var selected=isSelected(itemIndex);var point=new Point(e.pageX,e.pageY);
if(Spotfire.Touch.rightMouseButtonDown(e)){ignorePendingServerSelection=selected;selectionUpdatedByModifierKeyAndRightClick=e.shiftKey||e.ctrlKey||e.metaKey;
}else{if(!isSelectableItem(itemIndex)){return;}}activeItem={index:itemIndex,selected:selected,downPoint:point};
updateSelection(e,itemIndex);$(document.body).mouseup(onMouseUp);e.originalEvent.spMouseDownHandled=true;
};var onMouseDownNonItem=function(e){if(e.originalEvent.spMouseDownHandled){return;}if(Spotfire.Touch.rightMouseButtonDown(e)){e.originalEvent.spMouseDownHandled=true;
invokeRightClick(e.clientX,e.clientY);}};var onMouseOver=function(e){tooltip.hide();var tooltipItemIndex=getItemIndex(e.pageY);
if(tooltipItemIndex>=0){var tooltipArgs={elementId:listBoxId,generation:generation,type:"ListItem",itemIndex:tooltipItemIndex};
tooltip.show(tooltipArgs);}};var onMouseLeave=function(){tooltip.hide();};var onDoubleClick=function(e){toggleItemExpansion(e.pageY);
};var onScroll=function(){tooltip.hide();if(scrollTimer){window.clearTimeout(scrollTimer);}scrollTimer=window.setTimeout(fetchData,scrollDelay);
scrollDelay=100;};this.setMargins=function(_margins){margins=_margins;};this.appendTo=function(parent){parent.append(listBox);
};this.update=function(_generation,_itemCount,_visibleItemCount,_itemHeight,_itemsClientHeight,_collapsed,_collapseText,_resetScrolling,_resetAnchor,requestId){generation=_generation;
collapsed=_collapsed;itemsClientHeight=_itemsClientHeight;collapseText=_collapseText;itemCount=_itemCount;
visibleItemCount=_visibleItemCount;renderItemCount=visibleItemCount*3;itemHeight=_itemHeight;isMaxScroll=itemCount*itemHeight>DIV_MAXHEIGHT;
showHorizontalBorders=(searchFieldSettings===undefined)&&!collapsed;if(_resetScrolling){this.resetScrolling();
}if(_resetAnchor){this.resetSelectionAnchor();}performLayout();this.updateItems(undefined,requestId);
};this.updateItems=function(newGeneration,requestId){if(newGeneration!==undefined){generation=newGeneration;
}selection=selection||{};selectedItems={};items={};fetchData(requestId);};this.updateSearchField=function(value){if(searchInput!==undefined){searchInput.update(value);
}};this.resetScrolling=function(){setScrollPosition(0);};this.resetSelectionAnchor=function(){anchorMarkItem=-1;
};this.getHeight=function(){return listBox.outerHeight(true);};this.tryInvokeRightClick=function(point){if($searchField!==undefined&&$searchField.tryInvokeRightClick(point)){return true;
}var viewportBounds=new Rectangle(viewport.offset().left,viewport.offset().top,viewport.outerWidth(),viewport.outerHeight());
if(viewportBounds.containsPoint(point.x,point.y)){invokeRightClick(point.x,point.y,{isItemClick:true});
return true;}return false;};this.show=function(){listBox.show();};this.hide=function(){listBox.hide();
};this.getPreferredItemHeight=function(){return layout.itemHeight;};this.getNonItemHeight=getNonItemHeight;
scrollableDiv.mousedown(onMouseDown);listBox.mousedown(onMouseDownNonItem);scrollableDiv.dblclick(onDoubleClick);
scrollableDiv.mouseover(onMouseOver);scrollableDiv.mouseleave(onMouseLeave);if(Spotfire.capabilities.supportsTouch()){var scroll=new IScroll(scrollableDiv.get(0),null,{bounce:false,hScrollbarEnabled:false});
viewport.scrollTop=function(){return scroll.scrollTop();};scroll.onScroll=function(){viewport.trigger("scroll");
onScroll();};}else{viewport.scroll(onScroll);}}Spotfire.Controls.ListBox.create=function(viewId,listBoxId,tooltip,settings,onRightClick){return new ListBox(viewId,listBoxId,tooltip,settings,onRightClick);
};});$(function(){Spotfire.registerNameSpace("Controls.ModalDialog");function elem(s){return $(document.createElement(s||"div"));
}function extend(target){var i,obj,p;for(i=0;i<arguments.length;i++){obj=arguments[i];for(p in obj){if(obj.hasOwnProperty(p)){target[p]=obj[p];
}}}return target;}function closeAll(){$(".sf-modal-dialog-content").each(function(i,dialog){var api=$(dialog).data("modal-dialog-api");
if(api){api.close();}});}function initialize($content,options){options=extend({type:"default",width:300,height:null,minWidth:null,minHeight:null,title:null,titleIcon:null,preventAutoClose:$.noop,open:$.noop,close:$.noop,help:null,helpText:Spotfire.Localization.resources.Help,dialogClass:null,draggable:true,resizable:true,resize:$.noop,resizeStop:$.noop,buttons:[],extraFooterContent:null,responsive:true,position:null,modal:true},options);
options.title=options.title||$content.attr("title");var $backdrop=elem(),$modal=elem(),$header=elem(),$body=elem(),$footer=elem(),$headerTitle=Spotfire.Flex.item({container:"horizontal","align-items":"center","justify-content":"center"}),$headerTitleIcon=Spotfire.Flex.item({shrink:false}),$headerTitleText=Spotfire.Flex.item(),$previousFocus=null,closeButton=null,cancelButton=null,dragged=false;
function validateInViewport(){if($modal.outerWidth()>$(window).width()){$modal.css("width",$(window).width());
}if($modal.outerHeight()>$(window).height()){$modal.css("height",$(window).height());}var offset=$modal.offset();
var left=offset.left,top=offset.top,bottom=$(window).height()-$modal.outerHeight()-offset.top,right=$(window).width()-$modal.outerWidth()-offset.left,move=left<0||top<0||right<0||bottom<0;
if(left<0||right<0){left=Math.max(0,left+right);}if(top<0||bottom<0){top=Math.max(0,top+bottom);}if(move){$modal.css({top:top,left:left});
}$modal.css("height",parseInt($modal.outerHeight(),10)+"px");}function positionDialog(){if(!dragged){if(options.position){$modal.css({top:options.position[1]+"px",left:options.position[0]+"px"});
}else{var elemWidth=$modal.outerWidth(),elemHeight=$modal.outerHeight(),targetWidth=$(window).width(),targetHeight=$(window).height();
$modal.css({top:Math.round((targetHeight-elemHeight)/2)+"px",left:Math.round((targetWidth-elemWidth)/2)+"px"});
}}validateInViewport();}function closeDialog(){$modal.trigger("dialogclose");if(options.modal){$(document).trigger("hide.spotfire.modal");
}$backdrop.remove();$modal.remove();if($(".sf-modal-dialog-backdrop").length===0){$(window).off("resize.sf-modal-dialog");
}if(options.close&&typeof options.close==="function"){options.close();}if($previousFocus.is(":visible")){$previousFocus.focus();
}}function close(checkForPrevent){if(checkForPrevent&&options.preventAutoClose()){return true;}if(closeButton&&!closeButton.is(":enabled")){return true;
}if(closeButton&&closeButton.onClick){if(closeButton.onClick()){return true;}}closeDialog();return false;
}function preventTabbingOutsideModalDialog(e){if(e.which!==Keys.TAB){return;}var inputs=$modal.find("a, select, input, textarea, button").filter(":visible:enabled");
if(inputs.length===0){e.preventDefault();$modal.focus();return;}var first=inputs.first()[0];var last=inputs.last()[0];
if(e.shiftKey&&(document.activeElement===first||document.activeElement===$modal[0])){e.preventDefault();
$(last).focus();}else{if(!e.shiftKey&&document.activeElement===last){e.preventDefault();$(first).focus();
}}}function onCancel(e){e.stopPropagation();if(cancelButton&&cancelButton.onClick){if(cancelButton.onClick()){return;
}}closeDialog();}function onKeyDown(e){if(e.keyCode===Keys.ESCAPE){onCancel(e);}if(e.keyCode===Keys.F1){if(options.help){options.help();
e.stopPropagation();}}if(e.keyCode===Keys.RETURN){var $focused=$(":focus");if($focused.is("button")){return;
}if(!close(true)){e.stopPropagation();}}if(options.modal){preventTabbingOutsideModalDialog(e);}}function createHeader($target,size){var $headerHelp,$headerClose=elem();
$headerHelp=elem();$headerHelp.addClass("sf-modal-dialog-help");$headerHelp.text();if(options.help){$headerHelp.on("click",options.help);
$target.append($headerHelp);Spotfire.getSvg("Images/dialog/Help.svg",function($svg){$headerHelp.append($svg);
});}$headerClose.css({width:(size-2)+"px",height:(size-2)+"px"});$headerClose.addClass("sf-element-modal-dialog-header-close");
Spotfire.getSvg("images/dialog/Close.svg",function($svg){$headerClose.append($svg);});$headerClose.on("click touchstart",onCancel);
$headerClose.on("mousedown",function(e){e.stopPropagation();});$target.append($headerClose);}function setMinSize(){var minWidth=parseInt($footer.css("padding-left"),10)+parseInt($footer.css("padding-right"),10)+parseInt($footer.css("margin-left"),10)+parseInt($footer.css("margin-right"),10);
$footer.find(".sf-element-button").each(function(i,b){minWidth+=$(b).outerWidth(true);});var minHeight=$footer.outerHeight(true)+$header.outerHeight(true)+$body.outerHeight(true)-$body.outerHeight(false);
$modal.css({"min-width":Math.max(options.minWidth||0,Math.ceil(minWidth)),"min-height":Math.max(options.minHeight||0,Math.ceil(minHeight))});
}function setExtraFooterContent(){$footer.find(".extra-footer-content").empty().append(options.extraFooterContent);
}function setHeight(){$footer.css("height",$footer.find("button").first().outerHeight(true));var bodyMargin=$body.outerHeight(true)-$body.outerHeight(false);
var delta=$header.outerHeight(true)+$footer.outerHeight(true)+bodyMargin;$body.css("height","calc(100% - "+delta+"px)");
if(options.height==="auto"){var bodyPadding=parseInt($body.css("padding-top"),10)+parseInt($body.css("padding-bottom"),10);
var diff=$body[0].scrollHeight-$content.innerHeight()-bodyPadding;if(diff>0){$modal.css("height",Math.min(Math.max($modal.outerHeight(true)+diff+bodyPadding,options.minHeight),$(window).outerHeight()));
}}else{if(options.height){$modal.css("height",Math.max(options.height,options.minHeight));}}positionDialog();
}function setWidth(){if(options.width){$modal.css("width",Math.max(options.width,options.minWidth));}positionDialog();
}function setAutoScroll(autoScroll){$modal.toggleClass("sfpc-disable-auto-scroll",!autoScroll);}function createResizeHandle($target){if(!options.resizable){return;
}var $handle=elem();$handle.addClass("sf-modal-dialog-resize");Spotfire.getSvg("images/dialog/Resize.svg",function($svg){$handle.append($svg);
});$target.append($handle);}function createFooter(){$footer.empty();var $btn;$footer.attr("class","sf-element-modal-dialog-footer");
$footer.addClass("sf-modal-dialog-footer-"+options.buttons.length+"-buttons");if(options.help){$btn=elem("button");
$btn.addClass("sf-element-button sfpc-secondary sf-modal-dialog-footer-help");$btn.text(options.helpText||Spotfire.Localization.resources.Help);
$btn.on("click",options.help);$footer.append($btn);}var $buttonGroup=$("<div />").addClass("footer-button-group").appendTo($footer);
$("<div />").addClass("extra-footer-content").appendTo($footer);$.each(options.buttons,function(index,item){$btn=elem("button");
$btn.attr("id",item.id);$btn.prop("disabled",item.disabled);if(item.disabled){$btn.addClass("sfpc-disabled");
}$btn.addClass("sf-element-button");if(item.isDefault){$btn.text(item.text||Spotfire.Localization.resources.Ok);
$btn.on("click",function(){close(false);});$btn.onClick=item.click;closeButton=$btn;}else{if(item.isCancel){$btn.addClass("sfpc-secondary");
$btn.text(item.text||Spotfire.Localization.resources.Cancel);$btn.on("click",onCancel);$btn.onClick=item.click;
cancelButton=$btn;}else{$btn.addClass("sfpc-secondary");$btn.text(item.text);$btn.on("click",item.click||$.noop);
}}$buttonGroup.append($btn);});setMinSize();createResizeHandle($footer);}$backdrop.addClass("sf-modal-dialog-backdrop");
$headerTitle.addClass("sf-element-modal-dialog-header-title");$headerTitleText.addClass("sf-element-modal-dialog-header-title-text");
$modal.addClass("sf-element-modal-dialog");$header.addClass("sf-element-modal-dialog-header");$body.addClass("sf-element-modal-dialog-body");
$footer.addClass("sf-element-modal-dialog-footer");if(options.dialogClass){$modal.addClass(options.dialogClass);
}if(options.zIndex){$modal.css("z-index",options.zIndex);$backdrop.css("z-index",options.zIndex);}if(options.type!=="default"){$modal.addClass("sfpc-"+options.type);
}if(options.titleIcon){$headerTitleIcon.width(options.titleIcon.width);$headerTitleIcon.height(options.titleIcon.height);
Spotfire.getSvg(options.titleIcon.svgPath,function($svg){$headerTitleIcon.append($svg);});}$headerTitleText.text(options.title||"-");
$header.append($headerTitle);$headerTitle.append($headerTitleIcon);$headerTitle.append($headerTitleText);
$body.append($content);$modal.append($header);$modal.append($body);$modal.append($footer);if(options.modal){$(document.body).append($backdrop);
}$(document.body).append($modal);if($("#styleManager").length===0){var showDialogTimer;var showDialog=function(){if($("#styleManager").length===0){$modal.addClass("static-style");
}$modal.css("opacity","1");setHeight();window.clearTimeout(showDialogTimer);$(document.body).off("changed",showDialog);
};$modal.css("opacity","0");$(document.body).on("changed","#styleManager",showDialog);showDialogTimer=window.setTimeout(showDialog,1000);
}createHeader($header,parseInt($headerTitleText.css("font-size"),10));createFooter();if(options.responsive){$modal.addClass("sf-modal-dialog-responsive");
}$modal.css("width",options.width);setHeight();setMinSize();if(options.draggable){Spotfire.Touch.draggable($modal,{handle:$header,drag:function(){dragged=true;
}});}var currentSize;if(options.resizable){var resizeOptions={handles:"s,w,e,n,se,sw,ne,nw",minWidth:options.minWidth,minHeight:options.minHeight,containment:$(window),resize:function(size){dragged=true;
currentSize=size;options.resize(size);$modal.trigger("sf-resize");},stop:function(){options.resizeStop(currentSize);
}};Spotfire.Touch.resizable($modal,resizeOptions);}options.open();if(options.modal){$(document).trigger("show.spotfire.modal");
}var settingToUpdateMethod={buttons:function(){createFooter();setHeight();},title:function(){$headerTitleText.text(options.title||"-");
},height:setHeight,width:setWidth,setAutoScroll:setAutoScroll,extraFooterContent:setExtraFooterContent};
function update(arg1,arg2){if(typeof arg1!=="object"){var o={};o[arg1]=arg2;update(o);return;}var updateOptions=arg1||{};
var updateMethods=[];var p,i;for(p in updateOptions){if(updateOptions.hasOwnProperty(p)&&settingToUpdateMethod[p]&&updateMethods.indexOf(settingToUpdateMethod[p])===-1){updateMethods.push(settingToUpdateMethod[p]);
}}extend(options,updateOptions);for(i=0;i<updateMethods.length;i++){updateMethods[i]();}}function onResize(e){if(e.target===window){setHeight();
setMinSize();}}var api={close:function(){closeDialog();},update:update};$content.override("dialog",function(dialogMethod,arg1,arg2){if(dialogMethod==="option"){api.update(arg1,arg2);
}else{if(dialogMethod==="close"){api.close();}}});$content.addClass("sf-modal-dialog-content").data("modal-dialog-api",api);
$(window).on("resize.sf-modal-dialog",onResize);$previousFocus=$(document.activeElement);Spotfire.Focus.handleKeyDown($modal,onKeyDown);
Spotfire.Focus.setFocus($modal);$backdrop.on("mousedown",function(e){e.preventDefault();Spotfire.Focus.blur();
});$backdrop.on("mouseup",function(e){e.preventDefault();});$backdrop.on("click",function(e){e.preventDefault();
});return api;}$.fn.override=function(method,action){var original=$.fn[method];var thisNode=this;$.fn[method]=function(){if(this[0]===thisNode[0]){return action.apply(this,arguments);
}return original.apply(this,arguments);};};function update($content,method,settings){var api=$content.data("modal-dialog-api");
if(!api){return;}api.update(method,settings);}function close($content){var api=$content.data("modal-dialog-api");
if(!api){return;}api.close();}Spotfire.Controls.ModalDialog.initialize=initialize;Spotfire.Controls.ModalDialog.update=update;
Spotfire.Controls.ModalDialog.close=close;Spotfire.Controls.ModalDialog.closeAll=closeAll;});$(function(){Spotfire.registerNameSpace("Controls.DropDown");
function StyledDropDown($comboBoxDiv,settings){var $currentPopout=null;var $comboBoxTextDiv=null;var $searchInput=null;
var onSearch;var focusPopout;var setTextAndTitle=function($div,text){if(settings.detachedDropdownButton&&settings.detachedDropdownButtonText){text=settings.detachedDropdownButtonText;
}if($div.children("input").length===1){$div.children("input").val(text);}else{if(text===""){$div.html("&nbsp;");
}else{$div.text(text);}}$div.attr("title",$div.text());};var setIconPosition=function($picker){var marginRight=7;
var $inputText=$($picker.find(".sf-input-with-placeholder")[0]);var $arrow=$($picker.find(".ArrowContainer")[0]);
var $errorIcon=$($picker.find("#errorIcon")[0]);var $suffixIcon=$($picker.find("#suffixIcon")[0]);var $editIcon=$($picker.find("#editIcon")[0]);
var arrowWidth=$picker.find(".ArrowContainer").length?$arrow.width()+marginRight:marginRight;var errorWidth=$picker.find("#errorIcon").length?$errorIcon.width()+marginRight:0;
var suffixWidth=$picker.find("#suffixIcon").length?$suffixIcon.width()+marginRight:0;$editIcon.css("right",arrowWidth+"px");
$errorIcon.css({right:arrowWidth+"px",top:"3px"});$suffixIcon.css("right",arrowWidth+errorWidth);$inputText.css("padding-right",arrowWidth+errorWidth+suffixWidth);
};var setError=function($picker,validValue){$picker.removeClass("sf-element-error-input");$picker.find("#errorIcon").remove();
if(validValue){var $comboBoxError=$("<div/>").attr("id","errorIcon").addClass("sf-element-detached-combobox-svg-container").addClass("sf-element-detached-combobox-svg-container-error").appendTo($picker);
$picker.addClass("sf-element-error-input");Spotfire.getSvg(validValue,function($svg){$comboBoxError.append($svg);
});$comboBoxError.hover(function(){Spotfire.Visuals.Tooltip.show(Spotfire.Localization.resources.RuleBuilder_ErrorInput,Spotfire.Visuals.Tooltip.defaultPauseTime);
},function(){Spotfire.Visuals.Tooltip.hide();});}setIconPosition($picker);};var getSettings=function(newSettings){var defaultSettings={values:[],disabled:false,useIndexAsValueId:false,selectedValue:undefined,selectedIndex:-1,onSelected:$.noop,layoutForTextFlow:false,useContainerSize:false,maxVisibleValues:10,width:null,fixedListWidth:false,useCombobox:false,detachedCombobox:false,detachedComboboxValue:undefined,detachedComboboxDisabled:false,onDetachedComboboxBlur:$.noop,onCharAdd:$.noop,detachedComboboxClick:$.noop,detachedComboboxSvg:undefined,detachedErrorSvg:undefined,detachedComboboxPlaceholder:undefined,detachedDropdownButton:false,detachedDropdownButtonSvg:undefined,detachedDropdownButtonText:undefined,detachedDropdownButtonClick:$.noop,startExpanded:false,onPopoutClosed:$.noop,showDropdownArrow:true,itemDisplayTextCreator:function(item){return item.text;
},itemValueCreator:function(item){return item.value;}};var name,value;for(name in defaultSettings){if(defaultSettings.hasOwnProperty(name)){value=newSettings[name];
if(value!==undefined){defaultSettings[name]=value;}}}return defaultSettings;};settings=getSettings(settings);
var positionPopout=function(){$currentPopout.position({my:"left top",at:"left bottom+1",of:$comboBoxDiv,collision:"flipfit"});
};var createPopout=function($comboBoxTextDiv,popoutCloser,originalItems,longestItemWidth,itemHeight,originalSelectedIndex,updateSelectedIndex){var $container=$comboBoxDiv.parent();
$currentPopout=$("<div/>").addClass("DropdownListContainer");$container.append($currentPopout);var popoutWidth=$comboBoxDiv.outerWidth();
if(!settings.fixedListWidth){popoutWidth=Math.max(popoutWidth,longestItemWidth+20);}$currentPopout.css({width:popoutWidth});
$currentPopout.css({position:"absolute",top:"0",left:"0"});var items=originalItems;var selectedIndex=originalSelectedIndex;
var onSelectedValueChanged=function(newSelectedIndex){popoutCloser();if(newSelectedIndex!==selectedIndex){var item=items[newSelectedIndex];
if(!settings.detachedCombobox){setTextAndTitle($comboBoxTextDiv,item.Text);}settings.onSelected(item.OriginalItem,item.OriginalIndex);
updateSelectedIndex(item);}};var onGetValues=function(low,high,generation,callback){var requestedItems=[];
var i;var item;for(i=low;i<=high;++i){item={Text:items[i].Text};requestedItems.push(item);}var result={Items:requestedItems,TopIndex:low};
callback(result);};var $popoutListboxDiv=$("<div/>");$popoutListboxDiv.appendTo($currentPopout);var listBox;
onSearch=function(pattern){selectedIndex=-1;if(pattern===""||pattern===null||pattern===undefined||pattern==="*"){selectedIndex=originalSelectedIndex;
items=originalItems;}else{var newList=[];var i;var j=0;for(i=0;i<settings.values.length;++i){if(originalItems[i].Text.toUpperCase().indexOf(pattern.toUpperCase())!==-1){newList.push(originalItems[i]);
if(originalItems[i].Selected){selectedIndex=j;}j++;}}items=newList;}var numHits=items.length;if(numHits>0){$currentPopout.show();
}else{$currentPopout.hide();}listBox.update({height:Math.min(items.length,settings.maxVisibleValues),totalVisibleValues:items.length});
positionPopout();var searchResult={numHits:numHits,listBox:listBox,selectedIndex:selectedIndex};return searchResult;
};listBox=Spotfire.Controls.VirtualListBox.create($popoutListboxDiv,{height:Math.min(items.length,settings.maxVisibleValues),itemHeight:itemHeight,totalVisibleValues:items.length,onGetValues:onGetValues,onSelectionChanged:onSelectedValueChanged,sendSelectionAfterKeyboardMovement:false,sendSelectionOnUpdate:false,handleKeyEnter:true,viewportClass:"sf-element-dropdown-list sfc-scrollable",listItemClass:"sf-element-dropdown-list-item",setListItemCssHeight:false});
$popoutListboxDiv.closest(".sf-element-dialog").on("dialogbeforeclose.Dropdown",function(event){event.preventDefault();
});$popoutListboxDiv.closest(".sf-element-modal-dialog").on("dialogbeforeclose.Dropdown",function(event){event.preventDefault();
});Spotfire.Focus.handleKeyDown($popoutListboxDiv,function(event){if(event.keyCode===Keys.ESCAPE||event.keyCode===Keys.TAB){popoutCloser();
event.stopPropagation();}});Spotfire.Prompt.suppressFormsAcceptCommandIfFocused($popoutListboxDiv);focusPopout=function(){Spotfire.Focus.setFocus($popoutListboxDiv);
};focusPopout();listBox.update();$currentPopout.css({position:"fixed"});$currentPopout.zIndex($comboBoxDiv.zIndex()+10);
positionPopout();if(selectedIndex!==-1){listBox.markAndScrollToIndex(originalSelectedIndex,originalSelectedIndex);
}};var calculateArrowWidth=function(height){return Math.round(height*1.05);};var createButton=function($comboBoxTextDiv,$comboBoxButtonDiv,isCombobox){var $comboboxIcon;
$comboBoxDiv.removeClass("sf-element-combobox sf-element-dropdown");$comboBoxButtonDiv.removeClass("sf-element-combobox-button");
$comboBoxButtonDiv.removeClass("sf-element-dropdown-button");$comboBoxDiv.closest(".sf-element-detached-combobox-svg-container").remove();
$comboBoxDiv.closest(".sf-element-detached-dropdown-button-svg-container").remove();$comboBoxDiv.removeClass("sf-element-error-input");
if(isCombobox){$comboBoxDiv.addClass("sf-element-combobox");$comboBoxButtonDiv.addClass("sf-element-combobox-button ArrowContainer").appendTo($comboBoxDiv);
if(settings.detachedCombobox&&settings.detachedComboboxSvg){$comboboxIcon=$("<div/>").attr("id","suffixIcon").addClass("sf-element-detached-combobox-svg-container").appendTo($comboBoxDiv);
Spotfire.getSvg(settings.detachedComboboxSvg,function($svg){$svg.css("position","absolute");$comboboxIcon.append($svg);
});}if(settings.detachedCombobox&&settings.detachedErrorSvg){setError($comboBoxDiv,settings.detachedErrorSvg);
}}else{$comboBoxDiv.addClass("sf-element-dropdown");if(settings.showDropdownArrow){if(settings.detachedDropdownButton){$comboBoxButtonDiv.addClass("sf-element-dropdown-button ArrowContainer").appendTo($comboBoxDiv);
$comboBoxButtonDiv.on("mouseenter mouseleave",function(){$comboBoxDiv.toggleClass("sf-element-dropdown-nohover");
});}else{$comboBoxButtonDiv.addClass("ArrowContainer").appendTo($comboBoxDiv);}}}$comboBoxDiv.toggleClass("sfpc-disabled",settings.disabled);
var $comboboxTextDivContainer=$("<div/>").addClass("ComboBoxTextDivContainer").appendTo($comboBoxDiv);
$comboBoxTextDiv.addClass("sf-element-text-box").appendTo($comboboxTextDivContainer);if(settings.detachedDropdownButton){var dropdownButtonClick=function(){if(settings.detachedDropdownButtonClick){settings.detachedDropdownButtonClick();
return false;}$.noop();};if(settings.detachedDropdownButtonClick){$comboboxTextDivContainer.on("click",dropdownButtonClick);
}if(settings.detachedDropdownButtonSvg){$comboboxIcon=$("<div/>").addClass("sf-element-detached-dropdown-button-svg-container").attr("id","editIcon").appendTo($comboBoxDiv);
Spotfire.getSvg(settings.detachedDropdownButtonSvg,function($svg){$svg.css("position","absolute");$comboboxIcon.append($svg);
});$comboboxIcon.on("click",dropdownButtonClick);$comboBoxTextDiv.addClass("sf-element-text-box-icon");
}}if(settings.detachedCombobox){$searchInput=$("<input type='text'/>").addClass("ComboBoxSearchField");
Spotfire.Prompt.suppressFormsAcceptCommandIfFocused($searchInput);$searchInput.on("keyup",function(e){if(e.which===Keys.RETURN){$searchInput.blur();
}});$searchInput.on("keydown",function(e){if(e.which===Keys.TAB){$searchInput.blur();}});$searchInput.on("blur",function(e,d){if(settings.onDetachedComboboxBlur){settings.onDetachedComboboxBlur(e,d);
}});$searchInput.on("input",function(){settings.onCharAdd($searchInput.val());});if(settings.detachedComboboxPlaceholder){$searchInput.addClass("sf-input-with-placeholder");
$searchInput.attr("placeholder",settings.detachedComboboxPlaceholder);}$comboBoxTextDiv.append($searchInput);
}else{$comboBoxTextDiv.text("X");}$comboBoxButtonDiv.height("100%");var arrowHeight=$comboBoxButtonDiv.height();
var arrowWidth=calculateArrowWidth(arrowHeight);$comboBoxButtonDiv.width(arrowWidth);if(!settings.layoutForTextFlow&&!settings.useContainerSize){$comboboxTextDivContainer.css({width:"-webkit-calc(100% - "+arrowWidth+"px)"});
$comboboxTextDivContainer.css({width:"calc(100% - "+arrowWidth+"px)"});}var arrowSvgDiv=$("<div>").addClass("sf-element sf-element-icon").width(arrowWidth).appendTo($comboBoxButtonDiv);
Spotfire.getSvg("Images/Controls/StyledDropDownArrow.svg",function($svg){arrowSvgDiv.append($svg);});
setIconPosition($comboBoxDiv);return isCombobox?$comboBoxButtonDiv:$comboBoxDiv;};var createSelect=function($comboBoxTextDiv,originalItems){var $select=$("<select/>").addClass("sf-dropdown-select").appendTo($comboBoxDiv).prop("disabled",settings.disabled);
var option;if(settings.useIndexAsValueId&&settings.selectedIndex===-1){option=$("<option></option>").val(-1).text("---").prop("selected","selected");
$select.prepend(option);}var i,item;for(i=0;i<originalItems.length;i++){option=$("<option></option>");
item=originalItems[i];option.text(item.Text);option.val(item.OriginalIndex);if(item.Selected){option.attr("selected","selected");
}$select.append(option);}$select.change(function(){var index=$(this).val();if(index>=0){item=originalItems[index];
if(!settings.detachedCombobox){setTextAndTitle($comboBoxTextDiv,item.Text);}settings.onSelected(item.OriginalItem,item.OriginalIndex);
}});var $cssParent=$comboBoxDiv.closest(".sf-element-document");if($cssParent.length===0){$cssParent=$comboBoxDiv;
}$select.css($cssParent.css(["background-color"]));$select.css($comboBoxDiv.css(["color","font-family"]));
if(settings.startExpanded){$select.click();}};var getWidthsAndHeights=function($parent,$comboBoxTextDiv){var longestItemWidth;
var itemHeight;var comboBoxTextWidth;var allItems=_.reduce(settings.values,function(memo,item){if(item instanceof Object){return memo+"\n"+item.text;
}return memo+"\n"+item;},"");var $tmpDropdownList=$("<div/>").addClass("sf-element-dropdown-list sfc-scrollable").appendTo($parent);
var $tmpDropdownListItem=$("<div/>").addClass("sf-element-dropdown-list-item").text("A").appendTo($tmpDropdownList);
itemHeight=$tmpDropdownListItem.sfBoxHeight();$tmpDropdownListItem.text(allItems);longestItemWidth=$tmpDropdownListItem.sfBoxWidth();
$tmpDropdownList.remove();if(settings.layoutForTextFlow&&!settings.useContainerSize){$comboBoxTextDiv.css({"white-space":"pre"});
$comboBoxTextDiv.text(allItems);comboBoxTextWidth=$comboBoxTextDiv.outerWidth()+1;$comboBoxTextDiv.css({"white-space":"nowrap"});
}return{longestItemWidth:longestItemWidth,itemHeight:itemHeight,comboBoxTextWidth:comboBoxTextWidth};
};var resetcombobox=function($comboBoxTextDiv,oldText){if($searchInput&&!settings.detachedCombobox){$searchInput.remove();
$searchInput=null;if($comboBoxTextDiv&&oldText){setTextAndTitle($comboBoxTextDiv,oldText);}}};var closePopout=function($parent,$comboBoxTextDiv,oldText){var closed=false;
if($currentPopout){$currentPopout.remove();$currentPopout=null;$(document.body).off("mousedown.dropDownList");
$(document.body).off("scroll.dropDownList");closed=true;}resetcombobox($comboBoxTextDiv,oldText);if($parent){Spotfire.Focus.setFocus($parent);
$parent.closest(".sf-element-dialog").off("dialogbeforeclose.Dropdown");}if(closed){settings.onPopoutClosed();
}};var initialize=function(){closePopout();$comboBoxDiv.empty();$comboBoxDiv.off();$comboBoxDiv.on("remove",function(){closePopout();
});$comboBoxDiv.attr("tabindex","-1");$comboBoxTextDiv=$("<div/>");var $comboBoxButtonDiv=$("<div/>");
var useListbox=!Spotfire.capabilities.supportsTouch()||(settings.useCombobox&&settings.detachedCombobox);
var $selectable=createButton($comboBoxTextDiv,$comboBoxButtonDiv,useListbox&&settings.useCombobox);var widthsAndHeights=getWidthsAndHeights($comboBoxDiv.parent(),$comboBoxTextDiv);
var arrowWidth=calculateArrowWidth($comboBoxButtonDiv.height());if(settings.layoutForTextFlow){$comboBoxDiv.css("width","");
$comboBoxTextDiv.css("width","");var margin=7;var border=1;if(settings.useContainerSize){var containerWidth=$comboBoxDiv.parent().width();
$comboBoxDiv.css({width:containerWidth});$comboBoxTextDiv.css({width:containerWidth-margin-border-arrowWidth,"padding-right":margin});
}else{var $container=$comboBoxDiv.parent();$container.css({width:widthsAndHeights.longestItemWidth+margin+border+arrowWidth+border});
$comboBoxTextDiv.css({width:widthsAndHeights.longestItemWidth,"padding-right":margin});}}else{if(settings.width!==null){$comboBoxTextDiv.css("width","");
$comboBoxDiv.css({width:settings.width});}}setTextAndTitle($comboBoxTextDiv,settings.detachedCombobox?settings.detachedComboboxValue:"---");
var originalItems=[];var i,item,text,value,selected;var selectedIndex=-1;for(i=0;i<settings.values.length;
++i){item=settings.values[i];text=item;value=item;selected=false;if(item instanceof Object){value=settings.itemValueCreator(item);
text=settings.itemDisplayTextCreator(item);}if(settings.useIndexAsValueId){if(settings.selectedIndex===i){selectedIndex=i;
selected=true;if(!settings.detachedCombobox){setTextAndTitle($comboBoxTextDiv,text);}}}else{if(settings.selectedValue===value){selectedIndex=i;
selected=true;if(!settings.detachedCombobox){setTextAndTitle($comboBoxTextDiv,text);}}}originalItems.push({OriginalItem:value,OriginalIndex:i,Text:text,Selected:selected});
}if(useListbox){var $body=$(document.body);var oldText=null;var popoutCloser=function(){closePopout($comboBoxDiv,$comboBoxTextDiv,oldText);
};var onMouseDown=function(event){var target=$(event.target);if(target.is($comboBoxDiv)||target.closest($comboBoxDiv).length||target.is($currentPopout)||target.closest($currentPopout).length){return;
}popoutCloser();};if(settings.useCombobox){$comboBoxTextDiv.click(function(){if($comboBoxDiv.is(".sfpc-disabled")){return;
}if(settings.detachedCombobox){if(settings.detachedComboboxClick){settings.detachedComboboxClick();}if(settings.detachedComboboxDisabled){return;
}}if($(".ComboBoxSearchField").length===0){oldText=$comboBoxTextDiv.text();setTextAndTitle($comboBoxTextDiv,"");
$searchInput=$("<input type='text'/>").addClass("ComboBoxSearchField");Spotfire.Prompt.suppressFormsAcceptCommandIfFocused($searchInput);
$searchInput.css({width:"calc(100% - "+arrowWidth+"px"});$searchInput.val(oldText);$comboBoxTextDiv.append($searchInput);
}var result=null;$body.on("mousedown.dropDownList",onMouseDown);if(!settings.detachedCombobox){if($currentPopout===null){$selectable.trigger("click",true);
}$body.on("scroll.dropDownList",onMouseDown);$searchInput.on("input",function(){result=onSearch($searchInput.val());
if(result.numHits>0&&result.selectedIndex!==-1){result.listBox.markAndScrollToIndex(result.selectedIndex,0);
}});$searchInput.on("keydown",function(e){if(e.keyCode===Keys.UP||e.keyCode===Keys.DOWN){if(result!==null){if(result.numHits===0){return;
}if(e.keyCode===Keys.DOWN){result.listBox.markAndScrollToIndex(0,0);}else{if(e.keyCode===Keys.UP){result.listBox.markAndScrollToIndex(result.numHits-1,result.numHits-1);
}}e.stopPropagation();$comboBoxDiv.focus();focusPopout();result=null;}else{$comboBoxDiv.focus();focusPopout();
}}else{if(e.keyCode===Keys.ESCAPE){popoutCloser();$comboBoxDiv.focus();e.stopPropagation();}else{if(e.keyCode===Keys.TAB){$searchInput.blur();
popoutCloser();}}}});}});}$selectable.click(function(event,fromSearch){if($currentPopout!==null){popoutCloser();
return;}if(!fromSearch){$comboBoxDiv.focus();}else{if(settings.detachedCombobox){return;}}if($comboBoxDiv.is(".sfpc-disabled")){return;
}$body.on("mousedown.dropDownList",onMouseDown);$body.on("scroll.dropDownList",onMouseDown);createPopout($comboBoxTextDiv,popoutCloser,originalItems,widthsAndHeights.longestItemWidth,widthsAndHeights.itemHeight,selectedIndex,function(item){selectedIndex=item.OriginalIndex;
});if(fromSearch){$searchInput[0].select();$searchInput.focus();}});if(settings.startExpanded){$selectable.trigger("click",true);
}}else{createSelect($comboBoxTextDiv,originalItems);}};var update=function(newSettings){settings=getSettings($.extend({},settings,newSettings));
initialize();};var val=function(value){if(settings.useCombobox&&settings.detachedCombobox){if(typeof value==="string"){update({detachedComboboxValue:value});
}else{return $searchInput!==null?$searchInput.val():$comboBoxTextDiv.text();}}else{throw"Unexpected call to val, Only implemented for detached combobox.";
}};this.initialize=initialize;this.update=update;this.val=val;this.setError=setError;}Spotfire.Controls.DropDown.initialize=function($comboBoxDiv,settings){var dropDown=new StyledDropDown($comboBoxDiv,settings);
dropDown.initialize();$comboBoxDiv.data("dropDown",dropDown);return dropDown;};Spotfire.Controls.DropDown.update=function($comboBoxDiv,newSettings){var oldDropDown=$comboBoxDiv.data("dropDown");
if(!oldDropDown){return;}if(newSettings){oldDropDown.update(newSettings);}};});$(function(){Spotfire.registerNameSpace("Filters.StyledFilters");
var STYLEDCLASSNAME="StyledInput";$(document).ready(function(){$(document.body).on("click","."+STYLEDCLASSNAME,function(){var $styled=$(this);
var $unstyled=$styled.prev();if(!$styled.hasClass("disabled")){$unstyled.trigger("click");$unstyled.focus();
}return false;});});var createSvg=function(qName){return document.createElementNS("http://www.w3.org/2000/svg",qName);
};var supportsSvg=function(){return window.SVGSVGElement;};Spotfire.Filters.StyledFilters.createStyledInput=function(element,width,height,inputHideCss){if(!element||!element.length||!supportsSvg()){return element;
}if(element.get(0).nodeName!="INPUT"){element.find("input").each(function(){Spotfire.Filters.StyledFilters.createStyledInput($(this),width,height,inputHideCss);
});return element;}var input=element;if(!width){width=input.get(0).clientWidth;}if(!height){height=input.get(0).clientHeight;
}if(!width||!height){height=input.outerHeight();width=input.outerWidth();}var styledinput=input.next().hasClass(STYLEDCLASSNAME)?input.next():null;
if(!styledinput){if(input.attr("type")=="checkbox"){styledinput=createSvgCheckbox(width,height);}else{if(input.attr("type")=="radio"){styledinput=createSvgRadio(width,height,"StyledInput StyledRadio ");
}}if(styledinput){if(inputHideCss){input.css(inputHideCss);}else{input.css({position:"absolute",opacity:"0"});
}styledinput.addClass(STYLEDCLASSNAME);styledinput.insertAfter(input);}}if(styledinput){if(input.prop("disabled")){styledinput.addClass("disabled");
}else{styledinput.removeClass("disabled");}}return styledinput;};Spotfire.Filters.StyledFilters.drawPath=function(parent,path,width,height,color,options){options=$.extend({parent:parent,width:parent.innerWidth(),height:parent.innerHeight(),elements:[{type:"path",path:path,fill:color,width:width,height:height}]},options||{});
return Spotfire.Filters.StyledFilters.createStyledElement(options);};Spotfire.Filters.StyledFilters.createSvgPrevMonth=function(parent,options){if(!supportsSvg()){return parent;
}var settings=$.extend({parent:parent,width:parent.innerWidth(),height:parent.innerHeight(),classname:"StyledDatePickerPrev"},options);
return createMonthArrow(settings,"M 2.5,1 l-0.9,0.9 l0.9,0.9 z");};Spotfire.Filters.StyledFilters.createSvgNextMonth=function(parent,options){if(!supportsSvg()){return null;
}var settings=$.extend({parent:parent,width:parent.innerWidth(),height:parent.innerHeight(),classname:"StyledDatePickerNext"},options);
return createMonthArrow(settings,"M 1.5,1 l0.9,0.9 l-0.9,0.9 z");};Spotfire.Filters.StyledFilters.createDropDownArrow=function(parent,options){if(!supportsSvg()){return null;
}return Spotfire.Filters.StyledFilters.createStyledElement($.extend({parent:parent,width:parent.innerWidth(),height:parent.innerHeight(),elements:[{type:"path",path:"M4,6 l7,0 l-3.5,3.5 z",width:"15",height:"15",fill:"currentColor",classname:"Down"}]},options));
};Spotfire.Filters.StyledFilters.createMagnifierGlass=function(parent,options){if(!supportsSvg()){return null;
}return Spotfire.Filters.StyledFilters.createStyledElement($.extend({parent:parent,width:parent.innerWidth(),height:parent.innerHeight(),background:"white",elements:[{type:"path",path:"M90,90 l-25,-25 a 31 31 0 1 1 0.5 -0.5 z",width:"100",height:"100",brushcolor:"#b3b3b3",brushwidth:"10",fill:"none",classname:"Normal"},{type:"path",path:"M90,90 l-25,-25 a 31 31 0 1 1 0.5 -0.5 z",width:"100",height:"100",brushcolor:"#7a7a7a",brushwidth:"10",fill:"none",classname:"Hover"}]},options));
};Spotfire.Filters.StyledFilters.createExpandCollapseButton=function(parent,options){if(!supportsSvg()){return null;
}return Spotfire.Filters.StyledFilters.createStyledElement($.extend({parent:parent,classname:"Styled",borderwidth:1,elements:[{type:"rect",width:"7",height:"7",fill:"currentColor",x:"1",y:"3",rectWidth:"5",rectHeight:"1"},{type:"rect",width:"7",height:"7",fill:"currentColor",x:"3",y:"1",rectWidth:"1",rectHeight:"5",classname:"Expand"}]},options));
};var createMonthArrow=function(settings,path){return Spotfire.Filters.StyledFilters.createStyledElement($.extend({elements:[{type:"path",path:path,fill:"#26a2ed",width:"4",height:"4",filters:[{type:"dropshadow",color:"#ffffff",dx:0,dy:1,r:0.5},{type:"innershadow",color:"#1d638d",dx:0,dy:1,r:1}]}]},settings));
};var createSvgCheckbox=function(width,height){return Spotfire.Filters.StyledFilters.createStyledElement({classname:"StyledInput StyledCheckbox sf-element-check-box",width:width,height:height,borderwidth:1,elements:[{type:"path",path:"M7.608,2l-2.522,4.835l-2.331,-1.835l-0.755,1.234l3.478,2.766l3.522,-6.124z",fill:"currentColor",classname:"CheckboxButtonSvg",width:"11",height:"11"},{type:"rect",x:"2",y:"5",rectWidth:"7",rectHeight:"1.5",fill:"currentColor",classname:"IndeterminateCheckboxButtonSvg",width:"11",height:"11"}]});
};var createSvgRadio=function(width,height,additionalClass){return Spotfire.Filters.StyledFilters.createStyledElement({classname:(additionalClass||"")+"sf-element sf-element-radio-button",width:width,height:height,borderwidth:1,elements:[{type:"circle",classname:"RadioButtonSvg",cx:width/2-1,cy:height/2-1,size:Math.ceil(Math.min(width,height)/3),fill:"currentColor",brushwidth:1}]});
};Spotfire.Filters.StyledFilters.createSvgRadio=createSvgRadio;Spotfire.Filters.StyledFilters.createStyledElement=function(settings){if(!supportsSvg()){return null;
}var filtercontainer=$(document.getElementsByTagName("html")[0]);var borderwidth=settings.borderwidth||0;
var $wrapper=settings.parent||$("<div />");$wrapper.addClass(settings.classname).css({width:settings.width-2*borderwidth+"px",height:settings.height-2*borderwidth+"px"});
if(borderwidth){$wrapper.css("border-width",borderwidth+"px");}var svg=createSvg("svg");var $svg=$(svg);
var width=settings.width-2*borderwidth;var height=settings.height-2*borderwidth;svg.setAttribute("width",Math.max(width,0)+"px");
svg.setAttribute("height",Math.max(height,0)+"px");if(settings.viewBox&&!settings.stretch){svg.setAttribute("viewBox",settings.viewBox);
}if(settings.elements){var ix,r,elementwidth,elementheight,element,node;for(ix=0;ix<settings.elements.length;
ix++){element=settings.elements[ix];elementwidth=element.width;elementheight=element.height;if(element.type==="path"){node=createSvg("path");
node.setAttribute("d",element.path);}else{if(element.type==="circle"){node=createSvg("circle");r=element.r||((element.size/2)-(element.brushwidth||0)/2);
node.setAttribute("r",r);node.setAttribute("cx",element.cx||r);node.setAttribute("cy",element.cy||r);
elementwidth=element.width||element.size;elementheight=element.height||element.size;}else{if(element.type==="rect"){node=createSvg("rect");
node.setAttribute("x",element.x);node.setAttribute("y",element.y);node.setAttribute("height",element.rectHeight);
node.setAttribute("width",element.rectWidth);}else{if(element.type==="polygon"){node=createSvg("polygon");
node.setAttribute("points",element.points);}}}}if(settings.stretch&&settings.viewBox){var viewBoxArray=settings.viewBox.split(" ");
var scaleX=settings.width/parseFloat(viewBoxArray[2]);var scaleY=settings.height/parseFloat(viewBoxArray[3]);
node.setAttribute("transform",Spotfire.Utilities.formatString("scale({0},{1})",scaleX,scaleY));}if(node){node.setAttribute("fill",element.fill);
node.setAttribute("stroke-width",element.brushwidth||1);if(element.brushcolor){node.setAttribute("stroke",element.brushcolor);
}if(element.opacity){node.setAttribute("opacity",element.opacity);}if(element.width&&element.height){var scaleX=width/elementwidth;
var scaleY=height/elementheight;if(!settings.stretch){scaleX=Math.min(scaleX,scaleY);scaleY=scaleX;}node.setAttribute("transform",Spotfire.Utilities.formatString("scale({0},{1})",scaleX,scaleY));
}if(element.classname){node.setAttribute("class",element.classname);}if(element.filters){var ixx;for(ixx=0;
ixx<element.filters.length;ixx++){var filter=element.filters[ixx];var g=createSvg("g");if(filter.type.toLowerCase()=="dropshadow"){g.setAttribute("filter",Spotfire.Utilities.formatString("url(#{0})",createDropShadow(filter.color,filter.dx,filter.dy,filter.r,filtercontainer)));
}else{if(filter.type.toLowerCase()=="innershadow"){g.setAttribute("filter",Spotfire.Utilities.formatString("url(#{0})",createInnerShadow(filter.color,filter.dx,filter.dy,filter.r,filtercontainer)));
}}g.appendChild(node);node=g;}}svg.appendChild(node);}}}return $wrapper.append($svg);};var makeSafeId=function(str){if(typeof str==="string"){return str.replace(/^[^a-z]+|[^\w:.\-]+/gi,"_");
}return str;};var createDropShadow=function(color,dx,dy,r,container){var name=Spotfire.Utilities.formatString("dropshadow_{0}_{1}_{2}_{3}",makeSafeId("c"+color),dx,dy,r);
var filter=document.getElementById(name);if(filter){return name;}var defs=getDefintionElement(container);
filter=defs.appendChild(createSvg("filter"));filter.setAttribute("id",name);var blur=filter.appendChild(createSvg("feGaussianBlur"));
blur.setAttribute("in","SourceAlpha");blur.setAttribute("stdDeviation",r);var offset=filter.appendChild(createSvg("feOffset"));
offset.setAttribute("dx",dx);offset.setAttribute("dy",dy);offset.setAttribute("result","offsetblur");
var flood=filter.appendChild(createSvg("feFlood"));flood.setAttribute("flood-color",color);flood.setAttribute("class",name+"Color");
var composite=filter.appendChild(createSvg("feComposite"));composite.setAttribute("in2","offsetblur");
composite.setAttribute("operator","in");var merge=filter.appendChild(createSvg("feMerge"));merge.appendChild(createSvg("feMergeNode"));
var mergenode=merge.appendChild(createSvg("feMergeNode"));mergenode.setAttribute("in","SourceGraphic");
return name;};var createInnerShadow=function(color,dx,dy,r,container){var name=Spotfire.Utilities.formatString("innershadow_{0}_{1}_{2}_{3}",makeSafeId("c"+color),dx,dy,r);
var filter=document.getElementById(name);if(filter){return name;}var defs=getDefintionElement(container);
filter=defs.appendChild(createSvg("filter"));filter.setAttribute("id",name);var blur=filter.appendChild(createSvg("feGaussianBlur"));
blur.setAttribute("in","SourceAlpha");blur.setAttribute("stdDeviation",r);blur.setAttribute("result","blur");
var offset=filter.appendChild(createSvg("feOffset"));offset.setAttribute("dx",dx);offset.setAttribute("dy",dy);
var composite=filter.appendChild(createSvg("feComposite"));composite.setAttribute("in2","SourceAlpha");
composite.setAttribute("operator","arithmetic");composite.setAttribute("k2","-1");composite.setAttribute("k3","1");
composite.setAttribute("result","shadowDiff");var flood=filter.appendChild(createSvg("feFlood"));flood.setAttribute("flood-color",color);
flood.setAttribute("flood-opacity","1");flood.setAttribute("class",name+"Color");var composite2=filter.appendChild(createSvg("feComposite"));
composite2.setAttribute("in2","shadowDiff");composite2.setAttribute("operator","in");var composite3=filter.appendChild(createSvg("feComposite"));
composite3.setAttribute("in2","SourceGraphic");composite3.setAttribute("operator","over");return name;
};var createGradient=function(color1,color2,container){var name=Spotfire.Utilities.formatString("gradient_{0}_{1}",makeSafeId("c"+color1),makeSafeId("c"+color2));
var gradient=document.getElementById(name);if(gradient){return name;}var defs=getDefintionElement(container);
gradient=createSvg("linearGradient");gradient.setAttribute("id",name);gradient.setAttribute("x1","0%");
gradient.setAttribute("y1","0%");gradient.setAttribute("x2","0%");gradient.setAttribute("y2","100%");
defs.appendChild(gradient);var stop1=gradient.appendChild(createSvg("stop"));stop1.setAttribute("class","stop1");
stop1.setAttribute("offset","0%");stop1.setAttribute("style","stop-color:"+color1+";stop-opacity:1");
var stop2=gradient.appendChild(createSvg("stop"));stop2.setAttribute("class","stop2");stop2.setAttribute("offset","100%");
stop2.setAttribute("style","stop-color:"+color2+";stop-opacity:1");return name;};var getDefintionElement=function(container){if(container instanceof jQuery){container=container.get(0);
}var defsList=container?container.getElementsByClassName("SvgDefinitions"):document.getElementsByClassName("SvgDefinitions");
if(defsList.length===0){var svg=createSvg("svg");if(container){container.appendChild(svg);}else{document.body.appendChild(svg);
}svg.setAttribute("visibility","hidden");svg.setAttribute("style","position:fixed");var defs=svg.appendChild(createSvg("defs"));
defs.setAttribute("class","SvgDefinitions");return defs;}return defsList[0];};Spotfire.Filters.StyledFilters.createSvgArrow=function(parent,direction,borderClass){var DIRECTION={up:0,left:1,right:2,down:3};
parent.empty();var path="M 12,0 L0,12 L12,24";var width=12;var height=24;if(direction===DIRECTION.right){path="M 0,0 L12,12 L0,24";
}else{if(direction===DIRECTION.up){path="M 0,12 L12,0 L24,12";width=24;height=12;}else{if(direction===DIRECTION.down){path="M 0,0 L12,12 L24,0";
width=24;height=12;}}}return Spotfire.Filters.StyledFilters.createStyledElement({parent:parent,borderwidth:0,width:width,height:height,elements:[{type:"path",path:path+" z",fill:"currentColor"},{type:"path",path:path,fill:"none",brushwidth:"1",brushcolor:"currentColor",classname:borderClass}]});
};});(function($){function Scrollbar(virtualScrollArea,$scrollbarDiv,options,scrollendfn,direction){var scrollbarBorderWidth=options.handleBorderWidth;
var scrollbarWidth=options.width;var sidePadding=options.sidePadding;var isScrollWheelDisabled=options.isScrollWheelDisabled||function(){return false;
};var mousewheelLines=options.mouseWheelLines||3;var lineSize=options.lineSize||function(){return 13;
};var baseScrollWheelStepSize=options.lineSize?lineSize()*mousewheelLines:40;var pageSize=options.pageSize;
var buttonSize;$scrollbarDiv.attr("draggable",false);var isVertical=direction==="vertical";var $handle=$("<div />").addClass("ScrollbarHandle sf-element sf-element-scroll-bar-handle").appendTo($scrollbarDiv);
if(isVertical){$scrollbarDiv.addClass("VerticalScrollbarContainer sf-element sf-element-scroll-bar sfpc-right").width(scrollbarWidth+2*sidePadding);
$handle.css({"border-width":scrollbarBorderWidth,width:scrollbarWidth-2*scrollbarBorderWidth+"px",left:sidePadding+"px"});
}else{$scrollbarDiv.addClass("HorizontalScrollbarContainer sf-element sf-element-scroll-bar sfpc-bottom").height(scrollbarWidth+2*sidePadding);
$handle.css({"border-width":scrollbarBorderWidth,height:scrollbarWidth-2*scrollbarBorderWidth+"px",top:sidePadding+"px"});
}var $botButton=$("<div/>").addClass("ScrollbarButton sf-element sf-element-scroll-bar-button "+(isVertical?"sfpc-bottom":"sfpc-right")).appendTo($scrollbarDiv);
var $topButton=$("<div/>").addClass("ScrollbarButton sf-element sf-element-scroll-bar-button "+(isVertical?"sfpc-top":"sfpc-left")).appendTo($scrollbarDiv);
var svgUrl="Images/Controls/ScrollbarArrowDown.svg";Spotfire.getSvg(svgUrl,function($svg){$svg[0].setAttribute("preserveAspectRatio","xMidYMid slice");
$svg.css("width","100%");$svg.css("height","100%");var $topSvg=$svg.clone();var $topPolygon=$topSvg.find("polygon");
var $botPolygon=$svg.find("polygon");if($topPolygon.length>0&&$botPolygon.length>0){if(isVertical){$topPolygon[0].setAttribute("transform","translate(0 12) scale(1 -1)");
}else{$topPolygon[0].setAttribute("transform","translate(12 0) rotate(90)");$botPolygon[0].setAttribute("transform","translate(0 12) rotate(-90)");
}}$botButton.append($svg);$topButton.append($topSvg);});if(isVertical){$botButton.css({bottom:"0",left:"0"});
$topButton.css({top:"0",left:"0"});}else{$botButton.css({right:"0",top:"0"});$topButton.css({left:"0",top:"0"});
}var setScrollPosFromHandlePos;var drawHandles=function(){var cssPropPos=isVertical?"top":"left";var cssPropLength=isVertical?"height":"width";
var setScrollPos=isVertical?virtualScrollArea.scrollTop.bind(virtualScrollArea):virtualScrollArea.scrollLeft.bind(virtualScrollArea);
var scrollAreaLength=isVertical?virtualScrollArea.get(0).scrollHeight:virtualScrollArea.get(0).scrollWidth;
var scrollAreaVisibleLength=isVertical?virtualScrollArea.innerHeight():virtualScrollArea.innerWidth();
var scrollBarInnerLength=isVertical?$scrollbarDiv.innerHeight():$scrollbarDiv.innerWidth();var scrollPosition=isVertical?virtualScrollArea.scrollTop():virtualScrollArea.scrollLeft();
var defaultButtonSize=(scrollbarWidth+2*sidePadding);var minHandleLength=scrollbarWidth*2;buttonSize=defaultButtonSize;
if(2*defaultButtonSize>(scrollBarInnerLength-3)){buttonSize=(scrollBarInnerLength-2)/2;}$botButton.css({width:buttonSize+"px",height:defaultButtonSize+"px"});
$topButton.css({width:buttonSize+"px",height:defaultButtonSize+"px"});buttonSize+=1;scrollBarInnerLength-=2*buttonSize;
var scrollbarHandleLength=Math.max(scrollBarInnerLength/scrollAreaLength*scrollAreaVisibleLength,minHandleLength);
var actualLength=scrollbarHandleLength-2*scrollbarBorderWidth;var coefficient=(scrollBarInnerLength-scrollbarHandleLength)/(scrollAreaLength-scrollAreaVisibleLength);
var scrollHandlePos=(scrollPosition*coefficient)+buttonSize;setScrollPosFromHandlePos=function(pos){var scrollPos=(pos-buttonSize)/coefficient;
setScrollPos(scrollPos);};$handle.css(cssPropPos,scrollHandlePos+"px");$handle.css(cssPropLength,actualLength+"px");
if(actualLength>=(scrollBarInnerLength-3)){$handle.css({opacity:0,cssPropLength:"1px"});}else{$handle.css("opacity",1);
}};var isscrolling;var $currentScroll;var handleMousemove=function(ev){if(isscrolling){if($currentScroll){var pos=isVertical?(ev.pageY-$scrollbarDiv.yStart):(ev.pageX-$scrollbarDiv.xStart);
setScrollPosFromHandlePos(pos);}drawHandles();}};var mousemove=_.throttle(handleMousemove,50,{leading:true,trailing:true});
var mouseup=function(){isscrolling=false;$(document).off("mouseup",mouseup);$(document).off("mousemove",mousemove);
$.each(scrollendfn(),function(){$(document).off("mouseup",this);});if($currentScroll){$currentScroll.off("mouseup",mouseup);
$currentScroll.off("mousemove",mousemove);}$currentScroll=null;};var onmousedown=function(ev){$currentScroll=$(ev.currentTarget);
isscrolling=true;$scrollbarDiv.yStart=ev.pageY-$handle.position().top;$scrollbarDiv.xStart=ev.pageX-$handle.position().left;
$currentScroll.on("mouseup",mouseup);$currentScroll.on("mousemove",mousemove);$(document).on("mouseup",mouseup);
$(document).on("mousemove",mousemove);$.each(scrollendfn(),function(){$(document).on("mouseup",this);
});};var onscrollwheel=function(e){if(isScrollWheelDisabled()){return;}var scrolltop=virtualScrollArea.scrollTop();
virtualScrollArea.scrollTop(virtualScrollArea.scrollTop()+e.scrollWheelY*baseScrollWheelStepSize);if(scrolltop!==virtualScrollArea.scrollTop()){virtualScrollArea.trigger("scroll");
e.stopPropagation();}};var pagingdirection;var mousedownTimer;var ispaging;var singleLinePaging;var pagingpaused;
var lastposition;var pagingelement;var dopaging=function(){if(!ispaging||pagingpaused){return;}var ls=lineSize();
var innerHeight=virtualScrollArea.innerHeight();var pagesizeVertical=pageSize?pageSize.height:Math.max(1,innerHeight-ls-(innerHeight%ls));
var innerWidth=virtualScrollArea.innerWidth();var pagesizeHorizontal=pageSize?pageSize.width:Math.max(1,innerWidth-13-(innerWidth%13));
if(singleLinePaging){pagesizeVertical=ls;pagesizeHorizontal=13;}pagesizeVertical=Math.max(1,pagesizeVertical);
pagesizeHorizontal=Math.max(1,pagesizeHorizontal);if(pagingdirection==="up"&&lastposition&&lastposition.y<$handle.offset().top){virtualScrollArea.scrollTop(virtualScrollArea.scrollTop()-pagesizeVertical);
}if(pagingdirection==="down"&&lastposition&&lastposition.y>$handle.offset().top+$handle.outerHeight()){virtualScrollArea.scrollTop(virtualScrollArea.scrollTop()+pagesizeVertical);
}if(pagingdirection==="left"&&lastposition&&lastposition.x<$handle.offset().left){virtualScrollArea.scrollLeft(virtualScrollArea.scrollLeft()-pagesizeHorizontal);
}if(pagingdirection==="right"&&lastposition&&lastposition.x>$handle.offset().left+$handle.outerHeight()){virtualScrollArea.scrollLeft(virtualScrollArea.scrollLeft()+pagesizeHorizontal);
}};var onpagingpause=function(){pagingpaused=true;};var onpagingresume=function(){pagingpaused=false;
};var onpagingmousemove=function(e){lastposition=new Point(e.pageX,e.pageY);};var onpagingstop=function(e){ispaging=false;
pagingpaused=false;$(document).off("mouseup",onpagingstop);pagingelement.off("mouseleave",onpagingpause);
pagingelement.off("mouseenter",onpagingresume);pagingelement.off("mousemove",onpagingmousemove);$.each(scrollendfn(),function(){$(document).off("mouseup",this);
});pagingdirection=null;if(mousedownTimer){window.clearInterval(mousedownTimer);}mousedownTimer=null;
};var onpagingstart=function(e){var handleOffset=$handle.offset();if($(e.target).hasClass("ScrollbarHandle")||(isVertical&&e.pageY>=handleOffset.top&&e.pageY<=handleOffset.top+$handle.outerHeight())||(!isVertical&&e.pageX>=handleOffset.left&&e.pageX<=handleOffset.left+$handle.outerWidth())){return;
}singleLinePaging=$(e.target).is(".sf-element-scroll-bar-button, .sf-element-scroll-bar-button *");pagingelement=$(this);
ispaging=true;pagingpaused=false;pagingelement.on("mouseleave",onpagingpause);pagingelement.on("mouseenter",onpagingresume);
pagingelement.on("mousemove",onpagingmousemove);lastposition=new Point(e.pageX,e.pageY);$(document).on("mouseup",onpagingstop);
$.each(scrollendfn(),function(){$(document).on("mouseup",this);});if(isVertical){if(e.pageY<handleOffset.top){pagingdirection="up";
}else{pagingdirection="down";}}else{if(e.pageX<handleOffset.left){pagingdirection="left";}else{pagingdirection="right";
}}var initialScrollWaitTime=300;var mousedownScrollTime=singleLinePaging?100:50;if(!mousedownTimer){window.setTimeout(function(){if(!mousedownTimer&&ispaging===true){mousedownTimer=window.setInterval(dopaging,mousedownScrollTime);
}},initialScrollWaitTime);}dopaging();};if(!Spotfire.capabilities.supportsTouch()){$handle.on("mousedown",onmousedown);
if(isVertical){$scrollbarDiv.on("scrollwheel",onscrollwheel);}if(options.virtualScroller){options.virtualScroller.onScroll(drawHandles);
}$scrollbarDiv.on("mousedown",onpagingstart);}return{drawHandles:function(){drawHandles();},isScrolling:function(){return isscrolling||ispaging;
},destroy:function(){$handle.off("mousedown",onmousedown);$scrollbarDiv.off("scrollwheel",onscrollwheel);
$scrollbarDiv.off("mousedown",onpagingstart);}};}function Scrollable($parent,options){var parentTop=$parent.position().top;
var scrollbarWidth=options.width;var sidePadding=options.sidePadding;var allowResize=options.allowResize;
var isScrollWheelDisabled=options.isScrollWheelDisabled||function(){return false;};var mousewheelLines=options.mouseWheelLines||3;
var lineSize=options.lineSize||function(){return 13;};var baseScrollWheelStepSize=options.lineSize?lineSize()*mousewheelLines:40;
var scrollendfn=[];var previousOuterWidth=0;var previousOuterHeight=0;var overflowX=$parent.css("overflow-x");
var overflowY=$parent.css("overflow-y");var zIndex=$parent.css("z-index");var $wrapper;var $container,$verticalContainer,$horizontalContainer;
var verticalScrollbar,horizontalScrollbar;var virtualScroller;if(!Spotfire.capabilities.supportsTouch()){$wrapper=$("<div/>").addClass("StyledScrollbar");
$parent.css("overflow-x","hidden");$parent.css("overflow-y","hidden");if(options.cssClass){$wrapper.addClass(options.cssClass);
}$wrapper.insertAfter($parent).append($parent);$container=$parent;virtualScroller=options.virtualScroller||$container;
if(options.scrollTop){virtualScroller.scrollTop(options.scrollTop);}if(options.scrollLeft){virtualScroller.scrollLeft(options.scrollLeft);
}if(options.adaptContentToScrollbar){$parent.width($parent.width()+scrollbarWidth+2*sidePadding);}$verticalContainer=$("<div />").css("z-index",zIndex);
$horizontalContainer=$("<div />").css("z-index",zIndex);$verticalContainer.appendTo($wrapper);$horizontalContainer.appendTo($wrapper);
$verticalContainer.css("top",parentTop+"px");verticalScrollbar=Scrollbar(virtualScroller,$verticalContainer,options,function(){return scrollendfn;
},"vertical");horizontalScrollbar=Scrollbar(virtualScroller,$horizontalContainer,options,function(){return scrollendfn;
},"horizontal");}var drawHandles=function(){verticalScrollbar.drawHandles();horizontalScrollbar.drawHandles();
};var isVerticalScrollbarVisible=function(){if(Spotfire.capabilities.supportsTouch()||overflowY==="hidden"){return false;
}return overflowY==="scroll"||(overflowY==="auto"&&virtualScroller.get(0).scrollHeight>$container.outerHeight());
};var isHorizontalScrollbarVisible=function(){if(Spotfire.capabilities.supportsTouch()||overflowX==="hidden"){return false;
}return overflowX==="scroll"||(overflowX==="auto"&&virtualScroller.get(0).scrollWidth>$container.outerWidth());
};var getVerticalScrollbarWidth=function(ignorevisible){if(ignorevisible||isVerticalScrollbarVisible()){return $verticalContainer.outerWidth();
}return 0;};var getHorizontalScrollbarWidth=function(ignorevisible){if(ignorevisible||isHorizontalScrollbarVisible()){return $horizontalContainer.outerHeight();
}return 0;};var setScrollbarVisibility=function(fullOuterWidth,fullOuterHeight){if(allowResize){$container.outerWidth(fullOuterWidth-getVerticalScrollbarWidth());
$container.outerHeight(fullOuterHeight-getHorizontalScrollbarWidth());}previousOuterWidth=$container.outerWidth();
previousOuterHeight=$container.outerHeight();$verticalContainer.offset({top:$container.offset().top});
$horizontalContainer.css("left",$container.position().left+"px");$verticalContainer.css("left",$container.position().left+$container.outerWidth()-(allowResize?0:getVerticalScrollbarWidth())+"px");
$horizontalContainer.css("top",$container.position().top+$container.outerHeight()-(allowResize?0:getHorizontalScrollbarWidth())+"px");
$verticalContainer.css("display",isVerticalScrollbarVisible()?"block":"none");$horizontalContainer.css("display",isHorizontalScrollbarVisible()?"block":"none");
};var onscrollwheel=function(e){if(isScrollWheelDisabled()){return;}var scrolltop=virtualScroller.scrollTop();
virtualScroller.scrollTop(virtualScroller.scrollTop()+e.scrollWheelY*baseScrollWheelStepSize);if(scrolltop!==virtualScroller.scrollTop()){virtualScroller.trigger("scroll");
e.stopPropagation();}};var getFullOuterWidth=function(){if($container.outerWidth()===previousOuterWidth&&$verticalContainer.css("display")==="block"){return $container.outerWidth()+getVerticalScrollbarWidth(true);
}return $container.outerWidth();};var getFullOuterHeight=function(){if($container.outerHeight()===previousOuterHeight&&$horizontalContainer.css("display")==="block"){return $container.outerHeight()+getVerticalScrollbarWidth(true);
}return $container.outerHeight();};var refresh=function(){if(Spotfire.capabilities.supportsTouch()){return;
}var fullOuterWidth=getFullOuterWidth();var fullOuterHeight=getFullOuterHeight();$verticalContainer.outerHeight(fullOuterHeight-getHorizontalScrollbarWidth());
$horizontalContainer.outerWidth(fullOuterWidth-getVerticalScrollbarWidth());var hVisible=isHorizontalScrollbarVisible();
var vVisible=isVerticalScrollbarVisible();if((hVisible||vVisible)&&!(hVisible&&vVisible)){setScrollbarVisibility(fullOuterWidth,fullOuterHeight);
if(vVisible){$verticalContainer.outerHeight(fullOuterHeight-getHorizontalScrollbarWidth());}else{$horizontalContainer.outerWidth(fullOuterWidth-getVerticalScrollbarWidth());
}}setScrollbarVisibility(fullOuterWidth,fullOuterHeight);$wrapper.height($container.outerHeight());$wrapper.width($container.outerWidth());
$wrapper.css({top:$container.position().top+"px",left:$container.position().left+"px"});drawHandles();
};var onrefresh=function(){refresh();$parent.find("img").each(function(){if(!this.complete){$(this).one("load",refresh);
}});};if(!Spotfire.capabilities.supportsTouch()){$container.on("scrollwheel",onscrollwheel);$container.on("scroll",drawHandles);
refresh();}if($container){$container.on("resize",onrefresh);$container.on("panelResize",onrefresh);$container.on("sf-refresh-scrollbar",onrefresh);
}return{scrollend:function(fn){scrollendfn.push(fn);},isScrolling:function(){return verticalScrollbar.isScrolling()||horizontalScrollbar.isScrolling();
},getVScrollbarSize:function(ignorevisible){if(Spotfire.capabilities.supportsTouch()){return 0;}return getVerticalScrollbarWidth(ignorevisible);
},getHScrollbarSize:function(ignorevisible){if(Spotfire.capabilities.supportsTouch()){return 0;}return getHorizontalScrollbarWidth(ignorevisible);
},refresh:onrefresh,scrollLeft:function(value){if(Spotfire.capabilities.supportsTouch()){return 0;}if(typeof value==="number"){return virtualScroller.scrollLeft(value);
}return virtualScroller.scrollLeft();},scrollTop:function(value){if(Spotfire.capabilities.supportsTouch()){return 0;
}if(typeof value==="number"){virtualScroller.scrollTop(value);}return virtualScroller.scrollTop();},destroy:function(){if(!Spotfire.capabilities.supportsTouch()){verticalScrollbar.destroy();
horizontalScrollbar.destroy();$container.off("scrollwheel",onscrollwheel);$container.off("scroll",drawHandles);
$container.off("resize",onrefresh);$container.off("panelResize",onrefresh);$container.off("textAreaUpdate",onrefresh);
$container.width($container.width()+getVerticalScrollbarWidth());$container.height($container.height()+getHorizontalScrollbarWidth());
$container.css({"overflow-x":overflowX,"overflow-y":overflowY});$container.insertAfter($wrapper);$wrapper.remove();
$container.data("scrollbar",null);}}};}$.fn.StyledScrollbar=function(options){var obj=null;if(options&&typeof options==="string"){if(options==="refresh"){var bar=this.data("scrollbar");
if(bar){bar.refresh();}}else{if(options==="close"){var tmp=this.data("scrollbar");if(tmp){tmp.destroy();
}this.data("scrollbar",null);}}return this;}obj=this.data("scrollbar");if(!obj){var settings=$.extend({handleBorderWidth:1,width:10,sidePadding:1,position:"",scrollTop:0,scrollLeft:0,adaptContentToScrollbar:false},options);
obj=new Scrollable(this,settings);this.data("scrollbar",obj);}return obj;};}(jQuery));$(function(){var ACTION_NONE="none";
var ACTION_ADD="add";var ACTION_REPLACE="replace";var ACTION_REMOVE="remove";var VISIBLE_STATE_ABOVE="above";
var VISIBLE_STATE_VISIBLE="visible";var VISIBLE_STATE_BELOW="below";var DIV_MAXHEIGHT=1000000;var createDefaultSettings=function(){var noop=function(){};
var createListItem=function(top,settings){var $itemDiv=$("<div/>").addClass(settings.listItemClass);if(settings.setListItemCssHeight){$itemDiv.css({top:top+"px",height:settings.itemHeight+"px","line-height":settings.itemHeight+"px"});
}else{$itemDiv.css({top:top+"px"});}return $itemDiv;};var updateListItemSelected=function($item,selected){if(selected){$item.addClass("sfpc-selected");
}else{$item.removeClass("sfpc-selected");}};var updateListItem=function($item,index,item,hasValue,selected,itemHeight){var text=hasValue?item.Text:"...";
$item.text(text);$item.attr("title",text);var drawRightArrow=hasValue&&item.ContextMenu;if(drawRightArrow){var $arrow=$("<div/>").addClass("RightArrow").css({top:Math.floor((itemHeight-7)/2)+"px",right:"3px"});
$item.append($arrow);}else{$(".RightArrow",$item).remove();}updateListItemSelected($item,selected);};
var merge=function(that){var properties=["showImageMask","showSearchField","height","totalVisibleValues","itemHeight","multiSelect","togglingSelect","selectTopItemDisjointly","searchExpression","onSelectionChanged","onGetValues","onScrollToSubString","onSearch","onShowContextMenu","isScrollWheelDisabled","updateContainerToFitLongestItem","longestItemWidth","allowDragDrop","onDragDrop","populateDragData","sendSelectionAfterKeyboardMovement","sendSelectionOnUpdate","handleKeyEnter","viewportClass","listItemClass","setListItemCssHeight","searchFieldDelay","disableWebPlayerScrollDelay"];
var i,name,value;for(i=0;i<properties.length;i++){name=properties[i];value=that[name];if(value!==undefined){this[name]=value;
}}if(that.itemManager){this.createListItem=that.itemManager.createListItem;this.updateListItem=that.itemManager.updateListItem;
this.updateListItemSelected=that.itemManager.updateListItemSelected;}else{if(that.itemManager===null||this.createListItem===undefined){this.createListItem=createListItem;
this.updateListItem=updateListItem;this.updateListItemSelected=updateListItemSelected;}}};var settings={merge:merge,height:3,totalVisibleValues:0,itemHeight:15,multiSelect:false,togglingSelect:false,selectTopItemDisjointly:false,showImageMask:false,showSearchField:false,searchExpression:"",onSelectionChanged:noop,onGetValues:noop,onScrollToSubString:undefined,onSearch:noop,onShowContextMenu:noop,updateContainerToFitLongestItem:false,longestItemWidth:0,allowDragDrop:false,onDragDrop:noop,populateDragData:noop,sendSelectionAfterKeyboardMovement:true,sendSelectionOnUpdate:true,handleKeyEnter:false,viewportClass:"sf-element-list-box sfc-scrollable",listItemClass:"sf-element-list-box-item",setListItemCssHeight:true,disableWebPlayerScrollDelay:false,updateListItem:updateListItem,updateListItemSelected:updateListItemSelected,createListItem:createListItem,};
return settings;};function VirtualListBox(parentSelector,settings,keyboardInteractionSelector){var styledScrollbar,getTopIndex;
var $parent=$(parentSelector).addClass("VirtualListBox").empty();var selectAction=ACTION_NONE;var currentMarkItem=-1;
var anchorMarkItem=-1;var items;var selection;var scrollTimer;var scrollDelay=0;var autoScrollInterval;
var selectTimer;var selectDelay=0;var $progressIndicator;var progressTimer;var keyboardState={alt:false,control:false,shift:false};
var selectionBuffer=[];var searchFieldAppended=false;var inputField;var isMaxScroll=function(){return Spotfire.capabilities.supportsTouch()&&settings.totalVisibleValues*settings.itemHeight>DIV_MAXHEIGHT;
};var $container=$("<div/>").addClass("ListContainer").attr("draggable",false).attr("align","left");var $viewport=$("<div/>").addClass(settings.viewportClass);
var $scrollArea=$("<div/>").addClass("ScrollArea");var $listItems=$("<div/>").addClass("ListItems");$viewport.append($scrollArea);
$scrollArea.append($listItems);$container.append($viewport);$parent.append($container);var $imageMask;
if(settings.showImageMask){$imageMask=$("<div/>").addClass("Image");$container.append($imageMask);}var showProgress=function(){if(!$progressIndicator&&!progressTimer){progressTimer=setTimeout(function(){$progressIndicator=$(Spotfire.Progress.createProgressAnimation($viewport.innerWidth(),$viewport.innerHeight()));
$container.append($progressIndicator);progressTimer=null;},1000);}};var hideProgress=function(){if(progressTimer){clearTimeout(progressTimer);
progressTimer=null;}if($progressIndicator){$progressIndicator.remove();$progressIndicator=null;}};var refresh;
var currentItemHeight;var performLayout=function(){vScroller.update(new Size(0,settings.totalVisibleValues*settings.itemHeight),new Size(0,settings.height*settings.itemHeight));
var scrollBarWidth=!Spotfire.capabilities.supportsTouch()&&settings.totalVisibleValues>settings.height?styledScrollbar.getVScrollbarSize(true):0;
var imageWidth=settings.showImageMask?3:0;if(settings.updateContainerToFitLongestItem){var parentWidth=settings.longestItemWidth+imageWidth*2+scrollBarWidth+2;
var marginHackDueToCSS=25;$parent.width(parentWidth+marginHackDueToCSS);}var containerWidth=Math.max(0,$parent.width());
var viewportWidth=Math.max(0,containerWidth-imageWidth-(settings.showImageMask?3:0));var viewportHeight=settings.height*settings.itemHeight;
var scrollAreaWidth=Math.max(0,viewportWidth-scrollBarWidth-2);$viewport.css({width:Math.max(0,viewportWidth-2)+"px",height:viewportHeight+"px"});
$container.css({width:containerWidth+"px",height:$viewport.sfBoxHeight()+"px"});var viewportBottomPadding=parseInt($viewport.css("padding-bottom"),10)||0;
var scrollAreaHeight=Spotfire.capabilities.supportsTouch()?((isMaxScroll()?DIV_MAXHEIGHT:settings.totalVisibleValues*settings.itemHeight)+viewportBottomPadding):((Math.min(settings.height+1,settings.totalVisibleValues)*settings.itemHeight)+viewportBottomPadding);
$scrollArea.css({width:scrollAreaWidth+"px",height:scrollAreaHeight+"px"});if(settings.showImageMask){$imageMask.css({left:(viewportWidth+3)+"px",width:imageWidth+"px",height:viewportHeight+2+"px"});
}var $overlay=$("<div/>").addClass("DropOverlay");var $indicator=$("<div/>").addClass("DropIndicator");
var cleanUp=function(){$overlay.off().hide();$indicator.off().hide();};var dragDropCss={overlay:function($div){var slightlyBiggerOverlay=2;
return{height:$div.outerHeight()+2*slightlyBiggerOverlay,width:$div.outerWidth(),left:$div.position().left,top:$div.position().top-slightlyBiggerOverlay};
},indicatorAbove:function($div){return{top:$div.position().top-1,width:$div.width(),left:5,height:0};
},indicatorBelow:function($div){return{top:$div.position().top+$div.outerHeight()-1,width:$div.width(),left:5,height:0};
}};if(settings.allowDragDrop){Spotfire.DragDrop.makeScrollableByDrag($viewport);}var listItemClass=settings.listItemClass;
var numberOfListItems=Math.ceil(settings.height)+1;var reCreateListItems=$("."+listItemClass,$listItems).length!==numberOfListItems||currentItemHeight!==settings.itemHeight;
if(reCreateListItems){$listItems.empty();currentItemHeight=settings.itemHeight;var top=0,i,$itemDiv;for(i=0;
i<numberOfListItems;i++){$itemDiv=settings.createListItem(top,settings);if(settings.allowDragDrop){(function(){var current_index=i;
var div=$itemDiv;var destination=function(pageY,above,below){var yFraction=(pageY-div.offset().top)/div.height();
return(yFraction<0.5)?above:below;};Spotfire.DragDrop.makeDraggable(div,{abortOnModifierKeys:true,effectAllowed:"move",populateData:function(data){if(settings.populateDragData){settings.populateDragData(data,getTopIndex()+current_index);
}selectAction=ACTION_NONE;anchorMarkItem=-1;currentMarkItem=-1;refresh();},dragEnd:function(){anchorMarkItem=-1;
currentMarkItem=-1;selectAction=ACTION_NONE;cleanUp();}});var prevPageY;Spotfire.DragDrop.makeDroppable(div,{onDragOver:function(e,data){cleanUp();
$overlay.css(dragDropCss.overlay(div)).insertAfter(div).show();$indicator.insertAfter(div).show();var onDragOverCallback=function(e){var cssFunc=destination(e.pageY,dragDropCss.indicatorAbove,dragDropCss.indicatorBelow);
$indicator.css(cssFunc(div));prevPageY=e.pageY;};Spotfire.DragDrop.makeDroppable($overlay,{onDragOver:function(e){onDragOverCallback(e);
},onDrop:function(){cleanUp();var foo=getTopIndex()+current_index;settings.onDragDrop(data,destination(prevPageY,foo,foo+1));
},onDragLeave:function(){cleanUp();}});onDragOverCallback(e);}});}());}$listItems.append($itemDiv);top=top+settings.itemHeight;
}}var $items=$("."+listItemClass,$listItems);var spacing=$items.first().outerWidth()-$items.first().width();
$items.width(Math.max(0,scrollAreaWidth-spacing));if(settings.showSearchField){if(!searchFieldAppended){var $searchInput=$("<input type='text' draggable='false' />").addClass("SearchInput sf-element-input");
Spotfire.Prompt.suppressFormsAcceptCommandIfFocused($searchInput);var $searchImage=$("<div />").addClass("VirtualBoxMagnifier");
$parent.prepend($searchImage);$parent.prepend($searchInput);searchFieldAppended=true;var initializeInputField;
var searchFieldDelay=settings.searchFieldDelay;if(settings.hasOwnProperty("searchFieldDelay")){initializeInputField=Spotfire.Controls.InputField.initializeWithTimeout;
}else{initializeInputField=Spotfire.Controls.InputField.initialize;}inputField=initializeInputField($searchInput,Spotfire.Localization.resources.ListBoxFilterTypeToSearch,function(pattern){settings.searchExpression=pattern;
settings.onSearch(pattern);},searchFieldDelay);Spotfire.Filters.StyledFilters.createMagnifierGlass($searchImage);
$searchInput.on("mouseenter",function(){$searchImage.addClass("Hover");});$searchInput.on("mouseleave",function(){$searchImage.removeClass("Hover");
});$searchInput.on("focus",function(){$searchImage.addClass("Focus");});$searchInput.on("blur",function(){$searchImage.removeClass("Focus");
});$searchImage.on("click",function(){inputField.submit();});}inputField.update(settings.searchExpression);
var $inputFieldElement=inputField.element();var horizontalPadding=$inputFieldElement.outerWidth(true)-$inputFieldElement.width();
$inputFieldElement.width(Math.max(0,containerWidth-horizontalPadding));}else{if(searchFieldAppended){inputField.element().remove();
searchFieldAppended=false;}}styledScrollbar.refresh();};var sendSelection=function(){if(items===undefined){return false;
}if(settings.multiSelect){var toSend=[];var i;for(i=0;i<selectionBuffer.length;++i){if(selectionBuffer[i].operation===ACTION_REPLACE){toSend=[];
}toSend.push(selectionBuffer[i]);}settings.onSelectionChanged(toSend);}else{var item=items[anchorMarkItem];
if(item!==undefined&&item!==null&&item.ContextMenu){var $item=$($("."+settings.listItemClass,$listItems).get(anchorMarkItem-getTopIndex()));
var pos=$item.offset();pos.left+=$item.width();settings.onShowContextMenu(anchorMarkItem,pos);selectDelay=0;
}else{settings.onSelectionChanged(anchorMarkItem,item);}}selectionBuffer=[];};var getScrollFactor=function(){if(isMaxScroll()){var maxDivScroll=DIV_MAXHEIGHT-$viewport.height();
var maxModelScroll=settings.totalVisibleValues*settings.itemHeight-$viewport.height();return maxDivScroll/maxModelScroll;
}return 1;};var setScrollPosition=function(pos){vScroller.scrollTop(pos);};var setTopIndex=function(index){setScrollPosition(index*settings.itemHeight*getScrollFactor());
};var getScrollPosition=function(){return vScroller.scrollTop();};getTopIndex=function(){if(isMaxScroll()){return Math.max(0,Math.floor(((getScrollPosition()/getScrollFactor())/settings.itemHeight)+0.5));
}return Math.max(0,Math.floor(getScrollPosition()/settings.itemHeight));};var getItemIndex=function(y){var offsetY=y-$viewport.offset().top-parseInt($viewport.css("padding-top"),10);
var index=isMaxScroll()?getTopIndex()+Math.floor(offsetY/settings.itemHeight):Math.floor((offsetY+getScrollPosition())/settings.itemHeight);
return Math.min(settings.totalVisibleValues-1,index);};var isSelected=function(index){if(items===undefined){return false;
}var selected=false;if(typeof items[index]!=="undefined"){selected=items[index].Selected;}if(typeof selection[index]!=="undefined"){selected=selection[index];
}if(settings.multiSelect&&selectAction!==ACTION_NONE){var low=Math.min(anchorMarkItem,currentMarkItem);
var high=Math.max(anchorMarkItem,currentMarkItem);if(index>=low&&index<=high){return selectAction!==ACTION_REMOVE;
}return selected&&selectAction!==ACTION_REPLACE;}return selected;};var refreshSelection=function(){if(items===undefined){return;
}var topIndex=getTopIndex();$("."+settings.listItemClass,$listItems).each(function(i,elem){var $item=$(elem);
var index=i+topIndex;var hasValue=typeof items[index]!=="undefined";var selected=hasValue?isSelected(index):false;
settings.updateListItemSelected($item,selected);});};refresh=function(){if(items===undefined){return;
}var scrollPosition=getScrollPosition();var remainder=isMaxScroll()?0:Math.floor(scrollPosition%settings.itemHeight);
var listItemTop=Spotfire.capabilities.supportsTouch()?scrollPosition:0;$listItems.css("top",(listItemTop-remainder)+"px");
var topIndex=getTopIndex();$("."+settings.listItemClass,$listItems).each(function(i,elem){var $item=$(elem);
var index=i+topIndex;var item=items[index];var hasValue=typeof item!=="undefined";var selected=hasValue?isSelected(index):false;
settings.updateListItem($item,index,item,hasValue,selected,settings.itemHeight);});};var lastLow=null;
var lastHigh=null;var fetchGeneration=0;var lastReceivedGeneration=0;var fetchData=function(forceFetch){if(settings.totalVisibleValues<1){hideProgress();
return;}var getVisibleValuesCallback=function(result){if(result.GetValuesGeneration<lastReceivedGeneration){return;
}lastReceivedGeneration=result.GetValuesGeneration;items={};var i;for(i=0;i<result.Items.length;i++){items[i+result.TopIndex]=result.Items[i];
}scrollDelay=0;refresh();hideProgress();};var low=getTopIndex();var high=Math.min(settings.totalVisibleValues-1,low+Math.ceil(settings.height));
if(!forceFetch&&lastLow===low&&lastHigh===high){scrollDelay=0;return;}lastLow=low;lastHigh=high;fetchGeneration++;
settings.onGetValues(low,high,fetchGeneration,getVisibleValuesCallback);};var autoScroll=function(outside){window.clearInterval(autoScrollInterval);
if(outside!==0){var tick=function(){setScrollPosition(getScrollPosition()+outside);};autoScrollInterval=window.setInterval(tick,25);
}};var getOutside=function(mouseY){var topY=$viewport.offset().top;var bottomY=topY+$viewport.height();
var outside=0;if(mouseY<topY){outside=mouseY-topY;}else{if(mouseY>bottomY){outside=mouseY-bottomY;}}return outside;
};var scheduleSelectionChanged=function(){if(selectTimer){window.clearTimeout(selectTimer);}selectTimer=window.setTimeout(sendSelection,selectDelay);
selectDelay=Spotfire.isWebPlayer()?500:0;};var clearSelection=function(){selection={};var index;for(index in items){items[index].Selected=false;
}};var selectBetween=function(firstIndex,secondIndex,operation){if(operation===ACTION_REPLACE){clearSelection();
}var low=Math.min(firstIndex,secondIndex);var high=Math.max(firstIndex,secondIndex);if(settings.selectTopItemDisjointly){if(low===0&&high>0){low=1;
}}var i;for(i=low;i<=high;i++){selection[i]=operation!==ACTION_REMOVE;}selectionBuffer.push({operation:operation,low:low,high:high});
};var hasValidAnchorPosition=function(){return anchorMarkItem>=0&&anchorMarkItem<settings.totalVisibleValues;
};var getClampedIndex=function(index){return Math.min(Math.max(index,0),settings.totalVisibleValues-1);
};var setMarkPosition=function(value){anchorMarkItem=value;if(anchorMarkItem>=settings.totalVisibleValues){anchorMarkItem=settings.totalVisibleValues-1;
}else{if(anchorMarkItem<0){anchorMarkItem=0;}}};var noop=function(){};var moveUpUntilSelectable=noop;
var moveDownUntilSelectable=noop;var getVisibleState=function(itemIndex){var topIndex=getTopIndex();var visible=itemIndex>=topIndex&&itemIndex<(topIndex+settings.height);
if(visible){return VISIBLE_STATE_VISIBLE;}if(itemIndex<topIndex){return VISIBLE_STATE_ABOVE;}return VISIBLE_STATE_BELOW;
};var ensureVisible=function(indexToDisplay){var visibleState=getVisibleState(indexToDisplay);switch(visibleState){case VISIBLE_STATE_VISIBLE:break;
case VISIBLE_STATE_ABOVE:setTopIndex(getClampedIndex(indexToDisplay+2-settings.height));break;case VISIBLE_STATE_BELOW:setTopIndex(getClampedIndex(indexToDisplay-1));
break;}};var handleMarkingAfterKeyboardMovement=function(){if(!settings.multiSelect||(settings.multiSelect&&!keyboardState.shift)){selectBetween(currentMarkItem,currentMarkItem,ACTION_REPLACE);
anchorMarkItem=currentMarkItem;}else{selectBetween(currentMarkItem,anchorMarkItem,ACTION_REPLACE);}if(settings.sendSelectionAfterKeyboardMovement){scheduleSelectionChanged();
}};var makeMarkItemVisibleAndMark=function(){ensureVisible(currentMarkItem);handleMarkingAfterKeyboardMovement();
refresh();};var moveKeyboardPositionUp=function(steps){currentMarkItem=getClampedIndex(currentMarkItem-steps);
moveUpUntilSelectable();makeMarkItemVisibleAndMark();};var moveKeyboardPositionDown=function(steps){currentMarkItem=getClampedIndex(currentMarkItem+steps);
moveDownUntilSelectable();makeMarkItemVisibleAndMark();};var onArrowKeyUp=function(){if(!hasValidAnchorPosition()){setMarkPosition(0);
}else{moveKeyboardPositionUp(1);}};var onArrowKeyDown=function(){if(!hasValidAnchorPosition()){setMarkPosition(0);
}else{moveKeyboardPositionDown(1);}};var onKeyPageUp=function(){if(!hasValidAnchorPosition()){setMarkPosition(0);
}else{moveKeyboardPositionUp(settings.height);}};var onKeyPageDown=function(){if(!hasValidAnchorPosition()){setMarkPosition(0);
}else{moveKeyboardPositionDown(settings.height);}};var onKeyHome=function(){currentMarkItem=0;makeMarkItemVisibleAndMark();
};var onKeyEnd=function(){currentMarkItem=settings.totalVisibleValues-1;makeMarkItemVisibleAndMark();
};var onKeyEnter=function(){scheduleSelectionChanged();};var updateControlKeyState=function(e){keyboardState.alt=e.altKey;
keyboardState.control=e.ctrlKey;keyboardState.shift=e.shiftKey;};var areaThatReactsToKeyboard=$(keyboardInteractionSelector||parentSelector);
Spotfire.Focus.handleKeyDown(areaThatReactsToKeyboard,function(e){updateControlKeyState(e);switch(e.keyCode){case Keys.UP:onArrowKeyUp();
break;case Keys.DOWN:onArrowKeyDown();break;case Keys.PAGEUP:onKeyPageUp();break;case Keys.PAGEDOWN:onKeyPageDown();
break;case Keys.HOME:onKeyHome();break;case Keys.END:onKeyEnd();break;case 13:if(settings.handleKeyEnter){onKeyEnter();
e.preventDefault();e.stopPropagation();}break;}});if(settings.onScrollToSubString){Spotfire.Focus.handleKeyPress(areaThatReactsToKeyboard,function(e){if(keyboardState.alt||keyboardState.control){return;
}var str=String.fromCharCode(e.which);settings.onScrollToSubString(anchorMarkItem,str,function(markItem){if(markItem!==anchorMarkItem){currentMarkItem=markItem;
makeMarkItemVisibleAndMark();}});});}var onMouseMove=function(e){var y=e.pageY;currentMarkItem=getItemIndex(y);
autoScroll(getOutside(y));refresh();};var onMouseUp=function(e){if(anchorMarkItem>=0){if(settings.multiSelect){var y=e.pageY;
currentMarkItem=getItemIndex(y);autoScroll(0);selectBetween(anchorMarkItem,currentMarkItem,selectAction);
selectAction=ACTION_NONE;$(document.body).unbind("mousemove",onMouseMove);}refresh();scheduleSelectionChanged();
}$(document.body).unbind("mouseup",onMouseUp);};var onMouseDown=function(e){if(e.which!==1){return;}var itemIndex=getItemIndex(e.pageY);
var doRefresh=true;if(settings.multiSelect){if(anchorMarkItem===-1){anchorMarkItem=itemIndex;}if(settings.togglingSelect){selectAction=isSelected(itemIndex)?ACTION_REMOVE:ACTION_ADD;
anchorMarkItem=itemIndex;currentMarkItem=itemIndex;}else{if(e.shiftKey){if(e.ctrlKey||e.metaKey){selectAction=ACTION_ADD;
}else{selectAction=ACTION_REPLACE;}currentMarkItem=itemIndex;}else{if(e.ctrlKey||e.metaKey||Spotfire.capabilities.supportsTouch()){selectAction=isSelected(itemIndex)?ACTION_REMOVE:ACTION_ADD;
anchorMarkItem=itemIndex;currentMarkItem=itemIndex;}else{var selected=isSelected(itemIndex);if(settings.allowDragDrop){doRefresh=!selected;
if(!selected){selectBetween(itemIndex,itemIndex,ACTION_REPLACE);sendSelection();}}selectAction=ACTION_REPLACE;
anchorMarkItem=itemIndex;currentMarkItem=itemIndex;}}}if(!settings.allowDragDrop){$(document.body).mousemove(onMouseMove);
}}else{selection={};var index;for(index in items){items[index].Selected=false;}anchorMarkItem=itemIndex;
currentMarkItem=itemIndex;selection[anchorMarkItem]=true;if(settings.allowDragDrop){sendSelection();}}$(document.body).mouseup(onMouseUp);
if(doRefresh){refreshSelection();}};var onScroll=function(){refresh();if(scrollTimer){window.clearTimeout(scrollTimer);
}scrollTimer=window.setTimeout(function(){fetchData(false);},scrollDelay);scrollDelay=(!settings.disableWebPlayerScrollDelay&&Spotfire.isWebPlayer())?300:0;
};var update=function(other){if(other!==undefined){settings.merge(other);}selectDelay=0;if(selectionBuffer.length>0&&settings.sendSelectionOnUpdate){scheduleSelectionChanged();
return;}selectionBuffer=[];selection={};performLayout();showProgress();fetchData(true);};var updateMask=function(mask){$imageMask.attr("title",mask.ImageTooltip);
$imageMask.css("background-image",mask.ImageUrl);if(anchorMarkItem<0){anchorMarkItem=mask.FirstIndex+1;
currentMarkItem=mask.FirstIndex+1;}};var vScroller=Spotfire.Control.VirtualScroller.create();var supportsTouch=Spotfire.capabilities.supportsTouch();
styledScrollbar=$viewport.StyledScrollbar({cssClass:"ListContainerScroll",isScrollWheelDisabled:settings.isScrollWheelDisabled,lineSize:function(){return settings.itemHeight;
},virtualScroller:(supportsTouch?undefined:vScroller)});if(supportsTouch){var scroll=new IScroll($scrollArea.get(0),null,{hScrollbarEnabled:false});
scroll.onScroll=onScroll;vScroller={scrollTop:function(pos){if(typeof pos==="number"){scroll.scrollTop(pos);
}return scroll.scrollTop();},update:$.noop,onScroll:$.noop};}vScroller.onScroll(onScroll);$scrollArea.mousedown(onMouseDown);
var markAndScrollToIndex=function(markIndex,scrollIndex){anchorMarkItem=markIndex;currentMarkItem=markIndex;
ensureVisible(scrollIndex);handleMarkingAfterKeyboardMovement();refresh();};this.update=update;this.updateMask=updateMask;
this.ensureVisible=ensureVisible;this.itemHeight=function(){return settings.itemHeight;};this.height=function(){return settings.height;
};this.totalVisibleValues=function(){return settings.totalVisibleValues;};this.clearSelection=clearSelection;
this.markAndScrollToIndex=markAndScrollToIndex;this.setScrollPosition=setScrollPosition;this.adjustHeightToContainer=function($outerContainer,viewportSelector,extraHeight){if(viewportSelector===undefined){viewportSelector=".sfc-scrollable";
}var $scrollable=$parent.find(viewportSelector);var paddingAndBorders=$scrollable.outerHeight()-$scrollable.height();
var nonListBoxHeight=$parent.find(".SearchInput").outerHeight(true)+paddingAndBorders;if(extraHeight!==undefined){nonListBoxHeight+=extraHeight;
}var newHeight=($outerContainer.height()-nonListBoxHeight)/settings.itemHeight;this.update({height:newHeight});
};showProgress();performLayout();}Spotfire.registerNameSpace("Controls.VirtualListBox");Spotfire.Controls.VirtualListBox.create=function(parentSelector,settings,keyboardInteractionSelector){var s=createDefaultSettings();
s.merge(settings);return new VirtualListBox(parentSelector,s,keyboardInteractionSelector);};});$(function(){function VirtualScroller(){var scrollEvent=jQuery.Event("virtualScroll");
var scrollSize=new Size(0,0);var viewPortSize=new Size(0,0);var scrollPosY=0;var scrollPosX=0;var onScrollFn=[];
var setScrollPosY=function(pos){scrollPosY=Math.max(Math.min(scrollSize.height-viewPortSize.height,pos),0);
};var setScrollPosX=function(pos){scrollPosX=Math.max(Math.min(scrollSize.width-viewPortSize.width,pos),0);
};var trigger=function(vertical){$.each(onScrollFn,function(){this(scrollEvent,vertical?"vertical":"horizontal");
});};var obj={scrollTop:function(pos){if(typeof pos==="number"){setScrollPosY(pos);trigger(true);}else{return scrollPosY;
}},scrollLeft:function(pos){if(typeof pos==="number"){setScrollPosX(pos);trigger(false);}else{return scrollPosX;
}},get:function(){return{scrollHeight:scrollSize.height,scrollWidth:scrollSize.width};},innerHeight:function(){return viewPortSize.height;
},innerWidth:function(){return viewPortSize.width;},trigger:function(){trigger(true);},update:function(nScrollSize,nViewportSize){scrollSize=nScrollSize;
viewPortSize=nViewportSize;setScrollPosX(scrollPosX);setScrollPosY(scrollPosY);},scrollSize:function(){return scrollSize;
},onScroll:function(fn){onScrollFn.push(fn);}};return obj;}Spotfire.registerNameSpace("Control.VirtualScroller",{create:VirtualScroller});
});$(function(){Spotfire.registerNameSpace("Data.Access.AddData");function AddDataControl(webViewId,initSettings){var MEGAMENU=1,WELCOMEPAGE=2;
var mode=MEGAMENU;var dataTableToWorkOn;var dataDestination;var self={};var buttons=[];var connectorButtons=[];
var settings=initSettings;var connectorsInitialized=false;self.setMode=function(newMode){mode=newMode;
};self.isInitialized=function(){return connectorsInitialized;};var $panel,$container;var showDataSourceDialog=function(connector){var args={DisplayName:connector.DisplayName,TypeId:connector.TypeId,TargetTableId:dataTableToWorkOn,DataDestination:dataDestination};
Spotfire.Dxp.Web.Forms.AjaxService.Modify(webViewId,"ConnectorSelected",JSON.stringify(args));};function isVisible(){return $container&&$container.is(":visible");
}function setButtonStatus(blocked){if($panel){$panel.find(".sf-element-add-data-item-button").each(function(i,btn){$(btn).data("blocked",blocked);
});}}function createPanelButton(title,optionalDescription,optionalGetTooltipFunction,onClickFunction,enabled,style){var options={container:"vertical","align-items":"center",shrink:false};
if(mode===WELCOMEPAGE){options.inline=true;}var $buttonContainer=Spotfire.Flex.item(options).addClass("sf-element-add-data-item").toggleClass("sfpc-enabled",enabled);
if(style.cssClass){$buttonContainer.addClass("sf-connector-"+style.cssClass);}if(style.colors&&mode===WELCOMEPAGE&&enabled){var id="sf-connector-"+Spotfire.newFakeGuid();
$buttonContainer.attr("id",id);var fmt=_.partial(Spotfire.Utilities.formatString,_,id,style.colors.accent1,style.colors.accent2,style.colors.accent3);
$("<style>").appendTo($buttonContainer).append(fmt("#{0} .sf-element-add-data-item-button { border-color: {2}; }")).append(fmt("#{0}:hover .sf-element-add-data-item-button { background-color: {1}; border-color: {1}; }")).append(fmt("#{0}:hover .sf-element-add-data-item-description { color: {1}; }")).append(fmt("#{0}:hover { background-color: {3}; }"));
}if(optionalGetTooltipFunction){$buttonContainer.hover(function(){$(this).attr("title",optionalGetTooltipFunction());
});}var $button=$("<div />").addClass("sf-element-add-data-item-button").sfFlex({shrink:false}).appendTo($buttonContainer);
var $inner=$("<div />").addClass("sf-element-add-data-item-button-inner").appendTo($button);Spotfire.Data.Icons.get(style.svgIcon,function($svg){$inner.append($svg);
});$("<p>").addClass("sf-element-add-data-item-title").text(title).appendTo($buttonContainer);if(optionalDescription){$("<p>").addClass("sf-element-add-data-item-description").text(optionalDescription).appendTo($buttonContainer);
}if(onClickFunction&&enabled){$buttonContainer.on("click",function(){if(mode===MEGAMENU){$container.fadeOut(200);
}if(!$button.data("blocked")){onClickFunction();if(!$button.parent().hasClass("sf-connector-local-file")){setButtonStatus(true);
}}});}return $buttonContainer;}function addButton(name,description,tooltip,enabled,onClick,cssClass,onCreateButtonCallback){buttons.push({Name:name,Description:description,Tooltip:tooltip,Enabled:enabled,Action:onClick,Style:{cssClass:cssClass,svgIcon:"Images/Data/Connectors/"+cssClass+".svg"},CreatedCallback:onCreateButtonCallback});
}function addConnectorButton(name,description,tooltip,enabled,onClick,colors,svgIcon,onCreateButtonCallback){connectorButtons.push({Name:name,Description:description,Tooltip:tooltip,Enabled:enabled,Action:onClick,Style:{colors:colors,svgIcon:svgIcon},CreatedCallback:onCreateButtonCallback});
}function loadConnectors(result){connectorsInitialized=true;if(result.Successful){_.each(result.Connectors,function(connector){addConnectorButton(connector.Info.DisplayName,connector.Info.Resources.Description,function(){return connector.Info.Resources.DetailedDescription;
},connector.Info.IsEnabled,function(){showDataSourceDialog(connector.Info);},{accent1:connector.Styling.AccentColor1,accent2:connector.Styling.AccentColor2,accent3:connector.Styling.AccentColor3},connector.Styling.SvgIcon);
});if($panel){_.each(connectorButtons,function(button){var $btn=createPanelButton(button.Name,button.Description,button.Tooltip,button.Action,button.Enabled,button.Style);
if(button.CreatedCallback){button.CreatedCallback($btn);}$panel.append($btn);});}}}function getConnectorsList(){Spotfire.Dxp.Web.Forms.AjaxService.Read(webViewId,"GetConnectors","",loadConnectors);
}function makeActive(){var $el=$(this);if($el.is("input")){$el=$el.parent(".sf-element-add-data-item");
}var removeActive=function(){$(window).off("mouseup.addDataDialog");$el.removeClass("sfpc-active");};
$el.addClass("sfpc-active");if(!isIE){$(window).on("mouseup.addDataDialog",removeActive);}}var close=function(){if(mode===WELCOMEPAGE){return;
}$("body").off("mousedown.addDataDialog");$container.off("mousedown.addDataDialog");$container.fadeOut(200);
};function onBodyClick(e){if($container&&!$container.is(e.target)&&$container.has(e.target).length===0){close();
}}function initAddDataPanel(){if(settings.addDataFromFile){var onCreateButton=function($button){var $fileInput=$("<input type='file' id='AddDataFromFile' />").on("change",function(){if(this.files.length>0){var validationResult=Spotfire.DragDropFiles.addFile($fileInput[0].files[0]);
$fileInput.val("");if(validationResult.Result){if(dataTableToWorkOn){Spotfire.DragDropFiles.startUploads(1,dataTableToWorkOn,dataDestination);
}else{Spotfire.DragDropFiles.startUploads(1,null,dataDestination);}}else{Spotfire.Framework.ErrorDialog.show(Spotfire.Localization.resources.AddDataFromFile_ErrorDialogTitle,validationResult);
}}}).on("click",close);var allowedExtensions=mode===WELCOMEPAGE?settings.welcomePageAllowedFileExtensions:settings.allowedFileExtensions;
Spotfire.Data.Upload.createStyledFileInput2($fileInput,$button,allowedExtensions);};var getFromFileTooltip=function(){var fromFileTooltip=settings.fromFileMegaMenuTooltip;
if(mode===WELCOMEPAGE){fromFileTooltip=settings.fromFileWelcomePageTooltip;}return fromFileTooltip;};
addButton(Spotfire.Localization.resources.AddData_FromFileTitle,settings.fromFileDescription,getFromFileTooltip,true,$.noop,"local-file",onCreateButton);
}if(settings.addDataFromLibrary){addButton(Spotfire.Localization.resources.AddData_FromLibraryTitle,Spotfire.Localization.resources.AddData_FromLibraryDescription,function(){return Spotfire.Localization.resources.AddData_FromLibraryTooltip;
},true,function(){Spotfire.Dxp.Web.Forms.AjaxService.Modify(webViewId,"LibraryButtonClick",JSON.stringify({TargetTableId:dataTableToWorkOn,DataDestination:dataDestination}));
},"library");}getConnectorsList();}function createPanel(){var options={container:"horizontal",fill:true,"align-items":"stretch","justify-content":"center"};
if(mode===WELCOMEPAGE){dataDestination=Spotfire.Data.DataDestination.AddData;dataTableToWorkOn=null;options.wrap=true;
}var $p=Spotfire.Flex.item(options).addClass("sf-add-data-content");var allbuttons=buttons.concat(connectorButtons);
_.each(allbuttons,function(button){var $btn=createPanelButton(button.Name,button.Description,button.Tooltip,button.Action,button.Enabled,button.Style);
if(button.CreatedCallback){button.CreatedCallback($btn);}$p.append($btn);});$p.find(".sf-element-add-data-item").first().addClass("sfpc-first");
$panel=$p;return $p;}var show=function(argdataTableToWorkOn,$parentBtn,argDataDestination){mode=MEGAMENU;
dataTableToWorkOn=argdataTableToWorkOn;dataDestination=argDataDestination;if($container){$container.remove();
}$panel=createPanel();$container=$("<div>").addClass("sf-element-add-data-dialog").appendTo($("body"));
var $header=$("<div>").addClass("sf-element-add-data-dialog-header").appendTo($container);var headerText;
switch(dataDestination){case Spotfire.Data.DataDestination.ReplaceTable:headerText=Spotfire.Localization.resources.AddData_ReplaceDataDialog_Header;
break;case Spotfire.Data.DataDestination.AddData:headerText="";break;case Spotfire.Data.DataDestination.AddRows:headerText=Spotfire.Localization.resources.AddData_ForAddRows_DialogHeader;
break;}$header.text(headerText);var $content=$("<div>").addClass("sf-element-add-data-content").append($panel).appendTo($container);
if($parentBtn){var o=$parentBtn.offset();$container.removeClass("sf-element-add-data-no-header");var $arrow=$("<div />").addClass("sf-element-add-data-arrow").appendTo($content);
var $arrowOutline=$("<div />").addClass("arrow-outline").css("border-bottom-color",$header.css("border-top-color")).appendTo($arrow);
var $a=$("<div />").addClass("arrow-background").css("border-bottom-color",$container.css("background-color")).appendTo($arrow);
var arrowHeight=parseInt($a.css("border-bottom-width"),10);var offsetV=-3;var top=o.top+$parentBtn.outerHeight()+arrowHeight+offsetV;
var arrowTop=o.top+$parentBtn.outerHeight()+offsetV;var arrowOffset=$arrowOutline.outerWidth()/2;if(top+$container.outerHeight()>$(window).height()){arrowTop=o.top-offsetV;
top=arrowTop-$container.outerHeight()-arrowHeight;arrowOffset=-arrowOffset;$arrow.css("transform","rotate(180deg)");
}$container.css({top:top,left:Math.max(0,o.left-$content.outerWidth()/2+$parentBtn.outerWidth()/2)});
$arrow.css({top:arrowTop,left:o.left-arrowOffset+$parentBtn.outerWidth()/2});}else{if($("#AddDataMenuAnchor").length!==0){var offset=$("#AddDataMenuAnchor").offset().left;
$container.css("left",offset);}$container.addClass("sf-element-add-data-no-header");}$panel.on("mousedown.addDataDialog",".sf-element-add-data-item, input",makeActive);
$panel.fadeIn(200);$("body").on("mousedown.addDataDialog",onBodyClick);};self.enableButtons=function(){setButtonStatus(false);
};self.getPanel=createPanel;self.show=show;self.isVisible=isVisible;self.close=close;initAddDataPanel();
return self;}var instance,wvid,settings;function close(){instance.close();Spotfire.MultipleViews.OffRemoteFocus(close);
}function show(dataTableToWorkOn,$parentBtn,dataDestination){Spotfire.MultipleViews.OnRemoteFocus(close);
instance.show(dataTableToWorkOn,$parentBtn,dataDestination);}function init(webViewId,addDataSettings){wvid=webViewId;
settings=addDataSettings;instance=new AddDataControl(wvid,settings);}function enableButtons(){if(instance){instance.enableButtons();
}}function toggle(dataTableToWorkOn,$parentBtn,dataDestination){if(!instance||!instance.isVisible()){show(dataTableToWorkOn,$parentBtn,dataDestination);
}else{close();}}function showWelcomePage(id){window.setTimeout(function(){instance.setMode(2);var createWelcomePage=function(){if(instance.isInitialized()){var $wrapper=$("<div />").addClass("sf-welcome-page");
$wrapper.append($("<div />").addClass("sf-welcome-page-header").text(Spotfire.Localization.resources.WelcomePage_DataSectionHeader));
$wrapper.append(instance.getPanel());$("#"+id).append($wrapper);}else{window.setTimeout(createWelcomePage,50);
}};createWelcomePage();},0);}$(document).on("hide.bs.modal",enableButtons);Spotfire.Data.Access.AddData.enableButtons=enableButtons;
Spotfire.Data.Access.AddData.init=init;Spotfire.Data.Access.AddData.toggle=toggle;Spotfire.Data.Access.AddData.showWelcomePage=showWelcomePage;
});$(function(){Spotfire.registerNameSpace("Data.AddDataFromLibrary");function AddDataFromLibraryDialog(id,settings){var libraryEntryId="";
var libraryFolderId="";this.onLibraryEntrySelected=function(entryId,folderId){libraryEntryId=entryId;
libraryFolderId=folderId;Ajax.enqueueRequest(id,"NewDataFromLibrary",{LibraryEntryId:libraryEntryId,DataDestination:settings.DataDestination,TargetTableId:settings.TargetTableId});
};var launchLibraryBrowser=function(){Spotfire.Data.AddDataFromLibrary.showLibraryBrowser(libraryFolderId);
};launchLibraryBrowser();}var instance;Spotfire.Data.AddDataFromLibrary.EntrySelected=function(entryId,folderId){if(instance){instance.onLibraryEntrySelected(entryId,folderId);
instance=null;}};Spotfire.Data.AddDataFromLibrary.show=function(id,settings){instance=new AddDataFromLibraryDialog(id,settings);
};Spotfire.Data.AddDataFromLibrary.updateTableInformation=function(information){return;};});$(function(){var promptIndex=0;
var numPages;var $view,$pageContent,$pageHeader;var prompt,decimalSeparator;var $hierarchyView=null;var loadPage=null;
var parseInvariantDate=function(str){var match=str.match(/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2})$/);
return match?new Date(+match[1],match[2]-1,+match[3],+match[4],+match[5],+match[6]):null;};var formatInvariantDate=function(date){return("000"+date.getFullYear()).slice(-4)+"-"+("0"+(date.getMonth()+1)).slice(-2)+"-"+("0"+date.getDate()).slice(-2)+"T"+("0"+date.getHours()).slice(-2)+":"+("0"+date.getMinutes()).slice(-2)+":"+("0"+date.getSeconds()).slice(-2);
};var formatDateAndTime=function(value,callback){prompt.read("FormatDateAndTime",JSON.stringify({value:formatInvariantDate(value)}),function(result){callback(result.localizedDate,result.localizedTime);
});};var parseDateAndTime=function(date,time,callback){prompt.read("ParseDateAndTime",JSON.stringify({date:date,time:time}),function(result){callback(result.validDate,result.validTime,parseInvariantDate(result.value));
});};var validation=function(arg){if(typeof arg==="function"){$view.on("sf-connection-prompt-validation",function(event,data){if(data.promptIndex===undefined||data.promptIndex===promptIndex){arg({isValid:data.isValid,errorMessages:data.errorMessages||[],validatedValues:data.validatedValues||[]});
}});}else{$view.trigger("sf-connection-prompt-validation",arg);}};function BooleanControl(currentValue){var self={};
self.onChange=_.noop;var $container=$("<form/>");var dummyName=Spotfire.newFakeGuid();var $true=$("<input type='radio'/>").attr("name",dummyName);
var $false=$("<input type='radio'/>").attr("name",dummyName);var $trueContainer=$("<label>").addClass("sf-connection-prompt-radio");
$trueContainer.append($true).append($("<span>").text(Spotfire.Localization.resources.Prompt_True));$container.append($trueContainer);
var $falseContainer=$("<label/>").addClass("sf-connection-prompt-radio");$falseContainer.append($false).append($("<span/>").text(Spotfire.Localization.resources.Prompt_False));
$container.append($falseContainer);var radioButtonChange=function(){self.onChange($true.prop("checked").toString());
};if(currentValue===true){$true.prop("checked",true);_.defer(radioButtonChange);}else{if(currentValue===false){$false.prop("checked",true);
_.defer(radioButtonChange);}}$true.change(radioButtonChange);$false.change(radioButtonChange);Spotfire.Filters.StyledFilters.createStyledInput($container,13,13);
self.onValidation=_.noop;self.elem=function(){return $container;};return self;}function CalendarControl(dataType,currentValue){var self={};
self.onChange=_.noop;var $container=Spotfire.Flex.item({container:"horizontal"});var $combobox=Spotfire.Flex.item({container:"horizontal"}).addClass("sf-element-combobox sf-connection-prompt-calendar");
var $dateInputContainer=Spotfire.Flex.item({grow:true}).addClass("sf-element-text-box");var $dateInput=$("<input type='text'/>").addClass("ComboBoxSearchField");
var $comboboxButton=Spotfire.Flex.item().addClass("sf-element-combobox-button");var $comboboxIcon=$("<span>").addClass("sf-element-icon");
$comboboxButton.attr("title",Spotfire.Localization.resources.Prompt_ClickToSelectDate);$dateInputContainer.append($dateInput);
$combobox.append($dateInputContainer);$comboboxButton.append($comboboxIcon);$combobox.append($comboboxButton);
var $timeInput=$("<input type='text'/>").addClass("sf-element-input sf-connection-prompt-time");if(dataType.name==="DateTime"||dataType.name==="Date"){$container.append($combobox);
}if(dataType.name==="DateTime"||dataType.name==="Time"){$container.append($timeInput);}if(currentValue){formatDateAndTime(currentValue,function(localizedDate,localizedTime){$dateInput.val(localizedDate);
$timeInput.val(localizedTime);validation({isValid:true});});}else{formatDateAndTime(new Date(1970,0),function(localizedDate,localizedTime){$timeInput.val(localizedTime);
if(dataType.name==="Time"){$dateInput.val(localizedDate);validation({isValid:true});}});}var parseCallback=function(validDate,validTime,value){$timeInput.toggleClass("sf-invalid",!validTime);
var hasDateInput=$dateInput.val().trim()!=="";$dateInputContainer.toggleClass("sf-invalid",hasDateInput&&!validDate);
currentValue=value;self.onChange(value);};var inputHandler=function(){validation({isValid:false});parseDateAndTime($dateInput.val(),$timeInput.val(),parseCallback);
};$dateInput.on("input",inputHandler);$timeInput.on("input",inputHandler);$comboboxButton.click(function(){var offset=$combobox.offset();
var datePicker=new DatePicker(currentValue||new Date(),offset.left,offset.top+$combobox.outerHeight());
datePicker.onValueChanged=function(){validation({isValid:false});formatDateAndTime(datePicker.getValue(),function(localizedDate){$dateInput.val(localizedDate);
parseDateAndTime(localizedDate,$timeInput.val(),parseCallback);});};});self.onValidation=_.noop;self.elem=function(){return $container;
};return self;}function TextControl(dataType,currentValue){var self={};self.onChange=_.noop;var $container=$("<div/>");
var $input=$("<input type='text'/>").addClass("sf-connection-prompt-free-text sf-element-input").appendTo($container);
var $errorMessage=$("<div/>").html("&nbsp;").addClass("sf-error-message").appendTo($container);if(currentValue){$input.val(currentValue);
}var handleInput=function(){var text=$input.val();var isValid=false,errorMessage=null;switch(dataType.name){case"Long":case"Integer":text=$.trim(text);
isValid=text.match(/^-?\d+$/)!==null;if(isValid){var parsed=parseInt(text,10);isValid=parsed>=dataType.minValue&&parsed<=dataType.maxValue;
if(!isValid){var format=Spotfire.Localization.resources.Prompt_ErrorNumberOutsideRange;errorMessage=Spotfire.Utilities.formatString(format,dataType.minValue,dataType.maxValue);
}}else{errorMessage=Spotfire.Localization.resources.Prompt_ErrorProvideInteger;}break;case"Float":case"Double":case"Decimal":text=$.trim(text);
isValid=text.match(new RegExp("^-?\\d+("+decimalSeparator+"\\d+)?$"))!==null;if(!isValid){errorMessage=Spotfire.Localization.resources.Prompt_ErrorProvideNumber;
}break;case"TimeSpan":text=$.trim(text);isValid=text.length!==0;break;case"String":isValid=$.trim(text).length!==0;
break;}self.onValidation(isValid,errorMessage,text);self.onChange(isValid?text:null);};$input.on("input",handleInput);
self.onValidation=function(isValid,errorMessage,validatedValue){if(validatedValue!==$.trim($input.val())){return;
}if(isValid){$errorMessage.html("&nbsp;");$input.removeClass("sf-invalid");}else{if(errorMessage){$errorMessage.text(errorMessage);
$input.addClass("sf-invalid");}}};self.elem=function(){return $container;};return self;}var createInputControl=function(dataType,currentValue){switch(dataType.name){case"Boolean":return new BooleanControl(currentValue);
case"Date":case"DateTime":case"Time":return new CalendarControl(dataType,currentValue);default:return new TextControl(dataType,currentValue);
}};var submitValues=function(values,submitIndex){if(submitIndex===promptIndex){values=values.map(function(val){return _.isDate(val)?formatInvariantDate(val):val;
});var args={index:promptIndex,values:values};prompt.modify("SetValues",JSON.stringify(args));}};submitValues=_.debounce(submitValues,250);
var renderHeader=function(){$pageHeader.empty();var format=Spotfire.Localization.resources.Prompt_StepIndication;
var text=Spotfire.Utilities.formatString(format,promptIndex+1,numPages);$pageHeader.text(text);};var updateButtons=null;
var disableButtons=function(){updateButtons(false);};var freeTextHandler=null;var handleButtonClick=function(action){switch(action){case"OK":disableButtons();
prompt.confirm();break;case"Cancel":prompt.cancel();break;case"Back":disableButtons();loadPage(promptIndex-1);
break;case"Next":disableButtons();loadPage(promptIndex+1);break;case"TryFreeText":if(freeTextHandler!==null){freeTextHandler();
}break;}};var renderFooter=function(footerButtons){footerButtons=footerButtons.concat({text:Spotfire.Localization.resources.Cancel,actionName:"Cancel",isCancel:true});
prompt.setButtons(footerButtons,"Spotfire.Data.Access.Prompt.handleButtonClick");};var buttons=[];var nextButton=null;
var okButton=null;updateButtons=function(isValid){buttons=[];okButton={text:numPages===1?Spotfire.Localization.resources.Ok:Spotfire.Localization.resources.Finish,actionName:"OK",disabled:!isValid||promptIndex!==numPages-1};
nextButton={text:Spotfire.Localization.resources.Next,actionName:"Next",disabled:!isValid||promptIndex===numPages-1};
var backButton={text:Spotfire.Localization.resources.Back,actionName:"Back",disabled:promptIndex===0};
if(promptIndex===numPages-1){okButton.isDefault=true;}else{nextButton.isDefault=true;}if(numPages>1){buttons.push(backButton);
buttons.push(nextButton);}else{nextButton=null;}buttons.push(okButton);renderFooter(buttons);};var renderSelect=function($container,page){var renderedIndex=promptIndex;
var $instructionLabel=$("<div/>").addClass("sf-connection-prompt-instruction").appendTo($pageContent);
var format;if(page.maxSelection===null){format=Spotfire.Localization.resources.Prompt_SelectXOrMoreValues;
}else{if(page.maxSelection===1&&page.minSelection===1){format=Spotfire.Localization.resources.Prompt_SelectOneValue;
}else{if(page.maxSelection===page.minSelection){format=Spotfire.Localization.resources.Prompt_SelectXValues;
}else{format=Spotfire.Localization.resources.Prompt_SelectXToYValues;}}}$instructionLabel.text(Spotfire.Utilities.formatString(format,page.minSelection,page.maxSelection));
var $listboxContainer=Spotfire.Flex.item({grow:true}).appendTo($container);var $errorMessage=$("<div/>").addClass("sf-error-message").html("&nbsp").appendTo($container);
var generation=0;var listbox=null,$listbox=null;var searchExpression="";validation(function(data){if(data.errorMessages[0]){$errorMessage.text(data.errorMessages[0]);
}else{$errorMessage.html("&nbsp;");}});var totalVisibleValues=page.totalItemCount;var listBoxSettings={showSearchField:true,showImageMask:false,multiSelect:!(page.minSelection===1&&page.maxSelection===1),totalVisibleValues:totalVisibleValues,onSelectionChanged:function(selection){if(promptIndex!==renderedIndex){return;
}validation(false);var value={index:promptIndex,method:"Select",pendingSelects:selection,generation:generation};
prompt.modify("Select",JSON.stringify(value));},onGetValues:function(low,high,getValuesGeneration,callback){var args={index:promptIndex,searchExpression:searchExpression,low:low,high:high,generation:generation};
var getValuesCallback=function(result){generation=result.generation;callback(result);};prompt.read("GetVisibleItems",JSON.stringify(args),getValuesCallback);
},onSearch:function(searchString){searchExpression=searchString;var args={index:promptIndex,searchExpression:searchString,low:0,high:0};
prompt.read("GetVisibleItems",JSON.stringify(args),function(result){listbox.setScrollPosition(0);listbox.update({totalVisibleValues:result.totalVisibleValues});
});}};_.defer(function(){$listbox=$("<div/>").addClass("sf-connection-prompt-select").appendTo($listboxContainer);
listbox=Spotfire.Controls.VirtualListBox.create($listbox,listBoxSettings);listbox.adjustHeightToContainer($listboxContainer);
$view.on("sf-resize",function(){listbox.adjustHeightToContainer($listboxContainer);});});};var renderRange=function($container,page){var $instructionLabel=$("<div/>").addClass("sf-connection-prompt-instruction").appendTo($pageContent);
$instructionLabel.text(Spotfire.Localization.resources.Prompt_SpecifyRange);var fromValue=null;var toValue=null;
var renderedIndex=promptIndex;if(page.values.length!==0){fromValue=page.dataType.isTime?parseInvariantDate(page.values[0]):page.values[0];
toValue=page.dataType.isTime?parseInvariantDate(page.values[1]):page.values[1];}var isValidRange=function(){if(fromValue===null||toValue===null){return false;
}if(page.dataType.isTime){return fromValue<=toValue;}if(page.dataType.name==="Integer"||page.dataType.name==="Long"){return parseInt(fromValue,10)<=parseInt(toValue,10);
}return true;};var submit=function(){validation({isValid:false,validatedValues:[fromValue,toValue]});
if(isValidRange()){submitValues([fromValue,toValue],renderedIndex);}};var $fromContainer=$("<div/>").addClass("sf-connection-prompt-range");
var $fromLabel=$("<div/>").addClass("sf-connection-prompt-label").text(Spotfire.Localization.resources.Prompt_FromLabel);
var fromControl=createInputControl(page.dataType,fromValue);fromControl.onChange=function(value){fromValue=value;
submit();};$fromContainer.append($fromLabel);$fromContainer.append(fromControl.elem());var $toContainer=$("<div/>").addClass("sf-connection-prompt-range");
var $toLabel=$("<div/>").addClass("sf-connection-prompt-label").text(Spotfire.Localization.resources.Prompt_ToLabel);
var toControl=createInputControl(page.dataType,toValue);toControl.onChange=function(value){toValue=value;
submit();};$toContainer.append($toLabel);$toContainer.append(toControl.elem());var $rangeContainer=$("<div/>").addClass("sf-connection-prompt-range-container");
$rangeContainer.append($fromContainer);$rangeContainer.append($toContainer);$rangeContainer.appendTo($container);
$container.append($rangeContainer);validation(function(data){fromControl.onValidation(data.isValid,data.errorMessages[0],data.validatedValues[0]);
toControl.onValidation(data.isValid,data.errorMessages[1],data.validatedValues[1]);});};var renderFreeText=function($container,page){var renderedIndex=promptIndex;
var $instructionLabel=$("<div/>").addClass("sf-connection-prompt-instruction").appendTo($pageContent);
var resource="Prompt_Specify"+page.dataType.name;if(!Spotfire.Localization.resources.hasOwnProperty(resource)){resource="Prompt_SpecifyValue";
}$instructionLabel.text(Spotfire.Localization.resources[resource]);var currentValue=null;if(page.values.length!==0){currentValue=page.dataType.isTime?parseInvariantDate(page.values[0]):page.values[0];
}var inputControl=createInputControl(page.dataType,currentValue);inputControl.onChange=function(value){validation({isValid:false,validatedValues:[value]});
if(value!==null){submitValues([value],renderedIndex);}};validation(function(data){inputControl.onValidation(data.isValid,data.errorMessages[0],data.validatedValues[0]);
});$container.append(inputControl.elem());};var refreshHierarchy=function(clientGeneration){var height=$hierarchyView.height();
var itemHeight=20;var numItems=Math.floor(height/itemHeight);var hierarchySettings={HasFixedHeight:true,Height:numItems,TotalVisibleValues:0,ItemHeight:itemHeight,SearchFieldVisible:false,AllowCheck:true,ClientGeneration:clientGeneration};
Spotfire.Filters.CheckBoxHierarchyFilter.update($view.attr("id"),hierarchySettings,$hierarchyView);};
var renderHierarchical=function($container,page){var $hierarchicalContainer=Spotfire.Flex.item({grow:true}).appendTo($container);
_.defer(function(){$hierarchyView=$hierarchicalContainer.addClass("sf-connection-prompt-select").css({width:"100%"});
var height=$hierarchyView.height();var itemHeight=20;var numItems=Math.floor(height/itemHeight);var hierarchySettings={HasFixedHeight:true,Height:numItems,TotalVisibleValues:0,ItemHeight:itemHeight,SearchFieldVisible:false,AllowCheck:true,ClientGeneration:0};
Spotfire.Filters.CheckBoxHierarchyFilter.create($view.attr("id"),hierarchySettings,$hierarchyView,promptIndex);
});};var renderPage=function(page){var $nameLabel=$("<div/>").addClass("sf-connection-prompt-title").appendTo($pageContent);
$nameLabel.text(page.name);if(page.description){var $descriptionLabel=$("<div/>").addClass("sf-connection-prompt-description").appendTo($pageContent);
$descriptionLabel.text(page.description);}var onValidation=function(isValid){updateButtons(isValid);};
validation(function(data){onValidation(data.isValid);});switch(page.type){case"Range":renderRange($pageContent,page);
break;case"Single":case"Multiple":renderSelect($pageContent,page);break;case"FreeText":renderFreeText($pageContent,page);
break;case"Hierarchical":renderHierarchical($pageContent,page);break;}_.defer(function(){var $textFields=$pageContent.find("input[type=text]");
if(page.dataType.name!=="DateTime"){$textFields.first().focus();}$textFields.keydown(function(e){if(e.which===Keys.RETURN){if(nextButton&&!nextButton.disabled){handleButtonClick("Next");
}else{if(okButton&&!okButton.disabled){handleButtonClick("OK");}}e.stopPropagation();}});});onValidation(page.isValid);
};var renderError=function(errorTitle,errorDetails,page){$pageContent.append($("<div/>").addClass("sf-connection-prompt-error-title").text(errorTitle));
if(errorDetails){var $details=Spotfire.Flex.item({grow:true});$details.addClass("sf-connection-prompt-error-details sf-enable-selection").text(errorDetails);
$pageContent.append($details);}freeTextHandler=function(){$view.off();$pageContent.empty();renderPage(page);
};var footerButtons=[];footerButtons.push({text:Spotfire.Localization.resources.Prompt_TryFreeText,actionName:"TryFreeText"});
if(promptIndex>0){footerButtons.push({text:Spotfire.Localization.resources.Back,actionName:"Back"});}renderFooter(footerButtons);
};loadPage=function(index){promptIndex=index;ProgressBlocker.block($pageContent);prompt.read("GetPromptPage",JSON.stringify({index:promptIndex}),function(settings){ProgressBlocker.unblock($pageContent);
$view.off();renderHeader();$pageContent.empty();if(!settings.success){renderError(settings.errorTitle,settings.errorDetails,settings.page);
}else{renderPage(settings.page);}});};Spotfire.registerNameSpace("Data.Access.Prompt",{initialize:function(viewId,settings){numPages=settings.numPages;
if(numPages<=0){throw"There must be at least one prompt page.";}decimalSeparator=settings.decimalSeparator;
prompt=Spotfire.Prompt.create(viewId);var $container=Spotfire.Flex.item({container:"vertical",fill:true,"align-items":"stretch"});
$container.addClass("sf-connection-prompt-page-container");$pageContent=Spotfire.Flex.item({grow:true,container:"vertical","align-items":"stretch"});
$pageContent.addClass("sf-connection-prompt-page-content");$view=$("#"+viewId).addClass("sf-connection-prompt-dialog");
$pageHeader=Spotfire.Flex.item().addClass("sf-connection-prompt-header");if(numPages>1){$container.append($pageHeader);
}$container.append($pageContent);$view.append($container);renderHeader();renderFooter([]);loadPage(0);
},validate:function(promptIndex,isValid,errorMessages,validatedValues){validation({promptIndex:promptIndex,isValid:isValid,errorMessages:errorMessages,validatedValues:validatedValues});
},refreshHierarchy:function(clientGeneration){refreshHierarchy(clientGeneration);},handleButtonClick:function(viewId,actionName){handleButtonClick(actionName);
}});});$(function(){Spotfire.registerNameSpace("Data.Access.ConnectorDataSource");var instance=null;function ConnectorDataSource(id,title){var self={};
var closed=false;var modalDialog;var $dialog=$("<div>").addClass("sf-ConnectorDataSourceDialog");var $dataSourceContainer=Spotfire.Flex.item({container:"vertical","justify-content":"center","align-items":"center",fill:true});
function onClose(){if(!closed){closed=true;Spotfire.Dxp.Web.Forms.AjaxService.Modify(id,"Close","");self.onClose();
}}function close(){if(modalDialog){modalDialog.close();}else{$dataSourceContainer.remove();}onClose();
}var onDataSourceDone=function(parameters){$dataSourceContainer.fadeOut(200,function(){Spotfire.Dxp.Web.Forms.AjaxService.Modify(id,"ConnectorDataSourceDone",JSON.stringify(parameters));
});};var onDataSourceCancel=function(){close();};var onDataSourceCallback=function(parameters){Spotfire.Dxp.Web.Forms.AjaxService.Read(id,"Callback",JSON.stringify(parameters),parameters.Callback);
};var handler,style,editParameters;var initDataSourcePanel=function(){var dataAccessApi={DataSourceDone:onDataSourceDone,DataSourceCancel:onDataSourceCancel,DataSourceCallback:onDataSourceCallback};
$dataSourceContainer.empty();$("<style>").text(style).appendTo($dataSourceContainer);handler(dataAccessApi,editParameters).appendTo($dataSourceContainer);
};var load=function(){$(Spotfire.Progress.createProgressAnimation(30,30)).css("position","relative").appendTo($dataSourceContainer);
Spotfire.Dxp.Web.Forms.AjaxService.Read(id,"Load","",function(result){handler=Spotfire.evaluate(result.handler);
style=result.style;editParameters=result.parameters;initDataSourcePanel();});};self.close=function(){close();
};self.show=function(){var options=Spotfire.Data.Access.ViewsInConnection.getDialogOptions({title:title,preventAutoClose:function(){return true;
},close:function(){onClose();}});var $existingDialog=$(".sf-ViewsInConnection");if($existingDialog.length){modalDialog=null;
$dialog=$existingDialog.parent();}else{modalDialog=Spotfire.Controls.ModalDialog.initialize($dialog,options);
}$dialog.append($dataSourceContainer);};self.reopen=function(){$dialog.find(".sf-vic-container").remove();
$dataSourceContainer.fadeIn();};self.onClose=_.noop;load();return self;}Spotfire.Data.Access.ConnectorDataSource.viewsInConnectionClosed=function(){instance=null;
};Spotfire.Data.Access.ConnectorDataSource.show=function(id,title){if(instance!==null){instance.close();
}instance=new ConnectorDataSource(id,title);instance.onClose=function(){instance=null;};instance.show();
Spotfire.Data.Access.AddData.enableButtons();};Spotfire.Data.Access.ConnectorDataSource.reopen=function(){instance.reopen();
};});$(function(){var instance=null;var $dialog=null;function createCustomViewsInConnection(viewId,$container,script,css,parameters,onUpdateFooter,isPrompt){var cancelableCount=0;
var footerButtons;var enableDisableButtons=function(enable){$.each(footerButtons,function(index,item){if(!item.isCancel){$("#"+item.id).prop("disabled",!enable).toggleClass("sfpc-disabled",!enable);
}});};var unblock=function(){ProgressBlocker.unblock($container);$container.removeClass("sf-vic-has-preview").removeClass("sf-cvic-blocked");
enableDisableButtons(true);};var block=function(cancelableId){var blockSettings={zIndex:0};if(cancelableId!==undefined){blockSettings.cancelOperation=function(){Spotfire.Dxp.Web.Forms.AjaxService.Read(viewId,"Cancel",JSON.stringify({cancelableId:cancelableId}),_.noop);
unblock();};}$container.toggleClass("sf-cvic-blocked",true);ProgressBlocker.block($container,blockSettings);
enableDisableButtons(false);};var onError=function(error){if(Spotfire.isWebPlayer()){Spotfire.Framework.ErrorDialog.show(Spotfire.Localization.resources.CustomViewsInConnection_ErrorTitle,error);
}else{Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,"Error",JSON.stringify({Title:Spotfire.Localization.resources.CustomViewsInConnection_ErrorTitle,Message:error.Message,Details:error.Details}));
}};var handleDoneResponse=function(result){if(result.error){onError(result.error);return;}if(!result.isCancelled&&$dialog){Spotfire.Controls.ModalDialog.close($dialog);
instance=null;if(isPrompt){Prompt.confirmPrompt();}}};var onDone=function(params){var cancelableId=cancelableCount++;
block(cancelableId);params.cancelableId=cancelableId;Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,"Done",JSON.stringify(params));
};var onCancel=function(){Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,"Close","");instance=null;
if(isPrompt){Prompt.cancelPrompt();}};var onCallback=function(params,callback){Spotfire.Dxp.Web.Forms.AjaxService.Read(viewId,"OnExecuteCallback",JSON.stringify(params),callback);
};var onUpdateAndSaveFooter=function(buttons){footerButtons=buttons;onUpdateFooter(buttons);};var onPreview=function(params){block();
$container.addClass("sf-vic-has-preview");Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,"Preview",JSON.stringify(params));
};var onHelp=function(topicId){Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,"ShowHelpTopic",topicId);
};var dataAccessApi={done:onDone,cancel:onCancel,callback:onCallback,updateFooter:onUpdateAndSaveFooter,preview:onPreview,error:onError,help:onHelp};
$container.append($("<style>").text(css));Spotfire.evaluate(script)($container,dataAccessApi,parameters);
$container.children().addClass("sf-cvic-content");return{unblock:unblock,handleDone:handleDoneResponse};
}Spotfire.registerNameSpace("Data.Access.CustomViewsInConnection");Spotfire.Data.Access.CustomViewsInConnection.init=function(id,script,css,parameters){var $view=$("#"+id);
var $formsDialog=$view.parent();$formsDialog.addClass("sf-element-modal-dialog sfpc-compact sf-ViewsInConnection");
$view.addClass("sf-element-modal-dialog-body");var $footer=Spotfire.Flex.item({shrink:false,container:"horizontal","justify-content":"space-between"}).addClass("sf-cvic-footer");
var $leftFooterContainer=Spotfire.Flex.item({shrink:false,container:"horizontal","justify-content":"start"});
var $rightFooterContainer=Spotfire.Flex.item({shrink:false,container:"horizontal","justify-content":"end"});
$footer.append($leftFooterContainer,$rightFooterContainer);var onUpdateFooter=function(buttons){$footer.find("button").remove();
var $btn;$.each(buttons,function(index,item){$btn=$("<button>");$btn.attr("id",item.id);$btn.prop("disabled",item.disabled);
if(item.disabled){$btn.addClass("sfpc-disabled");}$btn.addClass("sf-element-button");if(item.isDefault){$btn.text(item.text||Spotfire.Localization.resources.Ok);
}else{if(item.isCancel){$btn.addClass("sfpc-secondary");$btn.text(item.text||Spotfire.Localization.resources.Cancel);
}else{if(item.isHelp){$btn.addClass("sfpc-secondary sf-modal-dialog-footer-help");$btn.text(item.text||Spotfire.Localization.resources.Help);
}else{$btn.addClass("sfpc-secondary");$btn.text(item.text);}}}$btn.on("click",item.click||$.noop);if(item.isHelp){$leftFooterContainer.append($btn);
}else{$rightFooterContainer.append($btn);}});};var $container=Spotfire.Flex.item({container:"vertical",fill:true,"align-items":"stretch"}).appendTo($view);
instance=createCustomViewsInConnection(id,$container,script,css,parameters,onUpdateFooter,false);$container.append($footer);
};Spotfire.Data.Access.CustomViewsInConnection.show=function(id,title,script,css,parameters,isPrompt){var dataSourceDialog=".sf-ConnectorDataSourceDialog";
var handleClose=function(){instance=null;};var show=function(){if(instance!==null){return;}var useExistingDialog=$(dataSourceDialog+", .promptingPopup").length>0;
if(useExistingDialog){$dialog=$(dataSourceDialog+", .promptingPopup").removeClass(dataSourceDialog).addClass("sf-ViewsInConnection");
$dialog.dialog("option",{close:handleClose});}else{var options=Spotfire.Data.Access.ViewsInConnection.getDialogOptions({title:title,close:handleClose});
$dialog=$("<div>").addClass("sf-ViewsInConnection");Spotfire.Controls.ModalDialog.initialize($dialog,options);
}var onUpdateFooter=function(buttons){buttons=_.filter(buttons,function(b){return !b.isHelp;});$.each(buttons,function(index,item){if(item.isHelp){item.text=item.text||Spotfire.Localization.resources.Help;
}else{if(item.isDefault){var onClick=item.click;item.click=function(){onClick();return true;};}}});Spotfire.Controls.ModalDialog.update($dialog,"buttons",buttons);
};var $owner=isPrompt?$("#"+id):$dialog;instance=createCustomViewsInConnection(id,$owner,script,css,parameters,onUpdateFooter,isPrompt);
};if(isPrompt){Prompt.onPromptLoaded=function(){Prompt.setEnableSelection(false);show();};}else{show();
}};Spotfire.Data.Access.CustomViewsInConnection.unblock=function(){if(instance!==null){instance.unblock();
}};Spotfire.Data.Access.CustomViewsInConnection.handleDone=function(result){if(instance!==null){instance.handleDone(result);
}};});$(function(){Spotfire.registerNameSpace("Data.Access.Common",{createCompactButton:function(text,alignment){alignment=alignment||"center";
return $("<a>").addClass("sf-element-button sfpc-secondary sf-vic-compact-button").text(text).sfFlex({container:"horizontal","justify-content":alignment,"align-items":"center",shrink:false});
},createCompactIconButton:function(text,icon,alignment){var $button=Spotfire.Data.Access.Common.createCompactButton(text,alignment);
Spotfire.getSvg(icon,function($svg){$button.prepend($svg);});return $button;},createPreviewButton:function(){var text=Spotfire.Localization.resources.ViewsInConnection_Preview;
var icon="Images/Data/Preview.svg";return Spotfire.Data.Access.Common.createCompactIconButton(text,icon).addClass("sf-vic-preview-button");
},createSearchField:function(placeholder,onInput){var $container=$("<div>").addClass("sf-vic-search-container");
var $input=$("<input type='text'/>").addClass("sf-element-input sf-input-with-placeholder sf-vic-search-field").attr("placeholder",placeholder);
var $magnifier=$("<div>").addClass("sf-element-icon sfc-search sf-vic-search-icon").appendTo($container);
Spotfire.getSvg("Images/Data/Search.svg",function($svg){$svg.appendTo($magnifier);});var $clear=$("<div>").addClass("sf-element-icon sfc-search sf-vic-search-icon sf-vic-search-clear sf-hidden").attr("title",Spotfire.Localization.resources.ViewsInConnection_ClearTooltip).appendTo($container);
Spotfire.getSvg("Images/Data/ClearSearch.svg",function($svg){$svg.appendTo($clear);});var update=function(){$magnifier.toggleClass("sf-hidden",$input.val().length!==0);
$clear.toggleClass("sf-hidden",$input.val().length===0);};var debouncedOnInput=_.debounce(onInput,100);
$input.on("input",function(){update();debouncedOnInput($input.val());return true;});$clear.click(function(){$input.val("");
onInput("");update();$input.focus();});$input.on("keydown",function(e){if(e.which===Keys.RETURN){return false;
}if(e.which===Keys.ESCAPE){$clear.click();$input.blur();return false;}return true;});$container.append($input);
$container.val=function(){return $input.val();};return $container;}});});$(function(){Spotfire.registerNameSpace("Data.Access.ViewsInConnection");
function addContent($group,$content){$group.find(".sf-group-content").append($content);}function addRow($group,text,$info){var $text=$("<span>").text(text).attr("title",text).sfFlex({grow:true});
var $rowContent=$("<div>").addClass("sf-row-content").append($info).sfFlex({shrink:false});addContent($group,$("<div>").sfFlex({container:"horizontal"}).append($text,$rowContent));
}function addGroup($container,headerText){var $content=$("<div>").addClass("sf-group-content");var $header=$("<div>").addClass("sf-group-header").text(headerText);
return $("<div>").addClass("sf-group").append($header,$content).appendTo($container);}function DataConnectionSyncOptions(){var self=this;
var addTables=new Spotfire.Data.Collections.Set();var getSettings=function(){return{addTables:addTables};
};var confirm=function(){self.prompt.modify("",getSettings());self.prompt.confirm();self.onClose();};
var cancel=function(){self.prompt.cancel();self.onClose();};var initView=function(settings){Spotfire.Focus.handleKeyDown(self.$view,function(e){if(e.which===Keys.ESCAPE){cancel();
}});self.$view.off().empty();var $container=$("<div>").addClass("sf-dc-sync-options").sfFlex({container:"vertical",fill:true,"align-items":"stretch"}).appendTo(self.$view);
$("<p>").addClass("sf-info").text(Spotfire.Localization.resources.DataConnectionSyncOptions_Info).appendTo($container);
var $innerPanel=$("<div>").sfFlex({grow:true}).addClass("sf-element-modal-dialog-inner-body sfpc-center").appendTo($container);
if(settings.removedViews.length){var $removedViews=addGroup($innerPanel,Spotfire.Localization.resources.DataConnectionSyncOptions_RemovedViews);
var $icon=$("<span>").addClass("sf-info-icon");Spotfire.getSvg("Images/Buttons/Info.svg",function($svg){$icon.append($svg);
});var $infoText=$("<span>").text(Spotfire.Localization.resources.DataConnectionSyncOptions_RemovedInfo);
addContent($removedViews,$("<p>").append($icon,$infoText));settings.removedViews.forEach(function(view){addRow($removedViews,view.Name,$("<span>").text(view.Info).attr("title",view.Info));
});}if(settings.addedViews.length){var $addedViews=addGroup($innerPanel,Spotfire.Localization.resources.DataConnectionSyncOptions_AddedViews);
settings.addedViews.forEach(function(view){addTables.add(view.Id);var $toggleAddTable=$("<label>");$("<input type='checkbox' checked/>").appendTo($toggleAddTable).change(function(){if($(this).is(":checked")){addTables.add(view.Id);
}else{addTables.remove(view.Id);}});$("<span>").text(Spotfire.Localization.resources.DataConnectionSyncOptions_AddDataTable).appendTo($toggleAddTable);
Spotfire.Filters.StyledFilters.createStyledInput($toggleAddTable,13,13);addRow($addedViews,view.Name,$toggleAddTable);
});}};self.init=function(viewId,settings,onClose){self.$view=$("#"+viewId);self.viewId=viewId;self.onClose=onClose;
self.prompt=Spotfire.Prompt.create(viewId);self.prompt.setEnableSelection(false);var buttons=[{text:Spotfire.Localization.resources.Ok,isDefault:true,actionName:"OK"},{text:Spotfire.Localization.resources.Cancel,isCancel:true,actionName:"Cancel"}];
self.prompt.setButtons(buttons,"Spotfire.Data.Access.ViewsInConnection.handleSyncOptionsClick");initView(settings);
};self.handleClick=function(actionName){switch(actionName){case"OK":confirm();break;case"Cancel":cancel();
break;}};}var instance=null;Spotfire.Data.Access.ViewsInConnection.showSyncOptions=function(viewId,settings){if(instance===null){instance=new DataConnectionSyncOptions();
}var onClose=function(){instance=null;};instance.init(viewId,settings,onClose);};Spotfire.Data.Access.ViewsInConnection.handleSyncOptionsClick=function(viewId,handlerName){if(instance!==null){instance.handleClick(handlerName);
}};});$(function(){Spotfire.registerNameSpace("Data",{DataDestination:{AddData:0,ReplaceTable:1,AddRows:2,EditSource:3}});
});$(function(){var preRegisteredIcons={};Spotfire.registerNameSpace("Data.Icons",{init:function(icons){preRegisteredIcons=icons;
},get:function(url,success){var icon=preRegisteredIcons[url];if(icon){success($(icon));}else{Spotfire.getSvg(url,success);
}}});});$(function(){Spotfire.registerNameSpace("Data.Collections");function KeyedCollection(initialItems,keyGetter){if(!_.isArray(initialItems)){throw"Expected 'initialItems' to be an array.";
}if(typeof keyGetter!=="function"){throw"Expeced 'keyGetter' to be a function.";}var self=this;this.list=[];
this.map={};this.addOrReplace=function(item){var key=keyGetter(item);if(self.contains(key)){var index=self.indexOf(key);
self.list[index]=item;self.map[key]=item;}else{self.list.push(item);self.map[key]=item;}};this.add=function(item){var key=keyGetter(item);
if(self.contains(key)){throw"The collection already contains an item with key '"+key+"'.";}self.list.push(item);
self.map[key]=item;};this.get=function(key){return self.map[key];};this.indexOf=function(key){return _.findIndex(self.list,function(item){return keyGetter(item)===key;
});};this.remove=function(key){var index=self.indexOf(key);if(index!==-1){delete self.map[key];self.list.splice(index,1);
}};this.removeItem=function(item){self.remove(keyGetter(item));};this.contains=function(key){return self.map.hasOwnProperty(key);
};this.forEach=function(callback){_.each(self.list,callback);};this.size=function(){return self.list.length;
};this.sortBy=function(sorter){self.list.sort(sorter);};this.toArray=function(){return _.clone(self.list);
};this.toJSON=function(){return self.toArray();};_.each(initialItems,this.add);}Spotfire.Data.Collections.KeyedCollection=KeyedCollection;
});$(function(){Spotfire.registerNameSpace("Data.NameString");var contains=function(name,takenNames){if(takenNames instanceof Spotfire.Data.Collections.Set){return takenNames.contains(name);
}return $.inArray(name,takenNames)!==-1;};Spotfire.Data.NameString.isNameValid=function(name,takenNames){var trimmedName=$.trim(name);
return trimmedName!==""&&!contains(trimmedName,takenNames);};Spotfire.Data.NameString.createUniqueName=function(suggestedName,takenNames){var candidate=suggestedName;
var suffix;for(suffix=2;contains(candidate,takenNames);suffix++){candidate=suggestedName+" ("+suffix+")";
}return candidate;};Spotfire.Data.NameString.makeNameValid=function(name,takenNames){var trimmedName=$.trim(name);
if(Spotfire.Data.NameString.isNameValid(trimmedName,takenNames)){return trimmedName;}return Spotfire.Data.NameString.createUniqueName(trimmedName,takenNames);
};});$(function(){Spotfire.registerNameSpace("Data.Collections");function Set(initialItems){if(initialItems&&!_.isArray(initialItems)){throw"Expected 'initialItems' to be an array.";
}var self=this;this.map={};this.add=function(item){if(self.contains(item)){return false;}self.map[item]=1;
return true;};this.remove=function(item){if(self.contains(item)){delete self.map[item];return true;}return false;
};this.contains=function(item){return self.map.hasOwnProperty(item);};this.size=function(){return self.toArray().length;
};this.toArray=function(){return _.keys(self.map);};this.toJSON=function(){return self.toArray();};_.each(initialItems||[],this.add);
}Spotfire.Data.Collections.Set=Set;});$(function(){Spotfire.registerNameSpace("Data.Access.ViewsInConnection");
var instance=null;function ViewsInConnection(viewId,title,existingNames,selectedView,dataDestination,isPromptControl,canEditDataSource,unlockEditInfo){var isPromptOverlayVisible=false;
var self={};var dataSourceDialog=".sf-ConnectorDataSourceDialog";var currentColumnSorting={CommandId:"None",Method:null};
var $dialog;var sortMenuItems=null;var sortMenu=null;var $sortButton;var isEditColumnMode=false;var takenNames=new Spotfire.Data.Collections.Set(existingNames);
var setOfCanceledLoadings=new Spotfire.Data.Collections.Set();var getName=function(obj){if(obj.Name===undefined){throw"The object doesn't have a 'Name' property.";
}return obj.Name;};var isUnlockedEditMode=false;var pendingTables=0;var preventClose=false;var viewBuilders=new Spotfire.Data.Collections.KeyedCollection([],getName);
var loadedSchemas={};var tableLists=[];var buttons;var activeViewBuilder=null;var $promptOrderButton;
var promptPopout;var $columnsList=null;var $tablesPanel;var $addedTablesPanel;var $addedTablesList;var $addedDataTablesHint;
var $detailsContentHint;var $detailsContent;var $columnsListContainer;var $columnSearch;var $pointers;
var $selectAllCheckbox;var updateFooter=null;var handleResize=function(){var update=function($list,width,height){$list.outerWidth(width);
$list.outerHeight(height);$list.StyledScrollbar().refresh();};var $container;_.each(tableLists,function($tableList){$container=$tableList.closest(".sf-vic-list-container");
update($tableList,$container.width(),$container.outerHeight());});if($columnsListContainer.is(":visible")){$container=$columnsList.closest(".sf-vic-list-container");
update($columnsList,$container.outerWidth(),$container.outerHeight()+1);}update($addedTablesList,$addedTablesPanel.width(),$addedTablesPanel.height());
};var onCancelDialog=function(){Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,"Close","");if(isPromptControl){Prompt.cancelPrompt();
}};var handleClose=function(){if(_.isEmpty(tableLists)){onCancelDialog();}self.onClose(true);};var initFooter=function(){Spotfire.Controls.ModalDialog.update($dialog,"buttons",buttons);
};var hideFooter=function(){Spotfire.Controls.ModalDialog.update($dialog,"buttons",[]);Spotfire.Controls.ModalDialog.update($dialog,"extraFooterContent",null);
};var showFooter=function(){initFooter();updateFooter();};var block=function(){$("#okButton").prop("disabled",true).addClass("sfpc-disabled");
$dialog.addClass("sf-loading");};var cancelableBlock=function(){block();$dialog.addClass("sf-loading-cancelable");
};var previewBlock=function(){block();$dialog.addClass("sf-vic-has-preview");};var unblock=function(){$dialog.removeClass("sf-loading sf-loading-cancelable sf-vic-has-preview");
updateFooter();};var editDataSource=function(){hideFooter();$dialog.hide();Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,"EditDataSource");
};var unlockEditAllViews=function(){isUnlockedEditMode=true;$dialog.find(".sf-vic-edit-connection").removeClass("sf-vic-edit-connection");
$dialog.find(".sf-vic-readonly").removeClass("sf-vic-readonly");updateFooter();};var getColumnDisplayName=function(column){return column.RenamedName||column.DisplayName;
};var columnInputKeyDown=function(column){var columnKeyDownHandler=function(e){if(e.which===Keys.RETURN){$(this).blur();
$columnsList.trigger("exitEditColumnMode");return false;}if(e.which===Keys.ESCAPE){$(this).val(getColumnDisplayName(column));
$(this).blur();$columnsList.trigger("exitEditColumnMode");return false;}return true;};return columnKeyDownHandler;
};var createFooterMessage=function(message,isError){var $container=Spotfire.Flex.item({container:"horizontal",inline:true,"justify-content":"end","align-items":"center"}).addClass("sf-vic-summary-label-container").toggleClass("sf-element-modal-dialog-error-content",isError);
var appendLabel=function(){$("<label>").addClass("sf-element-modal-dialog-footer-text sf-vic-summary-label").toggleClass("sf-vic-summary-error",isError).text(message).attr("title",message).appendTo($container);
};if(isError){Spotfire.getSvg("Images/Data/ErrorExclamation14x14.svg",function($svg){$svg.appendTo($container);
appendLabel();});}else{appendLabel();}return $container;};var vicToolTip=function($icon,$message){$icon.off("mouseenter");
$icon.off("mouseleave");$icon.attr("title","");var isJQuery=$message instanceof jQuery;var centerAlign=false;
if(!isJQuery){var multiline=new RegExp("[\\r\\n]").test($message);centerAlign=!multiline;$message=$("<div>").text($message);
}$icon.mouseenter(function(){var $tooltip=$("<div>").addClass("sf-vic-tooltip").toggleClass("sf-vic-center-align",centerAlign);
var $tooltipContent=$("<div>").addClass("sf-vic-tooltip-content");var $tooltipLabel=$("<label>").addClass("sf-vic-tooltip-label").append($message);
var $tooltipPointer=$("<div>").addClass("sf-vic-tooltip-pointer");$tooltipContent.append($tooltipLabel);
$tooltip.append($tooltipContent);$tooltip.append($tooltipPointer);$(".sf-element-modal-dialog").append($tooltip);
var x=$icon.offset().left-$(".sf-element-modal-dialog").offset().left-($tooltip.width()/2)+($icon.width()/2);
var y=$icon.offset().top-$(".sf-element-modal-dialog").offset().top-$tooltip.height();$tooltip.css("left",x);
$tooltip.css("top",y);$tooltip.fadeIn();});$icon.mouseleave(function(){$(".sf-vic-tooltip").remove();
});};var createFooterAction=function(text,infoTooltip,action){var $buttonContainer=$("<div>").addClass("sf-vic-footer-action").sfFlex({container:"horizontal","align-items":"center"});
$("<button>").addClass("sf-element-button sfpc-secondary").text(text).appendTo($buttonContainer).click(function(){action();
return false;});if(infoTooltip){Spotfire.getSvg("Images/Data/Info28x28.svg",function($svg){var $icon=$("<div>").addClass("sf-vic-icon sf-vic-icon-info").append($svg).appendTo($buttonContainer);
vicToolTip($icon,infoTooltip);});}return $buttonContainer;};updateFooter=function(){var numTables=viewBuilders.size();
var isValid=false;var $footerContent=$("<span>");if(numTables!==0){switch(dataDestination){case Spotfire.Data.DataDestination.ReplaceTable:case Spotfire.Data.DataDestination.AddRows:if(numTables===1&&pendingTables===0){isValid=true;
}else{var errorMessage=Spotfire.Localization.resources.ViewsInConnection_ReplaceOneTable;if(dataDestination===Spotfire.Data.DataDestination.AddRows){errorMessage=Spotfire.Localization.resources.ViewsInConnection_AddRowsToOneTable;
}$footerContent=createFooterMessage(errorMessage,true);}break;case Spotfire.Data.DataDestination.AddData:isValid=pendingTables===0;
var infoMessage=Spotfire.Utilities.formatString(Spotfire.Localization.resources.ViewsInConnection_SummaryFormatString,numTables);
$footerContent=createFooterMessage(infoMessage,false);break;case Spotfire.Data.DataDestination.EditSource:if(!isUnlockedEditMode){var text=Spotfire.Localization.resources.ViewsInConnection_UnlockEditAll;
$footerContent=createFooterAction(text,unlockEditInfo,unlockEditAllViews);}isValid=pendingTables===0;
break;}}$("#okButton").prop("disabled",!isValid);$("#okButton").toggleClass("sfpc-disabled",!isValid);
Spotfire.Controls.ModalDialog.update($dialog,"extraFooterContent",$footerContent);};var useExistingDialog=$(dataSourceDialog+", .promptingPopup").length>0;
if(useExistingDialog){$dialog=$(dataSourceDialog+", .promptingPopup").removeClass(dataSourceDialog).addClass("sf-ViewsInConnection");
$dialog.dialog("option",{resize:handleResize,close:handleClose,preventAutoClose:function(){return preventClose||isPromptOverlayVisible;
}});}else{var options=Spotfire.Data.Access.ViewsInConnection.getDialogOptions({title:title,resize:handleResize,close:handleClose});
$dialog=$("<div>").addClass("sf-ViewsInConnection");Spotfire.Controls.ModalDialog.initialize($dialog,options);
}var $content=Spotfire.Flex.item({container:"horizontal","align-items":"stretch"}).addClass("sf-element-modal-dialog-inner-body sfpc-right sf-element-views-in-connection");
var isValidMinMaxInput=function(input){if(input===null||input===undefined||input===""){return true;}return(/^\d+$/).test(input);
};var findViewListItem=function(displayName){return $addedTablesList.find("li").filter(function(){return $(this).data("id")===displayName;
});};var updatePromptDisplayNames=function(){viewBuilders.forEach(function(vjv){vjv.Prompts.forEach(function(prompt){var column=vjv.Columns.get(prompt.Name);
prompt.DisplayName=getColumnDisplayName(column);});});};var okButtonCallback=function(){updatePromptDisplayNames();
var builders=JSON.stringify({Builders:viewBuilders});Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,"Done",builders);
if(isPromptControl){Prompt.confirmPrompt();}return false;};var generateUniqueName=function(table){var uniqueName=Spotfire.Data.NameString.createUniqueName(table.DisplayName,takenNames);
takenNames.add(uniqueName);return uniqueName;};var hasPrompt=function(column){return activeViewBuilder.Prompts.contains(column.Name);
};var renameColumn=function(column){var renameColumnCallback=function(){var $item=$(this).parent();var updateColumnName=function(name){$item.find("input").val(name);
$item.find("label").text(name);};var value=$.trim($(this).val());if(value===""){column.RenamedName=null;
updateColumnName(getColumnDisplayName(column));return;}if(column.DisplayName===value){column.RenamedName=null;
updateColumnName(value);return;}if(column.RenamedName===value){updateColumnName(value);return;}var columnNames=[];
activeViewBuilder.Columns.forEach(function(column){if(column.RenamedName!==null){columnNames.push(column.RenamedName);
}else{columnNames.push(column.DisplayName);}});var uniqueName=Spotfire.Data.NameString.createUniqueName(value,columnNames);
column.RenamedName=uniqueName;updateColumnName(uniqueName);};return renameColumnCallback;};var getVisibleColumnCheckBoxes=function(){return $columnsList.find(":checkbox:visible");
};var updateSelectAllCheckBox=function(){var $checkBoxes=getVisibleColumnCheckBoxes();var numCheckboxes=$checkBoxes.length;
var numUnchecked=$checkBoxes.filter(":not(:checked)").length;$selectAllCheckbox.prop("checked",numUnchecked===0);
$selectAllCheckbox.prop("indeterminate",numUnchecked!==0&&numUnchecked!==numCheckboxes);};var togglePromptIcon=function(){_.each($(".sf-vic-prompt-icon"),function(promptIcon){var column=$(promptIcon).data("column");
if(isEditColumnMode){$(promptIcon).find("svg").attr("class","sf-element-svg-element sf-element-icon sfc-selected");
if(hasPrompt(column)){$(promptIcon).find("svg").attr("class","sf-element-svg-element sfc-accent3-color");
}$(promptIcon).show();}else{if(hasPrompt(column)){$(promptIcon).find("svg").attr("class","sf-element-svg-element sfc-accent3-color");
$(promptIcon).show();}else{$(promptIcon).find("svg").attr("class","sf-element-svg-element sf-element-icon sfc-selected");
$(promptIcon).hide();}}});};var reorderPrompts=function(){var indices={};_.each($(".sf-vic-prompt-order-list").find("li"),function(prompt,index){indices[$(prompt).data("name")]=index;
});activeViewBuilder.Prompts.sortBy(function(p1,p2){return indices[p1.Name]>indices[p2.Name];});};var canReorderPrompts=function(){if(Spotfire.capabilities.supportsTouch()){return false;
}return activeViewBuilder.Prompts.size()>1;};var createPointer=function(){var bgColor=$dialog.find(".sf-element-modal-dialog-inner-body.sfpc-right").css("background-color");
var $pointerItem=$("<li>").addClass("sf-vic-pointer");var $innerArrow=$("<div>").addClass("sf-vic-pointer-inner").css("background-color",bgColor);
$pointerItem.append($innerArrow);return $pointerItem;};var togglePromptOrderButton=function(){$promptOrderButton.toggle(canReorderPrompts());
handleResize();};var createPromptOrderListItem=function(name){var column=activeViewBuilder.Columns.get(name);
var displayName=getColumnDisplayName(column);var $item=$("<li>").addClass("sf-element-views-in-connection-list-item sf-vic-prompt-order-list-item").attr("draggable",true).data("name",name);
var $container=Spotfire.Flex.item({container:"horizontal","align-items":"center",fill:true}).addClass("sf-vic-prompt-order-list-item-container");
var $icon=$("<div>").addClass("sf-vic-prompt-order-type-icon");Spotfire.getSvg("Images/Data/hamburger.svg",function($svg){$svg.appendTo($icon);
});$container.append($icon);$("<span>").text(displayName).addClass("sf-vic-prompt-order-display-name").appendTo($container);
$item.append($container);$item.attr("title",displayName);return $item;};var createPromptOrderPanel=function(){var width=$(".sf-vic-columns-content").width()-6;
var $container=Spotfire.Flex.item({container:"vertical","align-items":"stretch",shrink:false}).addClass("sf-element-views-in-connection-panel sfc-popout sf-vic-prompt-order-list-container").css("width",width);
var $promptOrderList=$("<ul>").addClass("sf-element-views-in-connection-list sf-vic-prompt-order-list sf-vic-list").sortable({containment:".sf-vic-prompt-order-list",tolerance:"pointer",update:function(){reorderPrompts();
}});activeViewBuilder.Prompts.forEach(function(prompt){var $item=createPromptOrderListItem(prompt.Name);
$promptOrderList.append($item);});$container.append($promptOrderList);var $outer=$("<div>").addClass("sf-element-views-in-connection").append($container);
return $outer;};var createPromptOrderButton=function(){var $toggleButton=Spotfire.Data.Access.Common.createCompactIconButton(Spotfire.Localization.resources.ViewsInConnection_PromptOrder,"Images/Data/Prompt.svg","start").addClass("sf-vic-prompt-order-toggle-button").hide();
var getPopoverPosition=function($item){return{x:$item.offset().left+14+$item.width()/2,y:$item.offset().top-1};
};$toggleButton.click(function(){var $promptOrderPanel=createPromptOrderPanel();var pos=getPopoverPosition($toggleButton);
Spotfire.Visuals.Popout.showPopout(Spotfire.newFakeGuid(),{alignment:"Bottom",x:pos.x,y:pos.y,dialogType:Spotfire.Visuals.Popout.DialogType.ModalDialog},$promptOrderPanel);
});return $toggleButton;};var showPromptPopout=function($item,prompt,isNew,resultCallback){var noPrompt=isNew;
var $promptTypesSelectionDiv=$("<div>").addClass("sf-vic-prompt-definitions-container");var $promptOverlayContent=$("<div>").addClass("sf-vic-prompt-content");
var $promptDefinition=$("<div>").addClass("sf-vic-prompt-definition");var $innerGroup=$("<div>").addClass("sf-element-modal-dialog-inner-body sfpc-popout sf-vic-prompt-inner-group");
var $radioButtonGroup=$("<div/>").addClass("sf-vic-prompt-radio-button-group");var $noPromptDiv=$("<div>");
var $noPromptInput=$("<input type='radio' name='prompt' value='noprompt'/>").appendTo($noPromptDiv);var $noPromptText=$("<span>").addClass("sf-vic-prompt-span").text(Spotfire.Localization.resources.ViewsInConnection_NoPrompt);
var $noPromptLabel=$("<label>").sfFlex({container:"horizontal",fill:true}).addClass("sf-vic-prompt-label").append($noPromptDiv,$noPromptText);
Spotfire.Filters.StyledFilters.createStyledInput($noPromptDiv,15,15);var $promptDiv=$("<div>");var $promptInput=$("<input type='radio' name='prompt' value='prompt'/>").appendTo($promptDiv);
var $promptText=$("<span>").addClass("sf-vic-prompt-span").text(Spotfire.Localization.resources.ViewsInConnection_PromptType);
var $promptLabel=$("<label>").sfFlex({container:"horizontal",fill:true}).addClass("sf-vic-prompt-label bottom").append($promptDiv,$promptText);
Spotfire.Filters.StyledFilters.createStyledInput($promptDiv,15,15);var validateMinMax=function($min,$max,isMin,savedMin){var min=parseInt($min.val(),10);
var max=parseInt($max.val(),10);if(isNaN(min)){$min.val(savedMin);}else{if(min===0){$min.val(1);}}if(isNaN(max)){$max.val("");
}else{if(max===0){$max.val("");}else{if(max>999999){$max.val(999999);}}}if(isMin&&min>max){$max.val($min.val());
max=min;}else{if(!isMin&&(min>max)&&$max.val()!==""){$min.val($max.val());min=max;}}prompt.MinSelectionCount=min;
prompt.MaxSelectionCount=max;};var $minInput,$maxInput,currMin;var $minMaxSelectDiv=$("<div>").addClass("sf-vic-prompt-min-max");
$minInput=$("<input type='number' name='min' min='1'>");$minInput.addClass("sf-vic-prompt-number-input sf-element-input").focus(function(){currMin=$minInput.val();
}).change(function(){validateMinMax($minInput,$maxInput,true,currMin);});var $minLabel=$("<label>").addClass("sf-vic-prompt-label").append($("<span>").addClass("sf-vic-prompt-span").append(Spotfire.Localization.resources.ViewsInConnection_MinSelection));
var $minDiv=$("<div>").addClass("sf-vic-prompt-select").append($minLabel,$minInput);$maxInput=$("<input type='number' name='max' min='1' max='999999'>");
$maxInput.addClass("sf-vic-prompt-number-input sf-element-input").change(function(){validateMinMax($minInput,$maxInput,false,currMin);
});var $maxLabel=$("<label>").addClass("sf-vic-prompt-label").append($("<span>").addClass("sf-vic-prompt-span").append(Spotfire.Localization.resources.ViewsInConnection_MaxSelection));
var $maxDiv=$("<div>").addClass("sf-vic-prompt-select").append($maxLabel,$maxInput);$minMaxSelectDiv.append($minDiv,$maxDiv);
var $descriptionText=$("<textarea rows='4' cols='25'>");$descriptionText.addClass("sf-vic-prompt-description sf-element-input").val(prompt.Description).on("change",function(){prompt.Description=$descriptionText.val();
});$promptDefinition.append($innerGroup.append($("<label>").addClass("sf-vic-prompt-label").append($("<span>").text(Spotfire.Localization.resources.ViewsInConnection_PromptTypeLabel).addClass("sf-vic-prompt-text"))).append($promptTypesSelectionDiv).append($minMaxSelectDiv).append($("<label>").addClass("sf-vic-prompt-label").append($("<span>").text(Spotfire.Localization.resources.ViewsInConnection_PromptDescription).addClass("sf-vic-prompt-text"))).append($descriptionText));
var initPromptState=function(){if(noPrompt){$promptDefinition.hide();$minMaxSelectDiv.hide();}else{$descriptionText.val(prompt.Description);
$promptDefinition.show();if(prompt.SelectedPromptType==="Multiple"){$minMaxSelectDiv.show();}else{$minMaxSelectDiv.hide();
}if(isValidMinMaxInput(prompt.MinSelectionCount)){if(prompt.MinSelectionCount===0){prompt.MinSelectionCount=1;
}$minInput.val(prompt.MinSelectionCount);}if(isValidMinMaxInput(prompt.MaxSelectionCount)){$maxInput.val(prompt.MaxSelectionCount);
}}if(isPromptOverlayVisible){promptPopout.update();}};$radioButtonGroup.append($noPromptLabel);$radioButtonGroup.append($promptLabel);
$promptOverlayContent.append($radioButtonGroup,$promptDefinition);$promptInput.prop("checked",!noPrompt);
$noPromptInput.prop("checked",noPrompt);var promptChange=function(){noPrompt=$noPromptInput.is(":checked");
initPromptState();};$noPromptInput.change(promptChange);$promptInput.change(promptChange);var onPromptTypeChanged=function(value){prompt.SelectedPromptType=value;
if(value==="Multiple"){$minMaxSelectDiv.show();}else{$minMaxSelectDiv.hide();}};promptPopout=Spotfire.Visuals.Popout.showPopout(Spotfire.newFakeGuid(),{dialogType:Spotfire.Visuals.Popout.DialogType.ModalDialog,alignment:["Left","Right"],anchor:$item,useForPositioning:$radioButtonGroup,arrowAlignment:"Center",beforeClose:function(){if($promptInput.is(":checked")){resultCallback(prompt);
}else{resultCallback(null);}isPromptOverlayVisible=false;},runAfterDomAdded:function(){var promptTypes=_.map(prompt.PromptTypes,function(type){return{text:type.DisplayName,value:type.Name};
});Spotfire.Controls.DropDown.initialize($promptTypesSelectionDiv,{values:promptTypes,selectedValue:prompt.SelectedPromptType,useCombobox:false,onSelected:onPromptTypeChanged});
initPromptState();}},$promptOverlayContent);isPromptOverlayVisible=true;};var createColumnListItem=function(column){var $promptButton=$("<div>");
var $checkBox=$("<input type='checkbox'/>").attr("checked",!column.IsHidden);var scroll=false;var $item=$("<li>").addClass("sf-vic-column-list-item").hover(function(){if(!isPromptOverlayVisible&&!isEditColumnMode){$promptButton.show();
}},function(){if(!isPromptOverlayVisible&&!isEditColumnMode){$promptButton.toggle(activeViewBuilder.Prompts.contains(column.Name));
}}).bind("touchstart",function(){if(!isEditColumnMode){scroll=false;$item.toggleClass("disableHover",true);
}}).bind("touchmove",function(){if(!isEditColumnMode){scroll=true;}}).bind("touchend",function(e){if(!isEditColumnMode){if(!scroll){$checkBox.click();
}e.preventDefault();$item.toggleClass("disableHover",false);}});if(column.PromptDefinition!==undefined){$promptButton.addClass("sf-vic-prompt-icon").hide().attr("title",Spotfire.Localization.resources.ViewsInConnection_DefinePrompt).on("click",function(){var isNew=false;
var prompt=activeViewBuilder.Prompts.get(column.Name);if(!prompt){prompt=JSON.parse(JSON.stringify(column.PromptDefinition));
isNew=true;}if(column.RenamedName!==null){prompt.DisplayName=column.RenamedName;}showPromptPopout($promptButton,prompt,isNew,function(result){if(result){activeViewBuilder.Prompts.addOrReplace(result);
}else{activeViewBuilder.Prompts.remove(column.Name);}togglePromptIcon();togglePromptOrderButton();});
}).data("column",column);Spotfire.getSvg("Images/Data/Prompt.svg",function($svg){$svg.appendTo($promptButton);
});}if(hasPrompt(column)){$promptButton.show();}var displayName=getColumnDisplayName(column);$checkBox.change(function(){column.IsHidden=!$(this).is(":checked");
updateSelectAllCheckBox();});var $input=$("<input type='text'>").addClass("sf-element sf-element-input sf-vic-columns-list-item-input").val(displayName).on("keydown",columnInputKeyDown(column)).on("change",renameColumn(column));
var $label=$("<label>").addClass("sf-vic-columns-list-item-label").text(displayName).on("mousedown",function(e){if(e.which===1){$checkBox.click();
}e.preventDefault();});var $container=Spotfire.Flex.item({container:"horizontal","align-items":"center",fill:true}).css("height","100%");
$container.append($checkBox).append($input).append($label).append($promptButton);$item.append($container);
Spotfire.Controls.InputField.initialize($input,displayName,_.noop);Spotfire.Filters.StyledFilters.createStyledInput($item,13,13);
return $item;};var getSortedColumns=function(){if(activeViewBuilder===null){return[];}if(currentColumnSorting.Method===null){return activeViewBuilder.Columns.toArray();
}var columns=activeViewBuilder.Columns.toArray();columns.sort(currentColumnSorting.Method);return columns;
};var editColumns=function(event){var $editButton=$(this);$columnsList.toggleClass("sf-vic-edit-columns");
event.stopPropagation();$content.on("click",function(e){if(e.target.closest(".sf-vic-column-list-item")===null){$columnsList.trigger("exitEditColumnMode");
}});$content.off("exitEditColumnMode").on("exitEditColumnMode",function(){$columnsList.toggleClass("sf-vic-edit-columns",false);
$editButton.find("svg").attr("class","sf-element-svg-element sf-element-icon ");$content.off("click");
preventClose=false;isEditColumnMode=$columnsList.hasClass("sf-vic-edit-columns");togglePromptIcon();});
isEditColumnMode=$columnsList.hasClass("sf-vic-edit-columns");togglePromptIcon();if(isEditColumnMode){preventClose=true;
$editButton.find("svg").attr("class","sf-element-svg-element sfc-accent3-color");}else{preventClose=false;
$editButton.find("svg").attr("class","sf-element-svg-element sf-element-icon ");}};var createNoMatchSearchHint=function(){var $noMatchHint=Spotfire.Flex.item({container:"vertical",grow:true,"justify-content":"center","align-items":"center"}).addClass("sf-vic-search-hint");
var $searchWarningLabel=$("<div>").text(Spotfire.Localization.resources.ViewsInConnection_SearchNoMatch).addClass("sf-element-views-in-connection-hint sfc-no-match sf-vic-search-hint-text");
$noMatchHint.append($searchWarningLabel);return $noMatchHint;};var onSearch=function(searchString,$container,getNameFunc){var $itemsList=$container.find("li");
if(searchString.length>0){$itemsList.each(function(){var itemName=getNameFunc($(this)).toUpperCase();
if(itemName.indexOf(searchString)!==-1){$(this).show();$(this).closest(".sf-vic-list-container").removeClass("empty");
}else{$(this).hide();if($(this).siblings(":hidden").length===$(this).siblings().length){$(this).closest(".sf-vic-list-container").addClass("empty");
}else{$(this).closest(".sf-vic-list-container").removeClass("empty");}}});}else{$container.find(".sf-vic-search-hint").each(function(){$(this).closest(".sf-vic-list-container").removeClass("empty");
});if($container.is("ul")){$container.closest(".sf-vic-list-container").removeClass("empty");}$itemsList.show();
}handleResize();updateSelectAllCheckBox();};var showColumns=function(){$columnsListContainer.empty();
$columnsList=$("<ul>").addClass("sf-vic-list");$columnsListContainer.append($columnsList).addClass("sf-vic-list-container");
var $noMatchHint=createNoMatchSearchHint();$columnsListContainer.append($noMatchHint);var sortedColumns=getSortedColumns();
_.each(sortedColumns,function(column){var $columnListItem=createColumnListItem(column);$columnsList.append($columnListItem);
});togglePromptOrderButton();togglePromptIcon();onSearch($columnSearch.val().toUpperCase(),$columnsList,function($listItem){return $listItem.find("[type=text]").val().toUpperCase();
});if($columnsList[0].offsetHeight<$columnsList[0].scrollHeight){var maxHeight=$columnsListContainer.height()+1;
$columnsList.outerHeight(maxHeight);$columnsList.StyledScrollbar().refresh();}};var selectViewListItem=function($listItem){$pointers.find(".sf-vic-selected").removeClass("sf-vic-selected");
if($listItem.hasClass("sf-vic-selected")){$listItem.removeClass("sf-vic-selected");$detailsContent.stop();
$detailsContent.hide();$detailsContentHint.show();$promptOrderButton.hide();activeViewBuilder=null;return;
}$pointers.find(".sf-vic-selected").removeClass("sf-vic-selected");$addedTablesList.find(".sf-vic-selected").removeClass("sf-vic-selected");
$listItem.addClass("sf-vic-selected");$($pointers.children().get($listItem.index())).addClass("sf-vic-selected");
$detailsContentHint.hide();if(!$detailsContent.is(":visible")){$detailsContent.fadeIn();}activeViewBuilder=viewBuilders.get($listItem.data("id"));
showColumns();$detailsContent.trigger("init");};var isSelectable=function($listItem){return !$listItem.is(".sf-vic-readonly, .sf-vic-loading, .sf-vic-error, .sf-vic-unsupported");
};var onViewClicked=function(){if(!isSelectable($(this))){return;}selectViewListItem($(this));};var onRemove=function(e){e.stopPropagation();
var $itemToRemove=$(this).closest(".sf-vic-added-tables-list-item");var nameToRemove=$itemToRemove.data("id");
var doRemove=function(){var index=$itemToRemove.index();if($itemToRemove.hasClass("sf-vic-loading")){pendingTables-=1;
setOfCanceledLoadings.add(nameToRemove);}if($itemToRemove.hasClass("sf-vic-selected")){activeViewBuilder=null;
$promptOrderButton.hide();$detailsContent.hide();$detailsContentHint.fadeIn();}$($pointers.children().get(index)).remove();
$itemToRemove.fadeOut(200,function(){$itemToRemove.remove();$addedTablesList.StyledScrollbar().refresh();
});takenNames.remove(nameToRemove);viewBuilders.remove(nameToRemove);updateFooter();if($addedTablesList.children().length<=1){$addedTablesPanel.addClass("sf-vic-added-tables-panel-empty");
$addedDataTablesHint.fadeIn();$detailsContentHint.hide();}};var viewBuilder=viewBuilders.get(nameToRemove);
if(viewBuilder&&viewBuilder.DependentTables&&viewBuilder.DependentTables.length){var resource=viewBuilder.DependentTables.length===1?Spotfire.Localization.resources.ViewsInConnection_RemoveViewOneTable:Spotfire.Localization.resources.ViewsInConnection_RemoveViewManyTables;
var message=Spotfire.Utilities.formatString(resource,viewBuilder.DependentTables.join("\r\n"));Spotfire.ConfirmDialog.showYesNoDialog(Spotfire.Localization.resources.ViewsInConnection_RemoveViewDialogTitle,message,doRemove);
}else{doRemove();}};var createAddedTablesListItem=function(displayName,displayGroup,readOnly,supportsEdit,$infoTooltip){var $item=$("<li>").addClass("sf-element-views-in-connection-list-item sf-vic-added-tables-list-item").toggleClass("sf-vic-readonly",readOnly).toggleClass("sf-vic-unsupported",supportsEdit===false).click(onViewClicked).css("display","block");
var $inner=$("<div>").sfFlex({container:"horizontal","align-items":"center",fill:true}).css("height","100%").appendTo($item);
$("<div>").addClass("sf-vic-added-tables-list-item-selector sf-element-views-in-connection-hint sfc-accent").appendTo($inner);
var path="Images/Data/ViewsInConnectionTable.svg";if(displayGroup==="Reports"){path="Images/Data/ViewsInConnectionReport.svg";
}var $displayGroup=$("<div>").addClass("sf-vic-added-tables-display-group-icon").appendTo($inner);Spotfire.getSvg(path,function($svg){$svg.appendTo($displayGroup);
});$("<label>").text(displayName).attr("title",displayName).appendTo($inner).addClass("sf-vic-added-tables-list-item-title");
var $removeButton=$("<div>").addClass("sf-element-icon sfc-remove sf-vic-remove-button").attr("title",Spotfire.Localization.resources.ViewsInConnection_RemoveTooltip).click(onRemove).appendTo($inner);
Spotfire.getSvg("Images/Data/ViewsInConnectionRemoveTable.svg",function($svg){$svg.appendTo($removeButton);
});$("<div>").addClass("sf-vic-added-tables-loading-bar").appendTo($item);var $icon=$("<div>").addClass("sf-vic-added-tables-icon").appendTo($item);
Spotfire.getSvg("Images/Data/ErrorExclamation14x14.svg",function($svg){$("<div>").addClass("sf-vic-icon sf-vic-icon-error").append($svg).appendTo($icon);
});Spotfire.getSvg("Images/Data/Info28x28.svg",function($svg){$("<div>").addClass("sf-vic-icon sf-vic-icon-info").append($svg).appendTo($icon);
});if($infoTooltip){$item.addClass("sf-vic-has-icon sf-vic-info");vicToolTip($icon,$infoTooltip);}return $item;
};var updateAddedTableListItem=function(displayName){var $listItem=findViewListItem(displayName);$listItem.removeClass("sf-vic-loading");
if(!activeViewBuilder){selectViewListItem($listItem);}};var createViewBuilderColumns=function(baseSchemaColumns){var copy=JSON.parse(JSON.stringify(baseSchemaColumns));
return new Spotfire.Data.Collections.KeyedCollection(copy,getName);};var isInitiallyReadOnly=function(view){return selectedView&&view.Id!==selectedView;
};var getViewInfo=function(viewBuilder){if(!viewBuilder.Supported){return viewBuilder.NotSupportedReason;
}if(viewBuilder.DependentTables.length===0){throw"Unused views should not be included.";}if(viewBuilder.DependentTables.length===1){return null;
}var $info=$("<div>").text(Spotfire.Localization.resources.ViewsInConnection_EditViewAffectsTables);var $ul=$("<ul>").appendTo($info);
viewBuilder.DependentTables.forEach(function(t){$("<li>").text(t).appendTo($ul);});return $info;};var addTableListItem=function(viewBuilder){var schema=loadedSchemas[viewBuilder.BaseTableName];
var $infoTooltip=getViewInfo(viewBuilder);var $listItem=createAddedTablesListItem(viewBuilder.Name,schema.DisplayGroup,isInitiallyReadOnly(viewBuilder),viewBuilder.Supported,$infoTooltip);
$listItem.data("id",viewBuilder.Name);$addedTablesList.append($listItem);$pointers.append(createPointer());
return $listItem;};var onTableSchemasLoaded=function(viewBuildersToUpdate){var onLoaded=function(result){if(!result.Successful){_.each(viewBuildersToUpdate,function(viewBuilder){if(!setOfCanceledLoadings.contains(viewBuilder.Name)){pendingTables-=1;
var $listItem=findViewListItem(viewBuilder.Name);$listItem.removeClass("sf-vic-loading");$listItem.addClass("sf-vic-has-icon sf-vic-error");
$listItem.removeAttr("title");var $errorIcon=$listItem.find(".sf-vic-added-tables-icon");vicToolTip($errorIcon,result.Message);
}else{setOfCanceledLoadings.remove(viewBuilder.Name);}});updateFooter();return;}var tableSchemas=result.TableSchemas;
_.each(tableSchemas,function(tableSchema){loadedSchemas[tableSchema.Name]=tableSchema;});_.each(viewBuildersToUpdate,function(viewBuilder){if(!setOfCanceledLoadings.contains(viewBuilder.Name)){pendingTables-=1;
viewBuilder.Columns=createViewBuilderColumns(loadedSchemas[viewBuilder.BaseTableName].Columns);viewBuilders.add(viewBuilder);
updateAddedTableListItem(viewBuilder.Name);}else{setOfCanceledLoadings.remove(viewBuilder.Name);}});updateFooter();
};return onLoaded;};var loadTableSchemas=function(listOfTables,viewBuildersToUpdate){var listOfTablesJson=JSON.stringify({Tables:listOfTables});
Spotfire.Dxp.Web.Forms.AjaxService.Read(viewId,"LoadTableSchemas",listOfTablesJson,onTableSchemasLoaded(viewBuildersToUpdate));
};var createViewBuilder=function(displayName,baseTableName){var viewBuilder={Name:displayName,BaseTableName:baseTableName,Columns:new Spotfire.Data.Collections.KeyedCollection([],getName),Prompts:new Spotfire.Data.Collections.KeyedCollection([],getName)};
return viewBuilder;};var refreshAddedTablesList=function(){$addedTablesPanel.removeClass("sf-vic-added-tables-panel-empty");
$addedDataTablesHint.hide();if($addedTablesList.children().length===1&&activeViewBuilder===null){$detailsContentHint.fadeIn();
}updateFooter();$addedTablesList.StyledScrollbar().refresh();};var onAdd=function(){var theTable=$(this).data("table");
var displayName=generateUniqueName(theTable);var $listItem=createAddedTablesListItem(displayName,theTable.DisplayGroup,false);
$addedTablesPanel.removeClass("sf-vic-added-tables-panel-empty");$addedDataTablesHint.hide();$listItem.data("id",displayName);
$listItem.addClass("sf-vic-loading");$listItem.hide().fadeIn();$addedTablesList.append($listItem);var builder=createViewBuilder(displayName,theTable.Name);
$pointers.append(createPointer());if(loadedSchemas.hasOwnProperty(theTable.Name)){builder.Columns=createViewBuilderColumns(loadedSchemas[theTable.Name].Columns);
viewBuilders.add(builder);updateAddedTableListItem(displayName);}else{var tablesToLoad=[];var viewBuildersToUpdate=[];
setOfCanceledLoadings.remove(displayName);pendingTables+=1;tablesToLoad.push(theTable);viewBuildersToUpdate.push(builder);
loadTableSchemas(tablesToLoad,viewBuildersToUpdate);}refreshAddedTablesList();};var createTableList=function(tablesInGroup){var $uiList=$("<ul>").addClass("sf-element-views-in-connection-list sf-vic-list");
_.each(tablesInGroup,function(table){var $listItem=$("<li>").addClass("sf-element-views-in-connection-list-item sf-vic-source-table-list-item").click(onAdd).data("table",table);
$listItem.attr("title",table.DisplayName);$("<label>").text(table.DisplayName).appendTo($listItem).addClass("sf-vic-source-table-list-item-title");
var $hoverOverlay=$("<div>").addClass("sf-element-views-in-connection-list-item sfc-overlay sf-vic-source-table-list-item-overlay");
$listItem.append($hoverOverlay);$uiList.append($listItem);});return $uiList;};var createTablePanel=function($uiList,groupName){var $listContainer=Spotfire.Flex.item({container:"vertical",grow:true,"align-items":"stretch"}).addClass("sf-element-views-in-connection-list sf-vic-list-container");
$listContainer.append($uiList);var $listPanel=Spotfire.Flex.item({container:"vertical",grow:true,"align-items":"stretch"}).addClass("sf-vic-inner-panel");
var $header=$("<div>").addClass("sf-vic-source-table-list-header");var $icon=$("<div>").addClass("sf-vic-source-table-list-icon");
var path="Images/Data/ViewsInConnectionTable.svg";if(groupName==="Reports"){path="Images/Data/ViewsInConnectionReport.svg";
}Spotfire.getSvg(path,function($svg){$svg.appendTo($icon);});$header.append($icon);$("<label>").text(groupName).appendTo($header).addClass("sf-vic-source-table-list-header-text");
var $searchWarning=createNoMatchSearchHint();$listContainer.append($searchWarning);$listPanel.append($header);
$listPanel.append($listContainer);return $listPanel;};var initScrollbars=function(){_.each(tableLists,function($tableList){var height=$tableList.parent().outerHeight();
$tableList.height(height);$tableList.StyledScrollbar().refresh();});$addedTablesList.width($addedTablesPanel.width());
$addedTablesList.height($addedTablesPanel.height());$addedTablesList.StyledScrollbar();};var initializeLoadedSchemas=function(schemas){_.each(schemas,function(schema){loadedSchemas[schema.Name]=schema;
});};var initializeViewBuilders=function(views){_.each(views,function(view){var hiddenColumns=new Spotfire.Data.Collections.Set(view.ColumnsHidden);
var columnRenames=new Spotfire.Data.Collections.KeyedCollection(view.ColumnRenames,function(r){return r.OriginalName;
});view.Columns=createViewBuilderColumns(loadedSchemas[view.BaseTableName].Columns);view.Columns.forEach(function(column){column.IsHidden=hiddenColumns.contains(column.Name);
var rename=columnRenames.get(column.Name);if(rename){column.RenamedName=rename.RenamedName;}});view.Prompts=new Spotfire.Data.Collections.KeyedCollection(view.Prompts,getName);
viewBuilders.add(view);var $listItem=addTableListItem(view);if(dataDestination===Spotfire.Data.DataDestination.EditSource&&isSelectable($listItem)){selectViewListItem($listItem);
}});refreshAddedTablesList();};var refreshTablesList=function(tables){$tablesPanel.empty();var groupToTablesMap={};
_.each(tables,function(table){if(groupToTablesMap[table.DisplayGroup]){groupToTablesMap[table.DisplayGroup].push(table);
}else{groupToTablesMap[table.DisplayGroup]=[table];}});var tablePanels=[];_.each(groupToTablesMap,function(tablesInGroup,groupName){var $tableList=createTableList(tablesInGroup);
tableLists.push($tableList);var tablePanel=createTablePanel($tableList,groupName);tablePanels.push(tablePanel);
});tablePanels.sort(function(a,b){var valA=$(a).find(".sf-vic-source-table-list-header-text").text().toUpperCase();
var valB=$(b).find(".sf-vic-source-table-list-header-text").text().toUpperCase();return valA.localeCompare(valB);
});var $tableSearch=Spotfire.Data.Access.Common.createSearchField(Spotfire.Localization.resources.ViewsInConnection_SearchTables,function(){onSearch($tableSearch.val().toUpperCase(),$tablesPanel,function($listItem){return $listItem.text();
});_.each(tableLists,function($tableList){$tableList.StyledScrollbar().refresh();});});$tablesPanel.append($tableSearch);
_.each(tablePanels,function(panel){$tablesPanel.append(panel);});if(dataDestination===Spotfire.Data.DataDestination.EditSource&&canEditDataSource){Spotfire.Data.Access.Common.createCompactButton(Spotfire.Localization.resources.ViewsInConnection_EditDataSource).addClass("sf-vic-edit-data-source-button").click(editDataSource).appendTo($tablesPanel);
}initScrollbars();};var onSortColumnsClick=function(sortMenuItem){var ascending=function(col1,col2){var str1=getColumnDisplayName(col1);
var str2=getColumnDisplayName(col2);return str1.localeCompare(str2);};var descending=function(col1,col2){return -ascending(col1,col2);
};var setChecked=function(commandId){_.each(sortMenuItems,function(menuItem){if(menuItem.commandId===commandId){menuItem.checked=true;
}else{menuItem.checked=false;}});};if(currentColumnSorting.CommandId!==sortMenuItem.commandId){currentColumnSorting.CommandId=sortMenuItem.commandId;
setChecked(currentColumnSorting.CommandId);if(currentColumnSorting.CommandId==="Ascending"){currentColumnSorting.Method=ascending;
}else{if(currentColumnSorting.CommandId==="Descending"){currentColumnSorting.Method=descending;}else{if(currentColumnSorting.CommandId==="None"){currentColumnSorting.Method=null;
}}}showColumns();}sortMenu.close();};var showSortMenu=function(){var x=$sortButton.offset().left;var y=$sortButton.offset().top+$sortButton.outerHeight();
sortMenu.show(x,y);};var initSortMenu=function(){sortMenuItems=[{commandId:"None",text:Spotfire.Localization.resources.DataPanel_Sort_None,checked:true,enabled:true},{commandId:"Ascending",text:Spotfire.Localization.resources.DataPanel_Sort_Ascending,enabled:true},{commandId:"Descending",text:Spotfire.Localization.resources.DataPanel_Sort_Descending,enabled:true}];
sortMenu=Spotfire.Controls.ContextMenu.create(sortMenuItems,onSortColumnsClick);};var initColumnListHeader=function($header){var $selectAll=$("<div>");
var fakeGuid=Spotfire.newFakeGuid();$selectAllCheckbox=$("<input type='checkbox'/>").attr({name:fakeGuid,checked:true,id:fakeGuid});
$detailsContent.on("init",function(){updateSelectAllCheckBox();});$selectAll.change(function(){var value=$(this).find(":checkbox").is(":checked");
_.each(getVisibleColumnCheckBoxes(),function(checkbox){checkbox.checked=value;$(checkbox).trigger("change");
});});var $label=$("<label>").text(Spotfire.Localization.resources.ViewsInConnection_SelectAllColumns).attr("for",fakeGuid).css("margin-left",5);
$selectAll.append($selectAllCheckbox).append($label);Spotfire.Filters.StyledFilters.createStyledInput($selectAll,13,13);
var $buttons=$("<div>");$sortButton=$("<div>").addClass("sf-element-icon sf-vic-column-header-button sf-vic-sort-mode").attr("title",Spotfire.Localization.resources.ViewsInConnection_SortTooltip).click(showSortMenu);
Spotfire.getSvg("Images/Data/DataOverviewSortMode.svg",function($svg){$sortButton.empty().append($svg);
});var $editSign=$("<div>").addClass("sf-element-icon sf-vic-column-header-button").attr("title",Spotfire.Localization.resources.ViewsInConnection_RenameTooltip).click(editColumns);
Spotfire.getSvg("Images/Data/DataOverviewEdit.svg",function($svg){$svg.attr("class","sf-element-svg-element sf-element-icon ").appendTo($editSign);
});$buttons.append($editSign);$buttons.append($sortButton);$header.append($selectAll);$header.append($buttons);
};var showPreview=function(){previewBlock();updatePromptDisplayNames();Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,"Preview",JSON.stringify(activeViewBuilder));
};var initViewsInConnection=function(){initSortMenu();$content.toggleClass("sf-vic-edit-connection",dataDestination===Spotfire.Data.DataDestination.EditSource);
$tablesPanel=Spotfire.Flex.item({container:"vertical","align-items":"stretch"}).addClass("sf-element-views-in-connection-panel sfc-source-tables sf-vic-small-panel");
$addedTablesPanel=Spotfire.Flex.item({container:"vertical","align-items":"stretch",grow:true}).addClass("sf-element-views-in-connection-panel sfc-added-tables sf-vic-added-tables-panel sf-vic-added-tables-panel-empty");
$addedDataTablesHint=Spotfire.Flex.item({container:"vertical","justify-content":"center","align-items":"center",fill:true}).addClass("sf-element-views-in-connection-hint sfc-empty-state").css({position:"absolute",width:"100%"});
var $addedTablesHintIcon=$("<div>").addClass("sf-vic-added-tables-background-icon");Spotfire.getSvg("Images/Data/DataTableView.svg",function($svg){$svg.appendTo($addedTablesHintIcon);
});$addedTablesPanel.append($addedDataTablesHint);$addedDataTablesHint.append($addedTablesHintIcon);var $addedTablesHintLabel=$("<div>").text(Spotfire.Localization.resources.ViewsInConnection_DataPanelLabel).addClass("sf-vic-added-tables-background-text");
$addedDataTablesHint.append($addedTablesHintLabel);$addedTablesList=$("<ul>").addClass("sf-element-views-in-connection-list sf-vic-list");
$addedTablesPanel.append($addedTablesList);var $pointerPanel=Spotfire.Flex.item({container:"vertical"}).addClass("sf-vic-pointer-panel");
$pointers=$("<ul>").addClass("sf-vic-pointer-list");$pointerPanel.append($pointers);$addedTablesList.scroll(function(){$pointers.scrollTop($(this).scrollTop());
});var $detailsPanel=Spotfire.Flex.item({container:"vertical","align-items":"stretch"}).addClass("sf-element-views-in-connection-panel sfc-columns sf-vic-small-panel");
$detailsContent=Spotfire.Flex.item({container:"vertical","align-items":"stretch",grow:true}).addClass("sf-vic-details-content");
$detailsPanel.append($detailsContent);$detailsContentHint=Spotfire.Flex.item({container:"vertical","justify-content":"center","align-items":"center",grow:true}).addClass("sf-element-views-in-connection-hint sfc-empty-state");
$detailsPanel.append($detailsContentHint);$detailsContentHint.hide();var $detailsHintIcon=$("<div>").addClass("sf-vic-details-content-background-icon");
Spotfire.getSvg("Images/Data/DetailView.svg",function($svg){$svg.attr("class","sf-vic-details-content-background-icon-svg");
$svg.appendTo($detailsHintIcon);});$detailsContentHint.append($detailsHintIcon);var $detailsHintLabel=$("<div>").text(Spotfire.Localization.resources.ViewsInConnection_DetailsPanelLabel).addClass("sf-vic-details-content-background-text");
$detailsContentHint.append($detailsHintLabel);var $columnsContent=Spotfire.Flex.item({container:"vertical",grow:true,"align-items":"stretch"}).addClass("sf-element-views-in-connection-list sf-vic-columns-content");
$columnSearch=Spotfire.Data.Access.Common.createSearchField(Spotfire.Localization.resources.ViewsInConnection_SearchColumns,function(){showColumns();
$columnsList.StyledScrollbar().refresh();});$detailsContent.append($columnSearch);$detailsContent.append($columnsContent);
$detailsContent.hide();var $columnListHeader=Spotfire.Flex.item({container:"horizontal","justify-content":"space-between","align-items":"center"}).addClass("sf-vic-columns-header");
initColumnListHeader($columnListHeader);$columnsListContainer=Spotfire.Flex.item({container:"vertical","align-items":"stretch",grow:true});
$columnsContent.append($columnListHeader);$columnsContent.append($columnsListContainer);$promptOrderButton=createPromptOrderButton();
$detailsPanel.append($promptOrderButton);var $previewButton=Spotfire.Data.Access.Common.createPreviewButton().click(function(){showPreview();
return false;});$columnsContent.append($previewButton);var $blocker=Spotfire.Flex.item({container:"vertical",fill:true,"justify-content":"center","align-items":"center"}).addClass("sf-vic-container sf-loading-blocker");
$(Spotfire.Progress.createProgressAnimation(30,30)).css("position","relative").appendTo($blocker);$("<p>").text(Spotfire.Localization.resources.Cancel).addClass("sf-vic-loading-cancel").appendTo($blocker).click(function(){if(canEditDataSource){onCancelDialog();
}else{self.onClose(false);Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,"Cancel","");}});var cancelButtonCallback=function(){if(preventClose){return true;
}onCancelDialog();return false;};buttons=[{id:"okButton",disabled:true,click:okButtonCallback,isDefault:true},{id:"cancelButton",click:cancelButtonCallback,isCancel:true}];
$content.append($tablesPanel);$content.append($addedTablesPanel);$content.append($pointerPanel);$content.append($detailsPanel);
$dialog.append($blocker);};var showTableLoadError=function(error,errorDialogCallback){Spotfire.Framework.ErrorDialog.show(title,error,function(){Spotfire.Controls.ModalDialog.update($dialog,"buttons",[]);
errorDialogCallback();});};var onTablesRefreshed=function(result){unblock();if(result.Successful){refreshTablesList(result.Tables);
}else{showTableLoadError(result,editDataSource);}};var onDataSourceDone=function(needsRefresh){showFooter();
$dialog.show();if(needsRefresh){block();Spotfire.Dxp.Web.Forms.AjaxService.Read(viewId,"GetTables","",onTablesRefreshed);
}};var onSettingsLoaded=function(result){if(result.Canceled){return;}initFooter();unblock();if(result.Successful){$dialog.prepend($content);
if(result.Builders){initializeLoadedSchemas(result.TableSchemas);initializeViewBuilders(result.Builders);
}refreshTablesList(result.Tables);}else{showTableLoadError(result,function(){self.onClose(false);Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,"Cancel","");
});}};initViewsInConnection();self.onClose=_.noop;self.unblock=unblock;self.onDataSourceDone=onDataSourceDone;
self.elem=function(){return $dialog;};self.loadSettings=function(){cancelableBlock();Spotfire.Dxp.Web.Forms.AjaxService.Read(viewId,"GetSettings","",onSettingsLoaded);
};return self;}var show=function(settings){if(instance===null){instance=new ViewsInConnection(settings.viewId,settings.title,settings.existingNames,settings.selectedView,settings.dataDestination,settings.isPromptControl,settings.canEditDataSource,settings.unlockEditInfo);
instance.onClose=function(notify){instance=null;if(notify){Spotfire.Data.Access.ConnectorDataSource.viewsInConnectionClosed();
}};instance.loadSettings();}};Spotfire.Data.Access.ViewsInConnection.show=function(settings){if(settings.isPromptControl){Prompt.onPromptLoaded=function(){Prompt.setEnableSelection(false);
show(settings);};}else{if(instance===null){show(settings);}}};Spotfire.Data.Access.ViewsInConnection.unblock=function(){if(instance!==null){instance.unblock();
}};Spotfire.Data.Access.ViewsInConnection.onDataSourceDone=function(needsRefresh){if(instance!==null){instance.onDataSourceDone(needsRefresh);
}};Spotfire.Data.Access.ViewsInConnection.getDialogOptions=function(additionalOptions){var defaults={width:900,height:604,minWidth:524,minHeight:450,resizable:true,modal:true,type:"compact",dialogClass:"sf-ViewsInConnectionDialog"};
return _.extend(defaults,additionalOptions);};});$(function(){Spotfire.registerNameSpace("Import.DataTablePreview");
Spotfire.Import.DataTablePreview=function(settings){var data={};var $content=$("<div>").addClass("WorksheetPreview").sfFlex({container:"vertical",fill:true});
var $tableSelector=$("<div>").sfFlex({shrink:false});var $wrapper=$("<div>").addClass("WorksheetPreview-wrapper sf-element-preview-visual").sfFlex({grow:true});
var $scrollContent=$("<div>").addClass("WorksheetPreview-wrapper__scroll-content");var $dataTable=$("<div>").addClass("WorksheetPreview-table");
var styledScrollbar=null;function refresh(){$scrollContent.width($wrapper.width()).height($wrapper.height());
styledScrollbar.refresh();$dataTable.css("border-right-width",styledScrollbar.getVScrollbarSize());$dataTable.css("border-bottom-width",styledScrollbar.getHScrollbarSize());
styledScrollbar.refresh();}function populateData(key,value){data[key]=value;$("#"+settings.id).val(JSON.stringify(data));
}function populateTable(sheetName){var i,j;$dataTable.empty();var $thead=$("<div>").addClass("WorksheetPreview-table__row-group").appendTo($dataTable);
var $tbody=$("<div>").addClass("WorksheetPreview-table__row-group").appendTo($dataTable);var $row=$("<div>").addClass("WorksheetPreview-table__row");
var $column;for(i=0;i<settings.sheetData[sheetName].header.length;i++){$column=$("<div>").addClass("sf-element-table-cell sfc-column-header").text(settings.sheetData[sheetName].header[i].name).attr("title",settings.sheetData[sheetName].header[i].name);
if(settings.sheetData[sheetName].header[i].isNumeric){$column.addClass("WorksheetPreview--numeric");}$row.append($column);
}$thead.append($row);for(i=0;i<settings.sheetData[sheetName].rows.length;i++){$row=$("<div>").addClass("WorksheetPreview-table__row");
for(j=0;j<settings.sheetData[sheetName].rows[i].length;j++){$column=$("<div>").text(settings.sheetData[sheetName].rows[i][j]!==null?settings.sheetData[sheetName].rows[i][j]:"");
if(settings.sheetData[sheetName].header[j].isNumeric){$column.addClass("WorksheetPreview--numeric");}$column.addClass("sf-element-table-cell sfpc-value-cell");
$column.addClass(i%2===0?"sfpc-even-row":"sfpc-odd-row");$column.addClass(j%2===0?"sfpc-even-column":"sfpc-odd-column");
if(i===0){$column.addClass("sfpc-first-row");}if(i===settings.sheetData[sheetName].rows.length-1){$column.addClass("sfpc-last-row");
}if(j===settings.sheetData[sheetName].rows[i].length-1){$column.addClass("sfpc-last-column");}$row.append($column);
}$tbody.append($row);}refresh();}function buildTableSelector(){var options=_.map(settings.sheetNames,function(name){return{text:name,value:name};
});Spotfire.Controls.DropDown.initialize($tableSelector,{values:options,selectedValue:settings.sheetNames[0],width:300,onSelected:function(value){populateTable(value);
populateData("sheetName",value);}});}$("#"+settings.id).after($content);populateData("sheetName",settings.sheetNames[0]);
$content.append($("<h4>").addClass("WorksheetPreview-title").text(Spotfire.Localization.resources.dataTablePreviewWorksheetSelectorTitle));
$content.append($tableSelector);$scrollContent.append($dataTable);$wrapper.append($scrollContent);$content.append($wrapper);
buildTableSelector();styledScrollbar=$scrollContent.StyledScrollbar();populateTable(settings.sheetNames[0]);
Prompt.onResize=function(){refresh();};Prompt.fillHeight();};});$(function(){Spotfire.registerNameSpace("Filters.BatchRead");
var createBatchReader=function(readDelay){var timer=null;var pendingBatches={};var resultQueue=[];var resultQueueTimer=null;
var processResultQueue=function(){if(resultQueue.length===0){resultQueueTimer=null;return;}var item=resultQueue.shift();
item();resultQueueTimer=window.setTimeout(processResultQueue,0);};var onTimeout=function(){var copy=pendingBatches;
pendingBatches={};$.each(copy,function(viewId,updateBatch){var getMasksCallback=function(result){$.each(result,function(id,value){resultQueue.push(function(){updateBatch[id].callback(value);
});});if(resultQueueTimer){return;}processResultQueue();};var args=[];$.each(updateBatch,function(id,argsAndCallback){args.push({id:id,args:argsAndCallback.args});
});Spotfire.Dxp.Web.Forms.AjaxService.Read(viewId,"BatchReadControl",JSON.stringify(args),getMasksCallback);
});};var scheduleRead=function(id,args,callback){try{if(timer){window.clearTimeout(timer);}var viewId=$("#"+id).closest("[viewId]").attr("viewId");
if(viewId===undefined){return;}var updateBatch=pendingBatches[viewId];if(updateBatch===undefined||updateBatch===null){updateBatch={};
pendingBatches[viewId]=updateBatch;}updateBatch[id]={args:args,callback:callback};}finally{timer=window.setTimeout(onTimeout,readDelay);
}};return scheduleRead;};Spotfire.Filters.BatchRead.update=createBatchReader(300);Spotfire.Filters.BatchRead.getValues=createBatchReader(100);
});$(function(){var DIV_MAXHEIGHT=1000000;var CLASS_LIST_ITEM="sf-element-list-box-item";function CheckBoxHierarchyFilter(id,$parent,attributes){var settings={hasFixedHeight:true,height:15,totalVisibleValues:0,itemHeight:20,showSearchField:true,searchExpression:"",searchAllLevels:true,searchLevel:0,allowCheck:true,triStateEnabled:false,attributes:attributes};
$parent.addClass("CheckBoxHierarchyFilter").empty();var contextMenuCallback=function(){var index=getSelectedIndex();
if(index!==-1){var item=items[index];if(item!==undefined&&item!==null){if(item.IsLeaf&&(item.IsInProgress||item.Error!==undefined)){return{nodeId:null,confirmed:false};
}else{return{nodeId:item.NodeId,confirmed:false};}}}return{nodeId:null,confirmed:false};};$parent.data("contextMenuCallback",contextMenuCallback);
var delay=0;var clickTimer=null;var commands=[];var currentClientGeneration=0;var items;var selectedIndex=-1;
var scrollTimer;var scrollDelay=0;var searchFieldAppended=false;var inputField;var scrollInitialized=false;
var vScroller=Spotfire.Control.VirtualScroller.create();var itemSpacing;var onTimeout=function(){clickTimer=null;
var args=JSON.stringify(commands);commands=[];currentClientGeneration++;Spotfire.WebView.modifyControl(id,args,currentClientGeneration);
};var enqueue=function(command,executeImmediately){if(clickTimer){window.clearTimeout(clickTimer);}clickTimer=window.setTimeout(onTimeout,executeImmediately?0:delay);
delay=Spotfire.isWebPlayer()?500:0;commands.push(command);};var isUpToDate=function(clientGeneration){if(currentClientGeneration>clientGeneration){return false;
}if(clickTimer){return false;}return true;};var isMaxScroll=function(){return Spotfire.capabilities.supportsTouch()&&settings.totalVisibleValues*settings.itemHeight>DIV_MAXHEIGHT;
};var $container=$("<div/>").addClass("ListContainer");var $viewport=$("<div/>").addClass("sf-element-list-box");
var $scrollArea=$("<div/>").addClass("ScrollArea");var $searchBox=$("<div />").addClass("sf-element-input");
var $searchInput;var $searchHoverArea;var searchImage;var $searchSettingsButton;var $listItems=$("<div/>").addClass("ListItems");
$viewport.append($scrollArea);$scrollArea.append($listItems);$container.append($viewport);$parent.append($container);
var onSearchSettingsButtonClick=function(){var point={x:$searchSettingsButton.offset().left,y:$searchSettingsButton.offset().top+15};
var callback=function(ctxitems){var menu=Spotfire.Controls.ContextMenu.create(ctxitems,function(ctxitem){var val={action:"SetSearchSettings",tag:ctxitem.tag};
enqueue(val,true);return true;});menu.show(point.x,point.y);};var value={method:"GetSearchSettingsMenu"};
Spotfire.WebView.readControl(id,JSON.stringify(value),callback);};var performLayout=function(){vScroller.update(new Size(0,settings.totalVisibleValues*settings.itemHeight),new Size(0,settings.height*settings.itemHeight));
var scrollBarWidth=!Spotfire.capabilities.supportsTouch()&&settings.totalVisibleValues>settings.height?styledScrollbar.getVScrollbarSize(true):0;
var containerWidth=Math.max(0,$parent.width());var viewportWidth=Math.max(0,containerWidth);var viewportHeight=settings.height*settings.itemHeight;
var scrollAreaWidth=Math.max(0,viewportWidth-scrollBarWidth-2);$container.css({width:containerWidth+scrollBarWidth+"px",height:(viewportHeight+2)+"px"});
$viewport.css({width:Math.max(0,viewportWidth-2)+"px",height:viewportHeight+"px"});var scrollAreaHeight=Spotfire.capabilities.supportsTouch()?(isMaxScroll()?DIV_MAXHEIGHT:settings.totalVisibleValues*settings.itemHeight):(Math.min(settings.height+1,settings.totalVisibleValues)*settings.itemHeight);
$scrollArea.css({width:scrollAreaWidth+"px",height:scrollAreaHeight+"px"});var numberOfItems=(settings.height+1);
if($("."+CLASS_LIST_ITEM,$listItems).length!=numberOfItems){$listItems.empty();var top=0,i,itemDiv;for(i=0;
i<numberOfItems;i++){itemDiv=$("<div/>").addClass("ListItem "+CLASS_LIST_ITEM);itemDiv.css({top:top+"px",height:settings.itemHeight+"px","line-height":settings.itemHeight+"px"});
$listItems.append(itemDiv);top=top+settings.itemHeight;if(typeof itemSpacing==="undefined"){itemSpacing=itemDiv.outerWidth()-itemDiv.width();
}}}var leftPaddings=[];var $items=$("."+CLASS_LIST_ITEM,$listItems);$items.each(function(j,elem){var leftPadding=parseInt($(elem).css("padding-left"),10);
leftPaddings[j]=leftPadding;});$items.each(function(k,elem){var $item=$(elem);$item.css("width",Math.max(0,scrollAreaWidth-itemSpacing-leftPaddings[k])+"px");
});if(settings.hasFixedHeight){$viewport.addClass("sfc-scrollable");}else{$viewport.removeClass("sfc-scrollable");
}if(!scrollInitialized){if(Spotfire.capabilities.supportsTouch()){if(settings.hasFixedHeight){var scroll=new IScroll($scrollArea.get(0),null,{hScrollbarEnabled:false});
scroll.onScroll=onScroll;vScroller={scrollTop:function(pos){if(typeof pos==="number"){scroll.scrollTop(pos);
}return scroll.scrollTop();},update:$.noop,onScroll:$.noop};scrollInitialized=true;}}else{vScroller.onScroll(onScroll);
scrollInitialized=true;}}if(settings.showSearchField){if(!searchFieldAppended){$searchInput=$("<input type='text'/>").addClass("sf-element-input");
$searchHoverArea=$("<div />").addClass("SearchHoverArea");searchImage=$("<div />").addClass("VirtualBoxMagnifier");
$searchSettingsButton=$("<div />").addClass("sf-element-button");Spotfire.getSvg("Images/Filters/HierarchyFilterSearchAllLevels.svg",function(svg){$searchSettingsButton.append(svg);
});$searchInput.css("border-style","none");$parent.prepend($searchBox);$searchBox.append($searchHoverArea);
$searchHoverArea.append($searchInput);$searchHoverArea.append(searchImage);$searchBox.append($searchSettingsButton);
searchFieldAppended=true;inputField=Spotfire.Controls.InputField.initialize($searchInput,Spotfire.Localization.resources.ListBoxFilterTypeToSearch,function(pattern){settings.searchExpression=pattern;
var value={action:"SearchExpression",expression:pattern};enqueue(value,true);});Spotfire.Filters.StyledFilters.createMagnifierGlass(searchImage);
$searchHoverArea.on("mouseenter",function(){searchImage.addClass("Hover");});$searchHoverArea.on("mouseleave",function(){searchImage.removeClass("Hover");
});$searchInput.on("focus",function(){searchImage.addClass("Focus");});$searchInput.on("blur",function(){searchImage.removeClass("Focus");
});searchImage.on("click",function(){inputField.submit();});$searchSettingsButton.on("click",onSearchSettingsButtonClick);
}inputField.update(settings.searchExpression);var margin=$searchInput.outerWidth(true)-$searchInput.outerWidth();
$searchInput.width(Math.max(0,$searchHoverArea.width()-margin-searchImage.outerWidth(true)));}else{if(searchFieldAppended){$searchBox.remove();
searchFieldAppended=false;}}styledScrollbar.refresh();};var getNormalizedScroll=function(){return vScroller.scrollTop()/($scrollArea.height()-$viewport.height());
};var getScrollPosition=function(){return vScroller.scrollTop();};var getTopIndex=function(){if(isMaxScroll()){return Math.max(0,Math.floor(getNormalizedScroll()*settings.totalVisibleValues)-settings.height);
}return Math.floor(getScrollPosition()/settings.itemHeight);};var getItemIndex=function(y){var offsetY=y-$viewport.offset().top-parseInt($viewport.css("padding-top"),10);
if(isMaxScroll()){return getTopIndex()+Math.floor(offsetY/settings.itemHeight);}return Math.floor((offsetY+getScrollPosition())/settings.itemHeight);
};var isSelected=function(index){return index==selectedIndex;};var onExpandCollapseClicked=function(index){var item=items[index];
if(typeof item==="undefined"||item===null){return;}var value={action:"ToggleExpand",nodeId:item.NodeId};
if(settings.attributes!=undefined){value.attributes=settings.attributes;}enqueue(value,true);item.IsExpanded=!item.IsExpanded;
refresh();};var onErrorClicked=function(index){var item=items[index];if(typeof item==="undefined"||item===null){return;
}var value={action:"Retry",nodeId:item.NodeId};enqueue(value,true);item.IsInProgress=true;refresh();};
var onCheckBoxClicked=function(index,$checkBox){var item=items[index];if(typeof item==="undefined"||item===null){return;
}var checked=$checkBox.prop("checked");var value={action:"SetCheckState",nodeId:item.NodeId,checked:checked};
enqueue(value,false);var level=item.Level;item.IsChecked=checked;if(!item.IsLeaf||item.Level===-1){var descendantIndex,descendant,descendantLevel;
for(descendantIndex=index+1;descendantIndex<settings.totalVisibleValues;descendantIndex++){descendant=items[descendantIndex];
if(descendant===undefined||descendant===null){break;}descendantLevel=descendant.Level;if(descendantLevel<=level){break;
}descendant.IsChecked=checked;descendant.IsTriState=false;}}var currentLevel=level,ancestorIndex,ancestor;
for(ancestorIndex=index;ancestorIndex>0&&currentLevel>-1;){ancestorIndex--;ancestor=items[ancestorIndex];
if(typeof ancestor==="undefined"||ancestor===null){break;}var ancestorLevel=ancestor.Level;if(ancestorLevel<currentLevel){ancestor.IsTriState=true;
if(checked){ancestor.IsChecked=true;}currentLevel--;}}refresh();};var refreshSelection=function($item){$("."+CLASS_LIST_ITEM+".sfpc-selected",$listItems).removeClass("sfpc-selected");
if(items[selectedIndex]!==undefined){$item.addClass("sfpc-selected");}};var progressTimers=(function(){var timers=[];
var addTimeout=function(callback){callback();};var clear=function(){while(timers.length>0){window.clearTimeout(timers.pop());
}};return{addTimeout:addTimeout,clear:clear};})();var svgResources=(function(){var $progress=$();var $error=$();
Spotfire.getSvg("Images/Progress/CircularProgressAnimation.svg",function($svg){$progress=$svg.css("height","100%");
});Spotfire.getSvg("Images/Buttons/Error.svg",function($svg){$error=$svg.css("height","100%");});var paddingTop=4;
var paddingLeft=6;var padder=function(containerHeight){return $("<div/>").css({position:"absolute","padding-top":paddingTop+"px","padding-left":paddingLeft+"px",height:(containerHeight-2*paddingTop)+"px"});
};var getSvg=function(containerHeight,$svg){if(containerHeight!==undefined){return padder(containerHeight).append($svg.clone());
}else{return $svg.clone();}};var getError=function(containerHeight){return getSvg(containerHeight,$error);
};var getProgress=function(containerHeight){return getSvg(containerHeight,$progress);};return{getError:getError,getProgress:getProgress};
})();var refresh=function(){progressTimers.clear();var scrollPosition=getScrollPosition();var remainder=isMaxScroll()?0:Math.floor(scrollPosition%settings.itemHeight);
var listItemTop=Spotfire.capabilities.supportsTouch()?scrollPosition:0;$listItems.css("top",(listItemTop-remainder)+"px");
var topIndex=getTopIndex();var scrollAreaWidth=$scrollArea.width();$("."+CLASS_LIST_ITEM,$listItems).each(function(i,elem){var $item=$(elem);
var index=i+topIndex;var hasValue=typeof items[index]!=="undefined";var text=hasValue?items[index].Text:"...";
var selected=hasValue?isSelected(index):false;$item.attr("title",text);var item=items[index];$item.empty();
if(hasValue){var indentation=6+8*Math.max(0,item.Level)+(item.IsLeaf?9:0);$item.css({"padding-left":indentation+"px",width:scrollAreaWidth-indentation-itemSpacing+"px"});
if(!item.IsLeaf){var $expandCollapse=$("<div/>").addClass("ExpandCollapse sf-element-expand-collapse-button");
if(item.IsExpanded){$expandCollapse.addClass("Expanded");}$expandCollapse.click(function(){onExpandCollapseClicked(index);
});Spotfire.Filters.StyledFilters.createExpandCollapseButton($expandCollapse,{width:9,height:9});$item.append($expandCollapse);
if(item.IsInProgress){progressTimers.addTimeout(function(){$expandCollapse.empty().append(svgResources.getProgress());
});}}else{var itemHeight=$item.height();if(item.Error){var errorMessage=item.Error.ShortDisplayMessage;
var $error=svgResources.getError(itemHeight);$error.attr("title",errorMessage);$error.one("click",function(){onErrorClicked(index);
});$error.addClass("error-button");$item.empty();$item.append($error);if(item.IsInProgress){$error.css({opacity:"0.25",filter:"alpha(opacity=0)"});
$item.append(svgResources.getProgress(itemHeight));}}else{if(item.IsInProgress){progressTimers.addTimeout(function(){$item.append(svgResources.getProgress(itemHeight));
});}}}if(settings.allowCheck){if(!(item.IsLeaf&&(item.IsInProgress||item.Error!==undefined))){var checked=item.IsChecked;
var $checkBox=$("<input type='checkbox' />");$checkBox.prop("checked",checked);if(settings.triStateEnabled){var triState=item.IsTriState;
$checkBox.prop("indeterminate",triState);}$checkBox.click(function(){onCheckBoxClicked(index,$(this));
});$item.append($checkBox);}}}var $label=$("<label></label>");$label.text(text);if(hasValue){if(item.NodeMatchesSearch){$label.css("font-weight","bold");
}if(!item.FilteredByOthers){$item.addClass("sfpc-dimmed");}else{$item.removeClass("sfpc-dimmed");}}$item.append($label);
if(selected){$item.addClass("sfpc-selected");}else{$item.removeClass("sfpc-selected");}$item.on("mouseenter",function(){$item.addClass("sfpc-hover");
});$item.on("mouseleave",function(){$item.removeClass("sfpc-hover");});});Spotfire.Filters.StyledFilters.createStyledInput($listItems,13,13,{position:"absolute",left:"-20px",opacity:"0"});
};var fetchInitialData=function(){var clientGenerationAtRead=currentClientGeneration;var getVisibleValuesCallback=function(result){if(isUpToDate(clientGenerationAtRead)){settings.totalVisibleValues=result.TotalVisibleValues;
items={};for(var i=0;i<result.Items.length;i++){items[i+result.TopIndex]=result.Items[i];}performLayout();
refresh();}};var low=getTopIndex();var high=low+settings.height;var value={method:"GetInitialVisibleValues",low:low,high:high};
if(settings.attributes!=undefined){value.attributes=settings.attributes;}Spotfire.WebView.readControl(id,JSON.stringify(value),getVisibleValuesCallback);
};var fetchData=function(){if(settings.totalVisibleValues<1){return;}var clientGenerationAtRead=currentClientGeneration;
var getVisibleValuesCallback=function(result){if(isUpToDate(clientGenerationAtRead)){for(var i=0;i<result.Items.length;
i++){items[i+result.TopIndex]=result.Items[i];}scrollDelay=0;refresh();}};var low=getTopIndex();var high=Math.min(settings.totalVisibleValues,low+settings.height+1)-1;
var value={method:"GetVisibleValues",low:low,high:high};if(settings.attributes!=undefined){value.attributes=settings.attributes;
}Spotfire.WebView.readControl(id,JSON.stringify(value),getVisibleValuesCallback);};var onMouseDown=function(e){if(e.which!==1&&(e.which!==3)){return;
}var $elem=$(e.target);var $target=$elem;do{if($target.is("input")||$target.hasClass("StyledInput")||$target.hasClass("ExpandCollapse")){return;
}$target=$target.parent();}while($target.length>0);var clickedIndex=getItemIndex(e.pageY);if(items[clickedIndex].Error!==undefined){return;
}selectedIndex=clickedIndex;refreshSelection($elem.closest("."+CLASS_LIST_ITEM));};var onScroll=function(){refresh();
if(scrollTimer){window.clearTimeout(scrollTimer);}scrollTimer=window.setTimeout(fetchData,scrollDelay);
scrollDelay=Spotfire.isWebPlayer()?300:0;};var update=function(settingsUpdate){delay=0;currentClientGeneration=settingsUpdate.ClientGeneration;
settings.itemHeight=settingsUpdate.ItemHeight;settings.showSearchField=settingsUpdate.SearchFieldVisible;
settings.searchExpression=settingsUpdate.SearchExpression;settings.searchAllLevels=settingsUpdate.SearchAllLevels;
settings.searchLevel=settingsUpdate.SearchLevel;settings.hasFixedHeight=settingsUpdate.HasFixedHeight;
settings.triStateEnabled=settingsUpdate.TriStateEnabled;if(settingsUpdate.AllowCheck!==undefined){settings.allowCheck=settingsUpdate.AllowCheck;
}if(settingsUpdate.HasFixedHeight){settings.height=settingsUpdate.Height;performLayout();fetchInitialData();
}else{var count=settingsUpdate.Items.length;var height=count+(settingsUpdate.IsTruncated?1:0);settings.height=height;
settings.totalVisibleValues=height;items={};for(var i=0;i<count;i++){items[i]=settingsUpdate.Items[i];
}performLayout();refresh();}};$viewport.css("overflow-x","hidden");var styledScrollbar=$viewport.StyledScrollbar({cssClass:"ListContainerScroll",isScrollWheelDisabled:function(){return $("#"+id).closest(".sfc-filter-panel").length>0&&!Spotfire.FilterPanel.isSelected(id);
},lineSize:function(){return settings.itemHeight;},virtualScroller:(Spotfire.capabilities.supportsTouch()?undefined:vScroller)});
$scrollArea.mousedown(onMouseDown);var getSelectedIndex=function(){return selectedIndex;};this.isUpToDate=isUpToDate;
this.update=update;this.getSelectedIndex=getSelectedIndex;}Spotfire.registerNameSpace("Filters.CheckBoxHierarchyFilter");
Spotfire.Filters.CheckBoxHierarchyFilter.create=function(id,settings,$parent,attributes){if(!$parent){$parent=$("#"+id);
}var filter=new CheckBoxHierarchyFilter(id,$parent,attributes);$parent.data("filter",filter);filter.update(settings);
};Spotfire.Filters.CheckBoxHierarchyFilter.update=function(id,settings,$parent){if(!$parent){$parent=$("#"+id);
}var filter=$parent.data("filter");if(filter&&filter.isUpToDate(settings.ClientGeneration)){filter.update(settings);
}};});$(function(){Spotfire.registerNameSpace("Filters.ColumnFilter");function ColumnFilter(id,type){var $parent=$("#"+id).addClass("ColumnFilter");
var isRadio=type==="radio";var requestCount=0;var delay=0;var delayConstant=Spotfire.isWebPlayer()?500:0;
var clickTimer=null;var dimmingMask=null;var applyDimmingMask=function(){if(dimmingMask===null){return;
}var func=function(i,elem){var $label=$(elem);if(dimmingMask[i]){$label.addClass("sfpc-dimmed");}else{$label.removeClass("sfpc-dimmed");
}};$.each($(".sf-element-text-box",$parent),func);};var onTimeout=function(){clickTimer=null;var value=isRadio?-1:[];
$(isRadio?".sf-element-radio-button":".sf-element-check-box",$parent).each(function(i,elem){var $checkbox=$(elem);
if(isRadio){if($checkbox.hasClass("sfpc-checked")){value=i;return false;}}else{value.push($checkbox.hasClass("sfpc-checked"));
}});requestCount++;Spotfire.WebView.modifyControl(id,JSON.stringify(value));};var onClick=function(){if(clickTimer){window.clearTimeout(clickTimer);
}var $item=$(this).parent();if(isRadio){$(".sf-element-radio-button.sfpc-checked",$parent).removeClass("sfpc-checked").addClass("sfpc-unchecked");
$(".sf-element-radio-button",$item).addClass("sfpc-checked").removeClass("sfpc-unchecked");}else{var $checkbox=$(".sf-element-check-box",$item);
if($checkbox.hasClass("sfpc-unchecked")){$checkbox.addClass("sfpc-checked").removeClass("sfpc-unchecked");
}else{$checkbox.addClass("sfpc-unchecked").removeClass("sfpc-checked");}}clickTimer=window.setTimeout(onTimeout,delay);
delay=delayConstant;};var update=function(settings){var items=settings.items;requestCount=Math.max(0,requestCount-1);
if(requestCount>0){return;}if(clickTimer){return;}delay=0;$parent.empty();var i,$item,$label,$checkbox,$itemWrapper;
for(i=0;i<items.length;i++){$itemWrapper=Spotfire.Flex.item({container:"horizontal",inline:true,"align-items":"center"});
$itemWrapper.css("max-width","100%");$item=$("<div/>").addClass("sf-element sf-element-filter-item").append($itemWrapper);
if(isRadio){$checkbox=Spotfire.Filters.StyledFilters.createSvgRadio(13,13);}else{$checkbox=$("<div/>").addClass("sf-element sf-element-check-box");
Spotfire.getSvg("Images/Filters/CheckMark.svg",(function($cb){return function($svg){$cb.append($svg);
};})($checkbox));}$checkbox.sfFlex({shrink:false}).addClass(items[i].isChecked?"sfpc-checked":"sfpc-unchecked").appendTo($itemWrapper);
$label=Spotfire.Flex.item().addClass("sf-element sf-element-text-box").css("text-overflow","ellipsis").appendTo($itemWrapper);
$label.text(items[i].text);$label.attr("title",items[i].text);if(dimmingMask!==null&&(dimmingMask[i])){$label.addClass("sfpc-dimmed");
}$itemWrapper.on("click",onClick);$parent.append($item);}if(settings.isTruncated){$label=$("<div/>").addClass("sf-element sf-element-text-box").appendTo($parent);
$label.text("...");$label.attr("title",Spotfire.Localization.resources.ColumnFilterTruncated);}applyDimmingMask();
};var updateDimmingMask=function(){var callback=function(mask){if(mask!=null){dimmingMask=mask;applyDimmingMask();
}};var args={method:"GetUpdateMask"};Spotfire.Filters.BatchRead.update(id,JSON.stringify(args),callback);
};this.update=update;this.updateDimmingMask=updateDimmingMask;}Spotfire.Filters.ColumnFilter.create=function(id,type,settings){var filter=new ColumnFilter(id,type);
$("#"+id).data("filter",filter);filter.update(settings);filter.updateDimmingMask();};Spotfire.Filters.ColumnFilter.update=function(id,settings){var filter=$("#"+id).data("filter");
if(filter){filter.update(settings);filter.updateDimmingMask();}};Spotfire.Filters.ColumnFilter.updateMask=function(id){var filter=$("#"+id).data("filter");
if(filter){filter.updateDimmingMask();}};});function DatePicker(initialDate,x,y){var replaceTable,close;
if(initialDate===null){initialDate=new Date();}var table=null;var value=null;var calendar=this;var windowMargin=10;
this.onValueChanged=function(){};this.getValue=function(){return value;};var dayNames=Spotfire.Localization.resources.DayNames;
var months=Spotfire.Localization.resources.MonthNames;var firstDayOfWeek=Spotfire.Localization.resources.FirstDayOfWeek;
var containerDiv=$("<div></div>");containerDiv.addClass("DatePicker");if(Spotfire.capabilities.supportsDropShadow()){containerDiv.addClass("RoundedDropShadow");
}var previousFocus=$(document.activeElement);var returnFocus=function(){if(previousFocus.length!==0){Spotfire.Focus.setFocus(previousFocus);
}};var documentOnMouseDown=function(e){if($(".DatePicker").has(e.target).length===0){close();}};close=function(){containerDiv.remove();
$(document.body).unbind("mousedown",documentOnMouseDown);Spotfire.MultipleViews.OffRemoteFocus(close);
};Spotfire.MultipleViews.OnRemoteFocus(close);$(document.body).append(containerDiv);$(document.body).bind("mousedown",documentOnMouseDown);
var cellOnClick=function(){value=$(this).data("date");calendar.onValueChanged();close();returnFocus();
};var getDayName=function(dayNumber){var standardDayNumber=(dayNumber+firstDayOfWeek)%7;return dayNames[standardDayNumber];
};var getFirstDayOfPreviousMonth=function(d){var month=d.getUTCMonth()-1;if(month>=0){return new Date(Date.UTC(d.getUTCFullYear(),month,1));
}return new Date(Date.UTC(d.getUTCFullYear()-1,11,1));};var getFirstDayOfNextMonth=function(d){var month=d.getUTCMonth()+1;
if(month<=11){return new Date(Date.UTC(d.getUTCFullYear(),month,1));}return new Date(Date.UTC(d.getUTCFullYear()+1,0,1));
};var cloneDatePartOnly=function(d){return new Date(Date.UTC(d.getUTCFullYear(),d.getUTCMonth(),d.getUTCDate()));
};var isSameDay=function(d1,d2){return cloneDatePartOnly(d1).getTime()===cloneDatePartOnly(d2).getTime();
};var renderTable=function(targetDate,parent){var monthText=months[targetDate.getUTCMonth()]+" "+targetDate.getUTCFullYear();
var container=$("<div />");parent.append(container);var header=$("<div />").addClass("Header");var back=$("<span>").addClass("Back").click(function(){replaceTable(getFirstDayOfPreviousMonth(targetDate));
});var month=$("<span>").addClass("Month").html(monthText);var next=$("<span>").addClass("Next").click(function(){replaceTable(getFirstDayOfNextMonth(targetDate));
});header.append(back).append(month).append(next);container.append(header);Spotfire.Filters.StyledFilters.createSvgPrevMonth(back);
Spotfire.Filters.StyledFilters.createSvgNextMonth(next);container.append($("<div />").addClass("Separator"));
table=$("<table />").addClass("Calendar");container.append(table);var row=$("<tr />");table.append(row);
row.addClass("DayNames");var w;for(w=0;w<7;w++){row.append($("<td />").html(getDayName(w)));}var currentDate=new Date(Date.UTC(targetDate.getUTCFullYear(),targetDate.getUTCMonth(),1));
currentDate.setUTCDate(1-currentDate.getUTCDay()+firstDayOfWeek-(firstDayOfWeek>=currentDate.getUTCDay()?7:0));
var i,j,cell;for(i=0;i<6;i++){row=$("<tr />").addClass("Week");table.append(row);for(j=0;j<7;j++){cell=$("<td />");
row.append(cell);cell.data("date",cloneDatePartOnly(currentDate));cell.click(cellOnClick);cell.text(currentDate.getUTCDate());
if(isSameDay(currentDate,initialDate)){cell.addClass("Initial");}if(currentDate.getUTCMonth()===targetDate.getUTCMonth()){cell.addClass("CurrentMonth");
}currentDate.setUTCDate(currentDate.getUTCDate()+1);}}return container;};replaceTable=function(targetDate){if(table!==null){table.remove();
}table=renderTable(targetDate,containerDiv);};replaceTable(initialDate);var left=Math.min(x,$(window).width()-containerDiv.outerWidth()-windowMargin);
var top=Math.min(y,$(window).height()-containerDiv.outerHeight()-windowMargin);containerDiv.css("left",left);
containerDiv.css("top",top);Spotfire.Focus.handleKeyDown(containerDiv,function(e){if(e.keyCode===Keys.ESCAPE){close();
e.stopPropagation();returnFocus();}});Spotfire.Focus.setFocus(containerDiv);Spotfire.Prompt.suppressFormsAcceptCommandIfFocused(containerDiv);
}$(function(){function EditableLabel(parent,callback,showDatePicker){var getValue,toggle;var disabled=false;
var editMode=false;var alignment=parent.css("float");var width=parent.width();var height=parent.height();
parent.addClass("EditableLabel");var label=$("<div/>").addClass("sf-element-text-box ValueLabel");label.css("float",alignment);
label.css("text-align",alignment);var input=$("<input type='text'/>").addClass("Input");if(showDatePicker){var calendar=$("<div></div>").addClass("sf-element-icon");
calendar.css("float",alignment);calendar.css(alignment==="left"?"margin-right":"margin-left","2px");Spotfire.getSvg("Images/Filters/Calendar.svg",function(svg){calendar.append(svg);
});calendar.click(function(){if(disabled===false){Spotfire.Dxp.Web.Forms.AjaxService.ParseDate(getValue(),function(value){var pos=calendar.offset();
var picker=new DatePicker(value,pos.left,pos.top+calendar.height());picker.onValueChanged=function(){Spotfire.Dxp.Web.Forms.AjaxService.FormatDate(picker.getValue(),function(formattedValue){callback(formattedValue);
});};});}});parent.append(calendar);width-=calendar.outerWidth(true);}input.width(width).height(height);
label.width(width).height(height);parent.append(label);var onMouseDown=function(e){if(e.target!==input.get(0)){toggle();
}};var leaveEditMode=function(){input.detach();parent.append(label);$(document.body).unbind("mousedown",onMouseDown);
editMode=false;};toggle=function(){if(editMode){var value=input.val();if(value!==getValue()){callback(value);
}leaveEditMode();}else{label.detach();parent.append(input);input.val(label.text());$(document.body).mousedown(onMouseDown);
Spotfire.Controls.InputField.handleDraggable(input);input.focus();input.select();editMode=true;}};var onKeyDown=function(e){e.stopPropagation();
if(e.which===13){toggle();}};var setValue=function(str){label.text(str);label.attr("title",str);};getValue=function(){return label.text();
};var disable=function(){if(editMode){leaveEditMode();}label.addClass("sfpc-dimmed");input.unbind();parent.unbind();
disabled=true;};var enable=function(){disable();label.removeClass("sfpc-dimmed");parent.dblclick(toggle);
input.on("keydown",onKeyDown);disabled=false;};this.enable=enable;this.disable=disable;this.setValue=setValue;
this.getValue=getValue;}Spotfire.registerNameSpace("Filters.EditableLabel");Spotfire.Filters.EditableLabel.create=function(parent,callback,showDatePicker){return new EditableLabel(parent,callback,showDatePicker);
};});$(function(){var filterOverview=function(viewId,$parent){$("#"+viewId).remove();var filterPopoutId;
var poppedFilter;var tooltipDelay=500;var filterItemHeight=24;var overviewHeaderHeight=25;var styledScrollbar;
var filterState;var maxHeight=0;var $filterOverview=$("<div/>").attr("id",viewId).addClass("FilterOverview");
var $filterOverviewHeader=$("<div/>").addClass("FilterOverviewHeader sf-element sf-element-filter-overview-header");
var $filterOverviewLabel=$("<div/>").addClass("FilterLabels sf-element sf-element-text-box");var $resetModifiedFilters=$("<div/>").addClass("ResetFilters sfpc-first");
var $expandFilterOverview=$("<div/>").addClass("ExpandFilters sfpc-last");var $viewport=$("<div/>").addClass("Viewport sf-element sf-element-filter-overview-list");
var $scrollable=$("<div/>").addClass("Scrollable");var $filterOverviewList=$("<div/>").addClass("FilterList");
var resetFilters=function(id){var args={};if(id){args.id=id;}Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,"ResetFilter",JSON.stringify(args));
};var onClickResetFilters=function(){resetFilters();};Spotfire.Controls.PanelButton.initialize($resetModifiedFilters,Spotfire.Localization.resources.FilterOverview_ResetFilters,"Images/Panel/FilterOverview/cirklearrow.svg",onClickResetFilters);
Spotfire.Controls.PanelButton.initialize($expandFilterOverview,Spotfire.Localization.resources.FilterOverview_ExpandTooltip,"Images/Panel/FilterOverview/arrowup.svg");
$filterOverviewHeader.append($filterOverviewLabel);$filterOverviewHeader.append($resetModifiedFilters);
$filterOverviewHeader.append($expandFilterOverview);$filterOverview.append($filterOverviewHeader);$filterOverview.append($viewport);
$viewport.append($scrollable);$scrollable.append($filterOverviewList);$parent.append($filterOverview.hide());
var onMouseOverOverviewLabel=function(){var i;var text=$filterOverviewLabel.text();if(filterState.items!==undefined){for(i=0;
i<filterState.items.length;i++){text+="\r\n";text+=filterState.items[i].text;}}Spotfire.Visuals.Tooltip.show(text,tooltipDelay);
};var onMouseLeaveOverviewLabel=function(){Spotfire.Visuals.Tooltip.hide();};$filterOverviewLabel.mouseover(onMouseOverOverviewLabel);
$filterOverviewLabel.mouseleave(onMouseLeaveOverviewLabel);$filterOverviewHeader.click(function(e){if(!$(e.target).is(".ResetFilters, .ResetFiltersImage")){Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,"ToggleFiltersExpended",JSON.stringify({}));
}});var onClose=function(){$("#filterRow"+poppedFilter).removeClass("FilterRowPopped");poppedFilter=null;
};$filterOverviewList.on("click",".FilterRow",function(e){if($(e.target).closest(".FilterRowDelete").length>0){return;
}var data=$(this).data("filterData");if(data.id){Spotfire.Filters.FilterPopout.showPoppedFilter(filterPopoutId,{data:data,$element:$(this),onClose:onClose,$scrollParent:$viewport});
poppedFilter=data.id;$(this).addClass("FilterRowPopped");}});$filterOverviewList.on("click",".FilterRowDelete",function(){var data=$(this).closest(".FilterRow").data("filterData");
resetFilters(data.id);});var mouseup=function(e){$(e.data).removeClass("sfpc-active");$(document.body).off("mouseup",mouseup);
};$filterOverviewList.on("mousedown",".FilterRowDelete",function(){$(this).addClass("sfpc-active");$(document.body).on("mouseup",null,this,mouseup);
});var onMouseOverFilterRow=function(){var item=$(this).data("filterData");Spotfire.Visuals.Tooltip.show(item.text,tooltipDelay);
};var onMouseLeaveFilterRow=function(){Spotfire.Visuals.Tooltip.hide();};var appendSvgTo=function($div,path){Spotfire.getSvg(path,function($svg){$div.empty().append($svg);
});};$filterOverview.show();$viewport.show();var populateModifiedFilters=function(){var i;if(filterState.modifiedFilters>0){var viewportWidth=$parent.width();
var viewportHeight=filterState.items.length*filterItemHeight;var viewportMaxHeight=maxHeight-overviewHeaderHeight;
if(viewportHeight>viewportMaxHeight){viewportHeight=viewportMaxHeight;}$viewport.css("height",viewportHeight+"px");
$viewport.css("width",viewportWidth+"px");$scrollable.css("height",(filterState.items.length*filterItemHeight)+"px");
$filterOverview.show();var text=Spotfire.Utilities.formatString(filterState.modifiedFilters>1?Spotfire.Localization.resources.FilterOverview_FiltersChangedFormatString:Spotfire.Localization.resources.FilterOverview_1FilterChangedFormatString,filterState.modifiedFilters);
$filterOverviewLabel.text(text);$filterOverview.removeClass("Expanded");$filterOverviewHeader.removeClass("Expanded");
if(filterState.expanded){$filterOverview.addClass("Expanded");$filterOverviewHeader.addClass("Expanded");
$filterOverviewList.empty();var row,rowText,resetButton;for(i=0;i<filterState.items.length;i++){rowText=$("<div/>").addClass("sf-element sf-element-text-box").text(filterState.items[i].text);
row=$("<div/>").addClass("FilterRow sf-element sf-element-filter-overview-list-item").mouseover(onMouseOverFilterRow).mouseleave(onMouseLeaveFilterRow).append(rowText).appendTo($filterOverviewList).data("filterData",filterState.items[i]).attr("id","filterRow"+filterState.items[i].id);
if(filterState.items[i].id){resetButton=$("<div/>").addClass("FilterRowDelete sf-element sf-element-button").appendTo(row).attr("title",Spotfire.Localization.resources.FilterOverview_ResetFilter);
appendSvgTo(resetButton,"Images/Panel/FilterOverview/resetfilter.svg");}else{row.addClass("sfc-filter-overview-table-header");
}if(poppedFilter&&poppedFilter===filterState.items[i].id){row.addClass("FilterRowPopped");}}$viewport.show();
$expandFilterOverview.attr("title",Spotfire.Localization.resources.FilterOverview_CollapsedTooltip);appendSvgTo($expandFilterOverview,"Images/Panel/FilterOverview/arrowdown.svg");
}else{$viewport.hide();$expandFilterOverview.attr("title",Spotfire.Localization.resources.FilterOverview_ExpandTooltip);
appendSvgTo($expandFilterOverview,"Images/Panel/FilterOverview/arrowup.svg");}$resetModifiedFilters.attr("title",filterState.includeHidden?Spotfire.Localization.resources.FilterOverview_ResetFilters:Spotfire.Localization.resources.FilterPanelReset);
var showScrollbar=filterState.expanded&&filterState.items.length*filterItemHeight>viewportMaxHeight;if(!styledScrollbar&&showScrollbar){$viewport.css("overflow-y","auto");
styledScrollbar=$viewport.StyledScrollbar({allowResize:true,cssClass:"FilterOverviewScroll",width:10});
}if(showScrollbar){$viewport.StyledScrollbar("refresh");}else{$viewport.StyledScrollbar("close");$viewport.css("overflow-y","hidden");
styledScrollbar=null;}}else{$filterOverview.hide();}};var getStateCallback=function(data){var extendedChanged=!filterState||filterState.expanded!==data.expanded;
var itemsChanged=!filterState||filterState.items.length!==data.items.length;filterState=data;filterPopoutId=data.filterPopoutId;
if(extendedChanged||itemsChanged){$filterOverview.trigger("update");}else{populateModifiedFilters();}};
Spotfire.Dxp.Web.Forms.AjaxService.Read(viewId,"GetState","",getStateCallback);var control={update:function(){Spotfire.Dxp.Web.Forms.AjaxService.Read(viewId,"GetState","",getStateCallback);
},populateFilters:function(availableHeight){maxHeight=availableHeight;if(filterState){populateModifiedFilters();
}},getPreferredHeight:function(){if(!filterState){return 0;}var filtersHeight=filterState.expanded?filterState.items.length*filterItemHeight:0;
var controlHeight=overviewHeaderHeight+filtersHeight;var height=filterState.items.length>0?controlHeight:0;
return height;}};$filterOverview.data("control",control);return control;};Spotfire.registerNameSpace("Filters.FilterOverview");
Spotfire.Filters.FilterOverview.initialize=function(viewId,$parent){var control=filterOverview(viewId,$parent);
return control;};Spotfire.Filters.FilterOverview.update=function(viewId){var container=$("#"+viewId);
if(container.length===1&&container.data("control")){container.data("control").update();}};});$(function(){var viewId=null;
var currentInstance=null;var validateView=function(){if(viewId===null){throw"No filter panel active";
}};var modifyFilterPanel=function(method,args){validateView();Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,method,args);
};var readFilterPanel=function(method,args,callback){validateView();Spotfire.Dxp.Web.Forms.AjaxService.Read(viewId,method,args,callback);
};var showContextMenu=function(overrideViewId,point,canvas,filterId,fromFilterPanel,selectedFilterIds){var menuCallback=canvas.data("contextMenuCallback");
var filterArgs={};if(menuCallback!==undefined){filterArgs=menuCallback();}var settings={viewId:overrideViewId,left:point.x,top:point.y,filterId:filterId,filterArgs:filterArgs,selectedFilterIds:selectedFilterIds,fromFilterPanel:fromFilterPanel};
Spotfire.PageBus.publish("spotfire.visuals.filters.showcontextmenu",{settings:settings},overrideViewId);
};if(Spotfire.isWebPlayer()){Spotfire.PageBus.subscribe("spotfire.visuals.filters.showcontextmenu",function(subject,message){var data=JSON.parse(message);
var settings=data.settings;var onGetContextMenu=function(menuItems){var menu=Spotfire.Controls.ContextMenu.create(menuItems,function(menuItem){Spotfire.Dxp.Web.Forms.AjaxService.Modify(settings.viewId,"ContextMenu",JSON.stringify({id:settings.filterId,tag:menuItem.tag,filterArgs:settings.filterArgs}));
return true;});menu.show(settings.left,settings.top);};Spotfire.Dxp.Web.Forms.AjaxService.Read(settings.viewId,"GetContextMenu",JSON.stringify({id:settings.filterId,filterArgs:settings.filterArgs}),onGetContextMenu);
});}var initialize=function($parent){validateView();$("[viewId="+viewId+"]").removeAttr("viewId");$parent.attr("viewId",viewId);
$parent.empty();$parent.on("contextmenu",function(e){if($(e.target).is("input")){return;}var point={x:e.pageX,y:e.pageY};
showContextMenu(viewId,point,$parent,null,true,[]);e.preventDefault();});var update,isSelected,renderPlaceHolderItem,renderFilterGroup,performLayout,updateFilterHeights;
var $container;var $filterOverview;var invalidate=function(){if(!$.contains(document.documentElement,$container[0])){return;
}readFilterPanel("GetPanel","",update);};var invalidateFilterHeights=function(){if(!$.contains(document.documentElement,$container[0])){return;
}readFilterPanel("GetFilterHeights","",updateFilterHeights);};var performSearch=function(value){modifyFilterPanel("Search",value);
};var showAllFilters=function(){modifyFilterPanel("ShowAllFilters","");};var $header=$parent.siblings(".sf-element-panel-header");
$header.on("contextmenu",function(e){var data={ShowHeaderContextMenu:true};Spotfire.PageBus.publish("spotfire.visuals.showcontextmenu",data,viewId);
e.preventDefault();});var $buttonGroup=$header.children(".sf-element-button-group");var resetButton=$buttonGroup.find(".ResetButton")[0];
if(!resetButton){resetButton=$("<div></div>").addClass("sf-element-button ResetButton");$buttonGroup.append(resetButton);
}Spotfire.Controls.PanelButton.initialize(resetButton,Spotfire.Localization.resources.FilterPanelReset,"Images/Panel/ResetFilters.svg",function(){modifyFilterPanel("Reset","");
});var $searchField=$("<div/>").addClass("SearchField sf-element sf-element-search-field");var $searchImage=$("<div/>").addClass("FilterPanelMagnifier");
var $searchInput=$("<input type='text'/>").addClass("sf-element sf-element-input");$searchField.append($searchImage);
$searchField.append($searchInput);$parent.append($searchField);$searchField.on("mouseenter",function(){$searchImage.addClass("Hover");
});$searchField.on("mouseleave",function(){$searchImage.removeClass("Hover");});var searchInput=Spotfire.Controls.InputField.initialize($searchInput,Spotfire.Localization.resources.FilterPanelTypeToSearch,performSearch);
$container=$("<div></div>").addClass("Container");var $filterContainer=$("<div style='position: absolute; left: 0px; top: 0px; height: 0px; width: 1px'></div>");
$container.append($filterContainer);$parent.append($container);var $messageContainer=$("<div/>").addClass("sf-element-message");
var $hiddenFiltersLabel=$("<div/>").addClass("sf-element-text-box").css("display","inline-block").text(Spotfire.Localization.resources.FilterPanel_SomeFiltersAreHidden).attr("title",Spotfire.Localization.resources.FilterPanel_SomeFiltersAreHidden).appendTo($messageContainer);
var $showAllButton=$("<div/>").addClass("MessageButton sf-element-button").text(Spotfire.Localization.resources.FilterPanel_ShowAll).attr("title",Spotfire.Localization.resources.FilterPanel_ShowAll).click(showAllFilters).appendTo($messageContainer);
$parent.append($messageContainer);$searchImage.on("click",function(){searchInput.submit();});var onKeyDown=function(e){if(e.keyCode===Keys.F1){var args={ctrlKey:e.ctrlKey,shiftKey:e.shiftKey,altKey:e.altKey,keyCode:e.keyCode};
modifyFilterPanel("KeyDown",JSON.stringify(args));}};Spotfire.Focus.handleKeyDown($container,onKeyDown);
var styledScrollbar=null;var scrollTimer;var scrollTimeout=Spotfire.isProfessional()?0:250;var slack=500;
var itemThreshold=100;var labelHeight=20;var borderSize=2;var bottompadding=3;var items=[];var visible={};
var onDragOver=function(e){var distanceToContainerBottom=$container.offset().top+$container.height()-e.pageY;
var distanceToContainerTop=e.pageY-$container.offset().top;if(distanceToContainerBottom<25){$container.scrollTop($container.scrollTop()+10);
}else{if(distanceToContainerTop<25){$container.scrollTop($container.scrollTop()-10);}}};var isAuthor=Spotfire.isAuthorMode();
var selectedFilterIndices=[];if(isAuthor){Spotfire.FilterPanel.DragDrop.initialize(function(){return selectedFilterIndices;
},function(){return items;},onDragOver);Spotfire.DragDrop.initializeDroppableWebPlotWithTargetArea($header,viewId);
}var updateSelectedFilterIndication=function(){var $filters=$(".sf-element-filter",$parent);$filters.removeClass("sfpc-selected");
$filters.each(function(i,f){var $f=$(f);var index=$f.data("index");if(isSelected(index)){$f.addClass("sfpc-selected");
}});};var isSelectedId=function(id){return $("#"+id).parents(".sf-element-filter").hasClass("sfpc-selected");
};var selectFilter=function(index){selectedFilterIndices=[index];updateSelectedFilterIndication();};isSelected=function(index){var i=selectedFilterIndices.indexOf(index);
return i>=0;};var toggleSelectFilter=function(index){var i=selectedFilterIndices.indexOf(index);if(i>=0&&selectedFilterIndices.length>1){selectedFilterIndices.splice(i,1);
}else{if(selectedFilterIndices.length>0){var currentGroup=items[selectedFilterIndices[0]].tableGroupId;
var filterGroup=items[index].tableGroupId;if(currentGroup!==filterGroup){selectedFilterIndices=[];}}selectedFilterIndices.push(index);
}updateSelectedFilterIndication();};var selectFilterRange=function(index){var fromIndex=selectedFilterIndices.length>0?selectedFilterIndices[0]:0;
var group=items[fromIndex].tableGroupId;var selectedRange=[];while(fromIndex!==index&&group===items[fromIndex].tableGroupId){selectedRange.push(fromIndex);
fromIndex=fromIndex+(fromIndex<index?1:-1);}if(group===items[fromIndex].tableGroupId){selectedRange.push(fromIndex);
}selectedFilterIndices=selectedRange;updateSelectedFilterIndication();};var binarySearch=function(array,comparer,low,high){if(high<low){return -1;
}var i=low+Math.round((high-low)/2);var comparison=comparer(array[i]);if(comparison>0){return binarySearch(array,comparer,i+1,high);
}if(comparison<0){return binarySearch(array,comparer,low,i-1);}return i;};var activeTableChanged=function(dataTableGroupId,tableName){if(!$.contains(document.documentElement,$container[0])){return;
}var tableIndicators=$(".TableIndicator",$container);$.each(tableIndicators,function(i,e){var tableIndicator=$(e);
var groupInfo=tableIndicator.data("groupInfo");tableIndicator.css("background-color",groupInfo.id===dataTableGroupId?groupInfo.color:"transparent");
});var tableHeaders=$(".TableHeader",$container);$.each(tableHeaders,function(i,e){var tableHeader=$(e);
tableHeader.toggleClass("activeTable",tableHeader.data("name")===tableName);});};var refreshScrollbar=function(){if(styledScrollbar!==null&&styledScrollbar!==undefined){styledScrollbar.refresh();
}};var getScrollbarWidth=function(){return styledScrollbar!==null?styledScrollbar.getVScrollbarSize():0;
};updateFilterHeights=function(settings){var updateFilterAndGroupHeights=function($filterDiv,diff){var $placeholderContent=$(".sf-element-filter-content",$filterDiv).not(".sf-element-filter-title");
var $divs=$filterDiv.parentsUntil($filterContainer).add($filterDiv).add($placeholderContent);$.each($divs,function(){var $div=$(this);
$div.height($div.height()+diff);var divTop=$div.position().top;var $siblings=$div.siblings();$.each($siblings,function(){var $sibling=$(this);
var siblingTop=$sibling.position().top;if(siblingTop>divTop){$sibling.css("top",(siblingTop+diff)+"px");
}});if($div.hasClass("sf-element-filter-table-group")){var $tableIndicator=$(".TableIndicator",$div);
$tableIndicator.height($tableIndicator.height()+diff);}});};var $filterDivs=$(".sf-element-filter",$container);
$.each($filterDivs,function(){var $filterDiv=$(this);var oldHeight=$filterDiv.data("itemHeight");var newHeight=settings[$filterDiv.data("itemId")];
if(oldHeight!==newHeight){updateFilterAndGroupHeights($filterDiv,newHeight-oldHeight);$filterDiv.data("itemHeight",newHeight);
}});refreshScrollbar();};var populate=function(){var placeholders=$(".sf-element-filter",$container);
if(placeholders.length>itemThreshold){invalidate();return;}var containerHeight=$container.height();var scrollTop=$container.scrollTop();
var inViewport=function(toCheck){if(toCheck.offsetTop+toCheck.Height<scrollTop-slack){return 1;}if(toCheck.offsetTop>scrollTop+containerHeight+slack){return -1;
}return 0;};var startIndex=binarySearch(items,inViewport,0,items.length-1);if(startIndex<0){return;}var i;
for(i=startIndex-1;i>=0;i--){if(inViewport(items[i])===0){startIndex=i;}else{break;}}var currentItems=[];
var currentIds=[];var j,item;for(j=startIndex;j<items.length;j++){item=items[j];if(inViewport(item)===0){if(!visible[item.Id]){renderPlaceHolderItem(j);
currentItems.push(item);currentIds.push(item.Id);visible[item.Id]=true;}}else{break;}}if(currentItems.length>0){performLayout();
readFilterPanel("InitializeFilters",JSON.stringify(currentIds),function(filters){$.each(filters,function(index,filter){var $canvas=$("#"+filter.Id);
if($canvas.length===0){return false;}item=currentItems[index];if(item.Id!==filter.Id){return false;}item.Name=filter.Name;
item.FullyQualifiedName=filter.FullyQualifiedName;var $label=$canvas.siblings(".sf-element-filter-title");
$label.text(filter.Name);$label.attr("title",filter.Name);Spotfire.evaluate(filter.InitScript);return true;
});});}};performLayout=function(){var width=$parent.width();var height=$parent.height();var $currentSearchInput=$("input.sf-element.sf-element-input",$searchField);
var searchFieldWidth=$searchField.width()-($currentSearchInput.outerWidth()-$currentSearchInput.width());
$currentSearchInput.width(searchFieldWidth);var messageContainerHeight=$messageContainer.is(":visible")?$messageContainer.outerHeight():0;
$hiddenFiltersLabel.css("max-width",Math.max($messageContainer.width()-$showAllButton.width(),0)+"px");
var filterOverviewHeight=0;var avaliableContainerHeight=height-$container.position().top-messageContainerHeight;
if($filterOverview){var control=$filterOverview.data("control");control.populateFilters(avaliableContainerHeight/2);
filterOverviewHeight=control.getPreferredHeight()>0?$filterOverview.outerHeight():0;}$container.width(width);
$container.height(avaliableContainerHeight-filterOverviewHeight);var scrollbarWidth=getScrollbarWidth();
$(".FilterHeader",$container).add(".sf-element-filter",$container).each(function(){var oThis=$(this);
var paddingleft=parseInt(oThis.css("padding-left").replace("px",""),10);var w=width-oThis.position().left-paddingleft-scrollbarWidth;
oThis.width(w);$(".sf-element-filter-content",oThis).width(w-20);});$(".FilterHeader .GroupLabel",$container).each(function(){var oThis=$(this);
oThis.width(oThis.parent().innerWidth()-oThis.siblings(".ExpandCollapseIcon").outerWidth()-oThis.siblings(".RelationsIcon").outerWidth(true)-20);
});refreshScrollbar();};renderPlaceHolderItem=function(index){var item=items[index];var label=$("<span/>").addClass("sf-element-filter-content sf-element-filter-title").text("...");
if(isAuthor){label.addClass("sfpc-draggable");}var canvas=$("<span/>").addClass("sf-element-filter-content");
var showContextMenuForSelectedFilters=function(point){var selectedFilterIds=[];$.each(selectedFilterIndices,function(i,itemIndex){selectedFilterIds.push(items[itemIndex].Id);
});showContextMenu(viewId,point,canvas,item.Id,true,selectedFilterIds);};var $div=$("<div/>").addClass("sf-element sf-element-filter");
if(isSelected(index)){$div.addClass("sfpc-selected");}$div.on("mousedown",function(event){var width=$parent.width();
var height=$parent.height();var scrollbarWidth=$container.get(0).scrollHeight>height?Spotfire.Touch.getScrollbarWidth():0;
var adjust=function(){var $this=$(this);var w=width-$this.position().left-scrollbarWidth;$(".sf-element-filter-content.sf-element-filter-title",$this).width(w-12-($this.is(".sfpc-active")?16:0));
};$(".sfpc-active",$parent).removeClass("sfpc-active").add($div.addClass("sfpc-active")).each(adjust);
if(event.which===1){if(event.ctrlKey){toggleSelectFilter(index);}else{if(event.shiftKey){selectFilterRange(index);
}else{if(!isSelected(index)){selectFilter(index);}}}}else{if(!isSelected(index)){selectFilter(index);
}}});$div.on("mouseup",function(event){if(event.which===1){if(!event.ctrlKey&&!event.shiftKey&&isSelected(index)){selectFilter(index);
}}});$div.on("contextmenu",function(e){if($(e.target).is("input")){return;}e.stopPropagation();e.preventDefault();
var point={x:e.pageX,y:e.pageY};showContextMenuForSelectedFilters(point);});if(isAuthor){Spotfire.FilterPanel.DragDrop.makeDraggableFilter($div);
Spotfire.FilterPanel.DragDrop.makeDroppableFilter($div,item);}$div.data("itemId",item.Id);$div.data("itemHeight",item.Height);
$div.data("index",index);$div.css({top:item.top+"px",left:item.left+"px","padding-left":item.padding+"px",height:(item.Height+labelHeight+bottompadding-borderSize)+"px"});
canvas.attr("id",item.Id);canvas.height(item.Height);var button=$("<div/>").addClass("ContextButton").attr("title",Spotfire.Localization.resources.FilterPanel_ContextMenuTooltip);
button.click(function(){var point={x:button.offset().left,y:button.offset().top+15};showContextMenuForSelectedFilters(point);
});$div.append(label);$div.append(button);$div.append(canvas);item.container.append($div);};var renderFilterHeader=function(item,$parentContainer,left,top,isTable){var $div=$("<div />").addClass(isTable?"TableHeader":"GroupHeader").addClass(isTable?"sf-element-filter-table-group-title":"sf-element-filter-group-title").addClass("FilterHeader");
var svgPath;if(isTable){svgPath=item.Expanded?"Images/Filters/FilterTableGroupCollapse.svg":"Images/Filters/FilterTableGroupExpand.svg";
}else{svgPath=item.Expanded?"Images/Filters/FilterGroupCollapse.svg":"Images/Filters/FilterGroupExpand.svg";
}$div.css({top:top+"px",left:left+"px"});var image=$("<div/>").addClass("ExpandCollapseIcon sf-element-icon");
Spotfire.getSvg(svgPath,function($svg){image.append($svg);});image.attr("id",item.Id);var $relationsIcon;
if(item.RelationsIcon&&!Spotfire.isWebPlayer()){var icon=item.RelationsIcon;$relationsIcon=$("<div/>").addClass("RelationsIcon").attr("title",icon.Tooltip);
if(icon.Invalid){$relationsIcon.addClass("Invalid");}$relationsIcon.click(function(event){event.stopPropagation();
Spotfire.PageBus.publish("spotfire.visuals.filters.showrelationsmenu",{HeaderItemId:item.Id},viewId);
});}$div.click(function(){modifyFilterPanel("ToggleGroup",item.Id);});Spotfire.Controls.ContextMenu.bindRightClick($div,viewId,{HeaderItemId:item.Id});
var label=$("<span></span>").addClass("GroupLabel");label.attr("title",item.Name);label.text(item.Name);
$div.append(image);if($relationsIcon){$div.append($relationsIcon);}$div.append(label);if(isTable){if(item.ActiveTable){$div.addClass("activeTable");
}$div.data("name",item.Name);}else{if(isAuthor){Spotfire.FilterPanel.DragDrop.makeDraggableFilterGroup($div,item);
Spotfire.FilterPanel.DragDrop.makeDroppableFilterGroup($div,item);}}$parentContainer.append($div);return top+$div.outerHeight()+1;
};var renderTableGroup=function(group,$parentContainer,left,offsetTop,displayFilterHeader){var titleHeight=0;
var padding=0;if(displayFilterHeader){titleHeight=renderFilterHeader(group,$parentContainer,left,0,true);
offsetTop+=titleHeight;}var $groupContent=$("<div style='position: absolute; left: 0px; top: 0px; height: 0px; width: 1px'></div>").addClass("sf-element-filter-table-group-content");
$parentContainer.append($groupContent);var contentTop=titleHeight;var top=0,i,item,delta;var $filterGroupContainer,filterGroupHeight;
for(i=0;i<group.Items.length;i++){item=group.Items[i];item.tableGroupId=group.Id;if(item.Items){$filterGroupContainer=$("<div style='position: absolute; left: 0px; top: 0px; height: 0px; width: 1px'></div>").addClass("sf-element-filter-group");
$groupContent.append($filterGroupContainer);filterGroupHeight=renderFilterGroup(item,$filterGroupContainer,left,offsetTop);
$filterGroupContainer.css({top:top+"px",height:filterGroupHeight+"px"});top+=filterGroupHeight;offsetTop+=filterGroupHeight;
}else{item.offsetTop=offsetTop;item.top=top;item.left=left;item.padding=padding;item.container=$groupContent;
item.inFilterGroup=false;items.push(item);delta=item.Height+labelHeight+bottompadding;top+=delta;offsetTop+=delta;
}}var contentHeight=top;$groupContent.css({top:contentTop+"px",height:contentHeight+"px"});return contentHeight+titleHeight;
};renderFilterGroup=function(group,$parentContainer,left,offsetTop){var top=0;var padding=12;top=renderFilterHeader(group,$parentContainer,left,top,false);
var $groupContent=$("<div style='position: absolute; left: 0px; top: 0px; height: 0px; width: 1px'></div>").addClass("sf-element-filter-group-content");
$parentContainer.append($groupContent);var i,item,delta;for(i=0;i<group.Items.length;i++){item=group.Items[i];
item.offsetTop=offsetTop;item.top=top;item.left=left;item.padding=padding;item.tableGroupId=group.tableGroupId;
item.inFilterGroup=true;item.container=$groupContent;items.push(item);delta=item.Height+labelHeight+bottompadding;
top+=delta;offsetTop+=delta;}$groupContent.css({top:"0",height:top+"px"});return top;};var scrollCallback=function(){window.clearTimeout(scrollTimer);
scrollTimer=window.setTimeout(populate,scrollTimeout);};var updateFilteringSchemeSelector=function(settings){if(!Spotfire.isProfessional()){return;
}$(".sf-element-filtering-scheme-select",$parent).remove();var filteringScheme=settings.FilteringScheme;
if(filteringScheme===undefined||filteringScheme===null){return;}var $schemeSelect=$("<div/>").addClass("sf-element sf-element-filtering-scheme-select").prependTo($parent);
var $textbox=$("<div/>").addClass("sf-element sf-element-text-box sf-nowrap").text("a");$schemeSelect.append($textbox);
var $button=$("<div/>").addClass("sf-element sf-element-button sf-nowrap");$schemeSelect.append($button);
var h=$textbox.sfBoxHeight();$button.sfBoxHeight(h);$button.width($button.height());var maxWidth=Math.max(0,$schemeSelect.width()-$button.sfBoxWidth());
$textbox.css("max-width",maxWidth+"px");$textbox.text(filteringScheme);var onClick=function(){var offset=$(this).offset();
var data={x:Math.round(offset.left),y:Math.round(offset.top)+$(this).height()};Spotfire.PageBus.publish("spotfire.visuals.filters.showschemeselector",data,viewId);
};Spotfire.Controls.PanelButton.initialize($button,null,"Images/Filters/DownArrow.svg",onClick);};update=function(settings){searchInput.update(settings.SearchPattern);
updateFilteringSchemeSelector(settings);var previousScrollTop=$container.scrollTop();var oldSelectedFilters={};
$.each(selectedFilterIndices,function(arrayIndex,itemIndex){oldSelectedFilters[items[itemIndex].Id]=true;
});if(settings.filterOverviewId&&!$filterOverview){Spotfire.Filters.FilterOverview.initialize(settings.filterOverviewId,$parent);
$parent.off("update.filterOverview").on("update.filterOverview",function(){var oldScrollbarWidth=getScrollbarWidth();
performLayout();var newScrollbarWidth=getScrollbarWidth();if(oldScrollbarWidth!==newScrollbarWidth){invalidate();
return;}populate();});$filterOverview=$("#"+settings.filterOverviewId,$parent);}visible={};items=[];$searchImage.empty().attr("style","");
$container.empty();$filterContainer.empty();$container.append($filterContainer);selectedFilterIndices=[];
$parent.addClass("sf-element sf-element-panel-content sfc-filter-panel");var groupContainerTop=0,i,group,$groupContainer,height,tableIndicator;
for(i=0;i<settings.Tables.length;i++){group=settings.Tables[i];$groupContainer=$("<div style='position: absolute; left: 0px; top: 0px; height: 0px; width: 1px'></div>").addClass("sf-element-filter-table-group");
$filterContainer.append($groupContainer);height=renderTableGroup(group,$groupContainer,group.ShowColor?4:0,groupContainerTop,group.ShowHeader);
if(group.ShowColor){tableIndicator=$("<div></div>").addClass("TableIndicator").data("groupInfo",{color:group.Color,id:group.DataTableGroupId});
tableIndicator.css({top:"0",height:height+"px","background-color":group.ActiveTableGroup?group.Color:"transparent"});
$groupContainer.append(tableIndicator);}$groupContainer.css({top:groupContainerTop+"px",height:height+"px"});
groupContainerTop+=height;}$container.scrollTop(previousScrollTop);$messageContainer.hide();if(settings.showAllFiltersMessage){$messageContainer.show();
$messageContainer.height($hiddenFiltersLabel.outerHeight());}if(!Spotfire.Filters.StyledFilters.createMagnifierGlass($searchImage)){$searchImage.addClass("Fallback");
}if(styledScrollbar===null){styledScrollbar=$container.StyledScrollbar({cssClass:"FilterPanelScroll"});
}$.each(items,function(itemIndex,item){if(oldSelectedFilters[item.Id]){selectedFilterIndices.push(itemIndex);
}});performLayout();populate();if(Spotfire.capabilities.supportsTouch()){$filterContainer.css("height",groupContainerTop+"px");
var scroll=new IScroll($filterContainer.get(0),null,{bounce:false,hScrollbarEnabled:false});$container.scrollTop=function(){return scroll.scrollTop();
};scroll.onScroll=scrollCallback;}else{$container.scroll(scrollCallback);}};$parent.bind("panelResize",invalidate);
performLayout();return{invalidate:invalidate,invalidateFilterHeights:invalidateFilterHeights,isSelected:isSelectedId,activeTableChanged:activeTableChanged};
};Spotfire.registerNameSpace("FilterPanel",{setView:function(filterPanelViewId){viewId=filterPanelViewId;
},initialize:function($parent){currentInstance=initialize($parent);},handleDrop:function(args){modifyFilterPanel("HandleDrop",JSON.stringify(args));
},forceUpdate:function(id){modifyFilterPanel("ForceUpdate",id);},showContextMenu:function(overrideViewId,point,canvas,id){showContextMenu(overrideViewId,point,canvas,id,false);
},isSelected:function(id){if(currentInstance!==null){return currentInstance.isSelected(id);}return false;
},activeTableChanged:function(dataTablegroupid,tableName){if(currentInstance!==null){currentInstance.activeTableChanged(dataTablegroupid,tableName);
}},invalidateFilterHeights:function(){if(currentInstance!==null){currentInstance.invalidateFilterHeights();
}},invalidate:function(){if(currentInstance!==null){currentInstance.invalidate();}}});});$(function(){Spotfire.registerNameSpace("FilterPanel.DragDrop");
var dragDropSettings,dragDropCss;var getSelectedFilterIndices=$.noop;var getFilterItems=$.noop;var onDragOverCallback=$.noop;
var getDraggedFilters=function(){var filterItems=getFilterItems();return $.map(getSelectedFilterIndices(),function(index){return filterItems[index];
});};var $overlay=$("<div/>").addClass("DropOverlay");var $indicator=$("<div/>").addClass("DropIndicator");
var cleanUp=function(){$overlay.off().hide();$indicator.off().delay(50).hide(0);};var makeDroppable=function($div,item){var dragOverGeneric=function(settings){cleanUp();
$overlay.insertAfter($div).css(dragDropCss.overlay($div)).show();$overlay.on("mouseover",cleanUp);if(settings.isDropAllowed()){Spotfire.DragDrop.makeDroppable($overlay,{onDragOver:function(e){onDragOverCallback(e);
settings.onDragOver(e);},onDrop:function(){cleanUp();settings.onDrop();},onDragLeave:cleanUp});}else{Spotfire.DragDrop.makeDroppable($overlay,{onDragOver:function(e){onDragOverCallback(e);
e.originalEvent.dataTransfer.dropEffect="none";},onDrop:cleanUp,onDragLeave:cleanUp});}};Spotfire.DragDrop.makeDroppable($div,{onDragOver:function(e,data){var settings=dragDropSettings(data,$div,item);
dragOverGeneric(settings);}});};dragDropCss={overlay:function($div){var slightlyBiggerOverlay=2;return{height:$div.outerHeight()+2*slightlyBiggerOverlay,width:$div.outerWidth(),left:$div.position().left,top:$div.position().top-slightlyBiggerOverlay};
},indicatorAbove:function($div){return{top:$div.position().top,width:$div.width(),left:0,height:0};},indicatorOnTo:function($div){return{height:$div.height(),width:$div.width(),left:$div.position().left,top:$div.position().top};
},indicatorBelow:function($div){return{top:$div.position().top+$div.outerHeight(),width:$div.width(),left:0,height:0};
}};dragDropSettings=function(data,$div,targetItem){var currentPageY=null;var destination=function(pageY,above,onto,below){var yFraction=(pageY-$div.offset().top)/$div.height();
var dest=(yFraction<0.5)?above:below;if(targetItem.isFilterGroup()&&data.columnNames){dest=(yFraction>0.33&&yFraction<0.66)?onto:dest;
}return dest;};var onDragOver=function(e){if($div.next()!==$indicator){$indicator.insertAfter($div);}var cssFunc=destination(e.pageY,dragDropCss.indicatorAbove,dragDropCss.indicatorOnTo,dragDropCss.indicatorBelow);
currentPageY=e.pageY;var css=cssFunc($div);$indicator.css(css).stop().show();};var isDropAllowed=function(){if(!data||(!data.columnNames&&!data.groupName)){return false;
}var isAllowed=targetItem.tableGroupId()===data.tableGroupId;if(data.groupName){isAllowed&=!targetItem.inFilterGroup();
isAllowed&=(data.groupName!==targetItem.name());}else{if(data.columnNames){$.map(data.columnNames,function(columnName){isAllowed&=columnName!==targetItem.name();
});}else{isAllowed=false;}}return isAllowed;};var onDrop=function(){var args={targetName:targetItem.name(),destination:destination(currentPageY,"above","onto","below"),columnNames:data.columnNames,groupName:data.groupName};
Spotfire.FilterPanel.handleDrop(args);};return{onDragOver:onDragOver,isDropAllowed:isDropAllowed,onDrop:onDrop};
};var itemWrapper=function(item,isGroup){var guard=function(value){if(value===undefined){Spotfire.log("Guard failed!");
}return value;};var isFilterGroup=function(){return guard(isGroup);};var inFilterGroup=function(){return guard(isFilterGroup()?false:item.inFilterGroup);
};var name=function(){return guard(isFilterGroup()?item.Name:item.FullyQualifiedName);};var tableGroupId=function(){return guard(item.tableGroupId);
};return{isFilterGroup:isFilterGroup,inFilterGroup:inFilterGroup,name:name,tableGroupId:tableGroupId};
};Spotfire.FilterPanel.DragDrop.makeDroppableFilter=function($div,filterItem){makeDroppable($div,itemWrapper(filterItem,false));
};Spotfire.FilterPanel.DragDrop.makeDroppableFilterGroup=function($div,groupItem){makeDroppable($div,itemWrapper(groupItem,true));
};Spotfire.FilterPanel.DragDrop.makeDraggableFilter=function($div){var getFullyQualifiedName=function(filterItem){return filterItem.FullyQualifiedName;
};Spotfire.DragDrop.makeDraggable($div,{effectAllowed:"copyMove",abortOnModifierKeys:true,populateData:function(data){var filters=getDraggedFilters();
data.columnNames=$.map(filters,getFullyQualifiedName);data.tableGroupId=filters[0].tableGroupId;return data.columnNames.length;
},dragInProgressClass:"sfpc-highlight-axis-trays",dragEnd:cleanUp});};Spotfire.FilterPanel.DragDrop.makeDraggableFilterGroup=function($div,group){Spotfire.DragDrop.makeDraggable($div,{effectAllowed:"move",populateData:function(data){data.tableGroupId=group.tableGroupId;
data.groupName=group.Name;},dragEnd:cleanUp});};Spotfire.FilterPanel.DragDrop.initialize=function(getSelectedFilterIndicesFunc,getFilterItemsFunc,onDragOver){getSelectedFilterIndices=getSelectedFilterIndicesFunc;
getFilterItems=getFilterItemsFunc;onDragOverCallback=onDragOver;};});$(function(){var DIRECTION={up:0,left:1,right:2,down:3};
var createSvgPopoutArrow=function(parent,color,borderColor,direction){var path="M 10,0 L0,10 L10,20";
var width=10;var height=20;if(direction===DIRECTION.right){path="M 0,0 L10,10 L0,20";}else{if(direction===DIRECTION.up){path="M 0,10 L10,0 L20,10";
width=20;height=10;}else{if(direction===DIRECTION.down){path="M 0,0 L10,10 L20,0";width=20;height=10;
}}}return Spotfire.Filters.StyledFilters.createStyledElement({parent:parent,borderwidth:0,width:width,height:height,elements:[{type:"path",path:path+" z",fill:color},{type:"path",path:path,fill:"none",brushwidth:"1",brushcolor:borderColor}]});
};var updateFilterHeight;var defaultSettings={data:{},$element:null,$scrollParent:null,onClose:null,oldData:{}};
var showPoppedFilter=function(viewId,newSettings){var settings=$.extend({},defaultSettings,newSettings);
var data=settings.data;var $element=settings.$element;var $scrollParent=settings.$scrollParent;var onClose=settings.onClose;
var oldData=settings.oldData;$(document).triggerHandler("sf-onShowPoppedFilter");var closed=false;var containerId="poppedFilter"+new Date().getTime();
var $parent=$(".sf-element-document");var $pfWrapper=$("<div/>").addClass("PoppedFilterWrapper");$pfWrapper.appendTo($parent);
var $pfContainer=$("<div/>").addClass("PoppedFilter sf-element sf-element-filter-popout").appendTo($pfWrapper);
var $pfContent=$("<div />").addClass("PoppedFilterContent").appendTo($pfContainer);if(Spotfire.isWebPlayer()){$pfContainer.addClass("withBoxShadows");
}if(Spotfire.capabilities.supportsTouch()){$pfContent.css("width","200px");}var $pfScrollContainer=$("<div/>").addClass("PoppedScrollContainer sf-element sf-element-filter").appendTo($pfContent);
var $poppedFilter=$("<div/>").attr("viewId",viewId).addClass("FilterContainer sf-element sf-element-filter-content");
var height=34;var showButton=data.id===undefined;if(!showButton){var $textDiv=$("<div/>").addClass("sf-element sf-element-filter-title");
$pfScrollContainer.append($textDiv);$textDiv.attr("title",data.name);$textDiv.text(data.name);$pfScrollContainer.on("contextmenu",function(e){e.preventDefault();
var point={x:e.pageX,y:e.pageY};Spotfire.FilterPanel.showContextMenu(viewId,point,$poppedFilter,data.baseid);
});$poppedFilter.appendTo($pfScrollContainer).attr("id",containerId).css({height:height+"px"});}else{$pfScrollContainer.remove();
$("<button/>").addClass("PoppedFilterCreateFilterButton sfc-create-filter-button sf-element sf-element-button").text(Spotfire.Localization.resources.PoppedFilter_CreateFilter).attr("id",containerId).appendTo($pfContent).height(height).sfBoxWidth($pfContent.sfBoxWidth()).click(function(){Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,"CreateFilter",JSON.stringify({id:data.columnId,filterContainerId:containerId}));
});}var $arrow=$("<div/>").addClass("filter-overview-arrow");$parent.append($arrow);var offset;var elemWidth,elemHeight;
var arrowWidth=$arrow.width();var arrowHeight=$arrow.height();var arrowDirection;if($element){offset=$element.offset();
var parentOffset=$parent.offset();offset.top-=parentOffset.top;offset.left-=parentOffset.left;elemWidth=$element.outerWidth();
elemHeight=$element.outerHeight();}else{if(oldData){offset=oldData.offset;elemWidth=oldData.elemWidth;
elemHeight=oldData.elemHeight;}}var scrollBar;var fpPos;var time;var positionPopout=function(resetAnimation,newHeight,keepTopPosition){var scrollTop=0;
if(newHeight!==undefined){if(scrollBar){scrollTop=scrollBar.scrollTop();}height=newHeight;$arrow.removeClass().empty();
$poppedFilter.height(height);$poppedFilter.css("overflow","hidden");}$pfContainer.css("max-width","200px");
$pfScrollContainer.css("height","auto");if(scrollBar){scrollBar.refresh();}$pfContainer.css("max-height",$pfContent.sfBoxHeight());
var winWidth=$parent.width();var winHeight=$parent.height();var wrapperHeight=$pfContent.height();var wrapperWidth=$pfContent.width();
var margin=2;var toWide=!keepTopPosition&&wrapperWidth+2*margin>=winWidth,toHigh=wrapperHeight+margin+(keepTopPosition?fpPos.top:margin)>=winHeight;
var tryBelow=false,hideArrow=false;if(toWide&&toHigh){hideArrow=true;}else{if(toWide){tryBelow=true;}}if(toWide){wrapperWidth=winWidth-margin*2;
}if(toHigh){wrapperHeight=winHeight-margin-(keepTopPosition?fpPos.top:margin);}if(keepTopPosition){$pfWrapper.css("max-height","");
}else{arrowDirection=DIRECTION.left;fpPos={top:offset.top-(height/2),left:(offset.left+elemWidth+arrowWidth-2)};
if(!hideArrow&&!tryBelow){if(fpPos.top<=margin){fpPos.top=margin;}else{if(fpPos.top+wrapperHeight+margin>=winHeight){fpPos.top=winHeight-wrapperHeight-margin;
}}if(fpPos.left+wrapperWidth+margin>=winWidth){fpPos.left=offset.left-wrapperWidth-arrowWidth+2;arrowDirection=DIRECTION.right;
if(fpPos.left-margin<0){tryBelow=true;}}}if(tryBelow){arrowDirection=DIRECTION.up;fpPos={top:offset.top+elemHeight+arrowWidth-2,left:offset.left+(elemWidth/2)-(wrapperWidth/2)};
if(fpPos.left<=margin){fpPos.left=margin;}if(fpPos.left+wrapperWidth+margin>=winWidth){fpPos.left=winWidth-wrapperWidth-margin;
}if(fpPos.top+wrapperHeight+margin>=winHeight){arrowDirection=DIRECTION.down;fpPos.top=offset.top-arrowWidth+2-wrapperHeight;
if(fpPos.top<=margin){fpPos.top=margin;if(fpPos.top+wrapperHeight+arrowWidth-2>=offset.top+elemHeight){hideArrow=true;
}}}}var startX=arrowDirection===DIRECTION.left?fpPos.left-arrowWidth:fpPos.left+$pfContent.width()+arrowWidth;
var stopX=arrowDirection===DIRECTION.left?fpPos.left:fpPos.left+2;var startY=fpPos.top+(wrapperHeight*0.5);
var stopY=fpPos.top;var animationDuration=400;if(resetAnimation){time=new Date().getTime();$pfWrapper.css({top:startY+"px",left:startX+"px","max-height":"0","max-width":"0"});
}else{animationDuration=Math.max(200,Math.min(400,400-(new Date().getTime()-time)));}d3.select($pfWrapper.get(0)).transition().duration(animationDuration).style({top:stopY+"px",left:stopX+"px","max-height":$pfContent.sfBoxHeight()+2+"px","max-width":"200px"});
if(resetAnimation){$arrow.css({"max-height":"0","max-width":"0"});}d3.select($arrow.get(0)).transition().duration(animationDuration).style({"max-height":arrowHeight+"px","max-width":arrowWidth+"px"});
}if(toHigh||toWide){$pfContainer.height(wrapperHeight);$pfContainer.width(wrapperWidth);if(!showButton){$pfScrollContainer.sfBoxHeight(wrapperHeight);
}}if(!hideArrow){var arrowPos={};if(arrowDirection===DIRECTION.right){arrowPos.left=fpPos.left+wrapperWidth+1;
arrowPos.top=Math.min(Math.max(fpPos.top,offset.top+(elemHeight/2)-(arrowHeight/2)),fpPos.top+wrapperHeight-arrowHeight);
}else{if(arrowDirection===DIRECTION.up){arrowPos.left=Math.min(Math.max(fpPos.left,offset.left+(elemWidth/2)-(arrowHeight/2)),fpPos.left+wrapperWidth-arrowHeight);
arrowPos.top=fpPos.top-arrowWidth+1;}else{if(arrowDirection===DIRECTION.down){arrowPos.left=Math.min(Math.max(fpPos.left,offset.left+(elemWidth/2)-(arrowHeight/2)),fpPos.left+wrapperWidth-arrowHeight);
arrowPos.top=fpPos.top+wrapperHeight+1;}else{arrowPos.left=fpPos.left-arrowWidth+1;arrowPos.top=Math.min(Math.max(fpPos.top,offset.top+(elemHeight/2)-(arrowHeight/2)),fpPos.top+wrapperHeight-arrowHeight);
}}}$arrow.css({top:arrowPos.top+"px",left:arrowPos.left+"px"});if(arrowDirection===DIRECTION.up||arrowDirection===DIRECTION.down){$arrow.addClass("filter-overview-arrow-vertical");
}createSvgPopoutArrow($arrow,$pfContainer.css("background-color"),$pfContainer.css("border-right-color"),arrowDirection);
}if(newHeight!==undefined){if(scrollBar){scrollBar.scrollTop(scrollTop);scrollBar.refresh();}else{scrollBar=$pfScrollContainer.StyledScrollbar({allowResize:true,cssClass:"PoppedFilterScrollbars"});
}}};positionPopout(true);var $progressIndicator;var progressTimer;var showProgress=function(){if(!$progressIndicator&&!progressTimer){progressTimer=setTimeout(function(){$progressIndicator=$(Spotfire.Progress.createProgressAnimation($pfScrollContainer.innerWidth(),$pfScrollContainer.innerHeight()));
$pfScrollContainer.append($progressIndicator);progressTimer=null;},1000);}};var hideProgress=function(){if(progressTimer){clearTimeout(progressTimer);
progressTimer=null;}if($progressIndicator){$progressIndicator.remove();$progressIndicator=null;}};var closePopout=function(){closed=true;
hideProgress();updateFilterHeight=null;if(!showButton){Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,"CloseFilter",JSON.stringify({filterContainerId:containerId}));
}if(onClose){onClose();}$pfWrapper.remove();$arrow.remove();$(document.body).off("sf-touchmousedown.poppedFilter");
$(document).off("keydown.poppedFilter");if($scrollParent){$scrollParent.off("scroll.filterPopout");}Spotfire.MultipleViews.OffRemoteFocus(closePopout);
};Spotfire.MultipleViews.OnRemoteFocus(closePopout);$(document.body).on("sf-touchmousedown.poppedFilter",function(e){if($(e.target).parents(".PoppedFilter, .contextMenu, .DatePicker").length>0){return;
}closePopout();});if($scrollParent){$scrollParent.off("scroll.filterPopout").on("scroll.filterPopout",function(){closePopout();
$scrollParent.off("scroll.filterPopout");});}if(Spotfire.isProfessional()){$(document).on("keydown.poppedFilter",function(e){if(e.which===Keys.ESCAPE){closePopout();
}});}$pfContainer.data("PoppedFilterData",{data:{offset:offset,elemWidth:elemWidth,elemHeight:elemHeight},onClose:onClose,$scrollParent:$scrollParent});
updateFilterHeight=function(){Spotfire.Dxp.Web.Forms.AjaxService.Read(viewId,"ReadFilter",JSON.stringify({id:data.id,filterContainerId:containerId}),function(filterData){if(!closed){positionPopout(false,filterData.height,true);
}});};if(!showButton){showProgress();Spotfire.Dxp.Web.Forms.AjaxService.Read(viewId,"ReadFilter",JSON.stringify({id:data.id,filterContainerId:containerId}),function(filterData){if(!closed){hideProgress();
positionPopout(false,filterData.height);Spotfire.evaluate(filterData.script);}});}};Spotfire.registerNameSpace("Filters.FilterPopout");
Spotfire.Filters.FilterPopout.showPoppedFilter=function(viewId,settings){showPoppedFilter(viewId,settings);
};Spotfire.Filters.FilterPopout.updatePoppedFilter=function(containerId,viewId,data){var oldContainer=$("#"+containerId).closest(".PoppedFilter");
if(oldContainer.length>0){var oldSettings=oldContainer.data("PoppedFilterData");oldContainer.parent().remove();
$(".filter-overview-arrow").remove();$(document.body).off("sf-touchmousedown.poppedFilter");$(document).off("keydown.poppedFilter");
showPoppedFilter(viewId,{data:data,onClose:oldSettings.onClose,oldData:oldSettings.data,$scrollParent:oldSettings.$scrollParent});
}};Spotfire.Filters.FilterPopout.updatePoppedFilterHeight=function(){if(typeof updateFilterHeight==="function"){updateFilterHeight();
}};Spotfire.Filters.FilterPopout.closePoppedFilter=function(containerId){var oldContainer=$("#"+containerId).closest(".PoppedFilter");
if(oldContainer.length>0){oldContainer.parent().remove();$(".filter-overview-arrow").remove();$(document.body).off("sf-touchmousedown.poppedFilter");
$(document).off("keydown.poppedFilter");}};});$(function(){function ItemSlider(id){var DRAGSTATE_NONE=0;
var DRAGSTATE_BEGIN=1;var DRAGSTATE_CONTINUE=2;var dragState=DRAGSTATE_NONE;var stickyGuid;var $parent=$("#"+id).empty();
var $itemSlider=$("<div></div>").addClass("ItemSlider sf-element sf-element-item-slider");var $valueLabel=$("<div></div>").addClass("ValueLabel");
var $container=$("<div></div>").addClass("SliderContainer").attr("draggable",false);var $outerRange=$("<div></div>").addClass("Background sf-element sf-element-range sfc-outer");
var $innerRange=$("<div></div>").addClass("Line sf-element sf-element-range sfc-inner");var $leftButton=$("<div></div>").addClass("Button sf-element sf-element-button");
var $rightButton=$("<div></div>").addClass("Button sf-element sf-element-button");var $thumb=$("<div></div>").addClass("Thumb sf-element sf-element-thumb").html("&nbsp;");
$container.append($outerRange);$container.append($leftButton);$container.append($rightButton);$outerRange.append($innerRange);
$container.append($thumb);$itemSlider.append($valueLabel);$itemSlider.append($container);$parent.append($itemSlider);
Spotfire.getSvg("Images/Filters/LeftArrow.svg",function(svg){$leftButton.append(svg);});Spotfire.getSvg("Images/Filters/RightArrow.svg",function(svg){$rightButton.append(svg);
});$thumb.css("margin-left",$leftButton.outerWidth()+"px");$innerRange.css("left",$leftButton.outerWidth(true)+"px");
var initialized=false;var currentGeneration=0;var clientX=0;var thumbX=0;var selectedIndex=-1;var items=[];
var ticks=null;var buttonWidth=$leftButton.outerWidth(true);var thumbWidth=$thumb.outerWidth();$valueLabel.width($parent.width());
$outerRange.width($parent.width());var modify=function(method,value,guid){var args={method:method,value:value};
Spotfire.WebView.modifyControl(id,JSON.stringify(args),++currentGeneration,guid);};modify=_.throttle(modify,200,false);
var labelControl=Spotfire.Filters.EditableLabel.create($valueLabel,function(str){modify("SetFormattedValue",str);
},false);var innerWidth=$outerRange.width()-buttonWidth*2;$innerRange.width(innerWidth);var computeTicks=function(){$(".Tick",$innerRange).remove();
ticks=[];var dx=(innerWidth-thumbWidth)/Math.max(items.length-1,1);var drawTickMarks=dx>3;var thumbOffset=Math.round(thumbWidth/2);
var i,x,tick;for(i=items.length-1;i>=0;i--){ticks[i]=Math.round(i*dx);if(drawTickMarks){x=ticks[i]+thumbOffset;
tick=$("<span />").addClass("Tick sf-element sf-element-range sfc-inner-dimmed").css({width:dx+"px",left:x}).html("&nbsp;");
$innerRange.prepend(tick);}}};var getSnapIndex=function(x){var snapIndex=0,i;for(i=0;i<ticks.length;i++){if(Math.abs(ticks[i]-x)<Math.abs(ticks[snapIndex]-x)){snapIndex=i;
}}return snapIndex;};var moveThumb=function(){var snapIndex=getSnapIndex(thumbX);if(snapIndex>=0&&snapIndex<items.length){labelControl.setValue(items[snapIndex].s);
}$thumb.css("left",thumbX+"px");};var snapThumb=function(disableEvent){if(selectedIndex>=0&&selectedIndex<ticks.length){thumbX=ticks[selectedIndex];
}else{thumbX=ticks[ticks.length-1];}$leftButton.unbind();$rightButton.unbind();if(selectedIndex>0||selectedIndex===-1){$leftButton.click(function(){modify("Step",false);
});$leftButton.removeClass("LeftDisabled");$leftButton.addClass("LeftEnabled");}else{$leftButton.removeClass("LeftEnabled");
$leftButton.addClass("LeftDisabled");}if(selectedIndex>=0&&selectedIndex<items.length-1){$rightButton.click(function(){modify("Step",true);
});$rightButton.removeClass("RightDisabled");$rightButton.addClass("RightEnabled");}else{$rightButton.removeClass("RightEnabled");
$rightButton.addClass("RightDisabled");}moveThumb();if(!disableEvent){modify("SetSliderIndex",items[selectedIndex].i);
}};var onMouseMove=function(e){var dx=e.clientX-clientX;clientX=e.clientX;thumbX=Math.max(0,Math.min(innerWidth-thumbWidth,thumbX+dx));
moveThumb(getSnapIndex(thumbX));if(!Spotfire.isWebPlayer()){selectedIndex=getSnapIndex(thumbX);if(dragState===DRAGSTATE_BEGIN){stickyGuid=Spotfire.newFakeGuid();
}modify("SetSliderIndex",items[selectedIndex].i,stickyGuid);dragState=DRAGSTATE_CONTINUE;}};var onClick=function(e){if(e.target===$thumb.get(0)){return;
}var x=e.clientX-$innerRange.offset().left;selectedIndex=getSnapIndex(x);snapThumb();};var onMouseUp=function(){dragState=DRAGSTATE_NONE;
selectedIndex=getSnapIndex(thumbX);snapThumb();};var onMouseDown=function(e){clientX=e.clientX;dragState=DRAGSTATE_BEGIN;
};var updateItems=function(settings){if(settings!==undefined&&settings!==null){if(!initialized){Spotfire.Touch.registerTouchEvents($thumb,onMouseDown,onMouseMove,onMouseUp);
$innerRange.click(onClick);initialized=true;}items=settings.Items;selectedIndex=settings.SelectedIndex;
}computeTicks();snapThumb(true);if(selectedIndex>-1){labelControl.enable();}else{labelControl.disable();
}};var update=function(settings){if(settings.Generation<currentGeneration){return;}if(dragState!==DRAGSTATE_NONE){return;
}labelControl.setValue(settings.FormattedValue);if(!initialized){updateItems();}Spotfire.WebView.readControl(id,{method:"GetItems"},updateItems);
};this.update=update;}Spotfire.registerNameSpace("Filters.ItemSlider",{create:function(id,settings){var filter=new ItemSlider(id);
$("#"+id).data("filter",filter);filter.update(settings,0);},update:function(id,settings,generation){var filter=$("#"+id).data("filter");
if(filter){filter.update(settings,generation);}}});});$(function(){Spotfire.registerNameSpace("Filters.ListBoxFilter");
var preferFirst=function(a,b){if(a!==undefined){return a;}return b;};var assignCheckBoxModeSettings=function(id,settings,useCheckBoxMode){var updateChecked=function($item,checked){var $checkbox=$(".sf-element-check-box",$item);
if(checked){$checkbox.removeClass("sfpc-unchecked");$checkbox.addClass("sfpc-checked");}else{$checkbox.removeClass("sfpc-checked");
$checkbox.addClass("sfpc-unchecked");}};var createCheckboxListItem=function(top,settings){var $item=$("<div/>").addClass(settings.listItemClass);
var $flexContainer=Spotfire.Flex.item({container:"horizontal",inline:true,"align-items":"center"});$flexContainer.css("max-width","100%");
$item.append($flexContainer);var $checkbox=$("<div/>").addClass("sf-element sf-element-check-box");Spotfire.getSvg("Images/Filters/CheckMark.svg",function($svg){$checkbox.append($svg);
});$checkbox.sfFlex({shrink:false}).appendTo($flexContainer);var $label=Spotfire.Flex.item().addClass("sf-element sf-element-text-box").css("text-overflow","ellipsis");
$label.appendTo($flexContainer);if(settings.setListItemCssHeight){$item.css({top:top+"px",height:settings.itemHeight+"px"});
}else{$item.css({top:top+"px"});}return $item;};var updateCheckboxListItem=function($item,index,item,hasValue,checked,itemHeight){var text=hasValue?item.Text:"...";
$(".sf-element-text-box",$item).text(text);$item.attr("title",text);updateChecked($item,checked);};var $filterContent=$("#"+id);
if(useCheckBoxMode){settings.itemManager={createListItem:createCheckboxListItem,updateListItem:updateCheckboxListItem,updateListItemSelected:updateChecked};
settings.togglingSelect=true;$filterContent.addClass("sfc-listcheckbox-filter");}else{settings.itemManager=null;
settings.togglingSelect=false;$filterContent.removeClass("sfc-listcheckbox-filter");}};var updateTotalVisibleValuesAndMask=function(filter,id,fallbackSettings){var callback=function(result){if(result){var resultSettings=result.settings;
var updatedSettings={totalVisibleValues:preferFirst(resultSettings.TotalVisibleValues,fallbackSettings.TotalVisibleValues),height:preferFirst(resultSettings.Height,fallbackSettings.Height),itemHeight:preferFirst(resultSettings.ItemHeight,fallbackSettings.ItemHeight),showSearchField:preferFirst(resultSettings.SearchFieldVisible,fallbackSettings.SearchFieldVisible),searchExpression:preferFirst(resultSettings.SearchExpression,fallbackSettings.SearchExpression)};
assignCheckBoxModeSettings(id,updatedSettings,fallbackSettings.CheckBoxMode);filter.update(updatedSettings);
filter.updateMask(result.mask);}};var args={method:"GetTotalVisibleValuesAndMask"};Spotfire.Filters.BatchRead.update(id,JSON.stringify(args),callback);
};Spotfire.Filters.ListBoxFilter.create=function(id,settings){var listBoxSettings={height:settings.Height,itemHeight:settings.ItemHeight,showSearchField:settings.SearchFieldVisible,showImageMask:true,multiSelect:true,selectTopItemDisjointly:true,onSelectionChanged:function(selection){var value={method:"Select",pendingSelects:selection};
Spotfire.WebView.modifyControl(id,JSON.stringify(value));},onGetValues:function(low,high,generation,callback){var value={method:"GetVisibleValues",low:low,high:high};
Spotfire.Filters.BatchRead.getValues(id,JSON.stringify(value),function(result){if(result){callback(result);
}});},onSearch:function(searchString){var value={method:"SearchExpression",expression:searchString};Spotfire.WebView.modifyControl(id,JSON.stringify(value));
},isScrollWheelDisabled:function(){return $("#"+id).closest(".sfc-filter-panel").length>0&&!Spotfire.FilterPanel.isSelected(id);
}};assignCheckBoxModeSettings(id,listBoxSettings,settings.CheckBoxMode);var $filterContent=$("#"+id);
var filter=Spotfire.Controls.VirtualListBox.create($filterContent,listBoxSettings,$filterContent.closest(".sf-element-filter"));
$filterContent.data("filter",filter);updateTotalVisibleValuesAndMask(filter,id,settings);};Spotfire.Filters.ListBoxFilter.update=function(id,settings){var filter=$("#"+id).data("filter");
if(filter){updateTotalVisibleValuesAndMask(filter,id,settings);}};});$(function(){var createRange=function(low,high){return{low:low,high:high,collapsed:function(){return this.low===this.high;
},equals:function(that){return this.low===that.low&&this.high===that.high;}};};function ValueCache(id,maxItems){var values=null;
var callbacks=[];var loadValues=function(done){if(values!==null){done();return;}callbacks.push(done);
if(callbacks.length>1){return;}Spotfire.WebView.readControl(id,{method:"GetFormattedValues",maxItems:maxItems},function(result){values=result;
while(callbacks.length>0){callbacks.shift()();}},function(){callbacks=[];});};var getLabelIndexAt=function(n){return Math.round(n*(values.length-1));
};var getLabelAt=function(n){return values[getLabelIndexAt(n)];};return{getValueRange:function(normalizedRange,callback){loadValues(function(){var range=createRange(getLabelAt(normalizedRange.low),getLabelAt(normalizedRange.high));
callback(range);});},getValueIndexRange:function(normalizedRange,callback){loadValues(function(){var range=createRange(getLabelIndexAt(normalizedRange.low),getLabelIndexAt(normalizedRange.high));
callback(range,values.length);});},clear:function(){values=null;}};}function Generation(id){var currentGeneration=0;
var maxValidatedGeneration=-1;var onTimeout=function(){if(maxValidatedGeneration<currentGeneration){Spotfire.FilterPanel.forceUpdate(id);
}};var timer=null;var resetTimer=function(){if(timer){window.clearTimeout(timer);}timer=window.setTimeout(onTimeout,500);
};return{inc:function(){currentGeneration++;resetTimer();return currentGeneration;},validate:function(gen){maxValidatedGeneration=Math.max(gen,maxValidatedGeneration);
var invalid=gen<currentGeneration;return !invalid;}};}function RangeSlider(id,showDatePicker,hasEmptyValues){var RANGESLIDER_NO_ACTION=0;
var RANGESLIDER_LEFTDRAG=1;var RANGESLIDER_MIDDLEDRAG=2;var RANGESLIDER_RIGHTDRAG=3;var currentAction=RANGESLIDER_NO_ACTION;
var stickyGuid;var generation=new Generation(id);var $parent=$("#"+id).empty();var $container=$("<div/>").addClass("RangeSlider sf-element sf-element-range-slider").appendTo($parent);
var $itemFeedback=$("<div/>").addClass("Feedback").appendTo($container);var $leftFeedback=$("<div/>").addClass("LeftAligned").appendTo($itemFeedback);
var $rightFeedback=$("<div/>").addClass("RightAligned").appendTo($itemFeedback);var $background=$("<div/>").addClass("BackgroundContainer").attr("draggable",false).appendTo($container);
var $outerRange=$("<div/>").addClass("OuterRange Range sf-element sf-element-range sfc-outer").appendTo($background);
var $middleHandle=$("<div/>").addClass("MiddleHandle Range sf-element sf-element-range sfc-inner-dimmed").appendTo($background);
var $innerRange=$("<div/>").addClass("InnerRange Range sf-element sf-element-range sfc-inner").appendTo($background);
var $leftDots=$("<div/>").addClass("Dots").appendTo($background);var $rightDots=$("<div/>").addClass("Dots").appendTo($background);
var $rightHandle=$("<div/>").addClass("Handle sf-element sf-element-thumb").appendTo($background);var $leftHandle=$("<div/>").addClass("Handle sf-element sf-element-thumb").appendTo($background);
$container.width($parent.width());var labelWidth=Math.max(0,Math.round($container.width()/2)-2);$leftFeedback.width(labelWidth);
$rightFeedback.width(labelWidth);var pixelWidth=$container.width();var pixelLow=0;var pixelHigh=pixelWidth;
var innerValue=createRange(0,1);var normalizedRange=createRange(0,1);var lastDragRangeSent=createRange(-1,-1);
var pixelHandleWidth=$rightHandle.outerWidth();var pixelHighMax=pixelWidth-pixelHandleWidth;$outerRange.width(pixelWidth);
var formattedValues=new ValueCache(id,pixelWidth);var onDrag=function(reset){var action=currentAction;
if(action===RANGESLIDER_NO_ACTION){return;}formattedValues.getValueIndexRange(normalizedRange,function(range){range.maxItems=pixelWidth;
range.collapsed=normalizedRange.collapsed();switch(action){case RANGESLIDER_LEFTDRAG:range.high=-1;break;
case RANGESLIDER_RIGHTDRAG:range.low=-1;break;}if(!range.equals(lastDragRangeSent)){lastDragRangeSent=range;
Spotfire.WebView.modifyControl(id,{method:"Drag",args:range},generation.inc(),stickyGuid);}if(reset){currentAction=RANGESLIDER_NO_ACTION;
}});};var throttledDrag=_.throttle(function(){onDrag(false);},50,{leading:true,trailing:true});var emptyValuesCheckBox=null;
var leftLabel=null;var rightLabel=null;var onIncludeEmptyValuesChange=function(){var includeEmpty=emptyValuesCheckBox.prop("checked");
var obj={method:"IncludeEmptyValues",args:includeEmpty};Spotfire.WebView.modifyControl(id,obj,generation.inc());
};var onLeftLabelInput=function(str){var range=createRange(str,rightLabel.getValue());var obj={method:"FormattedRange",args:range};
Spotfire.WebView.modifyControl(id,obj,generation.inc());};var onRightLabelInput=function(str){var range=createRange(leftLabel.getValue(),str);
var obj={method:"FormattedRange",args:range};Spotfire.WebView.modifyControl(id,obj,generation.inc());
};leftLabel=Spotfire.Filters.EditableLabel.create($leftFeedback,onLeftLabelInput,showDatePicker);rightLabel=Spotfire.Filters.EditableLabel.create($rightFeedback,onRightLabelInput,showDatePicker);
if(hasEmptyValues){var $emptyValuesLabel=$("<label/>").attr("title",Spotfire.Localization.resources.IncludeEmptyValues).appendTo($container).css({display:"block","padding-top":"2px",overflow:"hidden","white-space":"nowrap","text-overflow":"ellipsis"});
$("<span/>").appendTo($emptyValuesLabel).text(Spotfire.Localization.resources.IncludeEmptyValues).css({position:"relative","vertical-align":"top",top:"1px"});
emptyValuesCheckBox=$("<input type='checkbox'/>").click(onIncludeEmptyValuesChange).css({outline:"none","margin-right":"3px"});
var $checkboxContainer=$("<div/>").prependTo($emptyValuesLabel).append(emptyValuesCheckBox).css({display:"inline-block","vertical-align":"top"});
Spotfire.Filters.StyledFilters.createStyledInput($checkboxContainer,13,13);}var isValidValue=function(val){return !(window.isNaN(val.low)||window.isNaN(val.high));
};var drawInnerRange=function(){var innerWidth=pixelWidth-pixelHandleWidth*2;var pixelInnerLow=Math.round(innerValue.low*innerWidth)+pixelHandleWidth;
var pixelInnerHigh=Math.round(innerValue.high*innerWidth)+pixelHandleWidth;if(pixelInnerLow===pixelInnerHigh){if(innerValue.low===0){pixelInnerHigh+=2;
}else{if(innerValue.high===1){pixelInnerLow-=2;}else{pixelInnerLow-=1;pixelInnerHigh+=1;}}}if(pixelInnerLow<pixelLow+pixelHandleWidth){pixelInnerLow=pixelLow+pixelHandleWidth;
}if(pixelInnerHigh>pixelHigh){pixelInnerHigh=pixelHigh;}var minInnerRangeWidth=2;var middleLeft=$middleHandle.position().left;
var left=Math.max(middleLeft,Math.min(pixelInnerLow,middleLeft+$middleHandle.width()-minInnerRangeWidth));
var width=Math.max(minInnerRangeWidth,(pixelInnerHigh-pixelInnerLow));$innerRange.css("left",left+"px");
$innerRange.width(width);};var setInnerValue=function(newValue){if(newValue){if(isValidValue(newValue)){$innerRange.show();
innerValue=newValue;drawInnerRange();}else{$innerRange.hide();innerValue=createRange(0,1);}}};var draw=function(){$leftHandle.css("left",pixelLow+"px");
$rightHandle.css("left",pixelHigh+"px");var widthBetweenHandles=pixelHigh-pixelLow-pixelHandleWidth;$middleHandle.css("left",(pixelLow+pixelHandleWidth)+"px");
$middleHandle.width(widthBetweenHandles);drawInnerRange();var dotsWidth=18;$leftDots.width(Math.max(0,Math.min(dotsWidth,widthBetweenHandles)));
$leftDots.css("left",pixelLow+pixelHandleWidth);$rightDots.width(Math.max(0,Math.min(dotsWidth,widthBetweenHandles)));
$rightDots.css("left",pixelHigh-$rightDots.width()+"px");};var setLabels=function(leftStr,rightStr){if(typeof leftStr==="string"){leftLabel.setValue(leftStr);
}if(typeof rightStr==="string"){rightLabel.setValue(rightStr);}};var setPixelValue=function(low,high,ignoreLabels){switch(currentAction){case RANGESLIDER_LEFTDRAG:low=Math.max(0,Math.min(low,high-pixelHandleWidth));
break;case RANGESLIDER_RIGHTDRAG:high=Math.min(pixelHighMax,Math.max(high,low+pixelHandleWidth));break;
case RANGESLIDER_MIDDLEDRAG:var delta=high-low;if(low<0){low=0;high=delta;}else{if(high>pixelHighMax){high=pixelHighMax;
low=high-delta;}}break;default:low=Math.max(0,Math.min(low,high-pixelHandleWidth));high=Math.min(pixelHighMax,Math.max(high,low+pixelHandleWidth));
break;}pixelLow=low;pixelHigh=high;var normLow=low/(pixelWidth-2*pixelHandleWidth);var normHigh=(high-pixelHandleWidth)/(pixelWidth-2*pixelHandleWidth);
normalizedRange=createRange(normLow,normHigh);draw();if(ignoreLabels){return;}formattedValues.getValueRange(normalizedRange,function(range){var collapsed=normalizedRange.collapsed();
switch(currentAction){case RANGESLIDER_LEFTDRAG:setLabels(collapsed?rightLabel.getValue():range.low,null);
break;case RANGESLIDER_RIGHTDRAG:setLabels(null,collapsed?leftLabel.getValue():range.high);break;case RANGESLIDER_MIDDLEDRAG:setLabels(range.low,range.high);
break;default:break;}});};var snapThumbs=function(){formattedValues.getValueIndexRange(normalizedRange,function(index,valueCount){var width=pixelWidth-pixelHandleWidth*2;
var low=Math.round((index.low/(valueCount-1))*width);var high=Math.round((index.high/(valueCount-1))*width)+pixelHandleWidth;
setPixelValue(low,high);});};var mouseDownX=0;var mouseDownPixelLow=0;var mouseDownPixelHigh=0;var onMouseMove=function(e){var dx=e.clientX-mouseDownX;
switch(currentAction){case RANGESLIDER_LEFTDRAG:setPixelValue(mouseDownPixelLow+dx,mouseDownPixelHigh);
break;case RANGESLIDER_RIGHTDRAG:setPixelValue(mouseDownPixelLow,mouseDownPixelHigh+dx);break;case RANGESLIDER_MIDDLEDRAG:setPixelValue(mouseDownPixelLow+dx,mouseDownPixelHigh+dx);
break;default:return;}if(Spotfire.isProfessional()){throttledDrag();}e.stopPropagation();e.preventDefault();
};var onMouseUp=function(){snapThumbs();onDrag(true);};var onMouseDown=function(e){mouseDownX=e.clientX;
mouseDownPixelLow=pixelLow;mouseDownPixelHigh=pixelHigh;};var beginDrag=function(e,action){if(e.which!==1){return;
}if(action===RANGESLIDER_MIDDLEDRAG&&normalizedRange.equals(createRange(0,1))){action=RANGESLIDER_NO_ACTION;
}currentAction=action;stickyGuid=Spotfire.newFakeGuid();};Spotfire.Touch.registerTouchEvents($innerRange,function(e){beginDrag(e,RANGESLIDER_MIDDLEDRAG);
onMouseDown(e);},onMouseMove,onMouseUp);Spotfire.Touch.registerTouchEvents($middleHandle,function(e){beginDrag(e,RANGESLIDER_MIDDLEDRAG);
onMouseDown(e);},onMouseMove,onMouseUp);Spotfire.Touch.registerTouchEvents($leftHandle,function(e){beginDrag(e,RANGESLIDER_LEFTDRAG);
onMouseDown(e);},onMouseMove,onMouseUp);Spotfire.Touch.registerTouchEvents($rightHandle,function(e){beginDrag(e,RANGESLIDER_RIGHTDRAG);
onMouseDown(e);},onMouseMove,onMouseUp);var areaThatReactsToKeyboard=$parent.closest(".sf-element-filter");
Spotfire.Focus.handleKeyDown(areaThatReactsToKeyboard,function(e){switch(e.keyCode){case Keys.UP:case Keys.DOWN:case Keys.LEFT:case Keys.RIGHT:break;
default:return;}var keyDownArgs={keyCode:e.keyCode,shiftKey:e.shiftKey,ctrlKey:e.ctrlKey,altKey:e.altKey};
Spotfire.WebView.modifyControl(id,{method:"KeyDown",args:keyDownArgs},generation.inc());});$outerRange.click(function(e){var x=e.pageX-$outerRange.offset().left;
var offset=Math.round($leftHandle.width()/2);if(x<pixelLow){currentAction=RANGESLIDER_LEFTDRAG;setPixelValue(x-offset,pixelHigh);
}else{if(x>pixelHigh){currentAction=RANGESLIDER_RIGHTDRAG;setPixelValue(pixelLow,x-offset);}}onDrag(true);
});var update=function(settings,serverGeneration){Spotfire.Filters.BatchRead.update(id,"GetNormalizedFilteredRange",setInnerValue);
if(!generation.validate(serverGeneration)){return;}if(currentAction!==RANGESLIDER_NO_ACTION){return;}formattedValues.clear();
lastDragRangeSent=createRange(-1,-1);var css={visibility:settings.ModifiedDataRange?"visible":"hidden",display:settings.ModifiedDataRange?"":"none"};
$leftDots.css(css);$rightDots.css(css);if(settings.IsValidRange){leftLabel.enable();rightLabel.enable();
}else{leftLabel.disable();rightLabel.disable();}if(isValidValue(settings.NormalizedRange)){normalizedRange=settings.NormalizedRange;
var width=pixelWidth-pixelHandleWidth*2;var proposedLow=Math.round(normalizedRange.low*width);var proposedHigh=Math.round(normalizedRange.high*width)+pixelHandleWidth;
setPixelValue(proposedLow,proposedHigh,true);}else{normalizedRange=createRange(0,1);setPixelValue(0,pixelHandleWidth,true);
}if(emptyValuesCheckBox!==null){emptyValuesCheckBox.prop("checked",settings.IncludeEmpty);}setLabels(settings.FormattedRange.low,settings.FormattedRange.high);
};this.update=update;}Spotfire.registerNameSpace("Filters.RangeSlider",{create:function(id,settings){var filter=new RangeSlider(id,settings.ShowDatePicker,settings.HasEmptyValues);
$("#"+id).data("filter",filter);filter.update(settings,0);},update:function(id,settings,generation){var filter=$("#"+id).data("filter");
if(filter){filter.update(settings,generation);}}});});$(function(){function TextFilter(parentSelector,emptyText,callback){var $parent=$(parentSelector).empty();
var $input=$("<input type='text'/>").css({"font-size":"11px",height:"19px","vertical-align":"middle"});
$input.addClass("sf-element sf-element-input");$parent.append($input);var inputField=Spotfire.Controls.InputField.initialize($input,emptyText,callback);
var performLayout=function(){var horizontalBorderWidth=$input.outerWidth()-$input.width();$input.width($parent.width()-horizontalBorderWidth);
};$parent.on("resize",performLayout);performLayout();var update=function(value){inputField.update(value);
};this.update=update;}Spotfire.registerNameSpace("Filters.TextFilter");Spotfire.Filters.TextFilter.create=function(parentSelector,emptyText,value,callback){if(callback===undefined){callback=function(val){Spotfire.WebView.modifyControl($(parentSelector).attr("id"),val);
};}var filter=new TextFilter(parentSelector,emptyText,callback);$(parentSelector).data("filter",filter);
filter.update(value);};Spotfire.Filters.TextFilter.update=function(parentSelector,value){var filter=$(parentSelector).data("filter");
if(filter){filter.update(value);}};});var Ajax;if(!Ajax){Ajax={};}$(function(){var needsRefreshPeriod=-1;
var communicationErrorRetryTime=500;Ajax.readyState=0;Ajax.pollState=1;Ajax.popupPollState=2;Ajax.updateState=3;
Ajax.connectingState=4;var currentState=Ajax.readyState;var pollingEnabled=true;var isRequesting=false;
var maxConsecutiveErrors=5;var consecutiveErrors=0;var requestQueue=[];var requestCounter=0;var pollTimeoutObject;
var needsRefreshTimeoutObject;var onStateChangedHandlers=[];var onDocumentUpdatedEventHandlers=[];var addOnDocumentUpdatedEventHandler=function(eventHandler){onDocumentUpdatedEventHandlers.push(eventHandler);
};var removeOnDocumentUpdatedEventHandler=function(eventHandler){var i=onDocumentUpdatedEventHandlers.indexOf(eventHandler);
if(i>=0){onDocumentUpdatedEventHandlers.splice(i,1);return;}throw"Couldn't find event handler to remove.";
};var webSocketProxy=null;var useWebSocket=function(){return webSocketProxy!==null&&webSocketProxy.initialized();
};var communicationError=function(retryFunction,retryInterval,functionName,error){if(++consecutiveErrors<maxConsecutiveErrors){window.setTimeout(retryFunction,retryInterval);
}else{if(Spotfire.connectionLost()){window.setTimeout(retryFunction,15000);}else{var heading=(error.search("Status: 401 Unauthorized")>0)?"Session was logged out.":"Communication error in "+functionName;
Ajax.redirectToErrorPage(heading,error);}}};var serverHasResponded=null;var needsRefresh=function(){if(Spotfire.shutdown()){return;
}if(useWebSocket()){return;}var needsRefreshCallback=function(doRefresh){serverHasResponded();if(doRefresh){Ajax.enqueueRequest(Ajax.DocumentId,"Refresh","");
}};try{Spotfire.Dxp.Web.Forms.AjaxService.NeedsRefresh(Ajax.DocumentId,needsRefreshCallback,function(error){communicationError(needsRefresh,communicationErrorRetryTime,"Ajax.needsRefresh",error);
});}catch(e){communicationError(needsRefresh,communicationErrorRetryTime);}};var createRequestId=function(){return((new Date().getTime()+requestCounter++).toString(36));
};serverHasResponded=function(){if(needsRefreshTimeoutObject){window.clearTimeout(needsRefreshTimeoutObject);
}needsRefreshTimeoutObject=window.setTimeout(needsRefresh,1000*needsRefreshPeriod,true);consecutiveErrors=0;
};var notifyError=function(title,details){if(!Ajax.DocumentId){return;}Ajax.enqueueRequest(Ajax.DocumentId,"NotifyError",{title:title,details:details});
};var updateDocument=function(data){$.each(data,function(){var $elem;try{switch(this.ChangeAction){case"Script":Spotfire.evaluate(this.Script,Spotfire.isDebugging());
break;case"Remove":$elem=$("#"+this.ControlId);$elem.remove();break;case"Content":if(this.ParentControlId&&this.Content){$elem=$("#"+this.ControlId);
if($elem.size()>0){$elem.replaceWith(this.Content);}else{var $parent=$("#"+this.ParentControlId);$parent.append(this.Content);
}}break;default:throw"Unrecognized object";}}catch(e){notifyError("Interpretation error during update.",Spotfire.unwrapException(e));
if(Spotfire.isDebugging()){throw e;}return false;}return true;});};var sendRequest=null;var receiveCallbackFromRequest=function(response){if(Spotfire.shutdown()){return;
}if(response.Status!=="Error"&&Ajax.DocumentNumber!==response.DocumentNumber){if(Ajax.DocumentNumber<response.DocumentNumber){Spotfire.reloadPage();
}return;}isRequesting=false;requestQueue.shift();sendRequest();serverHasResponded();var status=response.Status;
try{switch(status){case"Executing":Ajax.setState(Ajax.popupPollState);if(response.Changes.length>0){Ajax.setState(Ajax.updateState);
updateDocument(response.Changes);if(response.Progress===null){Spotfire.Progress.closePopupProgress();
}}if(response.Prompt!==null){Spotfire.Progress.closePopupProgress();Prompt.setContents(response.Prompt);
}else{if(!Prompt.exists()){if(currentState===Ajax.popupPollState&&response.Progress!==null){Spotfire.Progress.setPopupProgressText(response.Progress);
}}}if(requestQueue.length===0&&!isRequesting){pollTimeoutObject=window.setTimeout(Ajax.poll,response.PollInterval);
}Ajax.setState(Ajax.pollState);break;case"Idle":Ajax.setState(Ajax.updateState);Spotfire.Progress.closePopupProgress();
updateDocument(response.Changes);if(requestQueue.length===0&&!isRequesting){Ajax.setState(Ajax.readyState);
$.each(onDocumentUpdatedEventHandlers,function(){this();});}else{Ajax.setState(Ajax.connectingState);
}if(response.Prompt!==null){Prompt.setContents(response.Prompt);}break;case"Canceled":Spotfire.shutdown(true);
Spotfire.replaceUrl(Spotfire.Web.redirectPageOnClosedAnalysis);break;case"Error":Spotfire.Framework.onServerError(response.Error,response.ClosedReason,response.ErrorId);
break;default:throw"Unknown WebAnalysisStatus: <"+status+">";}}catch(e){notifyError("Error in Ajax.receiveCallback",Spotfire.unwrapException(e));
if(Spotfire.isDebugging()){throw e;}}};sendRequest=function(){if(Spotfire.shutdown()){return;}if(!Ajax.DocumentId){Ajax.redirectToErrorPage("DocumentId not found","");
return;}if(requestQueue.length>0){var request=requestQueue[0];if(useWebSocket()){var requestData={waid:Ajax.DocumentId,wavid:Ajax.DocumentViewId,nodeId:request.id,callback:request.clientAction,args:request.serializedArgs};
webSocketProxy.send(requestData);requestQueue.shift();sendRequest();}else{if(currentState===Ajax.readyState){Ajax.setState(Ajax.connectingState);
}isRequesting=true;Spotfire.Dxp.Web.Forms.AjaxService.Request(Ajax.DocumentId,Ajax.DocumentViewId,request.id,request.requestId,request.clientAction,request.serializedArgs,receiveCallbackFromRequest,function(error){communicationError(sendRequest,communicationErrorRetryTime,"Ajax.request",error);
});}}};Ajax.needsRefresh=needsRefresh;Ajax.enqueueRequest=function(nodeId,clientAction,args){if(typeof nodeId!=="string"||typeof clientAction!=="string"){throw"Ajax.enqueueRequest argument error.";
}if(pollTimeoutObject){window.clearTimeout(pollTimeoutObject);}var performRequestNow=(requestQueue.length===0);
var request={};request.id=nodeId;request.requestId=createRequestId();request.clientAction=clientAction;
request.serializedArgs=Spotfire.ensureString(args);requestQueue.push(request);if(performRequestNow){sendRequest();
}};Ajax.poll=function(){if(Spotfire.shutdown()){return;}if(!pollingEnabled){return;}Ajax.enqueueRequest("QFC","","");
};Ajax.cancelOperation=function(){var callback=function(){Spotfire.Progress.closePopupProgress();Prompt.closePopupPrompt();
Ajax.setState(Ajax.popupPollState);pollingEnabled=true;if(requestQueue.length===0){Ajax.poll();}else{sendRequest();
}};pollingEnabled=false;Spotfire.Dxp.Web.Forms.AjaxService.CancelOperation(Ajax.DocumentId,callback,function(error){communicationError(Ajax.cancelOperation,communicationErrorRetryTime,"Ajax.cancelOperation",error);
});};Ajax.close=function(redirectUrl){if(redirectUrl===undefined){redirectUrl=Spotfire.Web!==undefined?Spotfire.Web.redirectPageOnClosedAnalysis:"";
}var performRedirect=function(){serverHasResponded();Ajax.onClosed("ClosedByUser",redirectUrl);};if(currentState===Ajax.readyState){Spotfire.shutdown(true);
Spotfire.Dxp.Web.Forms.AjaxService.Close(Ajax.DocumentId,Ajax.DocumentViewId,performRedirect,function(error){communicationError(Ajax.close,communicationErrorRetryTime,"Ajax.close",error);
});}else{var retry=function(){removeOnDocumentUpdatedEventHandler(retry);Ajax.close(redirectUrl);};addOnDocumentUpdatedEventHandler(retry);
}};Ajax.setState=function(state){currentState=state;$.each(onStateChangedHandlers,function(){this(currentState);
});};Ajax.logoutByUser=function(){if(Spotfire.Web!==undefined){Ajax.logout(Spotfire.Web.redirectPageOnLoggedOutByUser);
}else{Ajax.logout();}};Ajax.logout=function(redirectUrl){if(redirectUrl===undefined){redirectUrl=Spotfire.Web!==undefined?Spotfire.Web.redirectPageOnLoggedOut:"";
}var performRedirect=function(){serverHasResponded();Ajax.onLoggedOut();try{if(redirectUrl!==""){Spotfire.replaceUrl(redirectUrl);
}}catch(ignore){}};Ajax.enqueueRequest=$.noop;if(currentState===Ajax.readyState){Spotfire.shutdown(true);
Spotfire.Dxp.Web.Forms.AjaxService.Logout(Ajax.DocumentId,performRedirect,function(error){communicationError(Ajax.logout,communicationErrorRetryTime,"Ajax.logout",error);
});}else{var retry=function(){removeOnDocumentUpdatedEventHandler(retry);Ajax.logout(redirectUrl);};addOnDocumentUpdatedEventHandler(retry);
}};Ajax.redirectToErrorPage=function(message,details,errorid){if(Spotfire.shutdown()){return;}Spotfire.Framework.onError(message,details,errorid);
};function ResizeHandler($root){var preventPanning=function(){function hasScrollableParent(target){var isScrollable=function(){var overflow=$(this).css("overflow");
return(overflow==="scroll"||overflow==="auto");};return $(target).parents().filter(isScrollable).length!==0;
}document.addEventListener("touchmove",function(e){if(e.touches.length<=1&&Touch.getBrowserZoom()===1&&!hasScrollableParent(e.target)){e.preventDefault();
}},false);};var getAvailableSize=function(){var width=$(window).innerWidth();var height=$(window).innerHeight();
var isMashups=window!==window.parent;if(!isMashups&&Spotfire.capabilities.supportsTouch()){if(window.navigator.hasOwnProperty("standalone")&&window.navigator.standalone){preventPanning();
}}return new Size(Math.max(0,width),Math.max(0,height-Spotfire.Web.customizableAreaHeight));};var performLayout=function(){var size=getAvailableSize();
$root.width(size.width);$root.height(size.height);if(window.innerWidth>=document.documentElement.clientWidth){window.scrollTo(0,0);
}};var getRootElementSize=function(){return{width:$root.width(),height:$root.height()};};performLayout();
var serverSize=getRootElementSize();var serverResize=_.debounce(function(){var size=getRootElementSize();
if(serverSize.width!==size.width||serverSize.height!==size.height){serverSize=size;Ajax.enqueueRequest(Ajax.DocumentId,"Resize",JSON.stringify(serverSize));
}},Spotfire.isWebPlayer()?200:50);$(window).on("resize",function(e){if($(e.target).is(".ui-resizable")){return;
}performLayout();serverResize();});return{getSize:function(){return serverSize;}};}Spotfire.registerNameSpace("WebAnalysis",{initialize:function(parsedParams,proxy){Ajax.DocumentId=parsedParams.WebAnalysisId;
Ajax.DocumentViewId=parsedParams.DocumentViewId;Ajax.DocumentNumber=parsedParams.DocumentNumber;Spotfire.registerNameSpace("Licenses",{licensedFeatures:parsedParams.LicensedFeatures});
Spotfire.registerNameSpace("Colors",{ColorPalette:parsedParams.ColorPalette,MarkingColorPalette:parsedParams.MarkingColorPalette});
Spotfire.registerNameSpace("Web",{redirectPageOnDocumentLoaded:parsedParams.ViewAnalysisPageWithWebAnalysisId,redirectPageOnClosedAnalysis:parsedParams.ClosedAnalysisPage,redirectPageOnLoggedOut:parsedParams.LoggedOutPage,redirectPageOnLoggedOutByUser:parsedParams.LoggedOutPageByUser,redirectPageOnError:parsedParams.ErrorPage,analysisURL:parsedParams.ViewAnalysisPage,hideCancelButtonWhenLoading:parsedParams.HideCancelButtonWhenLoading,tooltipEnabled:parsedParams.ToolTipEnabled,tooltipDelay:parsedParams.ToolTipDelay,allowRelativeLinks:parsedParams.AllowRelativeLinks,emptyImage:parsedParams.EmptyImage,isMashupContext:parsedParams.IsMashupContext,helpTarget:"contextHelp",getHelpTopicLink:function(topicId){return parsedParams.LocalizedHelpUrl+"?context="+topicId;
},showHelp:function(topicId){var win=window.open(Spotfire.Web.getHelpTopicLink(topicId),Spotfire.Web.helpTarget);
win.focus();},customizableAreaHeight:parsedParams.CustomizableAreaHeight});needsRefreshPeriod=parsedParams.NeedsRefreshInterval;
if(parsedParams.IsMashupContext){var mashupCallback=Spotfire.Mashup.enable();if(typeof mashupCallback==="function"){addOnDocumentUpdatedEventHandler(mashupCallback);
}}if(proxy!==undefined){if(webSocketProxy!==null){throw"Already initialized";}webSocketProxy=proxy;webSocketProxy.registerHandler("wc",receiveCallbackFromRequest);
}var testElement=document.createElement("div");testElement.style.position="absolute";testElement.style.left="0px";
testElement.style.top="0px";testElement.style.height="100px";testElement.style.width="100px";testElement.style.overflow="scroll";
document.body.appendChild(testElement);var verticalScrollBarWidth=testElement.offsetWidth-testElement.clientWidth;
var horizontalScrollBarHeight=testElement.offsetHeight-testElement.clientHeight;document.body.removeChild(testElement);
testElement=null;var $root=$("<div/>").attr("id",Ajax.DocumentId);$root.css({position:"absolute",top:"0",left:"0"});
$(document.body).css("overflow","hidden");$(document.body).append($root);if(Spotfire.isWebPlayer()&&!Spotfire.MultipleViews.RegisterView()){return;
}var customizableArea=document.getElementById(parsedParams.CustomizableAreaId);if(customizableArea){$root.css("top",Spotfire.Web.customizableAreaHeight+"px");
var showCustomizableAreaFunc=function(){customizableArea.style.visibility="visible";removeOnDocumentUpdatedEventHandler(showCustomizableAreaFunc);
};addOnDocumentUpdatedEventHandler(showCustomizableAreaFunc);}var resizeHandler=new ResizeHandler($root);
Ajax.enqueueRequest(Ajax.DocumentId,"Init",{windowSize:resizeHandler.getSize(),timezoneOffset:-new Date().getTimezoneOffset(),verticalScrollBarWidth:verticalScrollBarWidth,horizontalScrollBarHeight:horizontalScrollBarHeight});
Touch.allowZoom();},notifyError:notifyError,onStateChanged:function(handler){if(typeof handler!=="function"){throw"Not a function";
}onStateChangedHandlers.push(handler);},handleWebViewModify:function(){return useWebSocket();},isReady:function(){return currentState===Ajax.readyState;
}});});$(function(){var flushD3Transitions=function(){var now=Date.now;Date.now=function(){return Infinity;
};d3.timer.flush();Date.now=now;};Spotfire.registerNameSpace("DesktopClientTest",{flushD3Transitions:flushD3Transitions});
});var isIE=navigator.appName.toLowerCase().indexOf("explorer")!==-1;$(function(){var redirect=function(url){Spotfire.replaceUrl(url);
};var buildPanelAndLink=function(title,text,details){var $errorPanel=$("<div/>").addClass("errorDialog sf-enable-selection").attr("title",title).text(text);
if(typeof details==="string"&&details!==""){var $detailsPanel=$("<div/>").css("white-space","pre").text(details).hide();
var $toggleDetailsLink=$("<a/>").attr("href","#").text(Spotfire.Localization.resources.ErrorDialog_ShowDetails).click(function(){$detailsPanel.toggle();
$(this).text($detailsPanel.is(":visible")?Spotfire.Localization.resources.ErrorDialog_HideDetails:Spotfire.Localization.resources.ErrorDialog_ShowDetails);
return false;});$errorPanel.append("<br/><br/>");$errorPanel.append($toggleDetailsLink);$errorPanel.append("<br/><br/>");
$errorPanel.append($detailsPanel);}return $errorPanel;};var getDefaultOptions=function(width,height){return{width:width,height:height,minWidth:width,minHeight:height,modal:true};
};var showErrorDialog=function(title,error,onClose){var $errorPanel=buildPanelAndLink(title,error.Message,error.Details);
var buttons=[{id:"okButton",text:Spotfire.Localization.resources.Ok,isDefault:true}];var options=getDefaultOptions(400,300);
options.buttons=buttons;options.close=onClose;Spotfire.Controls.ModalDialog.initialize($errorPanel,options);
};var clientError=function(message,details,errorid){if(!Spotfire.isWebPlayer()){window.alert(message+" "+details+" "+errorid);
return;}Ajax.onError(message,details);Spotfire.shutdown(true);Spotfire.LightBox.show();var data={errortype:"ClientError",errorMessage:message,errorId:errorid,errorDetails:details,analysisURL:Spotfire.Web.analysisURL,mashup:Spotfire.Web.isMashupContext};
var showError=function(response){Spotfire.LightBox.hide();var $errorPanel=buildPanelAndLink(response.title,response.message,response.detailsLiteralVisible?response.detailsLiteral:null);
if(response.errorGuid){$("<div/>").text(Spotfire.Localization.resources.ErrorDialog_RefCode+": "+response.errorGuid).insertBefore($("br",$errorPanel).first());
}if(response.reportErrorDivVisible){var $reportErrorDiv=$("<div/>");$("<a/>").text(Spotfire.Localization.resources.ErrorDialog_Report).attr("href",response.reportErrorNavigateUrl).appendTo($reportErrorDiv);
$errorPanel.append($reportErrorDiv);}var onReopenAnalysis=function(){redirect("/spotfire/wp/OpenAnalysis?file="+response.file);
};var gotoLibrary=function(){redirect("/spotfire/wp/startPage");};var options=getDefaultOptions(400,400);
var buttons=[];if(response.reopenAnalysisVisible){buttons.push({id:"reopenAnalysisButton",text:Spotfire.Localization.resources.ErrorDialog_Reopen,click:onReopenAnalysis,isDefault:true});
}if(response.libraryPageLinkVisible){buttons.push({id:"openLibraryButton",text:Spotfire.Localization.resources.ErrorDialog_OpenLibrary,click:gotoLibrary,isDefault:!response.reopenAnalysisVisible,isCancel:response.reopenAnalysisVisible});
}if(buttons.length===1){options.close=buttons[0].click;buttons[0].click=$.noop;}options.buttons=buttons;
Spotfire.Controls.ModalDialog.initialize($errorPanel,options);};$.ajax({url:"Error.xhr",data:JSON.stringify(data),error:function(){var msg=message;
if(details){msg+=" : "+details;}showError({title:"Error",message:msg});},success:showError});};var serverErrorHandled=false;
var serverError=function(error,closedReason,errorid){if(serverErrorHandled){return;}serverErrorHandled=true;
switch(closedReason){case"ClosedByAdministrator":case"Idle":Ajax.onClosed(closedReason,Spotfire.Web.redirectPageOnClosedAnalysis);
return;case"UserLoggedOut":Ajax.onClosed(closedReason,Spotfire.Web.redirectPageOnLoggedOut);return;case"ClosedByUser":case"CanceledByUser":Ajax.onClosed(closedReason,Spotfire.Web.redirectPageOnClosedAnalysis);
return;case"DifferentServer":case"Restart":case"Stale":Ajax.onClosed(closedReason,Spotfire.Web.redirectPageOnDocumentLoaded);
return;case"Exception":case"ScheduledUpdates":case"Unknown":break;default:break;}clientError(error.Message,error.Details,errorid);
};Spotfire.registerNameSpace("Framework",{onServerError:serverError,onError:clientError});Spotfire.registerNameSpace("Framework.ErrorDialog",{show:showErrorDialog});
});$(function(){var trackAjaxRequests=function(){var requestCount=0;var pendingRequests={};$(document).ajaxSend(function(event,xhr,requestSettings){requestCount++;
requestSettings.index=requestCount;pendingRequests[requestSettings.index]=xhr;});$(document).ajaxComplete(function(event,xhr,requestSettings){delete pendingRequests[requestSettings.index];
});$(window).unload(function(){$.each(pendingRequests,function(index,req){try{req.abort();}catch(ignore){}});
});};var initializePageBus=function(){var onData=function(subj,msg,data){var args=JSON.stringify({subj:subj,msg:msg,data:data});
var cef=window.SpotfireCef;if(cef!==undefined&&cef!==null){if(!cef.postJsonMessage(args)){throw"SpotfireCef.postJsonMessage failed";
}return;}var ext=window.external;if(ext!==undefined&&ext!==null&&typeof ext.PostJsonMessage==="function"){window.external.PostJsonMessage(args);
}};Spotfire.PageBus.subscribe("**",onData);};Spotfire.registerNameSpace("FormsIntegration",{initialize:function(){if(window.external!==undefined){window.sfEvalHook=function(code){try{return JSON.stringify({v:Spotfire.evaluate(code)});
}catch(ignored){return null;}};trackAjaxRequests();}initializePageBus();$(document.body).on("click",function(e){var $target=$(e.target);
if(!$target.is("a")){return;}var href=$target.attr("href");if((typeof href==="string"?href.toLowerCase():"").indexOf("file://")===0){e.preventDefault();
Spotfire.PageBus.publish("spotfire.filelinkclicked",{url:href});}});$(document.body).on("mousewheel.sf-global",function(e){if(e.ctrlKey){e.preventDefault();
}});}});});$(function(){var Ajax=window.Ajax;if(!Ajax){Ajax={};window.Ajax=Ajax;}var isMashup=false;var mashupOrigin=null;
var pendingApiRequests=[];var apiRequestsStorageKey;var mashupOriginKey;var postMashupMessage=function(method,message){if(!isMashup){return;
}message=message||{};message.method=method;message.documentId=Ajax.DocumentId;try{window.parent.postMessage(JSON.stringify(message),mashupOrigin);
}catch(ignore){}};var executeApiMethod=function(path,argsString,requestId,initialRequest){var apiFunc=Spotfire.Api;
var i;try{for(i=0;i<path.length;i++){apiFunc=apiFunc[path[i]];}var jsonArgs=JSON.parse(argsString);if(initialRequest){jsonArgs.push(requestId);
}pendingApiRequests.push({path:path,args:JSON.stringify(jsonArgs),requestId:requestId});apiFunc(jsonArgs);
}catch(e){Ajax.apiError(null,"The api function '"+path.join(".")+"' does not exist.");}};var executeLostApiRequests=function(){try{var postponedRequests=window.sessionStorage.getItem(apiRequestsStorageKey);
if(postponedRequests){var i,data;window.sessionStorage.removeItem(apiRequestsStorageKey);var requests=JSON.parse(postponedRequests);
for(i=0;i<requests.length;i++){data=requests[i];executeApiMethod(data.path,data.args,data.requestId,false);
}}}catch(ignore){}};var enableMashup=function(){if(isMashup){return false;}if(window===window.parent){return false;
}var parseMessageOrigin=function(url){var patIPv4=/^(https?:\/\/)(?:[a-zA-Z0-9\-.]+@[a-zA-Z0-9\-.]+:)?([a-zA-Z0-9\-.]+)(:[0-9]+)?(.*)$/i;
var patIPv6=/^(https?:\/\/)(?:[a-zA-Z0-9\-.]+@[a-zA-Z0-9\-.]+:)?(\[[a-zA-Z0-9:]+\])(:[0-9]+)?(.*)$/i;
var res=patIPv6.exec(url)||patIPv4.exec(url);if(res){var protocol=res[1];var address=res[2];var port=res[3]||"";
if((protocol==="http://"&&port===":80")||(protocol==="https://"&&port===":443")){return protocol+address;
}return protocol+address+port;}return null;};var setMashupOrigin=function(){try{mashupOrigin=window.sessionStorage.getItem(mashupOriginKey);
window.sessionStorage.removeItem(mashupOriginKey);}catch(ignore){}if(mashupOrigin){return;}mashupOrigin=parseMessageOrigin(document.referrer)||window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"");
};var onMessage=function(event){if(event.origin!==mashupOrigin||event.source!==parent){return;}var data=JSON.parse(event.data);
if(data.method==="ExecuteApiMethod"){executeApiMethod(data.path,data.args,data.requestId,true);return;
}if(data.method==="closeAnalysis"){Ajax.close();return;}};isMashup=true;setMashupOrigin();window.addEventListener("message",onMessage);
return function(){postMashupMessage("documentUpdated");};};Ajax.onClosed=function(closedReason,url){if(isMashup){postMashupMessage("analysisClosed",{closedReason:closedReason});
}switch(closedReason){case"ClosedByAdministrator":case"Idle":case"UserLoggedOut":case"ClosedByUser":case"CanceledByUser":Spotfire.replaceUrl(url);
break;case"DifferentServer":case"Restart":case"Stale":if(!isMashup){Spotfire.replaceUrl(url);}break;case"ScheduledUpdates":if(isMashup){try{window.sessionStorage.setItem(apiRequestsStorageKey,JSON.stringify(pendingApiRequests));
window.sessionStorage.setItem(mashupOriginKey,mashupOrigin);}catch(ignore){}}Spotfire.reloadPage();break;
default:break;}};Ajax.onError=function(message,details){postMashupMessage("ajaxError",{message:message,details:details});
};Ajax.onLoggedOut=function(){postMashupMessage("userLoggedOut",{});};Ajax.mashupAnalysisLoaded=function(){postMashupMessage("analysisLoaded",{documentId:Ajax.DocumentId,documentViewId:Ajax.DocumentViewId});
executeLostApiRequests();};Ajax.apiRequestReceipt=function(requestId){postMashupMessage("apiRequestReceipt",{requestId:requestId});
var i;for(i=0;i<pendingApiRequests.length;i++){if(pendingApiRequests[i].requestId===requestId){pendingApiRequests.splice(i,1);
}}};Ajax.apiError=function(code,message){postMashupMessage("apiError",{code:code,message:message});};
Ajax.runCallback=function(id,args,evaluate){postMashupMessage("apiResult",{id:id,args:evaluate?args:JSON.stringify(args),eval:evaluate});
};Spotfire.registerNameSpace("Mashup",{enable:function(){apiRequestsStorageKey="API_"+Ajax.DocumentId+"_"+Ajax.DocumentViewId;
mashupOriginKey="Origin_"+Ajax.DocumentId+"_"+Ajax.DocumentViewId;return enableMashup();}});Spotfire.registerNameSpace("Api",{Internal:{disableTransitions:function(apiRequestId){Spotfire.disableTransitions();
Ajax.apiRequestReceipt(apiRequestId[0]);}}});});$(function(){var clearStorage=function(){try{window.localStorage.clear();
}catch(ignore){}};var getItem=function(key){var item;try{item=window.localStorage.getItem(key);}catch(ex){return null;
}try{return JSON.parse(item);}catch(e){return item;}};var documentFullId;var browserTabId=Math.random().toString(36).substr(2);
var setItem=function(key,value){if(typeof value!=="string"){value=JSON.stringify(value);}try{window.localStorage.setItem(key,value);
}catch(ex){clearStorage();}};var removeItem=function(key){try{window.localStorage.removeItem(key);}catch(ignore){}};
var modalOwnerAndCount;var unlockCallbacks=[];var registerUnlockCallback=function(callback){unlockCallbacks.push(callback);
};var unregisterUnlockCallback=function(callback){var i;for(i=0;i<unlockCallbacks.length;i++){if(unlockCallbacks[i]===callback){unlockCallbacks.splice(i,1);
i--;}}};var callUnlockCallbacks=function(){var cb=unlockCallbacks.pop();while(cb){cb();cb=unlockCallbacks.pop();
}};var lockRemoteViews=function(){var current=getItem(modalOwnerAndCount);var owner=current?current.owner:null;
var count=current?current.count:0;if(owner===browserTabId){count=Math.max(0,count+1);}else{count=1;}setItem(modalOwnerAndCount,{owner:browserTabId,count:count});
};var unlockRemoteView=function(){var current=getItem(modalOwnerAndCount);var owner=current?current.owner:null;
var count=current?current.count:0;if(owner===browserTabId){count=Math.max(0,count-1);}else{count=0;}setItem(modalOwnerAndCount,{owner:browserTabId,count:count});
};var closeModalBlocker=function(){$("#remoteModalBlocker").remove();};var showModalBlocker=function(){if($("#remoteModalBlocker").is(":visible")){return;
}var modalBlocker=$("<div />");modalBlocker.css({position:"absolute",left:0,top:0,right:0,bottom:0,"background-color":"#000",opacity:0.5});
modalBlocker.attr("id","remoteModalBlocker");modalBlocker.appendTo($(document.body));modalBlocker.on("click",function(){if($("#remoteModalBlockerDialog").is(":visible")){return;
}var $content=$("<div>"+Spotfire.Localization.resources.MultipleViews_LockedWindowText+"</div>").addClass("confirmContent").attr("id","remoteModalBlockerDialog");
Spotfire.Controls.ModalDialog.initialize($content,{width:400,resizable:false,modal:false,autoOpen:true,dialogClass:"confirmDialog",title:Spotfire.Localization.resources.MultipleViews_LockedWindowTitle,buttons:[{text:Spotfire.Localization.resources.Yes,isDefault:true,click:function(){Prompt.cancelPrompt();
closeModalBlocker();setItem(modalOwnerAndCount,{owner:"cancelled",count:0});}},{text:Spotfire.Localization.resources.No,isCancel:true}]});
});};var checkForModalDialog=function(event){if(event&&event.key!==modalOwnerAndCount){return;}var current=event?JSON.parse(event.newValue):getItem(modalOwnerAndCount);
var owner=current?current.owner:null;var count=current?current.count:0;if(owner==="unloaded"){closeModalBlocker();
Prompt.cancelPrompt();removeItem(modalOwnerAndCount);}else{if(owner==="cancelled"){closeModalBlocker();
if(event&&event.oldValue){var oldValue=JSON.parse(event.oldValue);if(oldValue.owner===browserTabId){callUnlockCallbacks();
$(".modal.in").modal("hide");$(".ui-dialog-content").dialog("destroy").remove();Spotfire.Controls.ModalDialog.closeAll();
}}}else{if(owner!==browserTabId){if(count>0){showModalBlocker();}else{closeModalBlocker();}}}}};var pokeViewKeyPrefix;
var refreshTimer;var checkNeedsRefresh=function(event){var key=pokeViewKeyPrefix+Ajax.DocumentViewId;
if(event.key!==key){return;}removeItem(key);if(!refreshTimer){refreshTimer=window.setTimeout(function(){refreshTimer=null;
Ajax.needsRefresh();},0);}};var pokeViews=function(){var i;for(i=0;i<arguments.length;i++){if(getItem(Ajax.DocumentId+"_"+arguments[i])){setItem(pokeViewKeyPrefix+arguments[i],new Date().getTime());
}}};var revertingKey;var revertPerformedPrefix;var revertToLastSaved=function(data){data.documentId=Ajax.DocumentId;
try{window.sessionStorage.setItem(revertingKey,JSON.stringify(data));}catch(ignore){}Spotfire.replaceUrl(data.url);
};var checkForRevert=function(event){var key=Ajax.DocumentId+revertPerformedPrefix+Ajax.DocumentViewId;
if(event.key!==key){return;}removeItem(key);Spotfire.replaceUrl(event.newValue);};var getSiblings=function(){var maxViewId=parseInt(getItem("MaxView_"+Ajax.DocumentId),10);
var siblings=[];var i;for(i=0;i<=maxViewId;i++){if(i!==parseInt(Ajax.DocumentViewId,10)&&getItem(Ajax.DocumentId+"_"+i)){siblings.push(i.toString());
}}return siblings;};var documentNumber;var updateDocumentNumber=function(args){setItem(documentNumber,args);
if(args.DocumentNumber<Ajax.DocumentNumber){return;}window.setTimeout(function(){Ajax.onClosed("ScheduledUpdates");
},0);};var checkForDocumentNumberUpdate=function(event){if(event.key!==documentNumber){return;}var args=JSON.parse(event.newValue);
if(Ajax.DocumentNumber>args.DocumentNumber){return;}Ajax.poll();};var checkInitialDocumentNumber=function(){var args=getItem(documentNumber);
if(!args||Ajax.DocumentNumber>args.DocumentNumber){return;}Ajax.onClosed("ScheduledUpdates");};var onClosing=function(){if(getItem(documentFullId)===browserTabId){removeItem(documentFullId);
window.setTimeout(function(){setItem(documentFullId,browserTabId);},100);}};var focusCallbacks=[];var hasFocus=false;
var viewReceivedFocus;var onRemoteFocus=function(callback){focusCallbacks.push(callback);};var offRemoteFocus=function(callback){var i;
for(i=0;i<focusCallbacks.length;i++){if(focusCallbacks[i]===callback){focusCallbacks.splice(i,1);i--;
}}};var checkForRemoteClicks=function(event){if(event.key.indexOf(viewReceivedFocus)===0&&event.newValue!==Ajax.DocumentViewId){hasFocus=false;
var cb=focusCallbacks.pop();while(cb){cb();cb=focusCallbacks.pop();}}};var onFocus=function(){if(!hasFocus){hasFocus=true;
setItem(viewReceivedFocus,Ajax.DocumentViewId);}};var showRemoteLightBox=function(popup){if(popup&&!popup._isProcessed){popup._isProcessed=true;
lockRemoteViews();}else{if(!popup){lockRemoteViews();}}};var hideRemoteLightBox=function(){unlockRemoteView();
};window.addEventListener("mousedown",onFocus,true);window.addEventListener("keydown",onFocus,true);var spawnTimeout;
var requestSpawnView=function(owner){setItem(Ajax.DocumentId+"_SpawnRequest_"+owner,browserTabId);spawnTimeout=window.setInterval(function(){if(!getItem(documentFullId)){Spotfire.reloadPage();
}},100);};var setSpawnResult=function(origin,url){setItem(Ajax.DocumentId+"_SpawnResult_"+origin,url);
};var checkForSpawnView=function(event){var requestKey=Ajax.DocumentId+"_SpawnRequest_"+browserTabId;
var responseKey=Ajax.DocumentId+"_SpawnResult_"+browserTabId;if(event.key===requestKey){removeItem(requestKey);
Ajax.enqueueRequest(Ajax.DocumentId,"SpawnView",{origin:event.newValue});}if(event.key===responseKey){if(spawnTimeout){window.clearTimeout(spawnTimeout);
}removeItem(responseKey);Spotfire.replaceUrl(event.newValue);}};var initialize=function(){if(Spotfire.isProfessional()){return true;
}var pingTime=60*1000;var pingKey="Ping";var lastPing=getItem(pingKey);if(!lastPing||lastPing<(new Date().getTime()-5*pingTime)){clearStorage();
}var ping=function(){setItem(pingKey,new Date().getTime());};ping();window.setInterval(ping,pingTime);
var i;documentFullId=Ajax.DocumentId+"_"+Ajax.DocumentViewId;modalOwnerAndCount=Ajax.DocumentId+"_MOD";
pokeViewKeyPrefix=Ajax.DocumentId+"_QFC_";documentNumber=Ajax.DocumentId+"_WLR";revertingKey="REV";revertPerformedPrefix="_REV_DONE_";
viewReceivedFocus=Ajax.DocumentId+"_FOC";$.widget("ui.dialog",$.ui.dialog,{open:function(){if(this.options.modal&&!this._isProcessed){lockRemoteViews();
this._isProcessed=true;}return this._super();},close:function(){if(this.options.modal&&this._isProcessed){unlockRemoteView();
this._isProcessed=false;}return this._super();}});$(document).on("show.spotfire.modal",function(){lockRemoteViews();
});$(document).on("hide.spotfire.modal",function(){unlockRemoteView();});$(document).on("show.bs.modal",function(){lockRemoteViews();
});$(document).on("hide.bs.modal",function(){unlockRemoteView();});$(document).on("show.spotfire.lightbox",function(){lockRemoteViews();
});$(document).on("hide.spotfire.lightbox",function(){unlockRemoteView();});checkForModalDialog();try{var revertingdata=window.sessionStorage.getItem(revertingKey);
if(revertingdata){var data=JSON.parse(revertingdata);window.sessionStorage.removeItem(revertingKey);for(i=0;
i<data.siblings.length;i++){setItem(data.documentId+revertPerformedPrefix+data.siblings[i].documentviewid,window.location.href);
}}}catch(ignore){}var storageListener=function(event){if(event.key.indexOf(Ajax.DocumentId+"_")!==0||!event.newValue){return;
}checkForSpawnView(event);checkForModalDialog(event);checkNeedsRefresh(event);checkForRevert(event);checkForRemoteClicks(event);
checkForDocumentNumberUpdate(event);};window.addEventListener("storage",storageListener);if(getItem(documentFullId)){requestSpawnView(getItem(documentFullId));
return false;}setItem(documentFullId,browserTabId);checkInitialDocumentNumber();var maxViewId=getItem("MaxView_"+Ajax.DocumentId);
if(!maxViewId||parseInt(Ajax.DocumentViewId,10)>parseInt(maxViewId,10)){setItem("MaxView_"+Ajax.DocumentId,Ajax.DocumentViewId);
}var id=getItem(documentFullId);if(id!==null&&id!==browserTabId){Spotfire.reloadPage();return false;}$(window).on("unload",function(){if(getItem(documentFullId)===browserTabId){removeItem(documentFullId);
}removeItem(pokeViewKeyPrefix+Ajax.DocumentViewId);removeItem(Ajax.DocumentId+revertPerformedPrefix+Ajax.DocumentViewId);
removeItem(Ajax.DocumentId+"_SpawnRequest_"+browserTabId);removeItem(Ajax.DocumentId+"_SpawnResult_"+browserTabId);
if(getSiblings().length===0){removeItem(viewReceivedFocus);removeItem("MaxView_"+Ajax.DocumentId);removeItem(modalOwnerAndCount);
}else{var current=getItem(modalOwnerAndCount);if(current&&current.owner===browserTabId){setItem(modalOwnerAndCount,{owner:"unloaded",count:0});
}}});return true;};Spotfire.registerNameSpace("MultipleViews",{PokeViews:pokeViews,RegisterView:initialize,ReplaceUrl:revertToLastSaved,OnRemoteFocus:onRemoteFocus,OffRemoteFocus:offRemoteFocus,SetFocus:onFocus,LockSiblingViews:showRemoteLightBox,UnlockSiblingViews:hideRemoteLightBox,RegisterUnlockCallback:registerUnlockCallback,UnregisterUnlockCallback:unregisterUnlockCallback,GetSiblings:getSiblings,ScheduledUpdatesWindowLocationReplace:updateDocumentNumber,SetSpawnResult:setSpawnResult,OnClosing:onClosing});
});var Progress;if(!Progress){Progress={};}$(function(){var setProgressText=function(progress,$popup){$(".progressTitle",$popup).text(progress.Title);
$(".progressDescription",$popup).text(progress.Description);};var createPopupProgress=function(cancelOperation){var $styledDialog=$("<div>").addClass("sf-element sf-element-styled-dialog progressDialog");
var $popup=$("<div>").addClass("sf-element sf-element-progress-dialog").css({width:"400px",height:"300px",position:"absolute",left:$(window).width()/2-200+"px",top:$(window).height()/2-150+"px"}).appendTo($styledDialog);
var $progressImage=$("<div>").addClass("sf-element sf-element-busy-indicator sf-svg-loader-70x70 progressPopupAnimation").css({"margin-left":"auto","margin-right":"auto"});
if(!Spotfire.useTransitions()){$progressImage.addClass("sfpc-inactive");}Spotfire.getSvg("Images/Progress/CircularProgressAnimation.svg",function($svg){$progressImage.append($svg);
});var $progressDialogText=$("<div>").addClass("sf-element sf-element-progress-dialog-text");$("<div>").addClass("progressTitle").appendTo($progressDialogText);
$("<div>").addClass("progressDescription").appendTo($progressDialogText);var onCancelClick=function(){cancelOperation();
$popup.remove();};var $cancelLink=$("<div>").addClass("progressCancel").text(Spotfire.Localization.resources.Cancel).click(onCancelClick);
if(Spotfire.Web.hideCancelButtonWhenLoading){$cancelLink.hide();}$popup.append($progressImage);$popup.append($progressDialogText);
$popup.append($cancelLink);var recenter=function(){$popup.css({position:"absolute",left:$(window).width()/2-$popup.width()/2+"px",top:$(window).height()/2-$popup.height()/2+"px"});
};$("body").append($styledDialog);$(window).on("resize",recenter);$popup.on("remove",function(){$(window).off("resize",recenter);
});window.setTimeout(function(){$cancelLink.css("left",($cancelLink.parent().innerWidth()-$cancelLink.outerWidth())/2+"px");
},0);Spotfire.MultipleViews.LockSiblingViews($styledDialog);return $styledDialog;};Progress.setPopupUploadProgressText=function(progress,cancelUploadCallback){var $popup=createPopupProgress(cancelUploadCallback);
setProgressText(progress,$popup);};Progress.showPlotOverlay=function(parentId){var overlayId=parentId+"_refresh";
var $parent=$("#"+parentId);if($("#"+overlayId,$parent).size()>0){return;}var $overlay=$(Spotfire.Progress.createProgressAnimation($parent.width(),$parent.height()));
$overlay.attr("id",overlayId);$parent.append($overlay);return $overlay;};Progress.hidePlotOverlay=function(parentId){var overlayId=parentId+"_refresh";
var $parent=$("#"+parentId);var $overlay=$("#"+overlayId,$parent);$overlay.remove();};Spotfire.registerNameSpace("Progress",{setPopupProgressText:function(progress){var $popup=$(".progressDialog");
if($popup.length===0){$popup=createPopupProgress(Ajax.cancelOperation);var restorers=[];$popup.siblings().each(function(){var $sibling=$(this);
var zIndex=parseInt($sibling.css("z-index"),10);if(zIndex>0){$sibling.css("z-index","");restorers.push(function(){$sibling.css("z-index",zIndex);
});}});$popup.on("sf-progress-dialog-close",function(){while(restorers.length>0){restorers.shift()();
}});}setProgressText(progress,$popup);},closePopupProgress:function(){if(Spotfire.Data.Upload.uploadProgress){return;
}var $popup=$(".progressDialog");if($popup.length>0){Spotfire.MultipleViews.UnlockSiblingViews();}$popup.trigger("sf-progress-dialog-close");
$popup.remove();},createProgressAnimation:function(width,height){var $overlay=$("<div/>").css({position:"absolute",top:"0",left:"0",width:width?width+"px":"100%",height:height?height+"px":"100%"});
var animationSize=30;var animationPadding=8;var animationOuterSize=animationSize+animationPadding*2;var $progressContainer=$("<div/>").addClass("sf-element sf-element-progress-animation").css({"border-radius":"50%",position:"absolute",height:animationSize,width:animationSize,padding:animationPadding,left:width/2-animationOuterSize/2,top:height/2-animationOuterSize/2}).appendTo($overlay);
var $progressImage=$("<div/>").addClass("sf-element sf-element-busy-indicator sf-svg-loader-30x30").appendTo($progressContainer);
if(!Spotfire.useTransitions()){$progressImage.addClass("sfpc-inactive");}Spotfire.getSvg("Images/Progress/CircularProgressAnimation.svg",function($svg){$progressImage.append($svg);
});return $overlay.get(0);},createFadingProgressAnimation:function($parent,width,height){var fadeInMs=Spotfire.useTransitions()?1000:0;
var fadeOutMs=Spotfire.useTransitions()?250:0;var $element=$(this.createProgressAnimation(width,height));
var $animation=$element.find(".sf-element-progress-animation").fadeIn(fadeInMs);$element.appendTo($parent);
var remove=function(){$element.css("pointer-events","none");$animation.stop().fadeOut(fadeOutMs,function(){$element.remove();
});};return{"$element":$element,remove:remove};}});});var ProgressBlocker={};$(function(){var defaultSettings={bgColor:undefined,bgOpacity:undefined,delay:0,zIndex:1000,cancelOperation:undefined,showProgress:true};
var doBlock=function(element,options){var settings=$.extend({},defaultSettings,options);if($(".progressBlocker",element).size()>0){return;
}var progressContainer=$("<div></div>");progressContainer.addClass("progressBlocker");var $progress=Spotfire.Flex.item({container:"vertical",fill:true,"justify-content":"center","align-items":"center"}).css({position:"absolute",top:0,left:0,"z-index":settings.zIndex,width:element.outerWidth()+"px",height:element.outerHeight()+"px"});
if(element.css("position")==="static"){$progress.css({top:element.position().top+"px",left:element.position().left+"px"});
}$progress.bind("*",function(event){event.stopPropagation();});if(settings.showProgress){$(Spotfire.Progress.createProgressAnimation(30,30)).css("position","relative").appendTo($progress);
}if(settings.bgColor){$progress.css({"background-color":settings.bgColor});}if(settings.bgOpacity){$progress.css({"z-index":"1"});
}if(settings.cancelOperation){$("<p>").addClass("progressCancel").text(Spotfire.Localization.resources.Cancel).appendTo($progress).click(function(){settings.cancelOperation();
});}progressContainer.append($progress);element.append(progressContainer);var progressOpacity=settings.bgOpacity!==undefined?settings.bgOpacity:1;
$progress.css("opacity",0).delay(settings.delay).fadeTo(600,progressOpacity);progressContainer.css("opacity",0).delay(settings.delay).fadeTo(600,1);
};ProgressBlocker.block=function(element,settings){_.defer(function(){doBlock(element,settings);});};
ProgressBlocker.unblock=function(element){_.defer(function(){var progressContainer=$(".progressBlocker",element);
progressContainer.empty();progressContainer.remove();});};});var Prompt;if(!Prompt){Prompt={};}$(function(){Prompt._clientValidationOk=true;
Prompt._errorMessage="";Prompt.promptModel=null;Prompt.controlsEnabled=false;Prompt.resetCallbacks=function(){Prompt.onPromptLoaded=function(){};
Prompt.onPromptConfirmed=function(){};Prompt.onPromptCanceled=function(){};Prompt.onWizardAdvanced=function(){};
Prompt.onClientValidate=function(){};Prompt.onResize=function(){};};Prompt.resetCallbacks();Prompt.updateStyledElements=function updateStyledInput(){if(Prompt.inProgress){Spotfire.Filters.StyledFilters.createStyledInput($(".promptContentPanel"),13,13);
}};Prompt.setContents=function(prompt){Prompt.inProgress=true;var popup=$(".promptingPopup");var contentPanel=$(".promptContentPanel",popup);
var onClose=function(){if(Prompt.inProgress){Prompt.cancelPrompt();Prompt.inProgress=false;}if(Prompt.interval){window.clearInterval(Prompt.interval);
Prompt.interval=null;}};if(popup.size()===0){popup=$("<div/>").addClass("promptingPopup sf-enable-selection");
contentPanel=$("<div/>").addClass("promptContentPanel").appendTo(popup);popup.data("ModalDialog",Spotfire.Controls.ModalDialog.initialize(popup,{type:prompt.DialogType.toLowerCase(),width:prompt.Width,height:prompt.Height,minWidth:prompt.MinWidth,minHeight:prompt.MinHeight,close:onClose,modal:true,titleIcon:prompt.Icon,preventAutoClose:function(){return !popup.hasClass("sf-has-default-button");
},resize:function(){contentPanel.trigger("sf-resize");Prompt.onResize();}}));Spotfire.LightBox.makeInvisible();
}if(prompt){contentPanel.html("");contentPanel.html(prompt.Contents?prompt.Contents:"");if(prompt.PromptScripts){Spotfire.evaluate(prompt.PromptScripts);
}if(prompt.Model){Prompt.promptModel=JSON.parse(prompt.Model);}if(prompt.ValidationResults){if(prompt.ValidationResults.IsValid===true){Prompt.setValid();
}else{Prompt.setInvalid(prompt.ValidationResults.ErrorMessage);}}Prompt.updateStyledElements();if(!Prompt.interval){Prompt.interval=window.setInterval(Prompt.updateStyledElements,100);
}popup.find("input").addClass("sf-element-input");popup.dialog("option",{title:prompt.Title?prompt.Title:"",height:prompt.Height});
Prompt.onPromptLoaded(Prompt.promptModel);}else{contentPanel.html("");var preparingPanel=$("<div></div>");
preparingPanel.css({width:"100%",height:"100%","text-align":"center"});var animation=$("<img src='Images/Progress/CircularProgressAnimation.gif'/>");
animation.css({width:"32px",height:"32px"});var text=$("<p></p>");text.html(Spotfire.Localization.resources.PreparingPromptStep);
preparingPanel.append($("<br/>"));preparingPanel.append($("<br/>"));preparingPanel.append(animation);
preparingPanel.append(text);contentPanel.append(preparingPanel);}Prompt.controlsEnabled=true;};Prompt.showButtons=function(buttons,clientValidation){var extractFormValues=function(){Prompt.promptModel=Spotfire.FormHelper.extractValues("promptForm");
};var onNextClick=function(){if(clientValidation){extractFormValues();Prompt.validateAndMoveNextWizardPage();
}else{Prompt.nextWizardPage();}return true;};var onBackClick=function(){if(clientValidation){extractFormValues();
}Prompt.previousWizardPage();};var onOkClick=function(){if(clientValidation){extractFormValues();}Prompt.confirmPrompt();
return true;};var onSkipClick=function(){if(clientValidation){extractFormValues();}Prompt.validOkOrSkipped();
return true;};if(buttons.ok||buttons.finish){Prompt.clickOk=onOkClick;}var items=[];if(buttons.back){items.push({text:Spotfire.Localization.resources.Back,click:onBackClick});
}if(buttons.next){items.push({text:Spotfire.Localization.resources.Next,isDefault:true,click:onNextClick});
}if(buttons.ok){items.push({text:Spotfire.Localization.resources.Ok,isDefault:!buttons.Finish&&!buttons.next,click:onOkClick});
}if(buttons.skip){items.push({text:buttons.skipButtonText,isDefault:false,click:onSkipClick});}if(buttons.finish){items.push({text:Spotfire.Localization.resources.Finish,click:onOkClick,isDefault:!buttons.next});
}if(!buttons.hasOwnProperty("nocancel")||buttons.nocancel!==true){items.push({text:Spotfire.Localization.resources.Cancel,click:Prompt.cancelPrompt,isCancel:true});
}var hasDefault=_.any(items,function(x){return true===x.isDefault;});$(".promptingPopup").toggleClass("sf-has-default-button",hasDefault).dialog("option",{buttons:items,resizeStop:Prompt.resize});
};Prompt.resize=function(width,height){var $popup=$(".promptingPopup");if($popup.length>0){var modalDialog=$popup.data("ModalDialog");
if(modalDialog){var updateArgs={width:width,height:height};modalDialog.update(updateArgs);}}};Prompt.fillHeight=function(){var $popup=$(".promptingPopup");
$popup.find(".promptContentPanel, #promptForm").css("height","100%");var modalDialog=$popup.data("ModalDialog");
if(modalDialog){modalDialog.update("setAutoScroll",false);}Prompt.onResize();};Prompt.setEnableSelection=function(enableSelection){var $popup=$(".promptingPopup");
$popup.toggleClass("sf-enable-selection",enableSelection);};Prompt.setValid=function(){Prompt._clientValidationOk=true;
Prompt._errorMessage="";};Prompt.setInvalid=function(errorMessage){Prompt._clientValidationOk=false;Prompt.setErrorMessage(errorMessage);
};Prompt.setErrorMessage=function(errorMessage){Prompt._errorMessage=errorMessage;var popup=$(".promptingPopup");
$(".promptErrorImage",popup).remove();var errorImage=$("<img src='Images/Prompt/Exclamation.gif'/>");
errorImage.addClass("promptErrorImage");errorImage.css({position:"absolute",top:"5px",right:"5px",width:"18px",height:"16px",border:"0px"});
errorImage.attr("alt",Prompt._errorMessage);errorImage.attr("title",Prompt._errorMessage);$(".promptContentPanel",popup).append(errorImage);
};Prompt.closePopupPrompt=function(){if(Prompt.interval){window.clearInterval(Prompt.interval);Prompt.interval=null;
}Prompt.inProgress=false;Spotfire.LightBox.makeVisible();$(".promptingPopup").dialog("close");Prompt.resetCallbacks();
};Prompt.cancelPrompt=function(){Prompt.onPromptCanceled();Ajax.cancelOperation();Prompt.resetCallbacks();
};Prompt.promptFunctionCall=function(functionName,args,callback){var serializedArguments=JSON.stringify(args);
Spotfire.Dxp.Web.Forms.AjaxService.PromptFunctionCall(Ajax.DocumentId,functionName,serializedArguments,callback,Prompt.communicationError);
};Prompt.validOkOrSkipped=function(){var serializedPromptModel=JSON.stringify(Prompt.promptModel);var callback=function(){Prompt.controlsEnabled=true;
Prompt.closePopupPrompt();Ajax.setState(Ajax.popupPollState);Ajax.poll();};Spotfire.Dxp.Web.Forms.AjaxService.ConfirmPrompt(Ajax.DocumentId,serializedPromptModel,callback,Prompt.communicationError);
Prompt.resetCallbacks();};Prompt.confirmPrompt=function(){Prompt._clientValidationOk=true;Prompt.onClientValidate();
if(Prompt._clientValidationOk){if(Prompt.controlsEnabled){Prompt.controlsEnabled=false;}else{return;}Prompt.onWizardAdvanced(Prompt.promptModel);
Prompt.onPromptConfirmed(Prompt.promptModel);var serializedPromptModel=JSON.stringify(Prompt.promptModel);
var callback=function(result){if(result.IsValid){Prompt.validOkOrSkipped();}else{Prompt.controlsEnabled=true;
Prompt.setErrorMessage(result.ErrorMessage);}};Spotfire.Dxp.Web.Forms.AjaxService.ValidatePrompt(Ajax.DocumentId,serializedPromptModel,callback,Prompt.communicationError);
}};Prompt.validateAndMoveNextWizardPage=function(){if(Prompt.controlsEnabled){Prompt.controlsEnabled=false;
}else{return;}var serializedPromptModel=JSON.stringify(Prompt.promptModel);var callback=function(result){Prompt.controlsEnabled=true;
if(result.IsValid){Prompt.setValid();Prompt.nextWizardPage();}else{Prompt.setInvalid(result.ErrorMessage);
}};Spotfire.Dxp.Web.Forms.AjaxService.ValidatePrompt(Ajax.DocumentId,serializedPromptModel,callback,Prompt.communicationError);
};Prompt.nextWizardPage=function(){Prompt._clientValidationOk=true;Prompt.onClientValidate();if(Prompt._clientValidationOk){if(Prompt.controlsEnabled){Prompt.controlsEnabled=false;
}else{return;}Prompt.onWizardAdvanced(Prompt.promptModel);var serializedPromptModel=JSON.stringify(Prompt.promptModel);
Spotfire.Dxp.Web.Forms.AjaxService.NextWizardPage(Ajax.DocumentId,serializedPromptModel,Prompt.wizardPromptPostCallback,Prompt.communicationError);
Prompt.resetCallbacks();}};Prompt.previousWizardPage=function(){if(Prompt.controlsEnabled){Prompt.controlsEnabled=false;
}else{return;}Prompt.onWizardAdvanced(Prompt.promptModel);var serializedPromptModel=JSON.stringify(Prompt.promptModel);
Spotfire.Dxp.Web.Forms.AjaxService.PreviousWizardPage(Ajax.DocumentId,serializedPromptModel,Prompt.wizardPromptPostCallback,Prompt.communicationError);
Prompt.resetCallbacks();};Prompt.wizardPromptPostCallback=function(){Prompt.controlsEnabled=true;Prompt.setContents();
Ajax.setState(Ajax.popupPollState);Ajax.poll();};Prompt.communicationError=function(error,retryInterval,functionName){if(Spotfire.connectionLost()){Prompt.cancelPrompt();
return;}var heading=(error.search("Status: 401 Unauthorized")>0)?"Session was logged out.":"Communication error in "+functionName;
Ajax.redirectToErrorPage(heading,error);};Prompt.exists=function(){return $(".promptingPopup").size()>0;
};Prompt.availableSize=function(){return{width:$(".promptingPopup").width()-5,height:$(".promptingPopup").height()-5};
};});$(function(){Spotfire.registerNameSpace("Prompt",function(){return{create:function(viewId){return{modify:function(method,args){Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,method,args);
},read:function(method,args,callback){Spotfire.Dxp.Web.Forms.AjaxService.Read(viewId,method,args,callback);
},confirm:function(){if(Spotfire.isProfessional()){this.modify("CloseDialog","OK");}else{Prompt.confirmPrompt();
}},cancel:function(){if(Spotfire.isProfessional()){this.modify("CloseDialog","Cancel");}else{Prompt.cancelPrompt();
}},resize:function(width,height){Prompt.resize(width,height);},setEnableSelection:function(enableSelection){Prompt.setEnableSelection(enableSelection);
},setButtons:function(buttons,globalHandlerName){if(Spotfire.isProfessional()){this.modify("SetDialogButtons",JSON.stringify({buttons:buttons,handlerName:globalHandlerName}));
}else{var modalDialog=$(".promptingPopup").data("ModalDialog");if(modalDialog){var clickHandler=Spotfire.evaluate(globalHandlerName);
if(typeof clickHandler!=="function"){throw'"'+globalHandlerName+'" is not a function.';}var dialogButtons=_.map(buttons,function(b){return{text:b.text,disabled:b.disabled,isDefault:b.isDefault,isCancel:b.isCancel,click:function(){clickHandler(viewId,b.actionName);
return true;}};});modalDialog.update("buttons",dialogButtons);}}}};},init:function(viewId,dialogType){var $view=$("#"+viewId);
$view.css("display","block");var setSize=function($elem){$elem.css({width:"100%",height:"100%"});};var $parent=$view.closest(".sf-element-modal-dialog");
var isModalDialog=$parent.length>0;if(!isModalDialog){$parent=$view.parent();$parent.css("overflow","hidden");
setSize($parent);$view.addClass("sf-element-modal-dialog-body");$parent.addClass("sf-element-modal-dialog sf-forms-dialog").css("overflow","hidden");
var dialogTypeLower=dialogType.toLowerCase();if(dialogTypeLower!=="default"){$parent.addClass("sfpc-"+dialogTypeLower);
}$(window).on("resize",function(){$parent.trigger("sf-resize");});$(window).on("keydown",function(e){if(e.which===Keys.ESCAPE){Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,"CancelCommand","");
}else{if(e.which===Keys.RETURN){if($(document.activeElement).closest(".sf-suppress-forms-accept-command").length===0){Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,"AcceptCommand","");
}}}});}else{setSize($parent.find(".promptContentPanel"));}setSize($view);$parent.on("sf-resize",function(e){if($(e.target).is($view)||$.contains($view.get(0),e.target)){return;
}$view.trigger("sf-resize");});},suppressFormsAcceptCommandIfFocused:function($target){$target.addClass("sf-suppress-forms-accept-command");
}};}());});var Spotfire;if(!Spotfire){Spotfire=(function(){var clientType=null;var isDebugging=null;var loginPage=null;
var isCloud=false;var isAuthorMode=false;var reloadTimer;var useTransitions=true;var shutdown=false;return{shutdown:function(value){if(typeof value==="boolean"){shutdown=value;
}return shutdown;},isDebugging:function(){return isDebugging===true;},isCloud:function(){return isCloud===true;
},setCloud:function(value){isCloud=value;},isAuthorMode:function(){return isAuthorMode===true;},setAuthorMode:function(value){isAuthorMode=value;
},enableDebugging:function(value){if(isDebugging!==null){throw"Attempt to enable debugging twice";}isDebugging=value===true;
},PROFESSIONAL:1,WEBPLAYER:2,handleAbsoluteSessionTimeouts:false,setLoginPage:function(url){loginPage=url;
},getLoginPage:function(){return loginPage;},isWebPlayer:function(){return clientType===this.WEBPLAYER;
},isProfessional:function(){return clientType===this.PROFESSIONAL;},setClientType:function(type){if(clientType!==null){throw"Attempt to set client type twice";
}if(type!==this.PROFESSIONAL&&type!==this.WEBPLAYER){throw"Invalid client type";}clientType=type;},registerNameSpace:function(ns,obj){var parent=this,segments=ns.split("."),i,propertyName;
for(i=0;i<segments.length;i++){propertyName=segments[i];if(!parent.hasOwnProperty(propertyName)){parent[propertyName]={};
}parent=parent[propertyName];}if(typeof obj==="object"){$.extend(parent,obj);}},unwrapException:function(e){var lines=[];
lines.push("Type: "+e.name);lines.push("Message: "+e.message);var stack=e.stack||e.stacktrace;if(stack){lines.push("Stacktrace: "+stack);
}return lines.join("\r\n");},evaluate:function(code,debug){var result;try{result=window.eval(code);}catch(e){if(debug){this.log(this.unwrapException(e)+" in '"+code+"'");
}throw e;}return result;},log:function(args){if(!isDebugging){return;}var usePageBus=this.isProfessional();
var consoleLog=function(str){var console=window.console;if(console){console.log(str);}if(usePageBus){Spotfire.PageBus.publish("spotfire.console.log",str);
}};if(args===undefined){consoleLog("undefined");}else{if(args===null){consoleLog("null");}else{if(typeof args==="function"){this.log(args());
}else{consoleLog(args.toString());}}}},svgCache:{},getSvg:function(url,success){url=url.toLowerCase();
var cacheEntry=this.svgCache[url];if(cacheEntry===undefined||cacheEntry===null){var pending=[];pending.push(success);
cacheEntry={pending:pending};this.svgCache[url]=cacheEntry;var callback=function(xml){var $svg=$(xml).find("svg").removeAttr("id");
if($svg.attr("xmlns")===undefined){Spotfire.log(url+" missing xmlns attribute.");return;}$svg=$(document.importNode($svg.get(0),true));
cacheEntry.result=$svg;delete cacheEntry.pending;$.each(pending,function(){this($svg.clone());});};$.get(url,null,callback,"xml");
return;}if(cacheEntry.result===undefined){if(cacheEntry.pending===undefined){throw"Inconsistent SVG cache state.";
}cacheEntry.pending.push(success);}else{if(!(cacheEntry.result instanceof jQuery)){cacheEntry.result=$(cacheEntry.result);
}success(cacheEntry.result.clone());}},htmlEncode:function(str){return $("<div/>").text(str).html();},newFakeGuid:function(){var s=function(len){var x=Math.pow(2,4*len);
return Math.floor((Math.random()*x)+x).toString(16).substring(1);};return s(8)+"-"+s(4)+"-"+s(4)+"-"+s(4)+"-"+s(12);
},connectionLost:function(){return $("#connectionLostOverlay").is(":visible");},PageBus:{publish:function(subject,data,viewId){if(viewId!==undefined){data.viewId=viewId;
}window.PageBus.publish(subject,JSON.stringify(data));},subscribe:function(subject,onMessage){var callback=function(subj,msg){onMessage(subj,msg);
};window.PageBus.subscribe(subject,null,callback,null);}},replaceUrl:function(url){if(url){$(window).off("beforeunload.spotfire");
window.location.replace(url);}},ensureString:function(args){return typeof args==="string"?args:(args!==null?JSON.stringify(args):null);
},reloadPage:function(){if(reloadTimer){return;}var reloadInterval=0;var initialInterval=300;var maxInterval=4800;
try{var lastReload=parseInt(window.sessionStorage.getItem("lastReload")||0,10);var lastReloadInterval=parseInt(window.sessionStorage.getItem("reloadInterval")||reloadInterval,10);
if(lastReload>(new Date().getTime()-10000)){reloadInterval=Math.min(maxInterval,(lastReloadInterval*2)||initialInterval);
}}catch(e){reloadInterval=initialInterval*4;}reloadTimer=window.setTimeout(function(){try{window.sessionStorage.setItem("lastReload",new Date().getTime());
window.sessionStorage.setItem("reloadInterval",reloadInterval);}catch(ignore){}$(window).off("beforeunload.spotfire");
window.location.replace(window.location.href.split("#")[0]);},reloadInterval);},capabilities:{supportsDropShadow:function(){return clientType===Spotfire.WEBPLAYER||(window.SpotfireCef!==undefined&&window.SpotfireCef.windowed);
},supportsTouch:function(){try{document.createEvent("TouchEvent");}catch(e){return false;}return navigator.userAgent.match(/(iphone|ipod|ipad|android)/gi)?true:false;
}},useTransitions:function(){return useTransitions;},disableTransitions:function(){useTransitions=false;
}};}());}$(function(){Spotfire.Touch.setupCustomEvents(Spotfire.capabilities.supportsTouch());$(window).on("unload",function(){Spotfire.shutdown(true);
});var formatXmlHttpRequestError=function(jqXhr){return"XmlHttpRequest failed.\nStatus: "+jqXhr.status+" "+jqXhr.statusText+"\n\nResponse:\n"+jqXhr.responseText;
};var logError=function(str){if(Spotfire.shutdown()){return;}Spotfire.WebAnalysis.notifyError("Operation failed",str);
if(Spotfire.isDebugging()){throw str;}if(Spotfire.isProfessional()){Spotfire.PageBus.publish("spotfire.log.error",str);
}};var onError=function(jqXhr,textStatus,errorThrown){logError(textStatus+" "+errorThrown+"\n\n"+formatXmlHttpRequestError(jqXhr));
};var onBeforeSend=function(jqXhr,settings){var getCookie=function(name){var cookieValue=null;if(document.cookie&&document.cookie!==""){var cookies=document.cookie.split(";");
var i,cookie;for(i=0;i<cookies.length;i++){cookie=jQuery.trim(cookies[i]);if(cookie.substring(0,name.length+1)===(name+"=")){cookieValue=decodeURIComponent(cookie.substring(name.length+1));
break;}}}return cookieValue;};if(!settings.crossDomain){var xsrfToken=getCookie("XSRF-TOKEN");if(xsrfToken){jqXhr.setRequestHeader("X-XSRF-TOKEN",xsrfToken);
}}};var get401RedirectUrl=function(location){var relativeUrl=location.pathname+location.search+location.hash;
var formEncodedTargetUrl=encodeURIComponent(relativeUrl).replace("%20","+").replace(/[!'()*]/g,function(c){return"%"+c.charCodeAt(0).toString(16);
});var mashupParam=Spotfire.Web.isMashupContext?"&mashup=true":"";return Spotfire.getLoginPage()+"?targetUrl="+formEncodedTargetUrl+mashupParam;
};var handleAbsoluteSessionTimeouts=function(jqXhr){if(Spotfire.handleAbsoluteSessionTimeouts&&jqXhr.status===401){Ajax.onLoggedOut();
$(window).off("beforeunload.spotfire");window.location.href=get401RedirectUrl(window.location);return true;
}if(Spotfire.handleAbsoluteSessionTimeouts&&jqXhr.status===410){if(!Spotfire.shutdown()){var r=null;try{r=JSON.parse(jqXhr.responseText);
}catch(ignore){}var handler=Spotfire.Framework.onServerError;if(r===null||r===undefined||r.Error===null||r.ClosedReason===null||r.ErrorId===null){handler(null,"UserLoggedOut",null);
}else{handler(r.Error,r.ClosedReason,r.ErrorId);}}return true;}return false;};var hideConnectionLostOverlay=function(){if(Spotfire.connectionLost()){$("#connectionLostOverlay").remove();
}};var showConnectionLostOverlay=function(){if($("#connectionLostOverlay").is(":visible")){return;}var $overlay=$("<div />");
$overlay.css({position:"absolute",left:0,top:0,right:0,bottom:0,"background-color":"#fff",opacity:0,"z-index":10000}).sfFlex({container:"horizontal","justify-content":"center",fill:true});
var $progress=Spotfire.Flex.item({container:"vertical","justify-content":"center","align-items":"center",fill:true}).appendTo($overlay);
var $progressImage=$("<div/>").css({"margin-bottom":"10px",color:"#26a2ed"}).addClass("sf-element sf-element-busy-indicator sf-svg-loader-30x30").appendTo($progress);
Spotfire.getSvg("Images/Progress/CircularProgressAnimation.svg",function($svg){$progressImage.append($svg);
});$("<div />").css("white-space","pre").text(Spotfire.Localization.resources.ErrorDialog_ConnectionLost).appendTo($progress);
$overlay.attr("id","connectionLostOverlay");$overlay.appendTo($(document.body));$overlay.fadeTo(500,0.75);
};var tssFormattedErrorHandler=function(jqXhr,error){if(!handleAbsoluteSessionTimeouts(jqXhr)){if(jqXhr.readyState===0){showConnectionLostOverlay();
}error(formatXmlHttpRequestError(jqXhr));}};var tssErrorHandler=function(jqXhr,textStatus,errorThrown,error){if(!handleAbsoluteSessionTimeouts(jqXhr)){error(jqXhr,textStatus,errorThrown);
}};$.ajaxSetup({type:"POST",contentType:"application/json; charset=utf-8",dataType:"json",error:function(jqXhr,textStatus,errorThrown){tssErrorHandler(jqXhr,textStatus,errorThrown,onError);
},beforeSend:onBeforeSend});$(document).ajaxSuccess(hideConnectionLostOverlay);var formatDate=function(date,callback){if(typeof date!=="object"||date===null){throw"Attempt to format non-date value.";
}var data={args:date.getTime()};var url="AjaxService.asmx/FormatDate";if(Spotfire.isWebPlayer()){url=url+"?waid="+Ajax.DocumentId;
}$.ajax({url:url,data:JSON.stringify(data),success:function(result){callback(result);}});};var parseDate=function(args,callback){if(typeof args!=="string"){throw"Attempt to parse non-string value.";
}var success=function(response){try{var s=response;var ms=parseInt(s.substring(s.indexOf("(")+1,s.indexOf(")")),10);
callback(new Date(ms));}catch(ex){callback(null);}};var data={args:args};var url="AjaxService.asmx/ParseDate";
if(Spotfire.isWebPlayer()){url=url+"?waid="+Ajax.DocumentId;}$.ajax({url:url,data:JSON.stringify(data),success:success});
};var readCallbackId=0;function ReadCallbackValidity(viewId){var selector="body [viewId="+viewId+"]";
var callbackId="cb-"+(readCallbackId++);var $view=$(selector);var hasDomElement=$view.length===1;if(hasDomElement){$view.data(callbackId,true);
var idAttribute=$view.attr("id");if(idAttribute!==undefined){selector="body #"+idAttribute;}}return function(){if(hasDomElement){$view=$(selector);
if($view.length===0){return false;}if(!$view.data(callbackId)){return false;}$view.removeData(callbackId);
}return true;};}var webViewRead=function(viewId,method,args,callback,errorCallback){var isValid=new ReadCallbackValidity(viewId);
var invokeCallback=function(val){if(!isValid()){return;}if(val!==null){if(typeof callback==="function"){callback(val);
}}else{if(typeof errorCallback==="function"){errorCallback();}}};var success=function(value){try{if(Spotfire.isWebPlayer()&&value){invokeCallback(value.result);
if(value.status===0&&Spotfire.WebAnalysis.isReady()){Ajax.poll();}return;}invokeCallback(value);}catch(e){logError("Read callback '"+method+"' failed.\r\n"+Spotfire.unwrapException(e));
}};var error=function(jqXhr,textStatus,errorThrown){var expectationFailedStatusCode=417;if(jqXhr.status!==expectationFailedStatusCode){onError(jqXhr,textStatus,errorThrown);
}};var wrappedError=function(jqXhr,textStatus,errorThrown){if(typeof errorCallback==="function"){errorCallback();
}tssErrorHandler(jqXhr,textStatus,errorThrown,error);};var data={viewId:viewId,method:method,args:Spotfire.ensureString(args)};
var url="AjaxService.asmx/Read";if(Spotfire.isWebPlayer()){url="WebViewRead.ashx?waid="+Ajax.DocumentId+"&wavid="+Ajax.DocumentViewId;
}$.ajax({url:url,data:JSON.stringify(data),success:success,error:wrappedError});};var webViewModify=function(viewId,method,args,stickyGuid){var data={viewId:viewId,method:method,args:Spotfire.ensureString(args),stickyGuid:stickyGuid};
if(Spotfire.isWebPlayer()||Spotfire.WebAnalysis.handleWebViewModify()){Ajax.enqueueRequest("WVM","",JSON.stringify(data));
}else{$.ajax({url:"AjaxService.asmx/Modify",data:JSON.stringify(data),success:$.noop});}};var request=function(waid,wavid,nodeId,requestId,callback,args,success,error){if(Spotfire.isProfessional()){throw"Request should not be called in Professional";
}var data={waid:waid,wavid:wavid,nodeId:nodeId,requestId:requestId,callback:callback,args:args};$.ajax({url:"AjaxService.asmx/Request?waid="+waid,data:JSON.stringify(data),success:function(response){success(response);
},error:function(jqXhr){tssFormattedErrorHandler(jqXhr,error);}});};var needsRefresh=function(waid,success,error){if(Spotfire.isProfessional()){throw"NeedsRefresh should not be called in Professional";
}var data={waid:waid,wavid:Ajax.DocumentViewId};$.ajax({url:"AjaxService.asmx/NeedsRefresh?waid="+waid+"&wavid="+Ajax.DocumentViewId,data:JSON.stringify(data),success:function(response){success(response);
},error:function(jqXhr){tssFormattedErrorHandler(jqXhr,error);}});};var cancelOperation=function(waid,success,error){var data={waid:waid,wavid:Ajax.DocumentViewId};
$.ajax({url:"AjaxService.asmx/CancelOperation?waid="+waid+"&wavid="+Ajax.DocumentViewId,data:JSON.stringify(data),success:success,error:function(jqXhr){tssFormattedErrorHandler(jqXhr,error);
}});};var close=function(waid,wavid,success,error){var data={waid:waid,wavid:wavid};$.ajax({url:"AjaxService.asmx/Close?waid="+waid+"&wavid="+wavid,data:JSON.stringify(data),success:success,error:function(jqXhr){tssFormattedErrorHandler(jqXhr,error);
}});};var logout=function(waid,success,error){$.ajax({url:"/spotfire/rest/security/logout",method:"GET",dataType:"text",success:success,error:function(jqXhr){tssFormattedErrorHandler(jqXhr,error);
}});};var confirmPrompt=function(waid,serializedPromptModel,success,error){var data={waid:waid,wavid:Ajax.DocumentViewId,serializedPromptModel:serializedPromptModel};
$.ajax({url:"AjaxService.asmx/ConfirmPrompt?waid="+waid+"&wavid="+Ajax.DocumentViewId,data:JSON.stringify(data),success:success,error:function(jqXhr){tssFormattedErrorHandler(jqXhr,error);
}});};var promptFunctionCall=function(waid,functionName,serializedArguments,success,error){var data={waid:waid,wavid:Ajax.DocumentViewId,functionName:functionName,args:serializedArguments};
$.ajax({url:"AjaxService.asmx/PromptFunctionCall?waid="+waid+"&wavid="+Ajax.DocumentViewId,data:JSON.stringify(data),success:function(response){success(response);
},error:function(jqXhr){tssFormattedErrorHandler(jqXhr,error);}});};var validatePrompt=function(waid,serializedPromptModel,success,error){var data={waid:waid,wavid:Ajax.DocumentViewId,serializedPromptModel:serializedPromptModel};
$.ajax({url:"AjaxService.asmx/ValidatePrompt?waid="+waid+"&wavid="+Ajax.DocumentViewId,data:JSON.stringify(data),success:function(response){success(response);
},error:function(jqXhr){tssFormattedErrorHandler(jqXhr,error);}});};var nextWizardPage=function(waid,serializedPromptModel,success,error){var data={waid:waid,wavid:Ajax.DocumentViewId,serializedPromptModel:serializedPromptModel};
$.ajax({url:"AjaxService.asmx/NextWizardPage?waid="+waid+"&wavid="+Ajax.DocumentViewId,data:JSON.stringify(data),success:success,error:function(jqXhr){tssFormattedErrorHandler(jqXhr,error);
}});};var previousWizardPage=function(waid,serializedPromptModel,success,error){var data={waid:waid,wavid:Ajax.DocumentViewId,serializedPromptModel:serializedPromptModel};
$.ajax({url:"AjaxService.asmx/PreviousWizardPage?waid="+waid+"&wavid="+Ajax.DocumentViewId,data:JSON.stringify(data),success:success,error:function(jqXhr){tssFormattedErrorHandler(jqXhr,error);
}});};Spotfire.registerNameSpace("Dxp.Web.Forms.AjaxService",{FormatDate:formatDate,ParseDate:parseDate,Read:webViewRead,Modify:webViewModify,Request:request,NeedsRefresh:needsRefresh,CancelOperation:cancelOperation,Close:close,Logout:logout,ConfirmPrompt:confirmPrompt,PromptFunctionCall:promptFunctionCall,ValidatePrompt:validatePrompt,NextWizardPage:nextWizardPage,PreviousWizardPage:previousWizardPage});
Spotfire.registerNameSpace("WebView",(function(){var getAttribute=function(id,attribute){return $("#"+id).closest("["+attribute+"]").attr(attribute);
};return{modifyControl:function(id,args,clientGeneration,stickyGuid){var viewId=getAttribute(id,"viewId");
if(viewId){var value=JSON.stringify({id:id,clientGeneration:clientGeneration||0,args:typeof args!=="string"?JSON.stringify(args):args});
webViewModify(viewId,"ModifyControl",value,stickyGuid);}},readControl:function(id,args,callback,nullCallback){var viewId=getAttribute(id,"viewId");
if(viewId){var value=JSON.stringify({id:id,args:typeof args!=="string"?JSON.stringify(args):args});webViewRead(viewId,"ReadControl",value,callback,nullCallback);
}}};}()));});$(function(){var error=function(str){if(console!==undefined&&console.error!==undefined){console.error(str);
}else{window.alert(str);}};function WebSocketProxy(){var socket=null;var opened=false;var close=function(){try{if(socket!==null){socket.close();
}}catch(ex){error("Failed to close WebSocket: "+ex);}};var handlers={};var registerHandler=function(name,handler){handlers[name]=handler;
};var initialize=function(url,onOpen,onError){var fatalError=onError||error;if(window.WebSocket===undefined){fatalError("Failed to initialize WebSocket communication. Make sure you are running Internet Explorer 10 or later.");
return;}try{socket=new WebSocket(url);}catch(ex){fatalError("Failed to initialize WebSocket: "+ex);return;
}socket.onopen=function(){opened=true;onOpen();};socket.onmessage=function(e){var msg=e.data;var array=[];
var pos=0;var delimiterIndex,length,i;try{for(i=0;i<3;i++){delimiterIndex=msg.indexOf(";",pos);length=parseInt(msg.substr(pos,delimiterIndex),10);
pos=delimiterIndex+1;array.push(msg.substr(pos,length));pos=pos+length+1;}var handler=handlers[array[0]];
if(typeof handler==="function"){handler(JSON.parse(array[1]),array[2]);}}catch(mex){error("Error when processing WebSocket message: "+mex);
}};socket.onerror=function(){fatalError("WebSocket connection to '"+url+"' failed.\r\nEnsure you do not have an interfering proxy or similar.");
socket=null;};socket.onclose=function(){opened=false;socket=null;};$(window).on("unload",close);};var send=function(data){if(socket===null){return;
}if(!opened){var onTimeout=function(){send(data);};window.setTimeout(onTimeout,100);return;}socket.send(JSON.stringify(data));
};return{initialize:initialize,initialized:function(){return socket!==null&&opened;},send:send,registerHandler:registerHandler,close:close};
}Spotfire.registerNameSpace("WebSocket",{createProxy:function(){return new WebSocketProxy();}});});(function(mod){if(typeof exports=="object"&&typeof module=="object"){mod(require("../../lib/codemirror"));
}else{if(typeof define=="function"&&define.amd){define(["../../lib/codemirror"],mod);}else{mod(CodeMirror);
}}})(function(CodeMirror){var defaults={pairs:"()[]{}''\"\"",triples:"",explode:"[]{}"};var Pos=CodeMirror.Pos;
CodeMirror.defineOption("autoCloseBrackets",false,function(cm,val,old){if(old&&old!=CodeMirror.Init){cm.removeKeyMap(keyMap);
cm.state.closeBrackets=null;}if(val){cm.state.closeBrackets=val;cm.addKeyMap(keyMap);}});function getOption(conf,name){if(name=="pairs"&&typeof conf=="string"){return conf;
}if(typeof conf=="object"&&conf[name]!=null){return conf[name];}return defaults[name];}var bind=defaults.pairs+"`";
var keyMap={Backspace:handleBackspace,Enter:handleEnter};for(var i=0;i<bind.length;i++){keyMap["'"+bind.charAt(i)+"'"]=handler(bind.charAt(i));
}function handler(ch){return function(cm){return handleChar(cm,ch);};}function getConfig(cm){var deflt=cm.state.closeBrackets;
if(!deflt){return null;}var mode=cm.getModeAt(cm.getCursor());return mode.closeBrackets||deflt;}function handleBackspace(cm){var conf=getConfig(cm);
if(!conf||cm.getOption("disableInput")){return CodeMirror.Pass;}var pairs=getOption(conf,"pairs");var ranges=cm.listSelections();
for(var i=0;i<ranges.length;i++){if(!ranges[i].empty()){return CodeMirror.Pass;}var around=charsAround(cm,ranges[i].head);
if(!around||pairs.indexOf(around)%2!=0){return CodeMirror.Pass;}}for(var i=ranges.length-1;i>=0;i--){var cur=ranges[i].head;
cm.replaceRange("",Pos(cur.line,cur.ch-1),Pos(cur.line,cur.ch+1),"+delete");}}function handleEnter(cm){var conf=getConfig(cm);
var explode=conf&&getOption(conf,"explode");if(!explode||cm.getOption("disableInput")){return CodeMirror.Pass;
}var ranges=cm.listSelections();for(var i=0;i<ranges.length;i++){if(!ranges[i].empty()){return CodeMirror.Pass;
}var around=charsAround(cm,ranges[i].head);if(!around||explode.indexOf(around)%2!=0){return CodeMirror.Pass;
}}cm.operation(function(){cm.replaceSelection("\n\n",null);cm.execCommand("goCharLeft");ranges=cm.listSelections();
for(var i=0;i<ranges.length;i++){var line=ranges[i].head.line;cm.indentLine(line,null,true);cm.indentLine(line+1,null,true);
}});}function contractSelection(sel){var inverted=CodeMirror.cmpPos(sel.anchor,sel.head)>0;return{anchor:new Pos(sel.anchor.line,sel.anchor.ch+(inverted?-1:1)),head:new Pos(sel.head.line,sel.head.ch+(inverted?1:-1))};
}function handleChar(cm,ch){var conf=getConfig(cm);if(!conf||cm.getOption("disableInput")){return CodeMirror.Pass;
}var pairs=getOption(conf,"pairs");var pos=pairs.indexOf(ch);if(pos==-1){return CodeMirror.Pass;}var triples=getOption(conf,"triples");
var identical=pairs.charAt(pos+1)==ch;var ranges=cm.listSelections();var opening=pos%2==0;var type;for(var i=0;
i<ranges.length;i++){var range=ranges[i],cur=range.head,curType;var next=cm.getRange(cur,Pos(cur.line,cur.ch+1));
if(opening&&!range.empty()){curType="surround";}else{if((identical||!opening)&&next==ch){if(triples.indexOf(ch)>=0&&cm.getRange(cur,Pos(cur.line,cur.ch+3))==ch+ch+ch){curType="skipThree";
}else{curType="skip";}}else{if(identical&&cur.ch>1&&triples.indexOf(ch)>=0&&cm.getRange(Pos(cur.line,cur.ch-2),cur)==ch+ch&&(cur.ch<=2||cm.getRange(Pos(cur.line,cur.ch-3),Pos(cur.line,cur.ch-2))!=ch)){curType="addFour";
}else{if(identical){if(!CodeMirror.isWordChar(next)&&enteringString(cm,cur,ch)){curType="both";}else{return CodeMirror.Pass;
}}else{if(opening&&(cm.getLine(cur.line).length==cur.ch||isClosingBracket(next,pairs)||/\s/.test(next))){curType="both";
}else{return CodeMirror.Pass;}}}}}if(!type){type=curType;}else{if(type!=curType){return CodeMirror.Pass;
}}}var left=pos%2?pairs.charAt(pos-1):ch;var right=pos%2?ch:pairs.charAt(pos+1);cm.operation(function(){if(type=="skip"){cm.execCommand("goCharRight");
}else{if(type=="skipThree"){for(var i=0;i<3;i++){cm.execCommand("goCharRight");}}else{if(type=="surround"){var sels=cm.getSelections();
for(var i=0;i<sels.length;i++){sels[i]=left+sels[i]+right;}cm.replaceSelections(sels,"around");sels=cm.listSelections().slice();
for(var i=0;i<sels.length;i++){sels[i]=contractSelection(sels[i]);}cm.setSelections(sels);}else{if(type=="both"){cm.replaceSelection(left+right,null);
cm.triggerElectric(left+right);cm.execCommand("goCharLeft");}else{if(type=="addFour"){cm.replaceSelection(left+left+left+left,"before");
cm.execCommand("goCharRight");}}}}}});}function isClosingBracket(ch,pairs){var pos=pairs.lastIndexOf(ch);
return pos>-1&&pos%2==1;}function charsAround(cm,pos){var str=cm.getRange(Pos(pos.line,pos.ch-1),Pos(pos.line,pos.ch+1));
return str.length==2?str:null;}function enteringString(cm,pos,ch){var line=cm.getLine(pos.line);var token=cm.getTokenAt(pos);
if(/\bstring2?\b/.test(token.type)){return false;}var stream=new CodeMirror.StringStream(line.slice(0,pos.ch)+ch+line.slice(pos.ch),4);
stream.pos=stream.start=token.start;for(;;){var type1=cm.getMode().token(stream,token.state);if(stream.pos>=pos.ch+1){return/\bstring2?\b/.test(type1);
}stream.start=stream.pos;}}});!function(){function n(n){return n&&(n.ownerDocument||n.document||n).documentElement;
}function t(n){return n&&(n.ownerDocument&&n.ownerDocument.defaultView||n.document&&n||n.defaultView);
}function e(n,t){return t>n?-1:n>t?1:n>=t?0:NaN;}function r(n){return null===n?NaN:+n;}function u(n){return !isNaN(n);
}function i(n){return{left:function(t,e,r,u){for(arguments.length<3&&(r=0),arguments.length<4&&(u=t.length);
u>r;){var i=r+u>>>1;n(t[i],e)<0?r=i+1:u=i;}return r;},right:function(t,e,r,u){for(arguments.length<3&&(r=0),arguments.length<4&&(u=t.length);
u>r;){var i=r+u>>>1;n(t[i],e)>0?u=i:r=i+1;}return r;}};}function a(n){return n.length;}function o(n){for(var t=1;
n*t%1;){t*=10;}return t;}function l(n,t){for(var e in t){Object.defineProperty(n.prototype,e,{value:t[e],enumerable:!1});
}}function c(){this._=Object.create(null);}function s(n){return(n+="")===xa||n[0]===ba?ba+n:n;}function f(n){return(n+="")[0]===ba?n.slice(1):n;
}function h(n){return s(n) in this._;}function g(n){return(n=s(n)) in this._&&delete this._[n];}function p(){var n=[];
for(var t in this._){n.push(f(t));}return n;}function v(){var n=0;for(var t in this._){++n;}return n;
}function d(){for(var n in this._){return !1;}return !0;}function m(){this._=Object.create(null);}function y(n){return n;
}function M(n,t,e){return function(){var r=e.apply(t,arguments);return r===t?n:r;};}function x(n,t){if(t in n){return t;
}t=t.charAt(0).toUpperCase()+t.slice(1);for(var e=0,r=_a.length;r>e;++e){var u=_a[e]+t;if(u in n){return u;
}}}function b(){}function _(){}function w(n){function t(){for(var t,r=e,u=-1,i=r.length;++u<i;){(t=r[u].on)&&t.apply(this,arguments);
}return n;}var e=[],r=new c;return t.on=function(t,u){var i,a=r.get(t);return arguments.length<2?a&&a.on:(a&&(a.on=null,e=e.slice(0,i=e.indexOf(a)).concat(e.slice(i+1)),r.remove(t)),u&&e.push(r.set(t,{on:u})),n);
},t;}function S(){oa.event.preventDefault();}function k(){for(var n,t=oa.event;n=t.sourceEvent;){t=n;
}return t;}function N(n){for(var t=new _,e=0,r=arguments.length;++e<r;){t[arguments[e]]=w(t);}return t.of=function(e,r){return function(u){try{var i=u.sourceEvent=oa.event;
u.target=n,oa.event=u,t[u.type].apply(e,r);}finally{oa.event=i;}};},t;}function E(n){return Sa(n,Aa),n;
}function A(n){return"function"==typeof n?n:function(){return ka(n,this);};}function C(n){return"function"==typeof n?n:function(){return Na(n,this);
};}function z(n,t){function e(){this.removeAttribute(n);}function r(){this.removeAttributeNS(n.space,n.local);
}function u(){this.setAttribute(n,t);}function i(){this.setAttributeNS(n.space,n.local,t);}function a(){var e=t.apply(this,arguments);
null==e?this.removeAttribute(n):this.setAttribute(n,e);}function o(){var e=t.apply(this,arguments);null==e?this.removeAttributeNS(n.space,n.local):this.setAttributeNS(n.space,n.local,e);
}return n=oa.ns.qualify(n),null==t?n.local?r:e:"function"==typeof t?n.local?o:a:n.local?i:u;}function L(n){return n.trim().replace(/\s+/g," ");
}function q(n){return new RegExp("(?:^|\\s+)"+oa.requote(n)+"(?:\\s+|$)","g");}function T(n){return(n+"").trim().split(/^|\s+/);
}function R(n,t){function e(){for(var e=-1;++e<u;){n[e](this,t);}}function r(){for(var e=-1,r=t.apply(this,arguments);
++e<u;){n[e](this,r);}}n=T(n).map(D);var u=n.length;return"function"==typeof t?r:e;}function D(n){var t=q(n);
return function(e,r){if(u=e.classList){return r?u.add(n):u.remove(n);}var u=e.getAttribute("class")||"";
r?(t.lastIndex=0,t.test(u)||e.setAttribute("class",L(u+" "+n))):e.setAttribute("class",L(u.replace(t," ")));
};}function P(n,t,e){function r(){this.style.removeProperty(n);}function u(){this.style.setProperty(n,t,e);
}function i(){var r=t.apply(this,arguments);null==r?this.style.removeProperty(n):this.style.setProperty(n,r,e);
}return null==t?r:"function"==typeof t?i:u;}function j(n,t){function e(){delete this[n];}function r(){this[n]=t;
}function u(){var e=t.apply(this,arguments);null==e?delete this[n]:this[n]=e;}return null==t?e:"function"==typeof t?u:r;
}function U(n){function t(){var t=this.ownerDocument,e=this.namespaceURI;return e?t.createElementNS(e,n):t.createElement(n);
}function e(){return this.ownerDocument.createElementNS(n.space,n.local);}return"function"==typeof n?n:(n=oa.ns.qualify(n)).local?e:t;
}function F(){var n=this.parentNode;n&&n.removeChild(this);}function H(n){return{__data__:n};}function O(n){return function(){return Ea(this,n);
};}function I(n){return arguments.length||(n=e),function(t,e){return t&&e?n(t.__data__,e.__data__):!t-!e;
};}function Y(n,t){for(var e=0,r=n.length;r>e;e++){for(var u,i=n[e],a=0,o=i.length;o>a;a++){(u=i[a])&&t(u,a,e);
}}return n;}function Z(n){return Sa(n,za),n;}function V(n){var t,e;return function(r,u,i){var a,o=n[i].update,l=o.length;
for(i!=e&&(e=i,t=0),u>=t&&(t=u+1);!(a=o[t])&&++t<l;){}return a;};}function X(n,t,e){function r(){var t=this[a];
t&&(this.removeEventListener(n,t,t.$),delete this[a]);}function u(){var u=l(t,ca(arguments));r.call(this),this.addEventListener(n,this[a]=u,u.$=e),u._=t;
}function i(){var t,e=new RegExp("^__on([^.]+)"+oa.requote(n)+"$");for(var r in this){if(t=r.match(e)){var u=this[r];
this.removeEventListener(t[1],u,u.$),delete this[r];}}}var a="__on"+n,o=n.indexOf("."),l=$;o>0&&(n=n.slice(0,o));
var c=La.get(n);return c&&(n=c,l=B),o?t?u:r:t?b:i;}function $(n,t){return function(e){var r=oa.event;
oa.event=e,t[0]=this.__data__;try{n.apply(this,t);}finally{oa.event=r;}};}function B(n,t){var e=$(n,t);
return function(n){var t=this,r=n.relatedTarget;r&&(r===t||8&r.compareDocumentPosition(t))||e.call(t,n);
};}function W(e){var r=".dragsuppress-"+ ++Ta,u="click"+r,i=oa.select(t(e)).on("touchmove"+r,S).on("dragstart"+r,S).on("selectstart"+r,S);
if(null==qa&&(qa="onselectstart" in e?!1:x(e.style,"userSelect")),qa){var a=n(e).style,o=a[qa];a[qa]="none";
}return function(n){if(i.on(r,null),qa&&(a[qa]=o),n){var t=function(){i.on(u,null);};i.on(u,function(){S(),t();
},!0),setTimeout(t,0);}};}function J(n,e){e.changedTouches&&(e=e.changedTouches[0]);var r=n.ownerSVGElement||n;
if(r.createSVGPoint){var u=r.createSVGPoint();if(0>Ra){var i=t(n);if(i.scrollX||i.scrollY){r=oa.select("body").append("svg").style({position:"absolute",top:0,left:0,margin:0,padding:0,border:"none"},"important");
var a=r[0][0].getScreenCTM();Ra=!(a.f||a.e),r.remove();}}return Ra?(u.x=e.pageX,u.y=e.pageY):(u.x=e.clientX,u.y=e.clientY),u=u.matrixTransform(n.getScreenCTM().inverse()),[u.x,u.y];
}var o=n.getBoundingClientRect();return[e.clientX-o.left-n.clientLeft,e.clientY-o.top-n.clientTop];}function G(){return oa.event.changedTouches[0].identifier;
}function K(n){return n>0?1:0>n?-1:0;}function Q(n,t,e){return(t[0]-n[0])*(e[1]-n[1])-(t[1]-n[1])*(e[0]-n[0]);
}function nn(n){return n>1?0:-1>n?ja:Math.acos(n);}function tn(n){return n>1?Ha:-1>n?-Ha:Math.asin(n);
}function en(n){return((n=Math.exp(n))-1/n)/2;}function rn(n){return((n=Math.exp(n))+1/n)/2;}function un(n){return((n=Math.exp(2*n))-1)/(n+1);
}function an(n){return(n=Math.sin(n/2))*n;}function on(){}function ln(n,t,e){return this instanceof ln?(this.h=+n,this.s=+t,void (this.l=+e)):arguments.length<2?n instanceof ln?new ln(n.h,n.s,n.l):_n(""+n,wn,ln):new ln(n,t,e);
}function cn(n,t,e){function r(n){return n>360?n-=360:0>n&&(n+=360),60>n?i+(a-i)*n/60:180>n?a:240>n?i+(a-i)*(240-n)/60:i;
}function u(n){return Math.round(255*r(n));}var i,a;return n=isNaN(n)?0:(n%=360)<0?n+360:n,t=isNaN(t)?0:0>t?0:t>1?1:t,e=0>e?0:e>1?1:e,a=0.5>=e?e*(1+t):e+t-e*t,i=2*e-a,new yn(u(n+120),u(n),u(n-120));
}function sn(n,t,e){return this instanceof sn?(this.h=+n,this.c=+t,void (this.l=+e)):arguments.length<2?n instanceof sn?new sn(n.h,n.c,n.l):n instanceof hn?pn(n.l,n.a,n.b):pn((n=Sn((n=oa.rgb(n)).r,n.g,n.b)).l,n.a,n.b):new sn(n,t,e);
}function fn(n,t,e){return isNaN(n)&&(n=0),isNaN(t)&&(t=0),new hn(e,Math.cos(n*=Oa)*t,Math.sin(n)*t);
}function hn(n,t,e){return this instanceof hn?(this.l=+n,this.a=+t,void (this.b=+e)):arguments.length<2?n instanceof hn?new hn(n.l,n.a,n.b):n instanceof sn?fn(n.h,n.c,n.l):Sn((n=yn(n)).r,n.g,n.b):new hn(n,t,e);
}function gn(n,t,e){var r=(n+16)/116,u=r+t/500,i=r-e/200;return u=vn(u)*Ka,r=vn(r)*Qa,i=vn(i)*no,new yn(mn(3.2404542*u-1.5371385*r-0.4985314*i),mn(-0.969266*u+1.8760108*r+0.041556*i),mn(0.0556434*u-0.2040259*r+1.0572252*i));
}function pn(n,t,e){return n>0?new sn(Math.atan2(e,t)*Ia,Math.sqrt(t*t+e*e),n):new sn(NaN,NaN,n);}function vn(n){return n>0.206893034?n*n*n:(n-4/29)/7.787037;
}function dn(n){return n>0.008856?Math.pow(n,1/3):7.787037*n+4/29;}function mn(n){return Math.round(255*(0.00304>=n?12.92*n:1.055*Math.pow(n,1/2.4)-0.055));
}function yn(n,t,e){return this instanceof yn?(this.r=~~n,this.g=~~t,void (this.b=~~e)):arguments.length<2?n instanceof yn?new yn(n.r,n.g,n.b):_n(""+n,yn,cn):new yn(n,t,e);
}function Mn(n){return new yn(n>>16,n>>8&255,255&n);}function xn(n){return Mn(n)+"";}function bn(n){return 16>n?"0"+Math.max(0,n).toString(16):Math.min(255,n).toString(16);
}function _n(n,t,e){var r,u,i,a=0,o=0,l=0;if(r=/([a-z]+)\((.*)\)/.exec(n=n.toLowerCase())){switch(u=r[2].split(","),r[1]){case"hsl":return e(parseFloat(u[0]),parseFloat(u[1])/100,parseFloat(u[2])/100);
case"rgb":return t(Nn(u[0]),Nn(u[1]),Nn(u[2]));}}return(i=ro.get(n))?t(i.r,i.g,i.b):(null==n||"#"!==n.charAt(0)||isNaN(i=parseInt(n.slice(1),16))||(4===n.length?(a=(3840&i)>>4,a=a>>4|a,o=240&i,o=o>>4|o,l=15&i,l=l<<4|l):7===n.length&&(a=(16711680&i)>>16,o=(65280&i)>>8,l=255&i)),t(a,o,l));
}function wn(n,t,e){var r,u,i=Math.min(n/=255,t/=255,e/=255),a=Math.max(n,t,e),o=a-i,l=(a+i)/2;return o?(u=0.5>l?o/(a+i):o/(2-a-i),r=n==a?(t-e)/o+(e>t?6:0):t==a?(e-n)/o+2:(n-t)/o+4,r*=60):(r=NaN,u=l>0&&1>l?0:r),new ln(r,u,l);
}function Sn(n,t,e){n=kn(n),t=kn(t),e=kn(e);var r=dn((0.4124564*n+0.3575761*t+0.1804375*e)/Ka),u=dn((0.2126729*n+0.7151522*t+0.072175*e)/Qa),i=dn((0.0193339*n+0.119192*t+0.9503041*e)/no);
return hn(116*u-16,500*(r-u),200*(u-i));}function kn(n){return(n/=255)<=0.04045?n/12.92:Math.pow((n+0.055)/1.055,2.4);
}function Nn(n){var t=parseFloat(n);return"%"===n.charAt(n.length-1)?Math.round(2.55*t):t;}function En(n){return"function"==typeof n?n:function(){return n;
};}function An(n){return function(t,e,r){return 2===arguments.length&&"function"==typeof e&&(r=e,e=null),Cn(t,e,n,r);
};}function Cn(n,t,e,r){function u(){var n,t=l.status;if(!t&&Ln(l)||t>=200&&300>t||304===t){try{n=e.call(i,l);
}catch(r){return void a.error.call(i,r);}a.load.call(i,n);}else{a.error.call(i,l);}}var i={},a=oa.dispatch("beforesend","progress","load","error"),o={},l=new XMLHttpRequest,c=null;
return !this.XDomainRequest||"withCredentials" in l||!/^(http(s)?:)?\/\//.test(n)||(l=new XDomainRequest),"onload" in l?l.onload=l.onerror=u:l.onreadystatechange=function(){l.readyState>3&&u();
},l.onprogress=function(n){var t=oa.event;oa.event=n;try{a.progress.call(i,l);}finally{oa.event=t;}},i.header=function(n,t){return n=(n+"").toLowerCase(),arguments.length<2?o[n]:(null==t?delete o[n]:o[n]=t+"",i);
},i.mimeType=function(n){return arguments.length?(t=null==n?null:n+"",i):t;},i.responseType=function(n){return arguments.length?(c=n,i):c;
},i.response=function(n){return e=n,i;},["get","post"].forEach(function(n){i[n]=function(){return i.send.apply(i,[n].concat(ca(arguments)));
};}),i.send=function(e,r,u){if(2===arguments.length&&"function"==typeof r&&(u=r,r=null),l.open(e,n,!0),null==t||"accept" in o||(o.accept=t+",*/*"),l.setRequestHeader){for(var s in o){l.setRequestHeader(s,o[s]);
}}return null!=t&&l.overrideMimeType&&l.overrideMimeType(t),null!=c&&(l.responseType=c),null!=u&&i.on("error",u).on("load",function(n){u(null,n);
}),a.beforesend.call(i,l),l.send(null==r?null:r),i;},i.abort=function(){return l.abort(),i;},oa.rebind(i,a,"on"),null==r?i:i.get(zn(r));
}function zn(n){return 1===n.length?function(t,e){n(null==t?e:null);}:n;}function Ln(n){var t=n.responseType;
return t&&"text"!==t?n.response:n.responseText;}function qn(n,t,e){var r=arguments.length;2>r&&(t=0),3>r&&(e=Date.now());
var u=e+t,i={c:n,t:u,n:null};return io?io.n=i:uo=i,io=i,ao||(oo=clearTimeout(oo),ao=1,lo(Tn)),i;}function Tn(){var n=Rn(),t=Dn()-n;
t>24?(isFinite(t)&&(clearTimeout(oo),oo=setTimeout(Tn,t)),ao=0):(ao=1,lo(Tn));}function Rn(){for(var n=Date.now(),t=uo;
t;){n>=t.t&&t.c(n-t.t)&&(t.c=null),t=t.n;}return n;}function Dn(){for(var n,t=uo,e=1/0;t;){t.c?(t.t<e&&(e=t.t),t=(n=t).n):t=n?n.n=t.n:uo=t.n;
}return io=n,e;}function Pn(n,t){return t-(n?Math.ceil(Math.log(n)/Math.LN10):1);}function jn(n,t){var e=Math.pow(10,3*Ma(8-t));
return{scale:t>8?function(n){return n/e;}:function(n){return n*e;},symbol:n};}function Un(n){var t=n.decimal,e=n.thousands,r=n.grouping,u=n.currency,i=r&&e?function(n,t){for(var u=n.length,i=[],a=0,o=r[0],l=0;
u>0&&o>0&&(l+o+1>t&&(o=Math.max(1,t-l)),i.push(n.substring(u-=o,u+o)),!((l+=o+1)>t));){o=r[a=(a+1)%r.length];
}return i.reverse().join(e);}:y;return function(n){var e=so.exec(n),r=e[1]||" ",a=e[2]||">",o=e[3]||"-",l=e[4]||"",c=e[5],s=+e[6],f=e[7],h=e[8],g=e[9],p=1,v="",d="",m=!1,y=!0;
switch(h&&(h=+h.substring(1)),(c||"0"===r&&"="===a)&&(c=r="0",a="="),g){case"n":f=!0,g="g";break;case"%":p=100,d="%",g="f";
break;case"p":p=100,d="%",g="r";break;case"b":case"o":case"x":case"X":"#"===l&&(v="0"+g.toLowerCase());
case"c":y=!1;case"d":m=!0,h=0;break;case"s":p=-1,g="r";}"$"===l&&(v=u[0],d=u[1]),"r"!=g||h||(g="g"),null!=h&&("g"==g?h=Math.max(1,Math.min(21,h)):("e"==g||"f"==g)&&(h=Math.max(0,Math.min(20,h)))),g=fo.get(g)||Fn;
var M=c&&f;return function(n){var e=d;if(m&&n%1){return"";}var u=0>n||0===n&&0>1/n?(n=-n,"-"):"-"===o?"":o;
if(0>p){var l=oa.formatPrefix(n,h);n=l.scale(n),e=l.symbol+d;}else{n*=p;}n=g(n,h);var x,b,_=n.lastIndexOf(".");
if(0>_){var w=y?n.lastIndexOf("e"):-1;0>w?(x=n,b=""):(x=n.substring(0,w),b=n.substring(w));}else{x=n.substring(0,_),b=t+n.substring(_+1);
}!c&&f&&(x=i(x,1/0));var S=v.length+x.length+b.length+(M?0:u.length),k=s>S?new Array(S=s-S+1).join(r):"";
return M&&(x=i(k+x,k.length?s-b.length:1/0)),u+=v,n=x+b,("<"===a?u+n+k:">"===a?k+u+n:"^"===a?k.substring(0,S>>=1)+u+n+k.substring(S):u+(M?n:k+n))+e;
};};}function Fn(n){return n+"";}function Hn(){this._=new Date(arguments.length>1?Date.UTC.apply(this,arguments):arguments[0]);
}function On(n,t,e){function r(t){var e=n(t),r=i(e,1);return r-t>t-e?e:r;}function u(e){return t(e=n(new go(e-1)),1),e;
}function i(n,e){return t(n=new go(+n),e),n;}function a(n,r,i){var a=u(n),o=[];if(i>1){for(;r>a;){e(a)%i||o.push(new Date(+a)),t(a,1);
}}else{for(;r>a;){o.push(new Date(+a)),t(a,1);}}return o;}function o(n,t,e){try{go=Hn;var r=new Hn;return r._=n,a(r,t,e);
}finally{go=Date;}}n.floor=n,n.round=r,n.ceil=u,n.offset=i,n.range=a;var l=n.utc=In(n);return l.floor=l,l.round=In(r),l.ceil=In(u),l.offset=In(i),l.range=o,n;
}function In(n){return function(t,e){try{go=Hn;var r=new Hn;return r._=t,n(r,e)._;}finally{go=Date;}};
}function Yn(n){function t(n){function t(t){for(var e,u,i,a=[],o=-1,l=0;++o<r;){37===n.charCodeAt(o)&&(a.push(n.slice(l,o)),null!=(u=vo[e=n.charAt(++o)])&&(e=n.charAt(++o)),(i=A[e])&&(e=i(t,null==u?"e"===e?" ":"0":u)),a.push(e),l=o+1);
}return a.push(n.slice(l,o)),a.join("");}var r=n.length;return t.parse=function(t){var r={y:1900,m:0,d:1,H:0,M:0,S:0,L:0,Z:null},u=e(r,n,t,0);
if(u!=t.length){return null;}"p" in r&&(r.H=r.H%12+12*r.p);var i=null!=r.Z&&go!==Hn,a=new (i?Hn:go);return"j" in r?a.setFullYear(r.y,0,r.j):"W" in r||"U" in r?("w" in r||(r.w="W" in r?1:0),a.setFullYear(r.y,0,1),a.setFullYear(r.y,0,"W" in r?(r.w+6)%7+7*r.W-(a.getDay()+5)%7:r.w+7*r.U-(a.getDay()+6)%7)):a.setFullYear(r.y,r.m,r.d),a.setHours(r.H+(r.Z/100|0),r.M+r.Z%100,r.S,r.L),i?a._:a;
},t.toString=function(){return n;},t;}function e(n,t,e,r){for(var u,i,a,o=0,l=t.length,c=e.length;l>o;
){if(r>=c){return -1;}if(u=t.charCodeAt(o++),37===u){if(a=t.charAt(o++),i=C[a in vo?t.charAt(o++):a],!i||(r=i(n,e,r))<0){return -1;
}}else{if(u!=e.charCodeAt(r++)){return -1;}}}return r;}function r(n,t,e){_.lastIndex=0;var r=_.exec(t.slice(e));
return r?(n.w=w.get(r[0].toLowerCase()),e+r[0].length):-1;}function u(n,t,e){x.lastIndex=0;var r=x.exec(t.slice(e));
return r?(n.w=b.get(r[0].toLowerCase()),e+r[0].length):-1;}function i(n,t,e){N.lastIndex=0;var r=N.exec(t.slice(e));
return r?(n.m=E.get(r[0].toLowerCase()),e+r[0].length):-1;}function a(n,t,e){S.lastIndex=0;var r=S.exec(t.slice(e));
return r?(n.m=k.get(r[0].toLowerCase()),e+r[0].length):-1;}function o(n,t,r){return e(n,A.c.toString(),t,r);
}function l(n,t,r){return e(n,A.x.toString(),t,r);}function c(n,t,r){return e(n,A.X.toString(),t,r);}function s(n,t,e){var r=M.get(t.slice(e,e+=2).toLowerCase());
return null==r?-1:(n.p=r,e);}var f=n.dateTime,h=n.date,g=n.time,p=n.periods,v=n.days,d=n.shortDays,m=n.months,y=n.shortMonths;
t.utc=function(n){function e(n){try{go=Hn;var t=new go;return t._=n,r(t);}finally{go=Date;}}var r=t(n);
return e.parse=function(n){try{go=Hn;var t=r.parse(n);return t&&t._;}finally{go=Date;}},e.toString=r.toString,e;
},t.multi=t.utc.multi=ct;var M=oa.map(),x=Vn(v),b=Xn(v),_=Vn(d),w=Xn(d),S=Vn(m),k=Xn(m),N=Vn(y),E=Xn(y);
p.forEach(function(n,t){M.set(n.toLowerCase(),t);});var A={a:function(n){return d[n.getDay()];},A:function(n){return v[n.getDay()];
},b:function(n){return y[n.getMonth()];},B:function(n){return m[n.getMonth()];},c:t(f),d:function(n,t){return Zn(n.getDate(),t,2);
},e:function(n,t){return Zn(n.getDate(),t,2);},H:function(n,t){return Zn(n.getHours(),t,2);},I:function(n,t){return Zn(n.getHours()%12||12,t,2);
},j:function(n,t){return Zn(1+ho.dayOfYear(n),t,3);},L:function(n,t){return Zn(n.getMilliseconds(),t,3);
},m:function(n,t){return Zn(n.getMonth()+1,t,2);},M:function(n,t){return Zn(n.getMinutes(),t,2);},p:function(n){return p[+(n.getHours()>=12)];
},S:function(n,t){return Zn(n.getSeconds(),t,2);},U:function(n,t){return Zn(ho.sundayOfYear(n),t,2);},w:function(n){return n.getDay();
},W:function(n,t){return Zn(ho.mondayOfYear(n),t,2);},x:t(h),X:t(g),y:function(n,t){return Zn(n.getFullYear()%100,t,2);
},Y:function(n,t){return Zn(n.getFullYear()%10000,t,4);},Z:ot,"%":function(){return"%";}},C={a:r,A:u,b:i,B:a,c:o,d:tt,e:tt,H:rt,I:rt,j:et,L:at,m:nt,M:ut,p:s,S:it,U:Bn,w:$n,W:Wn,x:l,X:c,y:Gn,Y:Jn,Z:Kn,"%":lt};
return t;}function Zn(n,t,e){var r=0>n?"-":"",u=(r?-n:n)+"",i=u.length;return r+(e>i?new Array(e-i+1).join(t)+u:u);
}function Vn(n){return new RegExp("^(?:"+n.map(oa.requote).join("|")+")","i");}function Xn(n){for(var t=new c,e=-1,r=n.length;
++e<r;){t.set(n[e].toLowerCase(),e);}return t;}function $n(n,t,e){mo.lastIndex=0;var r=mo.exec(t.slice(e,e+1));
return r?(n.w=+r[0],e+r[0].length):-1;}function Bn(n,t,e){mo.lastIndex=0;var r=mo.exec(t.slice(e));return r?(n.U=+r[0],e+r[0].length):-1;
}function Wn(n,t,e){mo.lastIndex=0;var r=mo.exec(t.slice(e));return r?(n.W=+r[0],e+r[0].length):-1;}function Jn(n,t,e){mo.lastIndex=0;
var r=mo.exec(t.slice(e,e+4));return r?(n.y=+r[0],e+r[0].length):-1;}function Gn(n,t,e){mo.lastIndex=0;
var r=mo.exec(t.slice(e,e+2));return r?(n.y=Qn(+r[0]),e+r[0].length):-1;}function Kn(n,t,e){return/^[+-]\d{4}$/.test(t=t.slice(e,e+5))?(n.Z=-t,e+5):-1;
}function Qn(n){return n+(n>68?1900:2000);}function nt(n,t,e){mo.lastIndex=0;var r=mo.exec(t.slice(e,e+2));
return r?(n.m=r[0]-1,e+r[0].length):-1;}function tt(n,t,e){mo.lastIndex=0;var r=mo.exec(t.slice(e,e+2));
return r?(n.d=+r[0],e+r[0].length):-1;}function et(n,t,e){mo.lastIndex=0;var r=mo.exec(t.slice(e,e+3));
return r?(n.j=+r[0],e+r[0].length):-1;}function rt(n,t,e){mo.lastIndex=0;var r=mo.exec(t.slice(e,e+2));
return r?(n.H=+r[0],e+r[0].length):-1;}function ut(n,t,e){mo.lastIndex=0;var r=mo.exec(t.slice(e,e+2));
return r?(n.M=+r[0],e+r[0].length):-1;}function it(n,t,e){mo.lastIndex=0;var r=mo.exec(t.slice(e,e+2));
return r?(n.S=+r[0],e+r[0].length):-1;}function at(n,t,e){mo.lastIndex=0;var r=mo.exec(t.slice(e,e+3));
return r?(n.L=+r[0],e+r[0].length):-1;}function ot(n){var t=n.getTimezoneOffset(),e=t>0?"-":"+",r=Ma(t)/60|0,u=Ma(t)%60;
return e+Zn(r,"0",2)+Zn(u,"0",2);}function lt(n,t,e){yo.lastIndex=0;var r=yo.exec(t.slice(e,e+1));return r?e+r[0].length:-1;
}function ct(n){for(var t=n.length,e=-1;++e<t;){n[e][0]=this(n[e][0]);}return function(t){for(var e=0,r=n[e];
!r[1](t);){r=n[++e];}return r[0](t);};}function st(){}function ft(n,t,e){var r=e.s=n+t,u=r-n,i=r-u;e.t=n-i+(t-u);
}function ht(n,t){n&&_o.hasOwnProperty(n.type)&&_o[n.type](n,t);}function gt(n,t,e){var r,u=-1,i=n.length-e;
for(t.lineStart();++u<i;){r=n[u],t.point(r[0],r[1],r[2]);}t.lineEnd();}function pt(n,t){var e=-1,r=n.length;
for(t.polygonStart();++e<r;){gt(n[e],t,1);}t.polygonEnd();}function vt(){function n(n,t){n*=Oa,t=t*Oa/2+ja/4;
var e=n-r,a=e>=0?1:-1,o=a*e,l=Math.cos(t),c=Math.sin(t),s=i*c,f=u*l+s*Math.cos(o),h=s*a*Math.sin(o);So.add(Math.atan2(h,f)),r=n,u=l,i=c;
}var t,e,r,u,i;ko.point=function(a,o){ko.point=n,r=(t=a)*Oa,u=Math.cos(o=(e=o)*Oa/2+ja/4),i=Math.sin(o);
},ko.lineEnd=function(){n(t,e);};}function dt(n){var t=n[0],e=n[1],r=Math.cos(e);return[r*Math.cos(t),r*Math.sin(t),Math.sin(e)];
}function mt(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2];}function yt(n,t){return[n[1]*t[2]-n[2]*t[1],n[2]*t[0]-n[0]*t[2],n[0]*t[1]-n[1]*t[0]];
}function Mt(n,t){n[0]+=t[0],n[1]+=t[1],n[2]+=t[2];}function xt(n,t){return[n[0]*t,n[1]*t,n[2]*t];}function bt(n){var t=Math.sqrt(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]);
n[0]/=t,n[1]/=t,n[2]/=t;}function _t(n){return[Math.atan2(n[1],n[0]),tn(n[2])];}function wt(n,t){return Ma(n[0]-t[0])<Da&&Ma(n[1]-t[1])<Da;
}function St(n,t){n*=Oa;var e=Math.cos(t*=Oa);kt(e*Math.cos(n),e*Math.sin(n),Math.sin(t));}function kt(n,t,e){++No,Ao+=(n-Ao)/No,Co+=(t-Co)/No,zo+=(e-zo)/No;
}function Nt(){function n(n,u){n*=Oa;var i=Math.cos(u*=Oa),a=i*Math.cos(n),o=i*Math.sin(n),l=Math.sin(u),c=Math.atan2(Math.sqrt((c=e*l-r*o)*c+(c=r*a-t*l)*c+(c=t*o-e*a)*c),t*a+e*o+r*l);
Eo+=c,Lo+=c*(t+(t=a)),qo+=c*(e+(e=o)),To+=c*(r+(r=l)),kt(t,e,r);}var t,e,r;jo.point=function(u,i){u*=Oa;
var a=Math.cos(i*=Oa);t=a*Math.cos(u),e=a*Math.sin(u),r=Math.sin(i),jo.point=n,kt(t,e,r);};}function Et(){jo.point=St;
}function At(){function n(n,t){n*=Oa;var e=Math.cos(t*=Oa),a=e*Math.cos(n),o=e*Math.sin(n),l=Math.sin(t),c=u*l-i*o,s=i*a-r*l,f=r*o-u*a,h=Math.sqrt(c*c+s*s+f*f),g=r*a+u*o+i*l,p=h&&-nn(g)/h,v=Math.atan2(h,g);
Ro+=p*c,Do+=p*s,Po+=p*f,Eo+=v,Lo+=v*(r+(r=a)),qo+=v*(u+(u=o)),To+=v*(i+(i=l)),kt(r,u,i);}var t,e,r,u,i;
jo.point=function(a,o){t=a,e=o,jo.point=n,a*=Oa;var l=Math.cos(o*=Oa);r=l*Math.cos(a),u=l*Math.sin(a),i=Math.sin(o),kt(r,u,i);
},jo.lineEnd=function(){n(t,e),jo.lineEnd=Et,jo.point=St;};}function Ct(n,t){function e(e,r){return e=n(e,r),t(e[0],e[1]);
}return n.invert&&t.invert&&(e.invert=function(e,r){return e=t.invert(e,r),e&&n.invert(e[0],e[1]);}),e;
}function zt(){return !0;}function Lt(n,t,e,r,u){var i=[],a=[];if(n.forEach(function(n){if(!((t=n.length-1)<=0)){var t,e=n[0],r=n[t];
if(wt(e,r)){u.lineStart();for(var o=0;t>o;++o){u.point((e=n[o])[0],e[1]);}return void u.lineEnd();}var l=new Tt(e,n,null,!0),c=new Tt(e,null,l,!1);
l.o=c,i.push(l),a.push(c),l=new Tt(r,n,null,!1),c=new Tt(r,null,l,!0),l.o=c,i.push(l),a.push(c);}}),a.sort(t),qt(i),qt(a),i.length){for(var o=0,l=e,c=a.length;
c>o;++o){a[o].e=l=!l;}for(var s,f,h=i[0];;){for(var g=h,p=!0;g.v;){if((g=g.n)===h){return;}}s=g.z,u.lineStart();
do{if(g.v=g.o.v=!0,g.e){if(p){for(var o=0,c=s.length;c>o;++o){u.point((f=s[o])[0],f[1]);}}else{r(g.x,g.n.x,1,u);
}g=g.n;}else{if(p){s=g.p.z;for(var o=s.length-1;o>=0;--o){u.point((f=s[o])[0],f[1]);}}else{r(g.x,g.p.x,-1,u);
}g=g.p;}g=g.o,s=g.z,p=!p;}while(!g.v);u.lineEnd();}}}function qt(n){if(t=n.length){for(var t,e,r=0,u=n[0];
++r<t;){u.n=e=n[r],e.p=u,u=e;}u.n=e=n[0],e.p=u;}}function Tt(n,t,e,r){this.x=n,this.z=t,this.o=e,this.e=r,this.v=!1,this.n=this.p=null;
}function Rt(n,t,e,r){return function(u,i){function a(t,e){var r=u(t,e);n(t=r[0],e=r[1])&&i.point(t,e);
}function o(n,t){var e=u(n,t);d.point(e[0],e[1]);}function l(){y.point=o,d.lineStart();}function c(){y.point=a,d.lineEnd();
}function s(n,t){v.push([n,t]);var e=u(n,t);x.point(e[0],e[1]);}function f(){x.lineStart(),v=[];}function h(){s(v[0][0],v[0][1]),x.lineEnd();
var n,t=x.clean(),e=M.buffer(),r=e.length;if(v.pop(),p.push(v),v=null,r){if(1&t){n=e[0];var u,r=n.length-1,a=-1;
if(r>0){for(b||(i.polygonStart(),b=!0),i.lineStart();++a<r;){i.point((u=n[a])[0],u[1]);}i.lineEnd();}}else{r>1&&2&t&&e.push(e.pop().concat(e.shift())),g.push(e.filter(Dt));
}}}var g,p,v,d=t(i),m=u.invert(r[0],r[1]),y={point:a,lineStart:l,lineEnd:c,polygonStart:function(){y.point=s,y.lineStart=f,y.lineEnd=h,g=[],p=[];
},polygonEnd:function(){y.point=a,y.lineStart=l,y.lineEnd=c,g=oa.merge(g);var n=Ot(m,p);g.length?(b||(i.polygonStart(),b=!0),Lt(g,jt,n,e,i)):n&&(b||(i.polygonStart(),b=!0),i.lineStart(),e(null,null,1,i),i.lineEnd()),b&&(i.polygonEnd(),b=!1),g=p=null;
},sphere:function(){i.polygonStart(),i.lineStart(),e(null,null,1,i),i.lineEnd(),i.polygonEnd();}},M=Pt(),x=t(M),b=!1;
return y;};}function Dt(n){return n.length>1;}function Pt(){var n,t=[];return{lineStart:function(){t.push(n=[]);
},point:function(t,e){n.push([t,e]);},lineEnd:b,buffer:function(){var e=t;return t=[],n=null,e;},rejoin:function(){t.length>1&&t.push(t.pop().concat(t.shift()));
}};}function jt(n,t){return((n=n.x)[0]<0?n[1]-Ha-Da:Ha-n[1])-((t=t.x)[0]<0?t[1]-Ha-Da:Ha-t[1]);}function Ut(n){var t,e=NaN,r=NaN,u=NaN;
return{lineStart:function(){n.lineStart(),t=1;},point:function(i,a){var o=i>0?ja:-ja,l=Ma(i-e);Ma(l-ja)<Da?(n.point(e,r=(r+a)/2>0?Ha:-Ha),n.point(u,r),n.lineEnd(),n.lineStart(),n.point(o,r),n.point(i,r),t=0):u!==o&&l>=ja&&(Ma(e-u)<Da&&(e-=u*Da),Ma(i-o)<Da&&(i-=o*Da),r=Ft(e,r,i,a),n.point(u,r),n.lineEnd(),n.lineStart(),n.point(o,r),t=0),n.point(e=i,r=a),u=o;
},lineEnd:function(){n.lineEnd(),e=r=NaN;},clean:function(){return 2-t;}};}function Ft(n,t,e,r){var u,i,a=Math.sin(n-e);
return Ma(a)>Da?Math.atan((Math.sin(t)*(i=Math.cos(r))*Math.sin(e)-Math.sin(r)*(u=Math.cos(t))*Math.sin(n))/(u*i*a)):(t+r)/2;
}function Ht(n,t,e,r){var u;if(null==n){u=e*Ha,r.point(-ja,u),r.point(0,u),r.point(ja,u),r.point(ja,0),r.point(ja,-u),r.point(0,-u),r.point(-ja,-u),r.point(-ja,0),r.point(-ja,u);
}else{if(Ma(n[0]-t[0])>Da){var i=n[0]<t[0]?ja:-ja;u=e*i/2,r.point(-i,u),r.point(0,u),r.point(i,u);}else{r.point(t[0],t[1]);
}}}function Ot(n,t){var e=n[0],r=n[1],u=[Math.sin(e),-Math.cos(e),0],i=0,a=0;So.reset();for(var o=0,l=t.length;
l>o;++o){var c=t[o],s=c.length;if(s){for(var f=c[0],h=f[0],g=f[1]/2+ja/4,p=Math.sin(g),v=Math.cos(g),d=1;
;){d===s&&(d=0),n=c[d];var m=n[0],y=n[1]/2+ja/4,M=Math.sin(y),x=Math.cos(y),b=m-h,_=b>=0?1:-1,w=_*b,S=w>ja,k=p*M;
if(So.add(Math.atan2(k*_*Math.sin(w),v*x+k*Math.cos(w))),i+=S?b+_*Ua:b,S^h>=e^m>=e){var N=yt(dt(f),dt(n));
bt(N);var E=yt(u,N);bt(E);var A=(S^b>=0?-1:1)*tn(E[2]);(r>A||r===A&&(N[0]||N[1]))&&(a+=S^b>=0?1:-1);}if(!d++){break;
}h=m,p=M,v=x,f=n;}}}return(-Da>i||Da>i&&0>So)^1&a;}function It(n){function t(n,t){return Math.cos(n)*Math.cos(t)>i;
}function e(n){var e,i,l,c,s;return{lineStart:function(){c=l=!1,s=1;},point:function(f,h){var g,p=[f,h],v=t(f,h),d=a?v?0:u(f,h):v?u(f+(0>f?ja:-ja),h):0;
if(!e&&(c=l=v)&&n.lineStart(),v!==l&&(g=r(e,p),(wt(e,g)||wt(p,g))&&(p[0]+=Da,p[1]+=Da,v=t(p[0],p[1]))),v!==l){s=0,v?(n.lineStart(),g=r(p,e),n.point(g[0],g[1])):(g=r(e,p),n.point(g[0],g[1]),n.lineEnd()),e=g;
}else{if(o&&e&&a^v){var m;d&i||!(m=r(p,e,!0))||(s=0,a?(n.lineStart(),n.point(m[0][0],m[0][1]),n.point(m[1][0],m[1][1]),n.lineEnd()):(n.point(m[1][0],m[1][1]),n.lineEnd(),n.lineStart(),n.point(m[0][0],m[0][1])));
}}!v||e&&wt(e,p)||n.point(p[0],p[1]),e=p,l=v,i=d;},lineEnd:function(){l&&n.lineEnd(),e=null;},clean:function(){return s|(c&&l)<<1;
}};}function r(n,t,e){var r=dt(n),u=dt(t),a=[1,0,0],o=yt(r,u),l=mt(o,o),c=o[0],s=l-c*c;if(!s){return !e&&n;
}var f=i*l/s,h=-i*c/s,g=yt(a,o),p=xt(a,f),v=xt(o,h);Mt(p,v);var d=g,m=mt(p,d),y=mt(d,d),M=m*m-y*(mt(p,p)-1);
if(!(0>M)){var x=Math.sqrt(M),b=xt(d,(-m-x)/y);if(Mt(b,p),b=_t(b),!e){return b;}var _,w=n[0],S=t[0],k=n[1],N=t[1];
w>S&&(_=w,w=S,S=_);var E=S-w,A=Ma(E-ja)<Da,C=A||Da>E;if(!A&&k>N&&(_=k,k=N,N=_),C?A?k+N>0^b[1]<(Ma(b[0]-w)<Da?k:N):k<=b[1]&&b[1]<=N:E>ja^(w<=b[0]&&b[0]<=S)){var z=xt(d,(-m+x)/y);
return Mt(z,p),[b,_t(z)];}}}function u(t,e){var r=a?n:ja-n,u=0;return -r>t?u|=1:t>r&&(u|=2),-r>e?u|=4:e>r&&(u|=8),u;
}var i=Math.cos(n),a=i>0,o=Ma(i)>Da,l=ve(n,6*Oa);return Rt(t,e,l,a?[0,-n]:[-ja,n-ja]);}function Yt(n,t,e,r){return function(u){var i,a=u.a,o=u.b,l=a.x,c=a.y,s=o.x,f=o.y,h=0,g=1,p=s-l,v=f-c;
if(i=n-l,p||!(i>0)){if(i/=p,0>p){if(h>i){return;}g>i&&(g=i);}else{if(p>0){if(i>g){return;}i>h&&(h=i);
}}if(i=e-l,p||!(0>i)){if(i/=p,0>p){if(i>g){return;}i>h&&(h=i);}else{if(p>0){if(h>i){return;}g>i&&(g=i);
}}if(i=t-c,v||!(i>0)){if(i/=v,0>v){if(h>i){return;}g>i&&(g=i);}else{if(v>0){if(i>g){return;}i>h&&(h=i);
}}if(i=r-c,v||!(0>i)){if(i/=v,0>v){if(i>g){return;}i>h&&(h=i);}else{if(v>0){if(h>i){return;}g>i&&(g=i);
}}return h>0&&(u.a={x:l+h*p,y:c+h*v}),1>g&&(u.b={x:l+g*p,y:c+g*v}),u;}}}}};}function Zt(n,t,e,r){function u(r,u){return Ma(r[0]-n)<Da?u>0?0:3:Ma(r[0]-e)<Da?u>0?2:1:Ma(r[1]-t)<Da?u>0?1:0:u>0?3:2;
}function i(n,t){return a(n.x,t.x);}function a(n,t){var e=u(n,1),r=u(t,1);return e!==r?e-r:0===e?t[1]-n[1]:1===e?n[0]-t[0]:2===e?n[1]-t[1]:t[0]-n[0];
}return function(o){function l(n){for(var t=0,e=d.length,r=n[1],u=0;e>u;++u){for(var i,a=1,o=d[u],l=o.length,c=o[0];
l>a;++a){i=o[a],c[1]<=r?i[1]>r&&Q(c,i,n)>0&&++t:i[1]<=r&&Q(c,i,n)<0&&--t,c=i;}}return 0!==t;}function c(i,o,l,c){var s=0,f=0;
if(null==i||(s=u(i,l))!==(f=u(o,l))||a(i,o)<0^l>0){do{c.point(0===s||3===s?n:e,s>1?r:t);}while((s=(s+l+4)%4)!==f);
}else{c.point(o[0],o[1]);}}function s(u,i){return u>=n&&e>=u&&i>=t&&r>=i;}function f(n,t){s(n,t)&&o.point(n,t);
}function h(){C.point=p,d&&d.push(m=[]),S=!0,w=!1,b=_=NaN;}function g(){v&&(p(y,M),x&&w&&E.rejoin(),v.push(E.buffer())),C.point=f,w&&o.lineEnd();
}function p(n,t){n=Math.max(-Fo,Math.min(Fo,n)),t=Math.max(-Fo,Math.min(Fo,t));var e=s(n,t);if(d&&m.push([n,t]),S){y=n,M=t,x=e,S=!1,e&&(o.lineStart(),o.point(n,t));
}else{if(e&&w){o.point(n,t);}else{var r={a:{x:b,y:_},b:{x:n,y:t}};A(r)?(w||(o.lineStart(),o.point(r.a.x,r.a.y)),o.point(r.b.x,r.b.y),e||o.lineEnd(),k=!1):e&&(o.lineStart(),o.point(n,t),k=!1);
}}b=n,_=t,w=e;}var v,d,m,y,M,x,b,_,w,S,k,N=o,E=Pt(),A=Yt(n,t,e,r),C={point:f,lineStart:h,lineEnd:g,polygonStart:function(){o=E,v=[],d=[],k=!0;
},polygonEnd:function(){o=N,v=oa.merge(v);var t=l([n,r]),e=k&&t,u=v.length;(e||u)&&(o.polygonStart(),e&&(o.lineStart(),c(null,null,1,o),o.lineEnd()),u&&Lt(v,i,t,c,o),o.polygonEnd()),v=d=m=null;
}};return C;};}function Vt(n){var t=0,e=ja/3,r=oe(n),u=r(t,e);return u.parallels=function(n){return arguments.length?r(t=n[0]*ja/180,e=n[1]*ja/180):[t/ja*180,e/ja*180];
},u;}function Xt(n,t){function e(n,t){var e=Math.sqrt(i-2*u*Math.sin(t))/u;return[e*Math.sin(n*=u),a-e*Math.cos(n)];
}var r=Math.sin(n),u=(r+Math.sin(t))/2,i=1+r*(2*u-r),a=Math.sqrt(i)/u;return e.invert=function(n,t){var e=a-t;
return[Math.atan2(n,e)/u,tn((i-(n*n+e*e)*u*u)/(2*u))];},e;}function $t(){function n(n,t){Oo+=u*n-r*t,r=n,u=t;
}var t,e,r,u;Xo.point=function(i,a){Xo.point=n,t=r=i,e=u=a;},Xo.lineEnd=function(){n(t,e);};}function Bt(n,t){Io>n&&(Io=n),n>Zo&&(Zo=n),Yo>t&&(Yo=t),t>Vo&&(Vo=t);
}function Wt(){function n(n,t){a.push("M",n,",",t,i);}function t(n,t){a.push("M",n,",",t),o.point=e;}function e(n,t){a.push("L",n,",",t);
}function r(){o.point=n;}function u(){a.push("Z");}var i=Jt(4.5),a=[],o={point:n,lineStart:function(){o.point=t;
},lineEnd:r,polygonStart:function(){o.lineEnd=u;},polygonEnd:function(){o.lineEnd=r,o.point=n;},pointRadius:function(n){return i=Jt(n),o;
},result:function(){if(a.length){var n=a.join("");return a=[],n;}}};return o;}function Jt(n){return"m0,"+n+"a"+n+","+n+" 0 1,1 0,"+-2*n+"a"+n+","+n+" 0 1,1 0,"+2*n+"z";
}function Gt(n,t){Ao+=n,Co+=t,++zo;}function Kt(){function n(n,r){var u=n-t,i=r-e,a=Math.sqrt(u*u+i*i);
Lo+=a*(t+n)/2,qo+=a*(e+r)/2,To+=a,Gt(t=n,e=r);}var t,e;Bo.point=function(r,u){Bo.point=n,Gt(t=r,e=u);
};}function Qt(){Bo.point=Gt;}function ne(){function n(n,t){var e=n-r,i=t-u,a=Math.sqrt(e*e+i*i);Lo+=a*(r+n)/2,qo+=a*(u+t)/2,To+=a,a=u*n-r*t,Ro+=a*(r+n),Do+=a*(u+t),Po+=3*a,Gt(r=n,u=t);
}var t,e,r,u;Bo.point=function(i,a){Bo.point=n,Gt(t=r=i,e=u=a);},Bo.lineEnd=function(){n(t,e);};}function te(n){function t(t,e){n.moveTo(t+a,e),n.arc(t,e,a,0,Ua);
}function e(t,e){n.moveTo(t,e),o.point=r;}function r(t,e){n.lineTo(t,e);}function u(){o.point=t;}function i(){n.closePath();
}var a=4.5,o={point:t,lineStart:function(){o.point=e;},lineEnd:u,polygonStart:function(){o.lineEnd=i;
},polygonEnd:function(){o.lineEnd=u,o.point=t;},pointRadius:function(n){return a=n,o;},result:b};return o;
}function ee(n){function t(n){return(o?r:e)(n);}function e(t){return ie(t,function(e,r){e=n(e,r),t.point(e[0],e[1]);
});}function r(t){function e(e,r){e=n(e,r),t.point(e[0],e[1]);}function r(){M=NaN,S.point=i,t.lineStart();
}function i(e,r){var i=dt([e,r]),a=n(e,r);u(M,x,y,b,_,w,M=a[0],x=a[1],y=e,b=i[0],_=i[1],w=i[2],o,t),t.point(M,x);
}function a(){S.point=e,t.lineEnd();}function l(){r(),S.point=c,S.lineEnd=s;}function c(n,t){i(f=n,h=t),g=M,p=x,v=b,d=_,m=w,S.point=i;
}function s(){u(M,x,y,b,_,w,g,p,f,v,d,m,o,t),S.lineEnd=a,a();}var f,h,g,p,v,d,m,y,M,x,b,_,w,S={point:e,lineStart:r,lineEnd:a,polygonStart:function(){t.polygonStart(),S.lineStart=l;
},polygonEnd:function(){t.polygonEnd(),S.lineStart=r;}};return S;}function u(t,e,r,o,l,c,s,f,h,g,p,v,d,m){var y=s-t,M=f-e,x=y*y+M*M;
if(x>4*i&&d--){var b=o+g,_=l+p,w=c+v,S=Math.sqrt(b*b+_*_+w*w),k=Math.asin(w/=S),N=Ma(Ma(w)-1)<Da||Ma(r-h)<Da?(r+h)/2:Math.atan2(_,b),E=n(N,k),A=E[0],C=E[1],z=A-t,L=C-e,q=M*z-y*L;
(q*q/x>i||Ma((y*z+M*L)/x-0.5)>0.3||a>o*g+l*p+c*v)&&(u(t,e,r,o,l,c,A,C,N,b/=S,_/=S,w,d,m),m.point(A,C),u(A,C,N,b,_,w,s,f,h,g,p,v,d,m));
}}var i=0.5,a=Math.cos(30*Oa),o=16;return t.precision=function(n){return arguments.length?(o=(i=n*n)>0&&16,t):Math.sqrt(i);
},t;}function re(n){var t=ee(function(t,e){return n([t*Ia,e*Ia]);});return function(n){return le(t(n));
};}function ue(n){this.stream=n;}function ie(n,t){return{point:t,sphere:function(){n.sphere();},lineStart:function(){n.lineStart();
},lineEnd:function(){n.lineEnd();},polygonStart:function(){n.polygonStart();},polygonEnd:function(){n.polygonEnd();
}};}function ae(n){return oe(function(){return n;})();}function oe(n){function t(n){return n=o(n[0]*Oa,n[1]*Oa),[n[0]*h+l,c-n[1]*h];
}function e(n){return n=o.invert((n[0]-l)/h,(c-n[1])/h),n&&[n[0]*Ia,n[1]*Ia];}function r(){o=Ct(a=fe(m,M,x),i);
var n=i(v,d);return l=g-n[0]*h,c=p+n[1]*h,u();}function u(){return s&&(s.valid=!1,s=null),t;}var i,a,o,l,c,s,f=ee(function(n,t){return n=i(n,t),[n[0]*h+l,c-n[1]*h];
}),h=150,g=480,p=250,v=0,d=0,m=0,M=0,x=0,b=Uo,_=y,w=null,S=null;return t.stream=function(n){return s&&(s.valid=!1),s=le(b(a,f(_(n)))),s.valid=!0,s;
},t.clipAngle=function(n){return arguments.length?(b=null==n?(w=n,Uo):It((w=+n)*Oa),u()):w;},t.clipExtent=function(n){return arguments.length?(S=n,_=n?Zt(n[0][0],n[0][1],n[1][0],n[1][1]):y,u()):S;
},t.scale=function(n){return arguments.length?(h=+n,r()):h;},t.translate=function(n){return arguments.length?(g=+n[0],p=+n[1],r()):[g,p];
},t.center=function(n){return arguments.length?(v=n[0]%360*Oa,d=n[1]%360*Oa,r()):[v*Ia,d*Ia];},t.rotate=function(n){return arguments.length?(m=n[0]%360*Oa,M=n[1]%360*Oa,x=n.length>2?n[2]%360*Oa:0,r()):[m*Ia,M*Ia,x*Ia];
},oa.rebind(t,f,"precision"),function(){return i=n.apply(this,arguments),t.invert=i.invert&&e,r();};}function le(n){return ie(n,function(t,e){n.point(t*Oa,e*Oa);
});}function ce(n,t){return[n,t];}function se(n,t){return[n>ja?n-Ua:-ja>n?n+Ua:n,t];}function fe(n,t,e){return n?t||e?Ct(ge(n),pe(t,e)):ge(n):t||e?pe(t,e):se;
}function he(n){return function(t,e){return t+=n,[t>ja?t-Ua:-ja>t?t+Ua:t,e];};}function ge(n){var t=he(n);
return t.invert=he(-n),t;}function pe(n,t){function e(n,t){var e=Math.cos(t),o=Math.cos(n)*e,l=Math.sin(n)*e,c=Math.sin(t),s=c*r+o*u;
return[Math.atan2(l*i-s*a,o*r-c*u),tn(s*i+l*a)];}var r=Math.cos(n),u=Math.sin(n),i=Math.cos(t),a=Math.sin(t);
return e.invert=function(n,t){var e=Math.cos(t),o=Math.cos(n)*e,l=Math.sin(n)*e,c=Math.sin(t),s=c*i-l*a;
return[Math.atan2(l*i+c*a,o*r+s*u),tn(s*r-o*u)];},e;}function ve(n,t){var e=Math.cos(n),r=Math.sin(n);
return function(u,i,a,o){var l=a*t;null!=u?(u=de(e,u),i=de(e,i),(a>0?i>u:u>i)&&(u+=a*Ua)):(u=n+a*Ua,i=n-0.5*l);
for(var c,s=u;a>0?s>i:i>s;s-=l){o.point((c=_t([e,-r*Math.cos(s),-r*Math.sin(s)]))[0],c[1]);}};}function de(n,t){var e=dt(t);
e[0]-=n,bt(e);var r=nn(-e[1]);return((-e[2]<0?-r:r)+2*Math.PI-Da)%(2*Math.PI);}function me(n,t,e){var r=oa.range(n,t-Da,e).concat(t);
return function(n){return r.map(function(t){return[n,t];});};}function ye(n,t,e){var r=oa.range(n,t-Da,e).concat(t);
return function(n){return r.map(function(t){return[t,n];});};}function Me(n){return n.source;}function xe(n){return n.target;
}function be(n,t,e,r){var u=Math.cos(t),i=Math.sin(t),a=Math.cos(r),o=Math.sin(r),l=u*Math.cos(n),c=u*Math.sin(n),s=a*Math.cos(e),f=a*Math.sin(e),h=2*Math.asin(Math.sqrt(an(r-t)+u*a*an(e-n))),g=1/Math.sin(h),p=h?function(n){var t=Math.sin(n*=h)*g,e=Math.sin(h-n)*g,r=e*l+t*s,u=e*c+t*f,a=e*i+t*o;
return[Math.atan2(u,r)*Ia,Math.atan2(a,Math.sqrt(r*r+u*u))*Ia];}:function(){return[n*Ia,t*Ia];};return p.distance=h,p;
}function _e(){function n(n,u){var i=Math.sin(u*=Oa),a=Math.cos(u),o=Ma((n*=Oa)-t),l=Math.cos(o);Wo+=Math.atan2(Math.sqrt((o=a*Math.sin(o))*o+(o=r*i-e*a*l)*o),e*i+r*a*l),t=n,e=i,r=a;
}var t,e,r;Jo.point=function(u,i){t=u*Oa,e=Math.sin(i*=Oa),r=Math.cos(i),Jo.point=n;},Jo.lineEnd=function(){Jo.point=Jo.lineEnd=b;
};}function we(n,t){function e(t,e){var r=Math.cos(t),u=Math.cos(e),i=n(r*u);return[i*u*Math.sin(t),i*Math.sin(e)];
}return e.invert=function(n,e){var r=Math.sqrt(n*n+e*e),u=t(r),i=Math.sin(u),a=Math.cos(u);return[Math.atan2(n*i,r*a),Math.asin(r&&e*i/r)];
},e;}function Se(n,t){function e(n,t){a>0?-Ha+Da>t&&(t=-Ha+Da):t>Ha-Da&&(t=Ha-Da);var e=a/Math.pow(u(t),i);
return[e*Math.sin(i*n),a-e*Math.cos(i*n)];}var r=Math.cos(n),u=function(n){return Math.tan(ja/4+n/2);
},i=n===t?Math.sin(n):Math.log(r/Math.cos(t))/Math.log(u(t)/u(n)),a=r*Math.pow(u(n),i)/i;return i?(e.invert=function(n,t){var e=a-t,r=K(i)*Math.sqrt(n*n+e*e);
return[Math.atan2(n,e)/i,2*Math.atan(Math.pow(a/r,1/i))-Ha];},e):Ne;}function ke(n,t){function e(n,t){var e=i-t;
return[e*Math.sin(u*n),i-e*Math.cos(u*n)];}var r=Math.cos(n),u=n===t?Math.sin(n):(r-Math.cos(t))/(t-n),i=r/u+n;
return Ma(u)<Da?ce:(e.invert=function(n,t){var e=i-t;return[Math.atan2(n,e)/u,i-K(u)*Math.sqrt(n*n+e*e)];
},e);}function Ne(n,t){return[n,Math.log(Math.tan(ja/4+t/2))];}function Ee(n){var t,e=ae(n),r=e.scale,u=e.translate,i=e.clipExtent;
return e.scale=function(){var n=r.apply(e,arguments);return n===e?t?e.clipExtent(null):e:n;},e.translate=function(){var n=u.apply(e,arguments);
return n===e?t?e.clipExtent(null):e:n;},e.clipExtent=function(n){var a=i.apply(e,arguments);if(a===e){if(t=null==n){var o=ja*r(),l=u();
i([[l[0]-o,l[1]-o],[l[0]+o,l[1]+o]]);}}else{t&&(a=null);}return a;},e.clipExtent(null);}function Ae(n,t){return[Math.log(Math.tan(ja/4+t/2)),-n];
}function Ce(n){return n[0];}function ze(n){return n[1];}function Le(n){for(var t=n.length,e=[0,1],r=2,u=2;
t>u;u++){for(;r>1&&Q(n[e[r-2]],n[e[r-1]],n[u])<=0;){--r;}e[r++]=u;}return e.slice(0,r);}function qe(n,t){return n[0]-t[0]||n[1]-t[1];
}function Te(n,t,e){return(e[0]-t[0])*(n[1]-t[1])<(e[1]-t[1])*(n[0]-t[0]);}function Re(n,t,e,r){var u=n[0],i=e[0],a=t[0]-u,o=r[0]-i,l=n[1],c=e[1],s=t[1]-l,f=r[1]-c,h=(o*(l-c)-f*(u-i))/(f*a-o*s);
return[u+h*a,l+h*s];}function De(n){var t=n[0],e=n[n.length-1];return !(t[0]-e[0]||t[1]-e[1]);}function Pe(){rr(this),this.edge=this.site=this.circle=null;
}function je(n){var t=ll.pop()||new Pe;return t.site=n,t;}function Ue(n){Be(n),il.remove(n),ll.push(n),rr(n);
}function Fe(n){var t=n.circle,e=t.x,r=t.cy,u={x:e,y:r},i=n.P,a=n.N,o=[n];Ue(n);for(var l=i;l.circle&&Ma(e-l.circle.x)<Da&&Ma(r-l.circle.cy)<Da;
){i=l.P,o.unshift(l),Ue(l),l=i;}o.unshift(l),Be(l);for(var c=a;c.circle&&Ma(e-c.circle.x)<Da&&Ma(r-c.circle.cy)<Da;
){a=c.N,o.push(c),Ue(c),c=a;}o.push(c),Be(c);var s,f=o.length;for(s=1;f>s;++s){c=o[s],l=o[s-1],nr(c.edge,l.site,c.site,u);
}l=o[0],c=o[f-1],c.edge=Ke(l.site,c.site,null,u),$e(l),$e(c);}function He(n){for(var t,e,r,u,i=n.x,a=n.y,o=il._;
o;){if(r=Oe(o,a)-i,r>Da){o=o.L;}else{if(u=i-Ie(o,a),!(u>Da)){r>-Da?(t=o.P,e=o):u>-Da?(t=o,e=o.N):t=e=o;
break;}if(!o.R){t=o;break;}o=o.R;}}var l=je(n);if(il.insert(t,l),t||e){if(t===e){return Be(t),e=je(t.site),il.insert(l,e),l.edge=e.edge=Ke(t.site,l.site),$e(t),void $e(e);
}if(!e){return void (l.edge=Ke(t.site,l.site));}Be(t),Be(e);var c=t.site,s=c.x,f=c.y,h=n.x-s,g=n.y-f,p=e.site,v=p.x-s,d=p.y-f,m=2*(h*d-g*v),y=h*h+g*g,M=v*v+d*d,x={x:(d*y-g*M)/m+s,y:(h*M-v*y)/m+f};
nr(e.edge,c,p,x),l.edge=Ke(c,n,null,x),e.edge=Ke(n,p,null,x),$e(t),$e(e);}}function Oe(n,t){var e=n.site,r=e.x,u=e.y,i=u-t;
if(!i){return r;}var a=n.P;if(!a){return -(1/0);}e=a.site;var o=e.x,l=e.y,c=l-t;if(!c){return o;}var s=o-r,f=1/i-1/c,h=s/c;
return f?(-h+Math.sqrt(h*h-2*f*(s*s/(-2*c)-l+c/2+u-i/2)))/f+r:(r+o)/2;}function Ie(n,t){var e=n.N;if(e){return Oe(e,t);
}var r=n.site;return r.y===t?r.x:1/0;}function Ye(n){this.site=n,this.edges=[];}function Ze(n){for(var t,e,r,u,i,a,o,l,c,s,f=n[0][0],h=n[1][0],g=n[0][1],p=n[1][1],v=ul,d=v.length;
d--;){if(i=v[d],i&&i.prepare()){for(o=i.edges,l=o.length,a=0;l>a;){s=o[a].end(),r=s.x,u=s.y,c=o[++a%l].start(),t=c.x,e=c.y,(Ma(r-t)>Da||Ma(u-e)>Da)&&(o.splice(a,0,new tr(Qe(i.site,s,Ma(r-f)<Da&&p-u>Da?{x:f,y:Ma(t-f)<Da?e:p}:Ma(u-p)<Da&&h-r>Da?{x:Ma(e-p)<Da?t:h,y:p}:Ma(r-h)<Da&&u-g>Da?{x:h,y:Ma(t-h)<Da?e:g}:Ma(u-g)<Da&&r-f>Da?{x:Ma(e-g)<Da?t:f,y:g}:null),i.site,null)),++l);
}}}}function Ve(n,t){return t.angle-n.angle;}function Xe(){rr(this),this.x=this.y=this.arc=this.site=this.cy=null;
}function $e(n){var t=n.P,e=n.N;if(t&&e){var r=t.site,u=n.site,i=e.site;if(r!==i){var a=u.x,o=u.y,l=r.x-a,c=r.y-o,s=i.x-a,f=i.y-o,h=2*(l*f-c*s);
if(!(h>=-Pa)){var g=l*l+c*c,p=s*s+f*f,v=(f*g-c*p)/h,d=(l*p-s*g)/h,f=d+o,m=cl.pop()||new Xe;m.arc=n,m.site=u,m.x=v+a,m.y=f+Math.sqrt(v*v+d*d),m.cy=f,n.circle=m;
for(var y=null,M=ol._;M;){if(m.y<M.y||m.y===M.y&&m.x<=M.x){if(!M.L){y=M.P;break;}M=M.L;}else{if(!M.R){y=M;
break;}M=M.R;}}ol.insert(y,m),y||(al=m);}}}}function Be(n){var t=n.circle;t&&(t.P||(al=t.N),ol.remove(t),cl.push(t),rr(t),n.circle=null);
}function We(n){for(var t,e=rl,r=Yt(n[0][0],n[0][1],n[1][0],n[1][1]),u=e.length;u--;){t=e[u],(!Je(t,n)||!r(t)||Ma(t.a.x-t.b.x)<Da&&Ma(t.a.y-t.b.y)<Da)&&(t.a=t.b=null,e.splice(u,1));
}}function Je(n,t){var e=n.b;if(e){return !0;}var r,u,i=n.a,a=t[0][0],o=t[1][0],l=t[0][1],c=t[1][1],s=n.l,f=n.r,h=s.x,g=s.y,p=f.x,v=f.y,d=(h+p)/2,m=(g+v)/2;
if(v===g){if(a>d||d>=o){return;}if(h>p){if(i){if(i.y>=c){return;}}else{i={x:d,y:l};}e={x:d,y:c};}else{if(i){if(i.y<l){return;
}}else{i={x:d,y:c};}e={x:d,y:l};}}else{if(r=(h-p)/(v-g),u=m-r*d,-1>r||r>1){if(h>p){if(i){if(i.y>=c){return;
}}else{i={x:(l-u)/r,y:l};}e={x:(c-u)/r,y:c};}else{if(i){if(i.y<l){return;}}else{i={x:(c-u)/r,y:c};}e={x:(l-u)/r,y:l};
}}else{if(v>g){if(i){if(i.x>=o){return;}}else{i={x:a,y:r*a+u};}e={x:o,y:r*o+u};}else{if(i){if(i.x<a){return;
}}else{i={x:o,y:r*o+u};}e={x:a,y:r*a+u};}}}return n.a=i,n.b=e,!0;}function Ge(n,t){this.l=n,this.r=t,this.a=this.b=null;
}function Ke(n,t,e,r){var u=new Ge(n,t);return rl.push(u),e&&nr(u,n,t,e),r&&nr(u,t,n,r),ul[n.i].edges.push(new tr(u,n,t)),ul[t.i].edges.push(new tr(u,t,n)),u;
}function Qe(n,t,e){var r=new Ge(n,null);return r.a=t,r.b=e,rl.push(r),r;}function nr(n,t,e,r){n.a||n.b?n.l===e?n.b=r:n.a=r:(n.a=r,n.l=t,n.r=e);
}function tr(n,t,e){var r=n.a,u=n.b;this.edge=n,this.site=t,this.angle=e?Math.atan2(e.y-t.y,e.x-t.x):n.l===t?Math.atan2(u.x-r.x,r.y-u.y):Math.atan2(r.x-u.x,u.y-r.y);
}function er(){this._=null;}function rr(n){n.U=n.C=n.L=n.R=n.P=n.N=null;}function ur(n,t){var e=t,r=t.R,u=e.U;
u?u.L===e?u.L=r:u.R=r:n._=r,r.U=u,e.U=r,e.R=r.L,e.R&&(e.R.U=e),r.L=e;}function ir(n,t){var e=t,r=t.L,u=e.U;
u?u.L===e?u.L=r:u.R=r:n._=r,r.U=u,e.U=r,e.L=r.R,e.L&&(e.L.U=e),r.R=e;}function ar(n){for(;n.L;){n=n.L;
}return n;}function or(n,t){var e,r,u,i=n.sort(lr).pop();for(rl=[],ul=new Array(n.length),il=new er,ol=new er;
;){if(u=al,i&&(!u||i.y<u.y||i.y===u.y&&i.x<u.x)){(i.x!==e||i.y!==r)&&(ul[i.i]=new Ye(i),He(i),e=i.x,r=i.y),i=n.pop();
}else{if(!u){break;}Fe(u.arc);}}t&&(We(t),Ze(t));var a={cells:ul,edges:rl};return il=ol=rl=ul=null,a;
}function lr(n,t){return t.y-n.y||t.x-n.x;}function cr(n,t,e){return(n.x-e.x)*(t.y-n.y)-(n.x-t.x)*(e.y-n.y);
}function sr(n){return n.x;}function fr(n){return n.y;}function hr(){return{leaf:!0,nodes:[],point:null,x:null,y:null};
}function gr(n,t,e,r,u,i){if(!n(t,e,r,u,i)){var a=0.5*(e+u),o=0.5*(r+i),l=t.nodes;l[0]&&gr(n,l[0],e,r,a,o),l[1]&&gr(n,l[1],a,r,u,o),l[2]&&gr(n,l[2],e,o,a,i),l[3]&&gr(n,l[3],a,o,u,i);
}}function pr(n,t,e,r,u,i,a){var o,l=1/0;return function c(n,s,f,h,g){if(!(s>i||f>a||r>h||u>g)){if(p=n.point){var p,v=t-n.x,d=e-n.y,m=v*v+d*d;
if(l>m){var y=Math.sqrt(l=m);r=t-y,u=e-y,i=t+y,a=e+y,o=p;}}for(var M=n.nodes,x=0.5*(s+h),b=0.5*(f+g),_=t>=x,w=e>=b,S=w<<1|_,k=S+4;
k>S;++S){if(n=M[3&S]){switch(3&S){case 0:c(n,s,f,x,b);break;case 1:c(n,x,f,h,b);break;case 2:c(n,s,b,x,g);
break;case 3:c(n,x,b,h,g);}}}}}(n,r,u,i,a),o;}function vr(n,t){n=oa.rgb(n),t=oa.rgb(t);var e=n.r,r=n.g,u=n.b,i=t.r-e,a=t.g-r,o=t.b-u;
return function(n){return"#"+bn(Math.round(e+i*n))+bn(Math.round(r+a*n))+bn(Math.round(u+o*n));};}function dr(n,t){var e,r={},u={};
for(e in n){e in t?r[e]=Mr(n[e],t[e]):u[e]=n[e];}for(e in t){e in n||(u[e]=t[e]);}return function(n){for(e in r){u[e]=r[e](n);
}return u;};}function mr(n,t){return n=+n,t=+t,function(e){return n*(1-e)+t*e;};}function yr(n,t){var e,r,u,i=fl.lastIndex=hl.lastIndex=0,a=-1,o=[],l=[];
for(n+="",t+="";(e=fl.exec(n))&&(r=hl.exec(t));){(u=r.index)>i&&(u=t.slice(i,u),o[a]?o[a]+=u:o[++a]=u),(e=e[0])===(r=r[0])?o[a]?o[a]+=r:o[++a]=r:(o[++a]=null,l.push({i:a,x:mr(e,r)})),i=hl.lastIndex;
}return i<t.length&&(u=t.slice(i),o[a]?o[a]+=u:o[++a]=u),o.length<2?l[0]?(t=l[0].x,function(n){return t(n)+"";
}):function(){return t;}:(t=l.length,function(n){for(var e,r=0;t>r;++r){o[(e=l[r]).i]=e.x(n);}return o.join("");
});}function Mr(n,t){for(var e,r=oa.interpolators.length;--r>=0&&!(e=oa.interpolators[r](n,t));){}return e;
}function xr(n,t){var e,r=[],u=[],i=n.length,a=t.length,o=Math.min(n.length,t.length);for(e=0;o>e;++e){r.push(Mr(n[e],t[e]));
}for(;i>e;++e){u[e]=n[e];}for(;a>e;++e){u[e]=t[e];}return function(n){for(e=0;o>e;++e){u[e]=r[e](n);}return u;
};}function br(n){return function(t){return 0>=t?0:t>=1?1:n(t);};}function _r(n){return function(t){return 1-n(1-t);
};}function wr(n){return function(t){return 0.5*(0.5>t?n(2*t):2-n(2-2*t));};}function Sr(n){return n*n;
}function kr(n){return n*n*n;}function Nr(n){if(0>=n){return 0;}if(n>=1){return 1;}var t=n*n,e=t*n;return 4*(0.5>n?e:3*(n-t)+e-0.75);
}function Er(n){return function(t){return Math.pow(t,n);};}function Ar(n){return 1-Math.cos(n*Ha);}function Cr(n){return Math.pow(2,10*(n-1));
}function zr(n){return 1-Math.sqrt(1-n*n);}function Lr(n,t){var e;return arguments.length<2&&(t=0.45),arguments.length?e=t/Ua*Math.asin(1/n):(n=1,e=t/4),function(r){return 1+n*Math.pow(2,-10*r)*Math.sin((r-e)*Ua/t);
};}function qr(n){return n||(n=1.70158),function(t){return t*t*((n+1)*t-n);};}function Tr(n){return 1/2.75>n?7.5625*n*n:2/2.75>n?7.5625*(n-=1.5/2.75)*n+0.75:2.5/2.75>n?7.5625*(n-=2.25/2.75)*n+0.9375:7.5625*(n-=2.625/2.75)*n+0.984375;
}function Rr(n,t){n=oa.hcl(n),t=oa.hcl(t);var e=n.h,r=n.c,u=n.l,i=t.h-e,a=t.c-r,o=t.l-u;return isNaN(a)&&(a=0,r=isNaN(r)?t.c:r),isNaN(i)?(i=0,e=isNaN(e)?t.h:e):i>180?i-=360:-180>i&&(i+=360),function(n){return fn(e+i*n,r+a*n,u+o*n)+"";
};}function Dr(n,t){n=oa.hsl(n),t=oa.hsl(t);var e=n.h,r=n.s,u=n.l,i=t.h-e,a=t.s-r,o=t.l-u;return isNaN(a)&&(a=0,r=isNaN(r)?t.s:r),isNaN(i)?(i=0,e=isNaN(e)?t.h:e):i>180?i-=360:-180>i&&(i+=360),function(n){return cn(e+i*n,r+a*n,u+o*n)+"";
};}function Pr(n,t){n=oa.lab(n),t=oa.lab(t);var e=n.l,r=n.a,u=n.b,i=t.l-e,a=t.a-r,o=t.b-u;return function(n){return gn(e+i*n,r+a*n,u+o*n)+"";
};}function jr(n,t){return t-=n,function(e){return Math.round(n+t*e);};}function Ur(n){var t=[n.a,n.b],e=[n.c,n.d],r=Hr(t),u=Fr(t,e),i=Hr(Or(e,t,-u))||0;
t[0]*e[1]<e[0]*t[1]&&(t[0]*=-1,t[1]*=-1,r*=-1,u*=-1),this.rotate=(r?Math.atan2(t[1],t[0]):Math.atan2(-e[0],e[1]))*Ia,this.translate=[n.e,n.f],this.scale=[r,i],this.skew=i?Math.atan2(u,i)*Ia:0;
}function Fr(n,t){return n[0]*t[0]+n[1]*t[1];}function Hr(n){var t=Math.sqrt(Fr(n,n));return t&&(n[0]/=t,n[1]/=t),t;
}function Or(n,t,e){return n[0]+=e*t[0],n[1]+=e*t[1],n;}function Ir(n){return n.length?n.pop()+",":"";
}function Yr(n,t,e,r){if(n[0]!==t[0]||n[1]!==t[1]){var u=e.push("translate(",null,",",null,")");r.push({i:u-4,x:mr(n[0],t[0])},{i:u-2,x:mr(n[1],t[1])});
}else{(t[0]||t[1])&&e.push("translate("+t+")");}}function Zr(n,t,e,r){n!==t?(n-t>180?t+=360:t-n>180&&(n+=360),r.push({i:e.push(Ir(e)+"rotate(",null,")")-2,x:mr(n,t)})):t&&e.push(Ir(e)+"rotate("+t+")");
}function Vr(n,t,e,r){n!==t?r.push({i:e.push(Ir(e)+"skewX(",null,")")-2,x:mr(n,t)}):t&&e.push(Ir(e)+"skewX("+t+")");
}function Xr(n,t,e,r){if(n[0]!==t[0]||n[1]!==t[1]){var u=e.push(Ir(e)+"scale(",null,",",null,")");r.push({i:u-4,x:mr(n[0],t[0])},{i:u-2,x:mr(n[1],t[1])});
}else{(1!==t[0]||1!==t[1])&&e.push(Ir(e)+"scale("+t+")");}}function $r(n,t){var e=[],r=[];return n=oa.transform(n),t=oa.transform(t),Yr(n.translate,t.translate,e,r),Zr(n.rotate,t.rotate,e,r),Vr(n.skew,t.skew,e,r),Xr(n.scale,t.scale,e,r),n=t=null,function(n){for(var t,u=-1,i=r.length;
++u<i;){e[(t=r[u]).i]=t.x(n);}return e.join("");};}function Br(n,t){return t=(t-=n=+n)||1/t,function(e){return(e-n)/t;
};}function Wr(n,t){return t=(t-=n=+n)||1/t,function(e){return Math.max(0,Math.min(1,(e-n)/t));};}function Jr(n){for(var t=n.source,e=n.target,r=Kr(t,e),u=[t];
t!==r;){t=t.parent,u.push(t);}for(var i=u.length;e!==r;){u.splice(i,0,e),e=e.parent;}return u;}function Gr(n){for(var t=[],e=n.parent;
null!=e;){t.push(n),n=e,e=e.parent;}return t.push(n),t;}function Kr(n,t){if(n===t){return n;}for(var e=Gr(n),r=Gr(t),u=e.pop(),i=r.pop(),a=null;
u===i;){a=u,u=e.pop(),i=r.pop();}return a;}function Qr(n){n.fixed|=2;}function nu(n){n.fixed&=-7;}function tu(n){n.fixed|=4,n.px=n.x,n.py=n.y;
}function eu(n){n.fixed&=-5;}function ru(n,t,e){var r=0,u=0;if(n.charge=0,!n.leaf){for(var i,a=n.nodes,o=a.length,l=-1;
++l<o;){i=a[l],null!=i&&(ru(i,t,e),n.charge+=i.charge,r+=i.charge*i.cx,u+=i.charge*i.cy);}}if(n.point){n.leaf||(n.point.x+=Math.random()-0.5,n.point.y+=Math.random()-0.5);
var c=t*e[n.point.index];n.charge+=n.pointCharge=c,r+=c*n.point.x,u+=c*n.point.y;}n.cx=r/n.charge,n.cy=u/n.charge;
}function uu(n,t){return oa.rebind(n,t,"sort","children","value"),n.nodes=n,n.links=su,n;}function iu(n,t){for(var e=[n];
null!=(n=e.pop());){if(t(n),(u=n.children)&&(r=u.length)){for(var r,u;--r>=0;){e.push(u[r]);}}}}function au(n,t){for(var e=[n],r=[];
null!=(n=e.pop());){if(r.push(n),(i=n.children)&&(u=i.length)){for(var u,i,a=-1;++a<u;){e.push(i[a]);
}}}for(;null!=(n=r.pop());){t(n);}}function ou(n){return n.children;}function lu(n){return n.value;}function cu(n,t){return t.value-n.value;
}function su(n){return oa.merge(n.map(function(n){return(n.children||[]).map(function(t){return{source:n,target:t};
});}));}function fu(n){return n.x;}function hu(n){return n.y;}function gu(n,t,e){n.y0=t,n.y=e;}function pu(n){return oa.range(n.length);
}function vu(n){for(var t=-1,e=n[0].length,r=[];++t<e;){r[t]=0;}return r;}function du(n){for(var t,e=1,r=0,u=n[0][1],i=n.length;
i>e;++e){(t=n[e][1])>u&&(r=e,u=t);}return r;}function mu(n){return n.reduce(yu,0);}function yu(n,t){return n+t[1];
}function Mu(n,t){return xu(n,Math.ceil(Math.log(t.length)/Math.LN2+1));}function xu(n,t){for(var e=-1,r=+n[0],u=(n[1]-r)/t,i=[];
++e<=t;){i[e]=u*e+r;}return i;}function bu(n){return[oa.min(n),oa.max(n)];}function _u(n,t){return n.value-t.value;
}function wu(n,t){var e=n._pack_next;n._pack_next=t,t._pack_prev=n,t._pack_next=e,e._pack_prev=t;}function Su(n,t){n._pack_next=t,t._pack_prev=n;
}function ku(n,t){var e=t.x-n.x,r=t.y-n.y,u=n.r+t.r;return 0.999*u*u>e*e+r*r;}function Nu(n){function t(n){s=Math.min(n.x-n.r,s),f=Math.max(n.x+n.r,f),h=Math.min(n.y-n.r,h),g=Math.max(n.y+n.r,g);
}if((e=n.children)&&(c=e.length)){var e,r,u,i,a,o,l,c,s=1/0,f=-(1/0),h=1/0,g=-(1/0);if(e.forEach(Eu),r=e[0],r.x=-r.r,r.y=0,t(r),c>1&&(u=e[1],u.x=u.r,u.y=0,t(u),c>2)){for(i=e[2],zu(r,u,i),t(i),wu(r,i),r._pack_prev=i,wu(i,u),u=r._pack_next,a=3;
c>a;a++){zu(r,u,i=e[a]);var p=0,v=1,d=1;for(o=u._pack_next;o!==u;o=o._pack_next,v++){if(ku(o,i)){p=1;
break;}}if(1==p){for(l=r._pack_prev;l!==o._pack_prev&&!ku(l,i);l=l._pack_prev,d++){}}p?(d>v||v==d&&u.r<r.r?Su(r,u=o):Su(r=l,u),a--):(wu(r,i),u=i,t(i));
}}var m=(s+f)/2,y=(h+g)/2,M=0;for(a=0;c>a;a++){i=e[a],i.x-=m,i.y-=y,M=Math.max(M,i.r+Math.sqrt(i.x*i.x+i.y*i.y));
}n.r=M,e.forEach(Au);}}function Eu(n){n._pack_next=n._pack_prev=n;}function Au(n){delete n._pack_next,delete n._pack_prev;
}function Cu(n,t,e,r){var u=n.children;if(n.x=t+=r*n.x,n.y=e+=r*n.y,n.r*=r,u){for(var i=-1,a=u.length;
++i<a;){Cu(u[i],t,e,r);}}}function zu(n,t,e){var r=n.r+e.r,u=t.x-n.x,i=t.y-n.y;if(r&&(u||i)){var a=t.r+e.r,o=u*u+i*i;
a*=a,r*=r;var l=0.5+(r-a)/(2*o),c=Math.sqrt(Math.max(0,2*a*(r+o)-(r-=o)*r-a*a))/(2*o);e.x=n.x+l*u+c*i,e.y=n.y+l*i-c*u;
}else{e.x=n.x+r,e.y=n.y;}}function Lu(n,t){return n.parent==t.parent?1:2;}function qu(n){var t=n.children;
return t.length?t[0]:n.t;}function Tu(n){var t,e=n.children;return(t=e.length)?e[t-1]:n.t;}function Ru(n,t,e){var r=e/(t.i-n.i);
t.c-=r,t.s+=e,n.c+=r,t.z+=e,t.m+=e;}function Du(n){for(var t,e=0,r=0,u=n.children,i=u.length;--i>=0;){t=u[i],t.z+=e,t.m+=e,e+=t.s+(r+=t.c);
}}function Pu(n,t,e){return n.a.parent===t.parent?n.a:e;}function ju(n){return 1+oa.max(n,function(n){return n.y;
});}function Uu(n){return n.reduce(function(n,t){return n+t.x;},0)/n.length;}function Fu(n){var t=n.children;
return t&&t.length?Fu(t[0]):n;}function Hu(n){var t,e=n.children;return e&&(t=e.length)?Hu(e[t-1]):n;
}function Ou(n){return{x:n.x,y:n.y,dx:n.dx,dy:n.dy};}function Iu(n,t){var e=n.x+t[3],r=n.y+t[0],u=n.dx-t[1]-t[3],i=n.dy-t[0]-t[2];
return 0>u&&(e+=u/2,u=0),0>i&&(r+=i/2,i=0),{x:e,y:r,dx:u,dy:i};}function Yu(n){var t=n[0],e=n[n.length-1];
return e>t?[t,e]:[e,t];}function Zu(n){return n.rangeExtent?n.rangeExtent():Yu(n.range());}function Vu(n,t,e,r){var u=e(n[0],n[1]),i=r(t[0],t[1]);
return function(n){return i(u(n));};}function Xu(n,t){var e,r=0,u=n.length-1,i=n[r],a=n[u];return i>a&&(e=r,r=u,u=e,e=i,i=a,a=e),n[r]=t.floor(i),n[u]=t.ceil(a),n;
}function $u(n){return n?{floor:function(t){return Math.floor(t/n)*n;},ceil:function(t){return Math.ceil(t/n)*n;
}}:wl;}function Bu(n,t,e,r){var u=[],i=[],a=0,o=Math.min(n.length,t.length)-1;for(n[o]<n[0]&&(n=n.slice().reverse(),t=t.slice().reverse());
++a<=o;){u.push(e(n[a-1],n[a])),i.push(r(t[a-1],t[a]));}return function(t){var e=oa.bisect(n,t,1,o)-1;
return i[e](u[e](t));};}function Wu(n,t,e,r){function u(){var u=Math.min(n.length,t.length)>2?Bu:Vu,l=r?Wr:Br;
return a=u(n,t,l,e),o=u(t,n,l,Mr),i;}function i(n){return a(n);}var a,o;return i.invert=function(n){return o(n);
},i.domain=function(t){return arguments.length?(n=t.map(Number),u()):n;},i.range=function(n){return arguments.length?(t=n,u()):t;
},i.rangeRound=function(n){return i.range(n).interpolate(jr);},i.clamp=function(n){return arguments.length?(r=n,u()):r;
},i.interpolate=function(n){return arguments.length?(e=n,u()):e;},i.ticks=function(t){return Qu(n,t);
},i.tickFormat=function(t,e){return ni(n,t,e);},i.nice=function(t){return Gu(n,t),u();},i.copy=function(){return Wu(n,t,e,r);
},u();}function Ju(n,t){return oa.rebind(n,t,"range","rangeRound","interpolate","clamp");}function Gu(n,t){return Xu(n,$u(Ku(n,t)[2])),Xu(n,$u(Ku(n,t)[2])),n;
}function Ku(n,t){null==t&&(t=10);var e=Yu(n),r=e[1]-e[0],u=Math.pow(10,Math.floor(Math.log(r/t)/Math.LN10)),i=t/r*u;
return 0.15>=i?u*=10:0.35>=i?u*=5:0.75>=i&&(u*=2),e[0]=Math.ceil(e[0]/u)*u,e[1]=Math.floor(e[1]/u)*u+0.5*u,e[2]=u,e;
}function Qu(n,t){return oa.range.apply(oa,Ku(n,t));}function ni(n,t,e){var r=Ku(n,t);if(e){var u=so.exec(e);
if(u.shift(),"s"===u[8]){var i=oa.formatPrefix(Math.max(Ma(r[0]),Ma(r[1])));return u[7]||(u[7]="."+ti(i.scale(r[2]))),u[8]="f",e=oa.format(u.join("")),function(n){return e(i.scale(n))+i.symbol;
};}u[7]||(u[7]="."+ei(u[8],r)),e=u.join("");}else{e=",."+ti(r[2])+"f";}return oa.format(e);}function ti(n){return -Math.floor(Math.log(n)/Math.LN10+0.01);
}function ei(n,t){var e=ti(t[2]);return n in Sl?Math.abs(e-ti(Math.max(Ma(t[0]),Ma(t[1]))))+ +("e"!==n):e-2*("%"===n);
}function ri(n,t,e,r){function u(n){return(e?Math.log(0>n?0:n):-Math.log(n>0?0:-n))/Math.log(t);}function i(n){return e?Math.pow(t,n):-Math.pow(t,-n);
}function a(t){return n(u(t));}return a.invert=function(t){return i(n.invert(t));},a.domain=function(t){return arguments.length?(e=t[0]>=0,n.domain((r=t.map(Number)).map(u)),a):r;
},a.base=function(e){return arguments.length?(t=+e,n.domain(r.map(u)),a):t;},a.nice=function(){var t=Xu(r.map(u),e?Math:Nl);
return n.domain(t),r=t.map(i),a;},a.ticks=function(){var n=Yu(r),a=[],o=n[0],l=n[1],c=Math.floor(u(o)),s=Math.ceil(u(l)),f=t%1?2:t;
if(isFinite(s-c)){if(e){for(;s>c;c++){for(var h=1;f>h;h++){a.push(i(c)*h);}}a.push(i(c));}else{for(a.push(i(c));
c++<s;){for(var h=f-1;h>0;h--){a.push(i(c)*h);}}}for(c=0;a[c]<o;c++){}for(s=a.length;a[s-1]>l;s--){}a=a.slice(c,s);
}return a;},a.tickFormat=function(n,e){if(!arguments.length){return kl;}arguments.length<2?e=kl:"function"!=typeof e&&(e=oa.format(e));
var r=Math.max(1,t*n/a.ticks().length);return function(n){var a=n/i(Math.round(u(n)));return t-0.5>a*t&&(a*=t),r>=a?e(n):"";
};},a.copy=function(){return ri(n.copy(),t,e,r);},Ju(a,n);}function ui(n,t,e){function r(t){return n(u(t));
}var u=ii(t),i=ii(1/t);return r.invert=function(t){return i(n.invert(t));},r.domain=function(t){return arguments.length?(n.domain((e=t.map(Number)).map(u)),r):e;
},r.ticks=function(n){return Qu(e,n);},r.tickFormat=function(n,t){return ni(e,n,t);},r.nice=function(n){return r.domain(Gu(e,n));
},r.exponent=function(a){return arguments.length?(u=ii(t=a),i=ii(1/t),n.domain(e.map(u)),r):t;},r.copy=function(){return ui(n.copy(),t,e);
},Ju(r,n);}function ii(n){return function(t){return 0>t?-Math.pow(-t,n):Math.pow(t,n);};}function ai(n,t){function e(e){return i[((u.get(e)||("range"===t.t?u.set(e,n.push(e)):NaN))-1)%i.length];
}function r(t,e){return oa.range(n.length).map(function(n){return t+e*n;});}var u,i,a;return e.domain=function(r){if(!arguments.length){return n;
}n=[],u=new c;for(var i,a=-1,o=r.length;++a<o;){u.has(i=r[a])||u.set(i,n.push(i));}return e[t.t].apply(e,t.a);
},e.range=function(n){return arguments.length?(i=n,a=0,t={t:"range",a:arguments},e):i;},e.rangePoints=function(u,o){arguments.length<2&&(o=0);
var l=u[0],c=u[1],s=n.length<2?(l=(l+c)/2,0):(c-l)/(n.length-1+o);return i=r(l+s*o/2,s),a=0,t={t:"rangePoints",a:arguments},e;
},e.rangeRoundPoints=function(u,o){arguments.length<2&&(o=0);var l=u[0],c=u[1],s=n.length<2?(l=c=Math.round((l+c)/2),0):(c-l)/(n.length-1+o)|0;
return i=r(l+Math.round(s*o/2+(c-l-(n.length-1+o)*s)/2),s),a=0,t={t:"rangeRoundPoints",a:arguments},e;
},e.rangeBands=function(u,o,l){arguments.length<2&&(o=0),arguments.length<3&&(l=o);var c=u[1]<u[0],s=u[c-0],f=u[1-c],h=(f-s)/(n.length-o+2*l);
return i=r(s+h*l,h),c&&i.reverse(),a=h*(1-o),t={t:"rangeBands",a:arguments},e;},e.rangeRoundBands=function(u,o,l){arguments.length<2&&(o=0),arguments.length<3&&(l=o);
var c=u[1]<u[0],s=u[c-0],f=u[1-c],h=Math.floor((f-s)/(n.length-o+2*l));return i=r(s+Math.round((f-s-(n.length-o)*h)/2),h),c&&i.reverse(),a=Math.round(h*(1-o)),t={t:"rangeRoundBands",a:arguments},e;
},e.rangeBand=function(){return a;},e.rangeExtent=function(){return Yu(t.a[0]);},e.copy=function(){return ai(n,t);
},e.domain(n);}function oi(n,t){function i(){var e=0,r=t.length;for(o=[];++e<r;){o[e-1]=oa.quantile(n,e/r);
}return a;}function a(n){return isNaN(n=+n)?void 0:t[oa.bisect(o,n)];}var o;return a.domain=function(t){return arguments.length?(n=t.map(r).filter(u).sort(e),i()):n;
},a.range=function(n){return arguments.length?(t=n,i()):t;},a.quantiles=function(){return o;},a.invertExtent=function(e){return e=t.indexOf(e),0>e?[NaN,NaN]:[e>0?o[e-1]:n[0],e<o.length?o[e]:n[n.length-1]];
},a.copy=function(){return oi(n,t);},i();}function li(n,t,e){function r(t){return e[Math.max(0,Math.min(a,Math.floor(i*(t-n))))];
}function u(){return i=e.length/(t-n),a=e.length-1,r;}var i,a;return r.domain=function(e){return arguments.length?(n=+e[0],t=+e[e.length-1],u()):[n,t];
},r.range=function(n){return arguments.length?(e=n,u()):e;},r.invertExtent=function(t){return t=e.indexOf(t),t=0>t?NaN:t/i+n,[t,t+1/i];
},r.copy=function(){return li(n,t,e);},u();}function ci(n,t){function e(e){return e>=e?t[oa.bisect(n,e)]:void 0;
}return e.domain=function(t){return arguments.length?(n=t,e):n;},e.range=function(n){return arguments.length?(t=n,e):t;
},e.invertExtent=function(e){return e=t.indexOf(e),[n[e-1],n[e]];},e.copy=function(){return ci(n,t);},e;
}function si(n){function t(n){return +n;}return t.invert=t,t.domain=t.range=function(e){return arguments.length?(n=e.map(t),t):n;
},t.ticks=function(t){return Qu(n,t);},t.tickFormat=function(t,e){return ni(n,t,e);},t.copy=function(){return si(n);
},t;}function fi(){return 0;}function hi(n){return n.innerRadius;}function gi(n){return n.outerRadius;
}function pi(n){return n.startAngle;}function vi(n){return n.endAngle;}function di(n){return n&&n.padAngle;
}function mi(n,t,e,r){return(n-e)*t-(t-r)*n>0?0:1;}function yi(n,t,e,r,u){var i=n[0]-t[0],a=n[1]-t[1],o=(u?r:-r)/Math.sqrt(i*i+a*a),l=o*a,c=-o*i,s=n[0]+l,f=n[1]+c,h=t[0]+l,g=t[1]+c,p=(s+h)/2,v=(f+g)/2,d=h-s,m=g-f,y=d*d+m*m,M=e-r,x=s*g-h*f,b=(0>m?-1:1)*Math.sqrt(Math.max(0,M*M*y-x*x)),_=(x*m-d*b)/y,w=(-x*d-m*b)/y,S=(x*m+d*b)/y,k=(-x*d+m*b)/y,N=_-p,E=w-v,A=S-p,C=k-v;
return N*N+E*E>A*A+C*C&&(_=S,w=k),[[_-l,w-c],[_*e/M,w*e/M]];}function Mi(n){function t(t){function a(){c.push("M",i(n(s),o));
}for(var l,c=[],s=[],f=-1,h=t.length,g=En(e),p=En(r);++f<h;){u.call(this,l=t[f],f)?s.push([+g.call(this,l,f),+p.call(this,l,f)]):s.length&&(a(),s=[]);
}return s.length&&a(),c.length?c.join(""):null;}var e=Ce,r=ze,u=zt,i=xi,a=i.key,o=0.7;return t.x=function(n){return arguments.length?(e=n,t):e;
},t.y=function(n){return arguments.length?(r=n,t):r;},t.defined=function(n){return arguments.length?(u=n,t):u;
},t.interpolate=function(n){return arguments.length?(a="function"==typeof n?i=n:(i=ql.get(n)||xi).key,t):a;
},t.tension=function(n){return arguments.length?(o=n,t):o;},t;}function xi(n){return n.length>1?n.join("L"):n+"Z";
}function bi(n){return n.join("L")+"Z";}function _i(n){for(var t=0,e=n.length,r=n[0],u=[r[0],",",r[1]];
++t<e;){u.push("H",(r[0]+(r=n[t])[0])/2,"V",r[1]);}return e>1&&u.push("H",r[0]),u.join("");}function wi(n){for(var t=0,e=n.length,r=n[0],u=[r[0],",",r[1]];
++t<e;){u.push("V",(r=n[t])[1],"H",r[0]);}return u.join("");}function Si(n){for(var t=0,e=n.length,r=n[0],u=[r[0],",",r[1]];
++t<e;){u.push("H",(r=n[t])[0],"V",r[1]);}return u.join("");}function ki(n,t){return n.length<4?xi(n):n[1]+Ai(n.slice(1,-1),Ci(n,t));
}function Ni(n,t){return n.length<3?bi(n):n[0]+Ai((n.push(n[0]),n),Ci([n[n.length-2]].concat(n,[n[1]]),t));
}function Ei(n,t){return n.length<3?xi(n):n[0]+Ai(n,Ci(n,t));}function Ai(n,t){if(t.length<1||n.length!=t.length&&n.length!=t.length+2){return xi(n);
}var e=n.length!=t.length,r="",u=n[0],i=n[1],a=t[0],o=a,l=1;if(e&&(r+="Q"+(i[0]-2*a[0]/3)+","+(i[1]-2*a[1]/3)+","+i[0]+","+i[1],u=n[1],l=2),t.length>1){o=t[1],i=n[l],l++,r+="C"+(u[0]+a[0])+","+(u[1]+a[1])+","+(i[0]-o[0])+","+(i[1]-o[1])+","+i[0]+","+i[1];
for(var c=2;c<t.length;c++,l++){i=n[l],o=t[c],r+="S"+(i[0]-o[0])+","+(i[1]-o[1])+","+i[0]+","+i[1];}}if(e){var s=n[l];
r+="Q"+(i[0]+2*o[0]/3)+","+(i[1]+2*o[1]/3)+","+s[0]+","+s[1];}return r;}function Ci(n,t){for(var e,r=[],u=(1-t)/2,i=n[0],a=n[1],o=1,l=n.length;
++o<l;){e=i,i=a,a=n[o],r.push([u*(a[0]-e[0]),u*(a[1]-e[1])]);}return r;}function zi(n){if(n.length<3){return xi(n);
}var t=1,e=n.length,r=n[0],u=r[0],i=r[1],a=[u,u,u,(r=n[1])[0]],o=[i,i,i,r[1]],l=[u,",",i,"L",Ri(Dl,a),",",Ri(Dl,o)];
for(n.push(n[e-1]);++t<=e;){r=n[t],a.shift(),a.push(r[0]),o.shift(),o.push(r[1]),Di(l,a,o);}return n.pop(),l.push("L",r),l.join("");
}function Li(n){if(n.length<4){return xi(n);}for(var t,e=[],r=-1,u=n.length,i=[0],a=[0];++r<3;){t=n[r],i.push(t[0]),a.push(t[1]);
}for(e.push(Ri(Dl,i)+","+Ri(Dl,a)),--r;++r<u;){t=n[r],i.shift(),i.push(t[0]),a.shift(),a.push(t[1]),Di(e,i,a);
}return e.join("");}function qi(n){for(var t,e,r=-1,u=n.length,i=u+4,a=[],o=[];++r<4;){e=n[r%u],a.push(e[0]),o.push(e[1]);
}for(t=[Ri(Dl,a),",",Ri(Dl,o)],--r;++r<i;){e=n[r%u],a.shift(),a.push(e[0]),o.shift(),o.push(e[1]),Di(t,a,o);
}return t.join("");}function Ti(n,t){var e=n.length-1;if(e){for(var r,u,i=n[0][0],a=n[0][1],o=n[e][0]-i,l=n[e][1]-a,c=-1;
++c<=e;){r=n[c],u=c/e,r[0]=t*r[0]+(1-t)*(i+u*o),r[1]=t*r[1]+(1-t)*(a+u*l);}}return zi(n);}function Ri(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]+n[3]*t[3];
}function Di(n,t,e){n.push("C",Ri(Tl,t),",",Ri(Tl,e),",",Ri(Rl,t),",",Ri(Rl,e),",",Ri(Dl,t),",",Ri(Dl,e));
}function Pi(n,t){return(t[1]-n[1])/(t[0]-n[0]);}function ji(n){for(var t=0,e=n.length-1,r=[],u=n[0],i=n[1],a=r[0]=Pi(u,i);
++t<e;){r[t]=(a+(a=Pi(u=i,i=n[t+1])))/2;}return r[t]=a,r;}function Ui(n){for(var t,e,r,u,i=[],a=ji(n),o=-1,l=n.length-1;
++o<l;){t=Pi(n[o],n[o+1]),Ma(t)<Da?a[o]=a[o+1]=0:(e=a[o]/t,r=a[o+1]/t,u=e*e+r*r,u>9&&(u=3*t/Math.sqrt(u),a[o]=u*e,a[o+1]=u*r));
}for(o=-1;++o<=l;){u=(n[Math.min(l,o+1)][0]-n[Math.max(0,o-1)][0])/(6*(1+a[o]*a[o])),i.push([u||0,a[o]*u||0]);
}return i;}function Fi(n){return n.length<3?xi(n):n[0]+Ai(n,Ui(n));}function Hi(n){for(var t,e,r,u=-1,i=n.length;
++u<i;){t=n[u],e=t[0],r=t[1]-Ha,t[0]=e*Math.cos(r),t[1]=e*Math.sin(r);}return n;}function Oi(n){function t(t){function l(){v.push("M",o(n(m),f),s,c(n(d.reverse()),f),"Z");
}for(var h,g,p,v=[],d=[],m=[],y=-1,M=t.length,x=En(e),b=En(u),_=e===r?function(){return g;}:En(r),w=u===i?function(){return p;
}:En(i);++y<M;){a.call(this,h=t[y],y)?(d.push([g=+x.call(this,h,y),p=+b.call(this,h,y)]),m.push([+_.call(this,h,y),+w.call(this,h,y)])):d.length&&(l(),d=[],m=[]);
}return d.length&&l(),v.length?v.join(""):null;}var e=Ce,r=Ce,u=0,i=ze,a=zt,o=xi,l=o.key,c=o,s="L",f=0.7;
return t.x=function(n){return arguments.length?(e=r=n,t):r;},t.x0=function(n){return arguments.length?(e=n,t):e;
},t.x1=function(n){return arguments.length?(r=n,t):r;},t.y=function(n){return arguments.length?(u=i=n,t):i;
},t.y0=function(n){return arguments.length?(u=n,t):u;},t.y1=function(n){return arguments.length?(i=n,t):i;
},t.defined=function(n){return arguments.length?(a=n,t):a;},t.interpolate=function(n){return arguments.length?(l="function"==typeof n?o=n:(o=ql.get(n)||xi).key,c=o.reverse||o,s=o.closed?"M":"L",t):l;
},t.tension=function(n){return arguments.length?(f=n,t):f;},t;}function Ii(n){return n.radius;}function Yi(n){return[n.x,n.y];
}function Zi(n){return function(){var t=n.apply(this,arguments),e=t[0],r=t[1]-Ha;return[e*Math.cos(r),e*Math.sin(r)];
};}function Vi(){return 64;}function Xi(){return"circle";}function $i(n){var t=Math.sqrt(n/ja);return"M0,"+t+"A"+t+","+t+" 0 1,1 0,"+-t+"A"+t+","+t+" 0 1,1 0,"+t+"Z";
}function Bi(n){return function(){var t,e,r;(t=this[n])&&(r=t[e=t.active])&&(r.timer.c=null,r.timer.t=NaN,--t.count?delete t[e]:delete this[n],t.active+=0.5,r.event&&r.event.interrupt.call(this,this.__data__,r.index));
};}function Wi(n,t,e){return Sa(n,Il),n.namespace=t,n.id=e,n;}function Ji(n,t,e,r){var u=n.id,i=n.namespace;
return Y(n,"function"==typeof e?function(n,a,o){n[i][u].tween.set(t,r(e.call(n,n.__data__,a,o)));}:(e=r(e),function(n){n[i][u].tween.set(t,e);
}));}function Gi(n){return null==n&&(n=""),function(){this.textContent=n;};}function Ki(n){return null==n?"__transition__":"__transition_"+n+"__";
}function Qi(n,t,e,r,u){function i(n){var t=v.delay;return s.t=t+l,n>=t?a(n-t):void (s.c=a);}function a(e){var u=p.active,i=p[u];
i&&(i.timer.c=null,i.timer.t=NaN,--p.count,delete p[u],i.event&&i.event.interrupt.call(n,n.__data__,i.index));
for(var a in p){if(r>+a){var c=p[a];c.timer.c=null,c.timer.t=NaN,--p.count,delete p[a];}}s.c=o,qn(function(){return s.c&&o(e||1)&&(s.c=null,s.t=NaN),1;
},0,l),p.active=r,v.event&&v.event.start.call(n,n.__data__,t),g=[],v.tween.forEach(function(e,r){(r=r.call(n,n.__data__,t))&&g.push(r);
}),h=v.ease,f=v.duration;}function o(u){for(var i=u/f,a=h(i),o=g.length;o>0;){g[--o].call(n,a);}return i>=1?(v.event&&v.event.end.call(n,n.__data__,t),--p.count?delete p[r]:delete n[e],1):void 0;
}var l,s,f,h,g,p=n[e]||(n[e]={active:0,count:0}),v=p[r];v||(l=u.time,s=qn(i,0,l),v=p[r]={tween:new c,time:l,timer:s,delay:u.delay,duration:u.duration,ease:u.ease,index:t},u=null,++p.count);
}function na(n,t,e){n.attr("transform",function(n){var r=t(n);return"translate("+(isFinite(r)?r:e(n))+",0)";
});}function ta(n,t,e){n.attr("transform",function(n){var r=t(n);return"translate(0,"+(isFinite(r)?r:e(n))+")";
});}function ea(n){return n.toISOString();}function ra(n,t,e){function r(t){return n(t);}function u(n,e){var r=n[1]-n[0],u=r/e,i=oa.bisect(Gl,u);
return i==Gl.length?[t.year,Ku(n.map(function(n){return n/31536000000;}),e)[2]]:i?t[u/Gl[i-1]<Gl[i]/u?i-1:i]:[nc,Ku(n,e)[2]];
}return r.invert=function(t){return ua(n.invert(t));},r.domain=function(t){return arguments.length?(n.domain(t),r):n.domain().map(ua);
},r.nice=function(n,t){function e(e){return !isNaN(e)&&!n.range(e,ua(+e+1),t).length;}var i=r.domain(),a=Yu(i),o=null==n?u(a,10):"number"==typeof n&&u(a,n);
return o&&(n=o[0],t=o[1]),r.domain(Xu(i,t>1?{floor:function(t){for(;e(t=n.floor(t));){t=ua(t-1);}return t;
},ceil:function(t){for(;e(t=n.ceil(t));){t=ua(+t+1);}return t;}}:n));},r.ticks=function(n,t){var e=Yu(r.domain()),i=null==n?u(e,10):"number"==typeof n?u(e,n):!n.range&&[{range:n},t];
return i&&(n=i[0],t=i[1]),n.range(e[0],ua(+e[1]+1),1>t?1:t);},r.tickFormat=function(){return e;},r.copy=function(){return ra(n.copy(),t,e);
},Ju(r,n);}function ua(n){return new Date(n);}function ia(n){return JSON.parse(n.responseText);}function aa(n){var t=sa.createRange();
return t.selectNode(sa.body),t.createContextualFragment(n.responseText);}var oa={version:"3.5.12"},la=[].slice,ca=function(n){return la.call(n);
},sa=this.document;if(sa){try{ca(sa.documentElement.childNodes)[0].nodeType;}catch(fa){ca=function(n){for(var t=n.length,e=new Array(t);
t--;){e[t]=n[t];}return e;};}}if(Date.now||(Date.now=function(){return +new Date;}),sa){try{sa.createElement("DIV").style.setProperty("opacity",0,"");
}catch(ha){var ga=this.Element.prototype,pa=ga.setAttribute,va=ga.setAttributeNS,da=this.CSSStyleDeclaration.prototype,ma=da.setProperty;
ga.setAttribute=function(n,t){pa.call(this,n,t+"");},ga.setAttributeNS=function(n,t,e){va.call(this,n,t,e+"");
},da.setProperty=function(n,t,e){ma.call(this,n,t+"",e);};}}oa.ascending=e,oa.descending=function(n,t){return n>t?-1:t>n?1:t>=n?0:NaN;
},oa.min=function(n,t){var e,r,u=-1,i=n.length;if(1===arguments.length){for(;++u<i;){if(null!=(r=n[u])&&r>=r){e=r;
break;}}for(;++u<i;){null!=(r=n[u])&&e>r&&(e=r);}}else{for(;++u<i;){if(null!=(r=t.call(n,n[u],u))&&r>=r){e=r;
break;}}for(;++u<i;){null!=(r=t.call(n,n[u],u))&&e>r&&(e=r);}}return e;},oa.max=function(n,t){var e,r,u=-1,i=n.length;
if(1===arguments.length){for(;++u<i;){if(null!=(r=n[u])&&r>=r){e=r;break;}}for(;++u<i;){null!=(r=n[u])&&r>e&&(e=r);
}}else{for(;++u<i;){if(null!=(r=t.call(n,n[u],u))&&r>=r){e=r;break;}}for(;++u<i;){null!=(r=t.call(n,n[u],u))&&r>e&&(e=r);
}}return e;},oa.extent=function(n,t){var e,r,u,i=-1,a=n.length;if(1===arguments.length){for(;++i<a;){if(null!=(r=n[i])&&r>=r){e=u=r;
break;}}for(;++i<a;){null!=(r=n[i])&&(e>r&&(e=r),r>u&&(u=r));}}else{for(;++i<a;){if(null!=(r=t.call(n,n[i],i))&&r>=r){e=u=r;
break;}}for(;++i<a;){null!=(r=t.call(n,n[i],i))&&(e>r&&(e=r),r>u&&(u=r));}}return[e,u];},oa.sum=function(n,t){var e,r=0,i=n.length,a=-1;
if(1===arguments.length){for(;++a<i;){u(e=+n[a])&&(r+=e);}}else{for(;++a<i;){u(e=+t.call(n,n[a],a))&&(r+=e);
}}return r;},oa.mean=function(n,t){var e,i=0,a=n.length,o=-1,l=a;if(1===arguments.length){for(;++o<a;
){u(e=r(n[o]))?i+=e:--l;}}else{for(;++o<a;){u(e=r(t.call(n,n[o],o)))?i+=e:--l;}}return l?i/l:void 0;},oa.quantile=function(n,t){var e=(n.length-1)*t+1,r=Math.floor(e),u=+n[r-1],i=e-r;
return i?u+i*(n[r]-u):u;},oa.median=function(n,t){var i,a=[],o=n.length,l=-1;if(1===arguments.length){for(;
++l<o;){u(i=r(n[l]))&&a.push(i);}}else{for(;++l<o;){u(i=r(t.call(n,n[l],l)))&&a.push(i);}}return a.length?oa.quantile(a.sort(e),0.5):void 0;
},oa.variance=function(n,t){var e,i,a=n.length,o=0,l=0,c=-1,s=0;if(1===arguments.length){for(;++c<a;){u(e=r(n[c]))&&(i=e-o,o+=i/++s,l+=i*(e-o));
}}else{for(;++c<a;){u(e=r(t.call(n,n[c],c)))&&(i=e-o,o+=i/++s,l+=i*(e-o));}}return s>1?l/(s-1):void 0;
},oa.deviation=function(){var n=oa.variance.apply(this,arguments);return n?Math.sqrt(n):n;};var ya=i(e);
oa.bisectLeft=ya.left,oa.bisect=oa.bisectRight=ya.right,oa.bisector=function(n){return i(1===n.length?function(t,r){return e(n(t),r);
}:n);},oa.shuffle=function(n,t,e){(i=arguments.length)<3&&(e=n.length,2>i&&(t=0));for(var r,u,i=e-t;i;
){u=Math.random()*i--|0,r=n[i+t],n[i+t]=n[u+t],n[u+t]=r;}return n;},oa.permute=function(n,t){for(var e=t.length,r=new Array(e);
e--;){r[e]=n[t[e]];}return r;},oa.pairs=function(n){for(var t,e=0,r=n.length-1,u=n[0],i=new Array(0>r?0:r);
r>e;){i[e]=[t=u,u=n[++e]];}return i;},oa.zip=function(){if(!(r=arguments.length)){return[];}for(var n=-1,t=oa.min(arguments,a),e=new Array(t);
++n<t;){for(var r,u=-1,i=e[n]=new Array(r);++u<r;){i[u]=arguments[u][n];}}return e;},oa.transpose=function(n){return oa.zip.apply(oa,n);
},oa.keys=function(n){var t=[];for(var e in n){t.push(e);}return t;},oa.values=function(n){var t=[];for(var e in n){t.push(n[e]);
}return t;},oa.entries=function(n){var t=[];for(var e in n){t.push({key:e,value:n[e]});}return t;},oa.merge=function(n){for(var t,e,r,u=n.length,i=-1,a=0;
++i<u;){a+=n[i].length;}for(e=new Array(a);--u>=0;){for(r=n[u],t=r.length;--t>=0;){e[--a]=r[t];}}return e;
};var Ma=Math.abs;oa.range=function(n,t,e){if(arguments.length<3&&(e=1,arguments.length<2&&(t=n,n=0)),(t-n)/e===1/0){throw new Error("infinite range");
}var r,u=[],i=o(Ma(e)),a=-1;if(n*=i,t*=i,e*=i,0>e){for(;(r=n+e*++a)>t;){u.push(r/i);}}else{for(;(r=n+e*++a)<t;
){u.push(r/i);}}return u;},oa.map=function(n,t){var e=new c;if(n instanceof c){n.forEach(function(n,t){e.set(n,t);
});}else{if(Array.isArray(n)){var r,u=-1,i=n.length;if(1===arguments.length){for(;++u<i;){e.set(u,n[u]);
}}else{for(;++u<i;){e.set(t.call(n,r=n[u],u),r);}}}else{for(var a in n){e.set(a,n[a]);}}}return e;};var xa="__proto__",ba="\x00";
l(c,{has:h,get:function(n){return this._[s(n)];},set:function(n,t){return this._[s(n)]=t;},remove:g,keys:p,values:function(){var n=[];
for(var t in this._){n.push(this._[t]);}return n;},entries:function(){var n=[];for(var t in this._){n.push({key:f(t),value:this._[t]});
}return n;},size:v,empty:d,forEach:function(n){for(var t in this._){n.call(this,f(t),this._[t]);}}}),oa.nest=function(){function n(t,a,o){if(o>=i.length){return r?r.call(u,a):e?a.sort(e):a;
}for(var l,s,f,h,g=-1,p=a.length,v=i[o++],d=new c;++g<p;){(h=d.get(l=v(s=a[g])))?h.push(s):d.set(l,[s]);
}return t?(s=t(),f=function(e,r){s.set(e,n(t,r,o));}):(s={},f=function(e,r){s[e]=n(t,r,o);}),d.forEach(f),s;
}function t(n,e){if(e>=i.length){return n;}var r=[],u=a[e++];return n.forEach(function(n,u){r.push({key:n,values:t(u,e)});
}),u?r.sort(function(n,t){return u(n.key,t.key);}):r;}var e,r,u={},i=[],a=[];return u.map=function(t,e){return n(e,t,0);
},u.entries=function(e){return t(n(oa.map,e,0),0);},u.key=function(n){return i.push(n),u;},u.sortKeys=function(n){return a[i.length-1]=n,u;
},u.sortValues=function(n){return e=n,u;},u.rollup=function(n){return r=n,u;},u;},oa.set=function(n){var t=new m;
if(n){for(var e=0,r=n.length;r>e;++e){t.add(n[e]);}}return t;},l(m,{has:h,add:function(n){return this._[s(n+="")]=!0,n;
},remove:g,values:p,size:v,empty:d,forEach:function(n){for(var t in this._){n.call(this,f(t));}}}),oa.behavior={},oa.rebind=function(n,t){for(var e,r=1,u=arguments.length;
++r<u;){n[e=arguments[r]]=M(n,t,t[e]);}return n;};var _a=["webkit","ms","moz","Moz","o","O"];oa.dispatch=function(){for(var n=new _,t=-1,e=arguments.length;
++t<e;){n[arguments[t]]=w(n);}return n;},_.prototype.on=function(n,t){var e=n.indexOf("."),r="";if(e>=0&&(r=n.slice(e+1),n=n.slice(0,e)),n){return arguments.length<2?this[n].on(r):this[n].on(r,t);
}if(2===arguments.length){if(null==t){for(n in this){this.hasOwnProperty(n)&&this[n].on(r,null);}}return this;
}},oa.event=null,oa.requote=function(n){return n.replace(wa,"\\$&");};var wa=/[\\\^\$\*\+\?\|\[\]\(\)\.\{\}]/g,Sa={}.__proto__?function(n,t){n.__proto__=t;
}:function(n,t){for(var e in t){n[e]=t[e];}},ka=function(n,t){return t.querySelector(n);},Na=function(n,t){return t.querySelectorAll(n);
},Ea=function(n,t){var e=n.matches||n[x(n,"matchesSelector")];return(Ea=function(n,t){return e.call(n,t);
})(n,t);};"function"==typeof Sizzle&&(ka=function(n,t){return Sizzle(n,t)[0]||null;},Na=Sizzle,Ea=Sizzle.matchesSelector),oa.selection=function(){return oa.select(sa.documentElement);
};var Aa=oa.selection.prototype=[];Aa.select=function(n){var t,e,r,u,i=[];n=A(n);for(var a=-1,o=this.length;
++a<o;){i.push(t=[]),t.parentNode=(r=this[a]).parentNode;for(var l=-1,c=r.length;++l<c;){(u=r[l])?(t.push(e=n.call(u,u.__data__,l,a)),e&&"__data__" in u&&(e.__data__=u.__data__)):t.push(null);
}}return E(i);},Aa.selectAll=function(n){var t,e,r=[];n=C(n);for(var u=-1,i=this.length;++u<i;){for(var a=this[u],o=-1,l=a.length;
++o<l;){(e=a[o])&&(r.push(t=ca(n.call(e,e.__data__,o,u))),t.parentNode=e);}}return E(r);};var Ca={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};
oa.ns={prefix:Ca,qualify:function(n){var t=n.indexOf(":"),e=n;return t>=0&&"xmlns"!==(e=n.slice(0,t))&&(n=n.slice(t+1)),Ca.hasOwnProperty(e)?{space:Ca[e],local:n}:n;
}},Aa.attr=function(n,t){if(arguments.length<2){if("string"==typeof n){var e=this.node();return n=oa.ns.qualify(n),n.local?e.getAttributeNS(n.space,n.local):e.getAttribute(n);
}for(t in n){this.each(z(t,n[t]));}return this;}return this.each(z(n,t));},Aa.classed=function(n,t){if(arguments.length<2){if("string"==typeof n){var e=this.node(),r=(n=T(n)).length,u=-1;
if(t=e.classList){for(;++u<r;){if(!t.contains(n[u])){return !1;}}}else{for(t=e.getAttribute("class");
++u<r;){if(!q(n[u]).test(t)){return !1;}}}return !0;}for(t in n){this.each(R(t,n[t]));}return this;}return this.each(R(n,t));
},Aa.style=function(n,e,r){var u=arguments.length;if(3>u){if("string"!=typeof n){2>u&&(e="");for(r in n){this.each(P(r,n[r],e));
}return this;}if(2>u){var i=this.node();return t(i).getComputedStyle(i,null).getPropertyValue(n);}r="";
}return this.each(P(n,e,r));},Aa.property=function(n,t){if(arguments.length<2){if("string"==typeof n){return this.node()[n];
}for(t in n){this.each(j(t,n[t]));}return this;}return this.each(j(n,t));},Aa.text=function(n){return arguments.length?this.each("function"==typeof n?function(){var t=n.apply(this,arguments);
this.textContent=null==t?"":t;}:null==n?function(){this.textContent="";}:function(){this.textContent=n;
}):this.node().textContent;},Aa.html=function(n){return arguments.length?this.each("function"==typeof n?function(){var t=n.apply(this,arguments);
this.innerHTML=null==t?"":t;}:null==n?function(){this.innerHTML="";}:function(){this.innerHTML=n;}):this.node().innerHTML;
},Aa.append=function(n){return n=U(n),this.select(function(){return this.appendChild(n.apply(this,arguments));
});},Aa.insert=function(n,t){return n=U(n),t=A(t),this.select(function(){return this.insertBefore(n.apply(this,arguments),t.apply(this,arguments)||null);
});},Aa.remove=function(){return this.each(F);},Aa.data=function(n,t){function e(n,e){var r,u,i,a=n.length,f=e.length,h=Math.min(a,f),g=new Array(f),p=new Array(f),v=new Array(a);
if(t){var d,m=new c,y=new Array(a);for(r=-1;++r<a;){(u=n[r])&&(m.has(d=t.call(u,u.__data__,r))?v[r]=u:m.set(d,u),y[r]=d);
}for(r=-1;++r<f;){(u=m.get(d=t.call(e,i=e[r],r)))?u!==!0&&(g[r]=u,u.__data__=i):p[r]=H(i),m.set(d,!0);
}for(r=-1;++r<a;){r in y&&m.get(y[r])!==!0&&(v[r]=n[r]);}}else{for(r=-1;++r<h;){u=n[r],i=e[r],u?(u.__data__=i,g[r]=u):p[r]=H(i);
}for(;f>r;++r){p[r]=H(e[r]);}for(;a>r;++r){v[r]=n[r];}}p.update=g,p.parentNode=g.parentNode=v.parentNode=n.parentNode,o.push(p),l.push(g),s.push(v);
}var r,u,i=-1,a=this.length;if(!arguments.length){for(n=new Array(a=(r=this[0]).length);++i<a;){(u=r[i])&&(n[i]=u.__data__);
}return n;}var o=Z([]),l=E([]),s=E([]);if("function"==typeof n){for(;++i<a;){e(r=this[i],n.call(r,r.parentNode.__data__,i));
}}else{for(;++i<a;){e(r=this[i],n);}}return l.enter=function(){return o;},l.exit=function(){return s;
},l;},Aa.datum=function(n){return arguments.length?this.property("__data__",n):this.property("__data__");
},Aa.filter=function(n){var t,e,r,u=[];"function"!=typeof n&&(n=O(n));for(var i=0,a=this.length;a>i;i++){u.push(t=[]),t.parentNode=(e=this[i]).parentNode;
for(var o=0,l=e.length;l>o;o++){(r=e[o])&&n.call(r,r.__data__,o,i)&&t.push(r);}}return E(u);},Aa.order=function(){for(var n=-1,t=this.length;
++n<t;){for(var e,r=this[n],u=r.length-1,i=r[u];--u>=0;){(e=r[u])&&(i&&i!==e.nextSibling&&i.parentNode.insertBefore(e,i),i=e);
}}return this;},Aa.sort=function(n){n=I.apply(this,arguments);for(var t=-1,e=this.length;++t<e;){this[t].sort(n);
}return this.order();},Aa.each=function(n){return Y(this,function(t,e,r){n.call(t,t.__data__,e,r);});
},Aa.call=function(n){var t=ca(arguments);return n.apply(t[0]=this,t),this;},Aa.empty=function(){return !this.node();
},Aa.node=function(){for(var n=0,t=this.length;t>n;n++){for(var e=this[n],r=0,u=e.length;u>r;r++){var i=e[r];
if(i){return i;}}}return null;},Aa.size=function(){var n=0;return Y(this,function(){++n;}),n;};var za=[];
oa.selection.enter=Z,oa.selection.enter.prototype=za,za.append=Aa.append,za.empty=Aa.empty,za.node=Aa.node,za.call=Aa.call,za.size=Aa.size,za.select=function(n){for(var t,e,r,u,i,a=[],o=-1,l=this.length;
++o<l;){r=(u=this[o]).update,a.push(t=[]),t.parentNode=u.parentNode;for(var c=-1,s=u.length;++c<s;){(i=u[c])?(t.push(r[c]=e=n.call(u.parentNode,i.__data__,c,o)),e.__data__=i.__data__):t.push(null);
}}return E(a);},za.insert=function(n,t){return arguments.length<2&&(t=V(this)),Aa.insert.call(this,n,t);
},oa.select=function(t){var e;return"string"==typeof t?(e=[ka(t,sa)],e.parentNode=sa.documentElement):(e=[t],e.parentNode=n(t)),E([e]);
},oa.selectAll=function(n){var t;return"string"==typeof n?(t=ca(Na(n,sa)),t.parentNode=sa.documentElement):(t=ca(n),t.parentNode=null),E([t]);
},Aa.on=function(n,t,e){var r=arguments.length;if(3>r){if("string"!=typeof n){2>r&&(t=!1);for(e in n){this.each(X(e,n[e],t));
}return this;}if(2>r){return(r=this.node()["__on"+n])&&r._;}e=!1;}return this.each(X(n,t,e));};var La=oa.map({mouseenter:"mouseover",mouseleave:"mouseout"});
sa&&La.forEach(function(n){"on"+n in sa&&La.remove(n);});var qa,Ta=0;oa.mouse=function(n){return J(n,k());
};var Ra=this.navigator&&/WebKit/.test(this.navigator.userAgent)?-1:0;oa.touch=function(n,t,e){if(arguments.length<3&&(e=t,t=k().changedTouches),t){for(var r,u=0,i=t.length;
i>u;++u){if((r=t[u]).identifier===e){return J(n,r);}}}},oa.behavior.drag=function(){function n(){this.on("mousedown.drag",i).on("touchstart.drag",a);
}function e(n,t,e,i,a){return function(){function o(){var n,e,r=t(h,v);r&&(n=r[0]-M[0],e=r[1]-M[1],p|=n|e,M=r,g({type:"drag",x:r[0]+c[0],y:r[1]+c[1],dx:n,dy:e}));
}function l(){t(h,v)&&(m.on(i+d,null).on(a+d,null),y(p),g({type:"dragend"}));}var c,s=this,f=oa.event.target,h=s.parentNode,g=r.of(s,arguments),p=0,v=n(),d=".drag"+(null==v?"":"-"+v),m=oa.select(e(f)).on(i+d,o).on(a+d,l),y=W(f),M=t(h,v);
u?(c=u.apply(s,arguments),c=[c.x-M[0],c.y-M[1]]):c=[0,0],g({type:"dragstart"});};}var r=N(n,"drag","dragstart","dragend"),u=null,i=e(b,oa.mouse,t,"mousemove","mouseup"),a=e(G,oa.touch,y,"touchmove","touchend");
return n.origin=function(t){return arguments.length?(u=t,n):u;},oa.rebind(n,r,"on");},oa.touches=function(n,t){return arguments.length<2&&(t=k().touches),t?ca(t).map(function(t){var e=J(n,t);
return e.identifier=t.identifier,e;}):[];};var Da=0.000001,Pa=Da*Da,ja=Math.PI,Ua=2*ja,Fa=Ua-Da,Ha=ja/2,Oa=ja/180,Ia=180/ja,Ya=Math.SQRT2,Za=2,Va=4;
oa.interpolateZoom=function(n,t){var e,r,u=n[0],i=n[1],a=n[2],o=t[0],l=t[1],c=t[2],s=o-u,f=l-i,h=s*s+f*f;
if(Pa>h){r=Math.log(c/a)/Ya,e=function(n){return[u+n*s,i+n*f,a*Math.exp(Ya*n*r)];};}else{var g=Math.sqrt(h),p=(c*c-a*a+Va*h)/(2*a*Za*g),v=(c*c-a*a-Va*h)/(2*c*Za*g),d=Math.log(Math.sqrt(p*p+1)-p),m=Math.log(Math.sqrt(v*v+1)-v);
r=(m-d)/Ya,e=function(n){var t=n*r,e=rn(d),o=a/(Za*g)*(e*un(Ya*t+d)-en(d));return[u+o*s,i+o*f,a*e/rn(Ya*t+d)];
};}return e.duration=1000*r,e;},oa.behavior.zoom=function(){function n(n){n.on(L,f).on($a+".zoom",g).on("dblclick.zoom",p).on(R,h);
}function e(n){return[(n[0]-k.x)/k.k,(n[1]-k.y)/k.k];}function r(n){return[n[0]*k.k+k.x,n[1]*k.k+k.y];
}function u(n){k.k=Math.max(A[0],Math.min(A[1],n));}function i(n,t){t=r(t),k.x+=n[0]-t[0],k.y+=n[1]-t[1];
}function a(t,e,r,a){t.__chart__={x:k.x,y:k.y,k:k.k},u(Math.pow(2,a)),i(d=e,r),t=oa.select(t),C>0&&(t=t.transition().duration(C)),t.call(n.event);
}function o(){b&&b.domain(x.range().map(function(n){return(n-k.x)/k.k;}).map(x.invert)),w&&w.domain(_.range().map(function(n){return(n-k.y)/k.k;
}).map(_.invert));}function l(n){z++||n({type:"zoomstart"});}function c(n){o(),n({type:"zoom",scale:k.k,translate:[k.x,k.y]});
}function s(n){--z||(n({type:"zoomend"}),d=null);}function f(){function n(){o=1,i(oa.mouse(u),h),c(a);
}function r(){f.on(q,null).on(T,null),g(o),s(a);}var u=this,a=D.of(u,arguments),o=0,f=oa.select(t(u)).on(q,n).on(T,r),h=e(oa.mouse(u)),g=W(u);
Ol.call(u),l(a);}function h(){function n(){var n=oa.touches(p);return g=k.k,n.forEach(function(n){n.identifier in d&&(d[n.identifier]=e(n));
}),n;}function t(){var t=oa.event.target;oa.select(t).on(x,r).on(b,o),_.push(t);for(var e=oa.event.changedTouches,u=0,i=e.length;
i>u;++u){d[e[u].identifier]=null;}var l=n(),c=Date.now();if(1===l.length){if(500>c-M){var s=l[0];a(p,s,d[s.identifier],Math.floor(Math.log(k.k)/Math.LN2)+1),S();
}M=c;}else{if(l.length>1){var s=l[0],f=l[1],h=s[0]-f[0],g=s[1]-f[1];m=h*h+g*g;}}}function r(){var n,t,e,r,a=oa.touches(p);
Ol.call(p);for(var o=0,l=a.length;l>o;++o,r=null){if(e=a[o],r=d[e.identifier]){if(t){break;}n=e,t=r;}}if(r){var s=(s=e[0]-n[0])*s+(s=e[1]-n[1])*s,f=m&&Math.sqrt(s/m);
n=[(n[0]+e[0])/2,(n[1]+e[1])/2],t=[(t[0]+r[0])/2,(t[1]+r[1])/2],u(f*g);}M=null,i(n,t),c(v);}function o(){if(oa.event.touches.length){for(var t=oa.event.changedTouches,e=0,r=t.length;
r>e;++e){delete d[t[e].identifier];}for(var u in d){return void n();}}oa.selectAll(_).on(y,null),w.on(L,f).on(R,h),N(),s(v);
}var g,p=this,v=D.of(p,arguments),d={},m=0,y=".zoom-"+oa.event.changedTouches[0].identifier,x="touchmove"+y,b="touchend"+y,_=[],w=oa.select(p),N=W(p);
t(),l(v),w.on(L,null).on(R,t);}function g(){var n=D.of(this,arguments);y?clearTimeout(y):(Ol.call(this),v=e(d=m||oa.mouse(this)),l(n)),y=setTimeout(function(){y=null,s(n);
},50),S(),u(Math.pow(2,0.002*Xa())*k.k),i(d,v),c(n);}function p(){var n=oa.mouse(this),t=Math.log(k.k)/Math.LN2;
a(this,n,e(n),oa.event.shiftKey?Math.ceil(t)-1:Math.floor(t)+1);}var v,d,m,y,M,x,b,_,w,k={x:0,y:0,k:1},E=[960,500],A=Ba,C=250,z=0,L="mousedown.zoom",q="mousemove.zoom",T="mouseup.zoom",R="touchstart.zoom",D=N(n,"zoomstart","zoom","zoomend");
return $a||($a="onwheel" in sa?(Xa=function(){return -oa.event.deltaY*(oa.event.deltaMode?120:1);},"wheel"):"onmousewheel" in sa?(Xa=function(){return oa.event.wheelDelta;
},"mousewheel"):(Xa=function(){return -oa.event.detail;},"MozMousePixelScroll")),n.event=function(n){n.each(function(){var n=D.of(this,arguments),t=k;
Fl?oa.select(this).transition().each("start.zoom",function(){k=this.__chart__||{x:0,y:0,k:1},l(n);}).tween("zoom:zoom",function(){var e=E[0],r=E[1],u=d?d[0]:e/2,i=d?d[1]:r/2,a=oa.interpolateZoom([(u-k.x)/k.k,(i-k.y)/k.k,e/k.k],[(u-t.x)/t.k,(i-t.y)/t.k,e/t.k]);
return function(t){var r=a(t),o=e/r[2];this.__chart__=k={x:u-r[0]*o,y:i-r[1]*o,k:o},c(n);};}).each("interrupt.zoom",function(){s(n);
}).each("end.zoom",function(){s(n);}):(this.__chart__=k,l(n),c(n),s(n));});},n.translate=function(t){return arguments.length?(k={x:+t[0],y:+t[1],k:k.k},o(),n):[k.x,k.y];
},n.scale=function(t){return arguments.length?(k={x:k.x,y:k.y,k:null},u(+t),o(),n):k.k;},n.scaleExtent=function(t){return arguments.length?(A=null==t?Ba:[+t[0],+t[1]],n):A;
},n.center=function(t){return arguments.length?(m=t&&[+t[0],+t[1]],n):m;},n.size=function(t){return arguments.length?(E=t&&[+t[0],+t[1]],n):E;
},n.duration=function(t){return arguments.length?(C=+t,n):C;},n.x=function(t){return arguments.length?(b=t,x=t.copy(),k={x:0,y:0,k:1},n):b;
},n.y=function(t){return arguments.length?(w=t,_=t.copy(),k={x:0,y:0,k:1},n):w;},oa.rebind(n,D,"on");
};var Xa,$a,Ba=[0,1/0];oa.color=on,on.prototype.toString=function(){return this.rgb()+"";},oa.hsl=ln;
var Wa=ln.prototype=new on;Wa.brighter=function(n){return n=Math.pow(0.7,arguments.length?n:1),new ln(this.h,this.s,this.l/n);
},Wa.darker=function(n){return n=Math.pow(0.7,arguments.length?n:1),new ln(this.h,this.s,n*this.l);},Wa.rgb=function(){return cn(this.h,this.s,this.l);
},oa.hcl=sn;var Ja=sn.prototype=new on;Ja.brighter=function(n){return new sn(this.h,this.c,Math.min(100,this.l+Ga*(arguments.length?n:1)));
},Ja.darker=function(n){return new sn(this.h,this.c,Math.max(0,this.l-Ga*(arguments.length?n:1)));},Ja.rgb=function(){return fn(this.h,this.c,this.l).rgb();
},oa.lab=hn;var Ga=18,Ka=0.95047,Qa=1,no=1.08883,to=hn.prototype=new on;to.brighter=function(n){return new hn(Math.min(100,this.l+Ga*(arguments.length?n:1)),this.a,this.b);
},to.darker=function(n){return new hn(Math.max(0,this.l-Ga*(arguments.length?n:1)),this.a,this.b);},to.rgb=function(){return gn(this.l,this.a,this.b);
},oa.rgb=yn;var eo=yn.prototype=new on;eo.brighter=function(n){n=Math.pow(0.7,arguments.length?n:1);var t=this.r,e=this.g,r=this.b,u=30;
return t||e||r?(t&&u>t&&(t=u),e&&u>e&&(e=u),r&&u>r&&(r=u),new yn(Math.min(255,t/n),Math.min(255,e/n),Math.min(255,r/n))):new yn(u,u,u);
},eo.darker=function(n){return n=Math.pow(0.7,arguments.length?n:1),new yn(n*this.r,n*this.g,n*this.b);
},eo.hsl=function(){return wn(this.r,this.g,this.b);},eo.toString=function(){return"#"+bn(this.r)+bn(this.g)+bn(this.b);
};var ro=oa.map({aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074});
ro.forEach(function(n,t){ro.set(n,Mn(t));}),oa.functor=En,oa.xhr=An(y),oa.dsv=function(n,t){function e(n,e,i){arguments.length<3&&(i=e,e=null);
var a=Cn(n,t,null==e?r:u(e),i);return a.row=function(n){return arguments.length?a.response(null==(e=n)?r:u(n)):e;
},a;}function r(n){return e.parse(n.responseText);}function u(n){return function(t){return e.parse(t.responseText,n);
};}function i(t){return t.map(a).join(n);}function a(n){return o.test(n)?'"'+n.replace(/\"/g,'""')+'"':n;
}var o=new RegExp('["'+n+"\n]"),l=n.charCodeAt(0);return e.parse=function(n,t){var r;return e.parseRows(n,function(n,e){if(r){return r(n,e-1);
}var u=new Function("d","return {"+n.map(function(n,t){return JSON.stringify(n)+": d["+t+"]";}).join(",")+"}");
r=t?function(n,e){return t(u(n),e);}:u;});},e.parseRows=function(n,t){function e(){if(s>=c){return a;
}if(u){return u=!1,i;}var t=s;if(34===n.charCodeAt(t)){for(var e=t;e++<c;){if(34===n.charCodeAt(e)){if(34!==n.charCodeAt(e+1)){break;
}++e;}}s=e+2;var r=n.charCodeAt(e+1);return 13===r?(u=!0,10===n.charCodeAt(e+2)&&++s):10===r&&(u=!0),n.slice(t+1,e).replace(/""/g,'"');
}for(;c>s;){var r=n.charCodeAt(s++),o=1;if(10===r){u=!0;}else{if(13===r){u=!0,10===n.charCodeAt(s)&&(++s,++o);
}else{if(r!==l){continue;}}}return n.slice(t,s-o);}return n.slice(t);}for(var r,u,i={},a={},o=[],c=n.length,s=0,f=0;
(r=e())!==a;){for(var h=[];r!==i&&r!==a;){h.push(r),r=e();}t&&null==(h=t(h,f++))||o.push(h);}return o;
},e.format=function(t){if(Array.isArray(t[0])){return e.formatRows(t);}var r=new m,u=[];return t.forEach(function(n){for(var t in n){r.has(t)||u.push(r.add(t));
}}),[u.map(a).join(n)].concat(t.map(function(t){return u.map(function(n){return a(t[n]);}).join(n);})).join("\n");
},e.formatRows=function(n){return n.map(i).join("\n");},e;},oa.csv=oa.dsv(",","text/csv"),oa.tsv=oa.dsv("	","text/tab-separated-values");
var uo,io,ao,oo,lo=this[x(this,"requestAnimationFrame")]||function(n){setTimeout(n,17);};oa.timer=function(){qn.apply(this,arguments);
},oa.timer.flush=function(){Rn(),Dn();},oa.round=function(n,t){return t?Math.round(n*(t=Math.pow(10,t)))/t:Math.round(n);
};var co=["y","z","a","f","p","n","\xb5","m","","k","M","G","T","P","E","Z","Y"].map(jn);oa.formatPrefix=function(n,t){var e=0;
return(n=+n)&&(0>n&&(n*=-1),t&&(n=oa.round(n,Pn(n,t))),e=1+Math.floor(1e-12+Math.log(n)/Math.LN10),e=Math.max(-24,Math.min(24,3*Math.floor((e-1)/3)))),co[8+e/3];
};var so=/(?:([^{])?([<>=^]))?([+\- ])?([$#])?(0)?(\d+)?(,)?(\.-?\d+)?([a-z%])?/i,fo=oa.map({b:function(n){return n.toString(2);
},c:function(n){return String.fromCharCode(n);},o:function(n){return n.toString(8);},x:function(n){return n.toString(16);
},X:function(n){return n.toString(16).toUpperCase();},g:function(n,t){return n.toPrecision(t);},e:function(n,t){return n.toExponential(t);
},f:function(n,t){return n.toFixed(t);},r:function(n,t){return(n=oa.round(n,Pn(n,t))).toFixed(Math.max(0,Math.min(20,Pn(n*(1+1e-15),t))));
}}),ho=oa.time={},go=Date;Hn.prototype={getDate:function(){return this._.getUTCDate();},getDay:function(){return this._.getUTCDay();
},getFullYear:function(){return this._.getUTCFullYear();},getHours:function(){return this._.getUTCHours();
},getMilliseconds:function(){return this._.getUTCMilliseconds();},getMinutes:function(){return this._.getUTCMinutes();
},getMonth:function(){return this._.getUTCMonth();},getSeconds:function(){return this._.getUTCSeconds();
},getTime:function(){return this._.getTime();},getTimezoneOffset:function(){return 0;},valueOf:function(){return this._.valueOf();
},setDate:function(){po.setUTCDate.apply(this._,arguments);},setDay:function(){po.setUTCDay.apply(this._,arguments);
},setFullYear:function(){po.setUTCFullYear.apply(this._,arguments);},setHours:function(){po.setUTCHours.apply(this._,arguments);
},setMilliseconds:function(){po.setUTCMilliseconds.apply(this._,arguments);},setMinutes:function(){po.setUTCMinutes.apply(this._,arguments);
},setMonth:function(){po.setUTCMonth.apply(this._,arguments);},setSeconds:function(){po.setUTCSeconds.apply(this._,arguments);
},setTime:function(){po.setTime.apply(this._,arguments);}};var po=Date.prototype;ho.year=On(function(n){return n=ho.day(n),n.setMonth(0,1),n;
},function(n,t){n.setFullYear(n.getFullYear()+t);},function(n){return n.getFullYear();}),ho.years=ho.year.range,ho.years.utc=ho.year.utc.range,ho.day=On(function(n){var t=new go(2000,0);
return t.setFullYear(n.getFullYear(),n.getMonth(),n.getDate()),t;},function(n,t){n.setDate(n.getDate()+t);
},function(n){return n.getDate()-1;}),ho.days=ho.day.range,ho.days.utc=ho.day.utc.range,ho.dayOfYear=function(n){var t=ho.year(n);
return Math.floor((n-t-60000*(n.getTimezoneOffset()-t.getTimezoneOffset()))/86400000);},["sunday","monday","tuesday","wednesday","thursday","friday","saturday"].forEach(function(n,t){t=7-t;
var e=ho[n]=On(function(n){return(n=ho.day(n)).setDate(n.getDate()-(n.getDay()+t)%7),n;},function(n,t){n.setDate(n.getDate()+7*Math.floor(t));
},function(n){var e=ho.year(n).getDay();return Math.floor((ho.dayOfYear(n)+(e+t)%7)/7)-(e!==t);});ho[n+"s"]=e.range,ho[n+"s"].utc=e.utc.range,ho[n+"OfYear"]=function(n){var e=ho.year(n).getDay();
return Math.floor((ho.dayOfYear(n)+(e+t)%7)/7);};}),ho.week=ho.sunday,ho.weeks=ho.sunday.range,ho.weeks.utc=ho.sunday.utc.range,ho.weekOfYear=ho.sundayOfYear;
var vo={"-":"",_:" ",0:"0"},mo=/^\s*\d+/,yo=/^%/;oa.locale=function(n){return{numberFormat:Un(n),timeFormat:Yn(n)};
};var Mo=oa.locale({decimal:".",thousands:",",grouping:[3],currency:["$",""],dateTime:"%a %b %e %X %Y",date:"%m/%d/%Y",time:"%H:%M:%S",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});
oa.format=Mo.numberFormat,oa.geo={},st.prototype={s:0,t:0,add:function(n){ft(n,this.t,xo),ft(xo.s,this.s,this),this.s?this.t+=xo.t:this.s=xo.t;
},reset:function(){this.s=this.t=0;},valueOf:function(){return this.s;}};var xo=new st;oa.geo.stream=function(n,t){n&&bo.hasOwnProperty(n.type)?bo[n.type](n,t):ht(n,t);
};var bo={Feature:function(n,t){ht(n.geometry,t);},FeatureCollection:function(n,t){for(var e=n.features,r=-1,u=e.length;
++r<u;){ht(e[r].geometry,t);}}},_o={Sphere:function(n,t){t.sphere();},Point:function(n,t){n=n.coordinates,t.point(n[0],n[1],n[2]);
},MultiPoint:function(n,t){for(var e=n.coordinates,r=-1,u=e.length;++r<u;){n=e[r],t.point(n[0],n[1],n[2]);
}},LineString:function(n,t){gt(n.coordinates,t,0);},MultiLineString:function(n,t){for(var e=n.coordinates,r=-1,u=e.length;
++r<u;){gt(e[r],t,0);}},Polygon:function(n,t){pt(n.coordinates,t);},MultiPolygon:function(n,t){for(var e=n.coordinates,r=-1,u=e.length;
++r<u;){pt(e[r],t);}},GeometryCollection:function(n,t){for(var e=n.geometries,r=-1,u=e.length;++r<u;){ht(e[r],t);
}}};oa.geo.area=function(n){return wo=0,oa.geo.stream(n,ko),wo;};var wo,So=new st,ko={sphere:function(){wo+=4*ja;
},point:b,lineStart:b,lineEnd:b,polygonStart:function(){So.reset(),ko.lineStart=vt;},polygonEnd:function(){var n=2*So;
wo+=0>n?4*ja+n:n,ko.lineStart=ko.lineEnd=ko.point=b;}};oa.geo.bounds=function(){function n(n,t){M.push(x=[s=n,h=n]),f>t&&(f=t),t>g&&(g=t);
}function t(t,e){var r=dt([t*Oa,e*Oa]);if(m){var u=yt(m,r),i=[u[1],-u[0],0],a=yt(i,u);bt(a),a=_t(a);var l=t-p,c=l>0?1:-1,v=a[0]*Ia*c,d=Ma(l)>180;
if(d^(v>c*p&&c*t>v)){var y=a[1]*Ia;y>g&&(g=y);}else{if(v=(v+360)%360-180,d^(v>c*p&&c*t>v)){var y=-a[1]*Ia;
f>y&&(f=y);}else{f>e&&(f=e),e>g&&(g=e);}}d?p>t?o(s,t)>o(s,h)&&(h=t):o(t,h)>o(s,h)&&(s=t):h>=s?(s>t&&(s=t),t>h&&(h=t)):t>p?o(s,t)>o(s,h)&&(h=t):o(t,h)>o(s,h)&&(s=t);
}else{n(t,e);}m=r,p=t;}function e(){b.point=t;}function r(){x[0]=s,x[1]=h,b.point=n,m=null;}function u(n,e){if(m){var r=n-p;
y+=Ma(r)>180?r+(r>0?360:-360):r;}else{v=n,d=e;}ko.point(n,e),t(n,e);}function i(){ko.lineStart();}function a(){u(v,d),ko.lineEnd(),Ma(y)>Da&&(s=-(h=180)),x[0]=s,x[1]=h,m=null;
}function o(n,t){return(t-=n)<0?t+360:t;}function l(n,t){return n[0]-t[0];}function c(n,t){return t[0]<=t[1]?t[0]<=n&&n<=t[1]:n<t[0]||t[1]<n;
}var s,f,h,g,p,v,d,m,y,M,x,b={point:n,lineStart:e,lineEnd:r,polygonStart:function(){b.point=u,b.lineStart=i,b.lineEnd=a,y=0,ko.polygonStart();
},polygonEnd:function(){ko.polygonEnd(),b.point=n,b.lineStart=e,b.lineEnd=r,0>So?(s=-(h=180),f=-(g=90)):y>Da?g=90:-Da>y&&(f=-90),x[0]=s,x[1]=h;
}};return function(n){g=h=-(s=f=1/0),M=[],oa.geo.stream(n,b);var t=M.length;if(t){M.sort(l);for(var e,r=1,u=M[0],i=[u];
t>r;++r){e=M[r],c(e[0],u)||c(e[1],u)?(o(u[0],e[1])>o(u[0],u[1])&&(u[1]=e[1]),o(e[0],u[1])>o(u[0],u[1])&&(u[0]=e[0])):i.push(u=e);
}for(var a,e,p=-(1/0),t=i.length-1,r=0,u=i[t];t>=r;u=e,++r){e=i[r],(a=o(u[1],e[0]))>p&&(p=a,s=e[0],h=u[1]);
}}return M=x=null,s===1/0||f===1/0?[[NaN,NaN],[NaN,NaN]]:[[s,f],[h,g]];};}(),oa.geo.centroid=function(n){No=Eo=Ao=Co=zo=Lo=qo=To=Ro=Do=Po=0,oa.geo.stream(n,jo);
var t=Ro,e=Do,r=Po,u=t*t+e*e+r*r;return Pa>u&&(t=Lo,e=qo,r=To,Da>Eo&&(t=Ao,e=Co,r=zo),u=t*t+e*e+r*r,Pa>u)?[NaN,NaN]:[Math.atan2(e,t)*Ia,tn(r/Math.sqrt(u))*Ia];
};var No,Eo,Ao,Co,zo,Lo,qo,To,Ro,Do,Po,jo={sphere:b,point:St,lineStart:Nt,lineEnd:Et,polygonStart:function(){jo.lineStart=At;
},polygonEnd:function(){jo.lineStart=Nt;}},Uo=Rt(zt,Ut,Ht,[-ja,-ja/2]),Fo=1000000000;oa.geo.clipExtent=function(){var n,t,e,r,u,i,a={stream:function(n){return u&&(u.valid=!1),u=i(n),u.valid=!0,u;
},extent:function(o){return arguments.length?(i=Zt(n=+o[0][0],t=+o[0][1],e=+o[1][0],r=+o[1][1]),u&&(u.valid=!1,u=null),a):[[n,t],[e,r]];
}};return a.extent([[0,0],[960,500]]);},(oa.geo.conicEqualArea=function(){return Vt(Xt);}).raw=Xt,oa.geo.albers=function(){return oa.geo.conicEqualArea().rotate([96,0]).center([-0.6,38.7]).parallels([29.5,45.5]).scale(1070);
},oa.geo.albersUsa=function(){function n(n){var i=n[0],a=n[1];return t=null,e(i,a),t||(r(i,a),t)||u(i,a),t;
}var t,e,r,u,i=oa.geo.albers(),a=oa.geo.conicEqualArea().rotate([154,0]).center([-2,58.5]).parallels([55,65]),o=oa.geo.conicEqualArea().rotate([157,0]).center([-3,19.9]).parallels([8,18]),l={point:function(n,e){t=[n,e];
}};return n.invert=function(n){var t=i.scale(),e=i.translate(),r=(n[0]-e[0])/t,u=(n[1]-e[1])/t;return(u>=0.12&&0.234>u&&r>=-0.425&&-0.214>r?a:u>=0.166&&0.234>u&&r>=-0.214&&-0.115>r?o:i).invert(n);
},n.stream=function(n){var t=i.stream(n),e=a.stream(n),r=o.stream(n);return{point:function(n,u){t.point(n,u),e.point(n,u),r.point(n,u);
},sphere:function(){t.sphere(),e.sphere(),r.sphere();},lineStart:function(){t.lineStart(),e.lineStart(),r.lineStart();
},lineEnd:function(){t.lineEnd(),e.lineEnd(),r.lineEnd();},polygonStart:function(){t.polygonStart(),e.polygonStart(),r.polygonStart();
},polygonEnd:function(){t.polygonEnd(),e.polygonEnd(),r.polygonEnd();}};},n.precision=function(t){return arguments.length?(i.precision(t),a.precision(t),o.precision(t),n):i.precision();
},n.scale=function(t){return arguments.length?(i.scale(t),a.scale(0.35*t),o.scale(t),n.translate(i.translate())):i.scale();
},n.translate=function(t){if(!arguments.length){return i.translate();}var c=i.scale(),s=+t[0],f=+t[1];
return e=i.translate(t).clipExtent([[s-0.455*c,f-0.238*c],[s+0.455*c,f+0.238*c]]).stream(l).point,r=a.translate([s-0.307*c,f+0.201*c]).clipExtent([[s-0.425*c+Da,f+0.12*c+Da],[s-0.214*c-Da,f+0.234*c-Da]]).stream(l).point,u=o.translate([s-0.205*c,f+0.212*c]).clipExtent([[s-0.214*c+Da,f+0.166*c+Da],[s-0.115*c-Da,f+0.234*c-Da]]).stream(l).point,n;
},n.scale(1070);};var Ho,Oo,Io,Yo,Zo,Vo,Xo={point:b,lineStart:b,lineEnd:b,polygonStart:function(){Oo=0,Xo.lineStart=$t;
},polygonEnd:function(){Xo.lineStart=Xo.lineEnd=Xo.point=b,Ho+=Ma(Oo/2);}},$o={point:Bt,lineStart:b,lineEnd:b,polygonStart:b,polygonEnd:b},Bo={point:Gt,lineStart:Kt,lineEnd:Qt,polygonStart:function(){Bo.lineStart=ne;
},polygonEnd:function(){Bo.point=Gt,Bo.lineStart=Kt,Bo.lineEnd=Qt;}};oa.geo.path=function(){function n(n){return n&&("function"==typeof o&&i.pointRadius(+o.apply(this,arguments)),a&&a.valid||(a=u(i)),oa.geo.stream(n,a)),i.result();
}function t(){return a=null,n;}var e,r,u,i,a,o=4.5;return n.area=function(n){return Ho=0,oa.geo.stream(n,u(Xo)),Ho;
},n.centroid=function(n){return Ao=Co=zo=Lo=qo=To=Ro=Do=Po=0,oa.geo.stream(n,u(Bo)),Po?[Ro/Po,Do/Po]:To?[Lo/To,qo/To]:zo?[Ao/zo,Co/zo]:[NaN,NaN];
},n.bounds=function(n){return Zo=Vo=-(Io=Yo=1/0),oa.geo.stream(n,u($o)),[[Io,Yo],[Zo,Vo]];},n.projection=function(n){return arguments.length?(u=(e=n)?n.stream||re(n):y,t()):e;
},n.context=function(n){return arguments.length?(i=null==(r=n)?new Wt:new te(n),"function"!=typeof o&&i.pointRadius(o),t()):r;
},n.pointRadius=function(t){return arguments.length?(o="function"==typeof t?t:(i.pointRadius(+t),+t),n):o;
},n.projection(oa.geo.albersUsa()).context(null);},oa.geo.transform=function(n){return{stream:function(t){var e=new ue(t);
for(var r in n){e[r]=n[r];}return e;}};},ue.prototype={point:function(n,t){this.stream.point(n,t);},sphere:function(){this.stream.sphere();
},lineStart:function(){this.stream.lineStart();},lineEnd:function(){this.stream.lineEnd();},polygonStart:function(){this.stream.polygonStart();
},polygonEnd:function(){this.stream.polygonEnd();}},oa.geo.projection=ae,oa.geo.projectionMutator=oe,(oa.geo.equirectangular=function(){return ae(ce);
}).raw=ce.invert=ce,oa.geo.rotation=function(n){function t(t){return t=n(t[0]*Oa,t[1]*Oa),t[0]*=Ia,t[1]*=Ia,t;
}return n=fe(n[0]%360*Oa,n[1]*Oa,n.length>2?n[2]*Oa:0),t.invert=function(t){return t=n.invert(t[0]*Oa,t[1]*Oa),t[0]*=Ia,t[1]*=Ia,t;
},t;},se.invert=ce,oa.geo.circle=function(){function n(){var n="function"==typeof r?r.apply(this,arguments):r,t=fe(-n[0]*Oa,-n[1]*Oa,0).invert,u=[];
return e(null,null,1,{point:function(n,e){u.push(n=t(n,e)),n[0]*=Ia,n[1]*=Ia;}}),{type:"Polygon",coordinates:[u]};
}var t,e,r=[0,0],u=6;return n.origin=function(t){return arguments.length?(r=t,n):r;},n.angle=function(r){return arguments.length?(e=ve((t=+r)*Oa,u*Oa),n):t;
},n.precision=function(r){return arguments.length?(e=ve(t*Oa,(u=+r)*Oa),n):u;},n.angle(90);},oa.geo.distance=function(n,t){var e,r=(t[0]-n[0])*Oa,u=n[1]*Oa,i=t[1]*Oa,a=Math.sin(r),o=Math.cos(r),l=Math.sin(u),c=Math.cos(u),s=Math.sin(i),f=Math.cos(i);
return Math.atan2(Math.sqrt((e=f*a)*e+(e=c*s-l*f*o)*e),l*s+c*f*o);},oa.geo.graticule=function(){function n(){return{type:"MultiLineString",coordinates:t()};
}function t(){return oa.range(Math.ceil(i/d)*d,u,d).map(h).concat(oa.range(Math.ceil(c/m)*m,l,m).map(g)).concat(oa.range(Math.ceil(r/p)*p,e,p).filter(function(n){return Ma(n%d)>Da;
}).map(s)).concat(oa.range(Math.ceil(o/v)*v,a,v).filter(function(n){return Ma(n%m)>Da;}).map(f));}var e,r,u,i,a,o,l,c,s,f,h,g,p=10,v=p,d=90,m=360,y=2.5;
return n.lines=function(){return t().map(function(n){return{type:"LineString",coordinates:n};});},n.outline=function(){return{type:"Polygon",coordinates:[h(i).concat(g(l).slice(1),h(u).reverse().slice(1),g(c).reverse().slice(1))]};
},n.extent=function(t){return arguments.length?n.majorExtent(t).minorExtent(t):n.minorExtent();},n.majorExtent=function(t){return arguments.length?(i=+t[0][0],u=+t[1][0],c=+t[0][1],l=+t[1][1],i>u&&(t=i,i=u,u=t),c>l&&(t=c,c=l,l=t),n.precision(y)):[[i,c],[u,l]];
},n.minorExtent=function(t){return arguments.length?(r=+t[0][0],e=+t[1][0],o=+t[0][1],a=+t[1][1],r>e&&(t=r,r=e,e=t),o>a&&(t=o,o=a,a=t),n.precision(y)):[[r,o],[e,a]];
},n.step=function(t){return arguments.length?n.majorStep(t).minorStep(t):n.minorStep();},n.majorStep=function(t){return arguments.length?(d=+t[0],m=+t[1],n):[d,m];
},n.minorStep=function(t){return arguments.length?(p=+t[0],v=+t[1],n):[p,v];},n.precision=function(t){return arguments.length?(y=+t,s=me(o,a,90),f=ye(r,e,y),h=me(c,l,90),g=ye(i,u,y),n):y;
},n.majorExtent([[-180,-90+Da],[180,90-Da]]).minorExtent([[-180,-80-Da],[180,80+Da]]);},oa.geo.greatArc=function(){function n(){return{type:"LineString",coordinates:[t||r.apply(this,arguments),e||u.apply(this,arguments)]};
}var t,e,r=Me,u=xe;return n.distance=function(){return oa.geo.distance(t||r.apply(this,arguments),e||u.apply(this,arguments));
},n.source=function(e){return arguments.length?(r=e,t="function"==typeof e?null:e,n):r;},n.target=function(t){return arguments.length?(u=t,e="function"==typeof t?null:t,n):u;
},n.precision=function(){return arguments.length?n:0;},n;},oa.geo.interpolate=function(n,t){return be(n[0]*Oa,n[1]*Oa,t[0]*Oa,t[1]*Oa);
},oa.geo.length=function(n){return Wo=0,oa.geo.stream(n,Jo),Wo;};var Wo,Jo={sphere:b,point:b,lineStart:_e,lineEnd:b,polygonStart:b,polygonEnd:b},Go=we(function(n){return Math.sqrt(2/(1+n));
},function(n){return 2*Math.asin(n/2);});(oa.geo.azimuthalEqualArea=function(){return ae(Go);}).raw=Go;
var Ko=we(function(n){var t=Math.acos(n);return t&&t/Math.sin(t);},y);(oa.geo.azimuthalEquidistant=function(){return ae(Ko);
}).raw=Ko,(oa.geo.conicConformal=function(){return Vt(Se);}).raw=Se,(oa.geo.conicEquidistant=function(){return Vt(ke);
}).raw=ke;var Qo=we(function(n){return 1/n;},Math.atan);(oa.geo.gnomonic=function(){return ae(Qo);}).raw=Qo,Ne.invert=function(n,t){return[n,2*Math.atan(Math.exp(t))-Ha];
},(oa.geo.mercator=function(){return Ee(Ne);}).raw=Ne;var nl=we(function(){return 1;},Math.asin);(oa.geo.orthographic=function(){return ae(nl);
}).raw=nl;var tl=we(function(n){return 1/(1+n);},function(n){return 2*Math.atan(n);});(oa.geo.stereographic=function(){return ae(tl);
}).raw=tl,Ae.invert=function(n,t){return[-t,2*Math.atan(Math.exp(n))-Ha];},(oa.geo.transverseMercator=function(){var n=Ee(Ae),t=n.center,e=n.rotate;
return n.center=function(n){return n?t([-n[1],n[0]]):(n=t(),[n[1],-n[0]]);},n.rotate=function(n){return n?e([n[0],n[1],n.length>2?n[2]+90:90]):(n=e(),[n[0],n[1],n[2]-90]);
},e([0,0,90]);}).raw=Ae,oa.geom={},oa.geom.hull=function(n){function t(n){if(n.length<3){return[];}var t,u=En(e),i=En(r),a=n.length,o=[],l=[];
for(t=0;a>t;t++){o.push([+u.call(this,n[t],t),+i.call(this,n[t],t),t]);}for(o.sort(qe),t=0;a>t;t++){l.push([o[t][0],-o[t][1]]);
}var c=Le(o),s=Le(l),f=s[0]===c[0],h=s[s.length-1]===c[c.length-1],g=[];for(t=c.length-1;t>=0;--t){g.push(n[o[c[t]][2]]);
}for(t=+f;t<s.length-h;++t){g.push(n[o[s[t]][2]]);}return g;}var e=Ce,r=ze;return arguments.length?t(n):(t.x=function(n){return arguments.length?(e=n,t):e;
},t.y=function(n){return arguments.length?(r=n,t):r;},t);},oa.geom.polygon=function(n){return Sa(n,el),n;
};var el=oa.geom.polygon.prototype=[];el.area=function(){for(var n,t=-1,e=this.length,r=this[e-1],u=0;
++t<e;){n=r,r=this[t],u+=n[1]*r[0]-n[0]*r[1];}return 0.5*u;},el.centroid=function(n){var t,e,r=-1,u=this.length,i=0,a=0,o=this[u-1];
for(arguments.length||(n=-1/(6*this.area()));++r<u;){t=o,o=this[r],e=t[0]*o[1]-o[0]*t[1],i+=(t[0]+o[0])*e,a+=(t[1]+o[1])*e;
}return[i*n,a*n];},el.clip=function(n){for(var t,e,r,u,i,a,o=De(n),l=-1,c=this.length-De(this),s=this[c-1];
++l<c;){for(t=n.slice(),n.length=0,u=this[l],i=t[(r=t.length-o)-1],e=-1;++e<r;){a=t[e],Te(a,s,u)?(Te(i,s,u)||n.push(Re(i,a,s,u)),n.push(a)):Te(i,s,u)&&n.push(Re(i,a,s,u)),i=a;
}o&&n.push(n[0]),s=u;}return n;};var rl,ul,il,al,ol,ll=[],cl=[];Ye.prototype.prepare=function(){for(var n,t=this.edges,e=t.length;
e--;){n=t[e].edge,n.b&&n.a||t.splice(e,1);}return t.sort(Ve),t.length;},tr.prototype={start:function(){return this.edge.l===this.site?this.edge.a:this.edge.b;
},end:function(){return this.edge.l===this.site?this.edge.b:this.edge.a;}},er.prototype={insert:function(n,t){var e,r,u;
if(n){if(t.P=n,t.N=n.N,n.N&&(n.N.P=t),n.N=t,n.R){for(n=n.R;n.L;){n=n.L;}n.L=t;}else{n.R=t;}e=n;}else{this._?(n=ar(this._),t.P=null,t.N=n,n.P=n.L=t,e=n):(t.P=t.N=null,this._=t,e=null);
}for(t.L=t.R=null,t.U=e,t.C=!0,n=t;e&&e.C;){r=e.U,e===r.L?(u=r.R,u&&u.C?(e.C=u.C=!1,r.C=!0,n=r):(n===e.R&&(ur(this,e),n=e,e=n.U),e.C=!1,r.C=!0,ir(this,r))):(u=r.L,u&&u.C?(e.C=u.C=!1,r.C=!0,n=r):(n===e.L&&(ir(this,e),n=e,e=n.U),e.C=!1,r.C=!0,ur(this,r))),e=n.U;
}this._.C=!1;},remove:function(n){n.N&&(n.N.P=n.P),n.P&&(n.P.N=n.N),n.N=n.P=null;var t,e,r,u=n.U,i=n.L,a=n.R;
if(e=i?a?ar(a):i:a,u?u.L===n?u.L=e:u.R=e:this._=e,i&&a?(r=e.C,e.C=n.C,e.L=i,i.U=e,e!==a?(u=e.U,e.U=n.U,n=e.R,u.L=n,e.R=a,a.U=e):(e.U=u,u=e,n=e.R)):(r=n.C,n=e),n&&(n.U=u),!r){if(n&&n.C){return void (n.C=!1);
}do{if(n===this._){break;}if(n===u.L){if(t=u.R,t.C&&(t.C=!1,u.C=!0,ur(this,u),t=u.R),t.L&&t.L.C||t.R&&t.R.C){t.R&&t.R.C||(t.L.C=!1,t.C=!0,ir(this,t),t=u.R),t.C=u.C,u.C=t.R.C=!1,ur(this,u),n=this._;
break;}}else{if(t=u.L,t.C&&(t.C=!1,u.C=!0,ir(this,u),t=u.L),t.L&&t.L.C||t.R&&t.R.C){t.L&&t.L.C||(t.R.C=!1,t.C=!0,ur(this,t),t=u.L),t.C=u.C,u.C=t.L.C=!1,ir(this,u),n=this._;
break;}}t.C=!0,n=u,u=u.U;}while(!n.C);n&&(n.C=!1);}}},oa.geom.voronoi=function(n){function t(n){var t=new Array(n.length),r=o[0][0],u=o[0][1],i=o[1][0],a=o[1][1];
return or(e(n),o).cells.forEach(function(e,o){var l=e.edges,c=e.site,s=t[o]=l.length?l.map(function(n){var t=n.start();
return[t.x,t.y];}):c.x>=r&&c.x<=i&&c.y>=u&&c.y<=a?[[r,a],[i,a],[i,u],[r,u]]:[];s.point=n[o];}),t;}function e(n){return n.map(function(n,t){return{x:Math.round(i(n,t)/Da)*Da,y:Math.round(a(n,t)/Da)*Da,i:t};
});}var r=Ce,u=ze,i=r,a=u,o=sl;return n?t(n):(t.links=function(n){return or(e(n)).edges.filter(function(n){return n.l&&n.r;
}).map(function(t){return{source:n[t.l.i],target:n[t.r.i]};});},t.triangles=function(n){var t=[];return or(e(n)).cells.forEach(function(e,r){for(var u,i,a=e.site,o=e.edges.sort(Ve),l=-1,c=o.length,s=o[c-1].edge,f=s.l===a?s.r:s.l;
++l<c;){u=s,i=f,s=o[l].edge,f=s.l===a?s.r:s.l,r<i.i&&r<f.i&&cr(a,i,f)<0&&t.push([n[r],n[i.i],n[f.i]]);
}}),t;},t.x=function(n){return arguments.length?(i=En(r=n),t):r;},t.y=function(n){return arguments.length?(a=En(u=n),t):u;
},t.clipExtent=function(n){return arguments.length?(o=null==n?sl:n,t):o===sl?null:o;},t.size=function(n){return arguments.length?t.clipExtent(n&&[[0,0],n]):o===sl?null:o&&o[1];
},t);};var sl=[[-1000000,-1000000],[1000000,1000000]];oa.geom.delaunay=function(n){return oa.geom.voronoi().triangles(n);
},oa.geom.quadtree=function(n,t,e,r,u){function i(n){function i(n,t,e,r,u,i,a,o){if(!isNaN(e)&&!isNaN(r)){if(n.leaf){var l=n.x,s=n.y;
if(null!=l){if(Ma(l-e)+Ma(s-r)<0.01){c(n,t,e,r,u,i,a,o);}else{var f=n.point;n.x=n.y=n.point=null,c(n,f,l,s,u,i,a,o),c(n,t,e,r,u,i,a,o);
}}else{n.x=e,n.y=r,n.point=t;}}else{c(n,t,e,r,u,i,a,o);}}}function c(n,t,e,r,u,a,o,l){var c=0.5*(u+o),s=0.5*(a+l),f=e>=c,h=r>=s,g=h<<1|f;
n.leaf=!1,n=n.nodes[g]||(n.nodes[g]=hr()),f?u=c:o=c,h?a=s:l=s,i(n,t,e,r,u,a,o,l);}var s,f,h,g,p,v,d,m,y,M=En(o),x=En(l);
if(null!=t){v=t,d=e,m=r,y=u;}else{if(m=y=-(v=d=1/0),f=[],h=[],p=n.length,a){for(g=0;p>g;++g){s=n[g],s.x<v&&(v=s.x),s.y<d&&(d=s.y),s.x>m&&(m=s.x),s.y>y&&(y=s.y),f.push(s.x),h.push(s.y);
}}else{for(g=0;p>g;++g){var b=+M(s=n[g],g),_=+x(s,g);v>b&&(v=b),d>_&&(d=_),b>m&&(m=b),_>y&&(y=_),f.push(b),h.push(_);
}}}var w=m-v,S=y-d;w>S?y=d+w:m=v+S;var k=hr();if(k.add=function(n){i(k,n,+M(n,++g),+x(n,g),v,d,m,y);},k.visit=function(n){gr(n,k,v,d,m,y);
},k.find=function(n){return pr(k,n[0],n[1],v,d,m,y);},g=-1,null==t){for(;++g<p;){i(k,n[g],f[g],h[g],v,d,m,y);
}--g;}else{n.forEach(k.add);}return f=h=n=s=null,k;}var a,o=Ce,l=ze;return(a=arguments.length)?(o=sr,l=fr,3===a&&(u=e,r=t,e=t=0),i(n)):(i.x=function(n){return arguments.length?(o=n,i):o;
},i.y=function(n){return arguments.length?(l=n,i):l;},i.extent=function(n){return arguments.length?(null==n?t=e=r=u=null:(t=+n[0][0],e=+n[0][1],r=+n[1][0],u=+n[1][1]),i):null==t?null:[[t,e],[r,u]];
},i.size=function(n){return arguments.length?(null==n?t=e=r=u=null:(t=e=0,r=+n[0],u=+n[1]),i):null==t?null:[r-t,u-e];
},i);},oa.interpolateRgb=vr,oa.interpolateObject=dr,oa.interpolateNumber=mr,oa.interpolateString=yr;var fl=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,hl=new RegExp(fl.source,"g");
oa.interpolate=Mr,oa.interpolators=[function(n,t){var e=typeof t;return("string"===e?ro.has(t.toLowerCase())||/^(#|rgb\(|hsl\()/i.test(t)?vr:yr:t instanceof on?vr:Array.isArray(t)?xr:"object"===e&&isNaN(t)?dr:mr)(n,t);
}],oa.interpolateArray=xr;var gl=function(){return y;},pl=oa.map({linear:gl,poly:Er,quad:function(){return Sr;
},cubic:function(){return kr;},sin:function(){return Ar;},exp:function(){return Cr;},circle:function(){return zr;
},elastic:Lr,back:qr,bounce:function(){return Tr;}}),vl=oa.map({"in":y,out:_r,"in-out":wr,"out-in":function(n){return wr(_r(n));
}});oa.ease=function(n){var t=n.indexOf("-"),e=t>=0?n.slice(0,t):n,r=t>=0?n.slice(t+1):"in";return e=pl.get(e)||gl,r=vl.get(r)||y,br(r(e.apply(null,la.call(arguments,1))));
},oa.interpolateHcl=Rr,oa.interpolateHsl=Dr,oa.interpolateLab=Pr,oa.interpolateRound=jr,oa.transform=function(n){var t=sa.createElementNS(oa.ns.prefix.svg,"g");
return(oa.transform=function(n){if(null!=n){t.setAttribute("transform",n);var e=t.transform.baseVal.consolidate();
}return new Ur(e?e.matrix:dl);})(n);},Ur.prototype.toString=function(){return"translate("+this.translate+")rotate("+this.rotate+")skewX("+this.skew+")scale("+this.scale+")";
};var dl={a:1,b:0,c:0,d:1,e:0,f:0};oa.interpolateTransform=$r,oa.layout={},oa.layout.bundle=function(){return function(n){for(var t=[],e=-1,r=n.length;
++e<r;){t.push(Jr(n[e]));}return t;};},oa.layout.chord=function(){function n(){var n,c,f,h,g,p={},v=[],d=oa.range(i),m=[];
for(e=[],r=[],n=0,h=-1;++h<i;){for(c=0,g=-1;++g<i;){c+=u[h][g];}v.push(c),m.push(oa.range(i)),n+=c;}for(a&&d.sort(function(n,t){return a(v[n],v[t]);
}),o&&m.forEach(function(n,t){n.sort(function(n,e){return o(u[t][n],u[t][e]);});}),n=(Ua-s*i)/n,c=0,h=-1;
++h<i;){for(f=c,g=-1;++g<i;){var y=d[h],M=m[y][g],x=u[y][M],b=c,_=c+=x*n;p[y+"-"+M]={index:y,subindex:M,startAngle:b,endAngle:_,value:x};
}r[y]={index:y,startAngle:f,endAngle:c,value:v[y]},c+=s;}for(h=-1;++h<i;){for(g=h-1;++g<i;){var w=p[h+"-"+g],S=p[g+"-"+h];
(w.value||S.value)&&e.push(w.value<S.value?{source:S,target:w}:{source:w,target:S});}}l&&t();}function t(){e.sort(function(n,t){return l((n.source.value+n.target.value)/2,(t.source.value+t.target.value)/2);
});}var e,r,u,i,a,o,l,c={},s=0;return c.matrix=function(n){return arguments.length?(i=(u=n)&&u.length,e=r=null,c):u;
},c.padding=function(n){return arguments.length?(s=n,e=r=null,c):s;},c.sortGroups=function(n){return arguments.length?(a=n,e=r=null,c):a;
},c.sortSubgroups=function(n){return arguments.length?(o=n,e=null,c):o;},c.sortChords=function(n){return arguments.length?(l=n,e&&t(),c):l;
},c.chords=function(){return e||n(),e;},c.groups=function(){return r||n(),r;},c;},oa.layout.force=function(){function n(n){return function(t,e,r,u){if(t.point!==n){var i=t.cx-n.x,a=t.cy-n.y,o=u-e,l=i*i+a*a;
if(l>o*o/m){if(v>l){var c=t.charge/l;n.px-=i*c,n.py-=a*c;}return !0;}if(t.point&&l&&v>l){var c=t.pointCharge/l;
n.px-=i*c,n.py-=a*c;}}return !t.charge;};}function t(n){n.px=oa.event.x,n.py=oa.event.y,l.resume();}var e,r,u,i,a,o,l={},c=oa.dispatch("start","tick","end"),s=[1,1],f=0.9,h=ml,g=yl,p=-30,v=Ml,d=0.1,m=0.64,M=[],x=[];
return l.tick=function(){if((u*=0.99)<0.005){return e=null,c.end({type:"end",alpha:u=0}),!0;}var t,r,l,h,g,v,m,y,b,_=M.length,w=x.length;
for(r=0;w>r;++r){l=x[r],h=l.source,g=l.target,y=g.x-h.x,b=g.y-h.y,(v=y*y+b*b)&&(v=u*a[r]*((v=Math.sqrt(v))-i[r])/v,y*=v,b*=v,g.x-=y*(m=h.weight+g.weight?h.weight/(h.weight+g.weight):0.5),g.y-=b*m,h.x+=y*(m=1-m),h.y+=b*m);
}if((m=u*d)&&(y=s[0]/2,b=s[1]/2,r=-1,m)){for(;++r<_;){l=M[r],l.x+=(y-l.x)*m,l.y+=(b-l.y)*m;}}if(p){for(ru(t=oa.geom.quadtree(M),u,o),r=-1;
++r<_;){(l=M[r]).fixed||t.visit(n(l));}}for(r=-1;++r<_;){l=M[r],l.fixed?(l.x=l.px,l.y=l.py):(l.x-=(l.px-(l.px=l.x))*f,l.y-=(l.py-(l.py=l.y))*f);
}c.tick({type:"tick",alpha:u});},l.nodes=function(n){return arguments.length?(M=n,l):M;},l.links=function(n){return arguments.length?(x=n,l):x;
},l.size=function(n){return arguments.length?(s=n,l):s;},l.linkDistance=function(n){return arguments.length?(h="function"==typeof n?n:+n,l):h;
},l.distance=l.linkDistance,l.linkStrength=function(n){return arguments.length?(g="function"==typeof n?n:+n,l):g;
},l.friction=function(n){return arguments.length?(f=+n,l):f;},l.charge=function(n){return arguments.length?(p="function"==typeof n?n:+n,l):p;
},l.chargeDistance=function(n){return arguments.length?(v=n*n,l):Math.sqrt(v);},l.gravity=function(n){return arguments.length?(d=+n,l):d;
},l.theta=function(n){return arguments.length?(m=n*n,l):Math.sqrt(m);},l.alpha=function(n){return arguments.length?(n=+n,u?n>0?u=n:(e.c=null,e.t=NaN,e=null,c.end({type:"end",alpha:u=0})):n>0&&(c.start({type:"start",alpha:u=n}),e=qn(l.tick)),l):u;
},l.start=function(){function n(n,r){if(!e){for(e=new Array(u),l=0;u>l;++l){e[l]=[];}for(l=0;c>l;++l){var i=x[l];
e[i.source.index].push(i.target),e[i.target.index].push(i.source);}}for(var a,o=e[t],l=-1,s=o.length;
++l<s;){if(!isNaN(a=o[l][n])){return a;}}return Math.random()*r;}var t,e,r,u=M.length,c=x.length,f=s[0],v=s[1];
for(t=0;u>t;++t){(r=M[t]).index=t,r.weight=0;}for(t=0;c>t;++t){r=x[t],"number"==typeof r.source&&(r.source=M[r.source]),"number"==typeof r.target&&(r.target=M[r.target]),++r.source.weight,++r.target.weight;
}for(t=0;u>t;++t){r=M[t],isNaN(r.x)&&(r.x=n("x",f)),isNaN(r.y)&&(r.y=n("y",v)),isNaN(r.px)&&(r.px=r.x),isNaN(r.py)&&(r.py=r.y);
}if(i=[],"function"==typeof h){for(t=0;c>t;++t){i[t]=+h.call(this,x[t],t);}}else{for(t=0;c>t;++t){i[t]=h;
}}if(a=[],"function"==typeof g){for(t=0;c>t;++t){a[t]=+g.call(this,x[t],t);}}else{for(t=0;c>t;++t){a[t]=g;
}}if(o=[],"function"==typeof p){for(t=0;u>t;++t){o[t]=+p.call(this,M[t],t);}}else{for(t=0;u>t;++t){o[t]=p;
}}return l.resume();},l.resume=function(){return l.alpha(0.1);},l.stop=function(){return l.alpha(0);},l.drag=function(){return r||(r=oa.behavior.drag().origin(y).on("dragstart.force",Qr).on("drag.force",t).on("dragend.force",nu)),arguments.length?void this.on("mouseover.force",tu).on("mouseout.force",eu).call(r):r;
},oa.rebind(l,c,"on");};var ml=20,yl=1,Ml=1/0;oa.layout.hierarchy=function(){function n(u){var i,a=[u],o=[];
for(u.depth=0;null!=(i=a.pop());){if(o.push(i),(c=e.call(n,i,i.depth))&&(l=c.length)){for(var l,c,s;--l>=0;
){a.push(s=c[l]),s.parent=i,s.depth=i.depth+1;}r&&(i.value=0),i.children=c;}else{r&&(i.value=+r.call(n,i,i.depth)||0),delete i.children;
}}return au(u,function(n){var e,u;t&&(e=n.children)&&e.sort(t),r&&(u=n.parent)&&(u.value+=n.value);}),o;
}var t=cu,e=ou,r=lu;return n.sort=function(e){return arguments.length?(t=e,n):t;},n.children=function(t){return arguments.length?(e=t,n):e;
},n.value=function(t){return arguments.length?(r=t,n):r;},n.revalue=function(t){return r&&(iu(t,function(n){n.children&&(n.value=0);
}),au(t,function(t){var e;t.children||(t.value=+r.call(n,t,t.depth)||0),(e=t.parent)&&(e.value+=t.value);
})),t;},n;},oa.layout.partition=function(){function n(t,e,r,u){var i=t.children;if(t.x=e,t.y=t.depth*u,t.dx=r,t.dy=u,i&&(a=i.length)){var a,o,l,c=-1;
for(r=t.value?r/t.value:0;++c<a;){n(o=i[c],e,l=o.value*r,u),e+=l;}}}function t(n){var e=n.children,r=0;
if(e&&(u=e.length)){for(var u,i=-1;++i<u;){r=Math.max(r,t(e[i]));}}return 1+r;}function e(e,i){var a=r.call(this,e,i);
return n(a[0],0,u[0],u[1]/t(a[0])),a;}var r=oa.layout.hierarchy(),u=[1,1];return e.size=function(n){return arguments.length?(u=n,e):u;
},uu(e,r);},oa.layout.pie=function(){function n(a){var o,l=a.length,c=a.map(function(e,r){return +t.call(n,e,r);
}),s=+("function"==typeof r?r.apply(this,arguments):r),f=("function"==typeof u?u.apply(this,arguments):u)-s,h=Math.min(Math.abs(f)/l,+("function"==typeof i?i.apply(this,arguments):i)),g=h*(0>f?-1:1),p=oa.sum(c),v=p?(f-l*g)/p:0,d=oa.range(l),m=[];
return null!=e&&d.sort(e===xl?function(n,t){return c[t]-c[n];}:function(n,t){return e(a[n],a[t]);}),d.forEach(function(n){m[n]={data:a[n],value:o=c[n],startAngle:s,endAngle:s+=o*v+g,padAngle:h};
}),m;}var t=Number,e=xl,r=0,u=Ua,i=0;return n.value=function(e){return arguments.length?(t=e,n):t;},n.sort=function(t){return arguments.length?(e=t,n):e;
},n.startAngle=function(t){return arguments.length?(r=t,n):r;},n.endAngle=function(t){return arguments.length?(u=t,n):u;
},n.padAngle=function(t){return arguments.length?(i=t,n):i;},n;};var xl={};oa.layout.stack=function(){function n(o,l){if(!(h=o.length)){return o;
}var c=o.map(function(e,r){return t.call(n,e,r);}),s=c.map(function(t){return t.map(function(t,e){return[i.call(n,t,e),a.call(n,t,e)];
});}),f=e.call(n,s,l);c=oa.permute(c,f),s=oa.permute(s,f);var h,g,p,v,d=r.call(n,s,l),m=c[0].length;for(p=0;
m>p;++p){for(u.call(n,c[0][p],v=d[p],s[0][p][1]),g=1;h>g;++g){u.call(n,c[g][p],v+=s[g-1][p][1],s[g][p][1]);
}}return o;}var t=y,e=pu,r=vu,u=gu,i=fu,a=hu;return n.values=function(e){return arguments.length?(t=e,n):t;
},n.order=function(t){return arguments.length?(e="function"==typeof t?t:bl.get(t)||pu,n):e;},n.offset=function(t){return arguments.length?(r="function"==typeof t?t:_l.get(t)||vu,n):r;
},n.x=function(t){return arguments.length?(i=t,n):i;},n.y=function(t){return arguments.length?(a=t,n):a;
},n.out=function(t){return arguments.length?(u=t,n):u;},n;};var bl=oa.map({"inside-out":function(n){var t,e,r=n.length,u=n.map(du),i=n.map(mu),a=oa.range(r).sort(function(n,t){return u[n]-u[t];
}),o=0,l=0,c=[],s=[];for(t=0;r>t;++t){e=a[t],l>o?(o+=i[e],c.push(e)):(l+=i[e],s.push(e));}return s.reverse().concat(c);
},reverse:function(n){return oa.range(n.length).reverse();},"default":pu}),_l=oa.map({silhouette:function(n){var t,e,r,u=n.length,i=n[0].length,a=[],o=0,l=[];
for(e=0;i>e;++e){for(t=0,r=0;u>t;t++){r+=n[t][e][1];}r>o&&(o=r),a.push(r);}for(e=0;i>e;++e){l[e]=(o-a[e])/2;
}return l;},wiggle:function(n){var t,e,r,u,i,a,o,l,c,s=n.length,f=n[0],h=f.length,g=[];for(g[0]=l=c=0,e=1;
h>e;++e){for(t=0,u=0;s>t;++t){u+=n[t][e][1];}for(t=0,i=0,o=f[e][0]-f[e-1][0];s>t;++t){for(r=0,a=(n[t][e][1]-n[t][e-1][1])/(2*o);
t>r;++r){a+=(n[r][e][1]-n[r][e-1][1])/o;}i+=a*n[t][e][1];}g[e]=l-=u?i/u*o:0,c>l&&(c=l);}for(e=0;h>e;++e){g[e]-=c;
}return g;},expand:function(n){var t,e,r,u=n.length,i=n[0].length,a=1/u,o=[];for(e=0;i>e;++e){for(t=0,r=0;
u>t;t++){r+=n[t][e][1];}if(r){for(t=0;u>t;t++){n[t][e][1]/=r;}}else{for(t=0;u>t;t++){n[t][e][1]=a;}}}for(e=0;
i>e;++e){o[e]=0;}return o;},zero:vu});oa.layout.histogram=function(){function n(n,i){for(var a,o,l=[],c=n.map(e,this),s=r.call(this,c,i),f=u.call(this,s,c,i),i=-1,h=c.length,g=f.length-1,p=t?1:1/h;
++i<g;){a=l[i]=[],a.dx=f[i+1]-(a.x=f[i]),a.y=0;}if(g>0){for(i=-1;++i<h;){o=c[i],o>=s[0]&&o<=s[1]&&(a=l[oa.bisect(f,o,1,g)-1],a.y+=p,a.push(n[i]));
}}return l;}var t=!0,e=Number,r=bu,u=Mu;return n.value=function(t){return arguments.length?(e=t,n):e;
},n.range=function(t){return arguments.length?(r=En(t),n):r;},n.bins=function(t){return arguments.length?(u="number"==typeof t?function(n){return xu(n,t);
}:En(t),n):u;},n.frequency=function(e){return arguments.length?(t=!!e,n):t;},n;},oa.layout.pack=function(){function n(n,i){var a=e.call(this,n,i),o=a[0],l=u[0],c=u[1],s=null==t?Math.sqrt:"function"==typeof t?t:function(){return t;
};if(o.x=o.y=0,au(o,function(n){n.r=+s(n.value);}),au(o,Nu),r){var f=r*(t?1:Math.max(2*o.r/l,2*o.r/c))/2;
au(o,function(n){n.r+=f;}),au(o,Nu),au(o,function(n){n.r-=f;});}return Cu(o,l/2,c/2,t?1:1/Math.max(2*o.r/l,2*o.r/c)),a;
}var t,e=oa.layout.hierarchy().sort(_u),r=0,u=[1,1];return n.size=function(t){return arguments.length?(u=t,n):u;
},n.radius=function(e){return arguments.length?(t=null==e||"function"==typeof e?e:+e,n):t;},n.padding=function(t){return arguments.length?(r=+t,n):r;
},uu(n,e);},oa.layout.tree=function(){function n(n,u){var s=a.call(this,n,u),f=s[0],h=t(f);if(au(h,e),h.parent.m=-h.z,iu(h,r),c){iu(f,i);
}else{var g=f,p=f,v=f;iu(f,function(n){n.x<g.x&&(g=n),n.x>p.x&&(p=n),n.depth>v.depth&&(v=n);});var d=o(g,p)/2-g.x,m=l[0]/(p.x+o(p,g)/2+d),y=l[1]/(v.depth||1);
iu(f,function(n){n.x=(n.x+d)*m,n.y=n.depth*y;});}return s;}function t(n){for(var t,e={A:null,children:[n]},r=[e];
null!=(t=r.pop());){for(var u,i=t.children,a=0,o=i.length;o>a;++a){r.push((i[a]=u={_:i[a],parent:t,children:(u=i[a].children)&&u.slice()||[],A:null,a:null,z:0,m:0,c:0,s:0,t:null,i:a}).a=u);
}}return e.children[0];}function e(n){var t=n.children,e=n.parent.children,r=n.i?e[n.i-1]:null;if(t.length){Du(n);
var i=(t[0].z+t[t.length-1].z)/2;r?(n.z=r.z+o(n._,r._),n.m=n.z-i):n.z=i;}else{r&&(n.z=r.z+o(n._,r._));
}n.parent.A=u(n,r,n.parent.A||e[0]);}function r(n){n._.x=n.z+n.parent.m,n.m+=n.parent.m;}function u(n,t,e){if(t){for(var r,u=n,i=n,a=t,l=u.parent.children[0],c=u.m,s=i.m,f=a.m,h=l.m;
a=Tu(a),u=qu(u),a&&u;){l=qu(l),i=Tu(i),i.a=n,r=a.z+f-u.z-c+o(a._,u._),r>0&&(Ru(Pu(a,n,e),n,r),c+=r,s+=r),f+=a.m,c+=u.m,h+=l.m,s+=i.m;
}a&&!Tu(i)&&(i.t=a,i.m+=f-s),u&&!qu(l)&&(l.t=u,l.m+=c-h,e=n);}return e;}function i(n){n.x*=l[0],n.y=n.depth*l[1];
}var a=oa.layout.hierarchy().sort(null).value(null),o=Lu,l=[1,1],c=null;return n.separation=function(t){return arguments.length?(o=t,n):o;
},n.size=function(t){return arguments.length?(c=null==(l=t)?i:null,n):c?null:l;},n.nodeSize=function(t){return arguments.length?(c=null==(l=t)?null:i,n):c?l:null;
},uu(n,a);},oa.layout.cluster=function(){function n(n,i){var a,o=t.call(this,n,i),l=o[0],c=0;au(l,function(n){var t=n.children;
t&&t.length?(n.x=Uu(t),n.y=ju(t)):(n.x=a?c+=e(n,a):0,n.y=0,a=n);});var s=Fu(l),f=Hu(l),h=s.x-e(s,f)/2,g=f.x+e(f,s)/2;
return au(l,u?function(n){n.x=(n.x-l.x)*r[0],n.y=(l.y-n.y)*r[1];}:function(n){n.x=(n.x-h)/(g-h)*r[0],n.y=(1-(l.y?n.y/l.y:1))*r[1];
}),o;}var t=oa.layout.hierarchy().sort(null).value(null),e=Lu,r=[1,1],u=!1;return n.separation=function(t){return arguments.length?(e=t,n):e;
},n.size=function(t){return arguments.length?(u=null==(r=t),n):u?null:r;},n.nodeSize=function(t){return arguments.length?(u=null!=(r=t),n):u?r:null;
},uu(n,t);},oa.layout.treemap=function(){function n(n,t){for(var e,r,u=-1,i=n.length;++u<i;){r=(e=n[u]).value*(0>t?0:t),e.area=isNaN(r)||0>=r?0:r;
}}function t(e){var i=e.children;if(i&&i.length){var a,o,l,c=f(e),s=[],h=i.slice(),p=1/0,v="slice"===g?c.dx:"dice"===g?c.dy:"slice-dice"===g?1&e.depth?c.dy:c.dx:Math.min(c.dx,c.dy);
for(n(h,c.dx*c.dy/e.value),s.area=0;(l=h.length)>0;){s.push(a=h[l-1]),s.area+=a.area,"squarify"!==g||(o=r(s,v))<=p?(h.pop(),p=o):(s.area-=s.pop().area,u(s,v,c,!1),v=Math.min(c.dx,c.dy),s.length=s.area=0,p=1/0);
}s.length&&(u(s,v,c,!0),s.length=s.area=0),i.forEach(t);}}function e(t){var r=t.children;if(r&&r.length){var i,a=f(t),o=r.slice(),l=[];
for(n(o,a.dx*a.dy/t.value),l.area=0;i=o.pop();){l.push(i),l.area+=i.area,null!=i.z&&(u(l,i.z?a.dx:a.dy,a,!o.length),l.length=l.area=0);
}r.forEach(e);}}function r(n,t){for(var e,r=n.area,u=0,i=1/0,a=-1,o=n.length;++a<o;){(e=n[a].area)&&(i>e&&(i=e),e>u&&(u=e));
}return r*=r,t*=t,r?Math.max(t*u*p/r,r/(t*i*p)):1/0;}function u(n,t,e,r){var u,i=-1,a=n.length,o=e.x,c=e.y,s=t?l(n.area/t):0;
if(t==e.dx){for((r||s>e.dy)&&(s=e.dy);++i<a;){u=n[i],u.x=o,u.y=c,u.dy=s,o+=u.dx=Math.min(e.x+e.dx-o,s?l(u.area/s):0);
}u.z=!0,u.dx+=e.x+e.dx-o,e.y+=s,e.dy-=s;}else{for((r||s>e.dx)&&(s=e.dx);++i<a;){u=n[i],u.x=o,u.y=c,u.dx=s,c+=u.dy=Math.min(e.y+e.dy-c,s?l(u.area/s):0);
}u.z=!1,u.dy+=e.y+e.dy-c,e.x+=s,e.dx-=s;}}function i(r){var u=a||o(r),i=u[0];return i.x=i.y=0,i.value?(i.dx=c[0],i.dy=c[1]):i.dx=i.dy=0,a&&o.revalue(i),n([i],i.dx*i.dy/i.value),(a?e:t)(i),h&&(a=u),u;
}var a,o=oa.layout.hierarchy(),l=Math.round,c=[1,1],s=null,f=Ou,h=!1,g="squarify",p=0.5*(1+Math.sqrt(5));
return i.size=function(n){return arguments.length?(c=n,i):c;},i.padding=function(n){function t(t){var e=n.call(i,t,t.depth);
return null==e?Ou(t):Iu(t,"number"==typeof e?[e,e,e,e]:e);}function e(t){return Iu(t,n);}if(!arguments.length){return s;
}var r;return f=null==(s=n)?Ou:"function"==(r=typeof n)?t:"number"===r?(n=[n,n,n,n],e):e,i;},i.round=function(n){return arguments.length?(l=n?Math.round:Number,i):l!=Number;
},i.sticky=function(n){return arguments.length?(h=n,a=null,i):h;},i.ratio=function(n){return arguments.length?(p=n,i):p;
},i.mode=function(n){return arguments.length?(g=n+"",i):g;},uu(i,o);},oa.random={normal:function(n,t){var e=arguments.length;
return 2>e&&(t=1),1>e&&(n=0),function(){var e,r,u;do{e=2*Math.random()-1,r=2*Math.random()-1,u=e*e+r*r;
}while(!u||u>1);return n+t*e*Math.sqrt(-2*Math.log(u)/u);};},logNormal:function(){var n=oa.random.normal.apply(oa,arguments);
return function(){return Math.exp(n());};},bates:function(n){var t=oa.random.irwinHall(n);return function(){return t()/n;
};},irwinHall:function(n){return function(){for(var t=0,e=0;n>e;e++){t+=Math.random();}return t;};}},oa.scale={};
var wl={floor:y,ceil:y};oa.scale.linear=function(){return Wu([0,1],[0,1],Mr,!1);};var Sl={s:1,g:1,p:1,r:1,e:1};
oa.scale.log=function(){return ri(oa.scale.linear().domain([0,1]),10,!0,[1,10]);};var kl=oa.format(".0e"),Nl={floor:function(n){return -Math.ceil(-n);
},ceil:function(n){return -Math.floor(-n);}};oa.scale.pow=function(){return ui(oa.scale.linear(),1,[0,1]);
},oa.scale.sqrt=function(){return oa.scale.pow().exponent(0.5);},oa.scale.ordinal=function(){return ai([],{t:"range",a:[[]]});
},oa.scale.category10=function(){return oa.scale.ordinal().range(El);},oa.scale.category20=function(){return oa.scale.ordinal().range(Al);
},oa.scale.category20b=function(){return oa.scale.ordinal().range(Cl);},oa.scale.category20c=function(){return oa.scale.ordinal().range(zl);
};var El=[2062260,16744206,2924588,14034728,9725885,9197131,14907330,8355711,12369186,1556175].map(xn),Al=[2062260,11454440,16744206,16759672,2924588,10018698,14034728,16750742,9725885,12955861,9197131,12885140,14907330,16234194,8355711,13092807,12369186,14408589,1556175,10410725].map(xn),Cl=[3750777,5395619,7040719,10264286,6519097,9216594,11915115,13556636,9202993,12426809,15186514,15190932,8666169,11356490,14049643,15177372,8077683,10834324,13528509,14589654].map(xn),zl=[3244733,7057110,10406625,13032431,15095053,16616764,16625259,16634018,3253076,7652470,10607003,13101504,7695281,10394312,12369372,14342891,6513507,9868950,12434877,14277081].map(xn);
oa.scale.quantile=function(){return oi([],[]);},oa.scale.quantize=function(){return li(0,1,[0,1]);},oa.scale.threshold=function(){return ci([0.5],[0,1]);
},oa.scale.identity=function(){return si([0,1]);},oa.svg={},oa.svg.arc=function(){function n(){var n=Math.max(0,+e.apply(this,arguments)),c=Math.max(0,+r.apply(this,arguments)),s=a.apply(this,arguments)-Ha,f=o.apply(this,arguments)-Ha,h=Math.abs(f-s),g=s>f?0:1;
if(n>c&&(p=c,c=n,n=p),h>=Fa){return t(c,g)+(n?t(n,1-g):"")+"Z";}var p,v,d,m,y,M,x,b,_,w,S,k,N=0,E=0,A=[];
if((m=(+l.apply(this,arguments)||0)/2)&&(d=i===Ll?Math.sqrt(n*n+c*c):+i.apply(this,arguments),g||(E*=-1),c&&(E=tn(d/c*Math.sin(m))),n&&(N=tn(d/n*Math.sin(m)))),c){y=c*Math.cos(s+E),M=c*Math.sin(s+E),x=c*Math.cos(f-E),b=c*Math.sin(f-E);
var C=Math.abs(f-s-2*E)<=ja?0:1;if(E&&mi(y,M,x,b)===g^C){var z=(s+f)/2;y=c*Math.cos(z),M=c*Math.sin(z),x=b=null;
}}else{y=M=0;}if(n){_=n*Math.cos(f-N),w=n*Math.sin(f-N),S=n*Math.cos(s+N),k=n*Math.sin(s+N);var L=Math.abs(s-f+2*N)<=ja?0:1;
if(N&&mi(_,w,S,k)===1-g^L){var q=(s+f)/2;_=n*Math.cos(q),w=n*Math.sin(q),S=k=null;}}else{_=w=0;}if(h>Da&&(p=Math.min(Math.abs(c-n)/2,+u.apply(this,arguments)))>0.001){v=c>n^g?0:1;
var T=p,R=p;if(ja>h){var D=null==S?[_,w]:null==x?[y,M]:Re([y,M],[S,k],[x,b],[_,w]),P=y-D[0],j=M-D[1],U=x-D[0],F=b-D[1],H=1/Math.sin(Math.acos((P*U+j*F)/(Math.sqrt(P*P+j*j)*Math.sqrt(U*U+F*F)))/2),O=Math.sqrt(D[0]*D[0]+D[1]*D[1]);
R=Math.min(p,(n-O)/(H-1)),T=Math.min(p,(c-O)/(H+1));}if(null!=x){var I=yi(null==S?[_,w]:[S,k],[y,M],c,T,g),Y=yi([x,b],[_,w],c,T,g);
p===T?A.push("M",I[0],"A",T,",",T," 0 0,",v," ",I[1],"A",c,",",c," 0 ",1-g^mi(I[1][0],I[1][1],Y[1][0],Y[1][1]),",",g," ",Y[1],"A",T,",",T," 0 0,",v," ",Y[0]):A.push("M",I[0],"A",T,",",T," 0 1,",v," ",Y[0]);
}else{A.push("M",y,",",M);}if(null!=S){var Z=yi([y,M],[S,k],n,-R,g),V=yi([_,w],null==x?[y,M]:[x,b],n,-R,g);
p===R?A.push("L",V[0],"A",R,",",R," 0 0,",v," ",V[1],"A",n,",",n," 0 ",g^mi(V[1][0],V[1][1],Z[1][0],Z[1][1]),",",1-g," ",Z[1],"A",R,",",R," 0 0,",v," ",Z[0]):A.push("L",V[0],"A",R,",",R," 0 0,",v," ",Z[0]);
}else{A.push("L",_,",",w);}}else{A.push("M",y,",",M),null!=x&&A.push("A",c,",",c," 0 ",C,",",g," ",x,",",b),A.push("L",_,",",w),null!=S&&A.push("A",n,",",n," 0 ",L,",",1-g," ",S,",",k);
}return A.push("Z"),A.join("");}function t(n,t){return"M0,"+n+"A"+n+","+n+" 0 1,"+t+" 0,"+-n+"A"+n+","+n+" 0 1,"+t+" 0,"+n;
}var e=hi,r=gi,u=fi,i=Ll,a=pi,o=vi,l=di;return n.innerRadius=function(t){return arguments.length?(e=En(t),n):e;
},n.outerRadius=function(t){return arguments.length?(r=En(t),n):r;},n.cornerRadius=function(t){return arguments.length?(u=En(t),n):u;
},n.padRadius=function(t){return arguments.length?(i=t==Ll?Ll:En(t),n):i;},n.startAngle=function(t){return arguments.length?(a=En(t),n):a;
},n.endAngle=function(t){return arguments.length?(o=En(t),n):o;},n.padAngle=function(t){return arguments.length?(l=En(t),n):l;
},n.centroid=function(){var n=(+e.apply(this,arguments)+ +r.apply(this,arguments))/2,t=(+a.apply(this,arguments)+ +o.apply(this,arguments))/2-Ha;
return[Math.cos(t)*n,Math.sin(t)*n];},n;};var Ll="auto";oa.svg.line=function(){return Mi(y);};var ql=oa.map({linear:xi,"linear-closed":bi,step:_i,"step-before":wi,"step-after":Si,basis:zi,"basis-open":Li,"basis-closed":qi,bundle:Ti,cardinal:Ei,"cardinal-open":ki,"cardinal-closed":Ni,monotone:Fi});
ql.forEach(function(n,t){t.key=n,t.closed=/-closed$/.test(n);});var Tl=[0,2/3,1/3,0],Rl=[0,1/3,2/3,0],Dl=[0,1/6,2/3,1/6];
oa.svg.line.radial=function(){var n=Mi(Hi);return n.radius=n.x,delete n.x,n.angle=n.y,delete n.y,n;},wi.reverse=Si,Si.reverse=wi,oa.svg.area=function(){return Oi(y);
},oa.svg.area.radial=function(){var n=Oi(Hi);return n.radius=n.x,delete n.x,n.innerRadius=n.x0,delete n.x0,n.outerRadius=n.x1,delete n.x1,n.angle=n.y,delete n.y,n.startAngle=n.y0,delete n.y0,n.endAngle=n.y1,delete n.y1,n;
},oa.svg.chord=function(){function n(n,o){var l=t(this,i,n,o),c=t(this,a,n,o);return"M"+l.p0+r(l.r,l.p1,l.a1-l.a0)+(e(l,c)?u(l.r,l.p1,l.r,l.p0):u(l.r,l.p1,c.r,c.p0)+r(c.r,c.p1,c.a1-c.a0)+u(c.r,c.p1,l.r,l.p0))+"Z";
}function t(n,t,e,r){var u=t.call(n,e,r),i=o.call(n,u,r),a=l.call(n,u,r)-Ha,s=c.call(n,u,r)-Ha;return{r:i,a0:a,a1:s,p0:[i*Math.cos(a),i*Math.sin(a)],p1:[i*Math.cos(s),i*Math.sin(s)]};
}function e(n,t){return n.a0==t.a0&&n.a1==t.a1;}function r(n,t,e){return"A"+n+","+n+" 0 "+ +(e>ja)+",1 "+t;
}function u(n,t,e,r){return"Q 0,0 "+r;}var i=Me,a=xe,o=Ii,l=pi,c=vi;return n.radius=function(t){return arguments.length?(o=En(t),n):o;
},n.source=function(t){return arguments.length?(i=En(t),n):i;},n.target=function(t){return arguments.length?(a=En(t),n):a;
},n.startAngle=function(t){return arguments.length?(l=En(t),n):l;},n.endAngle=function(t){return arguments.length?(c=En(t),n):c;
},n;},oa.svg.diagonal=function(){function n(n,u){var i=t.call(this,n,u),a=e.call(this,n,u),o=(i.y+a.y)/2,l=[i,{x:i.x,y:o},{x:a.x,y:o},a];
return l=l.map(r),"M"+l[0]+"C"+l[1]+" "+l[2]+" "+l[3];}var t=Me,e=xe,r=Yi;return n.source=function(e){return arguments.length?(t=En(e),n):t;
},n.target=function(t){return arguments.length?(e=En(t),n):e;},n.projection=function(t){return arguments.length?(r=t,n):r;
},n;},oa.svg.diagonal.radial=function(){var n=oa.svg.diagonal(),t=Yi,e=n.projection;return n.projection=function(n){return arguments.length?e(Zi(t=n)):t;
},n;},oa.svg.symbol=function(){function n(n,r){return(Pl.get(t.call(this,n,r))||$i)(e.call(this,n,r));
}var t=Xi,e=Vi;return n.type=function(e){return arguments.length?(t=En(e),n):t;},n.size=function(t){return arguments.length?(e=En(t),n):e;
},n;};var Pl=oa.map({circle:$i,cross:function(n){var t=Math.sqrt(n/5)/2;return"M"+-3*t+","+-t+"H"+-t+"V"+-3*t+"H"+t+"V"+-t+"H"+3*t+"V"+t+"H"+t+"V"+3*t+"H"+-t+"V"+t+"H"+-3*t+"Z";
},diamond:function(n){var t=Math.sqrt(n/(2*Ul)),e=t*Ul;return"M0,"+-t+"L"+e+",0 0,"+t+" "+-e+",0Z";},square:function(n){var t=Math.sqrt(n)/2;
return"M"+-t+","+-t+"L"+t+","+-t+" "+t+","+t+" "+-t+","+t+"Z";},"triangle-down":function(n){var t=Math.sqrt(n/jl),e=t*jl/2;
return"M0,"+e+"L"+t+","+-e+" "+-t+","+-e+"Z";},"triangle-up":function(n){var t=Math.sqrt(n/jl),e=t*jl/2;
return"M0,"+-e+"L"+t+","+e+" "+-t+","+e+"Z";}});oa.svg.symbolTypes=Pl.keys();var jl=Math.sqrt(3),Ul=Math.tan(30*Oa);
Aa.transition=function(n){for(var t,e,r=Fl||++Yl,u=Ki(n),i=[],a=Hl||{time:Date.now(),ease:Nr,delay:0,duration:250},o=-1,l=this.length;
++o<l;){i.push(t=[]);for(var c=this[o],s=-1,f=c.length;++s<f;){(e=c[s])&&Qi(e,s,u,r,a),t.push(e);}}return Wi(i,u,r);
},Aa.interrupt=function(n){return this.each(null==n?Ol:Bi(Ki(n)));};var Fl,Hl,Ol=Bi(Ki()),Il=[],Yl=0;
Il.call=Aa.call,Il.empty=Aa.empty,Il.node=Aa.node,Il.size=Aa.size,oa.transition=function(n,t){return n&&n.transition?Fl?n.transition(t):n:oa.selection().transition(n);
},oa.transition.prototype=Il,Il.select=function(n){var t,e,r,u=this.id,i=this.namespace,a=[];n=A(n);for(var o=-1,l=this.length;
++o<l;){a.push(t=[]);for(var c=this[o],s=-1,f=c.length;++s<f;){(r=c[s])&&(e=n.call(r,r.__data__,s,o))?("__data__" in r&&(e.__data__=r.__data__),Qi(e,s,i,u,r[i][u]),t.push(e)):t.push(null);
}}return Wi(a,i,u);},Il.selectAll=function(n){var t,e,r,u,i,a=this.id,o=this.namespace,l=[];n=C(n);for(var c=-1,s=this.length;
++c<s;){for(var f=this[c],h=-1,g=f.length;++h<g;){if(r=f[h]){i=r[o][a],e=n.call(r,r.__data__,h,c),l.push(t=[]);
for(var p=-1,v=e.length;++p<v;){(u=e[p])&&Qi(u,p,o,a,i),t.push(u);}}}}return Wi(l,o,a);},Il.filter=function(n){var t,e,r,u=[];
"function"!=typeof n&&(n=O(n));for(var i=0,a=this.length;a>i;i++){u.push(t=[]);for(var e=this[i],o=0,l=e.length;
l>o;o++){(r=e[o])&&n.call(r,r.__data__,o,i)&&t.push(r);}}return Wi(u,this.namespace,this.id);},Il.tween=function(n,t){var e=this.id,r=this.namespace;
return arguments.length<2?this.node()[r][e].tween.get(n):Y(this,null==t?function(t){t[r][e].tween.remove(n);
}:function(u){u[r][e].tween.set(n,t);});},Il.attr=function(n,t){function e(){this.removeAttribute(o);
}function r(){this.removeAttributeNS(o.space,o.local);}function u(n){return null==n?e:(n+="",function(){var t,e=this.getAttribute(o);
return e!==n&&(t=a(e,n),function(n){this.setAttribute(o,t(n));});});}function i(n){return null==n?r:(n+="",function(){var t,e=this.getAttributeNS(o.space,o.local);
return e!==n&&(t=a(e,n),function(n){this.setAttributeNS(o.space,o.local,t(n));});});}if(arguments.length<2){for(t in n){this.attr(t,n[t]);
}return this;}var a="transform"==n?$r:Mr,o=oa.ns.qualify(n);return Ji(this,"attr."+n,t,o.local?i:u);},Il.attrTween=function(n,t){function e(n,e){var r=t.call(this,n,e,this.getAttribute(u));
return r&&function(n){this.setAttribute(u,r(n));};}function r(n,e){var r=t.call(this,n,e,this.getAttributeNS(u.space,u.local));
return r&&function(n){this.setAttributeNS(u.space,u.local,r(n));};}var u=oa.ns.qualify(n);return this.tween("attr."+n,u.local?r:e);
},Il.style=function(n,e,r){function u(){this.style.removeProperty(n);}function i(e){return null==e?u:(e+="",function(){var u,i=t(this).getComputedStyle(this,null).getPropertyValue(n);
return i!==e&&(u=Mr(i,e),function(t){this.style.setProperty(n,u(t),r);});});}var a=arguments.length;if(3>a){if("string"!=typeof n){2>a&&(e="");
for(r in n){this.style(r,n[r],e);}return this;}r="";}return Ji(this,"style."+n,e,i);},Il.styleTween=function(n,e,r){function u(u,i){var a=e.call(this,u,i,t(this).getComputedStyle(this,null).getPropertyValue(n));
return a&&function(t){this.style.setProperty(n,a(t),r);};}return arguments.length<3&&(r=""),this.tween("style."+n,u);
},Il.text=function(n){return Ji(this,"text",n,Gi);},Il.remove=function(){var n=this.namespace;return this.each("end.transition",function(){var t;
this[n].count<2&&(t=this.parentNode)&&t.removeChild(this);});},Il.ease=function(n){var t=this.id,e=this.namespace;
return arguments.length<1?this.node()[e][t].ease:("function"!=typeof n&&(n=oa.ease.apply(oa,arguments)),Y(this,function(r){r[e][t].ease=n;
}));},Il.delay=function(n){var t=this.id,e=this.namespace;return arguments.length<1?this.node()[e][t].delay:Y(this,"function"==typeof n?function(r,u,i){r[e][t].delay=+n.call(r,r.__data__,u,i);
}:(n=+n,function(r){r[e][t].delay=n;}));},Il.duration=function(n){var t=this.id,e=this.namespace;return arguments.length<1?this.node()[e][t].duration:Y(this,"function"==typeof n?function(r,u,i){r[e][t].duration=Math.max(1,n.call(r,r.__data__,u,i));
}:(n=Math.max(1,n),function(r){r[e][t].duration=n;}));},Il.each=function(n,t){var e=this.id,r=this.namespace;
if(arguments.length<2){var u=Hl,i=Fl;try{Fl=e,Y(this,function(t,u,i){Hl=t[r][e],n.call(t,t.__data__,u,i);
});}finally{Hl=u,Fl=i;}}else{Y(this,function(u){var i=u[r][e];(i.event||(i.event=oa.dispatch("start","end","interrupt"))).on(n,t);
});}return this;},Il.transition=function(){for(var n,t,e,r,u=this.id,i=++Yl,a=this.namespace,o=[],l=0,c=this.length;
c>l;l++){o.push(n=[]);for(var t=this[l],s=0,f=t.length;f>s;s++){(e=t[s])&&(r=e[a][u],Qi(e,s,a,i,{time:r.time,ease:r.ease,delay:r.delay+r.duration,duration:r.duration})),n.push(e);
}}return Wi(o,a,i);},oa.svg.axis=function(){function n(n){n.each(function(){var n,c=oa.select(this),s=this.__chart__||e,f=this.__chart__=e.copy(),h=null==l?f.ticks?f.ticks.apply(f,o):f.domain():l,g=null==t?f.tickFormat?f.tickFormat.apply(f,o):y:t,p=c.selectAll(".tick").data(h,f),v=p.enter().insert("g",".domain").attr("class","tick").style("opacity",Da),d=oa.transition(p.exit()).style("opacity",Da).remove(),m=oa.transition(p.order()).style("opacity",1),M=Math.max(u,0)+a,x=Zu(f),b=c.selectAll(".domain").data([0]),_=(b.enter().append("path").attr("class","domain"),oa.transition(b));
v.append("line"),v.append("text");var w,S,k,N,E=v.select("line"),A=m.select("line"),C=p.select("text").text(g),z=v.select("text"),L=m.select("text"),q="top"===r||"left"===r?-1:1;
if("bottom"===r||"top"===r?(n=na,w="x",k="y",S="x2",N="y2",C.attr("dy",0>q?"0em":".71em").style("text-anchor","middle"),_.attr("d","M"+x[0]+","+q*i+"V0H"+x[1]+"V"+q*i)):(n=ta,w="y",k="x",S="y2",N="x2",C.attr("dy",".32em").style("text-anchor",0>q?"end":"start"),_.attr("d","M"+q*i+","+x[0]+"H0V"+x[1]+"H"+q*i)),E.attr(N,q*u),z.attr(k,q*M),A.attr(S,0).attr(N,q*u),L.attr(w,0).attr(k,q*M),f.rangeBand){var T=f,R=T.rangeBand()/2;
s=f=function(n){return T(n)+R;};}else{s.rangeBand?s=f:d.call(n,f,s);}v.call(n,s,f),m.call(n,f,f);});}var t,e=oa.scale.linear(),r=Zl,u=6,i=6,a=3,o=[10],l=null;
return n.scale=function(t){return arguments.length?(e=t,n):e;},n.orient=function(t){return arguments.length?(r=t in Vl?t+"":Zl,n):r;
},n.ticks=function(){return arguments.length?(o=ca(arguments),n):o;},n.tickValues=function(t){return arguments.length?(l=t,n):l;
},n.tickFormat=function(e){return arguments.length?(t=e,n):t;},n.tickSize=function(t){var e=arguments.length;
return e?(u=+t,i=+arguments[e-1],n):u;},n.innerTickSize=function(t){return arguments.length?(u=+t,n):u;
},n.outerTickSize=function(t){return arguments.length?(i=+t,n):i;},n.tickPadding=function(t){return arguments.length?(a=+t,n):a;
},n.tickSubdivide=function(){return arguments.length&&n;},n;};var Zl="bottom",Vl={top:1,right:1,bottom:1,left:1};
oa.svg.brush=function(){function n(t){t.each(function(){var t=oa.select(this).style("pointer-events","all").style("-webkit-tap-highlight-color","rgba(0,0,0,0)").on("mousedown.brush",i).on("touchstart.brush",i),a=t.selectAll(".background").data([0]);
a.enter().append("rect").attr("class","background").style("visibility","hidden").style("cursor","crosshair"),t.selectAll(".extent").data([0]).enter().append("rect").attr("class","extent").style("cursor","move");
var o=t.selectAll(".resize").data(v,y);o.exit().remove(),o.enter().append("g").attr("class",function(n){return"resize "+n;
}).style("cursor",function(n){return Xl[n];}).append("rect").attr("x",function(n){return/[ew]$/.test(n)?-3:null;
}).attr("y",function(n){return/^[ns]/.test(n)?-3:null;}).attr("width",6).attr("height",6).style("visibility","hidden"),o.style("display",n.empty()?"none":null);
var l,f=oa.transition(t),h=oa.transition(a);c&&(l=Zu(c),h.attr("x",l[0]).attr("width",l[1]-l[0]),r(f)),s&&(l=Zu(s),h.attr("y",l[0]).attr("height",l[1]-l[0]),u(f)),e(f);
});}function e(n){n.selectAll(".resize").attr("transform",function(n){return"translate("+f[+/e$/.test(n)]+","+h[+/^s/.test(n)]+")";
});}function r(n){n.select(".extent").attr("x",f[0]),n.selectAll(".extent,.n>rect,.s>rect").attr("width",f[1]-f[0]);
}function u(n){n.select(".extent").attr("y",h[0]),n.selectAll(".extent,.e>rect,.w>rect").attr("height",h[1]-h[0]);
}function i(){function i(){32==oa.event.keyCode&&(C||(M=null,L[0]-=f[1],L[1]-=h[1],C=2),S());}function v(){32==oa.event.keyCode&&2==C&&(L[0]+=f[1],L[1]+=h[1],C=0,S());
}function d(){var n=oa.mouse(b),t=!1;x&&(n[0]+=x[0],n[1]+=x[1]),C||(oa.event.altKey?(M||(M=[(f[0]+f[1])/2,(h[0]+h[1])/2]),L[0]=f[+(n[0]<M[0])],L[1]=h[+(n[1]<M[1])]):M=null),E&&m(n,c,0)&&(r(k),t=!0),A&&m(n,s,1)&&(u(k),t=!0),t&&(e(k),w({type:"brush",mode:C?"move":"resize"}));
}function m(n,t,e){var r,u,i=Zu(t),l=i[0],c=i[1],s=L[e],v=e?h:f,d=v[1]-v[0];return C&&(l-=s,c-=d+s),r=(e?p:g)?Math.max(l,Math.min(c,n[e])):n[e],C?u=(r+=s)+d:(M&&(s=Math.max(l,Math.min(c,2*M[e]-r))),r>s?(u=r,r=s):u=s),v[0]!=r||v[1]!=u?(e?o=null:a=null,v[0]=r,v[1]=u,!0):void 0;
}function y(){d(),k.style("pointer-events","all").selectAll(".resize").style("display",n.empty()?"none":null),oa.select("body").style("cursor",null),q.on("mousemove.brush",null).on("mouseup.brush",null).on("touchmove.brush",null).on("touchend.brush",null).on("keydown.brush",null).on("keyup.brush",null),z(),w({type:"brushend"});
}var M,x,b=this,_=oa.select(oa.event.target),w=l.of(b,arguments),k=oa.select(b),N=_.datum(),E=!/^(n|s)$/.test(N)&&c,A=!/^(e|w)$/.test(N)&&s,C=_.classed("extent"),z=W(b),L=oa.mouse(b),q=oa.select(t(b)).on("keydown.brush",i).on("keyup.brush",v);
if(oa.event.changedTouches?q.on("touchmove.brush",d).on("touchend.brush",y):q.on("mousemove.brush",d).on("mouseup.brush",y),k.interrupt().selectAll("*").interrupt(),C){L[0]=f[0]-L[0],L[1]=h[0]-L[1];
}else{if(N){var T=+/w$/.test(N),R=+/^n/.test(N);x=[f[1-T]-L[0],h[1-R]-L[1]],L[0]=f[T],L[1]=h[R];}else{oa.event.altKey&&(M=L.slice());
}}k.style("pointer-events","none").selectAll(".resize").style("display",null),oa.select("body").style("cursor",_.style("cursor")),w({type:"brushstart"}),d();
}var a,o,l=N(n,"brushstart","brush","brushend"),c=null,s=null,f=[0,0],h=[0,0],g=!0,p=!0,v=$l[0];return n.event=function(n){n.each(function(){var n=l.of(this,arguments),t={x:f,y:h,i:a,j:o},e=this.__chart__||t;
this.__chart__=t,Fl?oa.select(this).transition().each("start.brush",function(){a=e.i,o=e.j,f=e.x,h=e.y,n({type:"brushstart"});
}).tween("brush:brush",function(){var e=xr(f,t.x),r=xr(h,t.y);return a=o=null,function(u){f=t.x=e(u),h=t.y=r(u),n({type:"brush",mode:"resize"});
};}).each("end.brush",function(){a=t.i,o=t.j,n({type:"brush",mode:"resize"}),n({type:"brushend"});}):(n({type:"brushstart"}),n({type:"brush",mode:"resize"}),n({type:"brushend"}));
});},n.x=function(t){return arguments.length?(c=t,v=$l[!c<<1|!s],n):c;},n.y=function(t){return arguments.length?(s=t,v=$l[!c<<1|!s],n):s;
},n.clamp=function(t){return arguments.length?(c&&s?(g=!!t[0],p=!!t[1]):c?g=!!t:s&&(p=!!t),n):c&&s?[g,p]:c?g:s?p:null;
},n.extent=function(t){var e,r,u,i,l;return arguments.length?(c&&(e=t[0],r=t[1],s&&(e=e[0],r=r[0]),a=[e,r],c.invert&&(e=c(e),r=c(r)),e>r&&(l=e,e=r,r=l),(e!=f[0]||r!=f[1])&&(f=[e,r])),s&&(u=t[0],i=t[1],c&&(u=u[1],i=i[1]),o=[u,i],s.invert&&(u=s(u),i=s(i)),u>i&&(l=u,u=i,i=l),(u!=h[0]||i!=h[1])&&(h=[u,i])),n):(c&&(a?(e=a[0],r=a[1]):(e=f[0],r=f[1],c.invert&&(e=c.invert(e),r=c.invert(r)),e>r&&(l=e,e=r,r=l))),s&&(o?(u=o[0],i=o[1]):(u=h[0],i=h[1],s.invert&&(u=s.invert(u),i=s.invert(i)),u>i&&(l=u,u=i,i=l))),c&&s?[[e,u],[r,i]]:c?[e,r]:s&&[u,i]);
},n.clear=function(){return n.empty()||(f=[0,0],h=[0,0],a=o=null),n;},n.empty=function(){return !!c&&f[0]==f[1]||!!s&&h[0]==h[1];
},oa.rebind(n,l,"on");};var Xl={n:"ns-resize",e:"ew-resize",s:"ns-resize",w:"ew-resize",nw:"nwse-resize",ne:"nesw-resize",se:"nwse-resize",sw:"nesw-resize"},$l=[["n","e","s","w","nw","ne","se","sw"],["e","w"],["n","s"],[]],Bl=ho.format=Mo.timeFormat,Wl=Bl.utc,Jl=Wl("%Y-%m-%dT%H:%M:%S.%LZ");
Bl.iso=Date.prototype.toISOString&&+new Date("2000-01-01T00:00:00.000Z")?ea:Jl,ea.parse=function(n){var t=new Date(n);
return isNaN(t)?null:t;},ea.toString=Jl.toString,ho.second=On(function(n){return new go(1000*Math.floor(n/1000));
},function(n,t){n.setTime(n.getTime()+1000*Math.floor(t));},function(n){return n.getSeconds();}),ho.seconds=ho.second.range,ho.seconds.utc=ho.second.utc.range,ho.minute=On(function(n){return new go(60000*Math.floor(n/60000));
},function(n,t){n.setTime(n.getTime()+60000*Math.floor(t));},function(n){return n.getMinutes();}),ho.minutes=ho.minute.range,ho.minutes.utc=ho.minute.utc.range,ho.hour=On(function(n){var t=n.getTimezoneOffset()/60;
return new go(3600000*(Math.floor(n/3600000-t)+t));},function(n,t){n.setTime(n.getTime()+3600000*Math.floor(t));
},function(n){return n.getHours();}),ho.hours=ho.hour.range,ho.hours.utc=ho.hour.utc.range,ho.month=On(function(n){return n=ho.day(n),n.setDate(1),n;
},function(n,t){n.setMonth(n.getMonth()+t);},function(n){return n.getMonth();}),ho.months=ho.month.range,ho.months.utc=ho.month.utc.range;
var Gl=[1000,5000,15000,30000,60000,300000,900000,1800000,3600000,10800000,21600000,43200000,86400000,172800000,604800000,2592000000,7776000000,31536000000],Kl=[[ho.second,1],[ho.second,5],[ho.second,15],[ho.second,30],[ho.minute,1],[ho.minute,5],[ho.minute,15],[ho.minute,30],[ho.hour,1],[ho.hour,3],[ho.hour,6],[ho.hour,12],[ho.day,1],[ho.day,2],[ho.week,1],[ho.month,1],[ho.month,3],[ho.year,1]],Ql=Bl.multi([[".%L",function(n){return n.getMilliseconds();
}],[":%S",function(n){return n.getSeconds();}],["%I:%M",function(n){return n.getMinutes();}],["%I %p",function(n){return n.getHours();
}],["%a %d",function(n){return n.getDay()&&1!=n.getDate();}],["%b %d",function(n){return 1!=n.getDate();
}],["%B",function(n){return n.getMonth();}],["%Y",zt]]),nc={range:function(n,t,e){return oa.range(Math.ceil(n/e)*e,+t,e).map(ua);
},floor:y,ceil:y};Kl.year=ho.year,ho.scale=function(){return ra(oa.scale.linear(),Kl,Ql);};var tc=Kl.map(function(n){return[n[0].utc,n[1]];
}),ec=Wl.multi([[".%L",function(n){return n.getUTCMilliseconds();}],[":%S",function(n){return n.getUTCSeconds();
}],["%I:%M",function(n){return n.getUTCMinutes();}],["%I %p",function(n){return n.getUTCHours();}],["%a %d",function(n){return n.getUTCDay()&&1!=n.getUTCDate();
}],["%b %d",function(n){return 1!=n.getUTCDate();}],["%B",function(n){return n.getUTCMonth();}],["%Y",zt]]);
tc.year=ho.year.utc,ho.scale.utc=function(){return ra(oa.scale.linear(),tc,ec);},oa.text=An(function(n){return n.responseText;
}),oa.json=function(n,t){return Cn(n,"application/json",ia,t);},oa.html=function(n,t){return Cn(n,"text/html",aa,t);
},oa.xml=An(function(n){return n.responseXML;}),"function"==typeof define&&define.amd?(this.d3=oa,define(oa)):"object"==typeof module&&module.exports?module.exports=oa:this.d3=oa;
}();(function(){function iScroll(el,eventTarget,options){this.element=typeof el=="object"?el:document.getElementById(el);
this.wrapper=this.element.parentNode;this.eventTarget=eventTarget?eventTarget:this.element;this.setScrollStyles(this.element);
this.options={bounce:has3d,momentum:has3d,checkDOMChanges:true,topOnDOMChanges:false,hScrollbar:has3d,vScrollbar:has3d,hScrollbarEnabled:true,vhScrollbarEnabled:true,fadeScrollbar:isIphone||isIpad||!isTouch,shrinkScrollbar:isIphone||isIpad,desktopCompatibility:false,overflow:"hidden",notifyOnPositionChanged:false,disableWhenZoomed:true};
if(typeof options=="object"){for(var i in options){this.options[i]=options[i];}}if(this.options.desktopCompatibility){this.options.overflow="hidden";
}this.wrapper.style.overflow=this.options.overflow;this.refresh();if(isTouch||this.options.desktopCompatibility){this.eventTarget.addEventListener(START_EVENT,this,false);
}if(this.options.checkDOMChanges){this.eventTarget.addEventListener("DOMSubtreeModified",this,false);
}if(this.options.disableWhenZoomed){var me=this;var disableWhenZoomed=function(){window.setTimeout(function(){me.disabled=Math.abs(window.innerWidth-document.body.scrollWidth)>5;
},0);};document.addEventListener("gestureend",disableWhenZoomed,false);document.addEventListener("touchend",disableWhenZoomed,false);
}}iScroll.prototype={x:0,y:0,dist:0,setScrollPositionAndTargets:function(xPosition,yPosition,scrollTargets){this.scrollTargets=scrollTargets;
for(var i=0;i<scrollTargets.length;i++){var elementDiv=document.getElementById(scrollTargets[i].id);this.setScrollStyles(elementDiv);
}this.setPositionPrivate(xPosition,yPosition,true);},setScrollStyles:function(element){element.style.webkitTransitionProperty="-webkit-transform";
element.style.webkitTransitionTimingFunction="cubic-bezier(0,0,0.25,1)";element.style.webkitTransitionDuration="0";
element.style.top=0;element.style.left=0;},handleEvent:function(e){switch(e.type){case START_EVENT:this.touchStart(e);
break;case MOVE_EVENT:this.touchMove(e);break;case END_EVENT:this.touchEnd(e);break;case"webkitTransitionEnd":this.transitionEnd(e);
break;case"DOMSubtreeModified":this.onDOMModified(e);break;}},onDOMModified:function(e){this.refresh();
if(this.options.topOnDOMChanges&&(this.x!=0||this.y!=0)){this.scrollTo(0,0,"0");}},refresh:function(){window.clearTimeout(this.refreshTimer);
var me=this;this.refreshTimer=window.setTimeout(function(){me.refreshCore();},500);},refreshCore:function(){this.scrollWidth=this.wrapper.clientWidth;
this.scrollHeight=this.wrapper.clientHeight;this.maxScrollX=this.scrollWidth-this.getWidth();this.maxScrollY=this.scrollHeight-this.getHeight();
var resetX=this.x,resetY=this.y;if(this.scrollX){if(this.maxScrollX>=0){resetX=0;}else{if(this.x<this.maxScrollX){resetX=this.maxScrollX;
}}}if(this.scrollY){if(this.maxScrollY>=0){resetY=0;}else{if(this.y<this.maxScrollY){resetY=this.maxScrollY;
}}}if(resetX!=this.x||resetY!=this.y){this.setTransitionTime("0");this.setPosition(resetX,resetY);}this.scrollX=this.getWidth()>this.scrollWidth&&this.options.hScrollbarEnabled?true:false;
this.scrollY=this.getHeight()>this.scrollHeight&&this.options.vhScrollbarEnabled?true:false;if(this.options.hScrollbar&&this.scrollX){this.scrollBarX=(this.scrollBarX instanceof scrollbar)?this.scrollBarX:new scrollbar("horizontal",this.wrapper,this.options.fadeScrollbar,this.options.shrinkScrollbar);
this.scrollBarX.init(this.scrollWidth,this.getWidth());this.scrollBarX.setPosition(this.x,true);}else{if(this.scrollBarX){this.scrollBarX=this.scrollBarX.remove();
}}if(this.options.vScrollbar&&this.scrollY&&this.getHeight()>this.scrollHeight){this.scrollBarY=(this.scrollBarY instanceof scrollbar)?this.scrollBarY:new scrollbar("vertical",this.wrapper,this.options.fadeScrollbar,this.options.shrinkScrollbar);
this.scrollBarY.init(this.scrollHeight,this.getHeight());this.scrollBarY.setPosition(this.y,true);}else{if(this.scrollBarY){this.scrollBarY=this.scrollBarY.remove();
}}},getWidth:function(){return this.element.scrollWidth;},getHeight:function(){return this.element.offsetHeight;
},setPosition:function(x,y){this.setPositionPrivate(x,y,true);},scrollTop:function(value){if(value===undefined){var pos=this.getPosition();
return -pos.y;}else{var pos=this.getPosition();this.setPosition(pos.x,-value);}},scrollLeft:function(value){if(value===undefined){var pos=this.getPosition();
return -pos.x;}else{var pos=this.getPosition();this.setPosition(-value,pos.y);}},getPosition:function(){var offset={x:0,y:0};
if(this.element.style.webkitTransform){var transform=this.element.style.webkitTransform;var index=transform.indexOf("translate3d");
if(index!=-1){var first=transform.indexOf(",");var second=transform.lastIndexOf(",");var yStr=transform.substring(first+1,second);
offset.y+=parseInt(yStr);first=transform.indexOf("(");second=transform.indexOf(",");var xStr=transform.substring(first+1,second);
offset.x+=parseInt(xStr);}}return offset;},setPositionPrivate:function(x,y,hideScrollBars){this.x=this.options.hScrollbarEnabled?x:0;
this.y=this.options.vhScrollbarEnabled?y:0;this.element.style.webkitTransform=has3d?"translate3d("+this.x+"px,"+this.y+"px,0px)":"translate("+this.x+"px,"+this.y+"px)";
if(this.scrollTargets){for(var i=0;i<this.scrollTargets.length;i++){var target=this.scrollTargets[i];
var targetDiv=document.getElementById(target.id);if(!targetDiv){continue;}var targetX=this.x;var targetY=this.y;
switch(target.scroll){case"horizontal":targetY=0;break;case"vertical":targetX=0;break;default:break;}targetDiv.style.webkitTransform=has3d?"translate3d("+targetX+"px,"+targetY+"px,0px)":"translate("+targetX+"px,"+targetY+"px)";
}}if(!hideScrollBars){if(this.scrollBarX){this.scrollBarX.setPosition(this.x);}if(this.scrollBarY){this.scrollBarY.setPosition(this.y);
}}if(this.options.notifyOnPositionChanged){if(this.onScroll){this.onScroll(this.x,this.y,this.wrapper);
}}},setTransitionTime:function(time){time=time||"0";this.element.style.webkitTransitionDuration=time;
if(this.scrollTargets){for(var i=0;i<this.scrollTargets.length;i++){var targetDiv=document.getElementById(this.scrollTargets[i].id);
if(targetDiv){targetDiv.style.webkitTransitionDuration=time;}}}if(this.scrollBarX){this.scrollBarX.bar.style.webkitTransitionDuration=time;
this.scrollBarX.wrapper.style.webkitTransitionDuration=has3d&&this.options.fadeScrollbar?"300ms":"0";
}if(this.scrollBarY){this.scrollBarY.bar.style.webkitTransitionDuration=time;this.scrollBarY.wrapper.style.webkitTransitionDuration=has3d&&this.options.fadeScrollbar?"300ms":"0";
}},touchStart:function(e){if(e.touches.length!=1){return false;}if(this.disabled){return false;}e.stopPropagation();
this.moved=false;this.dist=0;this.setTransitionTime("0");if(this.options.momentum){var matrix=new WebKitCSSMatrix(window.getComputedStyle(this.element).webkitTransform);
if(matrix.e!=this.x||matrix.f!=this.y){this.element.removeEventListener("webkitTransitionEnd",this,false);
this.setPositionPrivate(matrix.e,matrix.f,false);this.moved=true;}}this.refreshCore();this.touchStartX=isTouch?e.touches[0].pageX:e.pageX;
this.scrollStartX=this.x;this.touchStartY=isTouch?e.touches[0].pageY:e.pageY;this.scrollStartY=this.y;
this.scrollStartTime=e.timeStamp;this.eventTarget.addEventListener(MOVE_EVENT,this,false);this.eventTarget.addEventListener(END_EVENT,this,false);
},touchMove:function(e){if(e.touches.length!=1){return false;}if(this.disabled){return false;}Touch.clickBlocker();
e.preventDefault();var pageX=isTouch?e.touches[0].pageX:e.pageX,pageY=isTouch?e.touches[0].pageY:e.pageY,leftDelta=this.scrollX===true?pageX-this.touchStartX:0,topDelta=this.scrollY===true?pageY-this.touchStartY:0,newX=this.x+leftDelta,newY=this.y+topDelta;
this.dist+=Math.abs(this.touchStartX-pageX)+Math.abs(this.touchStartY-pageY);this.touchStartX=pageX;this.touchStartY=pageY;
if(newX>0||newX<this.maxScrollX){newX=this.options.bounce?Math.round(this.x+leftDelta/3):newX>=0?0:this.maxScrollX;
}if(newY>0||newY<this.maxScrollY){newY=this.options.bounce?Math.round(this.y+topDelta/3):newY>=0?0:this.maxScrollY;
}if(this.dist>5){this.setPositionPrivate(newX,newY,false);this.moved=true;}},touchEnd:function(e){this.eventTarget.removeEventListener(MOVE_EVENT,this,false);
this.eventTarget.removeEventListener(END_EVENT,this,false);var time=e.timeStamp-this.scrollStartTime;
if(!this.moved){this.resetPosition();return false;}if(!this.options.momentum||time>250){this.resetPosition();
if(this.onScroll){this.onScroll(this.x,this.y,this.wrapper);}return false;}var momentumX=this.scrollX===true?this.momentum(this.x-this.scrollStartX,time,this.options.bounce?-this.x+this.scrollWidth/5:-this.x,this.options.bounce?this.x+this.getWidth()-this.scrollWidth+this.scrollWidth/5:this.x+this.getWidth()-this.scrollWidth):{dist:0,time:0};
var momentumY=this.scrollY===true?this.momentum(this.y-this.scrollStartY,time,this.options.bounce?-this.y+this.scrollHeight/5:-this.y,this.options.bounce?(this.maxScrollY<0?this.y+this.getHeight()-this.scrollHeight:0)+this.scrollHeight/5:this.y+this.getHeight()-this.scrollHeight):{dist:0,time:0};
if(!momentumX.dist&&!momentumY.dist){this.resetPosition();return false;}var newDuration=Math.max(Math.max(momentumX.time,momentumY.time),1);
var newPositionX=this.x+momentumX.dist;var newPositionY=this.y+momentumY.dist;this.scrollTo(newPositionX,newPositionY,newDuration+"ms");
},transitionEnd:function(){this.element.removeEventListener("webkitTransitionEnd",this,false);this.resetPosition();
if(this.onScroll){this.onScroll(this.x,this.y,this.wrapper);}},resetPosition:function(time){var resetX=this.x,resetY=this.y,that=this,time=time||"500ms";
if(this.x>=0){resetX=0;}else{if(this.x<this.maxScrollX){resetX=this.maxScrollX;}}if(this.y>=0||this.maxScrollY>0){resetY=0;
}else{if(this.y<this.maxScrollY){resetY=this.maxScrollY;}}if(resetX!=this.x||resetY!=this.y){this.scrollTo(resetX,resetY,time);
}else{this.setPositionPrivate(this.x,this.y,true);if(this.scrollBarX||this.scrollBarY){if(this.scrollBarX){this.scrollBarX.hide();
}if(this.scrollBarY){this.scrollBarY.hide();}}}},scrollTo:function(destX,destY,runtime){this.eventTarget.addEventListener("webkitTransitionEnd",this,false);
this.setTransitionTime(runtime||"450ms");this.setPositionPrivate(destX,destY,false);},momentum:function(dist,time,maxDistUpper,maxDistLower){var friction=2.5,deceleration=1.2,speed=Math.abs(dist)/time*1000,newDist=speed*speed/friction/1000,newTime=0;
if(dist>0&&newDist>maxDistUpper){speed=speed*maxDistUpper/newDist/friction;newDist=maxDistUpper;}else{if(dist<0&&newDist>maxDistLower){speed=speed*maxDistLower/newDist/friction;
newDist=maxDistLower;}}newDist=newDist*(dist<0?-1:1);newTime=speed/deceleration;return{dist:Math.round(newDist),time:Math.round(newTime)};
},destroy:function(full){this.element.removeEventListener(START_EVENT,this,false);this.element.removeEventListener(MOVE_EVENT,this,false);
this.element.removeEventListener(END_EVENT,this,false);this.element.removeEventListener("DOMSubtreeModified",this,false);
this.element.removeEventListener("webkitTransitionEnd",this,false);if(this.scrollBarX){this.scrollBarX=this.scrollBarX.remove();
}if(this.scrollBarY){this.scrollBarY=this.scrollBarY.remove();}if(full){this.wrapper.parentNode.removeChild(this.wrapper);
}return null;}};var scrollbar=function(dir,wrapper,fade,shrink){this.dir=dir;this.fade=fade;this.shrink=shrink;
this.bar=document.createElement("div");var style="position:absolute;top:0;left:0;-webkit-transition-timing-function:cubic-bezier(0,0,0.25,1);pointer-events:none;-webkit-transition-duration:0;-webkit-transition-delay:0;-webkit-transition-property:-webkit-transform;background:rgba(0,0,0,0.5);"+(has3d?"-webkit-transform:translate3d(0,0,0);":"-webkit-transform:translate(0,0);")+(dir=="horizontal"?"-webkit-border-radius:3px 2px;min-width:6px;min-height:5px":"-webkit-border-radius:2px 3px;min-width:5px;min-height:6px");
this.bar.setAttribute("style",style);this.wrapper=document.createElement("div");style="position:absolute;pointer-events:none;overflow:hidden;opacity:0;-webkit-transition-duration:"+(fade?"300ms":"0")+";-webkit-transition-delay:0;-webkit-transition-property:opacity;z-index:10;"+(this.dir=="horizontal"?"bottom:2px;left:1px;right:7px;height:5px;border-radius:3px":"top:1px;right:2px;bottom:7px;width:5px;border-radius:3px;");
this.wrapper.setAttribute("style",style);this.wrapper.appendChild(this.bar);wrapper.appendChild(this.wrapper);
};scrollbar.prototype={init:function(scroll,size){this.maxSize=this.dir=="horizontal"?this.wrapper.clientWidth:this.wrapper.clientHeight;
this.size=Math.round(this.maxSize*this.maxSize/size);this.maxScroll=this.maxSize-this.size;this.toWrapperProp=this.maxScroll/(scroll-size);
this.bar.style[this.dir=="horizontal"?"width":"height"]=this.size+"px";},setPosition:function(pos,hidden){if(!hidden&&this.wrapper.style.opacity!="1"){this.show();
}pos=this.toWrapperProp*pos;if(pos<0){pos=this.shrink?pos+pos*3:0;if(this.size+pos<5){pos=-this.size+5;
}}else{if(pos>this.maxScroll){pos=this.shrink?pos+(pos-this.maxScroll)*3:this.maxScroll;if(this.size+this.maxScroll-pos<5){pos=this.size+this.maxScroll-5;
}}}if(has3d){pos=this.dir=="horizontal"?"translate3d("+Math.round(pos)+"px,0,0)":"translate3d(0,"+Math.round(pos)+"px,0)";
}else{pos=this.dir=="horizontal"?"translate("+Math.round(pos)+"px,0)":"translate(0,"+Math.round(pos)+"px)";
}this.bar.style.webkitTransform=pos;},show:function(){if(has3d){this.wrapper.style.webkitTransitionDelay="0";
}this.wrapper.style.opacity="1";},hide:function(){if(has3d){this.wrapper.style.webkitTransitionDelay="200ms";
}this.wrapper.style.opacity="0";},remove:function(){if(this.wrapper.parentNode){this.wrapper.parentNode.removeChild(this.wrapper);
}return null;}};var has3d=("WebKitCSSMatrix" in window&&"m11" in new WebKitCSSMatrix()),isIphone=navigator.appVersion.match(/iphone/gi)?true:false,isIpad=navigator.appVersion.match(/ipad/gi)?true:false,isAndroid=navigator.appVersion.match(/android/gi)?true:false,isTouch=isIphone||isIpad||isAndroid,START_EVENT=isTouch?"touchstart":"mousedown",MOVE_EVENT=isTouch?"touchmove":"mousemove",END_EVENT=isTouch?"touchend":"mouseup";
window.IScroll=iScroll;})();if(typeof JSON!=="object"){JSON={};}(function(){var rx_one=/^[\],:{}\s]*$/,rx_two=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,rx_three=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,rx_four=/(?:^|:|,)(?:\s*\[)+/g,rx_escapable=/[\\\"\u0000-\u001f\u007f-\u009f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,rx_dangerous=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;
function f(n){return n<10?"0"+n:n;}function this_value(){return this.valueOf();}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null;
};Boolean.prototype.toJSON=this_value;Number.prototype.toJSON=this_value;String.prototype.toJSON=this_value;
}var gap,indent,meta,rep;function quote(string){rx_escapable.lastIndex=0;return rx_escapable.test(string)?'"'+string.replace(rx_escapable,function(a){var c=meta[a];
return typeof c==="string"?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4);})+'"':'"'+string+'"';
}function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value&&typeof value==="object"&&typeof value.toJSON==="function"){value=value.toJSON(key);
}if(typeof rep==="function"){value=rep.call(holder,key,value);}switch(typeof value){case"string":return quote(value);
case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);
case"object":if(!value){return"null";}gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==="[object Array]"){length=value.length;
for(i=0;i<length;i+=1){partial[i]=str(i,value)||"null";}v=partial.length===0?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]";
gap=mind;return v;}if(rep&&typeof rep==="object"){length=rep.length;for(i=0;i<length;i+=1){if(typeof rep[i]==="string"){k=rep[i];
v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v);}}}}else{for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=str(k,value);
if(v){partial.push(quote(k)+(gap?": ":":")+v);}}}}v=partial.length===0?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}";
gap=mind;return v;}}if(typeof JSON.stringify!=="function"){meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};
JSON.stringify=function(value,replacer,space){var i;gap="";indent="";if(typeof space==="number"){for(i=0;
i<space;i+=1){indent+=" ";}}else{if(typeof space==="string"){indent=space;}}rep=replacer;if(replacer&&typeof replacer!=="function"&&(typeof replacer!=="object"||typeof replacer.length!=="number")){throw new Error("JSON.stringify");
}return str("",{"":value});};}if(typeof JSON.parse!=="function"){JSON.parse=function(text,reviver){var j;
function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==="object"){for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=walk(value,k);
if(v!==undefined){value[k]=v;}else{delete value[k];}}}}return reviver.call(holder,key,value);}text=String(text);
rx_dangerous.lastIndex=0;if(rx_dangerous.test(text)){text=text.replace(rx_dangerous,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4);
});}if(rx_one.test(text.replace(rx_two,"@").replace(rx_three,"]").replace(rx_four,""))){j=eval("("+text+")");
return typeof reviver==="function"?walk({"":j},""):j;}throw new SyntaxError("JSON.parse");};}}());(function(mod){if(typeof exports=="object"&&typeof module=="object"){mod(require("../../lib/codemirror"));
}else{if(typeof define=="function"&&define.amd){define(["../../lib/codemirror"],mod);}else{mod(CodeMirror);
}}})(function(CodeMirror){var ie_lt8=/MSIE \d/.test(navigator.userAgent)&&(document.documentMode==null||document.documentMode<8);
var Pos=CodeMirror.Pos;var matching={"(":")>",")":"(<","[":"]>","]":"[<","{":"}>","}":"{<"};function findMatchingBracket(cm,where,strict,config){var line=cm.getLineHandle(where.line),pos=where.ch-1;
var match=(pos>=0&&matching[line.text.charAt(pos)])||matching[line.text.charAt(++pos)];if(!match){return null;
}var dir=match.charAt(1)==">"?1:-1;if(strict&&(dir>0)!=(pos==where.ch)){return null;}var style=cm.getTokenTypeAt(Pos(where.line,pos+1));
var found=scanForBracket(cm,Pos(where.line,pos+(dir>0?1:0)),dir,style||null,config);if(found==null){return null;
}return{from:Pos(where.line,pos),to:found&&found.pos,match:found&&found.ch==match.charAt(0),forward:dir>0};
}function scanForBracket(cm,where,dir,style,config){var maxScanLen=(config&&config.maxScanLineLength)||10000;
var maxScanLines=(config&&config.maxScanLines)||1000;var stack=[];var re=config&&config.bracketRegex?config.bracketRegex:/[(){}[\]]/;
var lineEnd=dir>0?Math.min(where.line+maxScanLines,cm.lastLine()+1):Math.max(cm.firstLine()-1,where.line-maxScanLines);
for(var lineNo=where.line;lineNo!=lineEnd;lineNo+=dir){var line=cm.getLine(lineNo);if(!line){continue;
}var pos=dir>0?0:line.length-1,end=dir>0?line.length:-1;if(line.length>maxScanLen){continue;}if(lineNo==where.line){pos=where.ch-(dir<0?1:0);
}for(;pos!=end;pos+=dir){var ch=line.charAt(pos);if(re.test(ch)&&(style===undefined||cm.getTokenTypeAt(Pos(lineNo,pos+1))==style)){var match=matching[ch];
if((match.charAt(1)==">")==(dir>0)){stack.push(ch);}else{if(!stack.length){return{pos:Pos(lineNo,pos),ch:ch};
}else{stack.pop();}}}}}return lineNo-dir==(dir>0?cm.lastLine():cm.firstLine())?false:null;}function matchBrackets(cm,autoclear,config){var maxHighlightLen=cm.state.matchBrackets.maxHighlightLineLength||1000;
var marks=[],ranges=cm.listSelections();for(var i=0;i<ranges.length;i++){var match=ranges[i].empty()&&findMatchingBracket(cm,ranges[i].head,false,config);
if(match&&cm.getLine(match.from.line).length<=maxHighlightLen){var style=match.match?"CodeMirror-matchingbracket":"CodeMirror-nonmatchingbracket";
marks.push(cm.markText(match.from,Pos(match.from.line,match.from.ch+1),{className:style}));if(match.to&&cm.getLine(match.to.line).length<=maxHighlightLen){marks.push(cm.markText(match.to,Pos(match.to.line,match.to.ch+1),{className:style}));
}}}if(marks.length){if(ie_lt8&&cm.state.focused){cm.focus();}var clear=function(){cm.operation(function(){for(var i=0;
i<marks.length;i++){marks[i].clear();}});};if(autoclear){setTimeout(clear,800);}else{return clear;}}}var currentlyHighlighted=null;
function doMatchBrackets(cm){cm.operation(function(){if(currentlyHighlighted){currentlyHighlighted();
currentlyHighlighted=null;}currentlyHighlighted=matchBrackets(cm,false,cm.state.matchBrackets);});}CodeMirror.defineOption("matchBrackets",false,function(cm,val,old){if(old&&old!=CodeMirror.Init){cm.off("cursorActivity",doMatchBrackets);
if(currentlyHighlighted){currentlyHighlighted();currentlyHighlighted=null;}}if(val){cm.state.matchBrackets=typeof val=="object"?val:{};
cm.on("cursorActivity",doMatchBrackets);}});CodeMirror.defineExtension("matchBrackets",function(){matchBrackets(this,true);
});CodeMirror.defineExtension("findMatchingBracket",function(pos,strict,config){return findMatchingBracket(this,pos,strict,config);
});CodeMirror.defineExtension("scanForBracket",function(pos,dir,style,config){return scanForBracket(this,pos,dir,style,config);
});});if(!window.OpenAjax){OpenAjax=new function(){var t=true;var f=false;var g=window;var ooh="org.openajax.hub.";
var h={};this.hub=h;h.implementer="http://openajax.org";h.implVersion="2.0";h.specVersion="2.0";h.implExtraData={};
var libs={};h.libraries=libs;h.registerLibrary=function(prefix,nsURL,version,extra){libs[prefix]={prefix:prefix,namespaceURI:nsURL,version:version,extraData:extra};
this.publish(ooh+"registerLibrary",libs[prefix]);};h.unregisterLibrary=function(prefix){this.publish(ooh+"unregisterLibrary",libs[prefix]);
delete libs[prefix];};h._subscriptions={c:{},s:[]};h._cleanup=[];h._subIndex=0;h._pubDepth=0;h.subscribe=function(name,callback,scope,subscriberData,filter){if(!scope){scope=window;
}var handle=name+"."+this._subIndex;var sub={scope:scope,cb:callback,fcb:filter,data:subscriberData,sid:this._subIndex++,hdl:handle};
var path=name.split(".");this._subscribe(this._subscriptions,path,0,sub);return handle;};h.publish=function(name,message){var path=name.split(".");
this._pubDepth++;this._publish(this._subscriptions,path,0,name,message);this._pubDepth--;if((this._cleanup.length>0)&&(this._pubDepth==0)){for(var i=0;
i<this._cleanup.length;i++){this.unsubscribe(this._cleanup[i].hdl);}delete (this._cleanup);this._cleanup=[];
}};h.unsubscribe=function(sub){var path=sub.split(".");var sid=path.pop();this._unsubscribe(this._subscriptions,path,0,sid);
};h._subscribe=function(tree,path,index,sub){var token=path[index];if(index==path.length){tree.s.push(sub);
}else{if(typeof tree.c=="undefined"){tree.c={};}if(typeof tree.c[token]=="undefined"){tree.c[token]={c:{},s:[]};
this._subscribe(tree.c[token],path,index+1,sub);}else{this._subscribe(tree.c[token],path,index+1,sub);
}}};h._publish=function(tree,path,index,name,msg,pid){if(typeof tree!="undefined"){var node;if(index==path.length){node=tree;
}else{this._publish(tree.c[path[index]],path,index+1,name,msg,pid);this._publish(tree.c["*"],path,index+1,name,msg,pid);
node=tree.c["**"];}if(typeof node!="undefined"){var callbacks=node.s;var max=callbacks.length;for(var i=0;
i<max;i++){if(callbacks[i].cb){var sc=callbacks[i].scope;var cb=callbacks[i].cb;var fcb=callbacks[i].fcb;
var d=callbacks[i].data;if(typeof cb=="string"){cb=sc[cb];}if(typeof fcb=="string"){fcb=sc[fcb];}if((!fcb)||(fcb.call(sc,name,msg,d))){cb.call(sc,name,msg,d,pid);
}}}}}};h._unsubscribe=function(tree,path,index,sid){if(typeof tree!="undefined"){if(index<path.length){var childNode=tree.c[path[index]];
this._unsubscribe(childNode,path,index+1,sid);if(childNode.s.length==0){for(var x in childNode.c){return;
}delete tree.c[path[index]];}return;}else{var callbacks=tree.s;var max=callbacks.length;for(var i=0;i<max;
i++){if(sid==callbacks[i].sid){if(this._pubDepth>0){callbacks[i].cb=null;this._cleanup.push(callbacks[i]);
}else{callbacks.splice(i,1);}return;}}}}};};OpenAjax.hub.registerLibrary("OpenAjax","http://openajax.org/hub","1.0",{});
}if(!window.PageBus){PageBus=new function(){var D=0;var Q=[];var that=this;this.version="2.0.0";this._debug=function(){};
_badParm=function(){throw new Error("OpenAjax.hub.Errors.BadParameters");};_valPub=function(name){if((name==null)||(name.indexOf("*")!=-1)||(name.indexOf("..")!=-1)||(name.charAt(0)==".")||(name.charAt(name.length-1)==".")){_badParm();
}};_valSub=function(name){var path=name.split(".");var len=path.length;for(var i=0;i<len;i++){if((path[i]=="")||((path[i].indexOf("*")!=-1)&&(path[i]!="*")&&(path[i]!="**"))){_badParm();
}if((path[i]=="**")&&(i<len-1)){_badParm();}}return path;};_cacheIt=function(subData){return((subData)&&(typeof subData=="object")&&(subData.PageBus)&&(subData.PageBus.cache));
};_TopicMatcher=function(){this._items={};};_TopicMatcher.prototype.store=function(topic,val){var path=topic.split(".");
var len=path.length;_recurse=function(tree,index){if(index==len){tree["."]={topic:topic,value:val};}else{var token=path[index];
if(!tree[token]){tree[token]={};}_recurse(tree[token],index+1);}};_recurse(this._items,0);};_TopicMatcher.prototype.match=function(topic,exactMatch){var path=topic.split(".");
var len=path.length;var res=[];_recurse=function(tree,index){if(!tree){return;}var node;if(index==len){node=tree;
}else{_recurse(tree[path[index]],index+1);if(exactMatch){return;}if(path[index]!="**"){_recurse(tree["*"],index+1);
}node=tree["**"];}if((!node)||(!node["."])){return;}res.push(node["."]);};_recurse(this._items,0);return res;
};_TopicMatcher.prototype.exists=function(topic,exactMatch){var path=topic.split(".");var len=path.length;
var res=false;_recurse=function(tree,index){if(!tree){return;}var node;if(index==len){node=tree;}else{_recurse(tree[path[index]],index+1);
if(res||exactMatch){return;}if(path[index]!="**"){_recurse(tree["*"],index+1);if(res){return;}}node=tree["**"];
}if((!node)||(!node["."])){return;}res=true;};_recurse(this._items,0);return res;};_TopicMatcher.prototype.clear=function(topic){var path=topic.split(".");
var len=path.length;_recurse=function(tree,index){if(!tree){return;}if(index==len){if(tree["."]){delete tree["."];
}}else{_recurse(tree[path[index]],index+1);for(var x in tree[path[index]]){return;}delete tree[path[index]];
}};_recurse(this._items,0);};_TopicMatcher.prototype.wildcardMatch=function(topic){var path=topic.split(".");
var len=path.length;var res=[];_recurse=function(tree,index){var tok=path[index];var node;if((!tree)||(index==len)){return;
}if(tok=="**"){for(var n in tree){if(n!="."){node=tree[n];if(node["."]){res.push(node["."]);}_recurse(node,index);
}}}else{if(tok=="*"){for(var n in tree){if((n!=".")&&(n!="**")){node=tree[n];if(index==len-1){if(node["."]){res.push(node["."]);
}}else{_recurse(node,index+1);}}}}else{node=tree[tok];if(!node){return;}if(index==len-1){if(node["."]){res.push(node["."]);
}}else{_recurse(node,index+1);}}}};_recurse(this._items,0);return res;};this._refs={};this._doCache=new _TopicMatcher();
this._caches=new _TopicMatcher();_isCaching=function(topic){return that._doCache.exists(topic,false);
};_copy=function(obj){var c;if(typeof(obj)=="object"){if(obj==null){return null;}else{if(obj.constructor==Array){c=[];
for(var i=0;i<obj.length;i++){c[i]=_copy(obj[i]);}return c;}else{if(obj.constructor==Date){c=new Date();
c.setDate(obj.getDate());return c;}}}c={};for(var p in obj){c[p]=_copy(obj[p]);}return c;}else{return obj;
}};this._add=function(topic,subID){var dc;var dca=this._doCache.match(topic,true);if(dca.length>0){dc=dca[0].value;
}else{dc={rc:0};this._doCache.store(topic,dc);}dc.rc++;this._refs[subID]=topic;};this._remove=function(subID){var topic=this._refs[subID];
if(!topic){return;}delete this._refs[subID];var dca=this._doCache.match(topic,true);if(dca.length==0){return;
}dca[0].value.rc--;if(dca[0].value.rc==0){this._doCache.clear(topic);var caches=this._caches.wildcardMatch(topic);
for(var i=0;i<caches.length;i++){if(!(this._doCache.exists(caches[i].topic,false))){this._caches.clear(caches[i].topic);
}}}};this.subscribe=function(topic,scope,onData,subscriberData){if(!subscriberData){subscriberData=null;
}var sid=OpenAjax.hub.subscribe(topic,onData,scope,subscriberData);if(_cacheIt(subscriberData)){this._add(topic,sid);
var vals=this.query(topic);for(var i=0;i<vals.length;i++){try{onData.call(scope?scope:window,vals[i].topic,vals[i].value,subscriberData);
}catch(e){PageBus._debug();}}}return sid;};this.publish=function(topic,data){_valPub(topic);Q.push({n:topic,m:data,d:(D+1)});
if(_isCaching(topic)){try{this._caches.store(topic,data);}catch(e){_badParm();}}if(D==0){while(Q.length>0){var qitem=Q.shift();
var path=qitem.n.split(".");try{D=qitem.d;OpenAjax.hub.publish(qitem.n,qitem.m);D=0;}catch(err){D=0;throw (err);
}}}};this.unsubscribe=function(sub){try{this._remove(sub);OpenAjax.hub.unsubscribe(sub);}catch(err){_badParm();
}};this.store=function(topic,data){if(!_isCaching(topic)){throw new Error("PageBus.cache.NoCache");}this.publish(topic,data);
};this.query=function(topic){try{_valSub(topic);return this._caches.wildcardMatch(topic);}catch(e){_badParm();
}};};OpenAjax.hub.registerLibrary("PageBus","http://tibco.com/PageBus","1.2.0",{});}(function(mod){if(typeof exports=="object"&&typeof module=="object"){mod(require("../../lib/codemirror"));
}else{if(typeof define=="function"&&define.amd){define(["../../lib/codemirror"],mod);}else{mod(CodeMirror);
}}})(function(CodeMirror){var HINT_ELEMENT_CLASS="CodeMirror-hint";var ACTIVE_HINT_ELEMENT_CLASS="CodeMirror-hint-active";
CodeMirror.showHint=function(cm,getHints,options){if(!getHints){return cm.showHint(options);}if(options&&options.async){getHints.async=true;
}var newOpts={hint:getHints};if(options){for(var prop in options){newOpts[prop]=options[prop];}}return cm.showHint(newOpts);
};CodeMirror.defineExtension("showHint",function(options){options=parseOptions(this,this.getCursor("start"),options);
var selections=this.listSelections();if(selections.length>1){return;}if(this.somethingSelected()){if(!options.hint.supportsSelection){return;
}for(var i=0;i<selections.length;i++){if(selections[i].head.line!=selections[i].anchor.line){return;}}}if(this.state.completionActive){this.state.completionActive.close();
}var completion=this.state.completionActive=new Completion(this,options);if(!completion.options.hint){return;
}CodeMirror.signal(this,"startCompletion",this);completion.update(true);});function Completion(cm,options){this.cm=cm;
this.options=options;this.widget=null;this.debounce=0;this.tick=0;this.startPos=this.cm.getCursor("start");
this.startLen=this.cm.getLine(this.startPos.line).length-this.cm.getSelection().length;var self=this;
cm.on("cursorActivity",this.activityFunc=function(){self.cursorActivity();});}var requestAnimationFrame=window.requestAnimationFrame||function(fn){return setTimeout(fn,1000/60);
};var cancelAnimationFrame=window.cancelAnimationFrame||clearTimeout;Completion.prototype={close:function(){if(!this.active()){return;
}this.cm.state.completionActive=null;this.tick=null;this.cm.off("cursorActivity",this.activityFunc);if(this.widget&&this.data){CodeMirror.signal(this.data,"close");
}if(this.widget){this.widget.close();}CodeMirror.signal(this.cm,"endCompletion",this.cm);},active:function(){return this.cm.state.completionActive==this;
},pick:function(data,i){var completion=data.list[i];if(completion.hint){completion.hint(this.cm,data,completion);
}else{this.cm.replaceRange(getText(completion),completion.from||data.from,completion.to||data.to,"complete");
}CodeMirror.signal(data,"pick",completion);this.close();},cursorActivity:function(){if(this.debounce){cancelAnimationFrame(this.debounce);
this.debounce=0;}var pos=this.cm.getCursor(),line=this.cm.getLine(pos.line);if(pos.line!=this.startPos.line||line.length-pos.ch!=this.startLen-this.startPos.ch||pos.ch<this.startPos.ch||this.cm.somethingSelected()||(pos.ch&&this.options.closeCharacters.test(line.charAt(pos.ch-1)))){this.close();
}else{var self=this;this.debounce=requestAnimationFrame(function(){self.update();});if(this.widget){this.widget.disable();
}}},update:function(first){if(this.tick==null){return;}var self=this,myTick=++this.tick;fetchHints(this.options.hint,this.cm,this.options,function(data){if(self.tick==myTick){self.finishUpdate(data,first);
}});},finishUpdate:function(data,first){if(this.data){CodeMirror.signal(this.data,"update");}var picked=(this.widget&&this.widget.picked)||(first&&this.options.completeSingle);
if(this.widget){this.widget.close();}if(data&&this.data&&isNewCompletion(this.data,data)){return;}this.data=data;
if(data&&data.list.length){if(picked&&data.list.length==1){this.pick(data,0);}else{this.widget=new Widget(this,data);
CodeMirror.signal(data,"shown");}}}};function isNewCompletion(old,nw){var moved=CodeMirror.cmpPos(nw.from,old.from);
return moved>0&&old.to.ch-old.from.ch!=nw.to.ch-nw.from.ch;}function parseOptions(cm,pos,options){var editor=cm.options.hintOptions;
var out={};for(var prop in defaultOptions){out[prop]=defaultOptions[prop];}if(editor){for(var prop in editor){if(editor[prop]!==undefined){out[prop]=editor[prop];
}}}if(options){for(var prop in options){if(options[prop]!==undefined){out[prop]=options[prop];}}}if(out.hint.resolve){out.hint=out.hint.resolve(cm,pos);
}return out;}function getText(completion){if(typeof completion=="string"){return completion;}else{return completion.text;
}}function buildKeyMap(completion,handle){var baseMap={Up:function(){handle.moveFocus(-1);},Down:function(){handle.moveFocus(1);
},PageUp:function(){handle.moveFocus(-handle.menuSize()+1,true);},PageDown:function(){handle.moveFocus(handle.menuSize()-1,true);
},Home:function(){handle.setFocus(0);},End:function(){handle.setFocus(handle.length-1);},Enter:handle.pick,Tab:handle.pick,Esc:handle.close};
var custom=completion.options.customKeys;var ourMap=custom?{}:baseMap;function addBinding(key,val){var bound;
if(typeof val!="string"){bound=function(cm){return val(cm,handle);};}else{if(baseMap.hasOwnProperty(val)){bound=baseMap[val];
}else{bound=val;}}ourMap[key]=bound;}if(custom){for(var key in custom){if(custom.hasOwnProperty(key)){addBinding(key,custom[key]);
}}}var extra=completion.options.extraKeys;if(extra){for(var key in extra){if(extra.hasOwnProperty(key)){addBinding(key,extra[key]);
}}}return ourMap;}function getHintElement(hintsElement,el){while(el&&el!=hintsElement){if(el.nodeName.toUpperCase()==="LI"&&el.parentNode==hintsElement){return el;
}el=el.parentNode;}}function Widget(completion,data){this.completion=completion;this.data=data;this.picked=false;
var widget=this,cm=completion.cm;var hints=this.hints=document.createElement("ul");hints.className="CodeMirror-hints";
this.selectedHint=data.selectedHint||0;var completions=data.list;for(var i=0;i<completions.length;++i){var elt=hints.appendChild(document.createElement("li")),cur=completions[i];
var className=HINT_ELEMENT_CLASS+(i!=this.selectedHint?"":" "+ACTIVE_HINT_ELEMENT_CLASS);if(cur.className!=null){className=cur.className+" "+className;
}elt.className=className;if(cur.render){cur.render(elt,data,cur);}else{elt.appendChild(document.createTextNode(cur.displayText||getText(cur)));
}elt.hintId=i;}var pos=cm.cursorCoords(completion.options.alignWithWord?data.from:null);var left=pos.left,top=pos.bottom,below=true;
hints.style.left=left+"px";hints.style.top=top+"px";var winW=window.innerWidth||Math.max(document.body.offsetWidth,document.documentElement.offsetWidth);
var winH=window.innerHeight||Math.max(document.body.offsetHeight,document.documentElement.offsetHeight);
(completion.options.container||document.body).appendChild(hints);var box=hints.getBoundingClientRect(),overlapY=box.bottom-winH;
var scrolls=hints.scrollHeight>hints.clientHeight+1;var startScroll=cm.getScrollInfo();if(overlapY>0){var height=box.bottom-box.top,curTop=pos.top-(pos.bottom-box.top);
if(curTop-height>0){hints.style.top=(top=pos.top-height)+"px";below=false;}else{if(height>winH){hints.style.height=(winH-5)+"px";
hints.style.top=(top=pos.bottom-box.top)+"px";var cursor=cm.getCursor();if(data.from.ch!=cursor.ch){pos=cm.cursorCoords(cursor);
hints.style.left=(left=pos.left)+"px";box=hints.getBoundingClientRect();}}}}var overlapX=box.right-winW;
if(overlapX>0){if(box.right-box.left>winW){hints.style.width=(winW-5)+"px";overlapX-=(box.right-box.left)-winW;
}hints.style.left=(left=pos.left-overlapX)+"px";}if(scrolls){for(var node=hints.firstChild;node;node=node.nextSibling){node.style.paddingRight=cm.display.nativeBarWidth+"px";
}}cm.addKeyMap(this.keyMap=buildKeyMap(completion,{moveFocus:function(n,avoidWrap){widget.changeActive(widget.selectedHint+n,avoidWrap);
},setFocus:function(n){widget.changeActive(n);},menuSize:function(){return widget.screenAmount();},length:completions.length,close:function(){completion.close();
},pick:function(){widget.pick();},data:data}));if(completion.options.closeOnUnfocus){var closingOnBlur;
cm.on("blur",this.onBlur=function(){closingOnBlur=setTimeout(function(){completion.close();},100);});
cm.on("focus",this.onFocus=function(){clearTimeout(closingOnBlur);});}cm.on("scroll",this.onScroll=function(){var curScroll=cm.getScrollInfo(),editor=cm.getWrapperElement().getBoundingClientRect();
var newTop=top+startScroll.top-curScroll.top;var point=newTop-(window.pageYOffset||(document.documentElement||document.body).scrollTop);
if(!below){point+=hints.offsetHeight;}if(point<=editor.top||point>=editor.bottom){return completion.close();
}hints.style.top=newTop+"px";hints.style.left=(left+startScroll.left-curScroll.left)+"px";});CodeMirror.on(hints,"dblclick",function(e){var t=getHintElement(hints,e.target||e.srcElement);
if(t&&t.hintId!=null){widget.changeActive(t.hintId);widget.pick();}});CodeMirror.on(hints,"click",function(e){var t=getHintElement(hints,e.target||e.srcElement);
if(t&&t.hintId!=null){widget.changeActive(t.hintId);if(completion.options.completeOnSingleClick){widget.pick();
}}});CodeMirror.on(hints,"mousedown",function(){setTimeout(function(){cm.focus();},20);});$(hints).StyledScrollbar({adaptContentToScrollbar:true});
$(hints).parent(".StyledScrollbar").on("mousedown",function(){return false;});if(completion.options.onScroll){$(hints).scroll(completion.options.onScroll);
}CodeMirror.signal(data,"select",completions[0],hints.firstChild);return true;}Widget.prototype={close:function(){if(this.completion.widget!=this){return;
}this.completion.widget=null;$(this.hints.parentNode).remove();this.completion.cm.removeKeyMap(this.keyMap);
var cm=this.completion.cm;if(this.completion.options.closeOnUnfocus){cm.off("blur",this.onBlur);cm.off("focus",this.onFocus);
}cm.off("scroll",this.onScroll);},disable:function(){this.completion.cm.removeKeyMap(this.keyMap);var widget=this;
this.keyMap={Enter:function(){widget.picked=true;}};this.completion.cm.addKeyMap(this.keyMap);},pick:function(){this.completion.pick(this.data,this.selectedHint);
},changeActive:function(i,avoidWrap){if(i>=this.data.list.length){i=avoidWrap?this.data.list.length-1:0;
}else{if(i<0){i=avoidWrap?0:this.data.list.length-1;}}if(this.selectedHint==i){return;}var node=this.hints.childNodes[this.selectedHint];
node.className=node.className.replace(" "+ACTIVE_HINT_ELEMENT_CLASS,"");node=this.hints.childNodes[this.selectedHint=i];
node.className+=" "+ACTIVE_HINT_ELEMENT_CLASS;if(node.offsetTop<this.hints.scrollTop){this.hints.scrollTop=node.offsetTop-3;
}else{if(node.offsetTop+node.offsetHeight>this.hints.scrollTop+this.hints.clientHeight){this.hints.scrollTop=node.offsetTop+node.offsetHeight-this.hints.clientHeight+3;
}}CodeMirror.signal(this.data,"select",this.data.list[this.selectedHint],node);},screenAmount:function(){return Math.floor(this.hints.clientHeight/this.hints.firstChild.offsetHeight)||1;
}};function applicableHelpers(cm,helpers){if(!cm.somethingSelected()){return helpers;}var result=[];for(var i=0;
i<helpers.length;i++){if(helpers[i].supportsSelection){result.push(helpers[i]);}}return result;}function fetchHints(hint,cm,options,callback){if(hint.async){hint(cm,callback,options);
}else{var result=hint(cm,options);if(result&&result.then){result.then(callback);}else{callback(result);
}}}function resolveAutoHints(cm,pos){var helpers=cm.getHelpers(pos,"hint"),words;if(helpers.length){var resolved=function(cm,callback,options){var app=applicableHelpers(cm,helpers);
function run(i){if(i==app.length){return callback(null);}fetchHints(app[i],cm,options,function(result){if(result&&result.list.length>0){callback(result);
}else{run(i+1);}});}run(0);};resolved.async=true;resolved.supportsSelection=true;return resolved;}else{if(words=cm.getHelper(cm.getCursor(),"hintWords")){return function(cm){return CodeMirror.hint.fromList(cm,{words:words});
};}else{if(CodeMirror.hint.anyword){return function(cm,options){return CodeMirror.hint.anyword(cm,options);
};}else{return function(){};}}}}CodeMirror.registerHelper("hint","auto",{resolve:resolveAutoHints});CodeMirror.registerHelper("hint","fromList",function(cm,options){var cur=cm.getCursor(),token=cm.getTokenAt(cur);
var to=CodeMirror.Pos(cur.line,token.end);if(token.string&&/\w/.test(token.string[token.string.length-1])){var term=token.string,from=CodeMirror.Pos(cur.line,token.start);
}else{var term="",from=to;}var found=[];for(var i=0;i<options.words.length;i++){var word=options.words[i];
if(word.slice(0,term.length)==term){found.push(word);}}if(found.length){return{list:found,from:from,to:to};
}});CodeMirror.commands.autocomplete=CodeMirror.showHint;var defaultOptions={hint:CodeMirror.hint.auto,completeSingle:true,alignWithWord:true,closeCharacters:/[\s()\[\]{};:>,]/,closeOnUnfocus:true,completeOnSingleClick:true,container:null,customKeys:null,extraKeys:null,onScroll:null};
CodeMirror.defineOption("hintOptions",null);});(function(window,$,undefined){var defaultOpts={beforeShow:noop,move:noop,change:noop,show:noop,hide:noop,cancel:noop,color:false,flat:false,showInput:false,showButtons:true,clickoutFiresChange:false,dragstopFiresChanges:false,showInitial:false,showPalette:false,showPaletteOnly:false,showMoreColorsButton:false,showSelectionPalette:true,localStorageKey:false,appendTo:"body",maxSelectionSize:7,cancelText:"cancel",chooseText:"choose",preferredFormat:false,className:"",showAlpha:false,theme:"sp-light",palette:["fff","000"],selectionPalette:[],disabled:false},spectrums=[],IE=!!/msie/i.exec(window.navigator.userAgent),rgbaSupport=(function(){function contains(str,substr){return !!~(""+str).indexOf(substr);
}var elem=document.createElement("div");var style=elem.style;style.cssText="background-color:rgba(0,0,0,.5)";
return contains(style.backgroundColor,"rgba")||contains(style.backgroundColor,"hsla");})(),replaceInput=["<div class='sp-replacer'>","<div class='sp-preview'><div class='sp-preview-inner'><img class='sp-preview-inner-image' /></div></div>","<div class='sp-dd'>&#9660;</div>","</div>"].join(""),markup=(function(){var gradientFix="";
if(IE){for(var i=1;i<=6;i++){gradientFix+="<div class='sp-"+i+"'></div>";}}return["<div class='sp-container sp-hidden'>","<div class='sp-palette-container'>","<div class='sp-palette sp-thumb sp-cf' id='sp-palette'></div>","<div class='sp-more-colors-container' >","<span class='sp-more-colors' />","<span class='sp-less-colors' />","<span class='sp-palette sp-thumb sp-cf' id='sp-selection-palette' />","</div>","</div>","<div class='sp-picker-container'>","<div class='sp-top sp-cf'>","<div class='sp-fill'></div>","<div class='sp-top-inner'>","<div class='sp-color'>","<div class='sp-sat'>","<div class='sp-val'>","<div class='sp-dragger'></div>","</div>","</div>","</div>","<div class='sp-hue'>","<div class='sp-slider'></div>",gradientFix,"</div>","</div>","<div class='sp-alpha'><div class='sp-alpha-inner'><div class='sp-alpha-handle'></div></div></div>","</div>","<div class='sp-input-container sp-cf'>","<span>#</span><input class='sp-input' type='text' spellcheck='false'  />&nbsp;","</div>","<div class='sp-initial sp-thumb sp-cf'></div>","<div class='sp-button-container sp-cf'>","<button class='sp-cancel'></button>","<button class='sp-choose'></button>","</div>","</div>","</div>"].join("");
})();function paletteTemplate(p,color,className){var html=[];for(var i=0;i<p.length;i++){var tiny=tinycolor(p[i]);
var c=tiny.toHsl().l<0.5?"sp-thumb-el sp-thumb-dark":"sp-thumb-el sp-thumb-light";c+=(tinycolor.equals(color,p[i]))?" sp-thumb-active":"";
c+=" "+tiny.id;var swatchStyle="";var innerImage="";if(tiny.image.length>0){innerImage='<img src="'+tiny.image+'" class="sp-inner-image"/>';
}else{swatchStyle=(rgbaSupport?("background-color:"+tiny.toRgbString()):"filter:"+tiny.toFilter())+";";
}var innerTextHtml="";if(tiny.text!==undefined&&tiny.text.length>0){innerTextHtml='<span class="sp-text-inner">'+tiny.text+"</span>";
}html.push('<span data-color="'+tiny.toRgbString()+"|"+tiny.id+'" class="'+c+'">'+innerTextHtml+'<span class="sp-thumb-inner" style="'+swatchStyle+'">'+innerImage+"</span></span>");
}return"<div class='sp-cf "+className+"'>"+html.join("")+"</div>";}function hideAll(){for(var i=0;i<spectrums.length;
i++){if(spectrums[i]){spectrums[i].hide();}}}function instanceOptions(o,callbackContext){var opts=$.extend({},defaultOpts,o);
opts.callbacks={move:bind(opts.move,callbackContext),change:bind(opts.change,callbackContext),show:bind(opts.show,callbackContext),hide:bind(opts.hide,callbackContext),beforeShow:bind(opts.beforeShow,callbackContext),cancel:bind(opts.cancel,callbackContext)};
return opts;}function spectrum(element,o){var opts=instanceOptions(o,element),flat=opts.flat,showSelectionPalette=opts.showSelectionPalette,localStorageKey=opts.localStorageKey,theme=opts.theme,callbacks=opts.callbacks,resize=throttle(reflow,10),visible=false,dragWidth=0,dragHeight=0,dragHelperHeight=0,slideHeight=0,slideWidth=0,alphaWidth=0,alphaSlideHelperWidth=0,slideHelperHeight=0,currentHue=0,currentSaturation=0,currentValue=0,currentAlpha=1,currentId="",currentImage="",currentText="",palette=opts.palette.slice(0),paletteArray=$.isArray(palette[0])?palette:[palette],selectionPalette=opts.selectionPalette.slice(0),maxSelectionSize=opts.maxSelectionSize,draggingClass="sp-dragging",shiftMovementDirection=null;
var doc=element.ownerDocument,body=doc.body,boundElement=$(element),disabled=false,container=$(markup,doc).addClass(theme),dragger=container.find(".sp-color"),dragHelper=container.find(".sp-dragger"),slider=container.find(".sp-hue"),slideHelper=container.find(".sp-slider"),alphaSliderInner=container.find(".sp-alpha-inner"),alphaSlider=container.find(".sp-alpha"),alphaSlideHelper=container.find(".sp-alpha-handle"),textInput=container.find(".sp-input"),moreColors=container.find(".sp-more-colors"),lessColors=container.find(".sp-less-colors"),paletteContainer=container.find("#sp-palette"),selectionPaletteContainer=container.find("#sp-selection-palette"),initialColorContainer=container.find(".sp-initial"),cancelButton=container.find(".sp-cancel"),chooseButton=container.find(".sp-choose"),isInput=boundElement.is("input"),shouldReplace=isInput&&!flat,replacer=(shouldReplace)?$(replaceInput).addClass(theme).addClass(opts.className):$([]),offsetElement=(shouldReplace)?replacer:boundElement,previewElement=replacer.find(".sp-preview-inner"),previewImageElement=replacer.find(".sp-preview-inner-image"),initialColor=opts.color||(isInput&&boundElement.val()),colorOnShow=false,preferredFormat=opts.preferredFormat,currentPreferredFormat=preferredFormat,clickoutFiresChange=!opts.showButtons||opts.clickoutFiresChange,dragstopFiresChanges=opts.dragstopFiresChanges;
function applyOptions(){container.toggleClass("sp-flat",flat);container.toggleClass("sp-input-disabled",!opts.showInput);
container.toggleClass("sp-alpha-enabled",opts.showAlpha);container.toggleClass("sp-buttons-disabled",!opts.showButtons);
container.toggleClass("sp-palette-disabled",!opts.showPalette);container.toggleClass("sp-palette-only",opts.showPaletteOnly);
container.toggleClass("sp-show-more-colors",opts.showMoreColorsButton);container.toggleClass("sp-more-colors-hidden",opts.showPalette);
container.toggleClass("sp-initial-disabled",!opts.showInitial);container.addClass(opts.className);reflow();
}function initialize(){if(IE){container.find("*:not(input)").attr("unselectable","on");}applyOptions();
if(shouldReplace){boundElement.after(replacer).hide();}if(flat){boundElement.after(container).hide();
}else{var appendTo=opts.appendTo==="parent"?boundElement.parent():$(opts.appendTo);if(appendTo.length!==1){appendTo=$("body");
}appendTo.append(container);}if(localStorageKey&&window.localStorage){try{var oldPalette=window.localStorage[localStorageKey].split(",#");
if(oldPalette.length>1){delete window.localStorage[localStorageKey];$.each(oldPalette,function(i,c){addColorToSelectionPalette(c);
});}}catch(e){}try{selectionPalette=window.localStorage[localStorageKey].split(";");}catch(e){}}offsetElement.bind("click.spectrum touchstart.spectrum",function(e){if(!disabled){toggle();
}e.stopPropagation();if(!$(e.target).is("input")){e.preventDefault();}});if(boundElement.is(":disabled")||(opts.disabled===true)){disable();
}container.click(stopPropagation);textInput.change(setFromTextInput);textInput.bind("paste",function(){setTimeout(setFromTextInput,1);
});textInput.keydown(function(e){if(e.keyCode==13){setFromTextInput();}});moreColors.bind("click.spectrum",function(e){e.stopPropagation();
e.preventDefault();if(isValid()){container.removeClass("sp-more-colors-hidden");reflow();container.change();
}});lessColors.bind("click.spectrum",function(e){e.stopPropagation();e.preventDefault();if(isValid()){container.addClass("sp-more-colors-hidden");
container.change();}});cancelButton.text(opts.cancelText);cancelButton.bind("click.spectrum",function(e){e.stopPropagation();
e.preventDefault();callbacks.cancel();hide("cancel");});chooseButton.text(opts.chooseText);chooseButton.bind("click.spectrum",function(e){e.stopPropagation();
e.preventDefault();if(isValid()){updateOriginalInput(true,false);hide();}});draggable(alphaSlider,function(dragX,dragY,e){currentAlpha=(dragX/alphaWidth);
if(e.shiftKey){currentAlpha=Math.round(currentAlpha*10)/10;}move();});draggable(slider,function(dragX,dragY){currentHue=parseFloat(dragY/slideHeight);
move();},dragStart,dragStop);draggable(dragger,function(dragX,dragY,e){if(!e.shiftKey){shiftMovementDirection=null;
}else{if(!shiftMovementDirection){var oldDragX=currentSaturation*dragWidth;var oldDragY=dragHeight-(currentValue*dragHeight);
var furtherFromX=Math.abs(dragX-oldDragX)>Math.abs(dragY-oldDragY);shiftMovementDirection=furtherFromX?"x":"y";
}}var setSaturation=!shiftMovementDirection||shiftMovementDirection==="x";var setValue=!shiftMovementDirection||shiftMovementDirection==="y";
if(setSaturation){currentSaturation=parseFloat(dragX/dragWidth);}if(setValue){currentValue=parseFloat((dragHeight-dragY)/dragHeight);
}move();},dragStart,dragStop);if(!!initialColor){set(initialColor);updateUI();currentPreferredFormat=preferredFormat||tinycolor(initialColor).format;
addColorToSelectionPalette(initialColor);}else{updateUI();}if(flat){show();}function palletElementClick(ex){if(ex.data&&ex.data.ignore){set($(this).data("color"));
move();}else{set($(this).data("color"));updateOriginalInput(true,false);move();hide();}return false;}var paletteEvent=IE?"mousedown.spectrum":"click.spectrum";
paletteContainer.on(paletteEvent,".sp-thumb-el",palletElementClick);selectionPaletteContainer.on(paletteEvent,".sp-thumb-el",palletElementClick);
initialColorContainer.on(paletteEvent,".sp-thumb-el:nth-child(1)",{ignore:true},palletElementClick);}function addColorToSelectionPalette(color){if(showSelectionPalette){var colorRgb=tinycolor(color).toRgbString();
if($.inArray(colorRgb,selectionPalette)===-1){selectionPalette.push(colorRgb);while(selectionPalette.length>maxSelectionSize){selectionPalette.shift();
}}if(localStorageKey&&window.localStorage){try{window.localStorage[localStorageKey]=selectionPalette.join(";");
}catch(e){}}}}function getUniqueSelectionPalette(){var unique=[];var p=selectionPalette;var paletteLookup={};
var rgb;if(opts.showPalette){for(var i=0;i<paletteArray.length;i++){for(var j=0;j<paletteArray[i].length;
j++){rgb=tinycolor(paletteArray[i][j]).toRgbString();paletteLookup[rgb]=true;}}for(i=0;i<p.length;i++){rgb=tinycolor(p[i]).toRgbString();
if(!paletteLookup.hasOwnProperty(rgb)){unique.push(p[i]);paletteLookup[rgb]=true;}}}return unique.reverse().slice(0,opts.maxSelectionSize);
}function drawPalette(){var currentColor=get();var html=$.map(paletteArray,function(palette,i){return paletteTemplate(palette,currentColor,"sp-palette-row sp-palette-row-"+i);
});if(selectionPalette){}paletteContainer.html(html.join(""));if(selectionPalette){html=$.map(getUniqueSelectionPalette(),function(palette,i){return paletteTemplate(selectionPalette,currentColor,"sp-palette-row sp-palette-row-"+i);
});selectionPaletteContainer.html(html.join(""));}}function drawInitial(){if(opts.showInitial){var initial=colorOnShow;
var current=get();initialColorContainer.html(paletteTemplate([initial,current],current,"sp-palette-row-initial"));
}}function dragStart(){if(dragHeight<=0||dragWidth<=0||slideHeight<=0){reflow();}container.addClass(draggingClass);
shiftMovementDirection=null;}function dragStop(){container.removeClass(draggingClass);if(dragstopFiresChanges){updateOriginalInput(true,true);
updateUI();}}function setFromTextInput(){var tiny=tinycolor(textInput.val());if(tiny.ok){set(tiny);updateOriginalInput(true,true);
updateUI();}else{textInput.addClass("sp-validation-error");}}function toggle(){if(visible){hide();}else{show();
}}function show(){var event=$.Event("beforeShow.spectrum");if(visible){reflow();return;}boundElement.trigger(event,[get()]);
if(callbacks.beforeShow(get())===false||event.isDefaultPrevented()){return;}hideAll();visible=true;$(doc).bind("click.spectrum",hide);
$(doc).bind("mousedown.spectrum",hideIfClickedOutsideThis);$(window).bind("resize.spectrum",resize);replacer.addClass("sp-active");
container.removeClass("sp-hidden");if(opts.showPalette){drawPalette();}reflow();updateUI();colorOnShow=get();
drawInitial();callbacks.show(colorOnShow);boundElement.trigger("show.spectrum",[colorOnShow]);}function hideIfClickedOutsideThis(e){if(e&&e.type=="click"&&e.button==2){return;
}if(!visible||flat){return;}var $parent=$(e.target);while(true){if($parent.length==0){break;}else{if($parent.is(container)){return;
}}$parent=$parent.parent();}visible=false;$(doc).unbind("mousedown.spectrum",hideIfClickedOutsideThis);
replacer.removeClass("sp-active");container.addClass("sp-hidden");}function hide(e){if(e&&e.type=="click"&&e.button==2){return;
}if(!visible||flat){return;}visible=false;$(doc).unbind("click.spectrum",hide);$(window).unbind("resize.spectrum",resize);
replacer.removeClass("sp-active");container.addClass("sp-hidden");var colorHasChanged=!tinycolor.equals(get(),colorOnShow);
if(colorHasChanged){if(clickoutFiresChange&&e!=="cancel"){updateOriginalInput(true,false);}else{revert();
}}callbacks.hide(get());boundElement.trigger("hide.spectrum",[get()]);}function revert(){set(colorOnShow,true);
}function set(color,ignoreFormatChange){if(tinycolor.equals(color,get())){return;}var newColor=tinycolor(color);
var newHsv=newColor.toHsv();currentHue=(newHsv.h%360)/360;currentSaturation=newHsv.s;currentValue=newHsv.v;
currentAlpha=newHsv.a;currentId=newColor.id;currentImage=newColor.image;currentText=newColor.text;updateUI();
if(newColor.ok&&!ignoreFormatChange){currentPreferredFormat=preferredFormat||newColor.format;}}function get(opts){opts=opts||{};
return tinycolor.fromRatio({h:currentHue,s:currentSaturation,v:currentValue,a:Math.round(currentAlpha*100)/100},{format:currentPreferredFormat,id:currentId,image:currentImage,text:currentText});
}function isValid(){return !textInput.hasClass("sp-validation-error");}function move(){updateUI();callbacks.move(get());
boundElement.trigger("move.spectrum",[get()]);}function updateUI(){textInput.removeClass("sp-validation-error");
updateHelperLocations();var flatColor=tinycolor.fromRatio({h:currentHue,s:1,v:1});dragger.css("background-color",flatColor.toHexString());
var format=currentPreferredFormat;if(currentAlpha<1){if(format==="hex"||format==="hex3"||format==="hex6"||format==="name"){format="rgb";
}}var realColor=get({format:format}),realHex=realColor.toHexString(),realRgb=realColor.toRgbString();
if(rgbaSupport||realColor.alpha===1){previewElement.css("background-color",realRgb);}else{previewElement.css("background-color","transparent");
previewElement.css("filter",realColor.toFilter());}if(realColor.image.length>0){previewImageElement.attr("src",realColor.image);
previewImageElement.css("display","block");}else{previewImageElement.css("display","none");}if(opts.showAlpha){var rgb=realColor.toRgb();
rgb.a=0;var realAlpha=tinycolor(rgb).toRgbString();var gradient="linear-gradient(left, "+realAlpha+", "+realHex+")";
if(IE){alphaSliderInner.css("filter",tinycolor(realAlpha).toFilter({gradientType:1},realHex));}else{alphaSliderInner.css("background","-webkit-"+gradient);
alphaSliderInner.css("background","-moz-"+gradient);alphaSliderInner.css("background","-ms-"+gradient);
alphaSliderInner.css("background",gradient);}}if(opts.showInput){textInput.val(realColor.toString("hex6").substring(1,7));
}if(opts.showPalette){drawPalette();}drawInitial();}function updateHelperLocations(){var s=currentSaturation;
var v=currentValue;var dragX=s*dragWidth;var dragY=dragHeight-(v*dragHeight);dragX=Math.max(-dragHelperHeight,Math.min(dragWidth-dragHelperHeight,dragX-dragHelperHeight));
dragY=Math.max(-dragHelperHeight,Math.min(dragHeight-dragHelperHeight,dragY-dragHelperHeight));dragHelper.css({top:dragY,left:dragX});
var alphaX=currentAlpha*alphaWidth;alphaSlideHelper.css({left:alphaX-(alphaSlideHelperWidth/2)});var slideY=(currentHue)*slideHeight;
slideHelper.css({top:slideY-slideHelperHeight});}function updateOriginalInput(fireCallback,stayopen){var color=get();
if(isInput){boundElement.val(color.toString(currentPreferredFormat)).change();}var hasChanged=!tinycolor.equals(color,colorOnShow);
colorOnShow=color;addColorToSelectionPalette(color);if(fireCallback&&hasChanged){callbacks.change(color,!stayopen);
boundElement.trigger("change.spectrum",[color]);}}function reflow(){dragWidth=dragger.width();dragHeight=dragger.height();
dragHelperHeight=dragHelper.height();slideWidth=slider.width();slideHeight=slider.height();slideHelperHeight=slideHelper.height();
alphaWidth=alphaSlider.width();alphaSlideHelperWidth=alphaSlideHelper.width();if(!flat){container.css("position","absolute");
container.offset(getOffset(container,offsetElement));}updateHelperLocations();}function destroy(){boundElement.show();
offsetElement.unbind("click.spectrum touchstart.spectrum");container.remove();replacer.remove();spectrums[spect.id]=null;
}function option(optionName,optionValue){if(optionName===undefined){return $.extend({},opts);}if(optionValue===undefined){return opts[optionName];
}opts[optionName]=optionValue;applyOptions();}function enable(){disabled=false;boundElement.attr("disabled",false);
offsetElement.removeClass("sp-disabled");}function disable(){hide();disabled=true;boundElement.attr("disabled",true);
offsetElement.addClass("sp-disabled");}function getColorById(id){for(var row=0;row<palette.length;row++){for(var col=0;
col<palette[row].length;col++){color=tinycolor(palette[row][col]);if(color.id==id){return color;}}}}initialize();
var spect={show:show,hide:hide,toggle:toggle,reflow:reflow,option:option,enable:enable,disable:disable,setById:function(id){set(getColorById(id));
},set:function(c){set(c);updateOriginalInput();},get:get,destroy:destroy,container:container};spect.id=spectrums.push(spect)-1;
return spect;}function getOffset(picker,input){var extraY=0;var dpWidth=picker.outerWidth();var dpHeight=picker.outerHeight();
var inputHeight=input.outerHeight();var doc=picker[0].ownerDocument;var docElem=doc.documentElement;var viewWidth=docElem.clientWidth+$(doc).scrollLeft();
var viewHeight=docElem.clientHeight+$(doc).scrollTop();var offset=input.offset();offset.top+=inputHeight;
offset.left-=Math.min(offset.left,(offset.left+dpWidth>viewWidth&&viewWidth>dpWidth)?Math.abs(offset.left+dpWidth-viewWidth):0);
offset.top-=Math.min(offset.top,((offset.top+dpHeight>viewHeight&&viewHeight>dpHeight)?Math.abs(dpHeight+inputHeight-extraY):extraY));
return offset;}function noop(){}function stopPropagation(e){e.stopPropagation();}function bind(func,obj){var slice=Array.prototype.slice;
var args=slice.call(arguments,2);return function(){return func.apply(obj,args.concat(slice.call(arguments)));
};}function draggable(element,onmove,onstart,onstop){onmove=onmove||function(){};onstart=onstart||function(){};
onstop=onstop||function(){};var doc=element.ownerDocument||document;var dragging=false;var offset={};
var maxHeight=0;var maxWidth=0;var hasTouch=("ontouchstart" in window);var duringDragEvents={};duringDragEvents.selectstart=prevent;
duringDragEvents.dragstart=prevent;duringDragEvents["touchmove mousemove"]=move;duringDragEvents["touchend mouseup"]=stop;
function prevent(e){if(e.stopPropagation){e.stopPropagation();}if(e.preventDefault){e.preventDefault();
}e.returnValue=false;}function move(e){if(dragging){if(IE&&document.documentMode<9&&!e.button){return stop();
}var touches=e.originalEvent.touches;var pageX=touches?touches[0].pageX:e.pageX;var pageY=touches?touches[0].pageY:e.pageY;
var dragX=Math.max(0,Math.min(pageX-offset.left,maxWidth));var dragY=Math.max(0,Math.min(pageY-offset.top,maxHeight));
if(hasTouch){prevent(e);}onmove.apply(element,[dragX,dragY,e]);}}function start(e){var rightclick=(e.which)?(e.which==3):(e.button==2);
var touches=e.originalEvent.touches;if(!rightclick&&!dragging){if(onstart.apply(element,arguments)!==false){dragging=true;
maxHeight=$(element).height();maxWidth=$(element).width();offset=$(element).offset();$(doc).bind(duringDragEvents);
$(doc.body).addClass("sp-dragging");if(!hasTouch){move(e);}prevent(e);}}}function stop(){if(dragging){$(doc).unbind(duringDragEvents);
$(doc.body).removeClass("sp-dragging");onstop.apply(element,arguments);}dragging=false;}$(element).bind("touchstart mousedown",start);
}function throttle(func,wait,debounce){var timeout;return function(){var context=this,args=arguments;
var throttler=function(){timeout=null;func.apply(context,args);};if(debounce){clearTimeout(timeout);}if(debounce||!timeout){timeout=setTimeout(throttler,wait);
}};}function log(){if(window.console){if(Function.prototype.bind){log=Function.prototype.bind.call(console.log,console);
}else{log=function(){Function.prototype.apply.call(console.log,console,arguments);};}log.apply(this,arguments);
}}var dataID="spectrum.id";$.fn.spectrum=function(opts,extra){if(typeof opts=="string"){var returnValue=this;
var args=Array.prototype.slice.call(arguments,1);this.each(function(){var spect=spectrums[$(this).data(dataID)];
if(spect){var method=spect[opts];if(!method){throw new Error("Spectrum: no such method: '"+opts+"'");
}if(opts=="get"){returnValue=spect.get();}else{if(opts=="container"){returnValue=spect.container;}else{if(opts=="option"){returnValue=spect.option.apply(spect,args);
}else{if(opts=="destroy"){spect.destroy();$(this).removeData(dataID);}else{method.apply(spect,args);}}}}}});
return returnValue;}return this.spectrum("destroy").each(function(){var spect=spectrum(this,opts);$(this).data(dataID,spect.id);
});};$.fn.spectrum.load=false;$.fn.spectrum.loadOpts={};$.fn.spectrum.draggable=draggable;$.fn.spectrum.defaults=defaultOpts;
$.spectrum={};$.spectrum.localization={};$.spectrum.palettes={};$.fn.spectrum.processNativeColorInputs=function(){var colorInput=$("<input type='color' value='!' />")[0];
var supportsColor=colorInput.type==="color"&&colorInput.value!="!";if(!supportsColor){$("input[type=color]").spectrum({preferredFormat:"hex6"});
}};(function(root){var trimLeft=/^[\s,#]+/,trimRight=/\s+$/,tinyCounter=0,math=Math,mathRound=math.round,mathMin=math.min,mathMax=math.max,mathRandom=math.random;
function tinycolor(color,opts){color=(color)?color:"";opts=opts||{};if(typeof color=="object"&&color.hasOwnProperty("_tc_id")){return color;
}var rgb=inputToRGB(color);var r=rgb.r,g=rgb.g,b=rgb.b,a=rgb.a,roundA=mathRound(100*a)/100,format=opts.format||rgb.format,id=opts.id||rgb.id,image=opts.image||rgb.image,text=opts.text||rgb.text;
if(r<1){r=mathRound(r);}if(g<1){g=mathRound(g);}if(b<1){b=mathRound(b);}if(r==255&&g==0&&b==255){r=254;
b=254;}return{ok:rgb.ok,format:format,id:id,image:image,text:text,_tc_id:tinyCounter++,alpha:a,toHsv:function(){var hsv=rgbToHsv(r,g,b);
return{h:hsv.h*360,s:hsv.s,v:hsv.v,a:a};},toHsvString:function(){var hsv=rgbToHsv(r,g,b);var h=mathRound(hsv.h*360),s=mathRound(hsv.s*100),v=mathRound(hsv.v*100);
return(a==1)?"hsv("+h+", "+s+"%, "+v+"%)":"hsva("+h+", "+s+"%, "+v+"%, "+roundA+")";},toHsl:function(){var hsl=rgbToHsl(r,g,b);
return{h:hsl.h*360,s:hsl.s,l:hsl.l,a:a};},toHslString:function(){var hsl=rgbToHsl(r,g,b);var h=mathRound(hsl.h*360),s=mathRound(hsl.s*100),l=mathRound(hsl.l*100);
return(a==1)?"hsl("+h+", "+s+"%, "+l+"%)":"hsla("+h+", "+s+"%, "+l+"%, "+roundA+")";},toHex:function(allow3Char){return rgbToHex(r,g,b,allow3Char);
},toHexString:function(allow3Char){return"#"+rgbToHex(r,g,b,allow3Char);},toRgb:function(){return{r:mathRound(r),g:mathRound(g),b:mathRound(b),a:a,id:id,image:image,text:text};
},toRgbString:function(){return(a==1)?"rgb("+mathRound(r)+", "+mathRound(g)+", "+mathRound(b)+")":"rgba("+mathRound(r)+", "+mathRound(g)+", "+mathRound(b)+", "+roundA+")";
},toPercentageRgb:function(){return{r:mathRound(bound01(r,255)*100)+"%",g:mathRound(bound01(g,255)*100)+"%",b:mathRound(bound01(b,255)*100)+"%",a:a,id:id,image:image,text:text};
},toPercentageRgbString:function(){return(a==1)?"rgb("+mathRound(bound01(r,255)*100)+"%, "+mathRound(bound01(g,255)*100)+"%, "+mathRound(bound01(b,255)*100)+"%)":"rgba("+mathRound(bound01(r,255)*100)+"%, "+mathRound(bound01(g,255)*100)+"%, "+mathRound(bound01(b,255)*100)+"%, "+roundA+")";
},toName:function(){return hexNames[rgbToHex(r,g,b,true)]||false;},toFilter:function(secondColor){var hex=rgbToHex(r,g,b);
var secondHex=hex;var alphaHex=Math.round(parseFloat(a)*255).toString(16);var secondAlphaHex=alphaHex;
var gradientType=opts&&opts.gradientType?"GradientType = 1, ":"";if(secondColor){var s=tinycolor(secondColor);
secondHex=s.toHex();secondAlphaHex=Math.round(parseFloat(s.alpha)*255).toString(16);}return"progid:DXImageTransform.Microsoft.gradient("+gradientType+"startColorstr=#"+pad2(alphaHex)+hex+",endColorstr=#"+pad2(secondAlphaHex)+secondHex+")";
},toString:function(format){format=format||this.format;var formattedString=false;if(format==="rgb"){formattedString=this.toRgbString();
}if(format==="prgb"){formattedString=this.toPercentageRgbString();}if(format==="hex"||format==="hex6"){formattedString=this.toHexString();
}if(format==="hex3"){formattedString=this.toHexString(true);}if(format==="name"){formattedString=this.toName();
}if(format==="hsl"){formattedString=this.toHslString();}if(format==="hsv"){formattedString=this.toHsvString();
}return formattedString||this.toHexString();}};}tinycolor.fromRatio=function(color,opts){if(typeof color=="object"){var newColor={};
for(var i in color){if(color.hasOwnProperty(i)){if(i==="a"){newColor[i]=color[i];}else{newColor[i]=convertToPercentage(color[i]);
}}}color=newColor;}return tinycolor(color,opts);};function inputToRGB(color){var rgb={r:0,g:0,b:0};var a=1;
var ok=false;var format=false;var id="";var image="";var text="";if(typeof color=="string"){color=stringInputToObject(color);
id=color.id;image=color.image;text=color.text;}if(typeof color=="object"){if(color.hasOwnProperty("r")&&color.hasOwnProperty("g")&&color.hasOwnProperty("b")){rgb=rgbToRgb(color.r,color.g,color.b);
ok=true;format=String(color.r).substr(-1)==="%"?"prgb":"rgb";}else{if(color.hasOwnProperty("h")&&color.hasOwnProperty("s")&&color.hasOwnProperty("v")){color.s=convertToPercentage(color.s);
color.v=convertToPercentage(color.v);rgb=hsvToRgb(color.h,color.s,color.v);ok=true;format="hsv";}else{if(color.hasOwnProperty("h")&&color.hasOwnProperty("s")&&color.hasOwnProperty("l")){color.s=convertToPercentage(color.s);
color.l=convertToPercentage(color.l);rgb=hslToRgb(color.h,color.s,color.l);ok=true;format="hsl";}}}if(color.hasOwnProperty("a")){a=color.a;
}}a=parseFloat(a);if(isNaN(a)||a<0||a>1){a=1;}return{ok:ok,format:color.format||format,r:mathMin(255,mathMax(rgb.r,0)),g:mathMin(255,mathMax(rgb.g,0)),b:mathMin(255,mathMax(rgb.b,0)),a:a,id:id,image:image,text:text};
}function rgbToRgb(r,g,b){return{r:bound01(r,255)*255,g:bound01(g,255)*255,b:bound01(b,255)*255};}function rgbToHsl(r,g,b){r=bound01(r,255);
g=bound01(g,255);b=bound01(b,255);var max=mathMax(r,g,b),min=mathMin(r,g,b);var h,s,l=(max+min)/2;if(max==min){h=s=0;
}else{var d=max-min;s=l>0.5?d/(2-max-min):d/(max+min);switch(max){case r:h=(g-b)/d+(g<b?6:0);break;case g:h=(b-r)/d+2;
break;case b:h=(r-g)/d+4;break;}h/=6;}return{h:h,s:s,l:l};}function hslToRgb(h,s,l){var r,g,b;h=bound01(h,360);
s=bound01(s,100);l=bound01(l,100);function hue2rgb(p,q,t){if(t<0){t+=1;}if(t>1){t-=1;}if(t<1/6){return p+(q-p)*6*t;
}if(t<1/2){return q;}if(t<2/3){return p+(q-p)*(2/3-t)*6;}return p;}if(s===0){r=g=b=l;}else{var q=l<0.5?l*(1+s):l+s-l*s;
var p=2*l-q;r=hue2rgb(p,q,h+1/3);g=hue2rgb(p,q,h);b=hue2rgb(p,q,h-1/3);}return{r:r*255,g:g*255,b:b*255};
}function rgbToHsv(r,g,b){r=bound01(r,255);g=bound01(g,255);b=bound01(b,255);var max=mathMax(r,g,b),min=mathMin(r,g,b);
var h,s,v=max;var d=max-min;s=max===0?0:d/max;if(max==min){h=0;}else{switch(max){case r:h=(g-b)/d+(g<b?6:0);
break;case g:h=(b-r)/d+2;break;case b:h=(r-g)/d+4;break;}h/=6;}return{h:h,s:s,v:v};}function hsvToRgb(h,s,v){h=bound01(h,360)*6;
s=bound01(s,100);v=bound01(v,100);var i=math.floor(h),f=h-i,p=v*(1-s),q=v*(1-f*s),t=v*(1-(1-f)*s),mod=i%6,r=[v,q,p,p,t,v][mod],g=[t,v,v,q,p,p][mod],b=[p,p,t,v,v,q][mod];
return{r:r*255,g:g*255,b:b*255};}function rgbToHex(r,g,b,allow3Char){var hex=[pad2(mathRound(r).toString(16)),pad2(mathRound(g).toString(16)),pad2(mathRound(b).toString(16))];
if(allow3Char&&hex[0].charAt(0)==hex[0].charAt(1)&&hex[1].charAt(0)==hex[1].charAt(1)&&hex[2].charAt(0)==hex[2].charAt(1)){return hex[0].charAt(0)+hex[1].charAt(0)+hex[2].charAt(0);
}return hex.join("");}tinycolor.equals=function(color1,color2){if(!color1||!color2){return false;}var tc1=tinycolor(color1);
var tc2=tinycolor(color2);return tc1.toRgbString()==tc2.toRgbString()&&tc1.id==tc2.id&&tc1.image==tc2.image;
};tinycolor.random=function(){return tinycolor.fromRatio({r:mathRandom(),g:mathRandom(),b:mathRandom()});
};tinycolor.desaturate=function(color,amount){var hsl=tinycolor(color).toHsl();hsl.s-=((amount||10)/100);
hsl.s=clamp01(hsl.s);return tinycolor(hsl);};tinycolor.saturate=function(color,amount){var hsl=tinycolor(color).toHsl();
hsl.s+=((amount||10)/100);hsl.s=clamp01(hsl.s);return tinycolor(hsl);};tinycolor.greyscale=function(color){return tinycolor.desaturate(color,100);
};tinycolor.lighten=function(color,amount){var hsl=tinycolor(color).toHsl();hsl.l+=((amount||10)/100);
hsl.l=clamp01(hsl.l);return tinycolor(hsl);};tinycolor.darken=function(color,amount){var hsl=tinycolor(color).toHsl();
hsl.l-=((amount||10)/100);hsl.l=clamp01(hsl.l);return tinycolor(hsl);};tinycolor.complement=function(color){var hsl=tinycolor(color).toHsl();
hsl.h=(hsl.h+180)%360;return tinycolor(hsl);};tinycolor.triad=function(color){var hsl=tinycolor(color).toHsl();
var h=hsl.h;return[tinycolor(color),tinycolor({h:(h+120)%360,s:hsl.s,l:hsl.l}),tinycolor({h:(h+240)%360,s:hsl.s,l:hsl.l})];
};tinycolor.tetrad=function(color){var hsl=tinycolor(color).toHsl();var h=hsl.h;return[tinycolor(color),tinycolor({h:(h+90)%360,s:hsl.s,l:hsl.l}),tinycolor({h:(h+180)%360,s:hsl.s,l:hsl.l}),tinycolor({h:(h+270)%360,s:hsl.s,l:hsl.l})];
};tinycolor.splitcomplement=function(color){var hsl=tinycolor(color).toHsl();var h=hsl.h;return[tinycolor(color),tinycolor({h:(h+72)%360,s:hsl.s,l:hsl.l}),tinycolor({h:(h+216)%360,s:hsl.s,l:hsl.l})];
};tinycolor.analogous=function(color,results,slices){results=results||6;slices=slices||30;var hsl=tinycolor(color).toHsl();
var part=360/slices;var ret=[tinycolor(color)];for(hsl.h=((hsl.h-(part*results>>1))+720)%360;--results;
){hsl.h=(hsl.h+part)%360;ret.push(tinycolor(hsl));}return ret;};tinycolor.monochromatic=function(color,results){results=results||6;
var hsv=tinycolor(color).toHsv();var h=hsv.h,s=hsv.s,v=hsv.v;var ret=[];var modification=1/results;while(results--){ret.push(tinycolor({h:h,s:s,v:v}));
v=(v+modification)%1;}return ret;};tinycolor.readability=function(color1,color2){var a=tinycolor(color1).toRgb();
var b=tinycolor(color2).toRgb();var brightnessA=(a.r*299+a.g*587+a.b*114)/1000;var brightnessB=(b.r*299+b.g*587+b.b*114)/1000;
var colorDiff=(Math.max(a.r,b.r)-Math.min(a.r,b.r)+Math.max(a.g,b.g)-Math.min(a.g,b.g)+Math.max(a.b,b.b)-Math.min(a.b,b.b));
return{brightness:Math.abs(brightnessA-brightnessB),color:colorDiff};};tinycolor.readable=function(color1,color2){var readability=tinycolor.readability(color1,color2);
return readability.brightness>125&&readability.color>500;};tinycolor.mostReadable=function(baseColor,colorList){var bestColor=null;
var bestScore=0;var bestIsReadable=false;for(var i=0;i<colorList.length;i++){var readability=tinycolor.readability(baseColor,colorList[i]);
var readable=readability.brightness>125&&readability.color>500;var score=3*(readability.brightness/125)+(readability.color/500);
if((readable&&!bestIsReadable)||(readable&&bestIsReadable&&score>bestScore)||((!readable)&&(!bestIsReadable)&&score>bestScore)){bestIsReadable=readable;
bestScore=score;bestColor=tinycolor(colorList[i]);}}return bestColor;};var names=tinycolor.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"};
var hexNames=tinycolor.hexNames=flip(names);function flip(o){var flipped={};for(var i in o){if(o.hasOwnProperty(i)){flipped[o[i]]=i;
}}return flipped;}function bound01(n,max){if(isOnePointZero(n)){n="100%";}var processPercent=isPercentage(n);
n=mathMin(max,mathMax(0,parseFloat(n)));if(processPercent){n=parseInt(n*max,10)/100;}if((math.abs(n-max)<0.000001)){return 1;
}return(n%max)/parseFloat(max);}function clamp01(val){return mathMin(1,mathMax(0,val));}function parseHex(val){return parseInt(val,16);
}function isOnePointZero(n){return typeof n=="string"&&n.indexOf(".")!=-1&&parseFloat(n)===1;}function isPercentage(n){return typeof n==="string"&&n.indexOf("%")!=-1;
}function pad2(c){return c.length==1?"0"+c:""+c;}function convertToPercentage(n){if(n<=1){n=(n*100)+"%";
}return n;}var matchers=(function(){var CSS_INTEGER="[-\\+]?\\d+%?";var CSS_NUMBER="[-\\+]?\\d*\\.\\d+%?";
var CSS_UNIT="(?:"+CSS_NUMBER+")|(?:"+CSS_INTEGER+")";var PERMISSIVE_MATCH3="[\\s|\\(]+("+CSS_UNIT+")[,|\\s]+("+CSS_UNIT+")[,|\\s]+("+CSS_UNIT+")\\s*\\)?";
var PERMISSIVE_MATCH4="[\\s|\\(]+("+CSS_UNIT+")[,|\\s]+("+CSS_UNIT+")[,|\\s]+("+CSS_UNIT+")[,|\\s]+("+CSS_UNIT+")\\s*\\)?";
return{rgb:new RegExp("rgb"+PERMISSIVE_MATCH3),rgba:new RegExp("rgba"+PERMISSIVE_MATCH4),hsl:new RegExp("hsl"+PERMISSIVE_MATCH3),hsla:new RegExp("hsla"+PERMISSIVE_MATCH4),hsv:new RegExp("hsv"+PERMISSIVE_MATCH3),hex3:/^([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/};
})();function stringInputToObject(colorinput){var inputarray=colorinput.split("|");color=inputarray[0];
var id="";var image="";var text="";if(inputarray.length>1){id=inputarray[1];}if(inputarray.length>2){image=inputarray[2];
}if(inputarray.length>3){text=inputarray[3];}color=color.replace(trimLeft,"").replace(trimRight,"").toLowerCase();
var named=false;if(names[color]){color=names[color];named=true;}else{if(color=="transparent"){return{r:0,g:0,b:0,a:0,id:id,image:image,text:text};
}}var match;if((match=matchers.rgb.exec(color))){return{r:match[1],g:match[2],b:match[3],id:id,image:image,text:text};
}if((match=matchers.rgba.exec(color))){return{r:match[1],g:match[2],b:match[3],a:match[4],id:id,image:image,text:text};
}if((match=matchers.hsl.exec(color))){return{h:match[1],s:match[2],l:match[3],id:id,image:image,text:text};
}if((match=matchers.hsla.exec(color))){return{h:match[1],s:match[2],l:match[3],a:match[4],id:id,image:image,text:text};
}if((match=matchers.hsv.exec(color))){return{h:match[1],s:match[2],v:match[3],id:id,image:image,text:text};
}if((match=matchers.hex6.exec(color))){return{r:parseHex(match[1]),g:parseHex(match[2]),b:parseHex(match[3]),id:id,image:image,text:text,format:named?"name":"hex"};
}if((match=matchers.hex3.exec(color))){return{r:parseHex(match[1]+""+match[1]),g:parseHex(match[2]+""+match[2]),b:parseHex(match[3]+""+match[3]),id:id,image:image,text:text,format:named?"name":"hex"};
}return false;}root.tinycolor=tinycolor;})(this);$(function(){if($.fn.spectrum.load){$.fn.spectrum.processNativeColorInputs();
}});})(window,jQuery);(function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId]){return installedModules[moduleId].exports;
}var module=installedModules[moduleId]={exports:{},id:moduleId,loaded:false};modules[moduleId].call(module.exports,module,module.exports,__webpack_require__);
module.loaded=true;return module.exports;}__webpack_require__.m=modules;__webpack_require__.c=installedModules;
__webpack_require__.p="";return __webpack_require__(0);})([function(module,exports,__webpack_require__){__webpack_require__(1);
__webpack_require__(2);__webpack_require__(3);__webpack_require__(4);__webpack_require__(5);__webpack_require__(6);
__webpack_require__(7);__webpack_require__(8);__webpack_require__(9);__webpack_require__(10);__webpack_require__(11);
__webpack_require__(12);__webpack_require__(13);__webpack_require__(14);__webpack_require__(15);__webpack_require__(16);
__webpack_require__(17);__webpack_require__(18);__webpack_require__(19);__webpack_require__(20);__webpack_require__(21);
__webpack_require__(22);__webpack_require__(23);__webpack_require__(24);__webpack_require__(25);__webpack_require__(26);
__webpack_require__(27);__webpack_require__(28);__webpack_require__(29);__webpack_require__(30);__webpack_require__(31);
__webpack_require__(32);__webpack_require__(33);__webpack_require__(34);__webpack_require__(35);__webpack_require__(36);
__webpack_require__(37);__webpack_require__(38);__webpack_require__(39);__webpack_require__(40);__webpack_require__(41);
__webpack_require__(42);__webpack_require__(43);__webpack_require__(44);__webpack_require__(45);__webpack_require__(46);
__webpack_require__(47);__webpack_require__(48);__webpack_require__(49);__webpack_require__(50);__webpack_require__(51);
__webpack_require__(52);__webpack_require__(53);__webpack_require__(54);__webpack_require__(55);__webpack_require__(56);
__webpack_require__(57);__webpack_require__(58);__webpack_require__(59);__webpack_require__(60);__webpack_require__(61);
__webpack_require__(62);__webpack_require__(63);__webpack_require__(64);__webpack_require__(65);__webpack_require__(66);
__webpack_require__(67);__webpack_require__(68);__webpack_require__(69);__webpack_require__(70);__webpack_require__(71);
__webpack_require__(72);module.exports=__webpack_require__(73);},function(module,exports){var T=window.T||{};
T.settings={geoWebServices:(window.location.protocol!="https:"?"http://geowebservices.maporama.com/":"https://geowebservices.maporama.com/")};
window.T=T;if(!document.querySelectorAll){document.querySelectorAll=function(r,c,i,j,a){var s=document.createStyleSheet();
a=document.all,c=[],r=r.replace(/\[for\b/gi,"[htmlFor").split(",");for(i=r.length;i--;){s.addRule(r[i],"k:v");
for(j=a.length;j--;){a[j].currentStyle.k&&c.push(a[j]);}s.removeRule(0);}return c;};}if(!Array.prototype.reduce){Array.prototype.reduce=function(callback,opt_initialValue){if(null===this||"undefined"===typeof this){throw new TypeError("Array.prototype.reduce called on null or undefined");
}if("function"!==typeof callback){throw new TypeError(callback+" is not a function");}var index,value,length=this.length>>>0,isValueSet=false;
if(1<arguments.length){value=opt_initialValue;isValueSet=true;}for(index=0;length>index;++index){if(this.hasOwnProperty(index)){if(isValueSet){value=callback(value,this[index],index,this);
}else{value=this[index];isValueSet=true;}}}if(!isValueSet){throw new TypeError("Reduce of empty array with no initial value");
}return value;};}if(!Array.prototype.map){Array.prototype.map=function(fun){var len=this.length;if(typeof fun!=="function"){throw new TypeError("func is not a function!");
}var res=[],i;var thisArg=arguments.length>=2?arguments[1]:void 0;for(i=0;i<len;i++){if(i in this){res[i]=fun.call(thisArg,this[i],i,this);
}}return res;};}if(!Array.prototype.filter){Array.prototype.filter=function(fun){var len=this.length;
if(typeof fun!=="function"){throw new TypeError();}var res=[],i;var thisArg=arguments.length>=2?arguments[1]:void 0;
for(i=0;i<len;i++){if(i in this){var val=this[i];if(fun.call(thisArg,val,i,this)){res.push(val);}}}return res;
};}if(!Array.prototype.forEach){Array.prototype.forEach=function(fun){var t=this;var len=t.length;if(typeof fun!=="function"){throw new TypeError();
}var thisArg=arguments.length>=2?arguments[1]:void 0,i=0;for(i=0;i<len;i++){if(i in t){fun.call(thisArg,t[i],i,t);
}}};}if(!Array.isArray){Array.isArray=function(vArg){return Object.prototype.toString.call(vArg)==="[object Array]";
};}if(!String.prototype.trim){String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"");};
}},function(module,exports){(function(exports){var EventDispatcher=function(){this.events={};this.eventsContext={};
};EventDispatcher.prototype={on:function(eventName,fn,context){var f=context?this.bind(fn,context):fn,events=this.events[eventName]=this.events[eventName]||{},eventsContext=this.eventsContext[eventName]=this.eventsContext[eventName]||{};
fn.key="fn"+this.now()+"_"+Math.floor((Math.random()*100));fn.proxy=f;events[fn.key]=f;eventsContext[fn.key]=context;
},fire:function(eventName,params){var functions=this.events[eventName],key;for(key in functions){if(functions.hasOwnProperty(key)){if(typeof functions[key]==="function"){var fn=functions[key];
var q=[];for(var i=1;i<arguments.length;i++){q.push(arguments[i]);}fn.apply(this,q);}}}},detach:function(eventName,fn){var events=this.events[eventName];
if(events.hasOwnProperty(fn.key)){delete events[fn.key];}return;},detachAll:function(){this.events={};
},bind:function(fn,c){return function(){return fn.apply(c||fn,arguments);};},now:function(){return(new Date()).getTime();
}};exports.EventDispatcher=EventDispatcher;}(window.T));},function(module,exports){(function(exports){var Point=function(x,y){this.x=x;
this.y=y;};Point.prototype={toString:function(){return"Point("+this.x+","+this.y+")";},clone:function(point){return new Point(this.x,this.y);
},add:function(point){var result=this.clone();result.x+=point.x;result.y+=point.y;return result;},substract:function(point){var result=this.clone();
result.x-=point.x;result.y-=point.y;return result;},multiplyBy:function(val){var result=this.clone();
if(val instanceof T.Point){result.x*=val.x;result.y*=val.y;}else{result.x*=val;result.y*=val;}return result;
},divideBy:function(val){var result=this.clone();if(val instanceof T.Point){result.x/=val.x;result.y/=val.y;
}else{result.x/=val;result.y/=val;}return result;},round:function(){var result=this.clone();result.x=Math.round(this.x);
result.y=Math.round(this.y);return result;},floor:function(){var result=this.clone();result.x=Math.floor(result.x);
result.y=Math.floor(result.y);return result;},isEqual:function(other,tollerance){if(tollerance){return(this.x<=other.x+tollerance&&this.x>=other.x-tollerance&&this.y<=other.y+tollerance&&this.y>=other.y-tollerance);
}return this.x===other.x&&this.y===other.y;},distanceTo:function(point){var x=point.x-this.x,y=point.y-this.y;
return Math.sqrt(x*x+y*y);}};exports.Point=Point;}(window.T));},function(module,exports){(function(exports){var Transform=function(a,b,c,d){this.a=a;
this.b=b;this.c=c;this.d=d;};Transform.prototype={transform:function(point,scale){var result=point.clone();
scale=scale||1;result.x=scale*(this.a*result.x+this.b);result.y=scale*(this.c*result.y+this.d);return result;
},untransform:function(point,scale){scale=scale||1;return new T.Point((point.x/scale-this.b)/this.a,(point.y/scale-this.d)/this.c);
}};exports.Transform=Transform;}(window.T));},function(module,exports){(function(exports){var LatLng=function(lat,lng){this.lat=lat;
this.lng=lng;};LatLng.from=function(p1,p2){if(p1===undefined||p1===null){return null;}if(p1 instanceof T.LatLng){return p1;
}if(T.Util.isArray(p1)){return new T.LatLng(p1[0],p1[1]);}return new T.LatLng(p1,p2);};LatLng.prototype={toString:function(){return"LatLng("+this.lat+","+this.lng+")";
},clone:function(){return new LatLng(this.lat,this.lng);},isEqual:function(other){return this.lat===other.lat&&this.lng===other.lng;
},round:function(){var result=this.clone();result.lat=Math.round(this.lat);result.lng=Math.round(this.lng);
return result;}};exports.LatLng=LatLng;}(window.T));},function(module,exports){(function(exports){var LatLngBounds=function(southWest,northEast){if(!southWest){return;
}this.extend(southWest);this.extend(northEast);};LatLngBounds.from=function(p1,p2){if(p1===undefined||p1===null){return null;
}if(p1 instanceof T.LatLngBounds){return p1;}if(T.Util.isArray(p1)&&T.Util.isArray(p2)){return new T.LatLngBounds(T.LatLng.from(p1),T.LatLng.from(p2));
}if(T.Util.isArray(p1)&&p1.length===2){return new T.LatLngBounds(T.LatLng.from(p1[0]),T.LatLng.from(p1[1]));
}};LatLngBounds.prototype={extend:function(obj){if(!obj){return this;}if(obj instanceof T.LatLng){if(!this.southWest&&!this.northEast){this.southWest=new T.LatLng(obj.lat,obj.lng);
this.northEast=new T.LatLng(obj.lat,obj.lng);}else{this.southWest.lat=Math.min(obj.lat,this.southWest.lat);
this.southWest.lng=Math.min(obj.lng,this.southWest.lng);this.northEast.lat=Math.max(obj.lat,this.northEast.lat);
this.northEast.lng=Math.max(obj.lng,this.northEast.lng);}}else{if(obj instanceof T.LatLngBounds){this.extend(obj.southWest);
this.extend(obj.northEast);}}return this;},getNorthEast:function(){return new T.LatLng(this.northEast.lat,this.northEast.lng);
},getNorthWest:function(){return new T.LatLng(this.northEast.lat,this.southWest.lng);},getSouthEast:function(){return new T.LatLng(this.southWest.lat,this.northEast.lng);
},getSouthWest:function(){return new T.LatLng(this.southWest.lat,this.southWest.lng);},center:function(){return new T.LatLng((this.southWest.lat+this.northEast.lat)/2,(this.southWest.lng+this.northEast.lng)/2);
},getWest:function(){return this.southWest.lng;},getSouth:function(){return this.southWest.lat;},getEast:function(){return this.northEast.lng;
},getNorth:function(){return this.northEast.lat;}};exports.LatLngBounds=LatLngBounds;}(window.T));},function(module,exports){(function(exports){var Bounds=function(a,b){if(!a){a=new T.Point(0,0);
}if(!b){b=new T.Point(0,0);}this.extend(a);this.extend(b);};Bounds.prototype={extend:function(point){if(!point){return;
}if(!this.min&&!this.max){this.min=point.clone();this.max=point.clone();}else{this.min.x=Math.min(point.x,this.min.x);
this.max.x=Math.max(point.x,this.max.x);this.min.y=Math.min(point.y,this.min.y);this.max.y=Math.max(point.y,this.max.y);
}return this;},intersect:function(bounds){var b=new T.Bounds();b.min.x=Math.max(this.min.x,bounds.min.x);
b.min.y=Math.max(this.min.y,bounds.min.y);b.max.x=Math.min(this.max.x,bounds.max.x);b.max.y=Math.min(this.max.y,bounds.max.y);
return b;},center:function(){return new T.Point((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2);
},topLeft:function(){return new T.Point(this.min.x,this.max.y);},topRight:function(){return new T.Point(this.max.x,this.max.y);
},bottomLeft:function(){return new T.Point(this.min.x,this.min.y);},bottomRight:function(){return new T.Point(this.max.x,this.min.y);
},width:function(){return this.max.x-this.min.x;},height:function(){return this.max.y-this.min.y;}};exports.Bounds=Bounds;
}(window.T));},function(module,exports){if(typeof JSON!=="object"){JSON={};}(function(){function f(n){return n<10?"0"+n:n;
}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null;
};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf();
};}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;
function quote(string){escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];
return typeof c==="string"?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4);})+'"':'"'+string+'"';
}function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value&&typeof value==="object"&&typeof value.toJSON==="function"){value=value.toJSON(key);
}if(typeof rep==="function"){value=rep.call(holder,key,value);}switch(typeof value){case"string":return quote(value);
case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);
case"object":if(!value){return"null";}gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==="[object Array]"){length=value.length;
for(i=0;i<length;i+=1){partial[i]=str(i,value)||"null";}v=partial.length===0?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]";
gap=mind;return v;}if(rep&&typeof rep==="object"){length=rep.length;for(i=0;i<length;i+=1){if(typeof rep[i]==="string"){k=rep[i];
v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v);}}}}else{for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=str(k,value);
if(v){partial.push(quote(k)+(gap?": ":":")+v);}}}}v=partial.length===0?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}";
gap=mind;return v;}}if(typeof JSON.stringify!=="function"){JSON.stringify=function(value,replacer,space){var i;
gap="";indent="";if(typeof space==="number"){for(i=0;i<space;i+=1){indent+=" ";}}else{if(typeof space==="string"){indent=space;
}}rep=replacer;if(replacer&&typeof replacer!=="function"&&(typeof replacer!=="object"||typeof replacer.length!=="number")){throw new Error("JSON.stringify");
}return str("",{"":value});};}if(typeof JSON.parse!=="function"){JSON.parse=function(text,reviver){var j;
function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==="object"){for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=walk(value,k);
if(v!==undefined){value[k]=v;}else{delete value[k];}}}}return reviver.call(holder,key,value);}text=String(text);
cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4);
});}if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");
return typeof reviver==="function"?walk({"":j},""):j;}throw new SyntaxError("JSON.parse");};}}());},function(module,exports){(function(exports){var Matrix2D=function(a,b,c,d,e,f){var ln=0;
var cl=0;for(var i=0;i<9;i++){ln=(i/3|0)+1;cl=i%3+1;this["m"+ln+cl]=ln===cl?1:0;}if(typeof a==="string"){var vals=a.match(/(-|\+)?\d*\.?\d+(?=,|\))/g);
this.m11=Number(vals[0]);this.m21=Number(vals[1]);this.m12=Number(vals[2]);this.m22=Number(vals[3]);this.m13=Number(vals[4]);
this.m23=Number(vals[5]);}else{this.m11=a||this.m11;this.m21=b||this.m21;this.m12=c||this.m12;this.m22=d||this.m22;
this.m13=e||this.m13;this.m23=f||this.m23;}};Matrix2D.prototype={inverse:function(){var m=this.clone();
var m2=new Matrix2D();var inv11=m.m22*m.m33-m.m23*m.m32;var inv12=m.m13*m.m32-m.m12*m.m33;var inv13=m.m12*m.m23-m.m13*m.m22;
var inv21=m.m23*m.m31-m.m21*m.m33;var inv22=m.m11*m.m33-m.m13*m.m31;var inv23=m.m13*m.m21-m.m11*m.m23;
var inv31=m.m21*m.m32-m.m22*m.m31;var inv32=m.m12*m.m31-m.m11*m.m32;var inv33=m.m11*m.m22-m.m12*m.m21;
var det=m.m11*inv11+m.m12*inv21+m.m13*inv31;m2.m11=1/det*inv11;m2.m12=1/det*inv12;m2.m13=1/det*inv13;
m2.m21=1/det*inv21;m2.m22=1/det*inv22;m2.m23=1/det*inv23;m2.m31=1/det*inv31;m2.m32=1/det*inv32;m2.m33=1/det*inv33;
return m2;},multiplyBy:function(b){var a=this;var c=new Matrix2D();c.m11=a.m11*b.m11+a.m12*b.m21+a.m13*b.m31;
c.m12=a.m11*b.m12+a.m12*b.m22+a.m13*b.m32;c.m13=a.m11*b.m13+a.m12*b.m23+a.m13*b.m33;c.m21=a.m21*b.m11+a.m22*b.m21+a.m23*b.m31;
c.m22=a.m21*b.m12+a.m22*b.m22+a.m23*b.m32;c.m23=a.m21*b.m13+a.m22*b.m23+a.m23*b.m33;c.m31=a.m31*b.m11+a.m32*b.m21+a.m33*b.m31;
c.m32=a.m31*b.m12+a.m32*b.m22+a.m33*b.m32;c.m33=a.m31*b.m13+a.m32*b.m23+a.m33*b.m33;return c;},clone:function(){var m=new Matrix2D();
var l=0;var c=0;for(var i=0;i<9;i++){l=(i/3|0)+1;c=i%3+1;m["m"+l+c]=this["m"+l+c];}return m;},toString:function(){var str=this.m11.toFixed(6);
str+=", "+this.m21.toFixed(6);str+=", "+this.m12.toFixed(6);str+=", "+this.m22.toFixed(6);str+=", "+this.m13.toFixed(6);
str+=", "+this.m23.toFixed(6);return"matrix("+str+")";}};exports.Matrix2D=Matrix2D;}(window.T));},function(module,exports){(function(exports){function Ajax(){}Ajax.prototype={createXhr:function(options){if(options){this.options=options;
}var ajax=this;if(this.isIE()&&!this.isSameWithOrigin(this.url)){this.xhr=new XDomainRequest();this.xhr.onload=function(){ajax.onComplete();
};this.xhr.onerror=function(){ajax.onError();};this.xhr.onprogress=function(){};this.xhr.ontimeout=function(){};
}else{if(!!window.XMLHttpRequest){this.xhr=new window.XMLHttpRequest();}else{if(!!window.ActiveXObject){this.xhr=new window.ActiveXObject("Microsoft.XMLHTTP");
}}}if(!this.xhr){throw new Error("Unable to create XHR object!");}this.xhr.onreadystatechange=function(){if(this.readyState===4){if(this.status===501){ajax.onSessionTimeout();
}else{if(this.status>=400||this.status===0){ajax.onError();}else{ajax.onComplete();}}}};this.xhr.onprogress=function(){};
this.xhr.ontimeout=function(){};return;},abort:function(){this.xhr.abort();},isIE:function(){if(navigator.appVersion.indexOf("MSIE")!==-1){return true;
}return false;},isSameWithOrigin:function(url){var reg=new RegExp("^http(s)?://.*?(/|$)","i");var newHost=reg.exec(url)[0];
var originHost=reg.exec(window.location.href)[0];return(originHost===newHost);},attachIsAjaxParameter:function(url){var isQueryString=false,i=0;
for(i=0;i<url.length;i++){if(url.charAt(i)==="?"){url=url+"&isajax=true";isQueryString=true;break;}}if(!isQueryString){url=url+"?isajax=true";
}return url;},send:function(url,options){this.options=options;this.url=this.attachIsAjaxParameter(url);
if(!this.xhr){this.createXhr();}this.xhr.open(options.method,this.url,true);this.xhr.timeout=2000000;
if(this.xhr.withCredentials!==undefined){if(options.withCredentials){this.xhr.withCredentials=options.withCredentials;
}}var i=0;if(this.xhr.setRequestHeader&&options.headers){for(i=0;i<options.headers.length;i++){this.xhr.setRequestHeader(options.headers[i].name,options.headers[i].value);
}}if(options.data){this.xhr.send(options.data);}else{this.xhr.send(null);}function timeoutHandler(){throw new Error("Loading timeout: "+url);
}return this;},onComplete:function(){if(this.options.on.success){this.options.on.success(this.xhr.responseText);
}},onError:function(){if(this.options.on.error){this.options.on.error(this.xhr.responseText);}},onSessionTimeout:function(){}};
exports.Ajax=Ajax;}(T));},function(module,exports){(function(exports){var Promise=function(){this.state="pending";
this.value=null;this.deferred=null;this.rejected=null;};Promise.prototype={then:function(deferred,rejected){this._handle(deferred,rejected);
},resolve:function(value){this.value=value;this.state="resolved";if(this.deferred){this._handle(this.deferred);
}},reject:function(value){if(value){value=JSON.parse(value);}this.rejected(value);},_handle:function(deffered,rejected){if(this.state==="pending"){this.deferred=deffered;
this.rejected=rejected;return;}deffered(this.value);}};exports.Promise=Promise;}(window.T));},function(module,exports){(function(exports){var Util={extend:function(dest){var sources=Array.prototype.slice.call(arguments,1),len=sources.length;
var i,j,src;for(j=0;j<len;j++){src=sources[j]||{};for(i in src){if(src.hasOwnProperty(i)){dest[i]=src[i];
}}}return dest;},clone:function(dest){var i,result={};for(i in dest){if(Object.prototype.hasOwnProperty.call(dest,i)){result[i]=dest[i];
}}return result;},cloneFunctions:function(dest){var i,result={};for(i in dest){if(typeof(dest[i])==="function"){result[i]=(function(){var func=dest[i];
return function(){return func.apply(this,arguments);};}());}else{result[i]=dest[i];}}return result;},inherit:function(cls,superCls){var Construct=function(){};
Construct.prototype=this.cloneFunctions(superCls.prototype);var proto=new Construct();cls.prototype=Util.extend(proto,cls.prototype);
cls.prototype.constructor=cls;cls.base=superCls.prototype;},bind:function(fn,c){return function(){return fn.apply(c||fn,arguments);
};},template:function(str,data){return str.replace(/\{ *([\w_]+) *\}/g,function(str,key){var value=data[key];
if(value===undefined){throw new Error("No value provided for variable "+str);}else{if(typeof value==="function"){value=value(data);
}}return value;});},trim:function(str){return str.trim?str.trim():str.replace(/^\s+|\s+$/g,"");},defaults:function(obj,source){if(!obj){return source;
}if(source){var prop;for(prop in source){if(source.hasOwnProperty(prop)){if((obj[prop]===null||obj[prop]===undefined)){obj[prop]=source[prop];
}}}}return obj;},limitExecByInterval:function(fn,time,context){var lock,execOnUnlock;return function wrapperFn(){var args=arguments;
if(lock){execOnUnlock=true;return;}lock=true;setTimeout(function(){lock=false;if(execOnUnlock){wrapperFn.apply(context,args);
execOnUnlock=false;}},time);fn.apply(context,args);};},isArray:function(obj){return(Object.prototype.toString.call(obj)==="[object Array]");
},isFunction:function(obj){return !!(obj&&obj.constructor&&obj.call&&obj.apply);},minMax:function(v1,v2,v3){return Math.max(v1,Math.min(v2,v3));
},maxMin:function(v1,v2,v3){return Math.min(v1,Math.max(v2,v3));},floatEqual:function(v1,v2,epsilon){epsilon=epsilon||0.00001;
return(Math.abs(v1-v2)<=epsilon);},stamp:(function(){var lastId=0,key="tibcoId";return function(obj){obj[key]=obj[key]||++lastId;
return obj[key];};}()),hexToRgba:function(hex,alpha){var result=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
var rgba=result?{r:parseInt(result[1],16),g:parseInt(result[2],16),b:parseInt(result[3],16),a:alpha||1}:null;
if(rgba){return"rgba("+rgba.r+","+rgba.g+","+rgba.b+","+rgba.a+")";}return"";},getObjectClass:function(obj){if(obj&&obj.constructor&&obj.constructor.toString){var arr=obj.constructor.toString().match(/function\s*(\w+)/);
if(arr&&arr.length===2){return arr[1];}}return undefined;},browserSupportsHistoryApi:function(){return !!(window.history&&history.pushState);
},handleBrowserNavigation:function(callback){window.onpopstate=callback;},setBrowserHistory:function(content,noHistory){var newUrl=window.location.href;
if(!content||(history.state&&content===history.state.content)||(window.location.href.indexOf(content)!==-1)){return;
}if(window.location.href.indexOf(content.charAt(0))!==-1){newUrl=window.location.href.substring(0,window.location.href.indexOf(content.charAt(0)));
}if(noHistory){history.replaceState({content:content},null,newUrl+content);}else{history.pushState({content:content},null,newUrl+content);
}},setBrowserUrlHash:function(content){if(!content){return;}window.location.hash=content;},getBrowserUrlHash:function(content){return window.location.hash;
},geolocate:function(onSuccess,onError){if(!navigator||!navigator.geolocation){onError.call(this,null);
}navigator.geolocation.getCurrentPosition(T.Util.bind(function(position){onSuccess.call(this,position.coords.latitude,position.coords.longitude);
},this),T.Util.bind(function(error){onError.call(this,error);},this));},browserSupportsGeolocation:function(){return(navigator&&navigator.geolocation);
},touchSupport:function(){var msPointerEnabled=!!navigator.pointerEnabled||navigator.msPointerEnabled;
return !!("ontouchstart" in window)||msPointerEnabled;},browserVersion:(function(){var ua=navigator.userAgent.toLowerCase();
return{ielt8:document.all&&!document.querySelector,ielt9:!!window.ActiveXObject&&!document.addEventListener,webkit:ua.indexOf("webkit")!==-1,chrome:ua.indexOf("chrome")!==-1,android:ua.indexOf("android")!==-1};
}()),initOldIE:(function(){if(!Array.prototype.indexOf){Array.prototype.indexOf=function(obj){var i=0;
for(i=0;i<this.length;i++){if(this[i]===obj){return i;}}return -1;};}if(!window.getComputedStyle){window.getComputedStyle=function(el,pseudo){this.el=el;
this.getPropertyValue=function(prop){var re=/(\-([a-z]){1})/g;if(prop=="float"){prop="styleFloat";}if(re.test(prop)){prop=prop.replace(re,function(){return arguments[2].toUpperCase();
});}return el.currentStyle[prop]?el.currentStyle[prop]:null;};return this;};}}()),numberToRad:(function(){if(typeof(Number.prototype.toRad)==="undefined"){Number.prototype.toRad=function(){return this*Math.PI/180;
};}}())};exports.Util=Util;}(window.T));},function(module,exports){(function(exports){var DomUtil={SVG_NS:"http://www.w3.org/2000/svg",get:function(id){return document.getElementById(id);
},getNodesByClass:function(className){return document.querySelectorAll("."+className);},create:function(tagName,className,parent,id){var element=document.createElement(tagName);
element.className=className||"";if(id){element.id=id;}if(parent){parent.appendChild(element);}return element;
},remove:function(el){if(!el){return;}el.parentNode.removeChild(el);},hasClass:function(el,className){return(el.className.length>0)&&new RegExp("(^|\\s)"+className+"(\\s|$)").test(el.className);
},addClass:function(el,className){if(!DomUtil.hasClass(el,className)){el.className+=(el.className?" ":"")+className;
}},removeClass:function(el,className){el.className=T.Util.trim((" "+el.className+" ").replace(" "+className+" "," "));
},getStyle:function(el,style){var value=el.style[style];if(!value&&el.currentStyle){value=el.currentStyle[style];
}if((!value||value==="auto")&&document.defaultView){var css=document.defaultView.getComputedStyle(el,null);
value=css?css[style]:null;}return value==="auto"?null:value;},setOpacity:function(el,value){el.style.msFilter="progid:DXImageTransform.Microsoft.Alpha(Opacity="+value*100+")";
if(!T.Util.browserVersion.ielt9){el.style.filter="alpha(opacity="+value*100+")";}el.style.opacity=value;
el.style.mozOpacity=value;},position:function(el,point){if(point){el.style.left=point.x+"px";el.style.top=point.y+"px";
el.tibcoPosition=point;}return el.tibcoPosition;},size:function(el,size){if(size){el.style.width=size.x+"px";
el.style.height=size.y+"px";}return new T.Point(parseInt(el.style.width,10),parseInt(el.style.height,10));
},calculateElementClientOffset:function(element){var offsetLeft=0;var offsetTop=0;var bounds=element.getBoundingClientRect();
offsetLeft=bounds.left;offsetTop=bounds.top;return{left:offsetLeft,top:offsetTop};},createSvgElement:function(name){return document.createElementNS(DomUtil.SVG_NS,name);
},createVmlElement:function(name){var x=document.createElement(name);x.setAttribute("xmlns","urn:schemas-microsoft.com:vml");
return x;},getNodeIndex:function(node,parent){var nodes=parent?parent.childNodes:node.parentNode.childNodes,i;
for(i=0;i<nodes.length;i++){if(node===nodes[i]){return i;}}return -1;},addStyleNode:function(css){var head=document.getElementsByTagName("head")[0];
var style=document.createElement("style");style.type="text/css";if(style.styleSheet){style.styleSheet.cssText=css;
}else{style.appendChild(document.createTextNode(css));}head.appendChild(style);},hide:function(el){el.style.display="none";
},show:function(el,display){el.style.display=display||"block";},getElementInsideContainer:function(parentId,childId){var elm=document.getElementById(childId);
var parent=elm?elm.parentNode:{};return(parent.id&&parent.id===parentId)?elm:{};},disableSelection:function(element){element.style.mozUserSelect="none";
element.style.khtmlUserSelect="none";element.style.webkitUserSelect="none";element.style.msUserSelect="none";
element.style.userSelect="none";element.dtraggable=false;element.onmousedown=function(event){if(event){if(event.preventDefault){event.preventDefault();
}else{event.returnValue=false;}}return false;};},nodeCollectionToArray:function(collection){var a=[],i=0;
try{a=Array.prototype.slice.call(collection);}catch(e){for(i=0;i<collection.length;i++){a.push(collection[i]);
}}return a;}};exports.DomUtil=DomUtil;}(window.T));},function(module,exports){(function(exports){var DomEventUtil={on:function(obj,type,fn,context){var id=T.Util.stamp(fn),key="tibco_"+type+id,handler,originalHandler,newType;
if(obj[key]){return this;}handler=function(e){return fn.call(context||obj,e||DomEventUtil.getEvent());
};if(obj.addEventListener!==undefined){if(type==="mousewheel"){obj.addEventListener("DOMMouseScroll",handler,false);
obj.addEventListener(type,handler,false);}else{if((type==="mouseenter")||(type==="mouseleave")){originalHandler=handler;
newType=(type==="mouseenter"?"mouseover":"mouseout");handler=function(e){if(!DomEventUtil.checkMouse(obj,e)){return;
}return originalHandler(e);};obj.addEventListener(newType,handler,false);}else{obj.addEventListener(type,handler,false);
}}}else{if(obj.attachEvent!==undefined){obj.attachEvent("on"+type,handler);}}obj[key]=handler;return this;
},off:function(obj,type,fn){var id=T.Util.stamp(fn),key="tibco_"+type+id,handler=obj[key];if(!handler){return this;
}if(obj.removeEventListener!==undefined){if(type==="mousewheel"){obj.removeEventListener("DOMMouseScroll",handler,false);
obj.removeEventListener(type,handler,false);}else{if((type==="mouseenter")||(type==="mouseleave")){obj.removeEventListener((type==="mouseenter"?"mouseover":"mouseout"),handler,false);
}else{obj.removeEventListener(type,handler,false);}}}else{if(obj.detachEvent!==undefined){obj.detachEvent("on"+type,handler);
}}obj[key]=null;return this;},stopPropagation:function(e){if(e.stopPropagation){e.stopPropagation();}else{e.cancelBubble=true;
}return this;},preventDefault:function(e){if(e.preventDefault){e.preventDefault();}else{e.returnValue=false;
}return this;},stop:function(e){return DomEventUtil.preventDefault(e).stopPropagation(e);},getWheelDelta:function(e){var delta=0;
if(e.wheelDelta){delta=e.wheelDelta/120;}if(e.detail){delta=-e.detail/3;}return delta;},checkMouse:function(el,e){var related=e.relatedTarget;
if(!related){return true;}try{while(related&&(related!==el)){related=related.parentNode;}}catch(err){return false;
}return(related!==el);},getEvent:function(){var e=window.event;if(!e){var caller=arguments.callee.caller;
while(caller){e=caller["arguments"][0];if(e&&window.Event===e.constructor){break;}caller=caller.caller;
}}return e;}};exports.DomEventUtil=DomEventUtil;}(window.T));},function(module,exports){(function(exports){var MouseUtil=function(target,options){this.events=new T.EventDispatcher();
this.options=T.Util.defaults(options,this.options);this.target=target;this.nbOfClicks=0;this.clickThreshold=this.options.clickThreshold||170;
this.longClickThreshold=this.options.longClickThreshold||300;this.dblClickThreshold=this.options.dblClickThreshold||150;
this.clickPrecision=this.options.clickPrecision/2||40/2;};MouseUtil.prototype={options:{},enable:function(){if(this.isEnable){return;
}T.DomEventUtil.on(document,"mouseover",this.onOver,this);T.DomEventUtil.on(document,"mouseout",this.onOut,this);
T.DomEventUtil.on(document,"mousedown",this.onDown,this);T.DomEventUtil.on(document,"mousewheel",this.onMouseWheel,this);
T.DomEventUtil.on(document,"contextmenu",this.onContextMenu,this);this.isEnable=true;},disable:function(){if(!this.isEnable){return;
}T.DomEventUtil.off(document,"mouseover",this.onOver,this);T.DomEventUtil.off(document,"mouseout",this.onOut,this);
T.DomEventUtil.off(document,"mousedown",this.onDown,this);T.DomEventUtil.off(document,"mousewheel",this.onMouseWheel,this);
T.DomEventUtil.off(document,"contextmenu",this.onContextMenu,this);this.isEnable=false;},onContextMenu:function(evt){T.DomEventUtil.stop(evt);
return false;},onMouseWheel:function(evt){this.events.fire("mouse-wheel",evt);},onOver:function(evt){this.events.fire("mouse-over",evt);
},onOut:function(evt){this.events.fire("mouse-out",evt);},onDown:function(evt){var targetElement=document.elementFromPoint(evt.clientX,evt.clientY);
if(this.findParentForTarget(targetElement,this.target)){T.DomEventUtil.stop(evt);}else{return;}this.nbOfClicks++;
this.moved=false;this.startPoint=this.newPoint=new T.Point(evt.clientX,evt.clientY);this.startTimestamp=this.getTimestamp();
this.f=function(evt){this.onUp(evt);};T.DomEventUtil.on(document,"mousemove",this.onMove,this);T.DomEventUtil.on(document,"mouseup",this.f,this);
this.events.fire("before-drag",evt);},onMove:function(evt){var newPoint=new T.Point(evt.clientX,evt.clientY);
T.DomEventUtil.preventDefault(evt);if(newPoint.isEqual(this.newPoint)){return;}if(!this.moved){this.moved=true;
this.events.fire("drag-start",evt);}this.newPoint=newPoint;this.moving=true;this.events.fire("drag",evt);
},onUp:function(evt){var newEvt;if((evt.which&&evt.which===3)||(evt.button&&evt.button===2)){this.events.fire("right-click",evt);
this.nbOfClicks=0;T.DomEventUtil.off(document,"mousemove",this.onMove,this);T.DomEventUtil.off(document,"mouseup",this.f,this);
return;}if(T.Util.browserVersion.ielt9){newEvt=T.Util.clone(evt);}else{newEvt=evt;}if(this.clickTimer){clearTimeout(this.clickTimer);
}if(this.withinTimeAndDistanceTolerance(this.clickThreshold)){if(this.nbOfClicks%2===0){this.events.fire("double-click",evt);
}}this.clickTimer=setTimeout(T.Util.bind(function(){if(this.nbOfClicks===1&&this.withinDistanceTolerance()&&!this.moving&&!this.moved){if(this.getTimestamp()-this.startTimestamp<this.longClickThreshold){this.events.fire("click",newEvt);
}else{this.events.fire("long-click",newEvt);}}this.moving=false;this.moved=false;this.nbOfClicks=0;},this),this.dblClickThreshold);
T.DomEventUtil.off(document,"mousemove",this.onMove,this);T.DomEventUtil.off(document,"mouseup",this.f,this);
this.events.fire("drag-end",evt);},findParentForTarget:function(target,parent){var match=false;while(target){if(target===parent){match=true;
break;}target=target.parentNode;}return match;},withinTimeAndDistanceTolerance:function(timeThreshold){return(this.startTimestamp+timeThreshold)-this.getTimestamp()>=0&&this.startPoint.x>=this.newPoint.x-this.clickPrecision&&this.newPoint.x<=this.newPoint.x+this.clickPrecision&&this.startPoint.y>=this.newPoint.y-this.clickPrecision&&this.startPoint.y<=this.newPoint.y+this.clickPrecision;
},withinDistanceTolerance:function(){return this.startPoint.x>=this.newPoint.x-this.clickPrecision&&this.newPoint.x<=this.newPoint.x+this.clickPrecision&&this.startPoint.y>=this.newPoint.y-this.clickPrecision&&this.startPoint.y<=this.newPoint.y+this.clickPrecision;
},getTimestamp:function(){return new Date().getTime();},getNewMouseEventWithUsefulProperties:function(evt,newTarget){return{clientX:evt.clientX,clientY:evt.clientY,target:newTarget};
}};exports.MouseUtil=MouseUtil;}(window.T));},function(module,exports){(function(exports){var TouchUtil=function(target,options){options=options||{};
this.events=new T.EventDispatcher();this.options=T.Util.defaults(options,this.options);this.target=target;
this.nbOfTaps=0;this.currentTouches=[];this.tapThreshold=options.tapThreshold||260;this.longTapThreshold=options.longTapThreshold||360;
this.dblTapThreshold=options.dblTapThreshold||270;this.tapPrecision=options.tapPrecision/2||14/2;};TouchUtil.prototype={options:{},enable:function(){if(this.isEnable){return;
}T.DomEventUtil.on(document,"touchstart",this.onTouchStart,this);T.DomEventUtil.on(document,"touchmove",this.onTouchMove,this);
T.DomEventUtil.on(document,"touchend",this.onTouchEnd,this);T.DomEventUtil.on(document,"touchcancel",this.onTouchEnd,this);
this.isEnable=true;},disable:function(){if(!this.isEnable){return;}T.DomEventUtil.off(document,"touchstart",this.onTouchStart,this);
T.DomEventUtil.off(document,"touchmove",this.onTouchMove,this);T.DomEventUtil.off(document,"touchend",this.onTouchEnd,this);
T.DomEventUtil.off(document,"touchcancel",this.onTouchEnd,this);this.isEnable=false;},onTouchStart:function(evt){var targetElement=document.elementFromPoint(this.getPointerEvent(evt).clientX,this.getPointerEvent(evt).clientY);
if(this.findParentForTarget(targetElement,this.target)){T.DomEventUtil.stop(evt);}else{return;}var touches=evt.changedTouches,newTouches=[],i;
this.moved=false;this.startPoint=this.newPoint=new T.Point(this.getPointerEvent(evt).clientX,this.getPointerEvent(evt).clientY);
for(i=0;i<touches.length;i++){var touchObj=this.createTouchObject(touches[i]);var idx=this.getTouchIndexById(touches[i].identifier);
if(idx>=0){this.currentTouches.splice(idx,1,touchObj);}else{this.currentTouches.push(touchObj);}newTouches.push(touchObj);
}if(this.currentTouches.length===1){if(this.nbOfTaps===0){this.startTimestamp=this.getTimestamp();}this.nbOfTaps++;
}else{this.nbOfTaps=0;}if(this.currentTouches.length<=2){this.startPositions=this.currentTouches.concat();
}this.events.fire("touch-start",evt,newTouches);},onTouchMove:function(evt){var touches=evt.changedTouches,newTouches=[],originalTouches=[],i,newPoint=new T.Point(this.getPointerEvent(evt).clientX,this.getPointerEvent(evt).clientY);
T.DomEventUtil.stop(evt);if(newPoint.isEqual(this.newPoint,1)){return;}for(i=0;i<touches.length;i++){var idx=this.getTouchIndexById(touches[i].identifier);
if(idx>=0){var touchObj=this.createTouchObject(touches[i]);newTouches.push(touchObj);originalTouches.push(this.currentTouches[idx]);
this.currentTouches.splice(idx,1,touchObj);}}if(this.currentTouches.length===1&&!this._pinching){if(!this.moved){this.moved=true;
this.events.fire("touch-move-start",evt);}this.newPoint=newPoint;this.moving=true;this.events.fire("touch-move",evt,originalTouches,newTouches);
}this.handleGesture(evt,originalTouches,newTouches);},onTouchEnd:function(evt){var touches=evt.changedTouches,endTouches=[],center,delta,scale,touchChange=false,originalTouches=[],i;
T.DomEventUtil.stop(evt);if(evt.touches.length===0){this.moving=false;}if(evt.changedTouches.length===1&&this.withinTimeAndDistanceTolerance(this.tapThreshold)){if(this.nbOfTaps>=2){this.nbOfTaps=0;
this.events.fire("double-tap",evt);}}if(!this.tapTimer){this.tapTimer=setTimeout(T.Util.bind(function(){if(this.nbOfTaps===1&&this.withinDistanceTolerance()&&!this.moving){if(this.getTimestamp()-this.startTimestamp<this.longTapThreshold){this.events.fire("tap",evt);
}else{this.events.fire("long-tap",evt);}}this.moving=false;this.moved=false;this.nbOfTaps=0;this.tapTimer=null;
},this),this.dblTapThreshold);}if(this.currentTouches.length===2){this._center={x:(this.startPositions[0].pageX+this.startPositions[1].pageX)/2,y:(this.startPositions[0].pageY+this.startPositions[1].pageY)/2};
this._delta=this.getPinchCenter();this._scale=this.getPinchScale();touchChange=true;}for(i=0;i<touches.length;
i++){var idx=this.getTouchIndexById(touches[i].identifier);if(idx>=0){var touchObj=this.createTouchObject(touches[i]);
endTouches.push(touchObj);originalTouches.push(this.currentTouches[idx]);this.currentTouches.splice(idx,1);
}}if(touchChange){this.events.fire("touch-pinch-change",evt,this._center,this._scale,this._delta);}if(evt.touches.length===0&&this._pinching){this._pinching=false;
this.events.fire("touch-pinch-end",evt,this._center,this._scale,this._delta);this.currentTouches=[];}this.events.fire("touch-end",evt,originalTouches,endTouches);
},findParentForTarget:function(target,parent){var match=false;while(target){if(target===parent){match=true;
break;}target=target.parentNode;}return match;},withinTimeAndDistanceTolerance:function(timeThreshold){return(this.startTimestamp+timeThreshold)-this.getTimestamp()>=0&&this.startPoint.x>=this.newPoint.x-this.tapPrecision&&this.newPoint.x<=this.newPoint.x+this.tapPrecision&&this.startPoint.y>=this.newPoint.y-this.tapPrecision&&this.startPoint.y<=this.newPoint.y+this.tapPrecision;
},withinDistanceTolerance:function(){return this.startPoint.x>=this.newPoint.x-this.tapPrecision&&this.newPoint.x<=this.newPoint.x+this.tapPrecision&&this.startPoint.y>=this.newPoint.y-this.tapPrecision&&this.startPoint.y<=this.newPoint.y+this.tapPrecision;
},getPointerEvent:function(event){return event.targetTouches?event.targetTouches[0]:event;},getTimestamp:function(){return new Date().getTime();
},handleGesture:function(evt,originalTouches,newTouches){if(this.currentTouches.length===1){var dx=newTouches[0].pageX-originalTouches[0].pageX;
var dy=newTouches[0].pageY-originalTouches[0].pageY;this.events.fire("touch-slide",evt,dx,dy);}else{if(this.currentTouches.length===2){var scale,center,delta;
this._pinching=true;center={x:(this.startPositions[0].pageX+this.startPositions[1].pageX)/2,y:(this.startPositions[0].pageY+this.startPositions[1].pageY)/2};
delta=this.getPinchCenter(originalTouches,newTouches);scale=this.getPinchScale(originalTouches,newTouches);
this.events.fire("touch-pinch",evt,center,scale,delta);}}},getPinchCenter:function(){var i,idx,touch;
var centerS={x:(this.startPositions[0].pageX+this.startPositions[1].pageX)/2,y:(this.startPositions[0].pageY+this.startPositions[1].pageY)/2};
var centerE={x:(this.currentTouches[0].pageX+this.currentTouches[1].pageX)/2,y:(this.currentTouches[0].pageY+this.currentTouches[1].pageY)/2};
var center={x:centerE.x-centerS.x,y:centerE.y-centerS.y};return center;},getPinchScale:function(originalTouches,newTouches){var idx,touchA,touchB,touchC,touchD,scale;
touchA=this.startPositions[0];touchB=this.startPositions[1];touchC=this.currentTouches[0];touchD=this.currentTouches[1];
scale=this.distance(touchC,touchD)/this.distance(touchA,touchB);return scale;},getTouchIndexById:function(idToFind){var i;
for(i=0;i<this.currentTouches.length;i++){var id=this.currentTouches[i].identifier;if(id===idToFind){return i;
}}return -1;},createTouchObject:function(touch){return{identifier:touch.identifier,pageX:touch.pageX,pageY:touch.pageY};
},distance:function(touchA,touchB){return Math.sqrt(Math.pow(touchA.pageX-touchB.pageX,2)+Math.pow(touchA.pageY-touchB.pageY,2));
},getNewMouseEventWithUsefulProperties:function(evt,newTarget){if(!evt.changedTouches){return{clientX:evt.clientX,clientY:evt.clientY,target:newTarget};
}else{return{clientX:evt.changedTouches[0].clientX,clientY:evt.changedTouches[0].clientY,target:newTarget};
}}};exports.TouchUtil=TouchUtil;}(window.T));},function(module,exports){(function(exports){var AnimUtil={getTransform:function(element){var style=getComputedStyle(element);
var transform=style.msTransform||style.webkitTransform||style.transform||"";if(transform.search("matrix")!==-1){return transform;
}return null;},setMatrix:function(element,matrixStr){if(element.style.msTransform){element.style.msTransform=matrixStr;
}else{element.style.webkitTransform=matrixStr;element.style.transform=matrixStr;}},onTransitionEnd:function(element,callback){element.removeEventListener("webkitTransitionEnd",element.lastCallback);
element.addEventListener("webkitTransitionEnd",callback,false);element.removeEventListener("transitionend",element.lastCallback);
element.addEventListener("transitionend",callback,false);element.removeEventListener("otransitionend",element.lastCallback);
element.addEventListener("otransitionend",callback,false);element.removeEventListener("MSTransitionEnd",element.lastCallback);
element.addEventListener("MSTransitionEnd",callback,false);element.lastCallback=callback;},transition:function(element,time,pos,type){if(type){element.style.webkitTransition=type+" "+time+"s";
element.style.transition=type+" "+time+"s";return;}pos=pos||new T.Point(0,0);element.style.webkitTransition="-webkit-transform "+time+"s cubic-bezier(.17,.67,1,.84)";
element.style.transition="transform "+time+"s cubic-bezier(.17,.67,1,.84)";element.style.webkitTransformOrigin=pos.x+"px "+pos.y+"px";
element.style.transformOrigin=pos.x+"px "+pos.y+"px";element.style.msTransformOrigin=pos.x+"px "+pos.y+"px";
},translate:function(element,x,y){if(element.style.msTransform){element.style.msTransform="translate("+x+"px,"+y+"px)"+element.style.msTransform;
}else{element.style.webkitTransform="translate("+x+"px,"+y+"px)"+element.style.webkitTransform;element.style.transform="translate("+x+"px,"+y+"px)"+element.style.transform;
}},scale:function(element,x,y){if(element.style.msTransform){element.style.msTransform="scale("+x+","+y+")"+element.style.msTransform;
}else{element.style.webkitTransform="scale("+x+","+y+")"+element.style.webkitTransform;element.style.transform="scale("+x+","+y+")"+element.style.transform;
}},reset:function(element){element.style.webkitTransition="-webkit-transform 0s";element.style.transition="transform 0s";
if(element.style.msTransform){element.style.msTransform="translate(0,0)";}else{element.style.webkitTransform="translate(0,0)";
element.style.transform="translate(0,0)";}if(element.style.msTransform){element.style.msTransform+="scale(1,1)";
}else{element.style.webkitTransform+="scale(1,1)";element.style.transform+="scale(1,1)";}},canAnim:function(){var s=document.createElement("p").style,supportsTransitions="transition" in s||"WebkitTransition" in s||"MozTransition" in s||"msTransition" in s||"OTransition" in s;
return supportsTransitions;}};exports.AnimUtil=AnimUtil;}(window.T));},function(module,exports){(function(T){var SimpleTouch=function(){this.currentTouches=[];
this.events=new T.EventDispatcher();this.lastAnchor={};};SimpleTouch.prototype={init:function(element){element.addEventListener("touchstart",this.handleStart.bind(this));
element.addEventListener("touchmove",this.handleMove.bind(this));element.addEventListener("touchend",this.handleEnd.bind(this));
},createTouchObject:function(touch){return{identifier:touch.identifier,pageX:touch.pageX,pageY:touch.pageY};
},getTouchIndexById:function(idToFind){var i;for(i=0;i<this.currentTouches.length;i++){var id=this.currentTouches[i].identifier;
if(id===idToFind){return i;}}return -1;},handleStart:function(e){var touches=e.changedTouches,newTouches=[],i;
e.preventDefault();for(i=0;i<touches.length;i++){var touchObj=this.createTouchObject(touches[i]);var idx=this.getTouchIndexById(touches[i].identifier);
if(idx>=0){this.currentTouches.splice(idx,1,touchObj);}else{this.currentTouches.push(touchObj);}newTouches.push(touchObj);
}if(this.currentTouches.length<=2){this.startPositions=this.currentTouches.concat();}this.events.fire("touch-start",newTouches);
},handleMove:function(e){var touches=e.changedTouches,newTouches=[],originalTouches=[],i;e.preventDefault();
for(i=0;i<touches.length;i++){var idx=this.getTouchIndexById(touches[i].identifier);if(idx>=0){var touchObj=this.createTouchObject(touches[i]);
newTouches.push(touchObj);originalTouches.push(this.currentTouches[idx]);this.currentTouches.splice(idx,1,touchObj);
}else{}}this.events.fire("touch-move",originalTouches,newTouches);this.handleGesture(originalTouches,newTouches);
},handleGesture:function(originalTouches,newTouches){if(this.currentTouches.length===1){var dx=newTouches[0].pageX-originalTouches[0].pageX;
var dy=newTouches[0].pageY-originalTouches[0].pageY;this.events.fire("touch-slide",dx,dy);}else{if(this.currentTouches.length===2){var scale,center,delta;
this._pinching=true;center={x:(this.startPositions[0].pageX+this.startPositions[1].pageX)/2,y:(this.startPositions[0].pageY+this.startPositions[1].pageY)/2};
delta=this.getPinchCenter(originalTouches,newTouches);scale=this.getPinchScale(originalTouches,newTouches);
this.events.fire("touch-pinch",center,scale,delta);}}},getPinchCenter:function(){var i,idx,touch;var centerS={x:(this.startPositions[0].pageX+this.startPositions[1].pageX)/2,y:(this.startPositions[0].pageY+this.startPositions[1].pageY)/2};
var centerE={x:(this.currentTouches[0].pageX+this.currentTouches[1].pageX)/2,y:(this.currentTouches[0].pageY+this.currentTouches[1].pageY)/2};
var center={x:centerE.x-centerS.x,y:centerE.y-centerS.y};return center;},getPinchScale:function(originalTouches,newTouches){var idx,touchA,touchB,touchC,touchD,scale;
touchA=this.startPositions[0];touchB=this.startPositions[1];touchC=this.currentTouches[0];touchD=this.currentTouches[1];
scale=this.distance(touchC,touchD)/this.distance(touchA,touchB);return scale;},distance:function(touchA,touchB){return Math.sqrt(Math.pow(touchA.pageX-touchB.pageX,2)+Math.pow(touchA.pageY-touchB.pageY,2));
},handleEnd:function(e){var touches=e.changedTouches,endTouches=[],center,delta,scale,touchChange=false,originalTouches=[],i;
e.preventDefault();if(this.currentTouches.length===2){this._center={x:(this.startPositions[0].pageX+this.startPositions[1].pageX)/2,y:(this.startPositions[0].pageY+this.startPositions[1].pageY)/2};
this._delta=this.getPinchCenter();this._scale=this.getPinchScale();touchChange=true;}for(i=0;i<touches.length;
i++){var idx=this.getTouchIndexById(touches[i].identifier);if(idx>=0){var touchObj=this.createTouchObject(touches[i]);
endTouches.push(touchObj);originalTouches.push(this.currentTouches[idx]);this.currentTouches.splice(idx,1);
}else{console.log("can't figure out which touch to end");}}if(touchChange){this.events.fire("touch-pinch-change",this._center,this._scale,this._delta);
}if(e.touches.length===0&&this._pinching){this._pinching=false;this.events.fire("touch-pinch-end",this._center,this._scale,this._delta);
this.currentTouches=[];}this.events.fire("touch-end",originalTouches,endTouches);}};T.SimpleTouch=SimpleTouch;
}(window.T));},function(module,exports,__webpack_require__){var require;var require;(function(global){!function(e){var f;
"undefined"!=typeof window?f=window:"undefined"!=typeof global?f=global:"undefined"!=typeof self&&(f=self),f.proj4=e();
}(function(){var define,module,exports;return(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;
if(!u&&a){return require(o,!0);}if(i){return i(o,!0);}throw new Error("Cannot find module '"+o+"'");}var f=n[o]={exports:{}};
t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e);},f,f.exports,e,t,n,r);}return n[o].exports;
}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++){s(r[o]);}return s;})({1:[function(_dereq_,module,exports){var mgrs=_dereq_("mgrs");
function Point(x,y,z){if(!(this instanceof Point)){return new Point(x,y,z);}if(Array.isArray(x)){this.x=x[0];
this.y=x[1];this.z=x[2]||0;}else{if(typeof x==="object"){this.x=x.x;this.y=x.y;this.z=x.z||0;}else{if(typeof x==="string"&&typeof y==="undefined"){var coords=x.split(",");
this.x=parseFloat(coords[0],10);this.y=parseFloat(coords[1],10);this.z=parseFloat(coords[2],10)||0;}else{this.x=x;
this.y=y;this.z=z||0;}}}console.warn("proj4.Point will be removed in version 3, use proj4.toPoint");}Point.fromMGRS=function(mgrsStr){return new Point(mgrs.toPoint(mgrsStr));
};Point.prototype.toMGRS=function(accuracy){return mgrs.forward([this.x,this.y],accuracy);};module.exports=Point;
},{mgrs:66}],2:[function(_dereq_,module,exports){var parseCode=_dereq_("./parseCode");var extend=_dereq_("./extend");
var projections=_dereq_("./projections");var deriveConstants=_dereq_("./deriveConstants");function Projection(srsCode,callback){if(!(this instanceof Projection)){return new Projection(srsCode);
}callback=callback||function(error){if(error){throw error;}};var json=parseCode(srsCode);if(typeof json!=="object"){callback(srsCode);
return;}var modifiedJSON=deriveConstants(json);var ourProj=Projection.projections.get(modifiedJSON.projName);
if(ourProj){extend(this,modifiedJSON);extend(this,ourProj);this.init();callback(null,this);}else{callback(srsCode);
}}Projection.projections=projections;Projection.projections.start();module.exports=Projection;},{"./deriveConstants":32,"./extend":33,"./parseCode":36,"./projections":38}],3:[function(_dereq_,module,exports){module.exports=function(crs,denorm,point){var xin=point.x,yin=point.y,zin=point.z||0;
var v,t,i;for(i=0;i<3;i++){if(denorm&&i===2&&point.z===undefined){continue;}if(i===0){v=xin;t="x";}else{if(i===1){v=yin;
t="y";}else{v=zin;t="z";}}switch(crs.axis[i]){case"e":point[t]=v;break;case"w":point[t]=-v;break;case"n":point[t]=v;
break;case"s":point[t]=-v;break;case"u":if(point[t]!==undefined){point.z=v;}break;case"d":if(point[t]!==undefined){point.z=-v;
}break;default:return null;}}return point;};},{}],4:[function(_dereq_,module,exports){var HALF_PI=Math.PI/2;
var sign=_dereq_("./sign");module.exports=function(x){return(Math.abs(x)<HALF_PI)?x:(x-(sign(x)*Math.PI));
};},{"./sign":21}],5:[function(_dereq_,module,exports){var TWO_PI=Math.PI*2;var sign=_dereq_("./sign");
module.exports=function(x){return(Math.abs(x)<Math.PI)?x:(x-(sign(x)*TWO_PI));};},{"./sign":21}],6:[function(_dereq_,module,exports){module.exports=function(x){if(Math.abs(x)>1){x=(x>1)?1:-1;
}return Math.asin(x);};},{}],7:[function(_dereq_,module,exports){module.exports=function(x){return(1-0.25*x*(1+x/16*(3+1.25*x)));
};},{}],8:[function(_dereq_,module,exports){module.exports=function(x){return(0.375*x*(1+0.25*x*(1+0.46875*x)));
};},{}],9:[function(_dereq_,module,exports){module.exports=function(x){return(0.05859375*x*x*(1+0.75*x));
};},{}],10:[function(_dereq_,module,exports){module.exports=function(x){return(x*x*x*(35/3072));};},{}],11:[function(_dereq_,module,exports){module.exports=function(a,e,sinphi){var temp=e*sinphi;
return a/Math.sqrt(1-temp*temp);};},{}],12:[function(_dereq_,module,exports){module.exports=function(ml,e0,e1,e2,e3){var phi;
var dphi;phi=ml/e0;for(var i=0;i<15;i++){dphi=(ml-(e0*phi-e1*Math.sin(2*phi)+e2*Math.sin(4*phi)-e3*Math.sin(6*phi)))/(e0-2*e1*Math.cos(2*phi)+4*e2*Math.cos(4*phi)-6*e3*Math.cos(6*phi));
phi+=dphi;if(Math.abs(dphi)<=1e-10){return phi;}}return NaN;};},{}],13:[function(_dereq_,module,exports){var HALF_PI=Math.PI/2;
module.exports=function(eccent,q){var temp=1-(1-eccent*eccent)/(2*eccent)*Math.log((1-eccent)/(1+eccent));
if(Math.abs(Math.abs(q)-temp)<0.000001){if(q<0){return(-1*HALF_PI);}else{return HALF_PI;}}var phi=Math.asin(0.5*q);
var dphi;var sin_phi;var cos_phi;var con;for(var i=0;i<30;i++){sin_phi=Math.sin(phi);cos_phi=Math.cos(phi);
con=eccent*sin_phi;dphi=Math.pow(1-con*con,2)/(2*cos_phi)*(q/(1-eccent*eccent)-sin_phi/(1-con*con)+0.5/eccent*Math.log((1-con)/(1+con)));
phi+=dphi;if(Math.abs(dphi)<=1e-10){return phi;}}return NaN;};},{}],14:[function(_dereq_,module,exports){module.exports=function(e0,e1,e2,e3,phi){return(e0*phi-e1*Math.sin(2*phi)+e2*Math.sin(4*phi)-e3*Math.sin(6*phi));
};},{}],15:[function(_dereq_,module,exports){module.exports=function(eccent,sinphi,cosphi){var con=eccent*sinphi;
return cosphi/(Math.sqrt(1-con*con));};},{}],16:[function(_dereq_,module,exports){var HALF_PI=Math.PI/2;
module.exports=function(eccent,ts){var eccnth=0.5*eccent;var con,dphi;var phi=HALF_PI-2*Math.atan(ts);
for(var i=0;i<=15;i++){con=eccent*Math.sin(phi);dphi=HALF_PI-2*Math.atan(ts*(Math.pow(((1-con)/(1+con)),eccnth)))-phi;
phi+=dphi;if(Math.abs(dphi)<=1e-10){return phi;}}return -9999;};},{}],17:[function(_dereq_,module,exports){var C00=1;
var C02=0.25;var C04=0.046875;var C06=0.01953125;var C08=0.01068115234375;var C22=0.75;var C44=0.46875;
var C46=0.013020833333333334;var C48=0.007120768229166667;var C66=0.3645833333333333;var C68=0.005696614583333333;
var C88=0.3076171875;module.exports=function(es){var en=[];en[0]=C00-es*(C02+es*(C04+es*(C06+es*C08)));
en[1]=es*(C22-es*(C04+es*(C06+es*C08)));var t=es*es;en[2]=t*(C44-es*(C46+es*C48));t*=es;en[3]=t*(C66-es*C68);
en[4]=t*es*C88;return en;};},{}],18:[function(_dereq_,module,exports){var pj_mlfn=_dereq_("./pj_mlfn");
var EPSLN=1e-10;var MAX_ITER=20;module.exports=function(arg,es,en){var k=1/(1-es);var phi=arg;for(var i=MAX_ITER;
i;--i){var s=Math.sin(phi);var t=1-es*s*s;t=(pj_mlfn(phi,s,Math.cos(phi),en)-arg)*(t*Math.sqrt(t))*k;
phi-=t;if(Math.abs(t)<EPSLN){return phi;}}return phi;};},{"./pj_mlfn":19}],19:[function(_dereq_,module,exports){module.exports=function(phi,sphi,cphi,en){cphi*=sphi;
sphi*=sphi;return(en[0]*phi-cphi*(en[1]+sphi*(en[2]+sphi*(en[3]+sphi*en[4]))));};},{}],20:[function(_dereq_,module,exports){module.exports=function(eccent,sinphi){var con;
if(eccent>1e-7){con=eccent*sinphi;return((1-eccent*eccent)*(sinphi/(1-con*con)-(0.5/eccent)*Math.log((1-con)/(1+con))));
}else{return(2*sinphi);}};},{}],21:[function(_dereq_,module,exports){module.exports=function(x){return x<0?-1:1;
};},{}],22:[function(_dereq_,module,exports){module.exports=function(esinp,exp){return(Math.pow((1-esinp)/(1+esinp),exp));
};},{}],23:[function(_dereq_,module,exports){module.exports=function(array){var out={x:array[0],y:array[1]};
if(array.length>2){out.z=array[2];}if(array.length>3){out.m=array[3];}return out;};},{}],24:[function(_dereq_,module,exports){var HALF_PI=Math.PI/2;
module.exports=function(eccent,phi,sinphi){var con=eccent*sinphi;var com=0.5*eccent;con=Math.pow(((1-con)/(1+con)),com);
return(Math.tan(0.5*(HALF_PI-phi))/con);};},{}],25:[function(_dereq_,module,exports){exports.wgs84={towgs84:"0,0,0",ellipse:"WGS84",datumName:"WGS84"};
exports.ch1903={towgs84:"674.374,15.056,405.346",ellipse:"bessel",datumName:"swiss"};exports.ggrs87={towgs84:"-199.87,74.79,246.62",ellipse:"GRS80",datumName:"Greek_Geodetic_Reference_System_1987"};
exports.nad83={towgs84:"0,0,0",ellipse:"GRS80",datumName:"North_American_Datum_1983"};exports.nad27={nadgrids:"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",ellipse:"clrk66",datumName:"North_American_Datum_1927"};
exports.potsdam={towgs84:"606.0,23.0,413.0",ellipse:"bessel",datumName:"Potsdam Rauenberg 1950 DHDN"};
exports.carthage={towgs84:"-263.0,6.0,431.0",ellipse:"clark80",datumName:"Carthage 1934 Tunisia"};exports.hermannskogel={towgs84:"653.0,-212.0,449.0",ellipse:"bessel",datumName:"Hermannskogel"};
exports.ire65={towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"mod_airy",datumName:"Ireland 1965"};
exports.rassadiran={towgs84:"-133.63,-157.5,-158.62",ellipse:"intl",datumName:"Rassadiran"};exports.nzgd49={towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",ellipse:"intl",datumName:"New Zealand Geodetic Datum 1949"};
exports.osgb36={towgs84:"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",ellipse:"airy",datumName:"Airy 1830"};
exports.s_jtsk={towgs84:"589,76,480",ellipse:"bessel",datumName:"S-JTSK (Ferro)"};exports.beduaram={towgs84:"-106,-87,188",ellipse:"clrk80",datumName:"Beduaram"};
exports.gunung_segara={towgs84:"-403,684,41",ellipse:"bessel",datumName:"Gunung Segara Jakarta"};exports.rnb72={towgs84:"106.869,-52.2978,103.724,-0.33657,0.456955,-1.84218,1",ellipse:"intl",datumName:"Reseau National Belge 1972"};
},{}],26:[function(_dereq_,module,exports){exports.MERIT={a:6378137,rf:298.257,ellipseName:"MERIT 1983"};
exports.SGS85={a:6378136,rf:298.257,ellipseName:"Soviet Geodetic System 85"};exports.GRS80={a:6378137,rf:298.257222101,ellipseName:"GRS 1980(IUGG, 1980)"};
exports.IAU76={a:6378140,rf:298.257,ellipseName:"IAU 1976"};exports.airy={a:6377563.396,b:6356256.91,ellipseName:"Airy 1830"};
exports.APL4={a:6378137,rf:298.25,ellipseName:"Appl. Physics. 1965"};exports.NWL9D={a:6378145,rf:298.25,ellipseName:"Naval Weapons Lab., 1965"};
exports.mod_airy={a:6377340.189,b:6356034.446,ellipseName:"Modified Airy"};exports.andrae={a:6377104.43,rf:300,ellipseName:"Andrae 1876 (Den., Iclnd.)"};
exports.aust_SA={a:6378160,rf:298.25,ellipseName:"Australian Natl & S. Amer. 1969"};exports.GRS67={a:6378160,rf:298.247167427,ellipseName:"GRS 67(IUGG 1967)"};
exports.bessel={a:6377397.155,rf:299.1528128,ellipseName:"Bessel 1841"};exports.bess_nam={a:6377483.865,rf:299.1528128,ellipseName:"Bessel 1841 (Namibia)"};
exports.clrk66={a:6378206.4,b:6356583.8,ellipseName:"Clarke 1866"};exports.clrk80={a:6378249.145,rf:293.4663,ellipseName:"Clarke 1880 mod."};
exports.clrk58={a:6378293.645208759,rf:294.2606763692654,ellipseName:"Clarke 1858"};exports.CPM={a:6375738.7,rf:334.29,ellipseName:"Comm. des Poids et Mesures 1799"};
exports.delmbr={a:6376428,rf:311.5,ellipseName:"Delambre 1810 (Belgium)"};exports.engelis={a:6378136.05,rf:298.2566,ellipseName:"Engelis 1985"};
exports.evrst30={a:6377276.345,rf:300.8017,ellipseName:"Everest 1830"};exports.evrst48={a:6377304.063,rf:300.8017,ellipseName:"Everest 1948"};
exports.evrst56={a:6377301.243,rf:300.8017,ellipseName:"Everest 1956"};exports.evrst69={a:6377295.664,rf:300.8017,ellipseName:"Everest 1969"};
exports.evrstSS={a:6377298.556,rf:300.8017,ellipseName:"Everest (Sabah & Sarawak)"};exports.fschr60={a:6378166,rf:298.3,ellipseName:"Fischer (Mercury Datum) 1960"};
exports.fschr60m={a:6378155,rf:298.3,ellipseName:"Fischer 1960"};exports.fschr68={a:6378150,rf:298.3,ellipseName:"Fischer 1968"};
exports.helmert={a:6378200,rf:298.3,ellipseName:"Helmert 1906"};exports.hough={a:6378270,rf:297,ellipseName:"Hough"};
exports.intl={a:6378388,rf:297,ellipseName:"International 1909 (Hayford)"};exports.kaula={a:6378163,rf:298.24,ellipseName:"Kaula 1961"};
exports.lerch={a:6378139,rf:298.257,ellipseName:"Lerch 1979"};exports.mprts={a:6397300,rf:191,ellipseName:"Maupertius 1738"};
exports.new_intl={a:6378157.5,b:6356772.2,ellipseName:"New International 1967"};exports.plessis={a:6376523,rf:6355863,ellipseName:"Plessis 1817 (France)"};
exports.krass={a:6378245,rf:298.3,ellipseName:"Krassovsky, 1942"};exports.SEasia={a:6378155,b:6356773.3205,ellipseName:"Southeast Asia"};
exports.walbeck={a:6376896,b:6355834.8467,ellipseName:"Walbeck"};exports.WGS60={a:6378165,rf:298.3,ellipseName:"WGS 60"};
exports.WGS66={a:6378145,rf:298.25,ellipseName:"WGS 66"};exports.WGS7={a:6378135,rf:298.26,ellipseName:"WGS 72"};
exports.WGS84={a:6378137,rf:298.257223563,ellipseName:"WGS 84"};exports.sphere={a:6370997,b:6370997,ellipseName:"Normal Sphere (r=6370997)"};
},{}],27:[function(_dereq_,module,exports){exports.greenwich=0;exports.lisbon=-9.131906111111;exports.paris=2.337229166667;
exports.bogota=-74.080916666667;exports.madrid=-3.687938888889;exports.rome=12.452333333333;exports.bern=7.439583333333;
exports.jakarta=106.807719444444;exports.ferro=-17.666666666667;exports.brussels=4.367975;exports.stockholm=18.058277777778;
exports.athens=23.7163375;exports.oslo=10.722916666667;},{}],28:[function(_dereq_,module,exports){var proj=_dereq_("./Proj");
var transform=_dereq_("./transform");var wgs84=proj("WGS84");function transformer(from,to,coords){var transformedArray;
if(Array.isArray(coords)){transformedArray=transform(from,to,coords);if(coords.length===3){return[transformedArray.x,transformedArray.y,transformedArray.z];
}else{return[transformedArray.x,transformedArray.y];}}else{return transform(from,to,coords);}}function checkProj(item){if(item instanceof proj){return item;
}if(item.oProj){return item.oProj;}return proj(item);}function proj4(fromProj,toProj,coord){fromProj=checkProj(fromProj);
var single=false;var obj;if(typeof toProj==="undefined"){toProj=fromProj;fromProj=wgs84;single=true;}else{if(typeof toProj.x!=="undefined"||Array.isArray(toProj)){coord=toProj;
toProj=fromProj;fromProj=wgs84;single=true;}}toProj=checkProj(toProj);if(coord){return transformer(fromProj,toProj,coord);
}else{obj={forward:function(coords){return transformer(fromProj,toProj,coords);},inverse:function(coords){return transformer(toProj,fromProj,coords);
}};if(single){obj.oProj=toProj;}return obj;}}module.exports=proj4;},{"./Proj":2,"./transform":64}],29:[function(_dereq_,module,exports){var HALF_PI=Math.PI/2;
var PJD_3PARAM=1;var PJD_7PARAM=2;var PJD_GRIDSHIFT=3;var PJD_WGS84=4;var PJD_NODATUM=5;var SEC_TO_RAD=0.00000484813681109536;
var AD_C=1.0026;var COS_67P5=0.3826834323650898;var datum=function(proj){if(!(this instanceof datum)){return new datum(proj);
}this.datum_type=PJD_WGS84;if(!proj){return;}if(proj.datumCode&&proj.datumCode==="none"){this.datum_type=PJD_NODATUM;
}if(proj.datum_params){for(var i=0;i<proj.datum_params.length;i++){proj.datum_params[i]=parseFloat(proj.datum_params[i]);
}if(proj.datum_params[0]!==0||proj.datum_params[1]!==0||proj.datum_params[2]!==0){this.datum_type=PJD_3PARAM;
}if(proj.datum_params.length>3){if(proj.datum_params[3]!==0||proj.datum_params[4]!==0||proj.datum_params[5]!==0||proj.datum_params[6]!==0){this.datum_type=PJD_7PARAM;
proj.datum_params[3]*=SEC_TO_RAD;proj.datum_params[4]*=SEC_TO_RAD;proj.datum_params[5]*=SEC_TO_RAD;proj.datum_params[6]=(proj.datum_params[6]/1000000)+1;
}}}this.datum_type=proj.grids?PJD_GRIDSHIFT:this.datum_type;this.a=proj.a;this.b=proj.b;this.es=proj.es;
this.ep2=proj.ep2;this.datum_params=proj.datum_params;if(this.datum_type===PJD_GRIDSHIFT){this.grids=proj.grids;
}};datum.prototype={compare_datums:function(dest){if(this.datum_type!==dest.datum_type){return false;
}else{if(this.a!==dest.a||Math.abs(this.es-dest.es)>5e-11){return false;}else{if(this.datum_type===PJD_3PARAM){return(this.datum_params[0]===dest.datum_params[0]&&this.datum_params[1]===dest.datum_params[1]&&this.datum_params[2]===dest.datum_params[2]);
}else{if(this.datum_type===PJD_7PARAM){return(this.datum_params[0]===dest.datum_params[0]&&this.datum_params[1]===dest.datum_params[1]&&this.datum_params[2]===dest.datum_params[2]&&this.datum_params[3]===dest.datum_params[3]&&this.datum_params[4]===dest.datum_params[4]&&this.datum_params[5]===dest.datum_params[5]&&this.datum_params[6]===dest.datum_params[6]);
}else{if(this.datum_type===PJD_GRIDSHIFT||dest.datum_type===PJD_GRIDSHIFT){return this.nadgrids===dest.nadgrids;
}else{return true;}}}}}},geodetic_to_geocentric:function(p){var Longitude=p.x;var Latitude=p.y;var Height=p.z?p.z:0;
var X;var Y;var Z;var Error_Code=0;var Rn;var Sin_Lat;var Sin2_Lat;var Cos_Lat;if(Latitude<-HALF_PI&&Latitude>-1.001*HALF_PI){Latitude=-HALF_PI;
}else{if(Latitude>HALF_PI&&Latitude<1.001*HALF_PI){Latitude=HALF_PI;}else{if((Latitude<-HALF_PI)||(Latitude>HALF_PI)){return null;
}}}if(Longitude>Math.PI){Longitude-=(2*Math.PI);}Sin_Lat=Math.sin(Latitude);Cos_Lat=Math.cos(Latitude);
Sin2_Lat=Sin_Lat*Sin_Lat;Rn=this.a/(Math.sqrt(1-this.es*Sin2_Lat));X=(Rn+Height)*Cos_Lat*Math.cos(Longitude);
Y=(Rn+Height)*Cos_Lat*Math.sin(Longitude);Z=((Rn*(1-this.es))+Height)*Sin_Lat;p.x=X;p.y=Y;p.z=Z;return Error_Code;
},geocentric_to_geodetic:function(p){var genau=1e-12;var genau2=(genau*genau);var maxiter=30;var P;var RR;
var CT;var ST;var RX;var RK;var RN;var CPHI0;var SPHI0;var CPHI;var SPHI;var SDPHI;var At_Pole;var iter;
var X=p.x;var Y=p.y;var Z=p.z?p.z:0;var Longitude;var Latitude;var Height;At_Pole=false;P=Math.sqrt(X*X+Y*Y);
RR=Math.sqrt(X*X+Y*Y+Z*Z);if(P/this.a<genau){At_Pole=true;Longitude=0;if(RR/this.a<genau){Latitude=HALF_PI;
Height=-this.b;return;}}else{Longitude=Math.atan2(Y,X);}CT=Z/RR;ST=P/RR;RX=1/Math.sqrt(1-this.es*(2-this.es)*ST*ST);
CPHI0=ST*(1-this.es)*RX;SPHI0=CT*RX;iter=0;do{iter++;RN=this.a/Math.sqrt(1-this.es*SPHI0*SPHI0);Height=P*CPHI0+Z*SPHI0-RN*(1-this.es*SPHI0*SPHI0);
RK=this.es*RN/(RN+Height);RX=1/Math.sqrt(1-RK*(2-RK)*ST*ST);CPHI=ST*(1-RK)*RX;SPHI=CT*RX;SDPHI=SPHI*CPHI0-CPHI*SPHI0;
CPHI0=CPHI;SPHI0=SPHI;}while(SDPHI*SDPHI>genau2&&iter<maxiter);Latitude=Math.atan(SPHI/Math.abs(CPHI));
p.x=Longitude;p.y=Latitude;p.z=Height;return p;},geocentric_to_geodetic_noniter:function(p){var X=p.x;
var Y=p.y;var Z=p.z?p.z:0;var Longitude;var Latitude;var Height;var W;var W2;var T0;var T1;var S0;var S1;
var Sin_B0;var Sin3_B0;var Cos_B0;var Sin_p1;var Cos_p1;var Rn;var Sum;var At_Pole;X=parseFloat(X);Y=parseFloat(Y);
Z=parseFloat(Z);At_Pole=false;if(X!==0){Longitude=Math.atan2(Y,X);}else{if(Y>0){Longitude=HALF_PI;}else{if(Y<0){Longitude=-HALF_PI;
}else{At_Pole=true;Longitude=0;if(Z>0){Latitude=HALF_PI;}else{if(Z<0){Latitude=-HALF_PI;}else{Latitude=HALF_PI;
Height=-this.b;return;}}}}}W2=X*X+Y*Y;W=Math.sqrt(W2);T0=Z*AD_C;S0=Math.sqrt(T0*T0+W2);Sin_B0=T0/S0;Cos_B0=W/S0;
Sin3_B0=Sin_B0*Sin_B0*Sin_B0;T1=Z+this.b*this.ep2*Sin3_B0;Sum=W-this.a*this.es*Cos_B0*Cos_B0*Cos_B0;S1=Math.sqrt(T1*T1+Sum*Sum);
Sin_p1=T1/S1;Cos_p1=Sum/S1;Rn=this.a/Math.sqrt(1-this.es*Sin_p1*Sin_p1);if(Cos_p1>=COS_67P5){Height=W/Cos_p1-Rn;
}else{if(Cos_p1<=-COS_67P5){Height=W/-Cos_p1-Rn;}else{Height=Z/Sin_p1+Rn*(this.es-1);}}if(At_Pole===false){Latitude=Math.atan(Sin_p1/Cos_p1);
}p.x=Longitude;p.y=Latitude;p.z=Height;return p;},geocentric_to_wgs84:function(p){if(this.datum_type===PJD_3PARAM){p.x+=this.datum_params[0];
p.y+=this.datum_params[1];p.z+=this.datum_params[2];}else{if(this.datum_type===PJD_7PARAM){var Dx_BF=this.datum_params[0];
var Dy_BF=this.datum_params[1];var Dz_BF=this.datum_params[2];var Rx_BF=this.datum_params[3];var Ry_BF=this.datum_params[4];
var Rz_BF=this.datum_params[5];var M_BF=this.datum_params[6];var x_out=M_BF*(p.x-Rz_BF*p.y+Ry_BF*p.z)+Dx_BF;
var y_out=M_BF*(Rz_BF*p.x+p.y-Rx_BF*p.z)+Dy_BF;var z_out=M_BF*(-Ry_BF*p.x+Rx_BF*p.y+p.z)+Dz_BF;p.x=x_out;
p.y=y_out;p.z=z_out;}}},geocentric_from_wgs84:function(p){if(this.datum_type===PJD_3PARAM){p.x-=this.datum_params[0];
p.y-=this.datum_params[1];p.z-=this.datum_params[2];}else{if(this.datum_type===PJD_7PARAM){var Dx_BF=this.datum_params[0];
var Dy_BF=this.datum_params[1];var Dz_BF=this.datum_params[2];var Rx_BF=this.datum_params[3];var Ry_BF=this.datum_params[4];
var Rz_BF=this.datum_params[5];var M_BF=this.datum_params[6];var x_tmp=(p.x-Dx_BF)/M_BF;var y_tmp=(p.y-Dy_BF)/M_BF;
var z_tmp=(p.z-Dz_BF)/M_BF;p.x=x_tmp+Rz_BF*y_tmp-Ry_BF*z_tmp;p.y=-Rz_BF*x_tmp+y_tmp+Rx_BF*z_tmp;p.z=Ry_BF*x_tmp-Rx_BF*y_tmp+z_tmp;
}}}};module.exports=datum;},{}],30:[function(_dereq_,module,exports){var PJD_3PARAM=1;var PJD_7PARAM=2;
var PJD_GRIDSHIFT=3;var PJD_NODATUM=5;var SRS_WGS84_SEMIMAJOR=6378137;var SRS_WGS84_ESQUARED=0.006694379990141316;
module.exports=function(source,dest,point){var wp,i,l;function checkParams(fallback){return(fallback===PJD_3PARAM||fallback===PJD_7PARAM);
}if(source.compare_datums(dest)){return point;}if(source.datum_type===PJD_NODATUM||dest.datum_type===PJD_NODATUM){return point;
}var src_a=source.a;var src_es=source.es;var dst_a=dest.a;var dst_es=dest.es;var fallback=source.datum_type;
if(fallback===PJD_GRIDSHIFT){if(this.apply_gridshift(source,0,point)===0){source.a=SRS_WGS84_SEMIMAJOR;
source.es=SRS_WGS84_ESQUARED;}else{if(!source.datum_params){source.a=src_a;source.es=source.es;return point;
}wp=1;for(i=0,l=source.datum_params.length;i<l;i++){wp*=source.datum_params[i];}if(wp===0){source.a=src_a;
source.es=source.es;return point;}if(source.datum_params.length>3){fallback=PJD_7PARAM;}else{fallback=PJD_3PARAM;
}}}if(dest.datum_type===PJD_GRIDSHIFT){dest.a=SRS_WGS84_SEMIMAJOR;dest.es=SRS_WGS84_ESQUARED;}if(source.es!==dest.es||source.a!==dest.a||checkParams(fallback)||checkParams(dest.datum_type)){source.geodetic_to_geocentric(point);
if(checkParams(source.datum_type)){source.geocentric_to_wgs84(point);}if(checkParams(dest.datum_type)){dest.geocentric_from_wgs84(point);
}dest.geocentric_to_geodetic(point);}if(dest.datum_type===PJD_GRIDSHIFT){this.apply_gridshift(dest,1,point);
}source.a=src_a;source.es=src_es;dest.a=dst_a;dest.es=dst_es;return point;};},{}],31:[function(_dereq_,module,exports){var globals=_dereq_("./global");
var parseProj=_dereq_("./projString");var wkt=_dereq_("./wkt");function defs(name){var that=this;if(arguments.length===2){var def=arguments[1];
if(typeof def==="string"){if(def[0]==="+"){defs[name]=parseProj(arguments[1]);}else{defs[name]=wkt(arguments[1]);
}}else{defs[name]=def;}}else{if(arguments.length===1){if(Array.isArray(name)){return name.map(function(v){if(Array.isArray(v)){defs.apply(that,v);
}else{defs(v);}});}else{if(typeof name==="string"){if(name in defs){return defs[name];}}else{if("EPSG" in name){defs["EPSG:"+name.EPSG]=name;
}else{if("ESRI" in name){defs["ESRI:"+name.ESRI]=name;}else{if("IAU2000" in name){defs["IAU2000:"+name.IAU2000]=name;
}else{console.log(name);}}}}}return;}}}globals(defs);module.exports=defs;},{"./global":34,"./projString":37,"./wkt":65}],32:[function(_dereq_,module,exports){var Datum=_dereq_("./constants/Datum");
var Ellipsoid=_dereq_("./constants/Ellipsoid");var extend=_dereq_("./extend");var datum=_dereq_("./datum");
var EPSLN=1e-10;var SIXTH=0.16666666666666666;var RA4=0.04722222222222222;var RA6=0.022156084656084655;
module.exports=function(json){if(json.datumCode&&json.datumCode!=="none"){var datumDef=Datum[json.datumCode];
if(datumDef){json.datum_params=datumDef.towgs84?datumDef.towgs84.split(","):null;json.ellps=datumDef.ellipse;
json.datumName=datumDef.datumName?datumDef.datumName:json.datumCode;}}if(!json.a){var ellipse=Ellipsoid[json.ellps]?Ellipsoid[json.ellps]:Ellipsoid.WGS84;
extend(json,ellipse);}if(json.rf&&!json.b){json.b=(1-1/json.rf)*json.a;}if(json.rf===0||Math.abs(json.a-json.b)<EPSLN){json.sphere=true;
json.b=json.a;}json.a2=json.a*json.a;json.b2=json.b*json.b;json.es=(json.a2-json.b2)/json.a2;json.e=Math.sqrt(json.es);
if(json.R_A){json.a*=1-json.es*(SIXTH+json.es*(RA4+json.es*RA6));json.a2=json.a*json.a;json.b2=json.b*json.b;
json.es=0;}json.ep2=(json.a2-json.b2)/json.b2;if(!json.k0){json.k0=1;}if(!json.axis){json.axis="enu";
}json.datum=datum(json);return json;};},{"./constants/Datum":25,"./constants/Ellipsoid":26,"./datum":29,"./extend":33}],33:[function(_dereq_,module,exports){module.exports=function(destination,source){destination=destination||{};
var value,property;if(!source){return destination;}for(property in source){value=source[property];if(value!==undefined){destination[property]=value;
}}return destination;};},{}],34:[function(_dereq_,module,exports){module.exports=function(defs){defs("EPSG:4326","+title=WGS 84 (long/lat) +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees");
defs("EPSG:4269","+title=NAD83 (long/lat) +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees");
defs("EPSG:3857","+title=WGS 84 / Pseudo-Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs");
defs.WGS84=defs["EPSG:4326"];defs["EPSG:3785"]=defs["EPSG:3857"];defs.GOOGLE=defs["EPSG:3857"];defs["EPSG:900913"]=defs["EPSG:3857"];
defs["EPSG:102113"]=defs["EPSG:3857"];};},{}],35:[function(_dereq_,module,exports){var proj4=_dereq_("./core");
proj4.defaultDatum="WGS84";proj4.Proj=_dereq_("./Proj");proj4.WGS84=new proj4.Proj("WGS84");proj4.Point=_dereq_("./Point");
proj4.toPoint=_dereq_("./common/toPoint");proj4.defs=_dereq_("./defs");proj4.transform=_dereq_("./transform");
proj4.mgrs=_dereq_("mgrs");proj4.version=_dereq_("../package.json").version;_dereq_("./includedProjections")(proj4);
module.exports=proj4;},{"../package.json":67,"./Point":1,"./Proj":2,"./common/toPoint":23,"./core":28,"./defs":31,"./includedProjections":"Jf/0WF","./transform":64,mgrs:66}],36:[function(_dereq_,module,exports){var defs=_dereq_("./defs");
var wkt=_dereq_("./wkt");var projStr=_dereq_("./projString");function testObj(code){return typeof code==="string";
}function testDef(code){return code in defs;}function testWKT(code){var codeWords=["GEOGCS","GEOCCS","PROJCS","LOCAL_CS"];
return codeWords.reduce(function(a,b){return a+1+code.indexOf(b);},0);}function testProj(code){return code[0]==="+";
}function parse(code){if(testObj(code)){if(testDef(code)){return defs[code];}else{if(testWKT(code)){return wkt(code);
}else{if(testProj(code)){return projStr(code);}}}}else{return code;}}module.exports=parse;},{"./defs":31,"./projString":37,"./wkt":65}],37:[function(_dereq_,module,exports){var D2R=0.017453292519943295;
var PrimeMeridian=_dereq_("./constants/PrimeMeridian");module.exports=function(defData){var self={};var paramObj={};
defData.split("+").map(function(v){return v.trim();}).filter(function(a){return a;}).forEach(function(a){var split=a.split("=");
split.push(true);paramObj[split[0].toLowerCase()]=split[1];});var paramName,paramVal,paramOutname;var params={proj:"projName",datum:"datumCode",rf:function(v){self.rf=parseFloat(v,10);
},lat_0:function(v){self.lat0=v*D2R;},lat_1:function(v){self.lat1=v*D2R;},lat_2:function(v){self.lat2=v*D2R;
},lat_ts:function(v){self.lat_ts=v*D2R;},lon_0:function(v){self.long0=v*D2R;},lon_1:function(v){self.long1=v*D2R;
},lon_2:function(v){self.long2=v*D2R;},alpha:function(v){self.alpha=parseFloat(v)*D2R;},lonc:function(v){self.longc=v*D2R;
},x_0:function(v){self.x0=parseFloat(v,10);},y_0:function(v){self.y0=parseFloat(v,10);},k_0:function(v){self.k0=parseFloat(v,10);
},k:function(v){self.k0=parseFloat(v,10);},r_a:function(){self.R_A=true;},zone:function(v){self.zone=parseInt(v,10);
},south:function(){self.utmSouth=true;},towgs84:function(v){self.datum_params=v.split(",").map(function(a){return parseFloat(a,10);
});},to_meter:function(v){self.to_meter=parseFloat(v,10);},from_greenwich:function(v){self.from_greenwich=v*D2R;
},pm:function(v){self.from_greenwich=(PrimeMeridian[v]?PrimeMeridian[v]:parseFloat(v,10))*D2R;},nadgrids:function(v){if(v==="@null"){self.datumCode="none";
}else{self.nadgrids=v;}},axis:function(v){var legalAxis="ewnsud";if(v.length===3&&legalAxis.indexOf(v.substr(0,1))!==-1&&legalAxis.indexOf(v.substr(1,1))!==-1&&legalAxis.indexOf(v.substr(2,1))!==-1){self.axis=v;
}}};for(paramName in paramObj){paramVal=paramObj[paramName];if(paramName in params){paramOutname=params[paramName];
if(typeof paramOutname==="function"){paramOutname(paramVal);}else{self[paramOutname]=paramVal;}}else{self[paramName]=paramVal;
}}if(typeof self.datumCode==="string"&&self.datumCode!=="WGS84"){self.datumCode=self.datumCode.toLowerCase();
}return self;};},{"./constants/PrimeMeridian":27}],38:[function(_dereq_,module,exports){var projs=[_dereq_("./projections/merc"),_dereq_("./projections/longlat")];
var names={};var projStore=[];function add(proj,i){var len=projStore.length;if(!proj.names){console.log(i);
return true;}projStore[len]=proj;proj.names.forEach(function(n){names[n.toLowerCase()]=len;});return this;
}exports.add=add;exports.get=function(name){if(!name){return false;}var n=name.toLowerCase();if(typeof names[n]!=="undefined"&&projStore[names[n]]){return projStore[names[n]];
}};exports.start=function(){projs.forEach(add);};},{"./projections/longlat":50,"./projections/merc":51}],39:[function(_dereq_,module,exports){var EPSLN=1e-10;
var msfnz=_dereq_("../common/msfnz");var qsfnz=_dereq_("../common/qsfnz");var adjust_lon=_dereq_("../common/adjust_lon");
var asinz=_dereq_("../common/asinz");exports.init=function(){if(Math.abs(this.lat1+this.lat2)<EPSLN){return;
}this.temp=this.b/this.a;this.es=1-Math.pow(this.temp,2);this.e3=Math.sqrt(this.es);this.sin_po=Math.sin(this.lat1);
this.cos_po=Math.cos(this.lat1);this.t1=this.sin_po;this.con=this.sin_po;this.ms1=msfnz(this.e3,this.sin_po,this.cos_po);
this.qs1=qsfnz(this.e3,this.sin_po,this.cos_po);this.sin_po=Math.sin(this.lat2);this.cos_po=Math.cos(this.lat2);
this.t2=this.sin_po;this.ms2=msfnz(this.e3,this.sin_po,this.cos_po);this.qs2=qsfnz(this.e3,this.sin_po,this.cos_po);
this.sin_po=Math.sin(this.lat0);this.cos_po=Math.cos(this.lat0);this.t3=this.sin_po;this.qs0=qsfnz(this.e3,this.sin_po,this.cos_po);
if(Math.abs(this.lat1-this.lat2)>EPSLN){this.ns0=(this.ms1*this.ms1-this.ms2*this.ms2)/(this.qs2-this.qs1);
}else{this.ns0=this.con;}this.c=this.ms1*this.ms1+this.ns0*this.qs1;this.rh=this.a*Math.sqrt(this.c-this.ns0*this.qs0)/this.ns0;
};exports.forward=function(p){var lon=p.x;var lat=p.y;this.sin_phi=Math.sin(lat);this.cos_phi=Math.cos(lat);
var qs=qsfnz(this.e3,this.sin_phi,this.cos_phi);var rh1=this.a*Math.sqrt(this.c-this.ns0*qs)/this.ns0;
var theta=this.ns0*adjust_lon(lon-this.long0);var x=rh1*Math.sin(theta)+this.x0;var y=this.rh-rh1*Math.cos(theta)+this.y0;
p.x=x;p.y=y;return p;};exports.inverse=function(p){var rh1,qs,con,theta,lon,lat;p.x-=this.x0;p.y=this.rh-p.y+this.y0;
if(this.ns0>=0){rh1=Math.sqrt(p.x*p.x+p.y*p.y);con=1;}else{rh1=-Math.sqrt(p.x*p.x+p.y*p.y);con=-1;}theta=0;
if(rh1!==0){theta=Math.atan2(con*p.x,con*p.y);}con=rh1*this.ns0/this.a;if(this.sphere){lat=Math.asin((this.c-con*con)/(2*this.ns0));
}else{qs=(this.c-con*con)/this.ns0;lat=this.phi1z(this.e3,qs);}lon=adjust_lon(theta/this.ns0+this.long0);
p.x=lon;p.y=lat;return p;};exports.phi1z=function(eccent,qs){var sinphi,cosphi,con,com,dphi;var phi=asinz(0.5*qs);
if(eccent<EPSLN){return phi;}var eccnts=eccent*eccent;for(var i=1;i<=25;i++){sinphi=Math.sin(phi);cosphi=Math.cos(phi);
con=eccent*sinphi;com=1-con*con;dphi=0.5*com*com/cosphi*(qs/(1-eccnts)-sinphi/com+0.5/eccent*Math.log((1-con)/(1+con)));
phi=phi+dphi;if(Math.abs(dphi)<=1e-7){return phi;}}return null;};exports.names=["Albers_Conic_Equal_Area","Albers","aea"];
},{"../common/adjust_lon":5,"../common/asinz":6,"../common/msfnz":15,"../common/qsfnz":20}],40:[function(_dereq_,module,exports){var adjust_lon=_dereq_("../common/adjust_lon");
var HALF_PI=Math.PI/2;var EPSLN=1e-10;var mlfn=_dereq_("../common/mlfn");var e0fn=_dereq_("../common/e0fn");
var e1fn=_dereq_("../common/e1fn");var e2fn=_dereq_("../common/e2fn");var e3fn=_dereq_("../common/e3fn");
var gN=_dereq_("../common/gN");var asinz=_dereq_("../common/asinz");var imlfn=_dereq_("../common/imlfn");
exports.init=function(){this.sin_p12=Math.sin(this.lat0);this.cos_p12=Math.cos(this.lat0);};exports.forward=function(p){var lon=p.x;
var lat=p.y;var sinphi=Math.sin(p.y);var cosphi=Math.cos(p.y);var dlon=adjust_lon(lon-this.long0);var e0,e1,e2,e3,Mlp,Ml,tanphi,Nl1,Nl,psi,Az,G,H,GH,Hs,c,kp,cos_c,s,s2,s3,s4,s5;
if(this.sphere){if(Math.abs(this.sin_p12-1)<=EPSLN){p.x=this.x0+this.a*(HALF_PI-lat)*Math.sin(dlon);p.y=this.y0-this.a*(HALF_PI-lat)*Math.cos(dlon);
return p;}else{if(Math.abs(this.sin_p12+1)<=EPSLN){p.x=this.x0+this.a*(HALF_PI+lat)*Math.sin(dlon);p.y=this.y0+this.a*(HALF_PI+lat)*Math.cos(dlon);
return p;}else{cos_c=this.sin_p12*sinphi+this.cos_p12*cosphi*Math.cos(dlon);c=Math.acos(cos_c);kp=c/Math.sin(c);
p.x=this.x0+this.a*kp*cosphi*Math.sin(dlon);p.y=this.y0+this.a*kp*(this.cos_p12*sinphi-this.sin_p12*cosphi*Math.cos(dlon));
return p;}}}else{e0=e0fn(this.es);e1=e1fn(this.es);e2=e2fn(this.es);e3=e3fn(this.es);if(Math.abs(this.sin_p12-1)<=EPSLN){Mlp=this.a*mlfn(e0,e1,e2,e3,HALF_PI);
Ml=this.a*mlfn(e0,e1,e2,e3,lat);p.x=this.x0+(Mlp-Ml)*Math.sin(dlon);p.y=this.y0-(Mlp-Ml)*Math.cos(dlon);
return p;}else{if(Math.abs(this.sin_p12+1)<=EPSLN){Mlp=this.a*mlfn(e0,e1,e2,e3,HALF_PI);Ml=this.a*mlfn(e0,e1,e2,e3,lat);
p.x=this.x0+(Mlp+Ml)*Math.sin(dlon);p.y=this.y0+(Mlp+Ml)*Math.cos(dlon);return p;}else{tanphi=sinphi/cosphi;
Nl1=gN(this.a,this.e,this.sin_p12);Nl=gN(this.a,this.e,sinphi);psi=Math.atan((1-this.es)*tanphi+this.es*Nl1*this.sin_p12/(Nl*cosphi));
Az=Math.atan2(Math.sin(dlon),this.cos_p12*Math.tan(psi)-this.sin_p12*Math.cos(dlon));if(Az===0){s=Math.asin(this.cos_p12*Math.sin(psi)-this.sin_p12*Math.cos(psi));
}else{if(Math.abs(Math.abs(Az)-Math.PI)<=EPSLN){s=-Math.asin(this.cos_p12*Math.sin(psi)-this.sin_p12*Math.cos(psi));
}else{s=Math.asin(Math.sin(dlon)*Math.cos(psi)/Math.sin(Az));}}G=this.e*this.sin_p12/Math.sqrt(1-this.es);
H=this.e*this.cos_p12*Math.cos(Az)/Math.sqrt(1-this.es);GH=G*H;Hs=H*H;s2=s*s;s3=s2*s;s4=s3*s;s5=s4*s;
c=Nl1*s*(1-s2*Hs*(1-Hs)/6+s3/8*GH*(1-2*Hs)+s4/120*(Hs*(4-7*Hs)-3*G*G*(1-7*Hs))-s5/48*GH);p.x=this.x0+c*Math.sin(Az);
p.y=this.y0+c*Math.cos(Az);return p;}}}};exports.inverse=function(p){p.x-=this.x0;p.y-=this.y0;var rh,z,sinz,cosz,lon,lat,con,e0,e1,e2,e3,Mlp,M,N1,psi,Az,cosAz,tmp,A,B,D,Ee,F;
if(this.sphere){rh=Math.sqrt(p.x*p.x+p.y*p.y);if(rh>(2*HALF_PI*this.a)){return;}z=rh/this.a;sinz=Math.sin(z);
cosz=Math.cos(z);lon=this.long0;if(Math.abs(rh)<=EPSLN){lat=this.lat0;}else{lat=asinz(cosz*this.sin_p12+(p.y*sinz*this.cos_p12)/rh);
con=Math.abs(this.lat0)-HALF_PI;if(Math.abs(con)<=EPSLN){if(this.lat0>=0){lon=adjust_lon(this.long0+Math.atan2(p.x,-p.y));
}else{lon=adjust_lon(this.long0-Math.atan2(-p.x,p.y));}}else{lon=adjust_lon(this.long0+Math.atan2(p.x*sinz,rh*this.cos_p12*cosz-p.y*this.sin_p12*sinz));
}}p.x=lon;p.y=lat;return p;}else{e0=e0fn(this.es);e1=e1fn(this.es);e2=e2fn(this.es);e3=e3fn(this.es);
if(Math.abs(this.sin_p12-1)<=EPSLN){Mlp=this.a*mlfn(e0,e1,e2,e3,HALF_PI);rh=Math.sqrt(p.x*p.x+p.y*p.y);
M=Mlp-rh;lat=imlfn(M/this.a,e0,e1,e2,e3);lon=adjust_lon(this.long0+Math.atan2(p.x,-1*p.y));p.x=lon;p.y=lat;
return p;}else{if(Math.abs(this.sin_p12+1)<=EPSLN){Mlp=this.a*mlfn(e0,e1,e2,e3,HALF_PI);rh=Math.sqrt(p.x*p.x+p.y*p.y);
M=rh-Mlp;lat=imlfn(M/this.a,e0,e1,e2,e3);lon=adjust_lon(this.long0+Math.atan2(p.x,p.y));p.x=lon;p.y=lat;
return p;}else{rh=Math.sqrt(p.x*p.x+p.y*p.y);Az=Math.atan2(p.x,p.y);N1=gN(this.a,this.e,this.sin_p12);
cosAz=Math.cos(Az);tmp=this.e*this.cos_p12*cosAz;A=-tmp*tmp/(1-this.es);B=3*this.es*(1-A)*this.sin_p12*this.cos_p12*cosAz/(1-this.es);
D=rh/N1;Ee=D-A*(1+A)*Math.pow(D,3)/6-B*(1+3*A)*Math.pow(D,4)/24;F=1-A*Ee*Ee/2-D*Ee*Ee*Ee/6;psi=Math.asin(this.sin_p12*Math.cos(Ee)+this.cos_p12*Math.sin(Ee)*cosAz);
lon=adjust_lon(this.long0+Math.asin(Math.sin(Az)*Math.sin(Ee)/Math.cos(psi)));lat=Math.atan((1-this.es*F*this.sin_p12/Math.sin(psi))*Math.tan(psi)/(1-this.es));
p.x=lon;p.y=lat;return p;}}}};exports.names=["Azimuthal_Equidistant","aeqd"];},{"../common/adjust_lon":5,"../common/asinz":6,"../common/e0fn":7,"../common/e1fn":8,"../common/e2fn":9,"../common/e3fn":10,"../common/gN":11,"../common/imlfn":12,"../common/mlfn":14}],41:[function(_dereq_,module,exports){var mlfn=_dereq_("../common/mlfn");
var e0fn=_dereq_("../common/e0fn");var e1fn=_dereq_("../common/e1fn");var e2fn=_dereq_("../common/e2fn");
var e3fn=_dereq_("../common/e3fn");var gN=_dereq_("../common/gN");var adjust_lon=_dereq_("../common/adjust_lon");
var adjust_lat=_dereq_("../common/adjust_lat");var imlfn=_dereq_("../common/imlfn");var HALF_PI=Math.PI/2;
var EPSLN=1e-10;exports.init=function(){if(!this.sphere){this.e0=e0fn(this.es);this.e1=e1fn(this.es);
this.e2=e2fn(this.es);this.e3=e3fn(this.es);this.ml0=this.a*mlfn(this.e0,this.e1,this.e2,this.e3,this.lat0);
}};exports.forward=function(p){var x,y;var lam=p.x;var phi=p.y;lam=adjust_lon(lam-this.long0);if(this.sphere){x=this.a*Math.asin(Math.cos(phi)*Math.sin(lam));
y=this.a*(Math.atan2(Math.tan(phi),Math.cos(lam))-this.lat0);}else{var sinphi=Math.sin(phi);var cosphi=Math.cos(phi);
var nl=gN(this.a,this.e,sinphi);var tl=Math.tan(phi)*Math.tan(phi);var al=lam*Math.cos(phi);var asq=al*al;
var cl=this.es*cosphi*cosphi/(1-this.es);var ml=this.a*mlfn(this.e0,this.e1,this.e2,this.e3,phi);x=nl*al*(1-asq*tl*(1/6-(8-tl+8*cl)*asq/120));
y=ml-this.ml0+nl*sinphi/cosphi*asq*(0.5+(5-tl+6*cl)*asq/24);}p.x=x+this.x0;p.y=y+this.y0;return p;};exports.inverse=function(p){p.x-=this.x0;
p.y-=this.y0;var x=p.x/this.a;var y=p.y/this.a;var phi,lam;if(this.sphere){var dd=y+this.lat0;phi=Math.asin(Math.sin(dd)*Math.cos(x));
lam=Math.atan2(Math.tan(x),Math.cos(dd));}else{var ml1=this.ml0/this.a+y;var phi1=imlfn(ml1,this.e0,this.e1,this.e2,this.e3);
if(Math.abs(Math.abs(phi1)-HALF_PI)<=EPSLN){p.x=this.long0;p.y=HALF_PI;if(y<0){p.y*=-1;}return p;}var nl1=gN(this.a,this.e,Math.sin(phi1));
var rl1=nl1*nl1*nl1/this.a/this.a*(1-this.es);var tl1=Math.pow(Math.tan(phi1),2);var dl=x*this.a/nl1;
var dsq=dl*dl;phi=phi1-nl1*Math.tan(phi1)/rl1*dl*dl*(0.5-(1+3*tl1)*dl*dl/24);lam=dl*(1-dsq*(tl1/3+(1+3*tl1)*tl1*dsq/15))/Math.cos(phi1);
}p.x=adjust_lon(lam+this.long0);p.y=adjust_lat(phi);return p;};exports.names=["Cassini","Cassini_Soldner","cass"];
},{"../common/adjust_lat":4,"../common/adjust_lon":5,"../common/e0fn":7,"../common/e1fn":8,"../common/e2fn":9,"../common/e3fn":10,"../common/gN":11,"../common/imlfn":12,"../common/mlfn":14}],42:[function(_dereq_,module,exports){var adjust_lon=_dereq_("../common/adjust_lon");
var qsfnz=_dereq_("../common/qsfnz");var msfnz=_dereq_("../common/msfnz");var iqsfnz=_dereq_("../common/iqsfnz");
exports.init=function(){if(!this.sphere){this.k0=msfnz(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts));
}};exports.forward=function(p){var lon=p.x;var lat=p.y;var x,y;var dlon=adjust_lon(lon-this.long0);if(this.sphere){x=this.x0+this.a*dlon*Math.cos(this.lat_ts);
y=this.y0+this.a*Math.sin(lat)/Math.cos(this.lat_ts);}else{var qs=qsfnz(this.e,Math.sin(lat));x=this.x0+this.a*this.k0*dlon;
y=this.y0+this.a*qs*0.5/this.k0;}p.x=x;p.y=y;return p;};exports.inverse=function(p){p.x-=this.x0;p.y-=this.y0;
var lon,lat;if(this.sphere){lon=adjust_lon(this.long0+(p.x/this.a)/Math.cos(this.lat_ts));lat=Math.asin((p.y/this.a)*Math.cos(this.lat_ts));
}else{lat=iqsfnz(this.e,2*p.y*this.k0/this.a);lon=adjust_lon(this.long0+p.x/(this.a*this.k0));}p.x=lon;
p.y=lat;return p;};exports.names=["cea"];},{"../common/adjust_lon":5,"../common/iqsfnz":13,"../common/msfnz":15,"../common/qsfnz":20}],43:[function(_dereq_,module,exports){var adjust_lon=_dereq_("../common/adjust_lon");
var adjust_lat=_dereq_("../common/adjust_lat");exports.init=function(){this.x0=this.x0||0;this.y0=this.y0||0;
this.lat0=this.lat0||0;this.long0=this.long0||0;this.lat_ts=this.lat_ts||0;this.title=this.title||"Equidistant Cylindrical (Plate Carre)";
this.rc=Math.cos(this.lat_ts);};exports.forward=function(p){var lon=p.x;var lat=p.y;var dlon=adjust_lon(lon-this.long0);
var dlat=adjust_lat(lat-this.lat0);p.x=this.x0+(this.a*dlon*this.rc);p.y=this.y0+(this.a*dlat);return p;
};exports.inverse=function(p){var x=p.x;var y=p.y;p.x=adjust_lon(this.long0+((x-this.x0)/(this.a*this.rc)));
p.y=adjust_lat(this.lat0+((y-this.y0)/(this.a)));return p;};exports.names=["Equirectangular","Equidistant_Cylindrical","eqc"];
},{"../common/adjust_lat":4,"../common/adjust_lon":5}],44:[function(_dereq_,module,exports){var e0fn=_dereq_("../common/e0fn");
var e1fn=_dereq_("../common/e1fn");var e2fn=_dereq_("../common/e2fn");var e3fn=_dereq_("../common/e3fn");
var msfnz=_dereq_("../common/msfnz");var mlfn=_dereq_("../common/mlfn");var adjust_lon=_dereq_("../common/adjust_lon");
var adjust_lat=_dereq_("../common/adjust_lat");var imlfn=_dereq_("../common/imlfn");var EPSLN=1e-10;exports.init=function(){if(Math.abs(this.lat1+this.lat2)<EPSLN){return;
}this.lat2=this.lat2||this.lat1;this.temp=this.b/this.a;this.es=1-Math.pow(this.temp,2);this.e=Math.sqrt(this.es);
this.e0=e0fn(this.es);this.e1=e1fn(this.es);this.e2=e2fn(this.es);this.e3=e3fn(this.es);this.sinphi=Math.sin(this.lat1);
this.cosphi=Math.cos(this.lat1);this.ms1=msfnz(this.e,this.sinphi,this.cosphi);this.ml1=mlfn(this.e0,this.e1,this.e2,this.e3,this.lat1);
if(Math.abs(this.lat1-this.lat2)<EPSLN){this.ns=this.sinphi;}else{this.sinphi=Math.sin(this.lat2);this.cosphi=Math.cos(this.lat2);
this.ms2=msfnz(this.e,this.sinphi,this.cosphi);this.ml2=mlfn(this.e0,this.e1,this.e2,this.e3,this.lat2);
this.ns=(this.ms1-this.ms2)/(this.ml2-this.ml1);}this.g=this.ml1+this.ms1/this.ns;this.ml0=mlfn(this.e0,this.e1,this.e2,this.e3,this.lat0);
this.rh=this.a*(this.g-this.ml0);};exports.forward=function(p){var lon=p.x;var lat=p.y;var rh1;if(this.sphere){rh1=this.a*(this.g-lat);
}else{var ml=mlfn(this.e0,this.e1,this.e2,this.e3,lat);rh1=this.a*(this.g-ml);}var theta=this.ns*adjust_lon(lon-this.long0);
var x=this.x0+rh1*Math.sin(theta);var y=this.y0+this.rh-rh1*Math.cos(theta);p.x=x;p.y=y;return p;};exports.inverse=function(p){p.x-=this.x0;
p.y=this.rh-p.y+this.y0;var con,rh1,lat,lon;if(this.ns>=0){rh1=Math.sqrt(p.x*p.x+p.y*p.y);con=1;}else{rh1=-Math.sqrt(p.x*p.x+p.y*p.y);
con=-1;}var theta=0;if(rh1!==0){theta=Math.atan2(con*p.x,con*p.y);}if(this.sphere){lon=adjust_lon(this.long0+theta/this.ns);
lat=adjust_lat(this.g-rh1/this.a);p.x=lon;p.y=lat;return p;}else{var ml=this.g-rh1/this.a;lat=imlfn(ml,this.e0,this.e1,this.e2,this.e3);
lon=adjust_lon(this.long0+theta/this.ns);p.x=lon;p.y=lat;return p;}};exports.names=["Equidistant_Conic","eqdc"];
},{"../common/adjust_lat":4,"../common/adjust_lon":5,"../common/e0fn":7,"../common/e1fn":8,"../common/e2fn":9,"../common/e3fn":10,"../common/imlfn":12,"../common/mlfn":14,"../common/msfnz":15}],45:[function(_dereq_,module,exports){var FORTPI=Math.PI/4;
var srat=_dereq_("../common/srat");var HALF_PI=Math.PI/2;var MAX_ITER=20;exports.init=function(){var sphi=Math.sin(this.lat0);
var cphi=Math.cos(this.lat0);cphi*=cphi;this.rc=Math.sqrt(1-this.es)/(1-this.es*sphi*sphi);this.C=Math.sqrt(1+this.es*cphi*cphi/(1-this.es));
this.phic0=Math.asin(sphi/this.C);this.ratexp=0.5*this.C*this.e;this.K=Math.tan(0.5*this.phic0+FORTPI)/(Math.pow(Math.tan(0.5*this.lat0+FORTPI),this.C)*srat(this.e*sphi,this.ratexp));
};exports.forward=function(p){var lon=p.x;var lat=p.y;p.y=2*Math.atan(this.K*Math.pow(Math.tan(0.5*lat+FORTPI),this.C)*srat(this.e*Math.sin(lat),this.ratexp))-HALF_PI;
p.x=this.C*lon;return p;};exports.inverse=function(p){var DEL_TOL=1e-14;var lon=p.x/this.C;var lat=p.y;
var num=Math.pow(Math.tan(0.5*lat+FORTPI)/this.K,1/this.C);for(var i=MAX_ITER;i>0;--i){lat=2*Math.atan(num*srat(this.e*Math.sin(p.y),-0.5*this.e))-HALF_PI;
if(Math.abs(lat-p.y)<DEL_TOL){break;}p.y=lat;}if(!i){return null;}p.x=lon;p.y=lat;return p;};exports.names=["gauss"];
},{"../common/srat":22}],46:[function(_dereq_,module,exports){var adjust_lon=_dereq_("../common/adjust_lon");
var EPSLN=1e-10;var asinz=_dereq_("../common/asinz");exports.init=function(){this.sin_p14=Math.sin(this.lat0);
this.cos_p14=Math.cos(this.lat0);this.infinity_dist=1000*this.a;this.rc=1;};exports.forward=function(p){var sinphi,cosphi;
var dlon;var coslon;var ksp;var g;var x,y;var lon=p.x;var lat=p.y;dlon=adjust_lon(lon-this.long0);sinphi=Math.sin(lat);
cosphi=Math.cos(lat);coslon=Math.cos(dlon);g=this.sin_p14*sinphi+this.cos_p14*cosphi*coslon;ksp=1;if((g>0)||(Math.abs(g)<=EPSLN)){x=this.x0+this.a*ksp*cosphi*Math.sin(dlon)/g;
y=this.y0+this.a*ksp*(this.cos_p14*sinphi-this.sin_p14*cosphi*coslon)/g;}else{x=this.x0+this.infinity_dist*cosphi*Math.sin(dlon);
y=this.y0+this.infinity_dist*(this.cos_p14*sinphi-this.sin_p14*cosphi*coslon);}p.x=x;p.y=y;return p;};
exports.inverse=function(p){var rh;var sinc,cosc;var c;var lon,lat;p.x=(p.x-this.x0)/this.a;p.y=(p.y-this.y0)/this.a;
p.x/=this.k0;p.y/=this.k0;if((rh=Math.sqrt(p.x*p.x+p.y*p.y))){c=Math.atan2(rh,this.rc);sinc=Math.sin(c);
cosc=Math.cos(c);lat=asinz(cosc*this.sin_p14+(p.y*sinc*this.cos_p14)/rh);lon=Math.atan2(p.x*sinc,rh*this.cos_p14*cosc-p.y*this.sin_p14*sinc);
lon=adjust_lon(this.long0+lon);}else{lat=this.phic0;lon=0;}p.x=lon;p.y=lat;return p;};exports.names=["gnom"];
},{"../common/adjust_lon":5,"../common/asinz":6}],47:[function(_dereq_,module,exports){var adjust_lon=_dereq_("../common/adjust_lon");
exports.init=function(){this.a=6377397.155;this.es=0.006674372230614;this.e=Math.sqrt(this.es);if(!this.lat0){this.lat0=0.863937979737193;
}if(!this.long0){this.long0=0.7417649320975901-0.308341501185665;}if(!this.k0){this.k0=0.9999;}this.s45=0.785398163397448;
this.s90=2*this.s45;this.fi0=this.lat0;this.e2=this.es;this.e=Math.sqrt(this.e2);this.alfa=Math.sqrt(1+(this.e2*Math.pow(Math.cos(this.fi0),4))/(1-this.e2));
this.uq=1.04216856380474;this.u0=Math.asin(Math.sin(this.fi0)/this.alfa);this.g=Math.pow((1+this.e*Math.sin(this.fi0))/(1-this.e*Math.sin(this.fi0)),this.alfa*this.e/2);
this.k=Math.tan(this.u0/2+this.s45)/Math.pow(Math.tan(this.fi0/2+this.s45),this.alfa)*this.g;this.k1=this.k0;
this.n0=this.a*Math.sqrt(1-this.e2)/(1-this.e2*Math.pow(Math.sin(this.fi0),2));this.s0=1.37008346281555;
this.n=Math.sin(this.s0);this.ro0=this.k1*this.n0/Math.tan(this.s0);this.ad=this.s90-this.uq;};exports.forward=function(p){var gfi,u,deltav,s,d,eps,ro;
var lon=p.x;var lat=p.y;var delta_lon=adjust_lon(lon-this.long0);gfi=Math.pow(((1+this.e*Math.sin(lat))/(1-this.e*Math.sin(lat))),(this.alfa*this.e/2));
u=2*(Math.atan(this.k*Math.pow(Math.tan(lat/2+this.s45),this.alfa)/gfi)-this.s45);deltav=-delta_lon*this.alfa;
s=Math.asin(Math.cos(this.ad)*Math.sin(u)+Math.sin(this.ad)*Math.cos(u)*Math.cos(deltav));d=Math.asin(Math.cos(u)*Math.sin(deltav)/Math.cos(s));
eps=this.n*d;ro=this.ro0*Math.pow(Math.tan(this.s0/2+this.s45),this.n)/Math.pow(Math.tan(s/2+this.s45),this.n);
p.y=ro*Math.cos(eps)/1;p.x=ro*Math.sin(eps)/1;if(!this.czech){p.y*=-1;p.x*=-1;}return(p);};exports.inverse=function(p){var u,deltav,s,d,eps,ro,fi1;
var ok;var tmp=p.x;p.x=p.y;p.y=tmp;if(!this.czech){p.y*=-1;p.x*=-1;}ro=Math.sqrt(p.x*p.x+p.y*p.y);eps=Math.atan2(p.y,p.x);
d=eps/Math.sin(this.s0);s=2*(Math.atan(Math.pow(this.ro0/ro,1/this.n)*Math.tan(this.s0/2+this.s45))-this.s45);
u=Math.asin(Math.cos(this.ad)*Math.sin(s)-Math.sin(this.ad)*Math.cos(s)*Math.cos(d));deltav=Math.asin(Math.cos(s)*Math.sin(d)/Math.cos(u));
p.x=this.long0-deltav/this.alfa;fi1=u;ok=0;var iter=0;do{p.y=2*(Math.atan(Math.pow(this.k,-1/this.alfa)*Math.pow(Math.tan(u/2+this.s45),1/this.alfa)*Math.pow((1+this.e*Math.sin(fi1))/(1-this.e*Math.sin(fi1)),this.e/2))-this.s45);
if(Math.abs(fi1-p.y)<1e-10){ok=1;}fi1=p.y;iter+=1;}while(ok===0&&iter<15);if(iter>=15){return null;}return(p);
};exports.names=["Krovak","krovak"];},{"../common/adjust_lon":5}],48:[function(_dereq_,module,exports){var HALF_PI=Math.PI/2;
var FORTPI=Math.PI/4;var EPSLN=1e-10;var qsfnz=_dereq_("../common/qsfnz");var adjust_lon=_dereq_("../common/adjust_lon");
exports.S_POLE=1;exports.N_POLE=2;exports.EQUIT=3;exports.OBLIQ=4;exports.init=function(){var t=Math.abs(this.lat0);
if(Math.abs(t-HALF_PI)<EPSLN){this.mode=this.lat0<0?this.S_POLE:this.N_POLE;}else{if(Math.abs(t)<EPSLN){this.mode=this.EQUIT;
}else{this.mode=this.OBLIQ;}}if(this.es>0){var sinphi;this.qp=qsfnz(this.e,1);this.mmf=0.5/(1-this.es);
this.apa=this.authset(this.es);switch(this.mode){case this.N_POLE:this.dd=1;break;case this.S_POLE:this.dd=1;
break;case this.EQUIT:this.rq=Math.sqrt(0.5*this.qp);this.dd=1/this.rq;this.xmf=1;this.ymf=0.5*this.qp;
break;case this.OBLIQ:this.rq=Math.sqrt(0.5*this.qp);sinphi=Math.sin(this.lat0);this.sinb1=qsfnz(this.e,sinphi)/this.qp;
this.cosb1=Math.sqrt(1-this.sinb1*this.sinb1);this.dd=Math.cos(this.lat0)/(Math.sqrt(1-this.es*sinphi*sinphi)*this.rq*this.cosb1);
this.ymf=(this.xmf=this.rq)/this.dd;this.xmf*=this.dd;break;}}else{if(this.mode===this.OBLIQ){this.sinph0=Math.sin(this.lat0);
this.cosph0=Math.cos(this.lat0);}}};exports.forward=function(p){var x,y,coslam,sinlam,sinphi,q,sinb,cosb,b,cosphi;
var lam=p.x;var phi=p.y;lam=adjust_lon(lam-this.long0);if(this.sphere){sinphi=Math.sin(phi);cosphi=Math.cos(phi);
coslam=Math.cos(lam);if(this.mode===this.OBLIQ||this.mode===this.EQUIT){y=(this.mode===this.EQUIT)?1+cosphi*coslam:1+this.sinph0*sinphi+this.cosph0*cosphi*coslam;
if(y<=EPSLN){return null;}y=Math.sqrt(2/y);x=y*cosphi*Math.sin(lam);y*=(this.mode===this.EQUIT)?sinphi:this.cosph0*sinphi-this.sinph0*cosphi*coslam;
}else{if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE){coslam=-coslam;
}if(Math.abs(phi+this.phi0)<EPSLN){return null;}y=FORTPI-phi*0.5;y=2*((this.mode===this.S_POLE)?Math.cos(y):Math.sin(y));
x=y*Math.sin(lam);y*=coslam;}}}else{sinb=0;cosb=0;b=0;coslam=Math.cos(lam);sinlam=Math.sin(lam);sinphi=Math.sin(phi);
q=qsfnz(this.e,sinphi);if(this.mode===this.OBLIQ||this.mode===this.EQUIT){sinb=q/this.qp;cosb=Math.sqrt(1-sinb*sinb);
}switch(this.mode){case this.OBLIQ:b=1+this.sinb1*sinb+this.cosb1*cosb*coslam;break;case this.EQUIT:b=1+cosb*coslam;
break;case this.N_POLE:b=HALF_PI+phi;q=this.qp-q;break;case this.S_POLE:b=phi-HALF_PI;q=this.qp+q;break;
}if(Math.abs(b)<EPSLN){return null;}switch(this.mode){case this.OBLIQ:case this.EQUIT:b=Math.sqrt(2/b);
if(this.mode===this.OBLIQ){y=this.ymf*b*(this.cosb1*sinb-this.sinb1*cosb*coslam);}else{y=(b=Math.sqrt(2/(1+cosb*coslam)))*sinb*this.ymf;
}x=this.xmf*b*cosb*sinlam;break;case this.N_POLE:case this.S_POLE:if(q>=0){x=(b=Math.sqrt(q))*sinlam;
y=coslam*((this.mode===this.S_POLE)?b:-b);}else{x=y=0;}break;}}p.x=this.a*x+this.x0;p.y=this.a*y+this.y0;
return p;};exports.inverse=function(p){p.x-=this.x0;p.y-=this.y0;var x=p.x/this.a;var y=p.y/this.a;var lam,phi,cCe,sCe,q,rho,ab;
if(this.sphere){var cosz=0,rh,sinz=0;rh=Math.sqrt(x*x+y*y);phi=rh*0.5;if(phi>1){return null;}phi=2*Math.asin(phi);
if(this.mode===this.OBLIQ||this.mode===this.EQUIT){sinz=Math.sin(phi);cosz=Math.cos(phi);}switch(this.mode){case this.EQUIT:phi=(Math.abs(rh)<=EPSLN)?0:Math.asin(y*sinz/rh);
x*=sinz;y=cosz*rh;break;case this.OBLIQ:phi=(Math.abs(rh)<=EPSLN)?this.phi0:Math.asin(cosz*this.sinph0+y*sinz*this.cosph0/rh);
x*=sinz*this.cosph0;y=(cosz-Math.sin(phi)*this.sinph0)*rh;break;case this.N_POLE:y=-y;phi=HALF_PI-phi;
break;case this.S_POLE:phi-=HALF_PI;break;}lam=(y===0&&(this.mode===this.EQUIT||this.mode===this.OBLIQ))?0:Math.atan2(x,y);
}else{ab=0;if(this.mode===this.OBLIQ||this.mode===this.EQUIT){x/=this.dd;y*=this.dd;rho=Math.sqrt(x*x+y*y);
if(rho<EPSLN){p.x=0;p.y=this.phi0;return p;}sCe=2*Math.asin(0.5*rho/this.rq);cCe=Math.cos(sCe);x*=(sCe=Math.sin(sCe));
if(this.mode===this.OBLIQ){ab=cCe*this.sinb1+y*sCe*this.cosb1/rho;q=this.qp*ab;y=rho*this.cosb1*cCe-y*this.sinb1*sCe;
}else{ab=y*sCe/rho;q=this.qp*ab;y=rho*cCe;}}else{if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE){y=-y;
}q=(x*x+y*y);if(!q){p.x=0;p.y=this.phi0;return p;}ab=1-q/this.qp;if(this.mode===this.S_POLE){ab=-ab;}}}lam=Math.atan2(x,y);
phi=this.authlat(Math.asin(ab),this.apa);}p.x=adjust_lon(this.long0+lam);p.y=phi;return p;};exports.P00=0.3333333333333333;
exports.P01=0.17222222222222222;exports.P02=0.10257936507936508;exports.P10=0.06388888888888888;exports.P11=0.0664021164021164;
exports.P20=0.016415012942191543;exports.authset=function(es){var t;var APA=[];APA[0]=es*this.P00;t=es*es;
APA[0]+=t*this.P01;APA[1]=t*this.P10;t*=es;APA[0]+=t*this.P02;APA[1]+=t*this.P11;APA[2]=t*this.P20;return APA;
};exports.authlat=function(beta,APA){var t=beta+beta;return(beta+APA[0]*Math.sin(t)+APA[1]*Math.sin(t+t)+APA[2]*Math.sin(t+t+t));
};exports.names=["Lambert Azimuthal Equal Area","Lambert_Azimuthal_Equal_Area","laea"];},{"../common/adjust_lon":5,"../common/qsfnz":20}],49:[function(_dereq_,module,exports){var EPSLN=1e-10;
var msfnz=_dereq_("../common/msfnz");var tsfnz=_dereq_("../common/tsfnz");var HALF_PI=Math.PI/2;var sign=_dereq_("../common/sign");
var adjust_lon=_dereq_("../common/adjust_lon");var phi2z=_dereq_("../common/phi2z");exports.init=function(){if(!this.lat2){this.lat2=this.lat1;
}if(!this.k0){this.k0=1;}this.x0=this.x0||0;this.y0=this.y0||0;if(Math.abs(this.lat1+this.lat2)<EPSLN){return;
}var temp=this.b/this.a;this.e=Math.sqrt(1-temp*temp);var sin1=Math.sin(this.lat1);var cos1=Math.cos(this.lat1);
var ms1=msfnz(this.e,sin1,cos1);var ts1=tsfnz(this.e,this.lat1,sin1);var sin2=Math.sin(this.lat2);var cos2=Math.cos(this.lat2);
var ms2=msfnz(this.e,sin2,cos2);var ts2=tsfnz(this.e,this.lat2,sin2);var ts0=tsfnz(this.e,this.lat0,Math.sin(this.lat0));
if(Math.abs(this.lat1-this.lat2)>EPSLN){this.ns=Math.log(ms1/ms2)/Math.log(ts1/ts2);}else{this.ns=sin1;
}if(isNaN(this.ns)){this.ns=sin1;}this.f0=ms1/(this.ns*Math.pow(ts1,this.ns));this.rh=this.a*this.f0*Math.pow(ts0,this.ns);
if(!this.title){this.title="Lambert Conformal Conic";}};exports.forward=function(p){var lon=p.x;var lat=p.y;
if(Math.abs(2*Math.abs(lat)-Math.PI)<=EPSLN){lat=sign(lat)*(HALF_PI-2*EPSLN);}var con=Math.abs(Math.abs(lat)-HALF_PI);
var ts,rh1;if(con>EPSLN){ts=tsfnz(this.e,lat,Math.sin(lat));rh1=this.a*this.f0*Math.pow(ts,this.ns);}else{con=lat*this.ns;
if(con<=0){return null;}rh1=0;}var theta=this.ns*adjust_lon(lon-this.long0);p.x=this.k0*(rh1*Math.sin(theta))+this.x0;
p.y=this.k0*(this.rh-rh1*Math.cos(theta))+this.y0;return p;};exports.inverse=function(p){var rh1,con,ts;
var lat,lon;var x=(p.x-this.x0)/this.k0;var y=(this.rh-(p.y-this.y0)/this.k0);if(this.ns>0){rh1=Math.sqrt(x*x+y*y);
con=1;}else{rh1=-Math.sqrt(x*x+y*y);con=-1;}var theta=0;if(rh1!==0){theta=Math.atan2((con*x),(con*y));
}if((rh1!==0)||(this.ns>0)){con=1/this.ns;ts=Math.pow((rh1/(this.a*this.f0)),con);lat=phi2z(this.e,ts);
if(lat===-9999){return null;}}else{lat=-HALF_PI;}lon=adjust_lon(theta/this.ns+this.long0);p.x=lon;p.y=lat;
return p;};exports.names=["Lambert Tangential Conformal Conic Projection","Lambert_Conformal_Conic","Lambert_Conformal_Conic_2SP","lcc"];
},{"../common/adjust_lon":5,"../common/msfnz":15,"../common/phi2z":16,"../common/sign":21,"../common/tsfnz":24}],50:[function(_dereq_,module,exports){exports.init=function(){};
function identity(pt){return pt;}exports.forward=identity;exports.inverse=identity;exports.names=["longlat","identity"];
},{}],51:[function(_dereq_,module,exports){var msfnz=_dereq_("../common/msfnz");var HALF_PI=Math.PI/2;
var EPSLN=1e-10;var R2D=57.29577951308232;var adjust_lon=_dereq_("../common/adjust_lon");var FORTPI=Math.PI/4;
var tsfnz=_dereq_("../common/tsfnz");var phi2z=_dereq_("../common/phi2z");exports.init=function(){var con=this.b/this.a;
this.es=1-con*con;if(!("x0" in this)){this.x0=0;}if(!("y0" in this)){this.y0=0;}this.e=Math.sqrt(this.es);
if(this.lat_ts){if(this.sphere){this.k0=Math.cos(this.lat_ts);}else{this.k0=msfnz(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts));
}}else{if(!this.k0){if(this.k){this.k0=this.k;}else{this.k0=1;}}}};exports.forward=function(p){var lon=p.x;
var lat=p.y;if(lat*R2D>90&&lat*R2D<-90&&lon*R2D>180&&lon*R2D<-180){return null;}var x,y;if(Math.abs(Math.abs(lat)-HALF_PI)<=EPSLN){return null;
}else{if(this.sphere){x=this.x0+this.a*this.k0*adjust_lon(lon-this.long0);y=this.y0+this.a*this.k0*Math.log(Math.tan(FORTPI+0.5*lat));
}else{var sinphi=Math.sin(lat);var ts=tsfnz(this.e,lat,sinphi);x=this.x0+this.a*this.k0*adjust_lon(lon-this.long0);
y=this.y0-this.a*this.k0*Math.log(ts);}p.x=x;p.y=y;return p;}};exports.inverse=function(p){var x=p.x-this.x0;
var y=p.y-this.y0;var lon,lat;if(this.sphere){lat=HALF_PI-2*Math.atan(Math.exp(-y/(this.a*this.k0)));
}else{var ts=Math.exp(-y/(this.a*this.k0));lat=phi2z(this.e,ts);if(lat===-9999){return null;}}lon=adjust_lon(this.long0+x/(this.a*this.k0));
p.x=lon;p.y=lat;return p;};exports.names=["Mercator","Popular Visualisation Pseudo Mercator","Mercator_1SP","Mercator_Auxiliary_Sphere","merc"];
},{"../common/adjust_lon":5,"../common/msfnz":15,"../common/phi2z":16,"../common/tsfnz":24}],52:[function(_dereq_,module,exports){var adjust_lon=_dereq_("../common/adjust_lon");
exports.init=function(){};exports.forward=function(p){var lon=p.x;var lat=p.y;var dlon=adjust_lon(lon-this.long0);
var x=this.x0+this.a*dlon;var y=this.y0+this.a*Math.log(Math.tan((Math.PI/4)+(lat/2.5)))*1.25;p.x=x;p.y=y;
return p;};exports.inverse=function(p){p.x-=this.x0;p.y-=this.y0;var lon=adjust_lon(this.long0+p.x/this.a);
var lat=2.5*(Math.atan(Math.exp(0.8*p.y/this.a))-Math.PI/4);p.x=lon;p.y=lat;return p;};exports.names=["Miller_Cylindrical","mill"];
},{"../common/adjust_lon":5}],53:[function(_dereq_,module,exports){var adjust_lon=_dereq_("../common/adjust_lon");
var EPSLN=1e-10;exports.init=function(){};exports.forward=function(p){var lon=p.x;var lat=p.y;var delta_lon=adjust_lon(lon-this.long0);
var theta=lat;var con=Math.PI*Math.sin(lat);for(var i=0;true;i++){var delta_theta=-(theta+Math.sin(theta)-con)/(1+Math.cos(theta));
theta+=delta_theta;if(Math.abs(delta_theta)<EPSLN){break;}}theta/=2;if(Math.PI/2-Math.abs(lat)<EPSLN){delta_lon=0;
}var x=0.900316316158*this.a*delta_lon*Math.cos(theta)+this.x0;var y=1.4142135623731*this.a*Math.sin(theta)+this.y0;
p.x=x;p.y=y;return p;};exports.inverse=function(p){var theta;var arg;p.x-=this.x0;p.y-=this.y0;arg=p.y/(1.4142135623731*this.a);
if(Math.abs(arg)>0.999999999999){arg=0.999999999999;}theta=Math.asin(arg);var lon=adjust_lon(this.long0+(p.x/(0.900316316158*this.a*Math.cos(theta))));
if(lon<(-Math.PI)){lon=-Math.PI;}if(lon>Math.PI){lon=Math.PI;}arg=(2*theta+Math.sin(2*theta))/Math.PI;
if(Math.abs(arg)>1){arg=1;}var lat=Math.asin(arg);p.x=lon;p.y=lat;return p;};exports.names=["Mollweide","moll"];
},{"../common/adjust_lon":5}],54:[function(_dereq_,module,exports){var SEC_TO_RAD=0.00000484813681109536;
exports.iterations=1;exports.init=function(){this.A=[];this.A[1]=0.6399175073;this.A[2]=-0.1358797613;
this.A[3]=0.063294409;this.A[4]=-0.02526853;this.A[5]=0.0117879;this.A[6]=-0.0055161;this.A[7]=0.0026906;
this.A[8]=-0.001333;this.A[9]=0.00067;this.A[10]=-0.00034;this.B_re=[];this.B_im=[];this.B_re[1]=0.7557853228;
this.B_im[1]=0;this.B_re[2]=0.249204646;this.B_im[2]=0.003371507;this.B_re[3]=-0.001541739;this.B_im[3]=0.04105856;
this.B_re[4]=-0.10162907;this.B_im[4]=0.01727609;this.B_re[5]=-0.26623489;this.B_im[5]=-0.36249218;this.B_re[6]=-0.6870983;
this.B_im[6]=-1.1651967;this.C_re=[];this.C_im=[];this.C_re[1]=1.3231270439;this.C_im[1]=0;this.C_re[2]=-0.577245789;
this.C_im[2]=-0.007809598;this.C_re[3]=0.508307513;this.C_im[3]=-0.112208952;this.C_re[4]=-0.15094762;
this.C_im[4]=0.18200602;this.C_re[5]=1.01418179;this.C_im[5]=1.64497696;this.C_re[6]=1.9660549;this.C_im[6]=2.5127645;
this.D=[];this.D[1]=1.5627014243;this.D[2]=0.5185406398;this.D[3]=-0.03333098;this.D[4]=-0.1052906;this.D[5]=-0.0368594;
this.D[6]=0.007317;this.D[7]=0.0122;this.D[8]=0.00394;this.D[9]=-0.0013;};exports.forward=function(p){var n;
var lon=p.x;var lat=p.y;var delta_lat=lat-this.lat0;var delta_lon=lon-this.long0;var d_phi=delta_lat/SEC_TO_RAD*0.00001;
var d_lambda=delta_lon;var d_phi_n=1;var d_psi=0;for(n=1;n<=10;n++){d_phi_n=d_phi_n*d_phi;d_psi=d_psi+this.A[n]*d_phi_n;
}var th_re=d_psi;var th_im=d_lambda;var th_n_re=1;var th_n_im=0;var th_n_re1;var th_n_im1;var z_re=0;
var z_im=0;for(n=1;n<=6;n++){th_n_re1=th_n_re*th_re-th_n_im*th_im;th_n_im1=th_n_im*th_re+th_n_re*th_im;
th_n_re=th_n_re1;th_n_im=th_n_im1;z_re=z_re+this.B_re[n]*th_n_re-this.B_im[n]*th_n_im;z_im=z_im+this.B_im[n]*th_n_re+this.B_re[n]*th_n_im;
}p.x=(z_im*this.a)+this.x0;p.y=(z_re*this.a)+this.y0;return p;};exports.inverse=function(p){var n;var x=p.x;
var y=p.y;var delta_x=x-this.x0;var delta_y=y-this.y0;var z_re=delta_y/this.a;var z_im=delta_x/this.a;
var z_n_re=1;var z_n_im=0;var z_n_re1;var z_n_im1;var th_re=0;var th_im=0;for(n=1;n<=6;n++){z_n_re1=z_n_re*z_re-z_n_im*z_im;
z_n_im1=z_n_im*z_re+z_n_re*z_im;z_n_re=z_n_re1;z_n_im=z_n_im1;th_re=th_re+this.C_re[n]*z_n_re-this.C_im[n]*z_n_im;
th_im=th_im+this.C_im[n]*z_n_re+this.C_re[n]*z_n_im;}for(var i=0;i<this.iterations;i++){var th_n_re=th_re;
var th_n_im=th_im;var th_n_re1;var th_n_im1;var num_re=z_re;var num_im=z_im;for(n=2;n<=6;n++){th_n_re1=th_n_re*th_re-th_n_im*th_im;
th_n_im1=th_n_im*th_re+th_n_re*th_im;th_n_re=th_n_re1;th_n_im=th_n_im1;num_re=num_re+(n-1)*(this.B_re[n]*th_n_re-this.B_im[n]*th_n_im);
num_im=num_im+(n-1)*(this.B_im[n]*th_n_re+this.B_re[n]*th_n_im);}th_n_re=1;th_n_im=0;var den_re=this.B_re[1];
var den_im=this.B_im[1];for(n=2;n<=6;n++){th_n_re1=th_n_re*th_re-th_n_im*th_im;th_n_im1=th_n_im*th_re+th_n_re*th_im;
th_n_re=th_n_re1;th_n_im=th_n_im1;den_re=den_re+n*(this.B_re[n]*th_n_re-this.B_im[n]*th_n_im);den_im=den_im+n*(this.B_im[n]*th_n_re+this.B_re[n]*th_n_im);
}var den2=den_re*den_re+den_im*den_im;th_re=(num_re*den_re+num_im*den_im)/den2;th_im=(num_im*den_re-num_re*den_im)/den2;
}var d_psi=th_re;var d_lambda=th_im;var d_psi_n=1;var d_phi=0;for(n=1;n<=9;n++){d_psi_n=d_psi_n*d_psi;
d_phi=d_phi+this.D[n]*d_psi_n;}var lat=this.lat0+(d_phi*SEC_TO_RAD*100000);var lon=this.long0+d_lambda;
p.x=lon;p.y=lat;return p;};exports.names=["New_Zealand_Map_Grid","nzmg"];},{}],55:[function(_dereq_,module,exports){var tsfnz=_dereq_("../common/tsfnz");
var adjust_lon=_dereq_("../common/adjust_lon");var phi2z=_dereq_("../common/phi2z");var HALF_PI=Math.PI/2;
var FORTPI=Math.PI/4;var EPSLN=1e-10;exports.init=function(){this.no_off=this.no_off||false;this.no_rot=this.no_rot||false;
if(isNaN(this.k0)){this.k0=1;}var sinlat=Math.sin(this.lat0);var coslat=Math.cos(this.lat0);var con=this.e*sinlat;
this.bl=Math.sqrt(1+this.es/(1-this.es)*Math.pow(coslat,4));this.al=this.a*this.bl*this.k0*Math.sqrt(1-this.es)/(1-con*con);
var t0=tsfnz(this.e,this.lat0,sinlat);var dl=this.bl/coslat*Math.sqrt((1-this.es)/(1-con*con));if(dl*dl<1){dl=1;
}var fl;var gl;if(!isNaN(this.longc)){if(this.lat0>=0){fl=dl+Math.sqrt(dl*dl-1);}else{fl=dl-Math.sqrt(dl*dl-1);
}this.el=fl*Math.pow(t0,this.bl);gl=0.5*(fl-1/fl);this.gamma0=Math.asin(Math.sin(this.alpha)/dl);this.long0=this.longc-Math.asin(gl*Math.tan(this.gamma0))/this.bl;
}else{var t1=tsfnz(this.e,this.lat1,Math.sin(this.lat1));var t2=tsfnz(this.e,this.lat2,Math.sin(this.lat2));
if(this.lat0>=0){this.el=(dl+Math.sqrt(dl*dl-1))*Math.pow(t0,this.bl);}else{this.el=(dl-Math.sqrt(dl*dl-1))*Math.pow(t0,this.bl);
}var hl=Math.pow(t1,this.bl);var ll=Math.pow(t2,this.bl);fl=this.el/hl;gl=0.5*(fl-1/fl);var jl=(this.el*this.el-ll*hl)/(this.el*this.el+ll*hl);
var pl=(ll-hl)/(ll+hl);var dlon12=adjust_lon(this.long1-this.long2);this.long0=0.5*(this.long1+this.long2)-Math.atan(jl*Math.tan(0.5*this.bl*(dlon12))/pl)/this.bl;
this.long0=adjust_lon(this.long0);var dlon10=adjust_lon(this.long1-this.long0);this.gamma0=Math.atan(Math.sin(this.bl*(dlon10))/gl);
this.alpha=Math.asin(dl*Math.sin(this.gamma0));}if(this.no_off){this.uc=0;}else{if(this.lat0>=0){this.uc=this.al/this.bl*Math.atan2(Math.sqrt(dl*dl-1),Math.cos(this.alpha));
}else{this.uc=-1*this.al/this.bl*Math.atan2(Math.sqrt(dl*dl-1),Math.cos(this.alpha));}}};exports.forward=function(p){var lon=p.x;
var lat=p.y;var dlon=adjust_lon(lon-this.long0);var us,vs;var con;if(Math.abs(Math.abs(lat)-HALF_PI)<=EPSLN){if(lat>0){con=-1;
}else{con=1;}vs=this.al/this.bl*Math.log(Math.tan(FORTPI+con*this.gamma0*0.5));us=-1*con*HALF_PI*this.al/this.bl;
}else{var t=tsfnz(this.e,lat,Math.sin(lat));var ql=this.el/Math.pow(t,this.bl);var sl=0.5*(ql-1/ql);var tl=0.5*(ql+1/ql);
var vl=Math.sin(this.bl*(dlon));var ul=(sl*Math.sin(this.gamma0)-vl*Math.cos(this.gamma0))/tl;if(Math.abs(Math.abs(ul)-1)<=EPSLN){vs=Number.POSITIVE_INFINITY;
}else{vs=0.5*this.al*Math.log((1-ul)/(1+ul))/this.bl;}if(Math.abs(Math.cos(this.bl*(dlon)))<=EPSLN){us=this.al*this.bl*(dlon);
}else{us=this.al*Math.atan2(sl*Math.cos(this.gamma0)+vl*Math.sin(this.gamma0),Math.cos(this.bl*dlon))/this.bl;
}}if(this.no_rot){p.x=this.x0+us;p.y=this.y0+vs;}else{us-=this.uc;p.x=this.x0+vs*Math.cos(this.alpha)+us*Math.sin(this.alpha);
p.y=this.y0+us*Math.cos(this.alpha)-vs*Math.sin(this.alpha);}return p;};exports.inverse=function(p){var us,vs;
if(this.no_rot){vs=p.y-this.y0;us=p.x-this.x0;}else{vs=(p.x-this.x0)*Math.cos(this.alpha)-(p.y-this.y0)*Math.sin(this.alpha);
us=(p.y-this.y0)*Math.cos(this.alpha)+(p.x-this.x0)*Math.sin(this.alpha);us+=this.uc;}var qp=Math.exp(-1*this.bl*vs/this.al);
var sp=0.5*(qp-1/qp);var tp=0.5*(qp+1/qp);var vp=Math.sin(this.bl*us/this.al);var up=(vp*Math.cos(this.gamma0)+sp*Math.sin(this.gamma0))/tp;
var ts=Math.pow(this.el/Math.sqrt((1+up)/(1-up)),1/this.bl);if(Math.abs(up-1)<EPSLN){p.x=this.long0;p.y=HALF_PI;
}else{if(Math.abs(up+1)<EPSLN){p.x=this.long0;p.y=-1*HALF_PI;}else{p.y=phi2z(this.e,ts);p.x=adjust_lon(this.long0-Math.atan2(sp*Math.cos(this.gamma0)-vp*Math.sin(this.gamma0),Math.cos(this.bl*us/this.al))/this.bl);
}}return p;};exports.names=["Hotine_Oblique_Mercator","Hotine Oblique Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin","Hotine_Oblique_Mercator_Azimuth_Center","omerc"];
},{"../common/adjust_lon":5,"../common/phi2z":16,"../common/tsfnz":24}],56:[function(_dereq_,module,exports){var e0fn=_dereq_("../common/e0fn");
var e1fn=_dereq_("../common/e1fn");var e2fn=_dereq_("../common/e2fn");var e3fn=_dereq_("../common/e3fn");
var adjust_lon=_dereq_("../common/adjust_lon");var adjust_lat=_dereq_("../common/adjust_lat");var mlfn=_dereq_("../common/mlfn");
var EPSLN=1e-10;var gN=_dereq_("../common/gN");var MAX_ITER=20;exports.init=function(){this.temp=this.b/this.a;
this.es=1-Math.pow(this.temp,2);this.e=Math.sqrt(this.es);this.e0=e0fn(this.es);this.e1=e1fn(this.es);
this.e2=e2fn(this.es);this.e3=e3fn(this.es);this.ml0=this.a*mlfn(this.e0,this.e1,this.e2,this.e3,this.lat0);
};exports.forward=function(p){var lon=p.x;var lat=p.y;var x,y,el;var dlon=adjust_lon(lon-this.long0);
el=dlon*Math.sin(lat);if(this.sphere){if(Math.abs(lat)<=EPSLN){x=this.a*dlon;y=-1*this.a*this.lat0;}else{x=this.a*Math.sin(el)/Math.tan(lat);
y=this.a*(adjust_lat(lat-this.lat0)+(1-Math.cos(el))/Math.tan(lat));}}else{if(Math.abs(lat)<=EPSLN){x=this.a*dlon;
y=-1*this.ml0;}else{var nl=gN(this.a,this.e,Math.sin(lat))/Math.tan(lat);x=nl*Math.sin(el);y=this.a*mlfn(this.e0,this.e1,this.e2,this.e3,lat)-this.ml0+nl*(1-Math.cos(el));
}}p.x=x+this.x0;p.y=y+this.y0;return p;};exports.inverse=function(p){var lon,lat,x,y,i;var al,bl;var phi,dphi;
x=p.x-this.x0;y=p.y-this.y0;if(this.sphere){if(Math.abs(y+this.a*this.lat0)<=EPSLN){lon=adjust_lon(x/this.a+this.long0);
lat=0;}else{al=this.lat0+y/this.a;bl=x*x/this.a/this.a+al*al;phi=al;var tanphi;for(i=MAX_ITER;i;--i){tanphi=Math.tan(phi);
dphi=-1*(al*(phi*tanphi+1)-phi-0.5*(phi*phi+bl)*tanphi)/((phi-al)/tanphi-1);phi+=dphi;if(Math.abs(dphi)<=EPSLN){lat=phi;
break;}}lon=adjust_lon(this.long0+(Math.asin(x*Math.tan(phi)/this.a))/Math.sin(lat));}}else{if(Math.abs(y+this.ml0)<=EPSLN){lat=0;
lon=adjust_lon(this.long0+x/this.a);}else{al=(this.ml0+y)/this.a;bl=x*x/this.a/this.a+al*al;phi=al;var cl,mln,mlnp,ma;
var con;for(i=MAX_ITER;i;--i){con=this.e*Math.sin(phi);cl=Math.sqrt(1-con*con)*Math.tan(phi);mln=this.a*mlfn(this.e0,this.e1,this.e2,this.e3,phi);
mlnp=this.e0-2*this.e1*Math.cos(2*phi)+4*this.e2*Math.cos(4*phi)-6*this.e3*Math.cos(6*phi);ma=mln/this.a;
dphi=(al*(cl*ma+1)-ma-0.5*cl*(ma*ma+bl))/(this.es*Math.sin(2*phi)*(ma*ma+bl-2*al*ma)/(4*cl)+(al-ma)*(cl*mlnp-2/Math.sin(2*phi))-mlnp);
phi-=dphi;if(Math.abs(dphi)<=EPSLN){lat=phi;break;}}cl=Math.sqrt(1-this.es*Math.pow(Math.sin(lat),2))*Math.tan(lat);
lon=adjust_lon(this.long0+Math.asin(x*cl/this.a)/Math.sin(lat));}}p.x=lon;p.y=lat;return p;};exports.names=["Polyconic","poly"];
},{"../common/adjust_lat":4,"../common/adjust_lon":5,"../common/e0fn":7,"../common/e1fn":8,"../common/e2fn":9,"../common/e3fn":10,"../common/gN":11,"../common/mlfn":14}],57:[function(_dereq_,module,exports){var adjust_lon=_dereq_("../common/adjust_lon");
var adjust_lat=_dereq_("../common/adjust_lat");var pj_enfn=_dereq_("../common/pj_enfn");var MAX_ITER=20;
var pj_mlfn=_dereq_("../common/pj_mlfn");var pj_inv_mlfn=_dereq_("../common/pj_inv_mlfn");var HALF_PI=Math.PI/2;
var EPSLN=1e-10;var asinz=_dereq_("../common/asinz");exports.init=function(){if(!this.sphere){this.en=pj_enfn(this.es);
}else{this.n=1;this.m=0;this.es=0;this.C_y=Math.sqrt((this.m+1)/this.n);this.C_x=this.C_y/(this.m+1);
}};exports.forward=function(p){var x,y;var lon=p.x;var lat=p.y;lon=adjust_lon(lon-this.long0);if(this.sphere){if(!this.m){lat=this.n!==1?Math.asin(this.n*Math.sin(lat)):lat;
}else{var k=this.n*Math.sin(lat);for(var i=MAX_ITER;i;--i){var V=(this.m*lat+Math.sin(lat)-k)/(this.m+Math.cos(lat));
lat-=V;if(Math.abs(V)<EPSLN){break;}}}x=this.a*this.C_x*lon*(this.m+Math.cos(lat));y=this.a*this.C_y*lat;
}else{var s=Math.sin(lat);var c=Math.cos(lat);y=this.a*pj_mlfn(lat,s,c,this.en);x=this.a*lon*c/Math.sqrt(1-this.es*s*s);
}p.x=x;p.y=y;return p;};exports.inverse=function(p){var lat,temp,lon,s;p.x-=this.x0;lon=p.x/this.a;p.y-=this.y0;
lat=p.y/this.a;if(this.sphere){lat/=this.C_y;lon=lon/(this.C_x*(this.m+Math.cos(lat)));if(this.m){lat=asinz((this.m*lat+Math.sin(lat))/this.n);
}else{if(this.n!==1){lat=asinz(Math.sin(lat)/this.n);}}lon=adjust_lon(lon+this.long0);lat=adjust_lat(lat);
}else{lat=pj_inv_mlfn(p.y/this.a,this.es,this.en);s=Math.abs(lat);if(s<HALF_PI){s=Math.sin(lat);temp=this.long0+p.x*Math.sqrt(1-this.es*s*s)/(this.a*Math.cos(lat));
lon=adjust_lon(temp);}else{if((s-EPSLN)<HALF_PI){lon=this.long0;}}}p.x=lon;p.y=lat;return p;};exports.names=["Sinusoidal","sinu"];
},{"../common/adjust_lat":4,"../common/adjust_lon":5,"../common/asinz":6,"../common/pj_enfn":17,"../common/pj_inv_mlfn":18,"../common/pj_mlfn":19}],58:[function(_dereq_,module,exports){exports.init=function(){var phy0=this.lat0;
this.lambda0=this.long0;var sinPhy0=Math.sin(phy0);var semiMajorAxis=this.a;var invF=this.rf;var flattening=1/invF;
var e2=2*flattening-Math.pow(flattening,2);var e=this.e=Math.sqrt(e2);this.R=this.k0*semiMajorAxis*Math.sqrt(1-e2)/(1-e2*Math.pow(sinPhy0,2));
this.alpha=Math.sqrt(1+e2/(1-e2)*Math.pow(Math.cos(phy0),4));this.b0=Math.asin(sinPhy0/this.alpha);var k1=Math.log(Math.tan(Math.PI/4+this.b0/2));
var k2=Math.log(Math.tan(Math.PI/4+phy0/2));var k3=Math.log((1+e*sinPhy0)/(1-e*sinPhy0));this.K=k1-this.alpha*k2+this.alpha*e/2*k3;
};exports.forward=function(p){var Sa1=Math.log(Math.tan(Math.PI/4-p.y/2));var Sa2=this.e/2*Math.log((1+this.e*Math.sin(p.y))/(1-this.e*Math.sin(p.y)));
var S=-this.alpha*(Sa1+Sa2)+this.K;var b=2*(Math.atan(Math.exp(S))-Math.PI/4);var I=this.alpha*(p.x-this.lambda0);
var rotI=Math.atan(Math.sin(I)/(Math.sin(this.b0)*Math.tan(b)+Math.cos(this.b0)*Math.cos(I)));var rotB=Math.asin(Math.cos(this.b0)*Math.sin(b)-Math.sin(this.b0)*Math.cos(b)*Math.cos(I));
p.y=this.R/2*Math.log((1+Math.sin(rotB))/(1-Math.sin(rotB)))+this.y0;p.x=this.R*rotI+this.x0;return p;
};exports.inverse=function(p){var Y=p.x-this.x0;var X=p.y-this.y0;var rotI=Y/this.R;var rotB=2*(Math.atan(Math.exp(X/this.R))-Math.PI/4);
var b=Math.asin(Math.cos(this.b0)*Math.sin(rotB)+Math.sin(this.b0)*Math.cos(rotB)*Math.cos(rotI));var I=Math.atan(Math.sin(rotI)/(Math.cos(this.b0)*Math.cos(rotI)-Math.sin(this.b0)*Math.tan(rotB)));
var lambda=this.lambda0+I/this.alpha;var S=0;var phy=b;var prevPhy=-1000;var iteration=0;while(Math.abs(phy-prevPhy)>1e-7){if(++iteration>20){return;
}S=1/this.alpha*(Math.log(Math.tan(Math.PI/4+b/2))-this.K)+this.e*Math.log(Math.tan(Math.PI/4+Math.asin(this.e*Math.sin(phy))/2));
prevPhy=phy;phy=2*Math.atan(Math.exp(S))-Math.PI/2;}p.x=lambda;p.y=phy;return p;};exports.names=["somerc"];
},{}],59:[function(_dereq_,module,exports){var HALF_PI=Math.PI/2;var EPSLN=1e-10;var sign=_dereq_("../common/sign");
var msfnz=_dereq_("../common/msfnz");var tsfnz=_dereq_("../common/tsfnz");var phi2z=_dereq_("../common/phi2z");
var adjust_lon=_dereq_("../common/adjust_lon");exports.ssfn_=function(phit,sinphi,eccen){sinphi*=eccen;
return(Math.tan(0.5*(HALF_PI+phit))*Math.pow((1-sinphi)/(1+sinphi),0.5*eccen));};exports.init=function(){this.coslat0=Math.cos(this.lat0);
this.sinlat0=Math.sin(this.lat0);if(this.sphere){if(this.k0===1&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=EPSLN){this.k0=0.5*(1+sign(this.lat0)*Math.sin(this.lat_ts));
}}else{if(Math.abs(this.coslat0)<=EPSLN){if(this.lat0>0){this.con=1;}else{this.con=-1;}}this.cons=Math.sqrt(Math.pow(1+this.e,1+this.e)*Math.pow(1-this.e,1-this.e));
if(this.k0===1&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=EPSLN){this.k0=0.5*this.cons*msfnz(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts))/tsfnz(this.e,this.con*this.lat_ts,this.con*Math.sin(this.lat_ts));
}this.ms1=msfnz(this.e,this.sinlat0,this.coslat0);this.X0=2*Math.atan(this.ssfn_(this.lat0,this.sinlat0,this.e))-HALF_PI;
this.cosX0=Math.cos(this.X0);this.sinX0=Math.sin(this.X0);}};exports.forward=function(p){var lon=p.x;
var lat=p.y;var sinlat=Math.sin(lat);var coslat=Math.cos(lat);var A,X,sinX,cosX,ts,rh;var dlon=adjust_lon(lon-this.long0);
if(Math.abs(Math.abs(lon-this.long0)-Math.PI)<=EPSLN&&Math.abs(lat+this.lat0)<=EPSLN){p.x=NaN;p.y=NaN;
return p;}if(this.sphere){A=2*this.k0/(1+this.sinlat0*sinlat+this.coslat0*coslat*Math.cos(dlon));p.x=this.a*A*coslat*Math.sin(dlon)+this.x0;
p.y=this.a*A*(this.coslat0*sinlat-this.sinlat0*coslat*Math.cos(dlon))+this.y0;return p;}else{X=2*Math.atan(this.ssfn_(lat,sinlat,this.e))-HALF_PI;
cosX=Math.cos(X);sinX=Math.sin(X);if(Math.abs(this.coslat0)<=EPSLN){ts=tsfnz(this.e,lat*this.con,this.con*sinlat);
rh=2*this.a*this.k0*ts/this.cons;p.x=this.x0+rh*Math.sin(lon-this.long0);p.y=this.y0-this.con*rh*Math.cos(lon-this.long0);
return p;}else{if(Math.abs(this.sinlat0)<EPSLN){A=2*this.a*this.k0/(1+cosX*Math.cos(dlon));p.y=A*sinX;
}else{A=2*this.a*this.k0*this.ms1/(this.cosX0*(1+this.sinX0*sinX+this.cosX0*cosX*Math.cos(dlon)));p.y=A*(this.cosX0*sinX-this.sinX0*cosX*Math.cos(dlon))+this.y0;
}}p.x=A*cosX*Math.sin(dlon)+this.x0;}return p;};exports.inverse=function(p){p.x-=this.x0;p.y-=this.y0;
var lon,lat,ts,ce,Chi;var rh=Math.sqrt(p.x*p.x+p.y*p.y);if(this.sphere){var c=2*Math.atan(rh/(0.5*this.a*this.k0));
lon=this.long0;lat=this.lat0;if(rh<=EPSLN){p.x=lon;p.y=lat;return p;}lat=Math.asin(Math.cos(c)*this.sinlat0+p.y*Math.sin(c)*this.coslat0/rh);
if(Math.abs(this.coslat0)<EPSLN){if(this.lat0>0){lon=adjust_lon(this.long0+Math.atan2(p.x,-1*p.y));}else{lon=adjust_lon(this.long0+Math.atan2(p.x,p.y));
}}else{lon=adjust_lon(this.long0+Math.atan2(p.x*Math.sin(c),rh*this.coslat0*Math.cos(c)-p.y*this.sinlat0*Math.sin(c)));
}p.x=lon;p.y=lat;return p;}else{if(Math.abs(this.coslat0)<=EPSLN){if(rh<=EPSLN){lat=this.lat0;lon=this.long0;
p.x=lon;p.y=lat;return p;}p.x*=this.con;p.y*=this.con;ts=rh*this.cons/(2*this.a*this.k0);lat=this.con*phi2z(this.e,ts);
lon=this.con*adjust_lon(this.con*this.long0+Math.atan2(p.x,-1*p.y));}else{ce=2*Math.atan(rh*this.cosX0/(2*this.a*this.k0*this.ms1));
lon=this.long0;if(rh<=EPSLN){Chi=this.X0;}else{Chi=Math.asin(Math.cos(ce)*this.sinX0+p.y*Math.sin(ce)*this.cosX0/rh);
lon=adjust_lon(this.long0+Math.atan2(p.x*Math.sin(ce),rh*this.cosX0*Math.cos(ce)-p.y*this.sinX0*Math.sin(ce)));
}lat=-1*phi2z(this.e,Math.tan(0.5*(HALF_PI+Chi)));}}p.x=lon;p.y=lat;return p;};exports.names=["stere"];
},{"../common/adjust_lon":5,"../common/msfnz":15,"../common/phi2z":16,"../common/sign":21,"../common/tsfnz":24}],60:[function(_dereq_,module,exports){var gauss=_dereq_("./gauss");
var adjust_lon=_dereq_("../common/adjust_lon");exports.init=function(){gauss.init.apply(this);if(!this.rc){return;
}this.sinc0=Math.sin(this.phic0);this.cosc0=Math.cos(this.phic0);this.R2=2*this.rc;if(!this.title){this.title="Oblique Stereographic Alternative";
}};exports.forward=function(p){var sinc,cosc,cosl,k;p.x=adjust_lon(p.x-this.long0);gauss.forward.apply(this,[p]);
sinc=Math.sin(p.y);cosc=Math.cos(p.y);cosl=Math.cos(p.x);k=this.k0*this.R2/(1+this.sinc0*sinc+this.cosc0*cosc*cosl);
p.x=k*cosc*Math.sin(p.x);p.y=k*(this.cosc0*sinc-this.sinc0*cosc*cosl);p.x=this.a*p.x+this.x0;p.y=this.a*p.y+this.y0;
return p;};exports.inverse=function(p){var sinc,cosc,lon,lat,rho;p.x=(p.x-this.x0)/this.a;p.y=(p.y-this.y0)/this.a;
p.x/=this.k0;p.y/=this.k0;if((rho=Math.sqrt(p.x*p.x+p.y*p.y))){var c=2*Math.atan2(rho,this.R2);sinc=Math.sin(c);
cosc=Math.cos(c);lat=Math.asin(cosc*this.sinc0+p.y*sinc*this.cosc0/rho);lon=Math.atan2(p.x*sinc,rho*this.cosc0*cosc-p.y*this.sinc0*sinc);
}else{lat=this.phic0;lon=0;}p.x=lon;p.y=lat;gauss.inverse.apply(this,[p]);p.x=adjust_lon(p.x+this.long0);
return p;};exports.names=["Stereographic_North_Pole","Oblique_Stereographic","Polar_Stereographic","sterea","Oblique Stereographic Alternative"];
},{"../common/adjust_lon":5,"./gauss":45}],61:[function(_dereq_,module,exports){var e0fn=_dereq_("../common/e0fn");
var e1fn=_dereq_("../common/e1fn");var e2fn=_dereq_("../common/e2fn");var e3fn=_dereq_("../common/e3fn");
var mlfn=_dereq_("../common/mlfn");var adjust_lon=_dereq_("../common/adjust_lon");var HALF_PI=Math.PI/2;
var EPSLN=1e-10;var sign=_dereq_("../common/sign");var asinz=_dereq_("../common/asinz");exports.init=function(){this.e0=e0fn(this.es);
this.e1=e1fn(this.es);this.e2=e2fn(this.es);this.e3=e3fn(this.es);this.ml0=this.a*mlfn(this.e0,this.e1,this.e2,this.e3,this.lat0);
};exports.forward=function(p){var lon=p.x;var lat=p.y;var delta_lon=adjust_lon(lon-this.long0);var con;
var x,y;var sin_phi=Math.sin(lat);var cos_phi=Math.cos(lat);if(this.sphere){var b=cos_phi*Math.sin(delta_lon);
if((Math.abs(Math.abs(b)-1))<1e-10){return(93);}else{x=0.5*this.a*this.k0*Math.log((1+b)/(1-b));con=Math.acos(cos_phi*Math.cos(delta_lon)/Math.sqrt(1-b*b));
if(lat<0){con=-con;}y=this.a*this.k0*(con-this.lat0);}}else{var al=cos_phi*delta_lon;var als=Math.pow(al,2);
var c=this.ep2*Math.pow(cos_phi,2);var tq=Math.tan(lat);var t=Math.pow(tq,2);con=1-this.es*Math.pow(sin_phi,2);
var n=this.a/Math.sqrt(con);var ml=this.a*mlfn(this.e0,this.e1,this.e2,this.e3,lat);x=this.k0*n*al*(1+als/6*(1-t+c+als/20*(5-18*t+Math.pow(t,2)+72*c-58*this.ep2)))+this.x0;
y=this.k0*(ml-this.ml0+n*tq*(als*(0.5+als/24*(5-t+9*c+4*Math.pow(c,2)+als/30*(61-58*t+Math.pow(t,2)+600*c-330*this.ep2)))))+this.y0;
}p.x=x;p.y=y;return p;};exports.inverse=function(p){var con,phi;var delta_phi;var i;var max_iter=6;var lat,lon;
if(this.sphere){var f=Math.exp(p.x/(this.a*this.k0));var g=0.5*(f-1/f);var temp=this.lat0+p.y/(this.a*this.k0);
var h=Math.cos(temp);con=Math.sqrt((1-h*h)/(1+g*g));lat=asinz(con);if(temp<0){lat=-lat;}if((g===0)&&(h===0)){lon=this.long0;
}else{lon=adjust_lon(Math.atan2(g,h)+this.long0);}}else{var x=p.x-this.x0;var y=p.y-this.y0;con=(this.ml0+y/this.k0)/this.a;
phi=con;for(i=0;true;i++){delta_phi=((con+this.e1*Math.sin(2*phi)-this.e2*Math.sin(4*phi)+this.e3*Math.sin(6*phi))/this.e0)-phi;
phi+=delta_phi;if(Math.abs(delta_phi)<=EPSLN){break;}if(i>=max_iter){return(95);}}if(Math.abs(phi)<HALF_PI){var sin_phi=Math.sin(phi);
var cos_phi=Math.cos(phi);var tan_phi=Math.tan(phi);var c=this.ep2*Math.pow(cos_phi,2);var cs=Math.pow(c,2);
var t=Math.pow(tan_phi,2);var ts=Math.pow(t,2);con=1-this.es*Math.pow(sin_phi,2);var n=this.a/Math.sqrt(con);
var r=n*(1-this.es)/con;var d=x/(n*this.k0);var ds=Math.pow(d,2);lat=phi-(n*tan_phi*ds/r)*(0.5-ds/24*(5+3*t+10*c-4*cs-9*this.ep2-ds/30*(61+90*t+298*c+45*ts-252*this.ep2-3*cs)));
lon=adjust_lon(this.long0+(d*(1-ds/6*(1+2*t+c-ds/20*(5-2*c+28*t-3*cs+8*this.ep2+24*ts)))/cos_phi));}else{lat=HALF_PI*sign(y);
lon=this.long0;}}p.x=lon;p.y=lat;return p;};exports.names=["Transverse_Mercator","Transverse Mercator","tmerc"];
},{"../common/adjust_lon":5,"../common/asinz":6,"../common/e0fn":7,"../common/e1fn":8,"../common/e2fn":9,"../common/e3fn":10,"../common/mlfn":14,"../common/sign":21}],62:[function(_dereq_,module,exports){var D2R=0.017453292519943295;
var tmerc=_dereq_("./tmerc");exports.dependsOn="tmerc";exports.init=function(){if(!this.zone){return;
}this.lat0=0;this.long0=((6*Math.abs(this.zone))-183)*D2R;this.x0=500000;this.y0=this.utmSouth?10000000:0;
this.k0=0.9996;tmerc.init.apply(this);this.forward=tmerc.forward;this.inverse=tmerc.inverse;};exports.names=["Universal Transverse Mercator System","utm"];
},{"./tmerc":61}],63:[function(_dereq_,module,exports){var adjust_lon=_dereq_("../common/adjust_lon");
var HALF_PI=Math.PI/2;var EPSLN=1e-10;var asinz=_dereq_("../common/asinz");exports.init=function(){this.R=this.a;
};exports.forward=function(p){var lon=p.x;var lat=p.y;var dlon=adjust_lon(lon-this.long0);var x,y;if(Math.abs(lat)<=EPSLN){x=this.x0+this.R*dlon;
y=this.y0;}var theta=asinz(2*Math.abs(lat/Math.PI));if((Math.abs(dlon)<=EPSLN)||(Math.abs(Math.abs(lat)-HALF_PI)<=EPSLN)){x=this.x0;
if(lat>=0){y=this.y0+Math.PI*this.R*Math.tan(0.5*theta);}else{y=this.y0+Math.PI*this.R*-Math.tan(0.5*theta);
}}var al=0.5*Math.abs((Math.PI/dlon)-(dlon/Math.PI));var asq=al*al;var sinth=Math.sin(theta);var costh=Math.cos(theta);
var g=costh/(sinth+costh-1);var gsq=g*g;var m=g*(2/sinth-1);var msq=m*m;var con=Math.PI*this.R*(al*(g-msq)+Math.sqrt(asq*(g-msq)*(g-msq)-(msq+asq)*(gsq-msq)))/(msq+asq);
if(dlon<0){con=-con;}x=this.x0+con;var q=asq+g;con=Math.PI*this.R*(m*q-al*Math.sqrt((msq+asq)*(asq+1)-q*q))/(msq+asq);
if(lat>=0){y=this.y0+con;}else{y=this.y0-con;}p.x=x;p.y=y;return p;};exports.inverse=function(p){var lon,lat;
var xx,yy,xys,c1,c2,c3;var a1;var m1;var con;var th1;var d;p.x-=this.x0;p.y-=this.y0;con=Math.PI*this.R;
xx=p.x/con;yy=p.y/con;xys=xx*xx+yy*yy;c1=-Math.abs(yy)*(1+xys);c2=c1-2*yy*yy+xx*xx;c3=-2*c1+1+2*yy*yy+xys*xys;
d=yy*yy/c3+(2*c2*c2*c2/c3/c3/c3-9*c1*c2/c3/c3)/27;a1=(c1-c2*c2/3/c3)/c3;m1=2*Math.sqrt(-a1/3);con=((3*d)/a1)/m1;
if(Math.abs(con)>1){if(con>=0){con=1;}else{con=-1;}}th1=Math.acos(con)/3;if(p.y>=0){lat=(-m1*Math.cos(th1+Math.PI/3)-c2/3/c3)*Math.PI;
}else{lat=-(-m1*Math.cos(th1+Math.PI/3)-c2/3/c3)*Math.PI;}if(Math.abs(xx)<EPSLN){lon=this.long0;}else{lon=adjust_lon(this.long0+Math.PI*(xys-1+Math.sqrt(1+2*(xx*xx-yy*yy)+xys*xys))/2/xx);
}p.x=lon;p.y=lat;return p;};exports.names=["Van_der_Grinten_I","VanDerGrinten","vandg"];},{"../common/adjust_lon":5,"../common/asinz":6}],64:[function(_dereq_,module,exports){var D2R=0.017453292519943295;
var R2D=57.29577951308232;var PJD_3PARAM=1;var PJD_7PARAM=2;var datum_transform=_dereq_("./datum_transform");
var adjust_axis=_dereq_("./adjust_axis");var proj=_dereq_("./Proj");var toPoint=_dereq_("./common/toPoint");
module.exports=function transform(source,dest,point){var wgs84;if(Array.isArray(point)){point=toPoint(point);
}function checkNotWGS(source,dest){return((source.datum.datum_type===PJD_3PARAM||source.datum.datum_type===PJD_7PARAM)&&dest.datumCode!=="WGS84");
}if(source.datum&&dest.datum&&(checkNotWGS(source,dest)||checkNotWGS(dest,source))){wgs84=new proj("WGS84");
transform(source,wgs84,point);source=wgs84;}if(source.axis!=="enu"){adjust_axis(source,false,point);}if(source.projName==="longlat"){point.x*=D2R;
point.y*=D2R;}else{if(source.to_meter){point.x*=source.to_meter;point.y*=source.to_meter;}source.inverse(point);
}if(source.from_greenwich){point.x+=source.from_greenwich;}point=datum_transform(source.datum,dest.datum,point);
if(dest.from_greenwich){point.x-=dest.from_greenwich;}if(dest.projName==="longlat"){point.x*=R2D;point.y*=R2D;
}else{dest.forward(point);if(dest.to_meter){point.x/=dest.to_meter;point.y/=dest.to_meter;}}if(dest.axis!=="enu"){adjust_axis(dest,true,point);
}return point;};},{"./Proj":2,"./adjust_axis":3,"./common/toPoint":23,"./datum_transform":30}],65:[function(_dereq_,module,exports){var D2R=0.017453292519943295;
var extend=_dereq_("./extend");function mapit(obj,key,v){obj[key]=v.map(function(aa){var o={};sExpr(aa,o);
return o;}).reduce(function(a,b){return extend(a,b);},{});}function sExpr(v,obj){var key;if(!Array.isArray(v)){obj[v]=true;
return;}else{key=v.shift();if(key==="PARAMETER"){key=v.shift();}if(v.length===1){if(Array.isArray(v[0])){obj[key]={};
sExpr(v[0],obj[key]);}else{obj[key]=v[0];}}else{if(!v.length){obj[key]=true;}else{if(key==="TOWGS84"){obj[key]=v;
}else{obj[key]={};if(["UNIT","PRIMEM","VERT_DATUM"].indexOf(key)>-1){obj[key]={name:v[0].toLowerCase(),convert:v[1]};
if(v.length===3){obj[key].auth=v[2];}}else{if(key==="SPHEROID"){obj[key]={name:v[0],a:v[1],rf:v[2]};if(v.length===4){obj[key].auth=v[3];
}}else{if(["GEOGCS","GEOCCS","DATUM","VERT_CS","COMPD_CS","LOCAL_CS","FITTED_CS","LOCAL_DATUM"].indexOf(key)>-1){v[0]=["name",v[0]];
mapit(obj,key,v);}else{if(v.every(function(aa){return Array.isArray(aa);})){mapit(obj,key,v);}else{sExpr(v,obj[key]);
}}}}}}}}}function rename(obj,params){var outName=params[0];var inName=params[1];if(!(outName in obj)&&(inName in obj)){obj[outName]=obj[inName];
if(params.length===3){obj[outName]=params[2](obj[outName]);}}}function d2r(input){return input*D2R;}function cleanWKT(wkt){if(wkt.type==="GEOGCS"){wkt.projName="longlat";
}else{if(wkt.type==="LOCAL_CS"){wkt.projName="identity";wkt.local=true;}else{if(typeof wkt.PROJECTION==="object"){wkt.projName=Object.keys(wkt.PROJECTION)[0];
}else{wkt.projName=wkt.PROJECTION;}}}if(wkt.UNIT){wkt.units=wkt.UNIT.name.toLowerCase();if(wkt.units==="metre"){wkt.units="meter";
}if(wkt.UNIT.convert){wkt.to_meter=parseFloat(wkt.UNIT.convert,10);}}if(wkt.GEOGCS){if(wkt.GEOGCS.DATUM){wkt.datumCode=wkt.GEOGCS.DATUM.name.toLowerCase();
}else{wkt.datumCode=wkt.GEOGCS.name.toLowerCase();}if(wkt.datumCode.slice(0,2)==="d_"){wkt.datumCode=wkt.datumCode.slice(2);
}if(wkt.datumCode==="new_zealand_geodetic_datum_1949"||wkt.datumCode==="new_zealand_1949"){wkt.datumCode="nzgd49";
}if(wkt.datumCode==="wgs_1984"){if(wkt.PROJECTION==="Mercator_Auxiliary_Sphere"){wkt.sphere=true;}wkt.datumCode="wgs84";
}if(wkt.datumCode.slice(-6)==="_ferro"){wkt.datumCode=wkt.datumCode.slice(0,-6);}if(wkt.datumCode.slice(-8)==="_jakarta"){wkt.datumCode=wkt.datumCode.slice(0,-8);
}if(~wkt.datumCode.indexOf("belge")){wkt.datumCode="rnb72";}if(wkt.GEOGCS.DATUM&&wkt.GEOGCS.DATUM.SPHEROID){wkt.ellps=wkt.GEOGCS.DATUM.SPHEROID.name.replace("_19","").replace(/[Cc]larke\_18/,"clrk");
if(wkt.ellps.toLowerCase().slice(0,13)==="international"){wkt.ellps="intl";}wkt.a=wkt.GEOGCS.DATUM.SPHEROID.a;
wkt.rf=parseFloat(wkt.GEOGCS.DATUM.SPHEROID.rf,10);}if(~wkt.datumCode.indexOf("osgb_1936")){wkt.datumCode="osgb36";
}}if(wkt.b&&!isFinite(wkt.b)){wkt.b=wkt.a;}function toMeter(input){var ratio=wkt.to_meter||1;return parseFloat(input,10)*ratio;
}var renamer=function(a){return rename(wkt,a);};var list=[["standard_parallel_1","Standard_Parallel_1"],["standard_parallel_2","Standard_Parallel_2"],["false_easting","False_Easting"],["false_northing","False_Northing"],["central_meridian","Central_Meridian"],["latitude_of_origin","Latitude_Of_Origin"],["scale_factor","Scale_Factor"],["k0","scale_factor"],["latitude_of_center","Latitude_of_center"],["lat0","latitude_of_center",d2r],["longitude_of_center","Longitude_Of_Center"],["longc","longitude_of_center",d2r],["x0","false_easting",toMeter],["y0","false_northing",toMeter],["long0","central_meridian",d2r],["lat0","latitude_of_origin",d2r],["lat0","standard_parallel_1",d2r],["lat1","standard_parallel_1",d2r],["lat2","standard_parallel_2",d2r],["alpha","azimuth",d2r],["srsCode","name"]];
list.forEach(renamer);if(!wkt.long0&&wkt.longc&&(wkt.PROJECTION==="Albers_Conic_Equal_Area"||wkt.PROJECTION==="Lambert_Azimuthal_Equal_Area")){wkt.long0=wkt.longc;
}}module.exports=function(wkt,self){var lisp=JSON.parse((","+wkt).replace(/\s*\,\s*([A-Z_0-9]+?)(\[)/g,',["$1",').slice(1).replace(/\s*\,\s*([A-Z_0-9]+?)\]/g,',"$1"]'));
var type=lisp.shift();var name=lisp.shift();lisp.unshift(["name",name]);lisp.unshift(["type",type]);lisp.unshift("output");
var obj={};sExpr(lisp,obj);cleanWKT(obj.output);return extend(self,obj.output);};},{"./extend":33}],66:[function(_dereq_,module,exports){var NUM_100K_SETS=6;
var SET_ORIGIN_COLUMN_LETTERS="AJSAJS";var SET_ORIGIN_ROW_LETTERS="AFAFAF";var A=65;var I=73;var O=79;
var V=86;var Z=90;exports.forward=function(ll,accuracy){accuracy=accuracy||5;return encode(LLtoUTM({lat:ll[1],lon:ll[0]}),accuracy);
};exports.inverse=function(mgrs){var bbox=UTMtoLL(decode(mgrs.toUpperCase()));return[bbox.left,bbox.bottom,bbox.right,bbox.top];
};exports.toPoint=function(mgrsStr){var llbbox=exports.inverse(mgrsStr);return[(llbbox[2]+llbbox[0])/2,(llbbox[3]+llbbox[1])/2];
};function degToRad(deg){return(deg*(Math.PI/180));}function radToDeg(rad){return(180*(rad/Math.PI));
}function LLtoUTM(ll){var Lat=ll.lat;var Long=ll.lon;var a=6378137;var eccSquared=0.00669438;var k0=0.9996;
var LongOrigin;var eccPrimeSquared;var N,T,C,A,M;var LatRad=degToRad(Lat);var LongRad=degToRad(Long);
var LongOriginRad;var ZoneNumber;ZoneNumber=Math.floor((Long+180)/6)+1;if(Long===180){ZoneNumber=60;}if(Lat>=56&&Lat<64&&Long>=3&&Long<12){ZoneNumber=32;
}if(Lat>=72&&Lat<84){if(Long>=0&&Long<9){ZoneNumber=31;}else{if(Long>=9&&Long<21){ZoneNumber=33;}else{if(Long>=21&&Long<33){ZoneNumber=35;
}else{if(Long>=33&&Long<42){ZoneNumber=37;}}}}}LongOrigin=(ZoneNumber-1)*6-180+3;LongOriginRad=degToRad(LongOrigin);
eccPrimeSquared=(eccSquared)/(1-eccSquared);N=a/Math.sqrt(1-eccSquared*Math.sin(LatRad)*Math.sin(LatRad));
T=Math.tan(LatRad)*Math.tan(LatRad);C=eccPrimeSquared*Math.cos(LatRad)*Math.cos(LatRad);A=Math.cos(LatRad)*(LongRad-LongOriginRad);
M=a*((1-eccSquared/4-3*eccSquared*eccSquared/64-5*eccSquared*eccSquared*eccSquared/256)*LatRad-(3*eccSquared/8+3*eccSquared*eccSquared/32+45*eccSquared*eccSquared*eccSquared/1024)*Math.sin(2*LatRad)+(15*eccSquared*eccSquared/256+45*eccSquared*eccSquared*eccSquared/1024)*Math.sin(4*LatRad)-(35*eccSquared*eccSquared*eccSquared/3072)*Math.sin(6*LatRad));
var UTMEasting=(k0*N*(A+(1-T+C)*A*A*A/6+(5-18*T+T*T+72*C-58*eccPrimeSquared)*A*A*A*A*A/120)+500000);var UTMNorthing=(k0*(M+N*Math.tan(LatRad)*(A*A/2+(5-T+9*C+4*C*C)*A*A*A*A/24+(61-58*T+T*T+600*C-330*eccPrimeSquared)*A*A*A*A*A*A/720)));
if(Lat<0){UTMNorthing+=10000000;}return{northing:Math.round(UTMNorthing),easting:Math.round(UTMEasting),zoneNumber:ZoneNumber,zoneLetter:getLetterDesignator(Lat)};
}function UTMtoLL(utm){var UTMNorthing=utm.northing;var UTMEasting=utm.easting;var zoneLetter=utm.zoneLetter;
var zoneNumber=utm.zoneNumber;if(zoneNumber<0||zoneNumber>60){return null;}var k0=0.9996;var a=6378137;
var eccSquared=0.00669438;var eccPrimeSquared;var e1=(1-Math.sqrt(1-eccSquared))/(1+Math.sqrt(1-eccSquared));
var N1,T1,C1,R1,D,M;var LongOrigin;var mu,phi1Rad;var x=UTMEasting-500000;var y=UTMNorthing;if(zoneLetter<"N"){y-=10000000;
}LongOrigin=(zoneNumber-1)*6-180+3;eccPrimeSquared=(eccSquared)/(1-eccSquared);M=y/k0;mu=M/(a*(1-eccSquared/4-3*eccSquared*eccSquared/64-5*eccSquared*eccSquared*eccSquared/256));
phi1Rad=mu+(3*e1/2-27*e1*e1*e1/32)*Math.sin(2*mu)+(21*e1*e1/16-55*e1*e1*e1*e1/32)*Math.sin(4*mu)+(151*e1*e1*e1/96)*Math.sin(6*mu);
N1=a/Math.sqrt(1-eccSquared*Math.sin(phi1Rad)*Math.sin(phi1Rad));T1=Math.tan(phi1Rad)*Math.tan(phi1Rad);
C1=eccPrimeSquared*Math.cos(phi1Rad)*Math.cos(phi1Rad);R1=a*(1-eccSquared)/Math.pow(1-eccSquared*Math.sin(phi1Rad)*Math.sin(phi1Rad),1.5);
D=x/(N1*k0);var lat=phi1Rad-(N1*Math.tan(phi1Rad)/R1)*(D*D/2-(5+3*T1+10*C1-4*C1*C1-9*eccPrimeSquared)*D*D*D*D/24+(61+90*T1+298*C1+45*T1*T1-252*eccPrimeSquared-3*C1*C1)*D*D*D*D*D*D/720);
lat=radToDeg(lat);var lon=(D-(1+2*T1+C1)*D*D*D/6+(5-2*C1+28*T1-3*C1*C1+8*eccPrimeSquared+24*T1*T1)*D*D*D*D*D/120)/Math.cos(phi1Rad);
lon=LongOrigin+radToDeg(lon);var result;if(utm.accuracy){var topRight=UTMtoLL({northing:utm.northing+utm.accuracy,easting:utm.easting+utm.accuracy,zoneLetter:utm.zoneLetter,zoneNumber:utm.zoneNumber});
result={top:topRight.lat,right:topRight.lon,bottom:lat,left:lon};}else{result={lat:lat,lon:lon};}return result;
}function getLetterDesignator(lat){var LetterDesignator="Z";if((84>=lat)&&(lat>=72)){LetterDesignator="X";
}else{if((72>lat)&&(lat>=64)){LetterDesignator="W";}else{if((64>lat)&&(lat>=56)){LetterDesignator="V";
}else{if((56>lat)&&(lat>=48)){LetterDesignator="U";}else{if((48>lat)&&(lat>=40)){LetterDesignator="T";
}else{if((40>lat)&&(lat>=32)){LetterDesignator="S";}else{if((32>lat)&&(lat>=24)){LetterDesignator="R";
}else{if((24>lat)&&(lat>=16)){LetterDesignator="Q";}else{if((16>lat)&&(lat>=8)){LetterDesignator="P";
}else{if((8>lat)&&(lat>=0)){LetterDesignator="N";}else{if((0>lat)&&(lat>=-8)){LetterDesignator="M";}else{if((-8>lat)&&(lat>=-16)){LetterDesignator="L";
}else{if((-16>lat)&&(lat>=-24)){LetterDesignator="K";}else{if((-24>lat)&&(lat>=-32)){LetterDesignator="J";
}else{if((-32>lat)&&(lat>=-40)){LetterDesignator="H";}else{if((-40>lat)&&(lat>=-48)){LetterDesignator="G";
}else{if((-48>lat)&&(lat>=-56)){LetterDesignator="F";}else{if((-56>lat)&&(lat>=-64)){LetterDesignator="E";
}else{if((-64>lat)&&(lat>=-72)){LetterDesignator="D";}else{if((-72>lat)&&(lat>=-80)){LetterDesignator="C";
}}}}}}}}}}}}}}}}}}}}return LetterDesignator;}function encode(utm,accuracy){var seasting=""+utm.easting,snorthing=""+utm.northing;
return utm.zoneNumber+utm.zoneLetter+get100kID(utm.easting,utm.northing,utm.zoneNumber)+seasting.substr(seasting.length-5,accuracy)+snorthing.substr(snorthing.length-5,accuracy);
}function get100kID(easting,northing,zoneNumber){var setParm=get100kSetForZone(zoneNumber);var setColumn=Math.floor(easting/100000);
var setRow=Math.floor(northing/100000)%20;return getLetter100kID(setColumn,setRow,setParm);}function get100kSetForZone(i){var setParm=i%NUM_100K_SETS;
if(setParm===0){setParm=NUM_100K_SETS;}return setParm;}function getLetter100kID(column,row,parm){var index=parm-1;
var colOrigin=SET_ORIGIN_COLUMN_LETTERS.charCodeAt(index);var rowOrigin=SET_ORIGIN_ROW_LETTERS.charCodeAt(index);
var colInt=colOrigin+column-1;var rowInt=rowOrigin+row;var rollover=false;if(colInt>Z){colInt=colInt-Z+A-1;
rollover=true;}if(colInt===I||(colOrigin<I&&colInt>I)||((colInt>I||colOrigin<I)&&rollover)){colInt++;
}if(colInt===O||(colOrigin<O&&colInt>O)||((colInt>O||colOrigin<O)&&rollover)){colInt++;if(colInt===I){colInt++;
}}if(colInt>Z){colInt=colInt-Z+A-1;}if(rowInt>V){rowInt=rowInt-V+A-1;rollover=true;}else{rollover=false;
}if(((rowInt===I)||((rowOrigin<I)&&(rowInt>I)))||(((rowInt>I)||(rowOrigin<I))&&rollover)){rowInt++;}if(((rowInt===O)||((rowOrigin<O)&&(rowInt>O)))||(((rowInt>O)||(rowOrigin<O))&&rollover)){rowInt++;
if(rowInt===I){rowInt++;}}if(rowInt>V){rowInt=rowInt-V+A-1;}var twoLetter=String.fromCharCode(colInt)+String.fromCharCode(rowInt);
return twoLetter;}function decode(mgrsString){if(mgrsString&&mgrsString.length===0){throw ("MGRSPoint coverting from nothing");
}var length=mgrsString.length;var hunK=null;var sb="";var testChar;var i=0;while(!(/[A-Z]/).test(testChar=mgrsString.charAt(i))){if(i>=2){throw ("MGRSPoint bad conversion from: "+mgrsString);
}sb+=testChar;i++;}var zoneNumber=parseInt(sb,10);if(i===0||i+3>length){throw ("MGRSPoint bad conversion from: "+mgrsString);
}var zoneLetter=mgrsString.charAt(i++);if(zoneLetter<="A"||zoneLetter==="B"||zoneLetter==="Y"||zoneLetter>="Z"||zoneLetter==="I"||zoneLetter==="O"){throw ("MGRSPoint zone letter "+zoneLetter+" not handled: "+mgrsString);
}hunK=mgrsString.substring(i,i+=2);var set=get100kSetForZone(zoneNumber);var east100k=getEastingFromChar(hunK.charAt(0),set);
var north100k=getNorthingFromChar(hunK.charAt(1),set);while(north100k<getMinNorthing(zoneLetter)){north100k+=2000000;
}var remainder=length-i;if(remainder%2!==0){throw ("MGRSPoint has to have an even number \nof digits after the zone letter and two 100km letters - front \nhalf for easting meters, second half for \nnorthing meters"+mgrsString);
}var sep=remainder/2;var sepEasting=0;var sepNorthing=0;var accuracyBonus,sepEastingString,sepNorthingString,easting,northing;
if(sep>0){accuracyBonus=100000/Math.pow(10,sep);sepEastingString=mgrsString.substring(i,i+sep);sepEasting=parseFloat(sepEastingString)*accuracyBonus;
sepNorthingString=mgrsString.substring(i+sep);sepNorthing=parseFloat(sepNorthingString)*accuracyBonus;
}easting=sepEasting+east100k;northing=sepNorthing+north100k;return{easting:easting,northing:northing,zoneLetter:zoneLetter,zoneNumber:zoneNumber,accuracy:accuracyBonus};
}function getEastingFromChar(e,set){var curCol=SET_ORIGIN_COLUMN_LETTERS.charCodeAt(set-1);var eastingValue=100000;
var rewindMarker=false;while(curCol!==e.charCodeAt(0)){curCol++;if(curCol===I){curCol++;}if(curCol===O){curCol++;
}if(curCol>Z){if(rewindMarker){throw ("Bad character: "+e);}curCol=A;rewindMarker=true;}eastingValue+=100000;
}return eastingValue;}function getNorthingFromChar(n,set){if(n>"V"){throw ("MGRSPoint given invalid Northing "+n);
}var curRow=SET_ORIGIN_ROW_LETTERS.charCodeAt(set-1);var northingValue=0;var rewindMarker=false;while(curRow!==n.charCodeAt(0)){curRow++;
if(curRow===I){curRow++;}if(curRow===O){curRow++;}if(curRow>V){if(rewindMarker){throw ("Bad character: "+n);
}curRow=A;rewindMarker=true;}northingValue+=100000;}return northingValue;}function getMinNorthing(zoneLetter){var northing;
switch(zoneLetter){case"C":northing=1100000;break;case"D":northing=2000000;break;case"E":northing=2800000;
break;case"F":northing=3700000;break;case"G":northing=4600000;break;case"H":northing=5500000;break;case"J":northing=6400000;
break;case"K":northing=7300000;break;case"L":northing=8200000;break;case"M":northing=9100000;break;case"N":northing=0;
break;case"P":northing=800000;break;case"Q":northing=1700000;break;case"R":northing=2600000;break;case"S":northing=3500000;
break;case"T":northing=4400000;break;case"U":northing=5300000;break;case"V":northing=6200000;break;case"W":northing=7000000;
break;case"X":northing=7900000;break;default:northing=-1;}if(northing>=0){return northing;}else{throw ("Invalid zone letter: "+zoneLetter);
}}},{}],67:[function(_dereq_,module,exports){module.exports={name:"proj4",version:"2.2.2-alpha",description:"Proj4js is a JavaScript library to transform point coordinates from one coordinate system to another, including datum transformations.",main:"lib/index.js",directories:{test:"test",doc:"docs"},scripts:{test:"./node_modules/istanbul/lib/cli.js test ./node_modules/mocha/bin/_mocha test/test.js"},repository:{type:"git",url:"git://github.com/proj4js/proj4js.git"},author:"",license:"MIT",jam:{main:"dist/proj4.js",include:["dist/proj4.js","README.md","AUTHORS","LICENSE.md"]},devDependencies:{"grunt-cli":"~0.1.13",grunt:"~0.4.2","grunt-contrib-connect":"~0.6.0","grunt-contrib-jshint":"~0.8.0",chai:"~1.8.1",mocha:"~1.17.1","grunt-mocha-phantomjs":"~0.4.0",browserify:"~3.24.5","grunt-browserify":"~1.3.0","grunt-contrib-uglify":"~0.3.2",curl:"git://github.com/cujojs/curl.git",istanbul:"~0.2.4",tin:"~0.4.0"},dependencies:{mgrs:"0.0.0"}};
},{}],"./includedProjections":[function(_dereq_,module,exports){module.exports=_dereq_("Jf/0WF");},{}],"Jf/0WF":[function(_dereq_,module,exports){var projs=[_dereq_("./lib/projections/tmerc"),_dereq_("./lib/projections/utm"),_dereq_("./lib/projections/sterea"),_dereq_("./lib/projections/stere"),_dereq_("./lib/projections/somerc"),_dereq_("./lib/projections/omerc"),_dereq_("./lib/projections/lcc"),_dereq_("./lib/projections/krovak"),_dereq_("./lib/projections/cass"),_dereq_("./lib/projections/laea"),_dereq_("./lib/projections/aea"),_dereq_("./lib/projections/gnom"),_dereq_("./lib/projections/cea"),_dereq_("./lib/projections/eqc"),_dereq_("./lib/projections/poly"),_dereq_("./lib/projections/nzmg"),_dereq_("./lib/projections/mill"),_dereq_("./lib/projections/sinu"),_dereq_("./lib/projections/moll"),_dereq_("./lib/projections/eqdc"),_dereq_("./lib/projections/vandg"),_dereq_("./lib/projections/aeqd")];
module.exports=function(proj4){projs.forEach(function(proj){proj4.Proj.projections.add(proj);});};},{"./lib/projections/aea":39,"./lib/projections/aeqd":40,"./lib/projections/cass":41,"./lib/projections/cea":42,"./lib/projections/eqc":43,"./lib/projections/eqdc":44,"./lib/projections/gnom":46,"./lib/projections/krovak":47,"./lib/projections/laea":48,"./lib/projections/lcc":49,"./lib/projections/mill":52,"./lib/projections/moll":53,"./lib/projections/nzmg":54,"./lib/projections/omerc":55,"./lib/projections/poly":56,"./lib/projections/sinu":57,"./lib/projections/somerc":58,"./lib/projections/stere":59,"./lib/projections/sterea":60,"./lib/projections/tmerc":61,"./lib/projections/utm":62,"./lib/projections/vandg":63}]},{},[35])(35);
});}.call(exports,(function(){return this;}())));},function(module,exports){(function(exports){var Projection=function(proj){this.proj=new proj4.Proj(proj);
};Projection.prototype={project:function(latlng){var projectedPoint=proj4(this.proj).forward([latlng.lng,latlng.lat]);
return new T.Point(projectedPoint[0],projectedPoint[1]);},unproject:function(point){var unprojectedPoint=proj4(this.proj).inverse([point.x,point.y]);
return new T.LatLng(unprojectedPoint[1],unprojectedPoint[0]);}};exports.Projection=Projection;}(window.T));
},function(module,exports){(function(exports){var SphericalMercator=function(){this.MAX_LATITUDE=85.0511287798*200;
};SphericalMercator.prototype={project:function(latlng){var d=Math.PI/180,max=this.MAX_LATITUDE,lat=Math.max(Math.min(max,latlng.lat),-max),x=latlng.lng*d,y=lat*d;
y=Math.log(Math.tan((Math.PI/4)+(y/2)));return new T.Point(x,y);},unproject:function(point){var d=180/Math.PI,lng=point.x*d,lat=(2*Math.atan(Math.exp(point.y))-(Math.PI/2))*d;
return new T.LatLng(lat,lng);}};exports.SphericalMercator=SphericalMercator;}(window.T));},function(module,exports){(function(exports){var Crs=function(options){var i;
this.code=options.code||"EPSG:3857";this.transformation=options.transform||new T.Transform(1,0,-1,0);
this.resolutions=options.resolutions;this.maxResolution=options.maxResolution;this.projText=options.proj;
this.projection=new T.Projection(options.proj||options.code);this.maxProjected=this.projection.project(new T.LatLng(0,179.9999));
if(!this.resolutions){this.resolutions=[];if(!this.maxResolution){this.maxResolution=2*Math.PI*this.projection.proj.a/256;
}for(i=0;i<19;i++){this.resolutions.push(this.maxResolution/(1<<i));}}this.scales=[];for(i=0;i<this.resolutions.length;
i++){this.scales.push(1/this.resolutions[i]);}};Crs.prototype={project:function(latlng){var point,MAX,factor,latlngClone;
if(this.code==="EPSG:3857"){MAX=20037508.342789233;latlngClone=latlng.clone();this.transformation=new T.Transform(1,MAX,-1,MAX);
factor=this.prepareLatLng(latlngClone);point=this.projection.project(latlngClone);point.x+=this.maxProjected.x*factor;
}else{point=this.projection.project(latlng);}return point;},unproject:function(point){var latlng,factor,MAX,pointClone;
if(this.code==="EPSG:3857"){MAX=20037508.342789233;pointClone=point.clone();this.transformation=new T.Transform(1,MAX,-1,MAX);
factor=this.preparePoint(pointClone);latlng=this.projection.unproject(pointClone);latlng.lng+=180*factor;
}else{latlng=this.projection.unproject(point);}return latlng;},latLngToPoint:function(latlng,zoom){var projectedPoint=this.project(latlng),point=this.transform(projectedPoint,zoom);
return point;},pointToLatLng:function(point,zoom){var untransformedPoint=this.untransform(point,zoom),latlng=this.unproject(untransformedPoint);
return latlng;},transform:function(point,zoom){var scale=this.scale(zoom),transformedPoint=this.transformation.transform(point,scale);
return transformedPoint;},untransform:function(point,zoom){var scale=this.scale(zoom),untransformedPoint=this.transformation.untransform(point,scale);
return untransformedPoint;},scale:function(zoom){return this.scales[zoom];},resolution:function(zoom){return this.resolutions[zoom];
},preparePoint:function(point){if(!point.x||point.x===0){return 0;}var max=this.maxProjected;var sgn=Math.abs(point.x)/point.x;
var factor=Math.floor(Math.abs(point.x/max.x));if(factor>0){point.x=point.x%max.x;}return factor*sgn;
},prepareLatLng:function(latlng){if(!latlng.lng||latlng.lng===0){return 0;}var max=180;var sgn=Math.abs(latlng.lng)/latlng.lng;
var factor=Math.floor(Math.abs(latlng.lng/max));if(factor>0){latlng.lng=latlng.lng%max;}return factor*sgn;
}};exports.Crs=Crs;}(window.T));},function(module,exports){(function(exports){var MouseHandler=function(options){this.dragTargetPrecision=(options&&options.dragTargetPrecision)?options.dragTargetPrecision:500;
};MouseHandler.CLICKS="clicks";MouseHandler.DRAG="drag";MouseHandler.MOUSE_WHEEL="mouse-wheel";MouseHandler.prototype={init:function(map){this.map=map;
this.mouseWheelDelta=0;this.mouseUtil=new T.MouseUtil(this.map.$container);this.enable();},uninit:function(){this.disable();
this.map=null;this.mouseUtil=null;},onClick:function(evt,supressMapEvents){var target=this.findEventInteractiveTarget(evt.target||evt.srcElement),mousePosition=this.map.computeMousePosition(evt),canvasGeometryHit;
if(!target){return;}evt.latLng=this.map.containerPointToLatLng(mousePosition);if(target instanceof T.CanvasLayer){this.handleCanvasLayerEvents(target,evt,"press",this.onClick);
}else{if(target.isClickableLayer){this.map.events.fire("press",evt);}else{if(target&&target.events){target.events.fire("press",evt);
this.customizedEventHandling(target,"press",evt);}}}if(!supressMapEvents){this.map.events.fire("map-press",evt);
}},onDoubleClick:function(evt){var target=this.findEventInteractiveTarget(evt.target||evt.srcElement);
if(!target){return;}this.doubleClickZoom(evt);},onLongClick:function(evt){var target=this.findEventInteractiveTarget(evt.target||evt.srcElement),mousePosition=this.map.computeMousePosition(evt);
if(!target){return;}evt.latLng=this.map.containerPointToLatLng(mousePosition);if(target instanceof T.CanvasLayer){this.handleCanvasLayerEvents(target,evt,"long-press",this.onLongClick);
}else{if(target.isClickableLayer){this.map.events.fire("long-press",evt);}else{if(target&&target.events){target.events.fire("long-press",evt);
this.customizedEventHandling(target,"long-press",evt);}}}},onRightClick:function(evt){var target=this.findEventInteractiveTarget(evt.target||evt.srcElement),mousePosition=this.map.computeMousePosition(evt);
evt.latLng=this.map.containerPointToLatLng(mousePosition);if(target&&target.isClickableLayer){this.map.events.fire("right-click",evt);
}},onMouseOver:function(evt){var mousePosition=this.map.computeMousePosition(evt),target=this.findEventInteractiveTarget(evt.target||evt.srcElement);
if(target){evt.latLng=this.map.containerPointToLatLng(mousePosition);target.events.fire("over",evt);this.customizedEventHandling(target,"over",evt);
}},onMouseOut:function(evt){var mousePosition=this.map.computeMousePosition(evt),target=this.findEventInteractiveTarget(evt.target||evt.srcElement);
if(target){evt.latLng=this.map.containerPointToLatLng(mousePosition);target.events.fire("out",evt);this.customizedEventHandling(target,"out",evt);
}},onBeforeDragStart:function(evt){var target=this.findEventInteractiveTarget(evt.target||evt.srcElement);
if(!target){return;}if(target instanceof T.CanvasLayer){var x=this.handleCanvasLayerEvents(target,evt,null,this.onBeforeDragStart);
if(!x){return;}}if(!target.isDraggable||!target.options.draggable){target=this.map.getTileLayer();}this.currentDragTarget=target;
target.events.fire("before-drag-start",evt);this.customizedEventHandling(target,"before-drag-start",evt);
},onDragStart:function(evt){var target=this.findEventInteractiveTarget(evt.target||evt.srcElement);if(!target){return;
}if(target instanceof T.CanvasLayer){this.handleCanvasLayerEvents(target,evt,null,this.onDragStart);return;
}if(!target.isDraggable||!target.options.draggable){target=this.map.getTileLayer();}target.events.fire("drag-start",evt);
this.customizedEventHandling(target,"drag-start",evt);},onDrag:function(evt){var target=this.currentDragTarget;
if(!target){return;}target.events.fire("drag",evt);this.customizedEventHandling(target,"drag",evt);},onDragEnd:function(evt){var target=this.currentDragTarget;
if(!target){return;}target.events.fire("drag-end",evt);this.customizedEventHandling(target,"drag-end",evt);
this.currentDragTarget=null;},onMouseWheel:function(evt){var target=this.findEventInteractiveTarget(evt.target||evt.srcElement);
if(!target){return;}var util=T.DomEventUtil,delta=util.getWheelDelta(evt),mousePosition=this.map.computeMousePosition(evt),centerInPixels=this.calculateCenterInPixels(mousePosition),center=this.map.unproject(centerInPixels),zoom,self;
this.mouseWheelDelta+=delta;util.stop(evt);clearTimeout(this.tm);self=this;this.tm=setTimeout(function(){zoom=(self.map.getZoom())+Math.floor(self.mouseWheelDelta);
self.map.zoomAround(center,zoom,true);self.mouseWheelDelta=0;},30);},handleCanvasLayerEvents:function(targetObject,evt,eventToFire,callback){var geometryFound=targetObject.getTargetedGeometry(evt);
if(!geometryFound){targetObject.$canvas.style.display="none";var newTarget=document.elementFromPoint(evt.clientX,evt.clientY);
var newEvt=this.mouseUtil.getNewMouseEventWithUsefulProperties(evt,newTarget);callback.call(this,newEvt,true);
targetObject.$canvas.style.display="block";}else{if(eventToFire){geometryFound.events.fire(eventToFire,evt);
this.customizedEventHandling(targetObject,eventToFire,geometryFound,evt);}}return geometryFound;},customizedEventHandling:function(target,eventName,object,evt){if(target.handleEvents){target.handleEvents(eventName,object,evt);
}},findEventInteractiveTarget:function(src){while(src){var target=src.interactiveObject;if(target){return target;
}if(src===this.map.$container.layers){break;}src=src.parentNode;}return null;},doubleClickZoom:function(evt){var util=T.DomEventUtil,mousePosition=this.map.computeMousePosition(evt),centerInPixels=this.calculateCenterInPixels(mousePosition),center=this.map.unproject(centerInPixels);
util.stop(evt);this.map.zoomAround(center,this.map.getZoom()+1,true);},calculateCenterInPixels:function(mousePosition){var pos=mousePosition.substract(this.map.getLayersPos()).add(this.map.getTopLeftInPixels());
return pos;},disable:function(handlerRegion){switch(handlerRegion){case T.MouseHandler.DRAG:this.mouseUtil.events.detach("before-drag",this.onBeforeDragStart);
this.mouseUtil.events.detach("drag-start",this.onDragStart);this.mouseUtil.events.detach("drag",this.onDrag);
this.mouseUtil.events.detach("drag-end",this.onDragEnd);break;case T.MouseHandler.MOUSE_WHEEL:this.mouseUtil.events.detach("mouse-wheel",this.onMouseWheel);
break;case T.MouseHandler.CLICKS:this.mouseUtil.events.detach("click",this.onClick);this.mouseUtil.events.detach("double-click",this.onDoubleClick);
this.mouseUtil.events.detach("long-click",this.onLongClick);this.mouseUtil.events.detach("right-click",this.onRightClick);
this.mouseUtil.events.detach("mouse-over",this.onMouseOver);this.mouseUtil.events.detach("mouse-out",this.onMouseOut);
break;default:this.mouseUtil.events.detach("before-drag",this.onBeforeDragStart);this.mouseUtil.events.detach("drag-start",this.onDragStart);
this.mouseUtil.events.detach("drag",this.onDrag);this.mouseUtil.events.detach("drag-end",this.onDragEnd);
this.mouseUtil.events.detach("mouse-wheel",this.onMouseWheel);this.mouseUtil.events.detach("mouse-over",this.onMouseOver);
this.mouseUtil.events.detach("mouse-out",this.onMouseOut);this.mouseUtil.events.detach("click",this.onClick,this);
this.mouseUtil.events.detach("double-click",this.onDoubleClick);this.mouseUtil.events.detach("long-click",this.onLongClick);
this.mouseUtil.events.detach("right-click",this.onRightClick);this.mouseUtil.disable();break;}},enable:function(handlerRegion){switch(handlerRegion){case T.MouseHandler.DRAG:this.mouseUtil.events.on("before-drag",this.onBeforeDragStart,this);
this.mouseUtil.events.on("drag-start",this.onDragStart,this);this.mouseUtil.events.on("drag",this.onDrag,this);
this.mouseUtil.events.on("drag-end",this.onDragEnd,this);break;case T.MouseHandler.MOUSE_WHEEL:this.mouseUtil.events.on("mouse-wheel",this.onMouseWheel,this);
break;case T.MouseHandler.CLICKS:this.mouseUtil.events.on("click",this.onClick,this);this.mouseUtil.events.on("double-click",this.onDoubleClick,this);
this.mouseUtil.events.on("long-click",this.onLongClick,this);this.mouseUtil.events.on("right-click",this.onRightClick,this);
this.mouseUtil.events.on("mouse-over",this.onMouseOver,this);this.mouseUtil.events.on("mouse-out",this.onMouseOut,this);
break;default:this.mouseUtil.events.on("before-drag",this.onBeforeDragStart,this);this.mouseUtil.events.on("drag-start",this.onDragStart,this);
this.mouseUtil.events.on("drag",this.onDrag,this);this.mouseUtil.events.on("drag-end",this.onDragEnd,this);
this.mouseUtil.events.on("mouse-wheel",this.onMouseWheel,this);this.mouseUtil.events.on("mouse-over",this.onMouseOver,this);
this.mouseUtil.events.on("mouse-out",this.onMouseOut,this);this.mouseUtil.events.on("click",this.onClick,this);
this.mouseUtil.events.on("double-click",this.onDoubleClick,this);this.mouseUtil.events.on("long-click",this.onLongClick,this);
this.mouseUtil.events.on("right-click",this.onRightClick,this);this.mouseUtil.enable();break;}},remove:function(){this.mouseUtil.disable();
this.mouseUtil.events.detachAll();this.map=null;this.mouseUtil=null;}};exports.MouseHandler=MouseHandler;
}(window.T));},function(module,exports){(function(exports){var TouchHandler=function(options){this.animMatrix=new T.Matrix2D();
};TouchHandler.TAPS="taps";TouchHandler.MOVE="move";TouchHandler.prototype={init:function(map){this.map=map;
this.touchUtil=new T.TouchUtil(this.map.$container);this.enable();},uninit:function(){this.disable();
this.map=null;this.touchUtil=null;},onTap:function(evt,supressMapEvents){var target=this.findEventInteractiveTarget(evt.target||evt.srcElement),newEvtData=this.touchUtil.getNewMouseEventWithUsefulProperties(evt,target),mousePosition=this.map.computeMousePosition(newEvtData),canvasGeometryHit;
if(!target){return;}newEvtData.latLng=this.map.containerPointToLatLng(mousePosition);if(target instanceof T.CanvasLayer){this.handleCanvasLayerEvents(target,newEvtData,"press",this.onTap);
}else{if(target.isClickableLayer){this.map.events.fire("press",newEvtData);}else{if(target&&target.events){target.events.fire("press",newEvtData);
this.customizedEventHandling(target,"press",evt);}}}if(!supressMapEvents){this.map.events.fire("map-press",newEvtData);
}},onDoubleTap:function(evt){var target=this.findEventInteractiveTarget(evt.target||evt.srcElement);if(!target){return;
}this.doubleTouchZoom(evt);},onLongTap:function(evt){var target=this.findEventInteractiveTarget(evt.target||evt.srcElement),newEvtData=this.touchUtil.getNewMouseEventWithUsefulProperties(evt,target),mousePosition=this.map.computeMousePosition(newEvtData);
if(!target){return;}newEvtData.latLng=this.map.containerPointToLatLng(mousePosition);if(target instanceof T.CanvasLayer){this.handleCanvasLayerEvents(target,newEvtData,"long-press",this.onLongTap);
}else{if(target.isClickableLayer){this.map.events.fire("long-press",newEvtData);}else{if(target&&target.events){target.events.fire("long-press",newEvtData);
this.customizedEventHandling(target,"long-press",evt);}}}},onTouchStart:function(evt){var target=this.findEventInteractiveTarget(evt.target||evt.srcElement),newEvtData=this.touchUtil.getNewMouseEventWithUsefulProperties(evt,target);
if(!target){return;}if(target instanceof T.CanvasLayer){this.handleCanvasLayerEvents(target,newEvtData,null,this.onTouchStart);
return;}if(!target.isDraggable||!target.options.draggable){target=this.map.getTileLayer();}this.currentDragTarget=target;
target.events.fire("before-drag-start",newEvtData);this.customizedEventHandling(target,"before-drag-start",evt);
},onTouchMove:function(evt){var target=this.currentDragTarget||this.findEventInteractiveTarget(evt.target||evt.srcElement),newEvtData=this.touchUtil.getNewMouseEventWithUsefulProperties(evt,target),dragContainer=null;
if(!target){return;}target.events.fire("drag",newEvtData);this.customizedEventHandling(target,"drag",evt);
},onTouchEnd:function(evt){var target=this.findEventInteractiveTarget(evt.target||evt.srcElement),newEvtData=this.touchUtil.getNewMouseEventWithUsefulProperties(evt,target);
if(!target){return;}if(target instanceof T.CanvasLayer){this.handleCanvasLayerEvents(target,newEvtData,null,this.onTouchEnd);
}if(!target.isDraggable||!target.options.draggable){target=this.map.getTileLayer();}this.currentDragTarget=null;
target.events.fire("drag-end",newEvtData);this.customizedEventHandling(target,"drag-end",evt);},onPinchZoom:function(evt,center,scale,delta){var newContinuousZoom=scale,mapPoint=this.map.computeMousePosition(new T.Point(center.x,center.y)).substract(this.map.getLayersPos()),matrixA=new T.Matrix2D(1,0,0,1,-mapPoint.x,-mapPoint.y),matrixB=new T.Matrix2D(scale,0,0,scale,delta.x,delta.y),matrixC=new T.Matrix2D(1,0,0,1,mapPoint.x,mapPoint.y),m=matrixC.multiplyBy(matrixB).multiplyBy(matrixA);
if(T.AnimUtil.canAnim()){m=m.multiplyBy(this.animMatrix);T.AnimUtil.setMatrix(this.map.$layers,m.toString());
}},onPinchZoomChanged:function(evt,center,scale,delta){var mapPoint=this.map.computeMousePosition(new T.Point(center.x,center.y)).substract(this.map.getLayersPos()),matrixA=new T.Matrix2D(1,0,0,1,-mapPoint.x,-mapPoint.y),matrixB=new T.Matrix2D(scale,0,0,scale,delta.x,delta.y),matrixC=new T.Matrix2D(1,0,0,1,mapPoint.x,mapPoint.y),m=matrixC.multiplyBy(matrixB).multiplyBy(matrixA);
this.animMatrix=m.multiplyBy(this.animMatrix);},onPinchZoomEnd:function(evt,center,scale,delta){var zoomDiff=Math.log(this.animMatrix.m11)/Math.LN2;
var zoom=(this.map.getZoom()+(this.animMatrix.m11<1?Math.floor(zoomDiff):Math.ceil(zoomDiff)))||1;var newScale=(this.animMatrix.m11<1?Math.floor(zoomDiff):Math.ceil(zoomDiff));
var mapPoint=this.map.computeMousePosition(new T.Point(center.x+delta.x,center.y+delta.y)).substract(this.map.getLayersPos());
var topleft=this.map.getTopLeftInPixels();var inverse=this.animMatrix.inverse();var newMapPoint=new T.Point(mapPoint.x*(inverse.m11)+inverse.m13,mapPoint.y*(inverse.m22)+inverse.m23);
var point=topleft.add(newMapPoint);var latLng=this.map.unproject(point);var newPoint=this.map.project(latLng,zoom);
var center=newPoint.substract(new T.Point(center.x+delta.x,center.y+delta.y)).add(this.map.getSize().divideBy(2));
var centerLatLng=this.map.unproject(center,zoom);this.map.resetView(centerLatLng,zoom,true);this.animMatrix=new T.Matrix2D();
},disable:function(handlerRegion){switch(handlerRegion){case T.TouchHandler.TAPS:this.touchUtil.events.detach("tap",this.onTap);
this.touchUtil.events.detach("double-tap",this.onDoubleTap);this.touchUtil.events.detach("long-tap",this.onLongTap);
break;case T.TouchHandler.MOVE:this.touchUtil.events.detach("touch-start",this.onTouchStart);this.touchUtil.events.detach("touch-move-start",this.onTouchStart);
this.touchUtil.events.detach("touch-move",this.onTouchMove);this.touchUtil.events.detach("touch-end",this.onTouchEnd);
this.touchUtil.events.detach("touch-pinch",this.onPinchZoom);this.touchUtil.events.detach("touch-pinch-change",this.onPinchZoomChanged);
this.touchUtil.events.detach("touch-pinch-end",this.onPinchZoomEnd);break;default:this.touchUtil.events.detach("tap",this.onTap,this);
this.touchUtil.events.detach("double-tap",this.onDoubleTap,this);this.touchUtil.events.detach("long-tap",this.onLongTap,this);
this.touchUtil.events.detach("touch-start",this.onTouchStart,this);this.touchUtil.events.detach("touch-move-start",this.onTouchStart,this);
this.touchUtil.events.detach("touch-move",this.onTouchMove,this);this.touchUtil.events.detach("touch-end",this.onTouchEnd,this);
this.touchUtil.events.detach("touch-pinch",this.onPinchZoom,this);this.touchUtil.events.detach("touch-pinch-change",this.onPinchZoomChanged,this);
this.touchUtil.events.detach("touch-pinch-end",this.onPinchZoomEnd,this);this.touchUtil.disable();break;
}},enable:function(handlerRegion){switch(handlerRegion){case T.TouchHandler.TAPS:this.touchUtil.events.on("tap",this.onTap,this);
this.touchUtil.events.on("double-tap",this.onDoubleTap,this);this.touchUtil.events.on("long-tap",this.onLongTap,this);
break;case T.TouchHandler.MOVE:this.touchUtil.events.on("touch-start",this.onTouchStart,this);this.touchUtil.events.on("touch-move-start",this.onTouchStart,this);
this.touchUtil.events.on("touch-move",this.onTouchMove,this);this.touchUtil.events.on("touch-end",this.onTouchEnd,this);
this.touchUtil.events.on("touch-pinch",this.onPinchZoom,this);this.touchUtil.events.on("touch-pinch-change",this.onPinchZoomChanged,this);
this.touchUtil.events.on("touch-pinch-end",this.onPinchZoomEnd,this);break;default:this.touchUtil.events.on("tap",this.onTap,this);
this.touchUtil.events.on("double-tap",this.onDoubleTap,this);this.touchUtil.events.on("long-tap",this.onLongTap,this);
this.touchUtil.events.on("touch-start",this.onTouchStart,this);this.touchUtil.events.on("touch-move-start",this.onTouchStart,this);
this.touchUtil.events.on("touch-move",this.onTouchMove,this);this.touchUtil.events.on("touch-end",this.onTouchEnd,this);
this.touchUtil.events.on("touch-pinch",this.onPinchZoom,this);this.touchUtil.events.on("touch-pinch-change",this.onPinchZoomChanged,this);
this.touchUtil.events.on("touch-pinch-end",this.onPinchZoomEnd,this);this.touchUtil.enable();break;}},remove:function(){this.touchUtil.disable();
this.touchUtil.events.detachAll();this.map=null;this.touchUtil=null;},doubleTouchZoom:function(evt){var util=T.DomEventUtil,touchEvent=this.getPointerEvent(evt),mousePosition=this.map.computeMousePosition(touchEvent),centerInPixels=this.calculateCenterInPixels(mousePosition),center=this.map.unproject(centerInPixels);
util.stop(evt);this.map.zoomAround(center,this.map.getZoom()+1,true);},calculateCenterInPixels:function(mousePosition){var pos=mousePosition.substract(this.map.getLayersPos()).add(this.map.getTopLeftInPixels());
return pos;},getPointerEvent:function(event){return event.changedTouches?event.changedTouches[0]:event;
},handleCanvasLayerEvents:function(targetObject,evt,eventToFire,callback){var geometryFound=targetObject.getTargetedGeometry(evt);
if(!geometryFound){targetObject.$canvas.style.display="none";var newTarget=document.elementFromPoint(evt.clientX,evt.clientY);
evt.target=newTarget;callback.call(this,evt,true);targetObject.$canvas.style.display="block";}else{if(eventToFire){geometryFound.events.fire(eventToFire,evt);
this.customizedEventHandling(targetObject,eventToFire,geometryFound,evt);}}},customizedEventHandling:function(target,eventName,object,evt){if(target.handleEvents){target.handleEvents(eventName,object,evt);
}},findEventInteractiveTarget:function(src){while(src){var target=src.interactiveObject;if(target){return target;
}if(src===this.map.$container.layers){break;}src=src.parentNode;}return null;}};exports.TouchHandler=TouchHandler;
}(window.T));},function(module,exports){(function(exports){var Map=function(container,options){if(!container){throw new Error("Map container not found.");
}this._targets={};this.layersArray=[];this.options=T.Util.defaults(options,this.options);this.zoom=this.options.zoom;
this.center=this.options.center;this.events=new T.EventDispatcher();this.lastTransform={matrix:new T.Matrix2D()};
this.initContainer(container);if(!this.options.skipDefaultHandlers){this.initHandlers();}this.initControls();
this.initPosition();this.resetView(this.center,this.zoom);};Map.prototype={options:{zoom:5,minZoom:1,maxZoom:18,maxExtent:null,center:new T.LatLng(46,2),crs:new T.Crs({code:"EPSG:3857"}),repeatX:true,repeatY:false,urlLocation:false,noHistory:true,geolocate:false,controls:{attribution:{prefix:"<a target='_blank' href='http://www.tibco.com/assets/blt59b361e6644c8d3a/tibco-end-user-license-agreement_tcm8-9378.pdf'>TIBCO GeoAnalytics</a>"}}},initContainer:function(container){this.$container=container;
this.$container.map=this;this.$container.style.overflow="hidden";this.$container.style.position="relative";
T.DomUtil.addClass(this.$container,"tibco-map");var layers=this.$container.layers=T.DomUtil.create("div","layers-container",this.$container,"layers-container");
var controls=this.$container.controls=T.DomUtil.create("div","controls-container",this.$container);layers.style.position="absolute";
T.DomUtil.position(layers,new T.Point(0,0));T.DomEventUtil.on(window,"resize",this.reset,this);this.$layers=layers;
},destroy:function(){var i=0;T.DomEventUtil.off(window,"resize",this.reset,this);for(i=0;i<this.layersArray.length;
i++){this.removeLayer(this.layersArray[i]);}this.$layers=null;this.layersArray=null;this.uninitHandlers();
this.$container.map=null;this.$container.innerHTML="";},initHandlers:function(){this.mouseHandler=new T.MouseHandler();
this.addHandler(this.mouseHandler);if(T.Util.touchSupport()){this.touchHandler=new T.TouchHandler();this.addHandler(this.touchHandler);
}},uninitHandlers:function(){if(this.mouseHandler){this.removeHandler(this.mouseHandler);}if(this.touchHandler){this.removeHandler(this.touchHandler);
}},initControls:function(){if(!(this.options.controls.contextMenu&&this.options.controls.contextMenu.addToMap===false)){this.addControl(new T.ContextMenuControl(this.options.controls.contextMenu));
}if(!(this.options.controls.attribution&&this.options.controls.attribution.addToMap===false)){this.addControl(new T.AttributionControl(this.options.controls.attribution));
}if(!(this.options.controls.scale&&this.options.controls.scale.addToMap===false)){this.addControl(new T.ScaleControl(this.options.controls.scale));
}},initPosition:function(){if(this.options.geolocate&&T.Util.browserSupportsGeolocation()){this.setPositionFromGeolocation();
}else{this.setPositionFromUrl();}},addHandler:function(handler){handler.init(this);},removeHandler:function(handler){handler.uninit();
},addControl:function(control){control.onAdd(this);return this;},reset:function(){this.resetView(this.getCenter(),this.zoom);
},resetView:function(center,zoom,hard){this.sizeChanged=true;if(this.lastTransform.matrix){var matrix=this.lastTransform.matrix;
if(matrix.m11===1&&matrix.m22===1){matrix=this.computeTransformMatrix(this.calculateCenterInPixel(),zoom);
}matrix.m13+=this.getLayersPos().x;matrix.m23+=this.getLayersPos().y;}this.zoom=this.limitZoom(zoom);
this.center=center;T.DomUtil.position(this.$container.layers,new T.Point(0,0));T.AnimUtil.reset(this.$layers);
if(hard){this.events.fire("hard-reset");}this.events.fire("view-reset");},addLayer:function(layer){this.layersArray.push(layer);
layer.onAdd(this);this.events.fire("layer-add",layer);return this;},removeLayer:function(layer){var layerIndex=this.getLayerIndex(layer);
if(layerIndex===-1){return;}this.layersArray.splice(layerIndex,1);layer.onRemove();this.events.fire("layer-remove",layer);
return this;},getSize:function(){if(!this.size||this.sizeChanged){this.size=new T.Point(this.$container.clientWidth,this.$container.clientHeight);
this.sizeChanged=false;}return this.size.clone();},setDefaults:function(defaults){this.options=T.Util.defaults(defaults,this.options);
},setCrs:function(crs){this.options.crs=crs;this.options.minZoom=0;this.options.maxZoom=crs.resolutions.length-1;
this.events.fire("zoom-interval-change");},setCenter:function(center){this.resetView(center,this.getZoom());
},setZoom:function(zoom){this.zoomAround(this.calculateCenter(),zoom);},setUrlLocation:function(){var urlLocationString=null;
if(this.options.urlLocation){urlLocationString="@"+this.getCenter().lat.toFixed(7)+","+this.getCenter().lng.toFixed(7)+","+this.getZoom()+"z";
if(T.Util.browserSupportsHistoryApi()){T.Util.setBrowserHistory("#"+urlLocationString,this.options.noHistory);
T.Util.handleBrowserNavigation(T.Util.bind(function(){},this));}else{T.Util.setBrowserUrlHash(urlLocationString);
}}},setPositionFromUrl:function(){var urlPosition=T.Util.getBrowserUrlHash(),urlContent=null,urlItems=[],latitude=null,longitude=null,zoom=null;
if(!this.options.urlLocation){return;}if(urlPosition&&urlPosition.length>1){urlContent=urlPosition.substring(1,urlPosition.length);
urlItems=urlContent.split(",");if(urlItems.length===3){latitude=parseFloat(urlItems[0].substring(1,urlItems[0].length));
longitude=parseFloat(urlItems[1]);zoom=parseInt(urlItems[2],10);this.center=new T.LatLng(latitude,longitude);
this.zoom=zoom;this.resetView(this.center,this.zoom);}else{this.zoom=this.options.zoom;this.center=this.options.center;
this.resetView(this.center,this.zoom);}}},setPositionFromGeolocation:function(){T.Util.geolocate(T.Util.bind(function(latitude,longitude){if(latitude&&longitude){this.center=new T.LatLng(latitude,longitude);
this.zoom=14;this.resetView(this.center,this.zoom);}else{this.setPositionFromUrl();}},this),T.Util.bind(function(error){this.setPositionFromUrl();
},this));},getZoom:function(){return this.zoom;},getCenter:function(){return this.calculateCenter();},getViewportCenter:function(){return this.center.clone();
},getCenterInPixels:function(){return this.project(this.getViewportCenter(),this.getZoom());},getTopLeftInPixels:function(){return this.getCenterInPixels().substract(this.getSize().divideBy(2));
},getResolution:function(){return this.options.crs.resolution(this.zoom);},latLngToPoint:function(latlng){latlng=T.LatLng.from(latlng);
var projectedPoint=this.project(latlng).round();return projectedPoint.substract(this.getTopLeftInPixels());
},pointToLatLng:function(point){var projectedPoint=point.add(this.getTopLeftInPixels());return this.unproject(projectedPoint);
},getLayersCenter:function(){var layerPoint=this.getSize().divideBy(2).substract(this.getLayersPos());
return layerPoint;},getPixelBounds:function(){var topLeft=this.calculateTopLeft();return new T.Bounds(topLeft,topLeft.add(this.getSize()));
},getLayersPos:function(){return T.DomUtil.position(this.$container.layers);},getLayers:function(){return this.layersArray;
},calculateCenter:function(){return this.unproject(this.calculateCenterInPixel());},calculateCenterInPixel:function(){var projectedCenter=this.getLayersCenter().add(this.getTopLeftInPixels());
return projectedCenter;},calculateTopLeft:function(){var half=this.getSize().divideBy(2);var topLeft=this.getCenterInPixels().substract(half).substract(this.getLayersPos());
return topLeft;},latLngToContainerPoint:function(latlng){latlng=T.LatLng.from(latlng);var projectedPoint=this.project(latlng).round();
return projectedPoint.substract(this.calculateTopLeft());},containerPointToLatLng:function(point){return this.unproject(this.calculateTopLeft().add(point));
},getMapResolution:function(){var point=this.getCenter();var zoom=this.getZoom();var tileSize=256;var earthRadius=6378137;
var res=(Math.cos(point.lat*Math.PI/180)*2*Math.PI*earthRadius)/(tileSize*Math.pow(2,zoom));return res;
},metersToArcAngle:function(meters,latlng){var equatorialArc=meters*360/40075016;return equatorialArc/Math.cos(latlng.lat*Math.PI/180);
},panBy:function(offset,skipRefresh){if(this.animatingZoom){return;}this.events.fire("move-start");T.DomUtil.position(this.$container.layers,this.getLayersPos().add(offset));
this.events.fire("move");if(!skipRefresh){this.events.fire("move-end");}return this;},zoomAround:function(latlng,zoom,withAnim,force){zoom=this.limitZoom(zoom);
withAnim=withAnim||false;if(zoom===this.zoom&&!force){return;}var point=this.project(latlng);var newPoint=this.project(latlng,zoom);
var diff=newPoint.substract(point);var pixelCenter=this.calculateCenterInPixel().add(diff);var latLngCenter=this.unproject(pixelCenter,zoom);
var matrix=this.computeTransformMatrix(point,zoom);if(T.AnimUtil.canAnim()&&withAnim){if(this.animatingZoom){return;
}this.animatingZoom=true;if(this.mouseHandler){this.mouseHandler.disable(T.MouseHandler.DRAG);}if(this.touchHandler){this.touchHandler.disable(T.TouchHandler.MOVE);
}var self=this;T.AnimUtil.onTransitionEnd(this.$layers,function(){if(self.mouseHandler){self.mouseHandler.enable(T.MouseHandler.DRAG);
}if(self.touchHandler){self.touchHandler.enable(T.TouchHandler.MOVE);}self.animatingZoom=null;self.lastTransform.matrix=new T.Matrix2D(T.AnimUtil.getTransform(self.$layers));
self.resetView(latLngCenter,zoom);});T.AnimUtil.transition(this.$layers,0.1);T.AnimUtil.setMatrix(this.$layers,matrix.toString());
}else{this.lastTransform.matrix=matrix;this.resetView(latLngCenter,zoom);}},limitBounds:function(){if(!this.options.maxExtent){return;
}var currentBounds=this.getBounds(),maxBounds=this.options.maxExtent,newBounds=new T.LatLngBounds(currentBounds.getSouthWest(),currentBounds.getNorthEast()),boundsChanged=false;
if(!T.Util.floatEqual(currentBounds.northEast.lat,maxBounds.northEast.lat)&&currentBounds.northEast.lat>maxBounds.northEast.lat){boundsChanged=true;
newBounds.northEast.lat=maxBounds.northEast.lat;newBounds.southWest.lat-=currentBounds.northEast.lat-maxBounds.northEast.lat;
}else{if(!T.Util.floatEqual(currentBounds.southWest.lat,maxBounds.southWest.lat)&&currentBounds.southWest.lat<maxBounds.southWest.lat){boundsChanged=true;
newBounds.southWest.lat=maxBounds.southWest.lat;newBounds.northEast.lat-=currentBounds.southWest.lat-maxBounds.southWest.lat;
}}if(!T.Util.floatEqual(currentBounds.northEast.lng,maxBounds.northEast.lng)&&currentBounds.northEast.lng>maxBounds.northEast.lng){boundsChanged=true;
newBounds.northEast.lng=maxBounds.northEast.lng;newBounds.southWest.lng-=currentBounds.northEast.lng-maxBounds.northEast.lng;
}else{if(!T.Util.floatEqual(currentBounds.southWest.lng,maxBounds.southWest.lng)&&currentBounds.southWest.lng<maxBounds.southWest.lng){boundsChanged=true;
newBounds.southWest.lng=maxBounds.southWest.lng;newBounds.northEast.lng-=currentBounds.southWest.lng-maxBounds.southWest.lng;
}}if(boundsChanged){this.fitToBounds(newBounds,20);}},limitZoom:function(zoom){var maxExtentZoom=(this.options.maxExtent)?this.getZoomForBounds(this.options.maxExtent)+1:zoom;
return T.Util.maxMin(this.options.maxZoom,maxExtentZoom,T.Util.minMax(this.options.minZoom,this.options.maxZoom,zoom));
},project:function(latlng,zoom){zoom=zoom===undefined?this.zoom:zoom;return this.options.crs.latLngToPoint(latlng,zoom);
},unproject:function(point,zoom){zoom=zoom===undefined?this.zoom:zoom;return this.options.crs.pointToLatLng(point,zoom);
},transform:function(point,zoom){zoom=zoom===undefined?this.zoom:zoom;return this.options.crs.transform(point,zoom);
},untransform:function(point,zoom){zoom=zoom===undefined?this.zoom:zoom;return this.options.crs.untransform(point,zoom);
},fitToBounds:function(bounds,tolerance,hard){var zoom=this.getZoomForBounds(bounds,tolerance);var ne=this.project(bounds.getNorthEast(),zoom);
var sw=this.project(bounds.getSouthWest(),zoom);var center=this.unproject(sw.add(ne).divideBy(2),zoom);
this.resetView(center,zoom,hard);},getBounds:function(){var pixelBounds=this.getPixelBounds();var bottomLeft=this.unproject(pixelBounds.bottomLeft());
var topRight=this.unproject(pixelBounds.topRight());var bounds=new T.LatLngBounds(bottomLeft,topRight);
return bounds;},getProjectedBounds:function(){var key,queryParams=this.options.queryParams,image=this.image,crs=this.options.crs,size=this.getSize(),bottomLeft=new T.Point(0,0),topRight=new T.Point(0,0),projCenter=this.untransform(this.calculateCenterInPixel()),half=size.divideBy(2).multiplyBy(crs.resolutions[this.getZoom()]);
bottomLeft.x=projCenter.x-half.x;bottomLeft.y=projCenter.y-half.y;topRight.x=projCenter.x+half.x;topRight.y=projCenter.y+half.y;
var bounds=new T.Bounds(bottomLeft,topRight);return bounds;},getZoomForBounds:function(bounds,tolerance){var zoom=this.options.minZoom,viewportSize=this.getSize(),i=0;
tolerance=tolerance||0;for(i=this.options.minZoom;i<=this.options.maxZoom;i++){var topRight=this.project(bounds.getNorthEast(),i);
var bottomLeft=this.project(bounds.getSouthWest(),i);var bWidth=topRight.x-bottomLeft.x;var bHeight=bottomLeft.y-topRight.y;
if(bWidth-tolerance<=viewportSize.x&&bHeight-tolerance<=viewportSize.y){zoom=i;}}return zoom;},getLayerIndex:function(layer){return this.layersArray.indexOf(layer);
},getTileLayer:function(){var i=0;for(i=0;i<this.layersArray.length;i++){if(this.layersArray[i] instanceof T.TibcoLayer||this.layersArray[i] instanceof T.TileLayer||this.layersArray[i] instanceof T.GoogleLayer){return this.layersArray[i];
}}return null;},computeMousePosition:function(evt){var point;if(evt instanceof T.Point){point=evt;}else{if(arguments.length===2){point=new T.Point(arguments[0],arguments[1]);
}else{point=new T.Point(evt.clientX,evt.clientY);}}var offset=T.DomUtil.calculateElementClientOffset(this.$container);
var containerOffset=new T.Point(offset.left,offset.top);var mousePosition=new T.Point(point.x,point.y).substract(containerOffset);
return mousePosition;},moveLayer:function(layer,newLayerIndex){if(!layer||layer.getIndex()===newLayerIndex||newLayerIndex<0||newLayerIndex>=this.layersArray.length){return;
}var referenceLayerElement=this.$layers.children.item(newLayerIndex);layer.getContainer().parentNode.removeChild(layer.getContainer());
if(layer.getIndex()>newLayerIndex){this.$layers.insertBefore(layer.getContainer(),referenceLayerElement);
}else{referenceLayerElement.parentNode.insertBefore(layer.getContainer(),referenceLayerElement.nextSibling);
}this.layersArray.splice(layer.getIndex(),1);this.layersArray.splice(newLayerIndex,0,layer);this.events.fire("layer-moved",layer);
},moveLayerUp:function(layer){if(layer.getIndex()!==-1&&layer.getIndex()!==this.layersArray.length-1){this.moveLayer(layer,layer.getIndex()+1);
}},moveLayerDown:function(layer){if(layer.getIndex()!==-1&&layer.getIndex()!==0){this.moveLayer(layer,layer.getIndex()-1);
}},computeTransformMatrix:function(point,zoom){var zoomDiff=zoom-this.getZoom();var ratio=Math.pow(2,zoomDiff);
var posDiff=this.getLayersPos().substract(point.substract(this.calculateTopLeft()));var newPosition=posDiff.multiplyBy(ratio).substract(posDiff);
var matrix=new T.Matrix2D(ratio,0,0,ratio,newPosition.x,newPosition.y);return matrix;},onBeforeDragStart:function(evt){this.startPoint=new T.Point(evt.clientX,evt.clientY);
this.startPos=T.DomUtil.position(this.$container.layers);},onDragStart:function(evt){var newPoint=new T.Point(evt.clientX,evt.clientY),offset=newPoint.substract(this.startPoint);
this.moved=true;this.startPos=T.DomUtil.position(this.$container.layers).substract(offset);},onDrag:function(evt){var newPoint=new T.Point(evt.clientX,evt.clientY),offset=newPoint.substract(this.startPoint),newPosition=this.startPos.add(offset);
T.DomUtil.position(this.$container.layers,newPosition);this.events.fire("move",evt);},onDragEnd:function(evt){this.events.fire("move-end",evt);
}};exports.Map=Map;}(window.T));},function(module,exports){(function(exports){var MapTypes={STANDARD:"Standard map",STANDARD_LIGHT:"Standard map - light",BASIC:"Basic map",BASIC_LIGHT:"Basic map - light",BORDERS:"Borders",LABELS:"Labels",ROADS:"Roads",};
exports.MapTypes=MapTypes;}(window.T));},function(module,exports){(function(exports){var MapStyles={LIGHT:"Light",DARK:"Dark"};
exports.MapStyles=MapStyles;}(window.T));},function(module,exports){(function(exports){var Path=function(options){this.type="path";
this.options=T.Util.defaults(options,this.options);this.style=T.Util.defaults({},this.options.style);
this.events=new T.EventDispatcher();};Path.prototype={options:{path:"",clickable:true,reverseCoordinates:false},style:null,initContainer:function(){if(this.context){this.context.initContainer(this);
}},setStyle:function(style){T.Util.extend(this.style,style);this.draw();},handleEvents:function(eventName,evt){this.layer.events.fire(eventName,this,evt);
},getStyle:function(){return this.context.options.style;},projectCoords:function(){},reset:function(){if(this.context){this.projectCoords();
this.draw();}},draw:function(){if(this.context){this.context.applyStyle(this);this.context.draw(this);
}},extendBounds:function(coords,bounds){if(!T.Util.isArray(coords[0])){var latLng=this.options.reverseCoordinates?new T.LatLng(coords[1],coords[0]):new T.LatLng(coords[0],coords[1]);
bounds.extend(latLng);return;}var i;for(i=0;i<coords.length;i++){this.extendBounds(coords[i],bounds);
}},getBounds:function(){if(!this.coords){return;}var bounds=new T.LatLngBounds();this.extendBounds(this.coords,bounds);
return bounds;},onAdd:function(layer){var defaultStyle=T.Util.clone(layer.options.defaultStyle);this.layer=layer;
this.context=layer.context;this.initContainer();this.setStyle(T.Util.extend(defaultStyle,this.style));
this.reset();},onRemove:function(layer){this.context.dispose(this);this.context=null;this.layer=null;
}};exports.Path=Path;}(window.T));},function(module,exports){(function(exports){var Polyline=function(coords,options){T.Path.call(this,options);
this.type="polyline";this.coords=coords;this.projectedCoords=[];this.noneFillGeometry=true;};Polyline.prototype={projectCoords:function(){var i,j;
this.projectedCoords=[];for(i=0;i<this.coords.length;i++){this.projectedCoords.push(this.layer.map.latLngToContainerPoint(this.options.reverseCoordinates?this.coords[i].concat().reverse():this.coords[i]).floor());
}}};T.Util.inherit(Polyline,T.Path);exports.Polyline=Polyline;}(window.T));},function(module,exports){(function(exports){var Polygon=function(coords,options){T.Path.call(this,options);
this.type="polygon";this.coords=coords;this.projectedCoords=[];};Polygon.prototype={projectCoords:function(){var i,j,k,line;
this.projectedCoords=[];for(i=0;i<this.coords.length;i++){line=[];for(j=0;j<this.coords[i].length;j++){line.push(this.layer.map.latLngToContainerPoint(this.options.reverseCoordinates?this.coords[i][j].concat().reverse():this.coords[i][j]).floor());
}this.projectedCoords.push(line);}}};T.Util.inherit(Polygon,T.Path);exports.Polygon=Polygon;}(window.T));
},function(module,exports){(function(exports){var MultiPolyline=function(coords,options){T.Path.call(this,options);
this.type="multipolyline";this.coords=coords;this.projectedCoords=[];this.noneFillGeometry=true;};MultiPolyline.prototype={projectCoords:function(){var i,j,k,line=[];
this.projectedCoords=[];for(i=0;i<this.coords.length;i++){line=[];for(j=0;j<this.coords[i].length;j++){line.push(this.layer.map.latLngToContainerPoint(this.options.reverseCoordinates?this.coords[i][j].concat().reverse():this.coords[i][j]).floor());
}this.projectedCoords.push(line);}}};T.Util.inherit(MultiPolyline,T.Path);exports.MultiPolyline=MultiPolyline;
}(window.T));},function(module,exports){(function(exports){var MultiPolygon=function(coords,options){T.Path.call(this,options);
this.type="multipolygon";this.coords=coords;this.projectedCoords=[];};MultiPolygon.prototype={projectCoords:function(){var i,j,k,line=[],poly=[];
this.projectedCoords=[];for(k=0;k<this.coords.length;k++){poly=[];for(i=0;i<this.coords[k].length;i++){line=[];
for(j=0;j<this.coords[k][i].length;j++){line.push(this.layer.map.latLngToContainerPoint(this.options.reverseCoordinates?this.coords[k][i][j].concat().reverse():this.coords[k][i][j]).floor());
}poly.push(line);}this.projectedCoords.push(poly);}}};T.Util.inherit(MultiPolygon,T.Path);exports.MultiPolygon=MultiPolygon;
}(window.T));},function(module,exports){(function(exports){var Rectangle=function(bounds,options){T.Polygon.call(this,this.boundsToCoordinates(bounds),options);
this.type="rectangle";this.projectedCoords=[];};Rectangle.prototype={setBounds:function(bounds){this.coords=this.boundsToCoordinates(bounds);
this.reset();},boundsToCoordinates:function(bounds){bounds=T.LatLngBounds.from(bounds);return[[bounds.getSouthWest(),bounds.getSouthEast(),bounds.getNorthEast(),bounds.getNorthWest()]];
}};T.Util.inherit(Rectangle,T.Polygon);exports.Rectangle=Rectangle;}(window.T));},function(module,exports){(function(exports){var Circle=function(center,radius,options){T.Path.call(this,options);
this.type="circle";this.radius=radius||100;this.center=T.LatLng.from(center);this.radiusMeasure=options.radiusMeasure==="meter"?options.radiusMeasure:"pixel";
this.isDraggable=true;};Circle.prototype={setRadius:function(radius){this.radius=radius;this.reset();
},setCenter:function(center){this.center=T.LatLng.from(center);this.reset();},projectCoords:function(){this.projectedCenter=this.layer.map.latLngToContainerPoint(this.options.reverseCoordinates?[this.center.lng,this.center.lat]:[this.center.lat,this.center.lng]).floor();
if(this.radiusMeasure==="meter"){var diff=this.layer.map.metersToArcAngle(this.radius,this.center);this.porjectedStartPoint=this.layer.map.latLngToContainerPoint(this.options.reverseCoordinates?[this.center.lng,this.center.lat-diff]:[this.center.lat,this.center.lng-diff]).floor();
}else{this.porjectedStartPoint=this.projectedCenter.clone().substract(new T.Point(this.radius,0));}}};
T.Util.inherit(Circle,T.Path);exports.Circle=Circle;}(window.T));},function(module,exports){(function(exports){var SvgContext=function(svg,options){this.options=T.Util.defaults(options,this.options);
this.$svg=svg;};SvgContext.prototype={initContainer:function(geometry){if(!geometry.$container){geometry.$container=T.DomUtil.createSvgElement("g");
geometry.$path=T.DomUtil.createSvgElement("path");geometry.$path.setAttributeNS(null,"fill-rule","evenodd");
geometry.$path.style.pointerEvents="visiblepainted";geometry.$container.appendChild(geometry.$path);}this.$svg.$g.appendChild(geometry.$container);
},applyStyle:function(geometry){var style=geometry.style;if(style.stroke){geometry.$path.setAttributeNS(null,"stroke",style.color);
geometry.$path.setAttributeNS(null,"stroke-opacity",style.opacity);geometry.$path.setAttributeNS(null,"stroke-width",style.weight);
geometry.$path.setAttributeNS(null,"stroke-linecap",style.lineCap);geometry.$path.setAttributeNS(null,"stroke-linejoin",style.lineJoin);
geometry.$path.setAttributeNS(null,"stroke-miterlimit",style.miterLimit);geometry.$path.setAttributeNS(null,"stroke-dasharray",style.dashArray);
}else{geometry.$path.setAttribute("stroke","none");}if(style.fill&&!geometry.noneFillGeometry){geometry.$path.setAttributeNS(null,"fill",style.fillColor||style.color);
geometry.$path.setAttributeNS(null,"fill-opacity",style.fillOpacity);}else{geometry.$path.setAttributeNS(null,"fill","none");
}},getPathString:function(geometry){var coords=geometry.projectedCoords;var i,j,k,path="";if(geometry.type!=="circle"&&coords.length===0){return;
}switch(geometry.type){case"polyline":path="M "+coords[0].x+" "+coords[0].y;for(i=1;i<coords.length;i++){path+="L "+coords[i].x+" "+coords[i].y;
}return path;case"polygon":case"rectangle":for(i=0;i<coords.length;i++){for(j=0;j<coords[i].length;j++){if(j===0){path+="M "+coords[i][0].x+" "+coords[i][0].y;
continue;}path+="L "+coords[i][j].x+" "+coords[i][j].y;}path+=" Z ";}return path;case"multipolyline":for(i=0;
i<coords.length;i++){for(j=0;j<coords[i].length;j++){if(j===0){path+="M "+coords[i][0].x+" "+coords[i][0].y;
continue;}path+="L "+coords[i][j].x+" "+coords[i][j].y;}}return path;case"multipolygon":for(k=0;k<coords.length;
k++){for(i=0;i<coords[k].length;i++){for(j=0;j<coords[k][i].length;j++){if(j===0){path+="M "+coords[k][i][0].x+" "+coords[k][i][0].y;
continue;}path+="L "+coords[k][i][j].x+" "+coords[k][i][j].y;}path+=" Z ";}}return path;case"circle":if(!geometry.projectedCenter){return;
}var radius=geometry.projectedCenter.x-geometry.porjectedStartPoint.x;path="M "+geometry.porjectedStartPoint.x+" "+geometry.porjectedStartPoint.y;
path+=" A "+radius+" "+radius;path+=",0,1,1, "+geometry.porjectedStartPoint.x+" "+(geometry.porjectedStartPoint.y+0.01)+" Z";
return path;}},draw:function(geometry){var path=this.getPathString(geometry);if(path){geometry.$path.setAttributeNS(null,"d",path);
}else{geometry.$path.setAttributeNS(null,"d","M 0 0");}},dispose:function(geometry){this.$svg.$g.removeChild(geometry.$container);
}};exports.SvgContext=SvgContext;}(window.T));},function(module,exports){(function(exports){var CanvasContext=function(canvas,options){this.options=T.Util.defaults(options,this.options);
this.$canvas=canvas;this.ctx=this.$canvas.getContext("2d");};CanvasContext.prototype={initContainer:function(geometry){},applyStyle:function(geometry){var style=geometry.style;
if(style.stroke){this.ctx.strokeStyle=T.Util.hexToRgba(style.color,style.opacity);this.ctx.lineWidth=style.weight;
this.ctx.lineCap=style.lineCap;this.ctx.lineJoin=style.lineJoin;this.ctx.miterLimit=style.miterLimit;
}if(style.fill){this.ctx.fillStyle=T.Util.hexToRgba(style.fillColor||style.color,style.fillOpacity);}},draw:function(geometry){var coords=geometry.projectedCoords,style=geometry.style;
var i,j,k,polygonPoints;this.ctx.beginPath();switch(geometry.type){case"polyline":if(coords.length>0){this.ctx.moveTo(coords[0].x,coords[0].y);
for(i=1;i<coords.length;i++){this.ctx.lineTo(coords[i].x,coords[i].y);}}break;case"polygon":case"rectangle":if(coords.length>0){for(i=0;
i<coords.length;i++){polygonPoints=coords[i].concat();if(i>0){polygonPoints.reverse();}this.ctx.moveTo(polygonPoints[0].x,polygonPoints[0].y);
for(j=1;j<polygonPoints.length;j++){this.ctx.lineTo(polygonPoints[j].x,polygonPoints[j].y);}this.ctx.closePath();
}}break;case"multipolyline":if(coords.length>0){for(i=0;i<coords.length;i++){polygonPoints=coords[i].concat();
this.ctx.moveTo(polygonPoints[0].x,polygonPoints[0].y);for(j=1;j<polygonPoints.length;j++){this.ctx.lineTo(polygonPoints[j].x,polygonPoints[j].y);
}}}break;case"multipolygon":if(coords.length>0){for(k=0;k<coords.length;k++){for(i=0;i<coords[k].length;
i++){polygonPoints=coords[k][i].concat();if(i>0){polygonPoints.reverse();}this.ctx.moveTo(polygonPoints[0].x,polygonPoints[0].y);
for(j=1;j<polygonPoints.length;j++){this.ctx.lineTo(polygonPoints[j].x,polygonPoints[j].y);}this.ctx.closePath();
}}}break;case"circle":if(!geometry.projectedCenter){return;}var radius=geometry.projectedCenter.x-geometry.porjectedStartPoint.x;
this.ctx.arc(geometry.projectedCenter.x,geometry.projectedCenter.y,radius,0,2*Math.PI);this.ctx.stroke();
break;}if(style.fill&&!geometry.noneFillGeometry){this.ctx.fill();}if(style.stroke){this.ctx.stroke();
}},dispose:function(geometry){this.draw(geometry);}};exports.CanvasContext=CanvasContext;}(window.T));
},function(module,exports){(function(exports){var VmlContext=function(vml,options){this.options=T.Util.defaults(options,this.options);
this.$vml=vml;};VmlContext.prototype={initContainer:function(geometry){if(!geometry.$container){geometry.$container=T.DomUtil.createVmlElement("shape");
var path=T.DomUtil.createVmlElement("path");geometry.$container.appendChild(path);geometry.$container.$path=path;
geometry.$container.style.width="1px";geometry.$container.style.height="1px";geometry.$container.className="tibco-vml";
geometry.$container.$path.className="tibco-vml";}geometry.$container.coordsize="1 1";this.$vml.appendChild(geometry.$container);
},applyStyle:function(geometry){var style=geometry.style;if(style.stroke){if(!geometry.$stroke){geometry.$stroke=T.DomUtil.createVmlElement("stroke");
geometry.$stroke.className="tibco-vml";geometry.$container.appendChild(geometry.$stroke);}geometry.$stroke.color=style.color;
geometry.$stroke.weight=style.weight;geometry.$stroke.opacity=style.opacity;geometry.$container.stroked="t";
}else{if(geometry.$stroke){geometry.$container.removeChild(geometry.$stroke);}geometry.$container.stroked="f";
}if(style.fill&&!geometry.noneFillGeometry){if(!geometry.$fill){geometry.$fill=T.DomUtil.createVmlElement("fill");
geometry.$fill.className="tibco-vml";geometry.$container.appendChild(geometry.$fill);}geometry.$fill.color=style.fillColor||style.color;
geometry.$fill.opacity=style.fillOpacity;geometry.$container.filled="t";}else{if(geometry.$fill){geometry.$container.removeChild(geometry.$fill);
}geometry.$container.filled="f";}},getPathString:function(geometry){var coords=geometry.projectedCoords;
var i,j,k,path;if(geometry.type!=="circle"&&coords.length===0){return;}switch(geometry.type){case"polyline":path="M "+Math.round(coords[0].x)+" "+Math.round(coords[0].y);
for(i=1;i<coords.length;i++){path+="L "+Math.round(coords[i].x)+" "+Math.round(coords[i].y);}return path;
case"polygon":case"rectangle":for(i=0;i<coords.length;i++){for(j=0;j<coords[i].length;j++){if(j===0){path+="M "+coords[i][0].x+" "+coords[i][0].y;
continue;}path+="L "+coords[i][j].x+" "+coords[i][j].y;}path+=" X ";}return path;case"multipolyline":for(i=0;
i<coords.length;i++){for(j=0;j<coords[i].length;j++){if(j===0){path+="M "+coords[i][0].x+" "+coords[i][0].y;
continue;}path+="L "+coords[i][j].x+" "+coords[i][j].y;}}return path;case"multipolygon":for(k=0;k<coords.length;
k++){for(i=0;i<coords[k].length;i++){for(j=0;j<coords[k][i].length;j++){if(j===0){path+="M "+coords[k][i][0].x+" "+coords[k][i][0].y;
continue;}path+="L "+coords[k][i][j].x+" "+coords[k][i][j].y;}path+=" X ";}}return path;case"circle":if(!geometry.projectedCenter){return;
}var radius=geometry.projectedCenter.x-geometry.porjectedStartPoint.x;path="AL "+Math.round(geometry.projectedCenter.x)+","+Math.round(geometry.projectedCenter.y)+" "+Math.round(radius)+","+Math.round(radius)+" 0,"+(65535*360);
return path;}},draw:function(geometry){geometry.$container.style.display="none";geometry.$container.$path.v=this.getPathString(geometry)+" ";
geometry.$container.style.display="";},dispose:function(geometry){this.$vml.removeChild(geometry.$container);
}};exports.VmlContext=VmlContext;}(window.T));},function(module,exports){(function(exports){var BaseLayer=function(options){this.options=T.Util.defaults(options,this.options);
this.name=this.options.name||"";this.events=new T.EventDispatcher();this.isClickableLayer=true;};BaseLayer.prototype={onRemove:function(){T.DomUtil.remove(this.getContainer());
this.events.detachAll();this.$container=null;},reset:function(){},getIndex:function(){if(!this.map){return -1;
}return this.map.getLayerIndex(this);},getContainer:function(){return this.$container;},setVisible:function(visible){if(visible===true){this.getContainer().style.display="block";
this.map.events.fire("layer-show");}else{if(visible===false){this.getContainer().style.display="none";
this.map.events.fire("layer-hide");}}},isVisible:function(){return T.DomUtil.getStyle(this.getContainer(),"display")!=="none"?true:false;
},setAsInteractiveTarget:function(targetElement,targetObject){targetElement.interactiveObject=targetObject;
return targetElement;}};exports.BaseLayer=BaseLayer;}(window.T));},function(module,exports){(function(exports){var base=T.BaseLayer;
var TileLayer=function(url,options){if(!url){}base.call(this,options);this.url=url;this.tilesToLoad=0;
this.delayedUpdate=T.Util.limitExecByInterval(this.move,200,this);this.isDraggable=true;};TileLayer.prototype={options:{tileSize:256,errorTileAttemptsThreshold:1,reuseTiles:true,opacity:1,autoLoadTiles:true,tile404:"https://geoanalytics.tibco.com/404.png",attribution:null},initContainer:function(){if(!this.$container){this.$layerContainer=T.DomUtil.create("div","tibco-layer tile-layer",this.map.$container.layers);
this.$container=T.DomUtil.create("div","tibco-layer tile-layer-1",this.$layerContainer);this.$bufferContainer=T.DomUtil.create("div","tibco-layer tile-layer-2",this.$layerContainer);
this.$layerContainer.style.position="relative";this.$container.style.position="absolute";this.$bufferContainer.style.position="absolute";
this.$container.style.visibility="visible";this.$bufferContainer.style.visibility="visible";this.$container.layer=this;
this.$bufferContainer.layer=this;}},reset:function(){this.tiles={};this.tilesToLoad=0;this.unusedTiles=[];
this.handleBackBuffer();this.update();this.map.setUrlLocation();},move:function(){if(this.$container.style.visibility==="hidden"){this.$container.style.visibility="visible";
this.$container.style.zIndex=0;this.$bufferContainer.style.zIndex=-1;}this.update();},moveEnd:function(){this.move();
this.map.setUrlLocation();},addTile:function(point,$container){var position=this.getTilePosition(point);
var tile=this.getTile();T.DomUtil.position(tile,position);this.storeTile(tile,point);this.loadTile(tile,point);
$container.appendChild(tile);},update:function(){if(!this.map){return;}if(this.options.autoLoadTiles===true){this.reloadTiles();
}},reloadTiles:function(){var zoom=this.map.getZoom(),bounds=this.map.getPixelBounds(),tileSize=this.options.tileSize;
var tileBounds=new T.Bounds(bounds.min.divideBy(tileSize).floor(),bounds.max.divideBy(tileSize).floor());
this.tilesLoaded=0;this.addTileFromBounds(tileBounds);this.removeInvisibleTiles(tileBounds);},handleBackBuffer:function(){if(!this.IsBackbufferEnabled()){this.$container.innerHTML="";
return;}var frontPercent=this.getLoadedTilesPercent(this.$container);var backPercent=this.getLoadedTilesPercent(this.$bufferContainer);
if(frontPercent>0.5&&backPercent<0.5){var temp=this.$bufferContainer;this.$bufferContainer=this.$container;
this.$container=temp;this.$container.style.visibility="hidden";}this.stopLoadingTiles(this.$container);
this.$container.innerHTML="";this.$bufferContainer.style.visibility="visible";var matrix=this.map.lastTransform.matrix;
if(!this.$bufferContainer.matrix){this.$bufferContainer.matrix=new T.Matrix2D();}this.$bufferContainer.matrix=matrix.multiplyBy(this.$bufferContainer.matrix);
T.DomUtil.position(this.$bufferContainer,new T.Point(0,0));T.AnimUtil.setMatrix(this.$bufferContainer,this.$bufferContainer.matrix.toString());
T.AnimUtil.setMatrix(this.$container,new T.Matrix2D());},setOpacity:function(opacity){this.options.opacity=opacity;
var key,tiles=this.tiles;for(key in tiles){if(tiles.hasOwnProperty(key)){T.DomUtil.setOpacity(tiles[key],this.options.opacity);
}}},addTileFromBounds:function(tileBounds){var queue=[];var j,i,point;var center=tileBounds.center();
for(j=tileBounds.min.y;j<=tileBounds.max.y;j++){for(i=tileBounds.min.x;i<=tileBounds.max.x;i++){point=new T.Point(i,j);
if(this.shouldTileBeLoaded(point)){queue.push(point);}}}if(queue.length===0){return;}queue.sort(function(a,b){return a.distanceTo(center)-b.distanceTo(center);
});this.tilesToLoad=queue.length;var fragment=document.createDocumentFragment();for(i=0;i<queue.length;
i++){this.addTile(queue[i],fragment);}this.$container.appendChild(fragment);},removeInvisibleTiles:function(tileBounds){var x,y,key;
for(key in this.tiles){if(this.tiles.hasOwnProperty(key)){var tmp=key.split(":");x=parseInt(tmp[0],10);
y=parseInt(tmp[1],10);if(x<tileBounds.min.x||x>tileBounds.max.x||y<tileBounds.min.y||y>tileBounds.max.y){this.removeTile(key);
}}}},removeTile:function(key){var tile=this.tiles[key];if(this.options.reuseTiles){T.DomUtil.removeClass(tile,"tibco-tile-loaded");
this.unusedTiles.push(tile);}if(!this.options.reuseTiles){tile.parentNode.removeChild(tile);}else{if(!T.Util.browserVersion.ielt9){tile.onerror=null;
tile.onload=null;tile.removeAttribute("src");}}delete this.tiles[key];},getTile:function(){if(this.options.reuseTiles&&this.unusedTiles.length>0){var tile=this.unusedTiles.pop();
return tile;}return this.createTile();},getTileUrl:function(point){var tileCount=Math.pow(2,this.map.getZoom());
var x=point.x;var y=point.y;if(this.map.options.repeatX){x=x>=0?x%tileCount:(tileCount+x%tileCount)%tileCount;
}if(x>=0&&x<tileCount&&y>=0&&y<tileCount){return T.Util.template(this.url,{x:x,y:y,z:point.z});}return"";
},getTilePosition:function(point){var tileSize=this.options.tileSize,topLeft=this.map.getCenterInPixels().substract(this.map.getSize().divideBy(2)).floor();
return point.multiplyBy(tileSize).substract(topLeft);},createTile:function(){var tile=T.DomUtil.create("img","tibco-tile");
tile.style.width=tile.style.height=this.options.tileSize+"px";tile.style.position="absolute";tile.errorAttempts=0;
T.DomUtil.setOpacity(tile,this.options.opacity);T.DomUtil.disableSelection(tile);T.DomUtil.show(tile);
return tile;},storeTile:function(tile,point){this.tiles[point.x+":"+point.y+":"+point.z]=tile;},loadTile:function(tile,point){point.z=this.map.getZoom();
tile.layer=this;tile.point=point;var src=this.getTileUrl(point);if(src&&src!==""){if(!tile.onload){tile.onload=this.onTileLoad;
}if(!tile.onerror){tile.onerror=this.onTileError;}tile.src=src;if(T.Util.browserVersion.ielt9){T.DomUtil.show(tile);
}}else{if(T.Util.browserVersion.ielt9){T.DomUtil.hide(tile);}this.tilesToLoad--;}if(!T.Util.browserVersion.ielt9){T.DomUtil.hide(tile);
}},shouldTileBeLoaded:function(point){var tileKey=point.x+":"+point.y+":"+point.z;if(typeof this.tiles[tileKey]!=="undefined"){return false;
}return true;},getIndex:function(){return this.map.getLayerIndex(this);},getContainer:function(){return this.$layerContainer;
},onAdd:function(map){this.map=map;this.map.events.on("hard-reset",function(){this.hardReset=true;},this);
this.map.events.on("view-reset",this.reset,this);this.map.events.on("move-end",this.moveEnd,this);this.map.events.on("move",this.delayedUpdate,this);
this.events.on("before-drag-start",this.onBeforeDragStart,this);this.events.on("drag-start",this.onDragStart,this);
this.events.on("drag",this.onDrag,this);this.events.on("drag-end",this.onDragEnd,this);this.initContainer();
this.reset();this.$layerContainer=base.prototype.setAsInteractiveTarget.call(this,this.$layerContainer,this);
},onRemove:function(){this.map.events.detach("view-reset",this.reset);this.map.events.detach("move-end",this.moveEnd,this);
this.map.events.detach("move",this.delayedUpdate,this);this.events.detach("before-drag-start",this.onBeforeDragStart,this);
this.events.detach("drag-start",this.onDragStart,this);this.events.detach("drag",this.onDrag,this);this.events.detach("drag-end",this.onDragEnd,this);
base.prototype.onRemove.call(this);},onTileLoad:function(){var layer=this.layer;layer.events.fire("tile-load",{tile:this});
T.DomUtil.addClass(this,"tibco-tile-loaded");layer.tilesLoaded++;if(this.src&&this.src!==""){T.DomUtil.show(this);
}if(layer.tilesToLoad===layer.tilesLoaded){layer.onAllTilesLoaded();layer.events.fire("tiles-loaded",{nrTiles:layer.tilesLoaded});
}},onTileError:function(e){var layer=this.layer;if(this.errorAttempts<this.layer.options.errorTileAttemptsThreshold){this.errorAttempts++;
this.layer.loadTile(this,this.point);}else{this.layer.tilesLoaded++;this.layer.events.fire("tile-error",{tile:this});
this.onerror=null;this.src=this.layer.options.tile404;}if(layer.tilesToLoad===layer.tilesLoaded){layer.onAllTilesLoaded();
layer.events.fire("tiles-loaded",{nrTiles:layer.tilesLoaded});}},IsBackbufferEnabled:function(){if(T.AnimUtil.canAnim()){if(this.hardReset){this.hardReset=false;
return false;}}else{return false;}return true;},onAllTilesLoaded:function(){if(!this.IsBackbufferEnabled()){return;
}var self=this;self.$container.style.zIndex=0;self.$bufferContainer.style.zIndex=-1;self.$container.style.visibility="visible";
self.$bufferContainer.style.visibility="hidden";self.$bufferContainer.innerHTML="";self.$bufferContainer.matrix=new T.Matrix2D();
},stopLoadingTiles:function(container){var tiles=T.DomUtil.nodeCollectionToArray(container.getElementsByTagName("img")),i,len,tile;
for(i=0,len=tiles.length;i<len;i++){tile=tiles[i];if(!tile.complete){tile.onload=null;tile.onerror=null;
tile.removeAttribute("src");tile.parentNode.removeChild(tile);}}},getLoadedTilesPercent:function(container){var tiles=container.getElementsByTagName("img"),i,j=0,len=tiles.length,tile;
if(len===0){return 0;}for(i=0;i<len;i++){if(tiles[i].complete){j++;}}return j/len;},onBeforeDragStart:function(evt){this.map.onBeforeDragStart(evt);
},onDragStart:function(evt){this.map.onDragStart(evt);},onDrag:function(evt){this.map.onDrag(evt);},onDragEnd:function(evt){this.map.onDragEnd(evt);
}};T.Util.inherit(TileLayer,base);exports.TileLayer=TileLayer;}(window.T));},function(module,exports){(function(exports){var ImageLayer=function(url,bounds,options){this.options=T.Util.defaults(options,this.options);
this.url=url;this.bounds=bounds;T.BaseLayer.call(this,options);};ImageLayer.prototype={options:{opacity:1},initContainer:function(){if(!this.$container){this.$container=T.DomUtil.create("div","tibco-layer",this.map.$container.layers);
this.$container.layer=this;}},initImage:function(){var image=this.image=T.DomUtil.create("img","tibco-image-1");
var backImage=this.backImage=T.DomUtil.create("img","tibco-image-2");image.onload=this.onImageLoad;image.onerror=this.onImageError;
if(this.url){image.src=this.url;}image.layer=this;image.style.position="absolute";image.style.opacity=this.options.opacity;
image.matrix=new T.Matrix2D();backImage.layer=this;backImage.style.position="absolute";backImage.style.opacity=this.options.opacity;
backImage.matrix=new T.Matrix2D();backImage.style.visibility="hidden";T.DomUtil.disableSelection(image);
T.DomUtil.disableSelection(backImage);},reset:function(){var image=this.image,topLeft,size;if(this.bounds instanceof T.LatLngBounds){topLeft=this.map.latLngToPoint(this.bounds.getNorthWest()).floor();
size=this.map.latLngToPoint(this.bounds.getSouthEast()).substract(topLeft).floor();}else{topLeft=this.map.transform(this.bounds.topLeft()).substract(this.map.getTopLeftInPixels()).round();
size=this.map.transform(this.bounds.bottomRight()).substract(this.map.getTopLeftInPixels()).substract(topLeft).round();
}T.DomUtil.position(image,topLeft);image.style.width=size.x+"px";image.style.height=size.y+"px";},reload:function(url,bounds){this.url=url;
this.bounds=bounds;if(!this.image){this.initImage();}this.events.fire("image-loading",{tile:this.image});
this.image.src=this.url;this.reset();},setOpacity:function(opacity){if(!this.image){this.initImage();
}this.options.opacity=opacity;this.image.style.opacity=this.options.opacity;},onAdd:function(map){this.map=map;
this.map.events.on("view-reset",this.reset,this);this.initContainer();if(!this.image){this.initImage();
}this.$container.appendChild(this.image);this.$container.appendChild(this.backImage);this.reset();},onRemove:function(map){T.ImageLayer.base.onRemove.call(this);
this.map.events.detach("view-reset",this.reset);},onImageLoad:function(){var layer=this.layer;layer.events.fire("image-load",{tile:this});
},onImageError:function(e){var layer=this.layer;layer.events.fire("image-error",{tile:this});}};T.Util.inherit(ImageLayer,T.BaseLayer);
exports.ImageLayer=ImageLayer;}(window.T));},function(module,exports){(function(exports){var base=T.BaseLayer;
var MarkersLayer=function(options){base.call(this,options);this.markers=[];};MarkersLayer.prototype={options:{opacity:1},initContainer:function(){var i;
if(!this.$container){this.$container=T.DomUtil.create("div","tibco-layer markers-layer",this.map.$container.layers);
this.$container.layer=this;for(i=0;i<this.markers.length;i++){this.$container.appendChild(this.markers[i].$container);
}}},reset:function(){var i=0;for(i=0;i<this.markers.length;i++){this.markers[i].reset();}},addMarker:function(marker){marker.layer=this;
marker.onAdd(this);marker.reset();if(this.$container){this.$container.appendChild(marker.$container);
}this.markers.push(marker);marker.$container=base.prototype.setAsInteractiveTarget.call(this,marker.$container,marker);
},removeMarker:function(marker){var index=this.markers.indexOf(marker);if(index>-1){this.markers.splice(index,1);
marker.layer=null;marker.onRemove(this);if(this.$container){this.$container.removeChild(marker.$container);
}}},removeAllMarkers:function(){var i=0;for(i=0;i<this.markers.length;i++){this.markers[i].layer=null;
this.markers[i].onRemove(this);}this.markers=[];this.$container.innerHTML="";},findByLabel:function(label){var i=0;
for(i=0;i<this.markers.length;i++){if(this.markers[i].options.label===label){return this.markers[i];}}return null;
},setOpacity:function(opacity){this.options.opacity=opacity;this.$container.style.opacity=this.options.opacity;
},onAdd:function(map){this.map=map;this.map.events.on("view-reset",this.reset,this);this.initContainer();
this.reset();},onRemove:function(){this.map.events.detach("view-reset",this.reset);base.prototype.onRemove.call(this);
}};T.Util.inherit(MarkersLayer,base);exports.MarkersLayer=MarkersLayer;}(window.T));},function(module,exports){(function(exports){var base=T.BaseLayer;
var SvgLayer=function(options){base.call(this,options);this.geometries=[];this.type="svg";};SvgLayer.prototype={initContainer:function(){var i;
if(!this.$container){this.$container=T.DomUtil.create("div","tibco-layer svg-layer",this.map.$container.layers);
this.$svg=T.DomUtil.createSvgElement("svg");this.$svg.style.pointerEvents="none";this.$svg.$g=T.DomUtil.createSvgElement("g");
this.$svg.style.position="absolute";this.$container.appendChild(this.$svg);this.$svg.appendChild(this.$svg.$g);
this.context=new T.SvgContext(this.$svg);for(i=0;i<this.geometries.length;i++){this.geometries[i].context=this.context;
this.geometries[i].initContainer();}}},reset:function(){var i;for(i=0;i<this.geometries.length;i++){this.geometries[i].reset();
}},addGeometry:function(geometry){var index=this.geometries.indexOf(geometry);if(index>-1){return;}geometry.onAdd(this);
this.geometries.push(geometry);geometry.$container=base.prototype.setAsInteractiveTarget.call(this,geometry.$container,geometry);
return this;},removeGeometry:function(geometry){var index=this.geometries.indexOf(geometry);if(index>-1){this.geometries.splice(index,1);
geometry.onRemove(this);}},removeAllGeometries:function(){for(var i=0;i<this.geometries.length;i++){this.geometries[i].onRemove(this);
}this.geometries=[];},updateViewPort:function(){var padding=new T.Point(this.options.clipOffset,this.options.clipOffset);
var delta=this.map.getLayersPos();var pos=delta.add(padding);var size=this.map.getSize().add(padding.multiplyBy(2));
T.DomUtil.position(this.$svg,pos.multiplyBy(-1));this.$svg.setAttributeNS(null,"width",size.x);this.$svg.setAttributeNS(null,"height",size.y);
this.$svg.setAttributeNS(null,"viewBox",[-padding.x,-padding.y,size.x,size.y].join(" "));this.$svg.$g.setAttributeNS(null,"transform","matrix("+[1,0,0,1,0,0].join(" ")+")");
this.reset();},bringForward:function(geometry){var index=T.DomUtil.getNodeIndex(geometry.$container,this.$svg.$g);
if(index<0){return;}var nextNode=this.$svg.$g.childNodes[index+2];if(nextNode){this.$svg.$g.insertBefore(geometry.$container,nextNode);
}else{this.$svg.$g.appendChild(geometry.$container);}},sendBackward:function(geometry){var index=T.DomUtil.getNodeIndex(geometry.$container,this.$svg.$g);
if(index<0){return;}var nextNode=this.$svg.$g.childNodes[index-1];if(nextNode){this.$svg.$g.insertBefore(geometry.$container,nextNode);
}},bringToFront:function(geometry){var index=T.DomUtil.getNodeIndex(geometry.$container,this.$svg.$g);
if(index<0){return;}this.$svg.$g.appendChild(geometry.$container);},sendToBack:function(geometry){var index=T.DomUtil.getNodeIndex(geometry.$container,this.$svg.$g);
if(index<0||this.$svg.$g.firstChild===geometry.$container){return;}this.$svg.$g.insertBefore(geometry.$container,this.$svg.$g.firstChild);
},getContainer:function(){return this.$container;},onAdd:function(map){this.map=map;this.map.events.on("view-reset",this.updateViewPort,this);
this.map.events.on("move-end",this.updateViewPort,this);this.initContainer();this.reset();this.updateViewPort();
},onRemove:function(){this.map.events.detach("view-reset",this.reset);this.map.events.detach("move-end",this.updateViewPort);
this.map=null;},onGeometryClick:function(e,geometry){this.events.fire("geometry-click",geometry);}};T.Util.inherit(SvgLayer,base);
exports.SvgLayer=SvgLayer;}(window.T));},function(module,exports){(function(exports){var CanvasLayer=function(options){T.BaseLayer.call(this,options);
this.type="canvas";this.geometries=[];};CanvasLayer.prototype={initContainer:function(){var i;if(!this.$container){this.$container=T.DomUtil.create("div","tibco-layer canvas-layer",this.map.$container.layers);
this.$canvas=T.DomUtil.create("canvas","canvas");this.$canvas.style.position="absolute";this.$container.appendChild(this.$canvas);
this.canvasContext=this.$canvas.getContext("2d");this.context=new T.CanvasContext(this.$canvas);for(i=0;
i<this.geometries.length;i++){this.geometries[i].context=this.context;this.geometries[i].initContainer();
}}},handleEvents:function(eventName,geometry,evt){this.events.fire(eventName,geometry,evt);},getTargetedGeometry:function(evt){var i,geometry;
var point=this.map.computeMousePosition(evt);var geoms=this.geometries.concat().reverse();var padding=new T.Point(this.options.clipOffset,this.options.clipOffset);
point=point.add(padding);for(i=0;i<geoms.length;i++){this.clear();geoms[i].reset();var img=this.canvasContext.getImageData(point.x,point.y,1,1).data;
if(img[0]!==0||img[1]!==0||img[2]!==0){geometry=geoms[i];break;}}this.updateViewPort();evt.latLng=this.map.containerPointToLatLng(point.substract(padding));
if(geometry){return geometry;}else{return null;}},reset:function(){var i;for(i=0;i<this.geometries.length;
i++){this.geometries[i].reset();}},addGeometry:function(geometry){var index=this.geometries.indexOf(geometry);
if(index>-1){return;}geometry.onAdd(this);this.geometries.push(geometry);return this;},removeGeometry:function(geometry){var index=this.geometries.indexOf(geometry),i=0;
if(index>-1){this.geometries.splice(index,1);this.clear();for(i=0;i<this.geometries.length;i++){this.geometries[i].draw(this.geometries[i]);
}}},removeAllGeometries:function(){this.clear();this.geometries=[];},clear:function(){this.canvasContext.clearRect(0,0,this.$canvas.width,this.$canvas.height);
},bringForward:function(geometry){var index=this.geometries.indexOf(geometry);if(this.geometries.length<2||index===this.geometries.length-1){return;
}var temp=this.geometries[index+1];this.geometries[index+1]=geometry;this.geometries[index]=temp;this.updateViewPort();
},sendBackward:function(geometry){var index=this.geometries.indexOf(geometry);if(this.geometries.length<2||index===0){return;
}var temp=this.geometries[index-1];this.geometries[index-1]=geometry;this.geometries[index]=temp;this.updateViewPort();
},bringToFront:function(geometry){var index=this.geometries.indexOf(geometry);if(this.geometries.length<2||index===this.geometries.length-1){return;
}this.geometries.splice(index,1);this.geometries.push(geometry);this.updateViewPort();},sendToBack:function(geometry){var index=this.geometries.indexOf(geometry);
if(this.geometries.length<2||index===0){return;}this.geometries.splice(index,1);this.geometries.splice(0,0,geometry);
this.updateViewPort();},updateViewPort:function(){var padding=new T.Point(this.options.clipOffset,this.options.clipOffset);
var pos=this.map.getLayersPos().add(padding);var size=this.map.getSize().add(padding.multiplyBy(2));T.DomUtil.position(this.$canvas,pos.multiplyBy(-1));
this.$canvas.width=size.x;this.$canvas.height=size.y;this.canvasContext.setTransform(1,0,0,1,padding.x,padding.y);
this.reset();},onAdd:function(map){this.map=map;this.map.events.on("view-reset",this.updateViewPort,this);
this.map.events.on("move-end",this.updateViewPort,this);this.initContainer();this.updateViewPort();this.$canvas=T.BaseLayer.prototype.setAsInteractiveTarget.call(this,this.$canvas,this);
},onRemove:function(){this.map.events.detach("view-reset",this.updateViewPort);this.map.events.detach("move-end",this.updateViewPort);
this.map=null;}};T.Util.inherit(CanvasLayer,T.BaseLayer);exports.CanvasLayer=CanvasLayer;}(window.T));
},function(module,exports){(function(exports){var VmlLayer=function(options){T.BaseLayer.call(this,options);
this.type="vml";this.geometries=[];};VmlLayer.prototype={initContainer:function(){var i;if(!this.$container){this.$container=T.DomUtil.create("div","tibco-layer vml-layer",this.map.$container.layers);
this.$container.style.position="absolute";document.namespaces.add("v","urn:schemas-microsoft-com:vml");
T.DomUtil.addStyleNode(".tibco-vml	 {	display:inline-block; behavior:url(#default#VML); position: absolute; }");
this.$vml=this.$container;this.context=new T.VmlContext(this.$vml);for(i=0;i<this.geometries.length;i++){this.geometries[i].context=this.context;
this.geometries[i].initContainer();}}},reset:function(){var i;for(i=0;i<this.geometries.length;i++){this.geometries[i].reset();
}},addGeometry:function(geometry){var index=this.geometries.indexOf(geometry);if(index>-1){return;}geometry.onAdd(this);
this.geometries.push(geometry);geometry.$container=T.BaseLayer.prototype.setAsInteractiveTarget.call(this,geometry.$container,geometry);
return this;},removeGeometry:function(geometry){var index=this.geometries.indexOf(geometry);if(index>-1){this.geometries.splice(index,1);
geometry.onRemove(this);}},removeAllGeometries:function(){for(var i=0;i<this.geometries.length;i++){this.geometries[i].onRemove(this);
}this.geometries=[];},updateViewPort:function(){var pos=this.map.getLayersPos();T.DomUtil.position(this.$vml,pos.multiplyBy(-1));
this.reset();},bringForward:function(geometry){var index=T.DomUtil.getNodeIndex(geometry.$container,this.$vml);
if(index<0){return;}var nextNode=this.$vml.childNodes[index+2];if(nextNode){this.$vml.insertBefore(geometry.$container,nextNode);
}else{this.$vml.appendChild(geometry.$container);}},sendBackward:function(geometry){var index=T.DomUtil.getNodeIndex(geometry.$container,this.$vml);
if(index<0){return;}var nextNode=this.$vml.childNodes[index-1];if(nextNode){this.$vml.insertBefore(geometry.$container,nextNode);
}},bringToFront:function(geometry){var index=T.DomUtil.getNodeIndex(geometry.$container,this.$vml);if(index<0){return;
}this.$vml.appendChild(geometry.$container);},sendToBack:function(geometry){var index=T.DomUtil.getNodeIndex(geometry.$container,this.$vml);
if(index<0||this.$vml.firstChild===geometry.$container){return;}this.$vml.insertBefore(geometry.$container,this.$vml.firstChild);
},getContainer:function(){return this.$container;},onAdd:function(map){this.map=map;this.map.events.on("view-reset",this.reset,this);
this.map.events.on("move-end",this.updateViewPort,this);if(T.Util.browserVersion.ielt9){this.map.events.on("layer-moved",this.updateViewPort,this);
}this.initContainer();this.updateViewPort();},onRemove:function(){T.VmlLayer.base.onRemove.call(this);
this.map.events.detach("view-reset",this.reset);this.map.events.detach("move-end",this.updateViewPort);
if(T.Util.browserVersion.ielt9){this.map.events.detach("layer-moved",this.updateViewPort);}}};T.Util.inherit(VmlLayer,T.BaseLayer);
exports.VmlLayer=VmlLayer;}(window.T));},function(module,exports){(function(exports){var base=T.BaseLayer;
var VectorLayer=function(options){var i;base.call(this,options);if(T.Util.browserVersion.ielt9){this.vectorDrawer=new T.VmlLayer(this.options);
}else{if(options&&options.useCanvas===true){this.vectorDrawer=new T.CanvasLayer(this.options);}else{this.vectorDrawer=new T.SvgLayer(this.options);
}}this.vectorDrawer.events=this.events;};VectorLayer.prototype={options:{defaultStyle:{stroke:true,color:"#0033ff",dashArray:null,lineCap:null,lineJoin:null,weight:2,opacity:0.5,fill:true,fillColor:null,fillOpacity:0.2},clipOffset:100},reset:function(){this.vectorDrawer.reset();
},addGeometry:function(geometry){return this.vectorDrawer.addGeometry(geometry);},removeGeometry:function(geometry){return this.vectorDrawer.removeGeometry(geometry);
},removeAllGeometries:function(){return this.vectorDrawer.removeAllGeometries();},bringForward:function(geometry){this.vectorDrawer.bringForward(geometry);
},sendBackward:function(geometry){this.vectorDrawer.sendBackward(geometry);},bringToFront:function(geometry){this.vectorDrawer.bringToFront(geometry);
},sendToBack:function(geometry){this.vectorDrawer.sendToBack(geometry);},updateViewPort:function(){this.vectorDrawer.updateViewPort();
},getIndex:function(){return this.vectorDrawer.map.getLayerIndex(this);},getContainer:function(){return this.vectorDrawer.$container;
},setVisible:function(visible){var container=this.getContainer();if(visible===true){container.style.display="block";
}else{if(visible===false){container.style.display="none";}}},isVisible:function(){var container=this.getContainer();
return container.style.display==="none"?false:true;},onAdd:function(map){this.vectorDrawer.onAdd(map);
},onRemove:function(map){this.vectorDrawer.onRemove(map);base.prototype.onRemove.call(this);}};T.Util.inherit(VectorLayer,base);
exports.VectorLayer=VectorLayer;}(window.T));},function(module,exports){(function(exports){var GoogleLayer=function(options){T.BaseLayer.call(this,options);
this.isDraggable=true;};GoogleLayer.prototype={options:{opacity:1,attribution:null},initContainer:function(){if(!this.$container){this.$container=T.DomUtil.create("div","tibco-layer google-layer",this.map.$container.layers);
this.$container.layer=this;T.DomUtil.size(this.$container,this.map.getSize());this.mapObject=new google.maps.Map(this.$container,{center:this.toGoogle(this.map.getCenter()),zoom:this.map.getZoom(),type:google.maps.MapTypeId.ROADMAP,disableDefaultUI:true,keyboardShortcuts:false,draggable:false,disableDoubleClickZoom:false,scrollwheel:false,streetViewControl:false});
}},reset:function(){var container=this.map.$layers;google.maps.event.addListenerOnce(this.mapObject,"idle",function(){container.style.visibility="";
});container.style.visibility="hidden";this.mapObject.setOptions({animatedZoom:false,center:this.toGoogle(this.map.getCenter()),zoom:this.map.getZoom()});
this.map.setUrlLocation();},update:function(){if(!this.map){return;}this.map.setUrlLocation();},updatePosition:function(){if(!this.map){return;
}var layerPosition=this.map.getLayersPos().multiplyBy(-1);T.DomUtil.position(this.$container,layerPosition);
this.mapObject.setCenter(this.toGoogle(this.map.getCenter()));this.resizeMap();},resizeMap:function(){google.maps.event.trigger(this.mapObject,"resize");
},toGoogle:function(latLng){return new google.maps.LatLng(latLng.lat,latLng.lng);},setOpacity:function(opacity){this.options.opacity=opacity;
},onAdd:function(map){this.map=map;this.map.events.on("move-end",this.update,this);this.map.events.on("move",this.updatePosition,this);
this.map.events.on("view-reset",this.reset,this);this.events.on("before-drag-start",this.onBeforeDragStart,this);
this.events.on("drag-start",this.onDragStart,this);this.events.on("drag",this.onDrag,this);this.events.on("drag-end",this.onDragEnd,this);
this.initContainer();this.reset();this.update();this.$container=T.BaseLayer.prototype.setAsInteractiveTarget.call(this,this.$container,this);
},onRemove:function(){T.GoogleLayer.base.onRemove.call(this);this.map.events.detach("move-end",this.update);
this.map.events.detach("move",this.updatePosition);this.map.events.detach("view-reset",this.reset);this.events.detach("before-drag-start",this.onBeforeDragStart,this);
this.events.detach("drag-start",this.onDragStart,this);this.events.detach("drag",this.onDrag,this);this.events.detach("drag-end",this.onDragEnd,this);
},onBeforeDragStart:function(evt){this.map.onBeforeDragStart(evt);},onDragStart:function(evt){this.map.onDragStart(evt);
},onDrag:function(evt){this.map.onDrag(evt);},onDragEnd:function(evt){this.map.onDragEnd(evt);}};T.Util.inherit(GoogleLayer,T.BaseLayer);
exports.GoogleLayer=GoogleLayer;}(window.T));},function(module,exports){(function(exports){var base=T.TileLayer;
var TibcoLayer=function(options){if(window.location.protocol!=="https:"){this.mapServicesUrl="http://geoanalytics.tibco.com/service/services-list.json";
}else{this.mapServicesUrl="https://geoanalytics.tibco.com/service/ssl/services-list.json";}this.mapServices=null;
this.mapTypeService=null;this.mapTypeServiceData=null;this.options=T.Util.defaults(this.options,base.prototype.options);
T.TileLayer.call(this,"",options);this.init(options);};TibcoLayer.prototype={options:{draggable:true,mapType:T.MapTypes.STANDARD,mapStyle:T.MapStyles.LIGHT,attribution:{prefix:"<a target='_blank' href='http://www.tibco.com/assets/blt59b361e6644c8d3a/tibco-end-user-license-agreement_tcm8-9378.pdf'>TIBCO GeoAnalytics</a>",text:""}},init:function(){var self=this;
this.makeRequest(this.mapServicesUrl).then(function(data){self.mapServices=self.getMapServices(data);
self.setMapType(self.options.mapType);},function(){throw new Error("Map services error!");});},makeRequest:function(url){var promise=new T.Promise();
var cfg={method:"GET",withCredentials:false,on:{success:function(data){var json=JSON.parse(data);promise.resolve(json);
},error:function(error){promise.reject(error);}}};new T.Ajax().send(url,cfg);return promise;},setMapType:function(mapType){var self=this,promise=new T.Promise();
if(!mapType){throw new Error("Please specify a map type!");}this.options.mapType=mapType;this.mapTypeService=this.getMapServiceByMapType(this.options.mapType);
if(!this.mapTypeService){throw new Error("Map services error!");}this.makeRequest(this.mapTypeService.href).then(function(data){if(!data||!data["tile url"]){throw new Error("Map tiles error!");
}self.options.attribution.text='<a target="_blank" href='+data["copyright href"]+">"+data.copyright+"</a>";
if(self.map){self.map.events.fire("attribution-update",self.options.attribution);self.map.events.fire("layer-attribution-reset",self);
}self.mapTypeServiceData=data;self.setMapStyle(self.options.mapStyle);promise.resolve();},function(){promise.reject();
throw new Error("Map tiles error!");});return promise;},setMapStyle:function(mapStyle){var availableMapStyles=this.mapTypeServiceData["tile styles"],styleFound=false,i=0;
if(!availableMapStyles){this.setTilesUrl(this.mapTypeServiceData["tile url"]);}else{for(i=0;i<availableMapStyles.length;
i++){if(availableMapStyles[i].id===mapStyle){styleFound=true;this.options.mapStyle=availableMapStyles[i].id;
this.setTilesUrl(availableMapStyles[i].url);break;}}if(!styleFound){throw new Error("Style '"+mapStyle+"' is not a supported map style!");
}}},setTilesUrl:function(tilesUrl){if(!tilesUrl){throw new Error("Map services error!");}this.url=tilesUrl+"{z}/{x}/{y}.png";
if(this.map){base.prototype.reset.call(this);}},getAvailableMapTypes:function(){var availableMapTypes=[],i=0;
if(!this.mapServices||this.mapServices.length===0){throw new Error("Map services error!");}for(i=0;i<this.mapServices.length;
i++){availableMapTypes.push(this.mapServices[i].name);}return availableMapTypes;},getAvailableMapStyles:function(){var availableMapStyles=[],i=0;
if(!this.mapTypeServiceData){throw new Error("Map services error!");}if(!this.mapTypeServiceData["tile styles"]){return availableMapStyles;
}for(i=0;i<this.mapTypeServiceData["tile styles"].length;i++){availableMapStyles.push(this.mapTypeServiceData["tile styles"][i].id);
}return availableMapStyles;},getMapServices:function(data){var latestMapData=null;if(!data||!data.maps){throw new Error("Map services error!");
}latestMapData=this.getLastVersionOfMapData(data.maps);if(!latestMapData||!latestMapData.services||latestMapData.services.length===0){throw new Error("Map services error!");
}return latestMapData.services;},getMapServiceByMapType:function(mapType){var i=0;if(!mapType||!this.mapServices||this.mapServices.length===0){throw new Error("Map services error!");
}for(i=0;i<this.mapServices.length;i++){if(this.mapServices[i].name===mapType){return this.mapServices[i];
}}return null;},getLastVersionOfMapData:function(mapData){var i=0,latestMapData=null;if(!mapData||mapData.length===0){throw new Error("Map services error!");
}latestMapData=mapData[0];for(i=1;i<mapData.length;i++){if(mapData[i].version>latestMapData.version){latestMapData=mapData[i];
}}return latestMapData;}};T.Util.inherit(TibcoLayer,T.TileLayer);exports.TibcoLayer=TibcoLayer;}(window.T));
},function(module,exports){(function(exports){var WmsLayer=function(url,options){options.transparent=options.transparent||"true";
options.version=options.version||"1.1.1";options.format=options.format||"image/png";options.styles=options.styles||[];
options.queryParams=options.queryParams||[];T.ImageLayer.call(this,null,null,options);this.wmsUrl=url;
};WmsLayer.prototype={computeParameters:function(bounds){var param={};if(this.options.maxBounds){param.bounds=bounds.intersect(this.options.maxBounds);
var topLeftPx=this.map.transform(param.bounds.topLeft());var bottomRightPx=this.map.transform(param.bounds.bottomRight());
param.topLeftPixel=topLeftPx.substract(this.map.calculateTopLeft()).substract(this.map.getLayersPos());
param.size=bottomRightPx.substract(topLeftPx);}else{param.topLeftPixel=new T.Point(0,0).substract(this.map.getLayersPos());
param.size=this.map.getSize();param.bounds=bounds;}param.size.x=param.size.x|0;param.size.y=param.size.y|0;
return param;},handleBackbuffer:function(noTransform){if(this.image.completed){var temp=this.backImage;
this.backImage=this.image;this.image=temp;this.image.style.visibility="hidden";this.image.completed=false;
if(T.AnimUtil.canAnim()){T.AnimUtil.setMatrix(this.image,new T.Matrix2D());}else{this.image.style.width="";
this.image.style.height="";this.image.style.left="";this.image.style.top="";}}else{this.image.onload=null;
this.image.onerror=null;this.image.removeAttribute("src");}if(!noTransform){var matrix=this.map.lastTransform.matrix;
this.backImage.matrix=matrix.multiplyBy(this.backImage.matrix);T.DomUtil.position(this.backImage,new T.Point(0,0));
if(T.AnimUtil.canAnim()){T.AnimUtil.transition(this.backImage,0);T.AnimUtil.setMatrix(this.backImage,this.backImage.matrix.toString());
}else{this.backImage.style.width=(this.backImage.originalWidth||0)*this.backImage.matrix.m11+"px";this.backImage.style.height=(this.backImage.originalHeight||0)*this.backImage.matrix.m11+"px";
this.backImage.style.left=this.backImage.matrix.m13+"px";this.backImage.style.top=this.backImage.matrix.m23+"px";
}}},reset:function(noTransform){this.handleBackbuffer(noTransform);var key,queryParams=this.options.queryParams,image=this.image,crs=this.map.options.crs,url=this.wmsUrl,map=this.map,bounds=map.getProjectedBounds(),param=this.computeParameters(bounds),size=param.size,topLeftPixel=param.topLeftPixel,bottomLeft=param.bounds.bottomLeft(),topRight=param.bounds.topRight();
if(size.x<=0||size.y<=0){this.events.fire("image-load",{tile:null});return;}url+="?";url+="service=WMS";
url+="&version="+this.options.version;url+="&request=GetMap";url+="&layers="+this.options.layers.join(",");
url+="&styles="+this.options.styles.join(",");url+="&bbox="+bottomLeft.x+","+bottomLeft.y+","+topRight.x+","+topRight.y;
url+="&format="+this.options.format;url+="&SRS="+crs.code;url+="&width="+size.x;url+="&height="+size.y;
url+="&transparent="+this.options.transparent;for(key in queryParams){if(queryParams.hasOwnProperty(key)){url+="&"+key+"="+queryParams[key];
}}this.events.fire("image-loading",{tile:this.image});T.DomUtil.position(image,topLeftPixel);image.onload=this.onImageLoad;
image.onerror=this.onImageError;image.style.width=size.x+"px";image.style.height=size.y+"px";image.src=url;
},onMoveEnd:function(){this.reset(true);},reload:function(url,bounds){},onAdd:function(map){WmsLayer.base.onAdd.call(this,map);
map.events.on("move-end",this.onMoveEnd,this);},onRemove:function(){this.map.events.detach("move-end",this.reset);
WmsLayer.base.onRemove.call(this);},onImageLoad:function(){var self=this.layer;var img;this.completed=true;
self.image.style.zIndex=0;self.backImage.style.zIndex=-1;self.image.style.visibility="visible";self.backImage.style.visibility="hidden";
self.image.matrix=new T.Matrix2D();self.image.matrix.m13+=T.DomUtil.position(this).x;self.image.matrix.m23+=T.DomUtil.position(this).y;
if(!T.AnimUtil.canAnim()){self.image.originalWidth=parseInt(this.style.width,10);self.image.originalHeight=parseInt(this.style.height,10);
}WmsLayer.base.onImageLoad.call(this);},onImageError:function(e){this.layer.events.fire("wms-error","Error loading WMS image");
}};T.Util.inherit(WmsLayer,T.ImageLayer);exports.WmsLayer=WmsLayer;}(window.T));},function(module,exports){(function(exports){var WmsTileLayer=function(url,options){if(!url){throw new Error("TileLayer must have an URL");
}T.TileLayer.call(this,url,options);this.url=url;options.transparent=options.transparent||"true";options.version=options.version||"1.1.1";
options.format=options.format||"image/png";options.styles=options.styles||[];options.queryParams=options.queryParams||[];
options.errorTileAttemptsThreshold=0;};WmsTileLayer.prototype={getTileUrl:function(point){var size,tilePos,crs=this.map.options.crs,url=this.url,tileSize=this.options.tileSize,queryParams=this.options.queryParams,tileSizePoint=new T.Point(tileSize,tileSize),topLeft,topRight,bottomLeft,bottomRight,topLeftLatLng,bottomRightLatLng,key,bbox,crsParameterName;
tilePos=point.multiplyBy(tileSize);topLeft=crs.untransform(tilePos,this.map.getZoom());size=tileSizePoint.multiplyBy(this.map.getResolution()).multiplyBy(new T.Point(1,-1));
bottomRight=topLeft.add(size);if(this.options.version==="1.3.0"&&this.options.reversedAxisOrder){bbox=[bottomRight.y,topLeft.x,topLeft.y,bottomRight.x];
}else{bbox=[topLeft.x,bottomRight.y,bottomRight.x,topLeft.y];}crsParameterName=(this.options.version==="1.3.0")?"CRS":"SRS";
url+="?";url+="service=WMS";url+="&version="+this.options.version;url+="&request=GetMap";url+="&layers="+this.options.layers.join(",");
url+="&styles="+this.options.styles.join(",");url+="&bbox="+bbox[0]+","+bbox[1]+","+bbox[2]+","+bbox[3];
url+="&format="+this.options.format;url+="&"+crsParameterName+"="+crs.code;url+="&width="+tileSize;url+="&height="+tileSize;
url+="&transparent="+this.options.transparent;for(key in queryParams){if(queryParams.hasOwnProperty(key)){url+="&"+key+"="+queryParams[key];
}}return url;},getTilePosition:function(point){var tileSize=this.options.tileSize,topLeft=this.map.getCenterInPixels().substract(this.map.getSize().divideBy(2)).floor();
return point.multiplyBy(tileSize).substract(topLeft);},onRemove:function(){WmsTileLayer.base.onRemove.call(this);
}};T.Util.inherit(WmsTileLayer,T.TileLayer);exports.WmsTileLayer=WmsTileLayer;}(window.T));},function(module,exports){(function(exports){var PopupsLayer=function(options){T.BaseLayer.call(this,options);
this.popups=[];};PopupsLayer.prototype={options:{opacity:1},initContainer:function(){if(!this.$container){this.$container=T.DomUtil.create("div","tibco-layer popup-layer",this.map.$container.layers);
this.$container.layer=this;}},reset:function(){var i=0;for(i=0;i<this.popups.length;i++){this.popups[i].reset();
}},addPopup:function(popup){this.$container.appendChild(popup.$container);popup.layer=this;popup.onAdd(this);
this.popups.push(popup);if(popup.$closeButton){T.DomEventUtil.on(popup.$closeButton,"mousedown",this.onPopupCloseButtonClick,this);
if(T.Util.touchSupport()){T.DomEventUtil.on(popup.$closeButton,"touchstart",this.onPopupCloseButtonClick,this);
}}},removePopup:function(popup){var index=this.popups.indexOf(popup);if(index>-1){this.popups.splice(index,1);
popup.layer=null;popup.onRemove(this);this.$container.removeChild(popup.$container);if(popup.$closeButton){T.DomEventUtil.off(popup.$closeButton,"mousedown",this.onPopupCloseButtonClick,this);
if(T.Util.touchSupport()){T.DomEventUtil.off(popup.$closeButton,"touchstart",this.onPopupCloseButtonClick,this);
}}}},removeAllPopups:function(){var i=0;for(i=0;i<this.popups.length;i++){this.popups[i].layer=null;this.popups[i].onRemove(this);
}this.popups=[];this.$container.innerHTML="";},setOpacity:function(opacity){this.options.opacity=opacity;
this.$container.style.opacity=this.options.opacity;},onAdd:function(map){this.map=map;this.map.events.on("view-reset",this.reset,this);
this.initContainer();this.reset();},onRemove:function(){this.map.events.detach("view-reset",this.reset);
T.PopupsLayer.base.onRemove.call(this);},onPopupCloseButtonClick:function(event){var target=event.target||event.srcElement;
target.popup.close();event.stopPropagation();}};T.Util.inherit(PopupsLayer,T.BaseLayer);exports.PopupsLayer=PopupsLayer;
}(window.T));},function(module,exports){(function(exports){var Popup=function(html,options){this.html=html;
this.options=T.Util.defaults(options,this.options);this.initContainer();};Popup.prototype={options:{closeButtonUrl:"",offset:{x:0,y:0},panMap:false,panMapExtraOffset:{x:0,y:0}},initContainer:function(){if(!this.$container){this.$container=T.DomUtil.create("div","tibco-popup");
if(this.options.closeButtonUrl){this.$closeButton=T.DomUtil.create("img","tibco-popup-close",this.$container);
this.$closeButton.src=this.options.closeButtonUrl;this.$closeButton.popup=this;}this.$htmlContent=T.DomUtil.create("div","tibco-popup-content",this.$container);
this.$tail=T.DomUtil.create("div","tibco-popup-tail",this.$container);this.$container.style.position="absolute";
if(this.html){this.$htmlContent.innerHTML=this.html;}this.close();}},addHandler:function(handler){handler.init(this);
},setHtml:function(template,templateData){var key=null,keyInTemplate=null,regExp=null;if(!template){return;
}if(templateData){for(key in templateData){keyInTemplate="{{"+key+"}}";if(template.indexOf(keyInTemplate)===-1){throw"Invalid object for popup template!";
}else{regExp=new RegExp(keyInTemplate,"g");template=template.replace(regExp,templateData[key]);}}}this.html=template;
this.$htmlContent.innerHTML=this.html;},getPosition:function(latlng,offset){var position=this.layer.map.latLngToPoint(latlng).floor();
position=position.substract(new T.Point(this.$container.clientWidth/2,this.$container.offsetHeight+this.$tail.offsetHeight/2)).add(new T.Point(this.options.offset.x,this.options.offset.y));
return position;},getLayersContainerPanOffset:function(){return{top:parseInt(T.DomUtil.getStyle(this.layer.map.$container.layers,"top"),10),left:parseInt(T.DomUtil.getStyle(this.layer.map.$container.layers,"left"),10)};
},getPanOffset:function(){var offsetX=0,offsetY=0,popupPanPosition=this.getPositionWithPan();if(popupPanPosition.left<0){offsetX=Math.abs(popupPanPosition.left)+this.options.panMapExtraOffset.x;
}else{if(!this.isHorizontallyVisible()){offsetX=this.layer.map.$container.offsetWidth-this.options.panMapExtraOffset.x-(popupPanPosition.left+this.$container.offsetWidth);
}else{offsetX=-this.options.panMapExtraOffset.x;}}if(popupPanPosition.top<0){offsetY=Math.abs(popupPanPosition.top)+this.options.panMapExtraOffset.y;
}else{if(!this.isVerticallyVisible()){offsetY=this.layer.map.$container.offsetHeight-this.options.panMapExtraOffset.y-(popupPanPosition.top+this.$container.offsetHeight+this.$tail.offsetHeight);
}else{offsetY=-this.options.panMapExtraOffset.y;}}return{x:offsetX,y:offsetY};},getPositionWithPan:function(){var layersContainerPanOffset=this.getLayersContainerPanOffset();
if(!this.$container.tibcoPosition){return null;}return{top:this.$container.tibcoPosition.y+layersContainerPanOffset.top,left:this.$container.tibcoPosition.x+layersContainerPanOffset.left};
},isInViewport:function(){return this.isHorizontallyVisible()&&this.isVerticallyVisible();},isHorizontallyVisible:function(){var popupPanPosition=this.getPositionWithPan();
return(popupPanPosition.left>0)&&((popupPanPosition.left+this.$container.offsetWidth)<=this.layer.map.$container.offsetWidth);
},isVerticallyVisible:function(){var popupPanPosition=this.getPositionWithPan();return(popupPanPosition.top>0)&&((popupPanPosition.top+this.$container.offsetHeight)<=this.layer.map.$container.offsetHeight);
},panMapIfNecessary:function(){var panOffset;if(this.options.panMap===true&&!this.isInViewport()){panOffset=this.getPanOffset();
this.layer.map.panBy(new T.Point(panOffset.x,panOffset.y));}},reset:function(){var position;if(!this.reference){return;
}position=this.getPosition(this.reference,this.options.offset);T.DomUtil.position(this.$container,position);
},open:function(reference){if(!reference){return;}if(this.marker){this.marker.popup=null;this.marker=null;
}if(reference.className&&reference.className==="marker"){this.marker=reference;this.marker.popup=this;
this.reference=this.marker.latlng;}else{this.reference=reference;}T.DomUtil.show(this.$container);this.reset();
this.panMapIfNecessary();},close:function(){T.DomUtil.hide(this.$container);},isOpen:function(){if(!this.$container){return false;
}return !(this.$container.style.display==="none");},onAdd:function(layer){},onRemove:function(layer){}};
exports.Popup=Popup;}(window.T));},function(module,exports){(function(exports){var ImageMarker=function ImageMarker(latlng,url,options){this.latlng=latlng;
this.url=url;this.options=T.Util.defaults(options,this.options);this.imageSize=new T.Point(0,0);this.className="marker";
this.events=new T.EventDispatcher();this.isDraggable=true;this.initContainer();};ImageMarker.prototype={options:{draggable:false,draggableUsingOffset:false,popOnClick:true,offset:new T.Point(0,0),anchor:"bottom-center"},initContainer:function(){if(!this.$container){this.$container=T.DomUtil.create("div","tibco-marker");
this.$container.marker=this;this.$container.style.position="absolute";}},addHandler:function(handler){handler.init(this);
},handleEvents:function(eventName,evt){this.layer.events.fire(eventName,this,evt);},reset:function(){if(!this.layer||!this.layer.map){return;
}var pxPosition=this.layer.map.latLngToPoint(this.latlng);switch(this.options.anchor){case"bottom-left":pxPosition.y=pxPosition.y-this.imageSize.y;
break;case"bottom-center":pxPosition.x=pxPosition.x-(this.imageSize.x/2);pxPosition.y=pxPosition.y-this.imageSize.y;
break;case"bottom-right":pxPosition.x=pxPosition.x-this.imageSize.x;pxPosition.y=pxPosition.y-this.imageSize.y;
break;}pxPosition=pxPosition.substract(this.options.offset).floor();T.DomUtil.position(this.$container,pxPosition);
},resetFromPx:function(){var p=T.DomUtil.position(this.$container).add(new T.Point(this.imageSize.x/2,this.imageSize.y));
if(this.layer){this.latlng=this.layer.map.pointToLatLng(p);}},resetOffset:function(){var viewportPos=this.layer.map.latLngToPoint(this.latlng);
var currentPos=T.DomUtil.position(this.$container);this.dragOffset=currentPos.substract(viewportPos);
},initImage:function(){var image=this.image=T.DomUtil.create("img","tibco-marker-image");image.marker=this;
image.onload=this.onImageLoad;image.onerror=this.onImageError;image.src=this.url;this.$container.appendChild(image);
},onAdd:function(layer){if(!this.image){this.initImage();}this.events.on("before-drag-start",this.onBeforeDragStart,this);
this.events.on("drag-start",this.onDragStart,this);this.events.on("drag",this.onDrag,this);this.events.on("drag-end",this.onDragEnd,this);
},onRemove:function(layer){this.events.detachAll();},move:function(latlng){this.latlng=latlng;this.reset();
if(this.popup){if(this.popup.isOpen()){this.popup.open(this);}}},onImageLoad:function(){this.marker.imageSize=new T.Point(this.width,this.height);
this.marker.reset();},onImageError:function(){},onBeforeDragStart:function(evt){if(!this.options.draggable){return;
}this.startPoint=new T.Point(evt.clientX,evt.clientY);this.startPos=T.DomUtil.position(this.$container);
if(this.options.popOnClick){var p=T.DomUtil.position(this.$container);p.y-=2;T.DomUtil.position(this.$container,p);
}},onDragStart:function(evt){if(!this.options.draggable){return;}var newPoint=new T.Point(evt.clientX,evt.clientY),offset=newPoint.substract(this.startPoint);
this.moved=true;this.startPos=T.DomUtil.position(this.$container).substract(offset);if(this.layer){if(this.popup){this.popup.close();
}}},onDrag:function(evt){if(!this.options.draggable){return;}var newPoint=new T.Point(evt.clientX,evt.clientY),offset=newPoint.substract(this.startPoint),newPosition=this.startPos.add(offset);
T.DomUtil.position(this.$container,newPosition);},onDragEnd:function(evt){if(!this.options.draggable){return;
}if(this.options.popOnClick){var p=T.DomUtil.position(this.$container);p.y+=2;T.DomUtil.position(this.$container,p);
}if(this.options.draggableUsingOffset){this.resetOffset();this.resetFromPx();}else{this.resetFromPx();
}}};exports.ImageMarker=ImageMarker;}(window.T));},function(module,exports){(function(exports){var HtmlMarker=function(latlng,html,options){this.latlng=latlng;
this.html=html;this.options=T.Util.defaults(options,this.options);this.dragOffset=new T.Point(0,0);this.className="marker";
this.events=new T.EventDispatcher();this.isDraggable=true;this.initContainer();};HtmlMarker.prototype={options:{draggable:false,draggableUsingOffset:false,popOnClick:false,offset:new T.Point(0,0)},initContainer:function(){if(!this.$container){this.$container=T.DomUtil.create("div","tibco-marker");
this.$container.marker=this;this.$container.style.position="absolute";if(this.html){this.$container.innerHTML=this.html;
}}},addHandler:function(handler){handler.init(this);},handleEvents:function(eventName,evt){this.layer.events.fire(eventName,this,evt);
},reset:function(){if(!this.layer||!this.layer.map){return;}var pxPosition=this.layer.map.latLngToPoint(this.latlng).floor();
pxPosition=pxPosition.substract(this.options.offset).add(this.dragOffset);T.DomUtil.position(this.$container,pxPosition);
},resetFromPx:function(){var p=T.DomUtil.position(this.$container).add(this.options.offset);if(this.layer){this.latlng=this.layer.map.pointToLatLng(p);
}},resetOffset:function(){var viewportPos=this.layer.map.latLngToPoint(this.latlng);var currentPos=T.DomUtil.position(this.$container);
this.dragOffset=currentPos.substract(viewportPos);},onAdd:function(layer){this.events.on("before-drag-start",this.onBeforeDragStart,this);
this.events.on("drag-start",this.onDragStart,this);this.events.on("drag",this.onDrag,this);this.events.on("drag-end",this.onDragEnd,this);
},onRemove:function(layer){this.events.detachAll();},onBeforeDragStart:function(evt){if(!this.options.draggable){return;
}this.startPoint=new T.Point(evt.clientX,evt.clientY);this.startPos=T.DomUtil.position(this.$container);
if(this.options.popOnClick){var p=T.DomUtil.position(this.$container);p.y-=2;T.DomUtil.position(this.$container,p);
}},onDragStart:function(evt){if(!this.options.draggable){return;}var newPoint=new T.Point(evt.clientX,evt.clientY),offset=newPoint.substract(this.startPoint);
this.moved=true;this.startPos=T.DomUtil.position(this.$container).substract(offset);if(this.layer){if(this.popup){this.popup.close();
}}},onDrag:function(evt){if(!this.options.draggable){return;}var newPoint=new T.Point(evt.clientX,evt.clientY),offset=newPoint.substract(this.startPoint),newPosition=this.startPos.add(offset);
T.DomUtil.position(this.$container,newPosition);},onDragEnd:function(evt){if(!this.options.draggable){return;
}if(this.options.popOnClick){var p=T.DomUtil.position(this.$container);p.y+=2;T.DomUtil.position(this.$container,p);
}if(this.options.draggableUsingOffset){this.resetOffset();}else{this.resetFromPx();}}};exports.HtmlMarker=HtmlMarker;
}(window.T));},function(module,exports){(function(exports){var ScaleControl=function(options){this.options=T.Util.defaults(options,this.options);
};ScaleControl.prototype={options:{offset:[0,0],fontSize:10,fontStyle:"normal",fontFamily:"Tahoma",kmLabel:"km",mLabel:"m",miLabel:"mi",ftLabel:"ft",unitSystem:"metric"},initContainer:function(){if(!this.$container){this.$container=T.DomUtil.create("div","scale-control",this.map.$container.controls);
this.$container.style.position="absolute";this.$container.style.left=(this.options.offset[0]+5)+"px";
this.$container.style.bottom=(this.options.offset[1]+5)+"px";this.$container.style.fontSize=this.options.fontSize+"pt";
this.$container.style.fontFamily=this.options.fontFamily;this.$container.style.fontStyle=this.options.fontStyle;
}},getPresetDistance:function(resolution){var resStr=parseInt(resolution,10).toString();var multiplier=Math.pow(10,resStr.length);
var res=resolution/multiplier;if(res<0.03){return multiplier;}else{if(res<0.1){return 5*multiplier;}else{if(res<0.2){return 10*multiplier;
}else{if(res<0.4){return 20*multiplier;}else{return 50*multiplier;}}}}},getPresetMileDistance:function(resolution){var resStr=parseInt(resolution,10).toString();
var multiplier=Math.pow(10,resStr.length);var res=resolution/multiplier;if(res<0.015){return 5;}else{if(res<0.02){return 10;
}else{if(res<0.03){return multiplier;}else{if(res<0.1){return 5*multiplier;}else{if(res<0.2){return 10*multiplier;
}else{if(res<0.4){return 20*multiplier;}else{return 50*multiplier;}}}}}}},getPresetFeetDistance:function(resolution){var resStr=parseInt(resolution,10).toString();
var multiplier=Math.pow(10,resStr.length);var res=resolution/multiplier;if(res<0.03){return multiplier;
}else{if(res<0.15){return 5*multiplier;}else{if(res<0.25){return 10*multiplier;}else{if(res<0.45){return 20*multiplier;
}else{return 50*multiplier;}}}}},reset:function(){var resolution=this.map.getMapResolution();var distance,label,width,mileResolution,feetResolution,useMiles;
if(this.options.unitSystem==="metric"){distance=this.getPresetDistance(resolution);width=distance/resolution;
label=this.options.mLabel;if(distance/1000>=1){distance=distance/1000;label=this.options.kmLabel;}}else{feetResolution=resolution*3.28084;
distance=this.getPresetFeetDistance(feetResolution);label=this.options.ftLabel;useMiles=false;if(distance/5280>=1){mileResolution=resolution*0.000621371;
distance=this.getPresetMileDistance(mileResolution);useMiles=true;label=this.options.miLabel;}width=useMiles===false?distance*0.3048/resolution:distance*1609.34/resolution;
}var html="";html+='<div style="padding-left: 5px;"><span>'+distance+" "+label+"</span></div>";html+='<div style="width: '+width+'px; height: 0px; border: 1px solid;"></div>';
html+='<div style="position: absolute; border: 1px solid;height: 5px;bottom: 0;"></div>';html+='<div style="position: absolute; border: 1px solid;height: 5px;bottom: 0;left:'+width+'px;"></div>';
this.$container.innerHTML=html;},onAdd:function(map){this.map=map;this.map.events.on("view-reset",this.reset,this);
this.map.events.on("move",this.reset,this);this.initContainer();this.reset();},onRemove:function(){this.map.events.detach("view-reset",this.reset);
this.map.events.detach("move",this.reset);T.DomUtil.remove(this.$container);this.map=null;}};exports.ScaleControl=ScaleControl;
}(window.T));},function(module,exports){(function(exports){var AttributionControl=function(options){this.options=T.Util.defaults(options,this.options);
this.attributions=[];};AttributionControl.prototype={options:{separator:" | ",prefix:"",offset:[0,0],fontSize:9,fontFamily:"Tahoma",opacity:0.5},initContainer:function(){if(!this.$container){this.$container=T.DomUtil.create("div","tibco-control tibco-attribution",this.map.$container.controls);
this.$container.style.background="#FFFFFF";this.$container.style.position="absolute";this.$container.style.margin=0;
this.$container.style.right=(this.options.offset[0])+"px";this.$container.style.bottom=(this.options.offset[1])+"px";
this.$container.style.padding="5px";this.$container.style.fontSize=this.options.fontSize+"pt";this.$container.style.fontFamily=this.options.fontFamily;
this.$container.style.filter="progid:DXImageTransform.Microsoft.Alpha(Opacity="+this.options.opacity*100+")";
T.DomUtil.setOpacity(this.$container,this.options.opacity);}},reset:function(){var attribution="";var separator=this.options.separator;
if(this.options.prefix===""||this.attributions.length===0){separator="";}attribution=this.options.prefix+separator+this.attributions.join(this.options.separator);
if(!attribution){this.$container.style.display="none";}else{this.$container.style.display="block";this.$container.innerHTML=attribution;
}},addAttribution:function(text){if(!text||this.getAttributionIndex(text)>-1){return;}this.attributions.push(text);
this.reset();return this;},removeAttribution:function(text){if(!text){return;}var index=this.getAttributionIndex(text);
if(index>-1){this.attributions=this.attributions.slice(index,1);}return this;},getAttributionIndex:function(text){var i=0;
for(i=0;i<this.attributions.length;i++){if(text===this.attributions[i]){return i;}}return -1;},onAdd:function(map){this.map=map;
this.map.events.on("layer-add",this.onLayerAdd,this);this.map.events.on("layer-remove",this.onLayerRemove,this);
this.map.events.on("layer-attribution-reset",this.onLayerAttributionReset,this);this.map.events.on("attribution-update",this.onAttributionUpdate,this);
this.initContainer();this.reset();},onRemove:function(){this.map.events.detach("layer-add",this.onLayerAdd);
this.map.events.detach("layer-remove",this.onLayerRemove);T.DomUtil.remove(this.$container);this.map=null;
},onLayerAdd:function(layer){if(layer.options.attribution){if(typeof(layer.options.attribution)==="object"){this.addAttribution(layer.options.attribution.text);
}else{this.addAttribution(layer.options.attribution);}}},onLayerRemove:function(layer){if(layer.options.attribution){if(typeof(layer.options.attribution)==="object"){this.removeAttribution(layer.options.attribution.text);
}else{this.removeAttribution(layer.options.attribution);}}},onAttributionUpdate:function(options){if(options){T.Util.defaults(this.options,options);
}},onLayerAttributionReset:function(layer){if(layer.options.attribution){if(typeof(layer.options.attribution)==="object"){this.addAttribution(layer.options.attribution.text);
}else{this.addAttribution(layer.options.attribution);}}}};exports.AttributionControl=AttributionControl;
}(window.T));},function(module,exports){(function(exports){var RulerControl=function(options){this.options=T.Util.defaults(options,this.options);
this.disbaled=false;this.vectorLayer=null;this.markerLayer=null;this.coordinates=[];this.distance=0;this.polyline=new T.Polyline(this.coordinates);
this.polyline.setStyle({color:"#FF0000",stroke:true});this.events=new T.EventDispatcher();};RulerControl.prototype={options:{disableMouse:false,useCanvas:false,startFlag:"",endFlag:""},initContainer:function(){if(!this.vectorLayer){this.vectorLayer=new T.VectorLayer({useCanvas:this.options.useCanvas});
this.map.addLayer(this.vectorLayer);this.vectorLayer.addGeometry(this.polyline);}if(!this.markersLayer){this.markerLayer=new T.MarkersLayer();
this.map.addLayer(this.markerLayer);}},calculateDisance:function(){var i;this.distance=0;if(this.coordinates.length>1){for(i=1;
i<this.coordinates.length;i++){this.distance+=this.computeDistanceBetween(T.LatLng.from(this.coordinates[i-1]),T.LatLng.from(this.coordinates[i]));
}}this.events.fire("distance-changed",this);},computeDistanceBetween:function(a,b){var R=6371;var dLat=(b.lat-a.lat).toRad();
var dLon=(b.lng-a.lng).toRad();var lat1=a.lat.toRad();var lat2=b.lat.toRad();var x=Math.sin(dLat/2)*Math.sin(dLat/2)+Math.sin(dLon/2)*Math.sin(dLon/2)*Math.cos(lat1)*Math.cos(lat2);
var y=2*Math.atan2(Math.sqrt(x),Math.sqrt(1-x));var d=R*y;return d;},enable:function(){if(!this.options.disableMouse){T.DomEventUtil.on(this.map.$container,"click",this.onMapClick,this);
if(T.Util.touchSupport()){T.DomEventUtil.on(this.map.$container,"touchstart",this.onMapClick,this);}}this.disabled=false;
},disable:function(){T.DomEventUtil.off(this.map.$container,"click",this.onMapClick);if(T.Util.touchSupport()){T.DomEventUtil.off(this.map.$container,"touchstart",this.onMapClick,this);
}this.disabled=true;},addCoordinate:function(coord){this.coordinates.push([coord.lat,coord.lng]);this.reset();
},addCoordinateAt:function(coord,index){this.coordinates.splice(index,0,[coord.lat,coord.lng]);this.reset();
},reset:function(){this.vectorLayer.updateViewPort();var startMarker=null;if(this.coordinates.length===1){startMarker=new T.ImageMarker(T.LatLng.from(this.coordinates[0]),this.options.startFlag,{anchor:"bottom-center",offset:new T.Point(0,-5)});
this.markerLayer.removeAllMarkers();this.markerLayer.addMarker(startMarker);}else{if(this.coordinates.length>1){startMarker=new T.ImageMarker(T.LatLng.from(this.coordinates[0]),this.options.startFlag,{anchor:"bottom-center",offset:new T.Point(0,-5)});
var stopMarker=new T.ImageMarker(T.LatLng.from(this.coordinates[this.coordinates.length-1]),this.options.endFlag,{anchor:"bottom-center",offset:new T.Point(0,-5)});
this.markerLayer.removeAllMarkers();this.markerLayer.addMarker(startMarker);this.markerLayer.addMarker(stopMarker);
}}this.calculateDisance();},clear:function(){this.coordinates=[];this.polyline.coords=this.coordinates;
this.markerLayer.removeAllMarkers();this.reset();},onAdd:function(map){this.map=map;this.map.events.on("view-reset",this.reset,this);
this.initContainer();this.reset();},onRemove:function(){this.map.events.detach("view-reset",this.reset);
T.DomUtil.remove(this.$container);this.map=null;},onMapClick:function(e){var mousePosition=this.map.computeMousePosition(e);
var coord=this.map.containerPointToLatLng(mousePosition);this.coordinates.push([coord.lat,coord.lng]);
this.reset();}};exports.RulerControl=RulerControl;}(window.T));},function(module,exports){(function(exports){var LayersControl=function(options){this.options=T.Util.defaults(options,this.options);
this.attributions=[];};LayersControl.prototype={CONTROL_LAYERS_CLASS:"tibco-control-layers",CONTROL_LAYERS_HEADER_CLASS:"header",CONTROL_LAYERS_CONTAINER_CLASS:"layers",HEADER_LABEL_CLASS:"label",HEADER_COLLAPSE_CLASS:"collapse",HEADER_COLLAPSE_TRUE_CLASS:"is-collapsed",HEADER_COLLAPSE_FALSE_CLASS:"is-not-collapsed",LAYER_CONTAINER_CLASS:"layer",LAYER_RADIO_CLASS:"radio",LAYER_VISIBLE_CLASS:"visibility",LAYER_LABEL_CLASS:"label",LAYER_SELECTED_CLASS:"selected",options:{offset:[0,0],fontSize:10,fontFamily:"Tahoma"},initContainer:function(){if(!this.$container){this.$container=T.DomUtil.create("div",this.CONTROL_LAYERS_CLASS,this.map.$container.controls);
this.$container.style.top=(this.options.offset[0])+"px";this.$container.style.left=(this.options.offset[1])+"px";
this.$container.style.fontSize=this.options.fontSize+"pt";this.$container.style.fontFamily=this.options.fontFamily;
this.createHeader();this.createLayersContainer();this.selectedLayerData=this.map.getLayers()[this.map.getLayers().length-1];
}},reset:function(){var layers=this.map.getLayers(),i=0;this.clearLayers();for(i=0;i<layers.length;i++){this.createLayer(layers[i]);
}this.bindKeyEvents();},createHeader:function(){var label=null,collapse=null;this.$headerContainer=T.DomUtil.create("div",this.CONTROL_LAYERS_HEADER_CLASS,this.$container);
this.$headerContainer.style.fontSize=this.options.fontSize+"pt";this.$headerContainer.style.fontFamily=this.options.fontFamily;
label=T.DomUtil.create("div",this.HEADER_LABEL_CLASS,this.$headerContainer);label.innerHTML="Layers";
collapse=T.DomUtil.create("div",this.HEADER_COLLAPSE_CLASS,this.$headerContainer);T.DomEventUtil.on(this.$headerContainer,"click",this.toggleLayers,this);
if(T.Util.touchSupport()){T.DomEventUtil.on(this.$headerContainer,"touchstart",this.toggleLayers,this);
}},createLayersContainer:function(){this.$layersContainer=T.DomUtil.create("div",this.CONTROL_LAYERS_CONTAINER_CLASS,this.$container);
this.$layersContainer.tabIndex="1";this.$layersContainer.style.display="none";},createLayer:function(layer){var layerContainer=null,radio=null,checkbox=null,label=null;
layerContainer=T.DomUtil.create("div",this.LAYER_CONTAINER_CLASS,this.$layersContainer);radio=T.DomUtil.create("input",this.LAYER_RADIO_CLASS);
radio.type="radio";radio.name="active-layer";layerContainer.appendChild(radio);radio.checked=(layer===this.selectedLayerData)?"checked":"";
checkbox=T.DomUtil.create("input",this.LAYER_VISIBLE_CLASS);checkbox.type="checkbox";layerContainer.appendChild(checkbox);
checkbox.checked=(layer.isVisible()===true)?"checked":"";label=T.DomUtil.create("div",this.LAYER_LABEL_CLASS);
label.innerHTML=layer.name;layerContainer.appendChild(label);T.DomEventUtil.on(radio,"click",this.onSelectLayer,this);
T.DomEventUtil.on(checkbox,"click",this.onSetLayerVisibility,this);if(T.Util.touchSupport()){T.DomEventUtil.on(radio,"touchstart",this.onSelectLayer,this);
T.DomEventUtil.on(checkbox,"touchstart",this.onSetLayerVisibility,this);}},toggleLayers:function(){var collapse=T.DomUtil.getNodesByClass(this.HEADER_COLLAPSE_CLASS)[0];
if(!collapse){return;}if(this.areLayersVisible()){collapse.className=this.HEADER_COLLAPSE_CLASS+" "+this.HEADER_COLLAPSE_TRUE_CLASS;
T.DomEventUtil.off(this.$layersContainer,"keydown",this.onKeydownHandler,this);this.hideLayers();}else{collapse.className=this.HEADER_COLLAPSE_CLASS+" "+this.HEADER_COLLAPSE_FALSE_CLASS;
T.DomEventUtil.on(this.$layersContainer,"keydown",this.onKeydownHandler,this);this.showLayers();this.$layersContainer.focus();
}},showLayers:function(){this.$layersContainer.style.display="block";},hideLayers:function(){this.$layersContainer.style.display="none";
},areLayersVisible:function(){return(this.$layersContainer.style.display!=="none"?true:false);},clearLayers:function(){while(this.$layersContainer.hasChildNodes()){if(T.DomUtil.hasClass(this.$layersContainer.lastChild,this.LAYER_CONTAINER_CLASS)){this.$layersContainer.removeChild(this.$layersContainer.lastChild);
}}},bindKeyEvents:function(){T.DomEventUtil.off(document,"keydown",this.onKeydownHandler,this);T.DomEventUtil.on(document,"keydown",this.onKeydownHandler,this);
},onKeydownHandler:function(evt){if(evt.stopPropagation!==undefined){evt.stopPropagation();}else{evt.cancelBubble=true;
}if(!this.selectedLayerData){return;}if(evt.keyCode===38){this.map.moveLayerDown(this.selectedLayerData);
}else{if(evt.keyCode===40){this.map.moveLayerUp(this.selectedLayerData);}}},onSelectLayer:function(evt){var targetEelement=evt.srcElement===undefined?evt.target:evt.srcElement;
this.selectedLayerIndex=T.DomUtil.getNodeIndex(targetEelement.parentNode,this.$layersContainer);this.selectedLayerData=this.map.getLayers()[this.selectedLayerIndex];
this.$layersContainer.focus();},onSetLayerVisibility:function(evt){var layer=null,layerIndex=-1,targetEelement=evt.srcElement===undefined?evt.target:evt.srcElement,layerVisible=targetEelement.checked;
layerIndex=T.DomUtil.getNodeIndex(targetEelement.parentNode,this.$layersContainer);layer=this.map.getLayers()[layerIndex];
layer.setVisible(layerVisible);},onAdd:function(map){this.map=map;this.map.events.on("layer-add",this.reset,this);
this.map.events.on("layer-remove",this.reset,this);this.map.events.on("layer-moved",this.reset,this);
this.map.events.on("layer-hide",this.reset,this);this.map.events.on("layer-show",this.reset,this);this.initContainer();
this.reset();},onRemove:function(){this.map.events.detach("layer-add",this.reset);this.map.events.detach("layer-remove",this.reset);
this.map.events.detach("layer-moved",this.reset);T.DomEventUtil.off(this.$headerContainer,"click",this.toggleLayers,this);
if(T.Util.touchSupport()){T.DomEventUtil.off(this.$headerContainer,"touchstart",this.toggleLayers,this);
}T.DomUtil.remove(this.$container);this.map=null;}};exports.LayersControl=LayersControl;}(window.T));
},function(module,exports){(function(exports){var TibcoMapControl=function(options){this.options=T.Util.defaults(options,this.options);
this.attributions=[];};TibcoMapControl.prototype={CONTROL_LAYERS_CLASS:"tibco-control-tibco-map",CONTROL_LAYERS_HEADER_CLASS:"header",CONTROL_LAYERS_CONTAINER_CLASS:"layers",HEADER_LABEL_CLASS:"label",HEADER_COLLAPSE_CLASS:"collapse",HEADER_COLLAPSE_TRUE_CLASS:"is-collapsed",HEADER_COLLAPSE_FALSE_CLASS:"is-not-collapsed",LAYER_CONTAINER_CLASS:"layer",LAYER_RADIO_CLASS:"radio",LAYER_VISIBLE_CLASS:"visibility",LAYER_LABEL_CLASS:"label",LAYER_SELECTED_CLASS:"selected",LAYER_OPTIONS_CONTAINER_CLASS:"layer-options",LAYER_OPTIONS_GROUP_CLASS:"layer-options-group",LAYER_OPTIONS_SELECT_CLASS:"layer-options-select",LAYER_OPTION_CLASS:"layer-option",options:{offset:[0,0],fontSize:10,fontFamily:"Tahoma"},initContainer:function(){if(!this.$container){this.$container=T.DomUtil.create("div",this.CONTROL_LAYERS_CLASS,this.map.$container.controls);
this.$container.style.top=(this.options.offset[0])+"px";this.$container.style.right=(this.options.offset[1])+"px";
this.$container.style.fontSize=this.options.fontSize+"pt";this.$container.style.fontFamily=this.options.fontFamily;
this.createHeader();this.createLayersContainer();this.createOptionsContainer();}},reset:function(){var layers=this.getMapTibcoLayers(),i=0;
this.clearContainer(this.$layersContainer,this.LAYER_CONTAINER_CLASS);for(i=0;i<layers.length;i++){this.createLayer(layers[i]);
}},createHeader:function(){var label=null,collapse=null;this.$headerContainer=T.DomUtil.create("div",this.CONTROL_LAYERS_HEADER_CLASS,this.$container);
this.$headerContainer.style.fontSize=this.options.fontSize+"pt";this.$headerContainer.style.fontFamily=this.options.fontFamily;
label=T.DomUtil.create("div",this.HEADER_LABEL_CLASS,this.$headerContainer);label.innerHTML="Tibco Layers";
collapse=T.DomUtil.create("div",this.HEADER_COLLAPSE_CLASS,this.$headerContainer);T.DomEventUtil.on(this.$headerContainer,"click",this.toggleContent,this);
if(T.Util.touchSupport()){T.DomEventUtil.on(this.$headerContainer,"touchstart",this.toggleContent,this);
}},createLayersContainer:function(){this.$layersContainer=T.DomUtil.create("div",this.CONTROL_LAYERS_CONTAINER_CLASS,this.$container);
this.$layersContainer.tabIndex="1";this.$layersContainer.style.display="none";},createOptionsContainer:function(){this.$layerOptionsContainer=T.DomUtil.create("div",this.LAYER_OPTIONS_CONTAINER_CLASS,this.$container);
this.$layerOptionsContainer.tabIndex="1";this.$layerOptionsContainer.style.display="none";},createLayer:function(layer){var layerContainer=null,radio=null,label=null;
layerContainer=T.DomUtil.create("div",this.LAYER_CONTAINER_CLASS,this.$layersContainer);radio=T.DomUtil.create("input",this.LAYER_RADIO_CLASS);
radio.type="radio";radio.name="active-layer";layerContainer.appendChild(radio);radio.checked="";label=T.DomUtil.create("div",this.LAYER_LABEL_CLASS);
label.innerHTML=layer.options.name;layerContainer.appendChild(label);T.DomEventUtil.on(radio,"click",this.onSelectLayer,this);
if(T.Util.touchSupport()){T.DomEventUtil.on(radio,"touchstart",this.onSelectLayer,this);}},createLayerOptions:function(){var i=0,mapTypesContainer=null,mapStylesContainer=null,mapTypesOptionContainer=null,mapStylesOptionContainer=null,availableMapTypes=null,availableMapStyles=null,mapTypeLabelContainer=null,mapStyleLabelContainer=null,groupContainer=null;
if(!this.selectedLayerData){throw new Error("No layer selected!");}this.clearContainer(this.$layerOptionsContainer,this.LAYER_OPTIONS_GROUP_CLASS);
this.$layerOptionsContainer.style.display="block";availableMapTypes=this.selectedLayerData.getAvailableMapTypes();
groupContainer=T.DomUtil.create("div",this.LAYER_OPTIONS_GROUP_CLASS,this.$layerOptionsContainer);mapTypeLabelContainer=T.DomUtil.create("span",this.LAYER_OPTIONS_SELECT_CLASS,groupContainer);
mapTypeLabelContainer.innerHTML="Map type:";mapTypesContainer=T.DomUtil.create("select",this.LAYER_OPTIONS_SELECT_CLASS,groupContainer);
for(i=0;i<availableMapTypes.length;i++){mapTypesOptionContainer=T.DomUtil.create("option",this.LAYER_OPTION_CLASS);
mapTypesOptionContainer.innerHTML=availableMapTypes[i];mapTypesContainer.appendChild(mapTypesOptionContainer);
T.DomEventUtil.on(mapTypesContainer,"change",this.onMapTypeChanged,this);}mapTypesContainer.value=this.selectedLayerData.options.mapType;
availableMapStyles=this.selectedLayerData.getAvailableMapStyles();if(!availableMapStyles||availableMapStyles.length===0){return;
}groupContainer=T.DomUtil.create("div",this.LAYER_OPTIONS_GROUP_CLASS,this.$layerOptionsContainer);mapStyleLabelContainer=T.DomUtil.create("span",this.LAYER_OPTIONS_SELECT_CLASS,groupContainer);
mapStyleLabelContainer.innerHTML="Map style:";mapStylesContainer=T.DomUtil.create("select",this.LAYER_OPTIONS_SELECT_CLASS,groupContainer);
for(i=0;i<availableMapStyles.length;i++){mapStylesOptionContainer=T.DomUtil.create("option",this.LAYER_OPTION_CLASS);
mapStylesOptionContainer.innerHTML=availableMapStyles[i];mapStylesContainer.appendChild(mapStylesOptionContainer);
T.DomEventUtil.on(mapStylesContainer,"change",this.onMapStyleChanged,this);}mapStylesContainer.value=this.selectedLayerData.options.mapStyle;
},getMapTibcoLayers:function(){var layers=this.map.getLayers(),tibcoLayers=[],i=0;for(i=0;i<layers.length;
i++){if(layers[i] instanceof T.TibcoLayer){tibcoLayers.push(layers[i]);}}return tibcoLayers;},toggleContent:function(){var collapse=T.DomUtil.getNodesByClass(this.HEADER_COLLAPSE_CLASS)[0];
if(!collapse){return;}if(this.areLayersVisible()){collapse.className=this.HEADER_COLLAPSE_CLASS+" "+this.HEADER_COLLAPSE_TRUE_CLASS;
this.hideContent();}else{collapse.className=this.HEADER_COLLAPSE_CLASS+" "+this.HEADER_COLLAPSE_FALSE_CLASS;
this.showContent();this.$layersContainer.focus();}},showContent:function(){this.$layersContainer.style.display="block";
if(this.selectedLayerData){this.$layerOptionsContainer.style.display="block";}},hideContent:function(){this.$layersContainer.style.display="none";
this.$layerOptionsContainer.style.display="none";},areLayersVisible:function(){return(this.$layersContainer.style.display!=="none"?true:false);
},clearContainer:function($container,containerClass){while($container.hasChildNodes()){if(T.DomUtil.hasClass($container.lastChild,containerClass)){$container.removeChild($container.lastChild);
}}},onAdd:function(map){this.map=map;this.tibcoLayers=this.getMapTibcoLayers();if(this.tibcoLayers.length===0){throw new Error("Map does not contain TibcoLayers. Cannot initialize this control!");
}this.map.events.on("layer-add",this.reset,this);this.map.events.on("layer-remove",this.reset,this);this.map.events.on("layer-moved",this.reset,this);
this.map.events.on("layer-hide",this.reset,this);this.map.events.on("layer-show",this.reset,this);this.initContainer();
this.reset();},onRemove:function(){this.map.events.detach("layer-add",this.reset);this.map.events.detach("layer-remove",this.reset);
this.map.events.detach("layer-moved",this.reset);T.DomEventUtil.off(this.$headerContainer,"click",this.toggleContent,this);
if(T.Util.touchSupport()){T.DomEventUtil.off(this.$headerContainer,"touchstart",this.toggleContent,this);
}T.DomUtil.remove(this.$container);this.map=null;},onSelectLayer:function(evt){var targetEelement=evt.srcElement===undefined?evt.target:evt.srcElement;
this.selectedLayerIndex=T.DomUtil.getNodeIndex(targetEelement.parentNode,this.$layersContainer);this.selectedLayerData=this.tibcoLayers[this.selectedLayerIndex];
this.createLayerOptions();this.$layersContainer.focus();},onMapTypeChanged:function(evt){var targetEelement=evt.srcElement===undefined?evt.target:evt.srcElement,self=this;
this.selectedLayerData.setMapType(targetEelement.value).then(function(){self.createLayerOptions();},function(){});
},onMapStyleChanged:function(evt){var targetEelement=evt.srcElement===undefined?evt.target:evt.srcElement;
this.selectedLayerData.setMapStyle(targetEelement.value);this.createLayerOptions();}};exports.TibcoMapControl=TibcoMapControl;
}(window.T));},function(module,exports){(function(exports){var NavigationControl=function(options){this.minHeight=100;
this.options=T.Util.defaults(options,this.options);this.height=(!this.options.zoomRailHeight||this.options.zoomRailHeight<this.minHeight)?this.minHeight:this.options.zoomRailHeight;
};NavigationControl.prototype={CONTROL_NAVIGATION_CLASS:"tibco-control-navigation",PAN_CONTROL_CLASS:"pan-control",RESET_CLASS:"reset",PAN_UP_CLASS:"pan-up",PAN_DOWN_CLASS:"pan-down",PAN_LEFT_CLASS:"pan-left",PAN_RIGHT_CLASS:"pan-right",ZOOM_CONTROL_CLASS:"zoom-control",ZOOM_IN_CLASS:"zoom-in",ZOOM_OUT_CLASS:"zoom-out",ZOOM_SLIDER_CLASS:"zoom-slider",ZOOM_RAIL_CLASS:"zoom-rail",ZOOM_THUMB_CLASS:"zoom-thumb",options:{offset:[0,0],panOffset:100,panControl:true,zoomControl:true},initContainer:function(){if(!this.$container){this.$container=T.DomUtil.create("div",this.CONTROL_NAVIGATION_CLASS,this.map.$container.controls);
this.$container.style.top=(this.options.offset[0])+"px";this.$container.style.left=(this.options.offset[1])+"px";
this.initPanControl();this.initZoomControl();}},initPanControl:function(){if(!this.options.panControl){return;
}this.createPanControl();},initZoomControl:function(){if(!this.options.zoomControl){return;}this.createZoomControl();
this.setPositionForZoom(this.map.zoom);this.drag=new T.MouseUtil(this.$zoomThumbContainer,this.$zoomThumbContainer,{limit:{minX:0,maxX:0,minY:this.minY,maxY:this.maxY}});
this.drag.events.on("drag-end",this.onZoomThumbDragEnd,this);this.drag.enable();},createPanControl:function(){this.$panContainer=T.DomUtil.create("div",this.PAN_CONTROL_CLASS,this.$container);
this.$panUpContainer=T.DomUtil.create("div",this.PAN_UP_CLASS,this.$panContainer);this.$panUpContainer.title=(this.options.titles&&this.options.titles.panUp)?this.options.titles.panUp:"";
this.$panDownContainer=T.DomUtil.create("div",this.PAN_DOWN_CLASS,this.$panContainer);this.$panDownContainer.title=(this.options.titles&&this.options.titles.panDown)?this.options.titles.panDown:"";
this.$panLeftContainer=T.DomUtil.create("div",this.PAN_LEFT_CLASS,this.$panContainer);this.$panLeftContainer.title=(this.options.titles&&this.options.titles.panLeft)?this.options.titles.panLeft:"";
this.$panRightContainer=T.DomUtil.create("div",this.PAN_RIGHT_CLASS,this.$panContainer);this.$panRightContainer.title=(this.options.titles&&this.options.titles.panRight)?this.options.titles.panRight:"";
if(!this.options.disableMapReset){this.$resetContainer=T.DomUtil.create("div",this.RESET_CLASS,this.$panContainer);
this.$resetContainer.title=(this.options.titles&&this.options.titles.reset)?this.options.titles.reset:"";
T.DomEventUtil.on(this.$resetContainer,"click",this.onReset,this);if(T.Util.touchSupport()){T.DomEventUtil.on(this.$resetContainer,"touchstart",this.onReset,this);
}}T.DomEventUtil.on(this.$panUpContainer,"click",this.onPanUp,this);T.DomEventUtil.on(this.$panDownContainer,"click",this.onPanDown,this);
T.DomEventUtil.on(this.$panLeftContainer,"click",this.onPanLeft,this);T.DomEventUtil.on(this.$panRightContainer,"click",this.onPanRight,this);
if(T.Util.touchSupport()){T.DomEventUtil.on(this.$panUpContainer,"touchstart",this.onPanUp,this);T.DomEventUtil.on(this.$panDownContainer,"touchstart",this.onPanDown,this);
T.DomEventUtil.on(this.$panLeftContainer,"touchstart",this.onPanLeft,this);T.DomEventUtil.on(this.$panRightContainer,"touchstart",this.onPanRight,this);
}},createZoomControl:function(){this.$zoomContainer=T.DomUtil.create("div",this.ZOOM_CONTROL_CLASS,this.$container);
this.$zoomInContainer=T.DomUtil.create("div",this.ZOOM_IN_CLASS,this.$zoomContainer);this.$zoomInContainer.title=(this.options.titles&&this.options.titles.zoomIn)?this.options.titles.zoomIn:"";
this.$zoomOutContainer=T.DomUtil.create("div",this.ZOOM_OUT_CLASS,this.$zoomContainer);this.$zoomOutContainer.title=(this.options.titles&&this.options.titles.zoomOut)?this.options.titles.zoomOut:"";
this.$zoomSliderContainer=T.DomUtil.create("div",this.ZOOM_SLIDER_CLASS,this.$zoomContainer);this.$zoomRailContainer=T.DomUtil.create("div",this.ZOOM_RAIL_CLASS,this.$zoomSliderContainer);
this.$zoomThumbContainer=T.DomUtil.create("div",this.ZOOM_THUMB_CLASS,this.$zoomRailContainer);this.$zoomSliderContainer.style.height=this.height+"px";
if(this.minZoom===0){this.$zoomSliderContainer.style.height=this.height+this.$zoomThumbContainer.clientHeight+"px";
}else{this.$zoomSliderContainer.style.height=this.height+this.$zoomThumbContainer.clientHeight-this.zoomSkipInterval+"px";
}this.$zoomContainer.style.height=this.$zoomSliderContainer.clientHeight+this.$zoomInContainer.clientHeight+this.$zoomOutContainer.clientHeight+"px";
this.minY=0;if(this.minZoom===0){this.maxY=this.height;}else{this.maxY=this.height-this.zoomSkipInterval;
}T.DomEventUtil.on(this.$zoomInContainer,"click",this.onZoomIn,this);T.DomEventUtil.on(this.$zoomOutContainer,"click",this.onZoomOut,this);
T.DomEventUtil.on(this.$zoomRailContainer,"click",this.onRailClick,this);if(T.Util.touchSupport()){T.DomEventUtil.on(this.$zoomInContainer,"touchstart",this.onZoomIn,this);
T.DomEventUtil.on(this.$zoomOutContainer,"touchstart",this.onZoomOut,this);}},getBottomPosition:function(topPosition){return this.height-topPosition;
},setPositionForZoom:function(zoom){var position=null,snapPosition=null;zoom=(zoom!==undefined)?zoom:this.map.zoom;
position=this.getBottomPosition(zoom*this.zoomSkipInterval);T.DomUtil.position(this.$zoomThumbContainer,new T.Point(0,position));
},setZoomForPosition:function(position){var newZoom=null;position=this.getBottomPosition(position);if(position===this.minY){newZoom=this.minZoom;
}else{newZoom=Math.round(position/this.zoomSkipInterval);}this.map.setZoom(newZoom);},reset:function(){if(this.$container){T.DomUtil.remove(this.$container);
this.$container=null;}this.minZoom=this.map.options.minZoom;this.maxZoom=this.map.options.maxZoom;if(this.minZoom===0){this.zoomSkipInterval=this.height/this.maxZoom;
}else{this.zoomSkipInterval=this.height/(this.maxZoom-this.minZoom+1);}this.initContainer();},onPanUp:function(){var p=new T.Point(0,this.options.panOffset);
this.map.panBy(p);},onPanDown:function(){var p=new T.Point(0,-this.options.panOffset);this.map.panBy(p);
},onPanLeft:function(){var p=new T.Point(this.options.panOffset,0);this.map.panBy(p);},onPanRight:function(){var p=new T.Point(-this.options.panOffset,0);
this.map.panBy(p);},onReset:function(){this.map.resetView(this.map.options.center,this.map.options.zoom);
},onZoomIn:function(){this.map.setZoom(this.map.zoom+1);},onZoomOut:function(){this.map.setZoom(this.map.zoom-1);
},onZoomThumbDragEnd:function(){var thumbPosition=T.DomUtil.position(this.$zoomThumbContainer).y;this.setZoomForPosition(thumbPosition);
},onRailClick:function(evt){var position=null,targetEelement=null;targetEelement=evt.srcElement===undefined?evt.target:evt.srcElement;
if(targetEelement.className===this.ZOOM_RAIL_CLASS){position=evt.offsetY===undefined?evt.layerY:evt.offsetY;
this.setZoomForPosition(position);}},onAdd:function(map){this.map=map;this.map.events.on("view-reset",this.setPositionForZoom,this);
this.map.events.on("zoom-interval-change",this.reset,this);this.reset();},onRemove:function(){this.map.events.detach("view-reset",this.setPositionForZoom);
this.map.events.detach("zoom-interval-change",this.reset);T.DomEventUtil.off(this.$zoomInContainer,"click",this.onZoomIn,this);
T.DomEventUtil.off(this.$zoomOutContainer,"click",this.onZoomOut,this);T.DomEventUtil.off(this.$zoomRailContainer,"click",this.onRailClick,this);
T.DomEventUtil.off(this.$resetContainer,"click",this.onReset,this);T.DomEventUtil.off(this.$panUpContainer,"click",this.onPanUp,this);
T.DomEventUtil.off(this.$panDownContainer,"click",this.onPanDown,this);T.DomEventUtil.off(this.$panLeftContainer,"click",this.onPanLeft,this);
T.DomEventUtil.off(this.$panRightContainer,"click",this.onPanRight,this);if(T.Util.touchSupport()){T.DomEventUtil.off(this.$panUpContainer,"touchstart",this.onPanUp,this);
T.DomEventUtil.off(this.$panDownContainer,"touchstart",this.onPanDown,this);T.DomEventUtil.off(this.$panLeftContainer,"touchstart",this.onPanLeft,this);
T.DomEventUtil.off(this.$panRightContainer,"touchstart",this.onPanRight,this);T.DomEventUtil.off(this.$resetContainer,"touchstart",this.onReset,this);
T.DomEventUtil.off(this.$zoomInContainer,"touchstart",this.onZoomIn,this);T.DomEventUtil.off(this.$zoomOutContainer,"touchstart",this.onZoomOut,this);
}T.DomUtil.remove(this.$container);this.map=null;}};exports.NavigationControl=NavigationControl;}(window.T));
},function(module,exports){(function(exports){var ContextMenuControl=function(options){this.options=T.Util.defaults(options,this.options);
};ContextMenuControl.prototype={CONTEXT_MENU_CLASS:"tibco-control-context-menu",CONTEXT_MENU_ITEM_CLASS:"item",options:{offset:[0,0]},reset:function(){this.removeContextMenu();
},addContextMenu:function(evt){this.evt=evt;this.removeContextMenu();if(!this.$container){this.$container=T.DomUtil.create("div",this.CONTEXT_MENU_CLASS,this.map.$container.controls);
this.$container.style.top=(evt.clientY-this.map.$container.offsetTop+this.options.offset[0])+"px";this.$container.style.left=(evt.clientX-this.map.$container.offsetLeft+this.options.offset[1])+"px";
}this.addContextMenuItem("What's here?",this.onLocationClick);},addContextMenuItem:function(text,callback){var $menuItemContainer=T.DomUtil.create("div",this.CONTEXT_MENU_ITEM_CLASS,this.$container);
$menuItemContainer.innerHTML=text;T.DomEventUtil.on($menuItemContainer,"click",callback,this);},removeContextMenu:function(){if(this.$container){T.DomUtil.remove(this.$container);
this.$container=null;}this.removeContextMenuItems();},removeContextMenuItems:function(){if(this.markerLayer){this.markerLayer.removeAllMarkers();
}if(this.popupLayer){this.popupLayer.removeAllPopups();}},onLocationClick:function(){var popup=null,marker=null;
this.removeContextMenu();if(!this.markerLayer){this.markerLayer=new T.MarkersLayer({name:"Internal Context Menu Marker Layer"});
this.map.addLayer(this.markerLayer);}this.markerLayer.removeAllMarkers();marker=new T.ImageMarker(this.evt.latLng,"http://geoanalytics.tibco.com/documentation/assets/img/marker.png",{offset:new T.Point(-2,-10)});
this.markerLayer.addMarker(marker);if(!this.popupLayer){this.popupLayer=new T.PopupsLayer({name:"Internal Context Menu Popup Layer"});
this.map.addLayer(this.popupLayer);}this.popupLayer.removeAllPopups();popup=new T.Popup("<div class='tibco-control-context-menu-popup'>"+this.evt.latLng.lat.toFixed(6)+", "+this.evt.latLng.lng.toFixed(6)+"</div>",{offset:{x:0,y:-35},panMap:true,panMapExtraOffset:{x:10,y:10}});
this.popupLayer.addPopup(popup);popup.open(marker.latlng);},onAdd:function(map){this.map=map;this.map.events.on("right-click",this.addContextMenu,this);
this.map.events.on("press",this.removeContextMenu,this);this.map.events.on("long-press",this.removeContextMenu,this);
this.map.events.on("move",this.removeContextMenu,this);this.map.events.on("view-reset",this.removeContextMenu,this);
this.reset();},onRemove:function(){this.map.events.detach("right-click",this.addContextMenu);this.map.events.detach("press",this.removeContextMenu);
this.map.events.detach("long-press",this.removeContextMenu);this.map.events.detach("move",this.removeContextMenu);
this.map.events.detach("view-reset",this.removeContextMenu);T.DomUtil.remove(this.$container);this.map=null;
}};exports.ContextMenuControl=ContextMenuControl;}(window.T));},function(module,exports){(function(exports){var GeoJsonImporter=function(geoJson,options){this.options=options||{};
this.geometries=[];if(typeof geoJson==="string"){this.initGeoJsonFromUrl(geoJson);}else{this.initGeoJson(geoJson);
}};GeoJsonImporter.prototype={initGeoJson:function(geoJson){this.geoJson=geoJson;this.readPart(geoJson);
if(this.options.success){this.options.success(this);}},initGeoJsonFromUrl:function(url){var ajax=new T.Ajax();
ajax.send(url,{method:"GET",on:{success:T.Util.bind(function(content){var json;try{json=JSON.parse(content);
}catch(err){throw"The URL content is not a valid JSON! "+err.message;}this.initGeoJson(json);},this)}});
},getStyle:function(properties){return T.Util.isFunction(this.options.style)?this.options.style(properties):this.options.style;
},readPart:function(obj,properties){var i,point,style;switch(obj.type){case"Point":style=this.getStyle(properties)||{color:"#ff0000",weight:1};
point=new T.Circle(obj.coordinates,style.radius||3,{radiusMeasure:"pixel",style:style,reverseCoordinates:true,geojsonProperties:properties});
this.geometries.push(point);break;case"MultiPoint":style=this.getStyle(properties)||{color:"#ff0000",weight:1};
for(i=0;i<obj.coordinates.length;i++){point=new T.Circle(obj.coordinates[i],style.radius||3,{radiusMeasure:"pixel",style:style,reverseCoordinates:true,geojsonProperties:properties});
this.geometries.push(point);}break;case"LineString":var lineString=new T.Polyline(obj.coordinates,{reverseCoordinates:true,style:this.getStyle(properties),geojsonProperties:properties});
this.geometries.push(lineString);break;case"MultiLineString":var multiLineString=new T.MultiPolyline(obj.coordinates,{reverseCoordinates:true,style:this.getStyle(properties),geojsonProperties:properties});
this.geometries.push(multiLineString);break;case"Polygon":var polygon=new T.Polygon(obj.coordinates,{reverseCoordinates:true,style:this.getStyle(properties),geojsonProperties:properties});
this.geometries.push(polygon);break;case"MultiPolygon":var multiPolygon=new T.MultiPolygon(obj.coordinates,{reverseCoordinates:true,style:this.getStyle(properties),geojsonProperties:properties});
this.geometries.push(multiPolygon);break;case"GeometryCollection":for(i=0;i<obj.geometries.length;i++){this.readPart(obj.geometries[i]);
}break;case"Feature":this.readPart(obj.geometry,obj.properties);break;case"FeatureCollection":for(i=0;
i<obj.features.length;i++){this.readPart(obj.features[i]);}break;}},addTo:function(layer){var i;for(i=0;
i<this.geometries.length;i++){layer.addGeometry(this.geometries[i]);}}};exports.GeoJsonImporter=GeoJsonImporter;
}(window.T));},function(module,exports){(function(exports){var GeocoderResult=function(resultObject){if(!resultObject){throw new Error("Please specify the geocoder result!");
}if(resultObject.Location&&resultObject.Location.Latitude&&resultObject.Location.Longitude){this.location=new T.LatLng(resultObject.Location.Latitude,resultObject.Location.Longitude);
}if(resultObject.BoundingBox&&resultObject.BoundingBox.NorthEast&&resultObject.BoundingBox.NorthEast.Latitude&&resultObject.BoundingBox.NorthEast.Longitude&&resultObject.BoundingBox.SouthWest&&resultObject.BoundingBox.SouthWest.Latitude&&resultObject.BoundingBox.SouthWest.Longitude){this.bounds=new T.LatLngBounds(new T.LatLng(resultObject.BoundingBox.SouthWest.Latitude,resultObject.BoundingBox.SouthWest.Longitude),new T.LatLng(resultObject.BoundingBox.NorthEast.Latitude,resultObject.BoundingBox.NorthEast.Longitude));
}if(resultObject.City){this.city=resultObject.City;}if(resultObject.Country){this.country=resultObject.Country;
}if(resultObject.EntireAddress){this.address=resultObject.EntireAddress;}if(resultObject.State){this.state=resultObject.State;
}if(resultObject.Street){this.street=resultObject.Street;}if(resultObject.StreetName){this.streetName=resultObject.StreetName;
}if(resultObject.StreetNb){this.streetNumber=resultObject.StreetNb;}if(resultObject.StreetType){this.streetType=resultObject.StreetType;
}if(resultObject.Zip){this.zip=resultObject.Zip;}if(resultObject.Level){this.level=resultObject.Level;
}if(resultObject.LevelInfo){this.levelInfo=resultObject.LevelInfo;}if(resultObject.Score){this.score=resultObject.Score;
}};GeocoderResult.prototype={location:null,bounds:null,country:null,city:null,address:null,state:null,street:null,streetName:null,streetNumber:null,streetType:null,zip:null,level:null,levelInfo:null,score:null};
exports.GeocoderResult=GeocoderResult;}(window.T));},function(module,exports){(function(exports){var Geocoder=function(customer,key,url){if(!customer||!key){throw new Error("Please set the geocoder customer and key!");
}this.customer=customer;this.key=key;this.url=url?url:T.settings.geoWebServices;};Geocoder.prototype={geocode:function(options){var url=null,promise=new T.Promise();
if(!this.customer||!this.key){throw new Error("Please set the geocoder customer and key!");}if(!options||!options.country){throw new Error("Please set the country!");
}if(!options.city&&!options.zip){throw new Error("Please set one of the following options, necessary in order to geocode: city or zip!");
}url=this.url;var cfg={method:"GET",withCredentials:false,on:{success:function(result){var resultObject=JSON.parse(result),geocoderResults=[],i=0;
for(i=0;i<resultObject.length;i++){geocoderResults.push(new T.GeocoderResult(resultObject[i]));}promise.resolve(geocoderResults);
},error:function(errorObject){promise.reject(errorObject);}}};url+=this.customer;url+="/coder.json";url+="?geocoder=maporama";
url+="&maporamakey="+this.key;url+="&country="+options.country;if(options.city){url+="&city="+options.city;
}if(options.zip){url+="&zip="+options.zip;}if(options.state){url+="&state="+options.state;}if(options.street){url+="&street="+options.street;
}new T.Ajax().send(url,cfg);return promise;},reverseGeocode:function(latLngObject){var url=null,promise=new T.Promise();
if(!this.customer||!this.key){throw new Error("Please set the geocoder customer and key!");}if(!latLngObject||!latLngObject.lat||!latLngObject.lng){throw new Error("Please specify the location!");
}url=this.url;var cfg={method:"GET",withCredentials:false,on:{success:function(result){var resultObject=JSON.parse(result),geocoderResults=[],i=0;
for(i=0;i<resultObject.length;i++){geocoderResults.push(new T.GeocoderResult(resultObject[i]));}promise.resolve(geocoderResults);
},error:function(errorObject){promise.reject(errorObject);}}};url+=this.customer;url+="/coder.json";url+="?geocoder=maporama";
url+="&maporamakey="+this.key;url+="&latitude="+latLngObject.lat;url+="&longitude="+latLngObject.lng;
new T.Ajax().send(url,cfg);return promise;}};exports.Geocoder=Geocoder;}(window.T));},function(module,exports){(function(exports){var DistanceServiceResult=function(resultObject){if(!resultObject){throw new Error("Please specify the distance service result!");
}this.distance={};this.time={};if(resultObject.StartLocation){this.startLocation=new T.LatLng(resultObject.StartLocation.Latitude,resultObject.StartLocation.Longitude);
}if(resultObject.EndLocation){this.endLocation=new T.LatLng(resultObject.EndLocation.Latitude,resultObject.EndLocation.Longitude);
}if(resultObject.StartName){this.startName=resultObject.StartName;}if(resultObject.EndName){this.endName=resultObject.EndName;
}if(resultObject.DrivingDistance){this.distance.kilometers=resultObject.DrivingDistance.Km||null;this.distance.meters=resultObject.DrivingDistance.Meters||null;
this.distance.miles=resultObject.DrivingDistance.Miles||null;this.distance.feet=resultObject.DrivingDistance.Feet||null;
}if(resultObject.DrivingTime){this.time.seconds=resultObject.DrivingTime.seconds||null;this.time.hh_mm=resultObject.DrivingTime.hh_mm||null;
}};DistanceServiceResult.prototype={startLocation:null,endLocation:null,startName:"",endName:"",distance:null,time:null};
exports.DistanceServiceResult=DistanceServiceResult;}(window.T));},function(module,exports){(function(exports){var DistanceService=function(customer,key,url){if(!customer||!key){throw new Error("Please set the DistanceService customer and key!");
}this.customer=customer;this.key=key;this.url=url||T.settings.geoWebServices;};DistanceService.prototype={computeDistance:function(start,waypoints,options){var url=null,promise=new T.Promise(),i=0;
if(!this.customer||!this.key){throw new Error("Please set the DistanceService customer and key!");}if(!start||!start.lat||!start.lng){throw new Error("Invalid start point!");
}if(!waypoints||waypoints.length===0){throw new Error("Waypoints missing!");}for(i=0;i<waypoints.length;
i++){if(!waypoints[i].location||!waypoints[i].location.lat||!waypoints[i].location.lng){throw new Error("Invalid waypoints!");
}}url=this.url;var cfg={method:"POST",withCredentials:false,data:this._buildDistancePayload(start,waypoints,options),on:{success:function(result){var resultObject=JSON.parse(result).Segments,DistanceServiceResults=[],i=0,theResult;
for(i=0;i<resultObject.length;i++){theResult=new T.DistanceServiceResult(resultObject[i]);DistanceServiceResults.push(theResult);
}promise.resolve(DistanceServiceResults);},error:function(errorObject){promise.reject(errorObject);}}};
url+=this.customer;url+="/itinerary/distance/onetomany.json";url+="?maporamakey="+this.key;new T.Ajax().send(url,cfg);
return promise;},_buildDistancePayload:function(start,waypoints,options){var payload="";payload+="startpoint="+start.lng+","+start.lat;
payload+=this._buildWaypointsPayload(waypoints);if(options&&options.travelMode){payload+="&travelmode="+options.travelMode;
}if(options&&options.avoidTollRoad!==undefined){payload+="&avoidtollroad="+options.avoidTollRoad;}if(options&&options.avoidHighways){payload+="&avoidhighways="+options.avoidHighways;
}if(options&&options.unitSystem){payload+="&unitsystem="+options.unitSystem;}if(options&&options.optimizationType){payload+="&optimizationtype="+options.optimizationType;
}if(options&&options.customSpeedProfile&&options.customSpeedProfile.length>0){payload+="&customspeedprofile="+options.customSpeedProfile.join();
}return payload;},_buildWaypointsPayload:function(waypoints){var i=0,waypointName="",waypointsPayload="&waypoints=",pointIndex=0;
for(i=0;i<waypoints.length;i++){pointIndex=i+1;waypointName=waypoints[i].name||"point"+pointIndex;waypointsPayload+="n:"+waypointName+";ll:"+waypoints[i].location.lng+","+waypoints[i].location.lat+"|";
}waypointsPayload=waypointsPayload.substring(0,waypointsPayload.length-1);return waypointsPayload;}};
exports.DistanceService=DistanceService;}(window.T));},function(module,exports){(function(exports){var ItineraryService=function(customer,key,url){if(!customer||!key){throw new Error("Please set the ItineraryService customer and key!");
}this.customer=customer;this.key=key;this.url=url||T.settings.geoWebServices;};ItineraryService.prototype={computeItinerary:function(start,end,waypoints,options){var url=null,promise=new T.Promise(),i=0;
if(!this.customer||!this.key){throw new Error("Please set the ItineraryService customer and key!");}if(!start||!start.lat||!start.lng){throw new Error("Invalid start point!");
}if(!end||!end.lat||!end.lng){throw new Error("Invalid end point!");}if(waypoints&&waypoints.length>0){for(i=0;
i<waypoints.length;i++){if(!waypoints[i].lat||!waypoints[i].lng){throw new Error("Invalid waypoints!");
}}}url=this.url;var cfg={method:"POST",withCredentials:false,data:this._buildItineraryPayload(start,end,waypoints,options),on:{success:function(result){var resultObject=JSON.parse(result);
promise.resolve(resultObject);},error:function(errorObject){promise.reject(errorObject);}}};url+=this.customer;
url+="/itinerary.json";url+="?maporamakey="+this.key;new T.Ajax().send(url,cfg);return promise;},_buildItineraryPayload:function(start,end,waypoints,options){var payload="";
payload+="start="+start.lng+";"+start.lat;payload+="&end="+end.lng+";"+end.lat;if(waypoints&&waypoints.length>0){payload+=this._buildWaypointsPayload(waypoints);
}if(options&&options.language){payload+="&language="+options.language;}if(options&&options.travelMode){payload+="&mode="+options.travelMode;
}if(options&&options.avoidTollRoad!==undefined){payload+="&avoidtollroad="+options.avoidTollRoad;}if(options&&options.returnPolyline!==undefined){payload+="&polyline="+options.returnPolyline;
}if(options&&options.avoidHighways){payload+="&avoidhighways="+options.avoidHighways;}if(options&&options.unitSystem){payload+="&unitsystem="+options.unitSystem;
}if(options&&options.optimizationType){payload+="&optimizationtype="+options.optimizationType;}if(options&&options.customSpeedProfile&&options.customSpeedProfile.length>0){payload+="&customspeedprofile="+options.customSpeedProfile.join();
}return payload;},_buildWaypointsPayload:function(waypoints){var i=0,waypointsPayload="&steps=",pointIndex=0;
for(i=0;i<waypoints.length;i++){waypointsPayload+=waypoints[i].lng+";"+waypoints[i].lat+"|";}waypointsPayload=waypointsPayload.substring(0,waypointsPayload.length-1);
return waypointsPayload;}};exports.ItineraryService=ItineraryService;}(window.T));},function(module,exports){(function(exports){var ItineraryRenderer=function(map){if(!map){throw new Error("Please specify the map on which the itinerray is displayed!");
}this.map=map;this.vectorLayer=new T.VectorLayer({useCanvas:false});this.markersLayer=new T.MarkersLayer();
this.map.addLayer(this.vectorLayer);this.map.addLayer(this.markersLayer);};ItineraryRenderer.prototype={displayItinerary:function(computedItinerary,options){var i=0,allPoints=[],polylines=[],itineraryBounds=new T.LatLngBounds();
options=options||{};if(!computedItinerary||!computedItinerary.Polyline){throw new Error("Invalid itinerary!");
}for(i=0;i<computedItinerary.Polyline.length-1;i++){polylines.push(this._createPolyline(computedItinerary.Polyline[i],computedItinerary.Polyline[i+1],options));
if(options.zoomToItinerary){itineraryBounds.extend(new T.LatLng(computedItinerary.Polyline[i].Latitude,computedItinerary.Polyline[i].Longitude));
}}var f=T.Util.bind(function(){this._addMarker(computedItinerary.Polyline[0],options.startMarkerPath||"http://geoanalytics.tibco.com/documentation/assets/img/marker.png",options.startMarkerOffset||new T.Point(0,-10));
this._addMarker(computedItinerary.Polyline[computedItinerary.Polyline.length-1],options.endMarkerPath||"http://geoanalytics.tibco.com/documentation/assets/img/marker.png",options.endMarkerOffset||new T.Point(0,-10));
for(i=0;i<polylines.length;i++){this.vectorLayer.addGeometry(polylines[i]);}this._getTileLayer().events.detach("tiles-loaded",f);
},this);this._getTileLayer().events.on("tiles-loaded",f);if(options.zoomToItinerary){itineraryBounds.extend(computedItinerary.Polyline[computedItinerary.Polyline.length-1].Latitude,computedItinerary.Polyline[computedItinerary.Polyline.length-1].Longitude);
this.map.fitToBounds(itineraryBounds);}},removeItinerary:function(){var i=0;this.markersLayer.removeAllMarkers();
this.vectorLayer.removeAllGeometries();},_createPolyline:function(start,end,options){var stroke=(options.stroke!==undefined)?options.stroke:true,strokeColor=options.strokeColor||"#428bca",strokeOpacity=(options.strokeOpacity!==undefined)?options.strokeOpacity:1,strokeWeight=(options.strokeWeight!==undefined)?options.strokeWeight:2,polyline=null;
polyline=new T.Polyline([[start.Latitude,start.Longitude],[end.Latitude,end.Longitude]]);polyline.setStyle({stroke:stroke,color:strokeColor,opacity:strokeOpacity,weight:strokeWeight});
return polyline;},_addMarker:function(polylineItem,imgPath,offset){var marker=new T.ImageMarker(new T.LatLng(polylineItem.Latitude,polylineItem.Longitude),imgPath,{offset:offset});
this.markersLayer.addMarker(marker);},_getTileLayer:function(){var i=0;for(i=0;i<this.map.layersArray.length;
i++){if(this.map.layersArray[i] instanceof T.TibcoLayer){return this.map.layersArray[i];}}return null;
}};exports.ItineraryRenderer=ItineraryRenderer;}(window.T));},function(module,exports){(function(exports){var TradeAreaService=function(customer,key,url){if(!customer||!key){throw new Error("Please set the TradeAreaService customer and key!");
}this.customer=customer;this.key=key;this.url=url||T.settings.geoWebServices;};TradeAreaService.prototype={computeTradeArea:function(center,value,options){var url=null,promise=new T.Promise(),i=0;
if(!this.customer||!this.key){throw new Error("Please set the TradeAreaService customer and key!");}if(!center||!center.lat||!center.lng){throw new Error("Invalid center point!");
}if(options&&options.travelMode){if(options.travelMode==="vehicle"){options.travelMode="drive";}else{if(options.travelMode==="pedestrian"){options.travelMode="walk";
}else{throw new Error("Invalid travel mode: "+options.travelMode+". Accepted values are: 'vehicle' or 'pedestrian'!");
}}}if(options&&options.computationType){if(options.computationType==="time"){options.computationType="bytime";
}else{if(options.computationType==="distance"){options.computationType="bydistance";}else{throw new Error("Invalid computation type: "+options.computationType+". Accepted values are: 'time' or 'distance'!");
}}}url=this.url;var cfg={method:"GET",withCredentials:false,on:{success:function(result){var resultObject=JSON.parse(result);
promise.resolve(resultObject);},error:function(errorObject){promise.reject(errorObject);}}};url+=this.customer;
url+="/tradearea.json";url+="?maporamakey="+this.key;url+="&point="+center.lng+";"+center.lat;url+="&unit="+value;
url+="&format=arrayOfPosition";if(options&&options.computationType){url+="&type="+options.computationType;
}if(options&&options.travelMode){url+="&mode="+options.travelMode;}if(options&&options.precision){url+="&precision="+options.precision;
}if(options&&options.tableName){url+="&tablename="+options.tableName;}if(options&&options.costRation){url+="&costratio="+options.costRation;
}new T.Ajax().send(url,cfg);return promise;}};exports.TradeAreaService=TradeAreaService;}(window.T));
},function(module,exports){(function(exports){var LegacyDragHandler=function(options){};LegacyDragHandler.prototype={init:function(map){this.map=map;
this.drag=new T.LegacyDragUtil(map.$container.layers,map.$container.layers);this.drag.events.on("drag-start",this.onDragStart,this);
this.drag.events.on("drag",this.onDrag,this);this.drag.events.on("drag-end",this.onDragEnd,this);this.drag.enable();
},onDragStart:function(evt){this.map.events.fire("move-start");},onDrag:function(evt){this.map.events.fire("move",{offset:evt.offset});
},onDragEnd:function(evt){if(this.drag.moved){this.map.events.fire("move-end");}},disable:function(){this.drag.disable();
},enable:function(){this.drag.enable();}};exports.LegacyDragHandler=LegacyDragHandler;}(window.T));},function(module,exports){(function(exports){var LegacyDragUtil=function(element,dragTarget,options){this.element=element;
this.events=new T.EventDispatcher();this.dragTarget=dragTarget||element;this.options=T.Util.defaults(options,this.options);
};LegacyDragUtil.prototype={options:{},enable:function(){if(this.isEnable){return;}T.DomEventUtil.on(this.dragTarget,"mousedown",this.onDown,this);
this.isEnable=true;},disable:function(){if(!this.isEnable){return;}T.DomEventUtil.off(this.dragTarget,"mousedown",this.onDown,this);
this.isEnable=false;},onDown:function(evt){T.DomEventUtil.stop(evt);this.moved=false;this.startPoint=new T.Point(evt.clientX,evt.clientY);
this.startPos=this.newPos=T.DomUtil.position(this.element);T.DomEventUtil.on(document,"mousemove",this.onMove,this);
T.DomEventUtil.on(document,"mouseup",this.onUp,this);this.events.fire("before-drag");},onMove:function(evt){var newPoint=new T.Point(evt.clientX,evt.clientY),offset=newPoint.substract(this.startPoint);
T.DomEventUtil.preventDefault(evt);if(!this.moved){this.events.fire("drag-start");this.moved=true;this.startPos=T.DomUtil.position(this.element).substract(offset);
}this.newPos=this.startPos.add(offset);this.moving=true;if(this.options.limit){if(this.options.limit.minX!==undefined&&this.options.limit.minX>this.newPos.x){this.newPos.x=this.options.limit.minX;
}if(this.options.limit.maxX!==undefined&&this.options.limit.maxX<this.newPos.x){this.newPos.x=this.options.limit.maxX;
}if(this.options.limit.minY!==undefined&&this.options.limit.minY>this.newPos.y){this.newPos.y=this.options.limit.minY;
}if(this.options.limit.maxY!==undefined&&this.options.limit.maxY<this.newPos.y){this.newPos.y=this.options.limit.maxY;
}}if(this.options.skipInterval){if(this.options.skipInterval.y){this.newPos.y=this.newPos.y-(this.newPos.y%this.options.skipInterval.y);
}if(this.options.skipInterval.x){this.newPos.x=this.newPos.x-(this.newPos.x%this.options.skipInterval.x);
}}T.DomUtil.position(this.element,this.newPos);this.events.fire("drag",{offset:offset});},onUp:function(evt){T.DomEventUtil.off(document,"mousemove",this.onMove,this);
T.DomEventUtil.off(document,"mouseup",this.onUp,this);this.events.fire("drag-end");this.moving=false;
this.moved=false;}};exports.LegacyDragUtil=LegacyDragUtil;}(window.T));},function(module,exports){(function(exports){var LegacyHtmlMarker=function(latlng,html,options){this.latlng=latlng;
this.html=html;this.options=T.Util.defaults(options,this.options);this.dragOffset=new T.Point(0,0);this.initContainer();
if(this.options.draggable){this.addHandler(new T.LegacyMarkerDragHandler());}};LegacyHtmlMarker.prototype={options:{draggable:false,draggableUsingOffset:false,popOnClick:false,offset:new T.Point(0,0)},initContainer:function(){if(!this.$container){this.$container=T.DomUtil.create("div","tibco-marker");
this.$container.marker=this;this.$container.style.position="absolute";if(this.html){this.$container.innerHTML=this.html;
}}},addHandler:function(handler){handler.init(this);},reset:function(){var pxPosition=this.layer.map.latLngToPoint(this.latlng).floor();
pxPosition=pxPosition.substract(this.options.offset).add(this.dragOffset);T.DomUtil.position(this.$container,pxPosition);
},resetFromPx:function(){var p=T.DomUtil.position(this.$container).add(this.options.offset);this.latlng=this.layer.map.pointToLatLng(p);
},resetOffset:function(){var viewportPos=this.layer.map.latLngToPoint(this.latlng);var currentPos=T.DomUtil.position(this.$container);
this.dragOffset=currentPos.substract(viewportPos);},onAdd:function(layer){if(!(layer instanceof T.LegacyMarkersLayer)){throw new Error("Legacy HTML Markers should only be added to LegacyMarkersLayer!");
}},onRemove:function(layer){}};exports.LegacyHtmlMarker=LegacyHtmlMarker;}(window.T));},function(module,exports){(function(exports){var LegacyMarkerDragHandler=function(options){};
LegacyMarkerDragHandler.prototype={init:function(marker){this.marker=marker;this.drag=new T.LegacyDragUtil(marker.$container,marker.$container);
this.drag.events.on("before-drag",this.onBeforeStart,this);this.drag.events.on("drag",this.onDrag,this);
this.drag.events.on("drag-end",this.onDragEnd,this);this.drag.enable();},onBeforeStart:function(evt){if(this.marker.options.popOnClick){var p=T.DomUtil.position(this.marker.$container);
p.y-=2;T.DomUtil.position(this.marker.$container,p);}},onDrag:function(evt){},onDragEnd:function(evt){if(this.marker.options.popOnClick){var p=T.DomUtil.position(this.marker.$container);
p.y+=2;T.DomUtil.position(this.marker.$container,p);}if(this.marker.options.draggableUsingOffset){this.marker.resetOffset();
}else{this.marker.resetFromPx();}if(this.marker.layer){this.marker.layer.events.fire("marker-drag-end",this.marker);
}}};exports.LegacyMarkerDragHandler=LegacyMarkerDragHandler;}(window.T));},function(module,exports){(function(exports){var base=T.MarkersLayer;
var LegacyMarkersLayer=function(options){base.call(this,options);this.markers=[];};LegacyMarkersLayer.prototype={addMarker:function(marker){if(!(marker instanceof T.LegacyHtmlMarker)){throw new Error("Legacy markers layer only works with LegacyHtmlMarker");
}marker.layer=this;marker.onAdd(this);marker.reset();if(this.$container){this.$container.appendChild(marker.$container);
}this.markers.push(marker);marker.$container=base.prototype.setAsInteractiveTarget.call(this,marker.$container,marker);
}};T.Util.inherit(LegacyMarkersLayer,T.MarkersLayer);exports.LegacyMarkersLayer=LegacyMarkersLayer;}(window.T));
}]);$(function(){var createSplitterFeedback=function($viewport,mouseEvent,immediate,splitterSettings){var noFeedback={update:$.noop,remove:$.noop};
if(immediate){return noFeedback;}var xStart=mouseEvent.pageX;var yStart=mouseEvent.pageY;var offset=$viewport.offset();
var bounds=splitterSettings.bounds;var cursor=splitterSettings.isHorizontal?"row-resize":"col-resize";
var $splitter=$("<div>").css("position","absolute").css("left",offset.left+bounds.x).css("top",offset.top+bounds.y).css("width",bounds.width).css("height",bounds.height).css("background-color","#666666").css("opacity","0.3").css("cursor",cursor).appendTo("body");
return{update:function(mouseEvent){var delta=splitterSettings.isHorizontal?mouseEvent.pageY-yStart:mouseEvent.pageX-xStart;
delta=Math.max(-splitterSettings.lowerLimit,delta);delta=Math.min(splitterSettings.upperLimit,delta);
if(splitterSettings.isHorizontal){$splitter.css("top",offset.top+bounds.y+delta);}else{$splitter.css("left",offset.left+bounds.x+delta);
}},remove:function(){$splitter.remove();}};};var create=function($viewport,canvasState,modify){var Point=Spotfire.Drawing.Point;
var getMarkArea=function(area){if(!area){return null;}var markArea={horizontal:area.alignment==="top"||area.alignment==="bottom"};
$.extend(markArea,canvasState.renderResult.data.panelsBounds);return markArea;};var getEntryPoint=function(event){var offset=$viewport.offset();
return new Point(event.pageX-offset.left,event.pageY-offset.top);};var startRectangleZoom=function(mouseDownEvent,area){var markArea=getMarkArea(area);
var entryPoint=getEntryPoint(mouseDownEvent);var zoomCallback=function(points){modify("MarkZoom",{token:canvasState.currentToken,points:points});
};Spotfire.Visuals.CanvasVisualization.Marking.createOverlay($viewport,entryPoint,"sf-overlay-zoom",false,zoomCallback,markArea);
};var startMarking=function(mouseDownEvent,area,markingDoneCallback,forceLasso){var isLasso=mouseDownEvent.altKey||forceLasso;
var markArea=getMarkArea(area);var entryPoint=getEntryPoint(mouseDownEvent);var markMode=mouseDownEvent.shiftKey?"Add":(mouseDownEvent.ctrlKey?"Toggle":"Replace");
var markingCallback=function(points,isSingleClickOnAxis){if(!isSingleClickOnAxis){modify("Mark",{mode:markMode,token:canvasState.currentToken,lasso:isLasso,points:points,isAxisMarking:markArea!==null});
}(markingDoneCallback||$.noop)();};Spotfire.Visuals.CanvasVisualization.Marking.createOverlay($viewport,entryPoint,"sf-overlay-mark",isLasso,markingCallback,markArea);
};var startButtonBehavior=function(mouseDownEvent,buttonBounds){var entryPoint=getEntryPoint(mouseDownEvent);
Spotfire.Visuals.CanvasVisualization.Dragging.begin({mouseUp:function(e){if(new Rectangle(buttonBounds).containsPoint(e.x,e.y)){modify("Mark",{mode:"Replace",token:canvasState.currentToken,lasso:false,points:[entryPoint],isAxisMarking:false});
}}},$viewport);};var clickInteractionArea=function(mouseDownEvent,area){var clickPoint=getEntryPoint(mouseDownEvent);
var showPoint=null;switch(area.alignment){case"top":showPoint=new Point(clickPoint.x,area.bounds.y+area.bounds.height);
break;case"bottom":showPoint=new Point(clickPoint.x,area.bounds.y);break;case"left":showPoint=new Point(area.bounds.x+area.bounds.width,clickPoint.y);
break;case"right":showPoint=new Point(area.bounds.x,clickPoint.y);break;}modify("InteractionAreaClick",{clickPoint:clickPoint,showPoint:showPoint});
};var clickArea=function(mouseDownEvent){modify("AreaClick",{clickPoint:getEntryPoint(mouseDownEvent)});
};var startMoveSplitter=function(downEvent,area,bounds){var horizontal=area.alignment==="top"||area.alignment==="bottom";
var immediate=Spotfire.isProfessional();var entryPoint=getEntryPoint(downEvent);var splitterData={bounds:bounds,isHorizontal:horizontal,lowerLimit:area.resizeData.min,upperLimit:area.resizeData.max};
var splitter=createSplitterFeedback($viewport,downEvent,immediate,splitterData);modify("BeginResize",{id:area.resizeData.id,x:entryPoint.x,y:entryPoint.y});
var modifyThrottled=_.throttle(modify,100);Spotfire.Visuals.CanvasVisualization.Dragging.begin({cursor:horizontal?"row-resize":"col-resize",mouseMove:function(e){splitter.update(e);
if(immediate){modifyThrottled("Drag",e);}},mouseUp:function(e){modify("DragEnd",e);},cancelled:function(){modify("DragCancel");
},done:function(){splitter.remove();}},$viewport);};var startMovePruneLine=function(mouseDownEvent){var immediate=Spotfire.isProfessional();
var splitterData=canvasState.pickDetails.getSplitterData();var splitter=createSplitterFeedback($viewport,mouseDownEvent,immediate,splitterData);
var entryPoint=getEntryPoint(mouseDownEvent);modify("DragBegin",entryPoint);Spotfire.Visuals.CanvasVisualization.Dragging.begin({cursor:splitterData.isHorizontal?"row-resize":"col-resize",mouseMove:function(e){splitter.update(e);
if(immediate){modify("Drag",e);}},mouseUp:function(e){modify("DragEnd",e);},cancelled:function(){modify("DragCancel");
},done:function(){splitter.remove();canvasState.pickDetails.clear();}},$viewport);};var createMarkerLabelFeedback=function($viewport,mouseEvent,markerLabelData){var offset=$viewport.offset();
var bounds=markerLabelData.bounds;var originalPageX=mouseEvent.pageX;var originalPageY=mouseEvent.pageY;
var viewportWidth=$viewport.width();var viewportHeight=$viewport.height();var color=markerLabelData.color;
var $overlay=$("<div>").css("position","absolute").css("left",offset.left).css("top",offset.top).css("width",viewportWidth).css("height",viewportHeight).css("opacity","0.5").appendTo("body");
var $label=$("<div>").css("position","absolute").css("left",bounds.x).css("top",bounds.y).css("width",bounds.width).css("height",bounds.height).css("background-color",color).appendTo($overlay);
var svgns="http://www.w3.org/2000/svg";var svg=document.createElementNS(svgns,"svg");svg.setAttribute("width",viewportWidth);
svg.setAttribute("height",viewportHeight);var line=document.createElementNS(svgns,"line");line.setAttribute("stroke",color);
line.setAttribute("stroke-width","2px");svg.appendChild(line);$overlay.get(0).appendChild(svg);var update=function(e){var markerBounds=new Rectangle(markerLabelData.markerBounds);
var markerX=markerBounds.centerX();var markerY=markerBounds.centerY();var left=bounds.x+e.pageX-originalPageX;
var top=bounds.y+e.pageY-originalPageY;var width=bounds.width;var height=bounds.height;var panelBounds=new Rectangle(markerLabelData.panelBounds);
if(left+width>panelBounds.right()){left=panelBounds.right()-width;}if(left<panelBounds.left()){left=panelBounds.left();
}if(top+height>panelBounds.bottom()){top=panelBounds.bottom()-height;}if(top<panelBounds.top()){top=panelBounds.top();
}var labelCenterX=left+bounds.width/2;var labelCenterY=top+bounds.height/2;var labelCornerX=markerX<labelCenterX?left:left+bounds.width;
var labelCornerY=markerY<labelCenterY?top:top+bounds.height;$label.css("left",left);$label.css("top",top);
line.setAttribute("x1",markerX);line.setAttribute("y1",markerY);line.setAttribute("x2",labelCornerX);
line.setAttribute("y2",labelCornerY);};update(mouseEvent);return{update:update,remove:function(){$overlay.remove();
}};};var startMoveLabel=function(mouseDownEvent){var label=createMarkerLabelFeedback($viewport,mouseDownEvent,canvasState.pickDetails.getMarkerLabelData());
var entryPoint=getEntryPoint(mouseDownEvent);modify("DragBegin",entryPoint);Spotfire.Visuals.CanvasVisualization.Dragging.begin({dragPredicate:function(e){return new Point(e.x,e.y).distance(entryPoint)>2;
},mouseMove:function(e){label.update(e);},mouseUp:function(e){modify("DragEnd",e);},click:function(e){var markMode=mouseDownEvent.shiftKey?"Add":(mouseDownEvent.ctrlKey?"Toggle":"Replace");
modify("Mark",{mode:markMode,token:canvasState.currentToken,lasso:false,points:[{x:e.x,y:e.y}]});},done:function(){label.remove();
canvasState.pickDetails.clear();}},$viewport);};var startRotate3DScatterPlot=function(mouseDownEvent){var entryPoint=getEntryPoint(mouseDownEvent);
modify("DragBegin",{x:entryPoint.x,y:entryPoint.y,ctrlKey:mouseDownEvent.ctrlKey,shiftKey:mouseDownEvent.shiftKey,which:mouseDownEvent.which});
Spotfire.Visuals.CanvasVisualization.Dragging.begin({preventContextMenuOnRelease:true,mouseMove:function(e){modify("Drag",e);
},mouseUp:function(e){modify("DragEnd",e);},cancelled:function(){modify("DragCancel");}},$viewport);};
var detectTouchClick=function(mouseDownEvent){var entryPoint=getEntryPoint(mouseDownEvent);$(window).one("sf-touchmouseup",function(upEvent){if(mouseDownEvent.pageX===upEvent.pageX&&mouseDownEvent.pageY===upEvent.pageY){modify("Mark",{mode:"Replace",token:canvasState.currentToken,lasso:false,points:[{x:entryPoint.x,y:entryPoint.y}]});
}upEvent.preventDefault();});};return{startRectangleZoom:startRectangleZoom,startMarking:startMarking,startMoveSplitter:startMoveSplitter,startMovePruneLine:startMovePruneLine,startMoveLabel:startMoveLabel,startRotate3DScatterPlot:startRotate3DScatterPlot,startButtonBehavior:startButtonBehavior,clickInteractionArea:clickInteractionArea,clickArea:clickArea,detectTouchClick:detectTouchClick};
};Spotfire.registerNameSpace("Visuals.CanvasVisualization.Actions",{create:create});});$(function(){var debugging=false;
var createPngBlob=function(base64){var decoded=window.atob(base64);var len=decoded.length;var charCodeArray=new Array(len);
var i;for(i=0;i<len;i++){charCodeArray[i]=decoded.charCodeAt(i);}return new window.Blob([new window.Uint8Array(charCodeArray)],{type:"image/png"});
};var imageUrlStore=(function(){var oldUrls={};var getPrevious=function(id){return oldUrls[id];};var create=function(id,base64){var blob=createPngBlob(base64);
var url=window.URL.createObjectURL(blob);var oldUrl=oldUrls[id];if(oldUrl){window.setTimeout(function(){window.URL.revokeObjectURL(oldUrl);
},1000);}oldUrls[id]=url;return url;};return function(id,base64){if(base64===null||base64===undefined){return getPrevious(id);
}return create(id,base64);};}());function ImageLayer($viewport,imageUrlStoreKey){var frameCount=0;var expectedUrl=null;
var $container=$("<div/>").addClass("sf-element-canvas-image").appendTo($viewport);var $preloadImage=$("<img/>").load(function(){var url=this.src;
if(expectedUrl!==url){return;}expectedUrl=null;frameCount++;$container.css("background-image","url("+url+")");
});var preload=function(url){expectedUrl=url;if(url!==null){$preloadImage.attr("src",url);}else{$container.css("background-image","");
}};if(debugging){var everySecond=function(){$container.html(($container.prev().length>0?"<br/>":"")+"FPS: "+frameCount);
frameCount=0;};window.setInterval(everySecond,1000);}var oldUrl=imageUrlStore(imageUrlStoreKey);if(oldUrl){preload(oldUrl);
}return{update:function(base64,useTransition){var url=imageUrlStore(imageUrlStoreKey,base64);var backgroundTransition="sfc-transition-background";
if(useTransition){$container.addClass(backgroundTransition);}else{$container.removeClass(backgroundTransition);
}preload(url);},clear:function(){preload(null);}};}var globalProgressCounter=(function(){var count=0;
var onActivityHandlers=[];var onActivity=function(pendingCount){$.each(onActivityHandlers,function(){this(pendingCount);
});};return{addHandler:function(handler){if(typeof handler!=="function"){throw"Not a function";}onActivityHandlers.push(handler);
},inc:function(){count++;onActivity(count);},dec:function(){count--;onActivity(count);}};}());function Progress($viewport){var progressTimer=null;
var delay=500;var progressAnimation=null;var seconds=delay/1000;var interval=null;var showOverlay=function(){var w=$viewport.width();
var h=$viewport.height();progressAnimation=Spotfire.Progress.createFadingProgressAnimation($viewport,w,h);
var $overlay=progressAnimation.$element;$overlay.css("cursor","progress");$overlay.css("text-align","center");
if(debugging){var $text=$("<h2/>").appendTo($overlay);var stopwatch=function(){$text.text(seconds.toFixed(1)+"s");
seconds+=0.1;};interval=window.setInterval(stopwatch,100);stopwatch();}};var cleanup=function(){if(progressTimer!==null){window.clearTimeout(progressTimer);
progressTimer=null;}if(interval!==null){seconds=delay/1000;window.clearInterval(interval);interval=null;
}if(progressAnimation!==null){progressAnimation.remove();progressAnimation=null;}};return{start:function(){if(progressTimer!==null||progressAnimation!==null){return;
}progressTimer=window.setTimeout(showOverlay,delay);},stop:function(){cleanup();}};}function InteractionLayer($viewportContainer,canvasActions,canvasState,$viewport){var Point=Spotfire.Drawing.Point;
var $interactionLayer=$("<div/>").appendTo($viewportContainer);var addInteractionArea=function(area){var mouseUpEventName="sf-touchmouseup.sf-interaction-layer";
var mouseMoveEventName="sf-touchmousemove.sf-interaction-layer";var onTouchHold=function(holdEvent){Touch.showTouchHoldImage(holdEvent.pageX,holdEvent.pageY);
Touch.clickBlocker();var moveTouchHoldImage=function(moveEvent){Touch.moveTouchHoldImage(moveEvent.pageX,moveEvent.pageY);
moveEvent.preventDefault();};$(window).on("sf-touchmousemove",moveTouchHoldImage);var onMarkingDone=function(){Touch.removeTouchHoldImage();
$(window).off("sf-touchmousemove",moveTouchHoldImage);};canvasActions.startMarking(holdEvent,area,onMarkingDone);
};var onMouseDown=function(downEvent){if(downEvent.which!==1){return;}var $activeElement=$(this).addClass("sfpc-active");
var dragStarted=(function(){var moved=false;var entryPoint=new Point(downEvent.pageX,downEvent.pageY);
return function(mouseEvent){moved=moved||entryPoint.distance(new Point(mouseEvent.pageX,mouseEvent.pageY))>0;
return moved;};}());$(document.body).on(mouseMoveEventName,function(e){if(!dragStarted(e)){return;}$(document.body).off(mouseUpEventName);
$(document.body).off(mouseMoveEventName);$activeElement.removeClass("sfpc-active");if(Spotfire.capabilities.supportsTouch()){return;
}var isZoom=downEvent.altKey&&downEvent.ctrlKey&&downEvent.shiftKey;if(isZoom&&!canvasState.canZoom){return;
}if(isZoom){canvasActions.startRectangleZoom(downEvent);}else{if(canvasState.canMark){canvasActions.startMarking(downEvent,area);
}}});$(document.body).on(mouseUpEventName,function(upEvent){$(document.body).off(mouseUpEventName);$(document.body).off(mouseMoveEventName);
$activeElement.removeClass("sfpc-active");var isClick=!dragStarted(upEvent);if(isClick){if(area.contextualPopout===true){canvasActions.clickInteractionArea(downEvent,area);
}else{canvasActions.clickArea(downEvent);}}});};var margin=3;var left=area.bounds.x;var top=area.bounds.y;
var width=area.bounds.width;var height=area.bounds.height;switch(area.alignment){case"top":height-=margin;
break;case"bottom":top+=margin;height-=margin;break;case"left":width-=margin;break;case"right":left+=margin;
width-=margin;break;}var $interactionDiv=$("<div/>").addClass("sfpc-"+area.alignment).css("left",left+"px").css("top",top+"px").css("width",width+"px").css("height",height+"px").on("sf-touchmousedown",onMouseDown).on("sf-touchhold",onTouchHold).on("mousemove",function(e){$viewport.trigger(e);
}).appendTo($interactionLayer);if(area.contextualPopout===true){$interactionDiv.addClass("sf-element-interaction-access-area");
}else{$interactionDiv.css("position","absolute");}};var addResizeSplitter=function(area){var bounds=new Rectangle(area.bounds);
var size=5;var halfSize=(size-1)/2;var horizontal=area.alignment==="top"||area.alignment==="bottom";switch(area.alignment){case"top":bounds.y+=bounds.height-halfSize;
bounds.height=size;break;case"left":bounds.x+=bounds.width-halfSize;bounds.width=size;break;case"right":bounds.x-=halfSize;
bounds.width=size;break;case"bottom":bounds.y-=halfSize;bounds.height=size;break;}$("<div>").addClass("sf-splitter").css("position","absolute").css("left",bounds.x).css("top",bounds.y).css("width",bounds.width).css("height",bounds.height).css("cursor",horizontal?"row-resize":"col-resize").appendTo($interactionLayer).on("sf-touchmousedown",function(downEvent){canvasActions.startMoveSplitter(downEvent,area,bounds);
});};return{update:function(data){$interactionLayer.empty();$.each(data.areas,function(i,area){if(area.contextualPopout===true||area.axisMarking===true){addInteractionArea(area);
}if(area.resizeData!==undefined){addResizeSplitter(area);}});}};}function RenderStatisticsLayer($viewport){var $overlay=null;
return{update:function(statistics){if(statistics===null||statistics===undefined){if($overlay!==null){$overlay.remove();
$overlay=null;}return;}$overlay=$overlay||$("<div class='sfc-render-stats'/>").appendTo($viewport);$overlay.children().remove();
var stats=statistics.statistics.split(";");$.each(stats,function(i,item){$overlay.append($("<div/>").text(item));
});}};}function CanvasVisualization(settings){var Point=Spotfire.Drawing.Point;var mouseButtons=Spotfire.Visuals.CanvasVisualization.MouseButtons;
var viewId=settings.id;var $viewportContainer=$("#"+viewId).addClass("sf-element sf-element-canvas-visualization");
var $viewport=$("<div/>").css({width:"100%",height:"100%",position:"absolute"}).appendTo($viewportContainer);
var $debug=null;var debugLog=function(s){if(debugging){if($debug===null){$debug=$("<div/>").appendTo($viewport).css({position:"absolute","font-family":"Courier","background-color":"lightsalmon","font-size":"0.8em","z-index":100});
}console.log(viewId+": "+s);$debug.prepend(s+"<br/>");}};var modify=function(method,args){Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,method,args);
};var read=function(method,args,callback,errorCallback){Spotfire.Dxp.Web.Forms.AjaxService.Read(viewId,method,args,callback,errorCallback);
};var canvasState={renderResult:null,currentToken:-1,canMark:false,canZoom:false,pickDetails:null};var canvasActions=Spotfire.Visuals.CanvasVisualization.Actions.create($viewport,canvasState,modify);
var plotImage=new ImageLayer($viewport,"plot-"+settings.modelDocumentNodeId);var highlightImage=new ImageLayer($viewport,"highlight-"+settings.modelDocumentNodeId);
var interactionLayer=new InteractionLayer($viewportContainer,canvasActions,canvasState,$viewport);var progress=new Progress($viewport);
var statisticsLayer=new RenderStatisticsLayer($viewport);canvasState.pickDetails=Spotfire.Visuals.CanvasVisualization.PickDetails.create(highlightImage,$viewport);
var useTransition=(function(){var lastRenderTime=0;var lastHeight=0;var lastWidth=0;if(!Spotfire.useTransitions()){return function(){return false;
};}return function(width,height){var currentRenderTime=Date.now();var transition=width!==lastWidth||height!==lastHeight||(currentRenderTime-lastRenderTime)>300;
lastWidth=width;lastHeight=height;lastRenderTime=currentRenderTime;return transition;};}());var handleRenderResult=function(result){if(result.token>canvasState.currentToken){debugLog("This is a newer image than expected! "+result.token);
canvasState.currentToken=result.token;}progress.stop();canvasState.renderResult=result;plotImage.update(result.base64,useTransition(result.width,result.height));
interactionLayer.update(result.data);canvasState.pickDetails.clear();statisticsLayer.update(result.data.renderStatistics);
canvasState.canMark=result.data.options.canMark;canvasState.canZoom=result.data.options.canZoom;if(result.data.updateLegend){Spotfire.Visuals.onUpdateLegend($viewport,{});
}Spotfire.Visuals.onPlotIssues($viewport,{viewId:viewId,issues:result.data.issues,plotMessages:result.data.plotMessages});
};var isMouseOverViewport=(function(){var isMouseOver=false;$viewport.on("mouseenter mousemove",function(){isMouseOver=true;
});$viewport.on("mouseleave",function(){isMouseOver=false;});return function(){return isMouseOver;};}());
var setDetails=function(data,highlightBase64){canvasState.pickDetails.setHighlightBase64(highlightBase64);
canvasState.pickDetails.setTooltip(data.tooltip);canvasState.pickDetails.setCursor(data.splitter,data.button,data.markerLabel);
};var highlight=(function(){var lastCursorPos=new Point(0,0);var highlightToken=-1;var getHighlightImage=function(x,y){var args={x:x,y:y,token:canvasState.currentToken,highlightToken:++highlightToken};
debugLog("HighlightRequest token: "+highlightToken+" x: "+x+" y: "+y);read("GetHighlightImage",args,function(image){debugLog("HighlightResponse token: "+highlightToken);
if(isMouseOverViewport()){setDetails(image.data,image.base64);}});};var clearHighlight=function(){lastCursorPos=new Point(0,0);
getHighlightImage(-1,-1);canvasState.pickDetails.setHighlightBase64();canvasState.pickDetails.setTooltip();
};var requestHighlight=function(pageX,pageY,mouseMoveThreshold){var offset=$viewport.sfBoxOffset();var currentPos=new Point(pageX-offset.left,pageY-offset.top);
if(currentPos.x<0||currentPos.x>$viewport.sfBoxWidth()||currentPos.y<0||currentPos.y>$viewport.sfBoxHeight()){return;
}if(Math.abs(currentPos.x-lastCursorPos.x)<mouseMoveThreshold&&Math.abs(currentPos.y-lastCursorPos.y)<mouseMoveThreshold){return;
}lastCursorPos=currentPos;getHighlightImage(currentPos.x,currentPos.y);};var onMouseMove=function(e){if(mouseButtons.which()===0){requestHighlight(e.pageX,e.pageY,2);
}};var throttledMouseMove=Spotfire.isProfessional()?_.throttle(onMouseMove,20):_.debounce(onMouseMove,200);
$viewport.on("mousemove",throttledMouseMove);$viewport.on("mouseleave",clearHighlight);return{redo:function(){requestHighlight(Spotfire.Cursor.getX(),Spotfire.Cursor.getY(),0);
}};}());$viewport.on("sf-touchhold",function(holdEvent){Touch.showTouchHoldImage(holdEvent.pageX,holdEvent.pageY);
Touch.clickBlocker();var moveTouchHoldImage=function(moveEvent){Touch.moveTouchHoldImage(moveEvent.pageX,moveEvent.pageY);
moveEvent.preventDefault();};$(window).on("sf-touchmousemove",moveTouchHoldImage);var onMarkingDone=function(){Touch.removeTouchHoldImage();
$(window).off("sf-touchmousemove",moveTouchHoldImage);};canvasActions.startMarking(holdEvent,null,onMarkingDone,true);
});$viewport.on("sf-touchmousedown",function(mouseDownEvent){if(Spotfire.capabilities.supportsTouch()){canvasActions.detectTouchClick(mouseDownEvent);
return;}var isZoom=mouseDownEvent.altKey&&mouseDownEvent.ctrlKey&&mouseDownEvent.shiftKey;if(isZoom&&!canvasState.canZoom){return;
}if(mouseDownEvent.which===3&&(mouseDownEvent.ctrlKey||mouseDownEvent.shiftKey)&&settings.canRightClickDrag){canvasActions.startRotate3DScatterPlot(mouseDownEvent);
return;}if(mouseDownEvent.which!==1){return;}if(canvasState.pickDetails.hasSplitterData()){canvasActions.startMovePruneLine(mouseDownEvent);
return;}if(canvasState.pickDetails.hasMarkerLabelData()){canvasActions.startMoveLabel(mouseDownEvent);
return;}if(isZoom){canvasActions.startRectangleZoom(mouseDownEvent);}else{if(canvasState.canMark){canvasActions.startMarking(mouseDownEvent);
}else{if(canvasState.pickDetails.hasButtonData()){canvasActions.startButtonBehavior(mouseDownEvent,canvasState.pickDetails.getButtonData().bounds);
}}}});var onKeyDown=function(e){if(Keys.F10===e.keyCode&&e.shiftKey){var ce=$.Event("contextmenu");var offset=$viewport.offset();
ce.pageX=offset.left+$viewport.width()/2;ce.pageY=offset.top+$viewport.height()/2;$viewport.trigger(ce);
return;}modify("KeyDown",{ctrlKey:e.ctrlKey,shiftKey:e.shiftKey,altKey:e.altKey,keyCode:e.keyCode});};
Spotfire.Focus.handleKeyDown($viewport,onKeyDown);var onMouseWheel=function(e){var offset=$viewport.offset();
modify("ScrollWheel",{x:e.pageX-offset.left,y:e.pageY-offset.top,scrollWheelX:e.scrollWheelX,scrollWheelY:e.scrollWheelY,ctrlKey:e.ctrlKey,shiftKey:e.shiftKey,altKey:e.altKey});
canvasState.pickDetails.clear();};$viewport.on("scrollwheel",onMouseWheel);return{start:function(){modify("Start","");
progress.start();},updatePlot:function(args){var token=args.token;debugLog("updatePlot imageToken: "+token);
if(token<=canvasState.currentToken){debugLog("This image has already been pushed. Ignoring.");return;
}canvasState.currentToken=token;progress.start();if(args.push){return;}if(plotImage.requesting){debugLog("Already requesting");
return;}var requestStart=function(){plotImage.requesting=true;globalProgressCounter.inc();};var requestEnd=function(){plotImage.requesting=false;
globalProgressCounter.dec();};var getImageCallback=function(image){requestEnd();debugLog("GetPlotImage currentToken: "+canvasState.currentToken+" imageToken: "+image.token);
if(image.token<canvasState.currentToken){debugLog("Old image! Asking again.");requestStart();read("GetPlotImage","",getImageCallback,requestEnd);
}if(!image.data){return;}handleRenderResult(image);if(image.token>canvasState.currentToken){debugLog("Got a newer image than expected. Updating currentToken to "+image.token);
canvasState.currentToken=image.token;}};requestStart();read("GetPlotImage","",getImageCallback,requestEnd);
},setPlotImage:function(data){var result=JSON.parse(data);handleRenderResult(result);},setDetailsResult:function(data){if(mouseButtons.which()===0){var result=JSON.parse(data);
if(isMouseOverViewport()){setDetails(result.data,result.base64);}}},setHighlightImage:function(base64){canvasState.pickDetails.setHighlightBase64(base64);
},clearHighlight:function(){canvasState.pickDetails.setHighlightBase64();},redoHighlight:function(){highlight.redo();
}};}var nomad=function(id){var $element=$("#"+id);return{bind:function(value){$element.data("plot",value);
return this;},invoke:function(func){var plot=$element.data("plot");if(plot!==undefined&&plot!==null&&typeof func==="function"){func.apply(plot,[plot]);
}return this;}};};Spotfire.registerNameSpace("Visuals.CanvasVisualization",{initialize:function(settings){nomad(settings.id).bind(new CanvasVisualization(settings)).invoke(function(){this.start();
});},clearHighlight:function(id){nomad(id).invoke(function(){this.clearHighlight();});},initializeWebSocket:function(proxy){proxy.registerHandler("PushDetails",function(args,data){nomad(args.id).invoke(function(){this.setDetailsResult(data);
});});proxy.registerHandler("PushHighlight",function(args,data){nomad(args.id).invoke(function(){this.setHighlightImage(data);
});});proxy.registerHandler("PushRenderResult",function(args,data){nomad(args.id).invoke(function(){this.setPlotImage(data);
});});},update:function(args){nomad(args.id).invoke(function(){this.updatePlot(args);});},setCursor:function(id,cursor){nomad(id).invoke(function(){this.setCursor(cursor);
});},redoHighlight:function(id){nomad(id).invoke(function(){this.redoHighlight();});},onActivity:function(handler){globalProgressCounter.addHandler(handler);
}});});$(function(){var CursorDiv=function(){var classString="sf-canvas-drag-cursor";var selector="."+classString;
var sizeInPixels=100;var getCursorDiv=function(){var $div=$(selector);if($div.length!==0){return $div;
}return $("<div/>").addClass(classString).css("position","absolute").css("width",sizeInPixels+"px").css("height",sizeInPixels+"px").css("opacity",0).appendTo("body");
};return{update:function(pageX,pageY,cursor){getCursorDiv().css("left",(pageX-sizeInPixels/2)+"px").css("top",(pageY-sizeInPixels/2)+"px").css("cursor",cursor);
},hide:function(){$(selector).remove();}};};var cursor=new CursorDiv();var beginDrag=function(options,$viewport){var defaultOptions={mouseMove:$.noop,mouseUp:$.noop,done:$.noop,cancelled:$.noop,dragPredicate:function(){return true;
},click:$.noop,cursor:"auto",preventContextMenuOnRelease:false};options=$.extend(defaultOptions,options);
var offset=$viewport.offset();var dragEvent=function(mouseEvent){var e=mouseEvent;return{x:e.pageX-offset.left,y:e.pageY-offset.top,pageX:e.pageX,pageY:e.pageY,clientX:e.clientX,clientY:e.clientY,altKey:e.altKey,ctrlKey:e.ctrlKey,shiftKey:e.shiftKey,stopPropagation:function(){mouseEvent.stopPropagation();
},preventDefault:function(){mouseEvent.preventDefault();}};};var nameSpace=".spotfireDragOperation";var $window=$(window);
var end=function(){if(options.preventContextMenuOnRelease){_.defer(function(){cursor.hide();});}else{cursor.hide();
}$window.off(nameSpace);options.done();};var checkDragStart=(function(){var dragStarted=false;return function(event){dragStarted=dragStarted||options.dragPredicate(event);
return dragStarted;};}());$window.on("sf-touchmousemove"+nameSpace,function(e){var event=dragEvent(e);
if(checkDragStart(event)){options.mouseMove(event);cursor.update(e.pageX,e.pageY,options.cursor);}});
$window.on("sf-touchmouseup"+nameSpace,function(e){var event=dragEvent(e);if(checkDragStart(event)){options.mouseUp(event);
}else{options.click(event);}end();});$window.on("keydown"+nameSpace,function(e){if(e.which===27){options.cancelled();
end();}});};Spotfire.registerNameSpace("Visuals.CanvasVisualization.Dragging",{begin:beginDrag});});$(function(){var validateNew=function(instance,type){if(instance instanceof type){return;
}throw"Instantiate object using the new keyword";};var pointDistance=function(point){var dx=this.x-point.x;
var dy=this.y-point.y;return Math.sqrt((dx*dx)+(dy*dy));};function Point(x,y){validateNew(this,Point);
this.x=x;this.y=y;this.distance=pointDistance;}Spotfire.registerNameSpace("Drawing",{Point:Point});});
$(function(){var createOverlay=function($viewport,entryPoint,overlayCssClass,isLasso,callback,markArea){var Point=Spotfire.Drawing.Point;
if(!(entryPoint instanceof Point)){throw"Expected a Spotfire.Drawing.Point";}var viewportWidth=$viewport.width();
var viewportHeight=$viewport.height();var svgns="http://www.w3.org/2000/svg";var svg=document.createElementNS(svgns,"svg");
svg.setAttribute("width",viewportWidth);svg.setAttribute("height",viewportHeight);var polygon=isLasso?document.createElementNS(svgns,"polyline"):document.createElementNS(svgns,"rect");
polygon.setAttribute("class","sf-overlay "+overlayCssClass);svg.appendChild(polygon);var $selection=$("<div/>").append(svg).appendTo($viewport).css({position:"absolute",width:viewportWidth+"px",height:viewportHeight+"px"});
var points=[];points.push(entryPoint);var avoidFuzzyness=0.5;var mouseMove=function(e){var x=Math.max(0,Math.min(e.x,viewportWidth-2*avoidFuzzyness));
var y=Math.max(0,Math.min(e.y,viewportHeight-2*avoidFuzzyness));if(isLasso){points.push(new Point(x,y));
var svgPath=points.map(function(p){return p.x+","+p.y;}).join(", ");polygon.setAttribute("points",svgPath);
}else{if(points.length===1){points.push(new Point(x,y));}else{points[1].x=x;points[1].y=y;}if(markArea!==null){if(markArea.horizontal){points[0].y=markArea.y;
points[1].y=markArea.y+markArea.height;}else{points[0].x=markArea.x;points[1].x=markArea.x+markArea.width;
}}var xx=Math.min(points[0].x,points[1].x)+avoidFuzzyness;var yy=Math.min(points[0].y,points[1].y)+avoidFuzzyness;
var width=Math.abs(points[0].x-points[1].x);var height=Math.abs(points[0].y-points[1].y);polygon.setAttribute("x",xx);
polygon.setAttribute("y",yy);polygon.setAttribute("width",width);polygon.setAttribute("height",height);
}};var mouseUp=function(){var isSingleClickOnAxis=(markArea&&points.length===1);callback(points,isSingleClickOnAxis);
$selection.remove();};var done=function(){$selection.remove();};Spotfire.Visuals.CanvasVisualization.Dragging.begin({mouseMove:mouseMove,mouseUp:mouseUp,done:done},$viewport);
};Spotfire.registerNameSpace("Visuals.CanvasVisualization.Marking",{createOverlay:createOverlay});});
$(function(){var which=0;window.addEventListener("mouseup",function(){which=0;},true);window.addEventListener("mousedown",function(e){which=e.which;
},true);window.addEventListener("dragend",function(){which=0;},true);Spotfire.registerNameSpace("Visuals.CanvasVisualization.MouseButtons",{which:function(){return which;
},reset:function(){which=0;}});});$(function(){var repeatButtonBehavior=function($div,pressed){$div.on("mousedown",function(e){$div.addClass("sfpc-active");
var pressInvoked=false;var timer=window.setInterval(function(){pressed(!pressInvoked);pressInvoked=true;
},100);Spotfire.Visuals.CanvasVisualization.Dragging.begin({mouseUp:function(e){if(!pressInvoked){pressed(true);
}},done:function(){$div.removeClass("sfpc-active");window.clearInterval(timer);}},$div);});};var NavigationBar=function(viewId){var $element=$("#"+viewId);
$element.addClass("sf-element-navigation-bar-3d");var modify=function(method,args){Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,method,JSON.stringify(args));
};var addButton=function(callback,icon,tooltip){var $button=$("<div>").addClass("sf-element-button").prop("title",tooltip).appendTo($element);
Spotfire.getSvg("Images/NavigationBar3D/"+icon,function(svg){$button.append(svg);});repeatButtonBehavior($button,function(firstTime){modify(callback,{beginNew:firstTime});
});};var resources=Spotfire.Localization.resources;addButton("ZoomIn","ZoomIn.svg",resources.NavigationBar3D_ZoomIn);
addButton("ZoomOut","ZoomOut.svg",resources.NavigationBar3D_ZoomOut);addButton("RotateRight","RotateRight.svg",resources.NavigationBar3D_Rotate);
addButton("RotateLeft","RotateLeft.svg",resources.NavigationBar3D_Rotate);addButton("RotateUp","RotateUp.svg",resources.NavigationBar3D_Rotate);
addButton("RotateDown","RotateDown.svg",resources.NavigationBar3D_Rotate);addButton("Reset","Reset.svg",resources.NavigationBar3D_Reset);
$element.children().sfSetSequencePseudoClasses();$element.on("contextmenu",function(e){e.preventDefault();
e.stopPropagation();Spotfire.PageBus.publish("spotfire.navigationbar3d.showcontextmenu",{},viewId);});
return this;};Spotfire.registerNameSpace("Visuals.NavigationBar3D",{initialize:function(id,settings){var selector="#"+id;
$(selector).data("navigationbar",new NavigationBar(id,settings));}});});$(function(){var create=function(highlightImage,$viewport){var splitterData=null;
var markerLabelData=null;var buttonData=null;var setHighlightBase64=function(base64){if(typeof base64==="string"&&base64.length>0){highlightImage.update(base64);
}else{highlightImage.clear();}};var setTooltip=function(data){if(data!==undefined&&data!==null){var offset=$viewport.offset();
var x=offset.left+data.x;var y=offset.top+data.y;Spotfire.Visuals.PlotTooltip.showHtml(data.html,x,y);
}else{Spotfire.Visuals.PlotTooltip.hide();}};var setCursor=function(splitter,button,markerLabel){var cursor="default";
splitterData=splitter;markerLabelData=markerLabel;buttonData=button;if(splitter!==undefined&&splitter!==null){cursor=splitter.isHorizontal?"row-resize":"col-resize";
}if(button!==undefined&&button!==null){cursor="pointer";}$viewport.css("cursor",cursor);};var clear=function(){setHighlightBase64();
setTooltip();setCursor();};var hasButtonData=function(){return typeof buttonData==="object"&&buttonData!==null;
};var getButtonData=function(){return buttonData;};var hasSplitterData=function(){return typeof splitterData==="object"&&splitterData!==null;
};var getSplitterData=function(){return splitterData;};var hasMarkerLabelData=function(){return typeof markerLabelData==="object"&&markerLabelData!==null;
};var getMarkerLabelData=function(){return markerLabelData;};return{setHighlightBase64:setHighlightBase64,setTooltip:setTooltip,setCursor:setCursor,clear:clear,hasButtonData:hasButtonData,getButtonData:getButtonData,hasSplitterData:hasSplitterData,getSplitterData:getSplitterData,hasMarkerLabelData:hasMarkerLabelData,getMarkerLabelData:getMarkerLabelData};
};Spotfire.registerNameSpace("Visuals.CanvasVisualization.PickDetails",{create:create});});$(function(){var mouseX,mouseY;
var padding=10;var cursorOffset=5;var fadeState={IN:1,OUT:2,HIDDEN:3,SHOWN:4,current:3};var fadeDuration=150;
var fadeInDelay=500;var fadeOutDelay=200;var $body=$(document.body);var tooltipAppearanceCss={};var hide=null;
var onMouseDown=function(){hide();};var onMouseMove=function(e){mouseX=e.pageX;mouseY=e.pageY;};hide=function(){var delay=fadeState.current===fadeState.IN?0:fadeOutDelay;
var duration=fadeDuration;var tooltipScene=d3.select($body.get(0)).selectAll(".sf-tooltip.sf-plot-tooltip").data([]);
tooltipScene.exit().transition("fade").delay(delay).duration(duration).style("opacity","0.001").remove().each("start",function(){fadeState.current=fadeState.OUT;
}).each("end",function(){fadeState.current=fadeState.HIDDEN;$body.unbind("mousedown",onMouseDown);});
};var showHtml=function(content,x,y){if(typeof x!=="number"||typeof y!=="number"){x=mouseX;y=mouseY;}if(Spotfire.capabilities.supportsTouch()){return;
}if(!content){return;}var maxWidth=$(window).width()-padding*2;var maxHeight=$(window).height()-padding*2;
var tooltipScene=d3.select($body.get(0)).selectAll(".sf-tooltip.sf-plot-tooltip").data([1]);tooltipScene.enter().append(function(){var $tooltipDiv=$("<div/>").addClass("sf-tooltip sf-plot-tooltip").css({width:"0",height:"0"}).css(tooltipAppearanceCss);
$("<div/>").addClass("sf-tooltip-content").appendTo($tooltipDiv).css({width:maxWidth+"px",height:maxHeight+"px"});
$body.mousedown(onMouseDown);return $tooltipDiv.get(0);});if(fadeState.current===fadeState.OUT){tooltipScene.interrupt("fade").transition("fade").duration(fadeDuration).style("opacity","1").each("start",function(){fadeState.current=fadeState.IN;
}).each("end",function(){fadeState.current=fadeState.SHOWN;});}else{if(fadeState.current===fadeState.HIDDEN){tooltipScene.style("opacity","0.001").transition("fade").duration(fadeInDelay).transition().duration(fadeDuration).style("opacity","1").each("start",function(){fadeState.current=fadeState.IN;
}).each("end",function(){fadeState.current=fadeState.SHOWN;});}else{if(fadeState.current===fadeState.SHOWN){tooltipScene.interrupt("fade").transition("fade");
}}}var layoutTooltip=function(){var width;var height;var left;var bottom;tooltipScene.each(function(){var $tooltipDiv=$(this);
var $contentSpan=$(".sf-tooltip-content span",$tooltipDiv);width=$contentSpan.width()+1;height=$contentSpan.height();
var documentHeight=$(window).height();bottom=Math.max(padding,Math.min(documentHeight-y+cursorOffset,documentHeight-height-padding));
var documentWidth=$(window).width()-padding*2;left=Math.max(padding,Math.min(x+cursorOffset,documentWidth-width));
});tooltipScene.style("left",left+"px").style("bottom",bottom+"px").transition("layout").duration(100).style("width",width+"px").style("height",height+"px");
};tooltipScene.each(function(){var $tooltipDiv=$(this);var $contentDiv=$(".sf-tooltip-content",$tooltipDiv);
$contentDiv.empty();var $contentSpan=$("<span/>");$("img",$contentSpan).on("load",layoutTooltip);$contentSpan.html(content);
$contentDiv.append($contentSpan);});layoutTooltip();};var setAppearance=function(textColor,backgroundColor,borderColor,borderWidth){tooltipAppearanceCss={"background-color":backgroundColor,color:textColor,"border-color":borderColor,"border-width":borderWidth+"px"};
};Spotfire.registerNameSpace("Visuals.PlotTooltip",{showHtml:showHtml,hide:hide,setAppearance:setAppearance});
$body.mousemove(onMouseMove);});$(function(){var stringify=function(args){return typeof args==="string"?args:JSON.stringify(args);
};var addTooltip=function($el,text,useNbsp){if(text.trim()){$el.text(text);}else{if(useNbsp){$el.html("&nbsp;");
}}$el.hover(function(){Spotfire.Visuals.Tooltip.show(text,Spotfire.Visuals.Tooltip.defaultPauseTime);
},function(){Spotfire.Visuals.Tooltip.hide();});};var textOrNbsp=function($el,text,useNbsp){if(text){addTooltip($el,text,true);
}else{if(useNbsp){$el.html("&nbsp;");}}};function toRGBA(color){return"rgba("+color.R+","+color.G+","+color.B+","+color.A+")";
}function Progress($viewport){var progressTimer=null;var delay=500;var progressAnimation=null;var interval=null;
var showOverlay=function(){var w=$viewport.width();var h=$viewport.height();progressAnimation=Spotfire.Progress.createFadingProgressAnimation($viewport,w,h);
var $overlay=progressAnimation.$element;$overlay.css("cursor","progress");$overlay.css("text-align","center");
};var cleanup=function(){if(progressTimer!==null){window.clearTimeout(progressTimer);progressTimer=null;
}if(interval!==null){window.clearInterval(interval);interval=null;}if(progressAnimation!==null){progressAnimation.remove();
progressAnimation=null;}};return{start:function(){if(progressTimer!==null||progressAnimation!==null){return;
}progressTimer=window.setTimeout(showOverlay,delay);},stop:function(){cleanup();}};}var read=function(id,method,args,callback,errorCallback){Spotfire.Dxp.Web.Forms.AjaxService.Read(id,method,stringify(args),callback,errorCallback);
};var modify=function(id,method,args){var json=stringify(args);Spotfire.Dxp.Web.Forms.AjaxService.Modify(id,method,json);
};function createSparkline($sparklineContainer,id,dataset,markLastPoint,strokeWidth){var svgns="http://www.w3.org/2000/svg";
var svg=document.createElementNS(svgns,"svg");svg.setAttribute("class","sparkline-svg");var $svg=$(svg);
$sparklineContainer.prepend(svg);var endPointRadious=strokeWidth*(strokeWidth>6?1.3:(strokeWidth>2?1.5:2));
var height=54;var width=216;if(svg.style.vectorEffect===undefined){height=$svg.height();width=$svg.width();
}var domainMinX=1;var domainMaxX=209;var rangeMinX=endPointRadious;var rangeMaxX=width-endPointRadious;
var domainMinY=1;var domainMaxY=49;var rangeMinY=endPointRadious;var rangeMaxY=height-endPointRadious;
var x=d3.scale.linear().domain([domainMinX,domainMaxX]).range([rangeMinX,rangeMaxX]);var y=d3.scale.linear().domain([domainMinY,domainMaxY]).range([rangeMinY,rangeMaxY]);
var tooltipCanceled;var toolTipIndicator=document.createElementNS(svgns,"path");toolTipIndicator.setAttribute("class","tooltipIndicator");
toolTipIndicator.setAttribute("d",Spotfire.Utilities.formatString("M 0, 0 m -{0}, 0 a {0},{0} 0 1,0 {1},0 a {0},{0} 0 1,0 -{1},0",endPointRadious,endPointRadious*2));
toolTipIndicator.setAttribute("stroke","none");$(svg).append(toolTipIndicator);var tooltipTimer;function getSparklinePointTooltip(result){if(result.tooltip&&!tooltipCanceled){var pauseTime=Spotfire.Visuals.Tooltip.defaultPauseTime;
if($(".sf-tooltip").length>0){pauseTime=0;}if(tooltipTimer){clearTimeout(tooltipTimer);}tooltipTimer=setTimeout(function(){if(!tooltipCanceled){var sparklineWidth=$svg.width();
var sparklineHeight=$svg.height();if(sparklineWidth>0&&sparklineHeight>0){var xScale=width/sparklineWidth;
var yScale=height/sparklineHeight;toolTipIndicator.setAttribute("transform",Spotfire.Utilities.formatString("translate({0} {1}) scale({2} {3})",x(result.point.x),y(result.point.y),xScale,yScale));
toolTipIndicator.setAttribute("stroke","currentColor");}}},pauseTime);Spotfire.Visuals.Tooltip.show(result.tooltip,pauseTime);
}}var getTooltip=function(e){var kpi=$(e.target).parents(".sf-kpi-tile").data("kpi");if(!kpi){return;
}var sparkline=$(e.target);if(!sparkline.is(".sparkline-svg")){sparkline=$(e.target).closest(".sparkline-svg");
}var sparklineOffset=sparkline.offset();var sparklineWidth=sparkline.width();var sparklineHeight=sparkline.height();
if(sparklineWidth===0||sparklineHeight===0){return;}var svgX=width*(e.pageX-sparklineOffset.left)/sparklineWidth;
var svgY=height*(e.pageY-sparklineOffset.top)/sparklineHeight;var internalSvgScaleFactorX=(domainMaxX-domainMinX)/(rangeMaxX-rangeMinX);
var internalSvgScaleFactorY=(domainMaxY-domainMinY)/(rangeMaxY-rangeMinY);var scaledSvgX=internalSvgScaleFactorX*(svgX-rangeMinX)+domainMinX;
var scaledSvgY=internalSvgScaleFactorY*(svgY-rangeMinY)+domainMinY;var args={token:kpi.token,kpiNodeId:kpi.kpiNodeId,leafNodeIndex:kpi.leafNodeIndex,svgX:scaledSvgX,svgY:scaledSvgY};
read(id,"GetSparklinePointTooltip",args,getSparklinePointTooltip);};var showTooltip=function(e){tooltipCanceled=false;
var throttleGetTooltip=_.throttle(getTooltip,20);var debounceGetTooltip=_.debounce(getTooltip,200);if(Spotfire.isProfessional()){throttleGetTooltip(e);
}else{debounceGetTooltip(e);}};function hideTooltip(){tooltipCanceled=true;toolTipIndicator.setAttribute("stroke","none");
Spotfire.Visuals.Tooltip.hide();}$svg[0].setAttribute("viewBox","0 0 "+width+" "+height);$svg[0].setAttribute("preserveAspectRatio","none");
$svg.on("mousemove",showTooltip);$svg.on("mouseleave",hideTooltip);var line=d3.svg.line().x(function(d){return x(d.x);
}).y(function(d){return y(d.y);});var path=document.createElementNS(svgns,"path");var $path=$(path).attr("d",line(dataset)).attr("vector-effect","non-scaling-stroke").attr("shape-rendering","auto").attr("stroke-width",strokeWidth).attr("stroke-linecap","round").attr("stroke-linejoin","round");
$svg.append($path);if(markLastPoint){var lastPoint=dataset[dataset.length-1];var circle=document.createElementNS(svgns,"path");
var $circle=$(circle).attr("d",Spotfire.Utilities.formatString("M{0} {1}h{2}",x(lastPoint.x),y(lastPoint.y),0.01)).attr("stroke-width",endPointRadious*2).attr("stroke-linecap","round").attr("vector-effect","non-scaling-stroke").attr("stroke","currentColor");
$svg.append($circle);}return $svg;}function createSparklineScale(height,max,min,mt,strokeWidth){var textWidth=Math.max(mt(max),mt(min));
var svgns="http://www.w3.org/2000/svg";var svg=document.createElementNS(svgns,"svg");if(svg.style.vectorEffect===undefined){strokeWidth=1;
}var width=textWidth+3+Math.floor((strokeWidth/2)+0.5);var $svg=$(svg).attr("width",width).attr("height",height);
$svg[0].setAttribute("viewBox","0 0 "+width+" "+height);$svg[0].setAttribute("preserveAspectRatio","none");
svg.setAttribute("class","sparkline-scale-svg");var $text1=$(document.createElementNS(svgns,"text")).attr("x","3").attr("y","1em").attr("dx",strokeWidth/2).attr("fill","currentColor").attr("stroke","none");
addTooltip($text1,max);var $text2=$(document.createElementNS(svgns,"text")).attr("x","3").attr("y",height-2).attr("dx",strokeWidth/2).attr("dy","0").attr("fill","currentColor").attr("stroke","none");
addTooltip($text2,min);$svg.append($text1);$svg.append($text2);var $line=$(document.createElementNS(svgns,"line")).attr("x1",1).attr("y1",2).attr("x2",1).attr("y2",height-2).attr("stroke-width",strokeWidth).attr("vector-effect","non-scaling-stroke").attr("shape-rendering","crispEdges");
$svg.append($line);return $svg;}function KpiChart(id){var $kpiChart=$("#"+id).addClass("sf-kpi-chart");
var progress=new Progress($kpiChart);var resultTiles={lastResult:null};var currentToken=-1;var pendingToken=-1;
var layoutPadding=5;var fontFamily=$kpiChart.css("font-family");var fontSize=parseInt($kpiChart.css("font-size"),10);
var italic=$kpiChart.css("font-style")==="italic";var bold=$kpiChart.css("font-weight")==="bold";var mt=function(text){if(!text){return 0;
}var canvas=document.createElement("canvas");var displayNameFont=(italic?"italic ":"")+(bold?"bold ":"")+fontSize+"px "+fontFamily;
var context=canvas.getContext("2d");context.font=displayNameFont;var metrics=context.measureText(text);
return metrics.width;};var createKpiTile=function(result,kpi){kpi.token=currentToken;var $kpiTile=Spotfire.Flex.item({container:"vertical",inline:true,"align-items":"start",fill:true}).addClass("sf-kpi-tile").data("kpi",kpi);
$kpiTile.css({"background-color":toRGBA(kpi.backgroundColor),color:toRGBA(kpi.textColor)});var $topContainer=Spotfire.Flex.item({container:"horizontal","justify-content":"space-between","align-items":"center",fill:true}).addClass("KpiTopContainer");
var $tileValue=$("<div/>").addClass("KpiTitle");textOrNbsp($tileValue,kpi.formattedTileValue,result.tile);
$topContainer.append($tileValue);var $timeValue=$("<div/>").addClass("KpiTime");textOrNbsp($timeValue,kpi.formattedXvalue,result.x);
$topContainer.append($timeValue);$kpiTile.append($topContainer);var $yValue=$("<div/>").addClass("KpiValue");
textOrNbsp($yValue,kpi.formattedYValue,result.compAndY);$kpiTile.append($yValue);var $yDisplayName=$("<div/>").addClass("KpiActual");
textOrNbsp($yDisplayName,kpi.yDisplayName,result.compAndY);$kpiTile.append($yDisplayName);var $perfCont=Spotfire.Flex.item({container:"vertical","align-items":"stretch","justify-content":"end"}).addClass("KpiFromTargetCont");
if(result.sparkline){var strokeWidth=Math.max(Math.floor((fontSize/11)+0.3),1);var $sparklineContainer=Spotfire.Flex.item({container:"horizontal","align-items":"stretch","justify-content":"space-between",fill:true});
$sparklineContainer.append($perfCont);var $sparkline=$("<div/>").addClass("Sparkline").sfFlex({container:"horizontal",grow:true});
if(kpi.points&&kpi.points.length){var svg=document.createElementNS("http://www.w3.org/2000/svg","svg");
if(svg.style.vectorEffect===undefined){setTimeout(function(){createSparkline($sparkline,id,kpi.points,kpi.markLastPoint,strokeWidth);
});}else{createSparkline($sparkline,id,kpi.points,kpi.markLastPoint,strokeWidth);}if(kpi.showScale){var height=fontSize*4.909;
var $sparklineScaleSvg=createSparklineScale(height,kpi.max,kpi.min,mt,strokeWidth);$sparkline.append($sparklineScaleSvg);
}$perfCont.css("max-width","50%");}$sparklineContainer.append($sparkline);$kpiTile.append($sparklineContainer);
}else{$kpiTile.append($perfCont);$perfCont.css("max-width","100%");}var $perfValue=$("<div/>").addClass("KpiTargetValue");
textOrNbsp($perfValue,kpi.formattedComparativeValue,result.compAndY);$perfCont.append($perfValue);if(result.compAndY||kpi.formattedComparativeValue){$perfCont.addClass("KpiLast");
}else{$yDisplayName.addClass("KpiLast");}var $comDisplayName=$("<div/>").addClass("KpiTarget");textOrNbsp($comDisplayName,kpi.comparativeAxisDisplayName,result.compAndY);
$perfCont.append($comDisplayName);var isActive=result.activeKpi===kpi.kpiNodeId;var activeAlpha=result.markedOutlineColor.R>127?0.25:kpi.textColor.R>127?0.75:0.25;
var activeColor=kpi.textColor.R>127?"rgba(255,255,255,":"rgba(0,0,0,";activeColor+=activeAlpha+")";$kpiTile.css("border","1px solid "+(kpi.isMarked?toRGBA(result.markedOutlineColor):(isActive?activeColor:"transparent")));
if(isActive){$kpiTile.css("box-shadow","inset 0 0 0 1px "+activeColor);}if(kpi.hasAction){$kpiTile.addClass("sf-action-tile");
}return $kpiTile;};var scroll;var updateStyling=function(){if(resultTiles.lastResult===null){return;}var $kpiLayout=$kpiChart.find(".KpiLayout");
var $tile=createKpiTile(resultTiles.lastResult,{backgroundColor:{R:1,G:1,B:1,A:1},textColor:{R:1,G:1,B:1,A:1},formattedYValue:"test",yDisplayName:"test",points:resultTiles.lastResult.sparkline?[{x:1,y:2}]:false}).css({position:"absolute",height:"auto"});
$kpiLayout.prepend($tile);var paddingBorderMarginPerKpi=$tile.sfBoxWidth()-$tile.width();var height=$tile.height();
var boxHeight=$tile.sfBoxHeight();$tile.remove();var totalWidth=$kpiChart.width();var kpiLayoutHeight=$kpiChart.height()-layoutPadding;
var styledScrollbar=$kpiLayout.data("scrollbar")||$kpiLayout.StyledScrollbar({allowResize:true});var scrollbarHeight=styledScrollbar.getVScrollbarSize(true);
var preferredWidth=resultTiles.lastResult.preferedWidth;var maxWidth=2*preferredWidth+paddingBorderMarginPerKpi;
var numberOfKpis=resultTiles.lastResult.data.length;var maxKpisPerRow=Math.floor(totalWidth/(preferredWidth+paddingBorderMarginPerKpi));
var kpisPerRow=Math.max(1,Math.min(maxKpisPerRow,numberOfKpis));var totalHeight=Math.ceil(numberOfKpis/kpisPerRow)*boxHeight;
var scrollWidth=totalWidth;if(totalHeight>kpiLayoutHeight){scrollWidth=totalWidth-scrollbarHeight;maxKpisPerRow=Math.floor(totalWidth/(preferredWidth+paddingBorderMarginPerKpi));
kpisPerRow=Math.max(1,Math.min(maxKpisPerRow,numberOfKpis));}var widthPerTile=Math.floor(scrollWidth/kpisPerRow);
if(widthPerTile>maxWidth){widthPerTile=maxWidth;}var escapedId=Spotfire.Utilities.escapeIdForCss(id);
var rule=escapedId+" .sf-kpi-tile { width:"+(widthPerTile-paddingBorderMarginPerKpi)+"px; height:"+height+"px;}";
Spotfire.StyleManager.updateOverrideCss($kpiChart,rule);$kpiLayout.css({width:totalWidth+"px",height:kpiLayoutHeight+"px"});
if(scroll!==undefined){scroll.refresh();}styledScrollbar.refresh();};var renderKpis=_.throttle(function(result){resultTiles.lastResult=result;
fontFamily=$kpiChart.css("font-family");fontSize=parseInt($kpiChart.css("font-size"),10);italic=$kpiChart.css("font-style")==="italic";
bold=$kpiChart.css("font-weight")==="bold";var $oldKpiLayout=$(".KpiLayout",$kpiChart);var newLayout=false;
var $scrollDiv;if($oldKpiLayout.length===0){newLayout=true;$oldKpiLayout=$("<div/>").addClass("KpiLayout").css({width:$kpiChart.width()+"px",height:($kpiChart.height()-layoutPadding)+"px"});
$kpiChart.append($oldKpiLayout);if(Spotfire.capabilities.supportsTouch()){$oldKpiLayout.append($("<div/>"));
scroll=new IScroll($oldKpiLayout.children().get(0),null,{bounce:false,hScrollbarEnabled:false});}}if(Spotfire.capabilities.supportsTouch()){$scrollDiv=$oldKpiLayout.children();
}else{$scrollDiv=$oldKpiLayout;}var $kpiLayout=$("<div/>");var i;var numberOfKpis=result.data.length;
for(i=0;i<numberOfKpis;i++){$kpiLayout.append(createKpiTile(result,result.data[i]));}if(!newLayout){$scrollDiv.empty();
}$scrollDiv.append($kpiLayout.children());updateStyling();progress.stop();},100);var getTarget=function(e){var $target=$(e.target);
var targets=[".sf-kpi-tile",".KpiLayout"].join();if(!$target.is(targets)){$target=$target.closest(targets);
}return $target;};var clickIsCloseToBorder=function(e,$target){var bb=$target[0].getBoundingClientRect();
var x=e.pageX-bb.left;var y=e.pageY-bb.top;var m=10;if(x>m&&bb.width-x>m&&y>m&&bb.height-y>m){return false;
}return true;};var unMark=function(args){args.token=currentToken;modify(id,"Mark",args);};$kpiChart.on("contextmenu",function(e){var $target=getTarget(e);
var args={token:currentToken};if($target.is(".sf-kpi-tile")){var kpi=$target.data("kpi");args.token=kpi.token;
args.kpiNodeId=kpi.kpiNodeId;args.leafNodeIndex=kpi.leafNodeIndex;}args.pointOnPage=new Point(e.pageX,e.pageY);
modify(id,"RightClick",args);});$kpiChart.on("click",function(e){var $target=getTarget(e);var args={};
if($target.is(".sf-kpi-tile")){if(Spotfire.capabilities.supportsTouch()&&clickIsCloseToBorder(e,$target)){unMark(args);
return;}var markMode=e.shiftKey?"Add":(e.ctrlKey?"Toggle":"Replace");var kpi=$target.data("kpi");args.token=kpi.token;
args.kpiNodeId=kpi.kpiNodeId;args.leafNodeIndex=kpi.leafNodeIndex;args.mode=markMode;modify(id,"Mark",args);
}if($target.is(".KpiLayout")){unMark(args);}});var onKeyDown=function(e){if(Keys.F10===e.keyCode&&e.shiftKey){var ce=$.Event("contextmenu");
var offset=$kpiChart.offset();ce.pageX=offset.left+$kpiChart.width()/2;ce.pageY=offset.top+$kpiChart.height()/2;
$kpiChart.trigger(ce);return;}modify(id,"KeyDown",{ctrlKey:e.ctrlKey,shiftKey:e.shiftKey,altKey:e.altKey,keyCode:e.keyCode});
};Spotfire.Focus.handleKeyDown($kpiChart,onKeyDown);return{resize:updateStyling,updateTiles:function(args){var token=args.token;
if(token<=currentToken){return;}if(token>pendingToken){pendingToken=token;}progress.start();if(resultTiles.requesting){return;
}var requestStart=function(){resultTiles.requesting=true;};var requestEnd=function(){resultTiles.requesting=false;
};var getKpiCallback=function(result){requestEnd();if(result.token<pendingToken){requestStart();read(id,"GetKpiTiles","",getKpiCallback,requestEnd);
}if(result.token===-1){return;}currentToken=result.token;renderKpis(result);Spotfire.Visuals.onPlotIssues($kpiChart,{viewId:id,issues:result.issues});
};requestStart();if(args.result){getKpiCallback(args.result);}else{read(id,"GetKpiTiles","",getKpiCallback,requestEnd);
}}};}Spotfire.registerNameSpace("Visuals.KpiChart",{initialize:function(settings){var $kpiChart=$("#"+settings.id);
var plot=new KpiChart(settings.id);$kpiChart.data("plot",plot);plot.updateTiles(settings);},updateTiles:function(settings){var $kpiChart=$("#"+settings.id);
var kpiChart=$kpiChart.data("plot");kpiChart.updateTiles(settings);},resize:function(id){var $kpiChart=$("#"+id);
var kpiChart=$kpiChart.data("plot");kpiChart.resize();}});});function Point(x,y){this.x=Math.round(x);
this.y=Math.round(y);}Point.prototype.offset=function(x,y){this.x+=Math.round(x);this.y+=Math.round(y);
return this;};Point.prototype.equals=function(point){return(point.x===this.x&&point.y===this.y);};Point.prototype.toString=function(){return"("+this.x+", "+this.y+")";
};Point.prototype.clone=function(){return new Point(this.x,this.y);};Point.prototype.distance=function(point){var deltaX=this.x-point.x;
var deltaY=this.y-point.y;return Math.sqrt((deltaX*deltaX)+(deltaY*deltaY));};function Rectangle(x,y,width,height){if(typeof x==="object"){var original=x;
this.x=original.x;this.y=original.y;this.width=original.width;this.height=original.height;return;}this.x=x;
this.y=y;this.width=width;this.height=height;}Rectangle.prototype.equals=function(rect){return(rect.x===this.x&&rect.y===this.y&&rect.width===this.width&&rect.height===this.height);
};Rectangle.prototype.toString=function(){return"("+this.x+", "+this.y+", "+this.width+", "+this.height+")";
};Rectangle.prototype.clone=function(){return new Rectangle(this.x,this.y,this.width,this.height);};Rectangle.prototype.left=function(){return this.x;
};Rectangle.prototype.top=function(){return this.y;};Rectangle.prototype.right=function(){return this.x+this.width;
};Rectangle.prototype.bottom=function(){return this.y+this.height;};Rectangle.prototype.centerX=function(){return this.x+this.width/2;
};Rectangle.prototype.centerY=function(){return this.y+this.height/2;};Rectangle.prototype.getHalf=function(side){switch(side){case"top":return new Rectangle(this.x,this.y,this.width,this.height/2);
case"bottom":return new Rectangle(this.x,this.y+this.height/2,this.width,this.height/2);case"left":return new Rectangle(this.x,this.y,this.width/2,this.height);
case"right":return new Rectangle(this.x+this.width/2,this.y,this.width/2,this.height);default:return new Rectangle(this);
}};Rectangle.prototype.round=function(){this.x=Math.round(this.x);this.y=Math.round(this.y);this.width=Math.round(this.width);
this.height=Math.round(this.height);return this;};Rectangle.prototype.containsPoint=function(x,y){if(x>=this.x&&y>=this.y&&x<(this.x+this.width)&&y<(this.y+this.height)){return true;
}return false;};Rectangle.prototype.offset=function(x,y){this.x+=x;this.y+=y;return this;};Rectangle.prototype.pointOffset=function(point){return this.offset(point.x,point.y);
};Rectangle.prototype.intersect=function(rectangle){return this.clip(rectangle);};Rectangle.prototype.intersectsWith=function(rect){return !(rect.x>this.x+this.width||rect.x+rect.width<this.x||rect.y>this.y+this.height||rect.y+rect.height<this.y);
};Rectangle.prototype.clip=function(clipRectangle){if(clipRectangle.intersectsWith(this)){var origX=this.x;
var origY=this.y;this.x=Math.max(this.x,clipRectangle.x);this.y=Math.max(this.y,clipRectangle.y);this.width=Math.max(0,Math.min(origX+this.width,clipRectangle.x+clipRectangle.width)-this.x);
this.height=Math.max(0,Math.min(origY+this.height,clipRectangle.y+clipRectangle.height)-this.y);}else{this.width=0;
this.height=0;}return this;};Rectangle.prototype.inflate=function(width,height){this.y-=height;this.height+=2*height;
this.x-=width;this.width+=2*width;};Rectangle.prototype.subtract=function(rect){var a=new Rectangle(this);
var b=new Rectangle(rect).intersect(a);if(b.width===0&&b.height===0){return this;}if(!(a.width===b.width||a.height===b.height)){return this;
}if(a.height>b.height){this.height=a.height-b.height;if(a.y===b.y){this.y=b.y+b.height;}}else{if(a.width>b.width){this.width=a.width-b.width;
if(a.x===b.x){this.x=b.x+b.width;}}else{this.width=0;this.height=0;}}return this;};function Size(width,height){this.width=width;
this.height=height;}Size.prototype.toString=function(){return"("+this.width+", "+this.height+")";};function Range(low,high){this.low=low;
this.high=high;}Range.prototype.toString=function(){return(this.low+" "+this.high);};function Path(points){this.pathString="";
this.pathArray=[];if(!points){return;}var i;for(i=0;i<points.length;i++){this.addPoint(points[i].x,points[i].y);
}}Path.prototype.addPoint=function(x,y){var pathStringStart="L ";if(this.pathArray.length===0){pathStringStart="M ";
}this.pathString+=pathStringStart+x+" "+y+" ";this.pathArray.push(new Point(x,y));};Path.prototype.toArray=function(){return this.pathArray;
};Path.prototype.toString=function(){return this.pathString;};function Circle(x,y,radius){this.x=x;this.x=y;
this.radius=radius;}Circle.prototype.circleToPolygon=function(){var step=2*Math.PI/100;var points=[];
var pointsString="";var theta,point;for(theta=0;theta<2*Math.PI;theta+=step){point=new Point(0,0);point.x=Math.round(this.x+this.radius*Math.cos(theta));
point.y=Math.round(this.y-this.radius*Math.sin(theta));points.push(point);pointsString+="L "+point.x+" "+point.y+" ";
}pointsString=pointsString.replace("L","M");return{pointsString:pointsString,points:points};};function Triangle(width,height){this.width=width;
this.height=height;}Triangle.prototype.toPathString=function(){return"M0 0 L0 "+this.height+" L"+this.width+" "+(this.height/2)+" Z";
};function Margins(left,top,right,bottom){if(typeof left==="object"){var original=left;this.left=original.left;
this.top=original.top;this.right=original.right;this.bottom=original.bottom;return;}this.left=left;this.top=top;
this.right=right;this.bottom=bottom;}Margins.prototype.equals=function(margins){return(margins.left===this.left&&margins.top===this.top&&margins.right===this.right&&margins.bottom===this.bottom);
};Margins.prototype.toString=function(){return"("+this.left+", "+this.top+", "+this.right+", "+this.bottom+")";
};Margins.prototype.toCss=function(){return this.top+"px "+this.right+"px "+this.bottom+"px "+this.left+"px";
};Margins.prototype.clone=function(){return new Margins(this.left,this.top,this.right,this.bottom);};
Margins.prototype.horizontal=function(){return this.left+this.right;};Margins.prototype.vertical=function(){return this.top+this.bottom;
};Spotfire.registerNameSpace("Utilities");Spotfire.Utilities.SafeColor=function(color){var colorString=color;
this.colornames={aqua:"#00ffff",black:"#000000",blue:"#0000ff",fuchsia:"#ff00ff",gray:"#808080",green:"#008000",lime:"#00ff00",maroon:"#800000",navy:"#000080",olive:"#808000",purple:"#800080",red:"#ff0000",silver:"#c0c0c0",teal:"#008080",white:"#ffffff",yellow:"#ffff00"};
if(this.colornames[color]!==undefined){colorString=this.colornames[color];}if(colorString.charAt(0)==="#"&&colorString.length>6){this.r=parseInt(colorString.substring(1,3),16);
this.g=parseInt(colorString.substring(3,5),16);this.b=parseInt(colorString.substring(5,7),16);}else{if(colorString.charAt(0)==="#"&&colorString.length>3){this.r=parseInt(colorString.substring(1,2),16);
this.g=parseInt(colorString.substring(2,3),16);this.b=parseInt(colorString.substring(3,4),16);this.r+=16*this.r;
this.g+=16*this.g;this.b+=16*this.b;}else{if(colorString.indexOf("rgb(")===0){var str=colorString.substring(4,colorString.length-1);
var rgbArray=str.split(",",3);this.r=parseInt(rgbArray[0],10);this.g=parseInt(rgbArray[1],10);this.b=parseInt(rgbArray[2],10);
}else{this.r=255;this.g=255;this.b=255;}}}};Spotfire.Utilities.SafeColor.prototype.toHexString=function(){var rc=Math.min(255,Math.max(0,this.r));
var gc=Math.min(255,Math.max(0,this.g));var bc=Math.min(255,Math.max(0,this.b));var rgb=bc|(gc<<8)|(rc<<16);
var colorString="000000"+rgb.toString(16);colorString="#"+colorString.substring(colorString.length-6,colorString.length);
return colorString;};Spotfire.Utilities.SafeColor.prototype.luminance=function(){var rc=Math.min(255,Math.max(0,this.r));
var gc=Math.min(255,Math.max(0,this.g));var bc=Math.min(255,Math.max(0,this.b));return(0.2126*rc+0.7152*gc+0.0722*bc)/255;
};Spotfire.Utilities.SafeColor.prototype.adjustBrightness=function(value){if(value!==undefined){this.r+=value;
this.g+=value;this.b+=value;}};$(function(){Spotfire.registerNameSpace("Visuals.TableContextualMenu");
function addCheckBox(inputId,text,tooltipText,checked,enabled,callback){var $itemWrapper=Spotfire.Flex.item({container:"horizontal",inline:true,"align-items":"center"});
$itemWrapper.css("max-width","100%");var $checkbox=$("<div/>").addClass("sf-element sf-element-check-box");
Spotfire.getSvg("Images/Filters/CheckMark.svg",(function($cb){return function($svg){$cb.append($svg);
};}($checkbox)));$checkbox.sfFlex({shrink:false}).addClass(checked?"sfpc-checked":"sfpc-unchecked").appendTo($itemWrapper);
var $label=Spotfire.Flex.item().addClass("sf-element sf-element-contextual-popout-label").css("text-overflow","ellipsis").appendTo($itemWrapper);
$label.text(text);$label.attr("title",tooltipText);if(!enabled){$checkbox.addClass("sfpc-disabled");$label.addClass("sfpc-disabled");
}var onClick=function(){if(!$checkbox.hasClass("sfpc-disabled")){if($checkbox.hasClass("sfpc-unchecked")){$checkbox.addClass("sfpc-checked").removeClass("sfpc-unchecked");
}else{$checkbox.addClass("sfpc-unchecked").removeClass("sfpc-checked");}var isChecked=$checkbox.hasClass("sfpc-checked");
if(!isChecked){$checkbox.trigger("close");}callback(isChecked);}return false;};$itemWrapper.on("click",onClick);
return $itemWrapper;}var buildSortSection=function(builder){builder.beginSection().beginRow().addHeading(Spotfire.Localization.resources.TablePlotContextMenu_Sorting,"column"," ",Spotfire.Localization.resources.TablePlotContextMenu_SortingTitle).endRow().beginRow().addRadioTextButton("columnSorting",Spotfire.Localization.resources.TablePlotContextMenu_SortNoneText,Spotfire.Localization.resources.TablePlotContextMenu_SortNone,"None",undefined).addRadioButton("columnSorting","Ascending",{text:Spotfire.Localization.resources.TablePlotContextMenu_SortAsc,title:Spotfire.Localization.resources.TablePlotContextMenu_SortAsc,compactMode:true}).addRadioButton("columnSorting","Descending",{text:Spotfire.Localization.resources.TablePlotContextMenu_SortDesc,title:Spotfire.Localization.resources.TablePlotContextMenu_SortDesc,compactMode:true}).addRadioButton("globalSorting","GlobalAscending",{text:Spotfire.Localization.resources.TablePlotContextMenu_SortAsc,title:Spotfire.Localization.resources.CrossTablePlotContextMenu_GlobalSortAsc,compactMode:true}).addRadioButton("globalSorting","GlobalDescending",{text:Spotfire.Localization.resources.TablePlotContextMenu_SortDesc,title:Spotfire.Localization.resources.CrossTablePlotContextMenu_GlobalSortDesc,compactMode:true}).endRow().endSection();
};var buildWidthSection=function(builder,resizeCallback){builder.beginSection().beginRow(true).addCheckBox("sizeToFit",Spotfire.Localization.resources.TablePlotContextMenu_SizeToFit,undefined,false,resizeCallback,Spotfire.Localization.resources.TablePlotContextMenu_SizeToFitTitle).endRow().beginRow().addNullableField("columnWidth",Spotfire.Localization.resources.TablePlotContextMenu_ColumnWidth,true,Spotfire.Localization.resources.TablePlotContextMenu_ColumnWidthTitle).endRow().endSection();
};var buildTablePlotHorizontalAlignItems=function(builder){builder.beginRow().addRadioButton("headerHorizontalAlign","DataType",{text:Spotfire.Localization.resources.TablePlotContextMenu_ColumnAlignDataType,compactMode:true}).addRadioButton("headerHorizontalAlign","Left",{text:Spotfire.Localization.resources.TablePlotContextMenu_HeaderAlignLeft,compactMode:true}).addRadioButton("headerHorizontalAlign","Center",{text:Spotfire.Localization.resources.TablePlotContextMenu_HeaderAlignCenter,compactMode:true}).addRadioButton("headerHorizontalAlign","Right",{text:Spotfire.Localization.resources.TablePlotContextMenu_HeaderAlignRight,compactMode:true}).endRow();
};var buildCrossTableHorizontalAlignItems=function(builder){builder.beginRow().addRadioButton("headerHorizontalAlign","Left",{text:Spotfire.Localization.resources.TablePlotContextMenu_HeaderAlignLeft,compactMode:true}).addRadioButton("headerHorizontalAlign","Center",{text:Spotfire.Localization.resources.TablePlotContextMenu_HeaderAlignCenter,compactMode:true}).addRadioButton("headerHorizontalAlign","Right",{text:Spotfire.Localization.resources.TablePlotContextMenu_HeaderAlignRight,compactMode:true}).endRow();
};var buildVerticalAlignItems=function(builder){builder.beginRow().addRadioButton("headerVerticalAlign","Top",{text:Spotfire.Localization.resources.TablePlotContextMenu_HeaderAlignTop,compactMode:true}).addRadioButton("headerVerticalAlign","Middle",{text:Spotfire.Localization.resources.TablePlotContextMenu_HeaderAlignMiddle,compactMode:true}).addRadioButton("headerVerticalAlign","Bottom",{text:Spotfire.Localization.resources.TablePlotContextMenu_HeaderAlignBottom,compactMode:true}).endRow();
};var buildTextOrientationItems=function(builder){builder.beginRow().addRadioButton("headerOrientation","Vertical",{text:Spotfire.Localization.resources.TablePlotContextMenu_HeaderOrientationVertical,compactMode:true}).addRadioButton("headerOrientation","Horizontal",{text:Spotfire.Localization.resources.TablePlotContextMenu_HeaderOrientationHorizontal,compactMode:true}).endRow();
};var buildIndvidualHeaderStyleItem=function(builder,args,individualHeaderStyleCallback,tooltip){builder.beginRow().addNode("individualHeaderStyle",addCheckBox("individualHeaderStyle",Spotfire.Localization.resources.TablePlotContextMenu_StyleHeaderIndividually,args.individualHeaderStyleEnabled?tooltip:Spotfire.Localization.resources.TablePlotContextMenu_StyleHeaderIndividuallyDisabledTooltip,args.individualHeaderStyle,args.individualHeaderStyleEnabled,individualHeaderStyleCallback)).endRow();
};var buildValueCellStyleSection=function(builder,args,individualColumnStyleCallback){var checkBoxTooltip=args.individualColumnStyleEnabled?Spotfire.Localization.resources.TablePlotContextMenu_StyleAlignValuesIndividuallyTooltip:Spotfire.Localization.resources.TablePlotContextMenu_StyleHeaderIndividuallyDisabledTooltip;
builder.beginSection().beginRow().addHeading(Spotfire.Localization.resources.TablePlotContextMenu_ColumnAlignValues,"cellValues"," ",Spotfire.Localization.resources.TablePlotContextMenu_ColumnAlignValuesTitle).endRow().beginRow().addRadioButton("columnHorizontalAlign","DataType",{text:Spotfire.Localization.resources.CrossTablePlotContextMenu_ColumnAlignDataType,compactMode:true}).addRadioButton("columnHorizontalAlign","Left",{text:Spotfire.Localization.resources.TablePlotContextMenu_ColumnAlignLeft,compactMode:true}).addRadioButton("columnHorizontalAlign","Center",{text:Spotfire.Localization.resources.TablePlotContextMenu_ColumnAlignCenter,compactMode:true}).addRadioButton("columnHorizontalAlign","Right",{text:Spotfire.Localization.resources.TablePlotContextMenu_ColumnAlignRight,compactMode:true}).endRow().beginRow().addNode("individualColumnStyle",addCheckBox("individualColumnStyle",Spotfire.Localization.resources.TablePlotContextMenu_StyleAlignValuesIndividually,checkBoxTooltip,args.individualColumnStyle,args.individualColumnStyleEnabled,individualColumnStyleCallback)).endRow().endSection();
};var buildTablePlotContextMenu=function(args,builder,resizeCallback,individualHeaderStyleCallback,individualColumnStyleCallback){buildSortSection(builder);
buildWidthSection(builder,resizeCallback);builder.beginSection().beginRow(true).addCheckBox("moveColumnFirst",Spotfire.Localization.resources.TablePlotContextMenu_MoveColumnFirst,undefined,false).endRow().beginRow(true).addCheckBox("moveColumnLast",Spotfire.Localization.resources.TablePlotContextMenu_MoveColumnLast,undefined,false).endRow().endSection();
builder.beginSection().beginRow().addHeading(Spotfire.Localization.resources.TablePlotContextMenu_HeaderSection,"columnHeader"," ",Spotfire.Localization.resources.TablePlotContextMenu_HeaderSectionTitle).endRow();
buildTablePlotHorizontalAlignItems(builder);buildVerticalAlignItems(builder);buildTextOrientationItems(builder);
buildIndvidualHeaderStyleItem(builder,args,individualHeaderStyleCallback,Spotfire.Localization.resources.TablePlotContextMenu_StyleHeaderIndividuallyTooltip);
builder.endSection();buildValueCellStyleSection(builder,args,individualColumnStyleCallback);builder.beginSection().beginRow(true).addCheckBox("hideColumn",Spotfire.Localization.resources.TablePlotContextMenu_HideColumn,undefined,false).endRow().endSection();
};var buildCrossTableContextMenu=function(args,builder,resizeCallback,individualHeaderStyleCallback,individualColumnStyleCallback){builder.beginSection().beginRow(true).addCheckBox("markValuesHorizontal",Spotfire.Localization.resources.TablePlotContextMenu_MarkValues,undefined,false,undefined,Spotfire.Localization.resources.TablePlotContextMenu_MarkValuesTitle).addCheckBox("markValuesVertical",Spotfire.Localization.resources.TablePlotContextMenu_MarkValues,undefined,false,undefined,Spotfire.Localization.resources.TablePlotContextMenu_MarkValuesTitle).endRow().endSection();
buildSortSection(builder);buildWidthSection(builder,resizeCallback);builder.beginSection().beginRow().addHeading(Spotfire.Localization.resources.TablePlotContextMenu_HeaderSection,"columnHeader"," ",Spotfire.Localization.resources.TablePlotContextMenu_HeaderSectionTitle).endRow();
buildCrossTableHorizontalAlignItems(builder);buildVerticalAlignItems(builder);buildTextOrientationItems(builder);
buildIndvidualHeaderStyleItem(builder,args,individualHeaderStyleCallback,Spotfire.Localization.resources.CrossTablePlotContextMenu_StyleHeaderIndividuallyTooltip);
builder.endSection();buildValueCellStyleSection(builder,args,individualColumnStyleCallback);builder.beginSection().beginRow(true).addCheckBox("hideSubtotals",Spotfire.Localization.resources.CrossTablePlotContextMenu_HideAllSubtotals,undefined,false).endRow().endSection();
builder.beginSection().beginRow(true).addCheckBox("hideGrandTotalForRows",Spotfire.Localization.resources.CrossTablePlotContextMenu_HideGrandTotalsForRows,undefined,false).endRow().endSection();
builder.beginSection().beginRow(true).addCheckBox("hideGrandTotalForColumns",Spotfire.Localization.resources.CrossTablePlotContextMenu_HideGrandTotalsForColumns,undefined,false).endRow().endSection();
};var showTableMenu=function(id,args,invokeModifyCallback,resizeCallback){var $popover=$("<div>");var individualHeaderStyle=args.individualHeaderStyle;
var individualColumnStyle=args.individualColumnStyle;var callback=function(name,value,checked){invokeModifyCallback("ContextMenu",{method:name,value:value,checked:checked===true,rowIndex:args.rowIndex,columnIndex:args.columnIndex,individualHeaderStyle:individualHeaderStyle,individualColumnStyle:individualColumnStyle});
};var individualHeaderStyleCallback=function(checked){individualHeaderStyle=checked;invokeModifyCallback("ContextMenu",{method:"individualHeaderStyle",individualHeaderStyle:individualHeaderStyle,rowIndex:args.rowIndex,value:"none",columnIndex:args.columnIndex});
};var individualColumnStyleCallback=function(checked){individualColumnStyle=checked;invokeModifyCallback("ContextMenu",{method:"individualColumnStyle",individualColumnStyle:individualColumnStyle,rowIndex:args.rowIndex,value:"none",columnIndex:args.columnIndex});
};var builder=Spotfire.Visuals.ContextualPopout.builder(id,args,$popover,callback);switch(args.TypeId){case"Spotfire.CrossTable":buildCrossTableContextMenu(args,builder,resizeCallback,individualHeaderStyleCallback,individualColumnStyleCallback);
break;case"Spotfire.Table":buildTablePlotContextMenu(args,builder,resizeCallback,individualHeaderStyleCallback,individualColumnStyleCallback);
break;}if($popover.children().length>0){args.dialogType="styled-dialog";Spotfire.Visuals.ContextualPopout.showPropertiesPopover(id,args,$popover);
}};var show=function(id,args,invokeModify,resizeCallback){switch(args.TypeId){case"Spotfire.CrossTable":showTableMenu(id,args,invokeModify,resizeCallback);
break;case"Spotfire.Table":showTableMenu(id,args,invokeModify,resizeCallback);break;}};Spotfire.Visuals.TableContextualMenu.show=show;
});$(function(){var SELECTION_INDICATION_MODE_ROW=1;var SELECTION_INDICATION_MODE_CELL=2;var clear=function(contentContainer){contentContainer.children(".highlightContainer").empty();
};var internalClear=function(id,contentContainer){if(Spotfire.isProfessional()){Spotfire.Dxp.Web.Forms.AjaxService.Modify(id,"ClearHighlight","");
}clear(contentContainer);};var createHighlightDivString=function(left,top,width,height){return"<div class='tableHighlight' style='transform: translate("+left+"px, "+top+"px);width:"+width+"px; height:"+height+"px'></div>";
};var createHighlightString=function(rect,tableLayout){var top,left,width,height;var leftBound=tableLayout.allowFrozenColumnsInteraction?0:tableLayout.frozenColumnsWidth;
var topBound=tableLayout.frozenRowsHeight;var highlightDivs=[];var divCounter=0;if(tableLayout.selectionIndicationMode===SELECTION_INDICATION_MODE_CELL){var clipRectangle=new Rectangle(leftBound,topBound,tableLayout.viewportSize.width,tableLayout.viewportSize.height);
var highlightRectangle=new Rectangle(rect.left,rect.top,rect.width,rect.height);if(highlightRectangle.intersectsWith(clipRectangle)){highlightRectangle.intersect(clipRectangle);
top=highlightRectangle.y;left=highlightRectangle.x;width=highlightRectangle.width;height=highlightRectangle.height;
left--;top--;highlightDivs[divCounter++]=createHighlightDivString(left,top,width,1);highlightDivs[divCounter++]=createHighlightDivString(left,top,1,height);
highlightDivs[divCounter++]=createHighlightDivString(left+width,top,1,height+1);highlightDivs[divCounter++]=createHighlightDivString(left,top+height,width,1);
}}else{if(tableLayout.selectionIndicationMode===SELECTION_INDICATION_MODE_ROW){top=rect.top;left=0;width=tableLayout.markableArea.width;
height=rect.height;top--;highlightDivs[divCounter++]=createHighlightDivString(left,top,width,1);highlightDivs[divCounter++]=createHighlightDivString(left,top+height,width,1);
}}return highlightDivs.join("");};var render=function(contentContainer,tableLayout,highlightRectangles){var divString="",i,rect;
var length=highlightRectangles.length;for(i=0;i<length;i++){rect=highlightRectangles[i];divString+=createHighlightString(rect,tableLayout);
}var $highlight=contentContainer.children(".highlightContainer");$highlight.empty();$highlight.append($(divString));
};Spotfire.registerNameSpace("Visuals.TableHighlight",{render:render,internalClear:internalClear,clear:clear});
});$(function(){var SELECTION_INDICATION_MODE_ROW=1;var SELECTION_INDICATION_MODE_CELL=2;var allowRelativeLinks=false;
var classFlag={valueCell:1,rowHeader:2,columnHeader:4,totalCell:8,sectionHeader:16,topLeftHeader:32,grandTotalRow:64,grandTotalColumn:128,subtotal:256,level1:512,level2:1024,levelLast:2048,oddColumn:4096,evenColumn:8192,evenRow:16384,oddRow:32768,sectionContent:65536,wrap:131072,textOrientationVertical:262144,selected:524288};
var cellTypes=(function(){var toClasses=function(types){if(!types||types===classFlag.valueCell){return"sfc-value-cell";
}var classes="";if((types&classFlag.valueCell)!==0){classes+=" sfc-value-cell";}if((types&classFlag.rowHeader)!==0){classes+=" sfc-row-header";
}if((types&classFlag.columnHeader)!==0){classes+=" sfc-column-header";}if((types&classFlag.totalCell)!==0){classes+=" sfpc-total-value";
}if((types&classFlag.sectionHeader)!==0){classes+=" sfpc-section-header";}if((types&classFlag.topLeftHeader)!==0){classes+=" sfc-top-left-header";
}if((types&classFlag.grandTotalRow)!==0){classes+=" sfc-grand-total-row";}if((types&classFlag.grandTotalColumn)!==0){classes+=" sfc-grand-total-column";
}if((types&classFlag.subtotal)!==0){classes+=" sfc-subtotal";}if((types&classFlag.level1)!==0){classes+=" sfpc-level-1";
}if((types&classFlag.level2)!==0){classes+=" sfpc-level-2";}if((types&classFlag.levelLast)!==0){classes+=" sfpc-level-last";
}if((types&classFlag.oddColumn)!==0){classes+=" sfpc-odd-column";}if((types&classFlag.evenColumn)!==0){classes+=" sfpc-even-column";
}if((types&classFlag.evenRow)!==0){classes+=" sfpc-even-row";}if((types&classFlag.oddRow)!==0){classes+=" sfpc-odd-row";
}if((types&classFlag.sectionContent)!==0){classes+=" sfpc-section-content";}if((types&classFlag.wrap)!==0){classes+=" sfc-wrap";
}if((types&classFlag.textOrientationVertical)!==0){classes+=" textOrientationDirection-vertical";}if((types&classFlag.selected)!==0){classes+=" sfpc-selected";
}return classes;};return{toClasses:toClasses};}());var updateGradients=function(tableLayout,container,leftPos,scrollSize,viewportWidth,canvas,frozenRowsCanvas){var gradientWidth=6;
var max=Math.max(0,scrollSize.width-viewportWidth);var gradientPositionRight=Math.min(gradientWidth,Math.max(0,max-leftPos))-gradientWidth;
var gradientPositionLeft=Math.max(-gradientWidth,Math.min(0,leftPos-gradientWidth));var $gradient=$("<div class='sf-element-table-gradient' style='position:absolute; top: 0' />");
$gradient.css("width",gradientWidth+"px");var $leftGradient=$gradient.clone().addClass("sfpc-left");var $rightGradient=$gradient.clone().addClass("sfpc-right");
var $leftContentGradient=$(".sf-element-table-gradient.sfpc-left",canvas.parent());if($leftContentGradient.length===0){$leftContentGradient=$leftGradient.clone();
$leftContentGradient.insertAfter(canvas);}var $leftHeaderGradient=$(".sf-element-table-gradient.sfpc-left",frozenRowsCanvas.parent());
if($leftHeaderGradient.length===0){$leftHeaderGradient=$leftGradient.clone();$leftHeaderGradient.insertAfter(frozenRowsCanvas);
}$leftContentGradient.css("left",gradientPositionLeft+"px");$leftHeaderGradient.css("left",gradientPositionLeft+"px");
var $rightContentGradient=$(".sf-element-table-gradient.sfpc-right",canvas.parent());if($rightContentGradient.length===0){$rightContentGradient=$rightGradient.clone();
$rightContentGradient.insertAfter(canvas);}var $rightHeaderGradient=$(".sf-element-table-gradient.sfpc-right",frozenRowsCanvas.parent());
if($rightHeaderGradient.length===0){$rightHeaderGradient=$rightGradient.clone();$rightHeaderGradient.insertAfter(frozenRowsCanvas);
}$rightContentGradient.css("right",gradientPositionRight+"px");$rightHeaderGradient.css("right",gradientPositionRight+"px");
$leftContentGradient.height(container.parent().height());$rightContentGradient.height(container.parent().height());
$rightHeaderGradient.height(frozenRowsCanvas.parent().height());$leftHeaderGradient.height(frozenRowsCanvas.parent().height());
};var hasHorizontalScrollbar=function(tableLayout){return tableLayout.scrollBounds.width+tableLayout.frozenColumnsWidth>tableLayout.viewportSize.width;
};var computeScrollSize=function(tableLayout,scrollbarWidth){var remainder=Math.ceil(tableLayout.rowHeight/2);
var scrollWidth=tableLayout.scrollBounds.width+tableLayout.frozenColumnsWidth;var scrollHeight=tableLayout.scrollBounds.height+tableLayout.frozenRowsHeight+remainder;
var showHorizontalScrollbar=hasHorizontalScrollbar(tableLayout);var showVerticalScrollbar=scrollHeight>tableLayout.viewportSize.height;
scrollWidth+=showVerticalScrollbar?scrollbarWidth:0;scrollHeight+=showHorizontalScrollbar?scrollbarWidth:0;
return new Size(scrollWidth,scrollHeight);};var getScrollbarWidth=function($container){var mockDocumentElement=document.createElement("div");
var testElement=document.createElement("div");testElement.style.position="absolute";testElement.style.left="0px";
testElement.style.top="0px";testElement.style.height="100px";testElement.style.width="100px";testElement.style.overflowY="scroll";
mockDocumentElement.appendChild(testElement);$container.append(mockDocumentElement);var scrollbar=$(testElement).StyledScrollbar({cssClass:"TablePlotScroll"});
var width=scrollbar.getVScrollbarSize(true);scrollbar.destroy();$(mockDocumentElement).remove();return width;
};var setFont=function(element,jsonFont){if(jsonFont){element.css("font-family",jsonFont.fontFamily);
element.css("font-size",jsonFont.fontSize);element.css("font-style",jsonFont.fontStyle);element.css("font-weight",jsonFont.fontWeight);
element.css("line-height",jsonFont.lineHeight);}};var renderLayout=function(id,tableLayout){var valueCellsContainerSize={width:tableLayout.viewportSize.width-tableLayout.frozenColumnsWidth,height:tableLayout.viewportSize.height-tableLayout.frozenRowsHeight};
var scrollContainer=$("<div name='scrollContainer' style='position:absolute; overflow: auto; left:0px; top:0px'></div>");
scrollContainer.css("width",tableLayout.viewportSize.width+"px");scrollContainer.css("height",tableLayout.viewportSize.height+"px");
var scrolledElement=$("<div name='scrolledElement' style='position:absolute'></div>");scrolledElement.css("left","0");
scrolledElement.css("top","0");scrollContainer.append(scrolledElement);var canvasContainer=$("<div name='canvasContainer' style='position:absolute; overflow: hidden;'></div>");
canvasContainer.css("top",tableLayout.frozenRowsHeight+"px");canvasContainer.css("left",tableLayout.frozenColumnsWidth+"px");
canvasContainer.css("width",valueCellsContainerSize.width+"px");canvasContainer.css("height",valueCellsContainerSize.height+"px");
var canvas=$("<div style='position:absolute; overflow: visible'></div>");canvasContainer.append(canvas);
var frozenRowsContainer=$("<div name='frozenRowsContainer' style='position:absolute; overflow: hidden;'></div>");
frozenRowsContainer.css("top","0");frozenRowsContainer.css("left",tableLayout.frozenColumnsWidth+"px");
frozenRowsContainer.css("width",valueCellsContainerSize.width+"px");frozenRowsContainer.css("height",tableLayout.frozenRowsHeight+"px");
var frozenRowsCanvas=$("<div name='frozenRowsCanvas' style='position:absolute; overflow: visible'></div>");
frozenRowsContainer.append(frozenRowsCanvas);var frozenColumnsContainer=$("<div name='frozenColumnsContainer' style='position:absolute; overflow: hidden'></div>");
frozenColumnsContainer.css("top",tableLayout.frozenRowsHeight+"px");frozenColumnsContainer.css("left","0");
frozenColumnsContainer.css("width",tableLayout.frozenColumnsWidth+"px");frozenColumnsContainer.css("height",valueCellsContainerSize.height+"px");
var frozenColumnsCanvas=$("<div name='frozenColumnsCanvas' style='position:absolute; overflow: visible'></div>");
frozenColumnsContainer.append(frozenColumnsCanvas);var topLeftCornerCanvas=$("<div name='topLeftCornerCanvas' style='position:absolute;'></div>");
topLeftCornerCanvas.css("width",tableLayout.frozenColumnsWidth+"px");topLeftCornerCanvas.css("height",tableLayout.frozenRowsHeight+"px");
var contentContainer=$("<div name='contentContainer' style='position:absolute; overflow: hidden; left:0px; top:0px; cursor: default'></div>");
contentContainer.css("width",tableLayout.viewportSize.width+"px");contentContainer.css("height",tableLayout.viewportSize.height+"px");
if(tableLayout.css){Spotfire.StyleManager.updateOverrideCss(contentContainer,tableLayout.css);}else{setFont(contentContainer,tableLayout.tableFont);
}contentContainer.append(canvasContainer);contentContainer.append(frozenColumnsContainer);contentContainer.append(frozenRowsContainer);
contentContainer.append(topLeftCornerCanvas);return{scrollContainer:scrollContainer,contentContainer:contentContainer,canvas:canvas,frozenRowsCanvas:frozenRowsCanvas,frozenColumnsCanvas:frozenColumnsCanvas,topLeftCornerCanvas:topLeftCornerCanvas};
};var renderSortedHeader=function(cell){var sortImage="";switch(cell.sort){case"up":sortImage="Images/Plots/TablePlot/TableUpArrow.gif";
break;case"down":sortImage="Images/Plots/TablePlot/TableDownArrow.gif";break;case"left":sortImage="Images/Plots/TablePlot/TableLeftArrow.gif";
break;case"right":sortImage="Images/Plots/TablePlot/TableRightArrow.gif";break;}var sortDirection="vertical";
switch(cell.sort){case"left":case"right":sortDirection="horizontal";break;}var position=sortDirection==="vertical"?"right: 2px; bottom: 3px;":"right: 2px; top: 4px;";
var imageDiv="<img sort='"+cell.sort+"' src='"+sortImage+"' alt='sort order' style='position: absolute; "+position+"'>";
return imageDiv;};var getRotatedBackgroundAlign=function(align,verticalAlign){switch(verticalAlign){case"top":align="right";
break;case"center":align="center";break;case"bottom":align="left";break;}return align;};var getRotatedBackgroundVerticalAlign=function(align,verticalAlign){switch(align){case"left":verticalAlign="top";
break;case"center":verticalAlign="center";break;case"right":verticalAlign="bottom";break;}return verticalAlign;
};var getImageHtml=function(cell){var align=(cell.hasOwnProperty("align")&&cell.align!=="")?cell.align:"right";
var verticalAlign=(cell.hasOwnProperty("valign")&&cell.valign!=="")?((cell.valign==="middle")?"center":cell.valign):"center";
if((cell.cellTypes&classFlag.textOrientationVertical)!==0){var tempAlign=getRotatedBackgroundAlign(align,verticalAlign);
verticalAlign=getRotatedBackgroundVerticalAlign(align,verticalAlign);align=tempAlign;}var backgroundImage="background-repeat: no-repeat; background-image: url('"+cell.imageUrl+"');";
var imageAlign=align+" "+verticalAlign;backgroundImage+="background-position: "+imageAlign+";";return'<div style="width:100%;height:100%;'+backgroundImage+'"></div>';
};var renderCell=function(htmlArr,cell,offset){var backgroundColor="";if(cell.hasOwnProperty("bgColor")&&cell.bgColor!==null&&cell.bgColor!==""){backgroundColor="background-color: "+cell.bgColor+";";
}var color="";if(cell.hasOwnProperty("color")&&cell.color!==null&&cell.color!==""){color="color: "+cell.color+";";
}var textAlign="";var justifyContent="";if(cell.hasOwnProperty("align")&&cell.align!==""){if(cell.align==="left"){justifyContent="flex-justify-start ";
}else{if(cell.align==="right"){justifyContent="flex-justify-end ";}else{if(cell.align==="center"){justifyContent="flex-justify-center ";
}}}textAlign="text-align: "+cell.align+";";}else{justifyContent="flex-justify-end ";}var alignItems="";
if(cell.hasOwnProperty("valign")&&cell.valign!==""){if(cell.valign==="top"){alignItems="flex-align-start ";
}else{if(cell.valign==="middle"){alignItems="flex-align-center ";}else{if(cell.valign==="bottom"){alignItems="flex-align-end ";
}}}}else{alignItems="flex-align-center ";}var cellText=(cell.hasOwnProperty("text")&&cell.text!==null)?cell.text:"";
if(cell.hasOwnProperty("link")&&cell.link){var link=cell.link.uri;if(Spotfire.isWebPlayer()){if(!cell.link.isAbsolute&&!allowRelativeLinks){link="http://"+link;
}}cellText='<a href="'+link+'" target="_blank">'+cellText+"</a>";}var cellContentStyle=textAlign.length===0?"":" style='"+textAlign+"'";
var cellContent="<div class='cell-text'"+cellContentStyle+">"+cellText+"</div>";if(cell.hasOwnProperty("imageUrl")){cellContent=getImageHtml(cell);
}var verticalSortArrow=false;if(cell.hasOwnProperty("sort")){cellContent=cellContent+renderSortedHeader(cell);
if(cell.sort==="up"||cell.sort==="down"){verticalSortArrow=true;}}var key="";if(cell.hasOwnProperty("key")&&cell.key){key="id = '"+cell.key+"'";
}var actionClass="";if(cell.hasOwnProperty("actionEnabled")&&cell.actionEnabled){actionClass=" actionCell";
}var border="";if(cell.hasOwnProperty("hideBorder")&&cell.hideBorder){border="border-color: transparent;";
}var font="";if(cell.hasOwnProperty("fontFamily")&&cell.fontFamily){font+="font-family: "+cell.fontFamily+";";
}if(cell.hasOwnProperty("fontSize")&&cell.fontSize){font+="font-size: "+cell.fontSize+";";}if(cell.hasOwnProperty("fontStyle")&&cell.fontStyle){font+="font-style: "+cell.fontStyle+";";
}if(cell.hasOwnProperty("fontWeight")&&cell.fontWeight){font+="font-weight: "+cell.fontWeight+";";}if(cell.hasOwnProperty("lineHeight")&&cell.lineHeight){font+="line-height: "+cell.lineHeight+";";
}htmlArr.push("<div ");htmlArr.push(key);htmlArr.push(' style="');if(font!==""){htmlArr.push(font);}if(border!==""){htmlArr.push(border);
}if(color!==""){htmlArr.push(color);}if(backgroundColor!==""){htmlArr.push(backgroundColor);}if(verticalSortArrow){htmlArr.push("padding-right: 11px;");
}var posCanvas=new Point(cell.b[0]-offset.x,cell.b[1]-offset.y);htmlArr.push("left: ");htmlArr.push(posCanvas.x);
htmlArr.push("px; top: ");htmlArr.push(posCanvas.y);htmlArr.push("px; width: ");htmlArr.push(cell.b[2]);
htmlArr.push("px; height: ");htmlArr.push(cell.b[3]);htmlArr.push("px;");htmlArr.push("\" class='sf-element-table-cell ");
htmlArr.push(justifyContent);htmlArr.push(alignItems);htmlArr.push(cellTypes.toClasses(cell.cellTypes));
if(actionClass!==""){htmlArr.push(actionClass);}htmlArr.push("'");htmlArr.push(">");htmlArr.push(cellContent);
htmlArr.push("</div>");};var renderCellsInternetExplorer=function(cells,$canvas,offset){var keys=[];var keyIndex=0;
var i,cell,column,htmlArr,colOffset,strCell,left;var columns=[];for(i=0;i<cells.length;i++){htmlArr=[];
cell=cells[i];left=cell.b[0];column=columns[left];if(!column){column={};column.cell=[];column.left=left-offset.x;
column.top=cell.b[1]-offset.y;columns[left]=column;}colOffset={x:offset.x+column.left,y:offset.y+column.top};
renderCell(htmlArr,cell,colOffset);strCell=htmlArr.join("");column.cell.push(strCell);if(cell.key){keys[keyIndex]=cell.key;
keyIndex++;}}var $part=$("<div name='column' style='position:absolute'></div>");var key;var $column;for(key in columns){if(columns.hasOwnProperty(key)){column=columns[key];
$column=$("<div style='position:absolute;'></div>");$column.css({left:column.left,top:column.top});$column.get(0).innerHTML=column.cell.join("");
$part.append($column);}}$canvas.append($part);return keys;};var renderCells=function(cells,$canvas,offset,renderedHeaderBounds){var htmlArr=[];
var keys=[];var keyIndex=0,cellBounds,isRendered=false;var i,cell,intersection;for(i=0;i<cells.length;
i++){cell=cells[i];if(renderedHeaderBounds){cellBounds=new Rectangle(cell.b[0],cell.b[1],cell.b[2],cell.b[3]);
intersection=cellBounds.intersect(renderedHeaderBounds);isRendered=intersection&&intersection.height>0&&intersection.width>0;
}if(!isRendered){renderCell(htmlArr,cell,offset);if(cell.key){keys[keyIndex]=cell.key;keyIndex++;}}}var cellContainer=document.createElement("div");
cellContainer.style.position="absolute";cellContainer.innerHTML=htmlArr.join("");$canvas.append(cellContainer);
return keys;};var displayErrors=function(viewport,messages,font){var messagesDiv=$("<div style='visibility: hidden; text-align:center; position: absolute; top: 0px'></div>");
var i,message,messageDiv;for(i=0;i<messages.length;i++){message=messages[i];messageDiv=$("<div style='word-wrap: break-word; visibility: visible; text-align:center; position: relative; top: 0px'></div>");
messageDiv.text(message);setFont(messageDiv,font[i]);messagesDiv.append(messageDiv);}messagesDiv.css("width",viewport.width()+"px");
viewport.append(messagesDiv);var top=viewport.height()/2-messagesDiv.height()/2;messagesDiv.css("top",top+"px");
messagesDiv.css("visibility","visible");};var getAdaptedColumnWidth=function($cells,maxColumnWidth){$cells.each(function(){var $item=$(this);
$item.after($item.clone().addClass("measure-cell").css({position:"absolute",visibility:"hidden"}));});
var maxWidth=0;$(".measure-cell").each(function(){maxWidth=Math.max(maxWidth,$(this).width());});$(".measure-cell").remove();
return Math.round(Math.min(maxWidth,maxColumnWidth));};var computeColumnResize=function(x,viewport,viewportRect,maxColumnWidth,isFrozenColumn){var verifyClass;
if(isFrozenColumn){verifyClass=function(cell){return cell.hasClass("sfc-row-header")||cell.hasClass("sfpc-level-last");
};}else{verifyClass=function(cell){return cell.hasClass("sfpc-level-last")||(cell.hasClass("sfc-grand-total-column")||cell.hasClass("sfc-value-cell"));
};}var columnX=x-5;var columnCells=viewport.find(".cell-text").filter(function(){var cell=$(this).parent();
var cellOffset=cell.offset();var cellRect=new Rectangle(cellOffset.left,cellOffset.top,cell.width(),cell.height());
var ok=!cell.hasClass("sf-element-rotated-cell")&&(cellOffset.left<=columnX&&(cellOffset.left+cell.outerWidth())>columnX)&&verifyClass(cell)&&cellRect.bottom()>=viewportRect.top()&&cellRect.top()<=viewportRect.bottom();
return ok;});if(columnCells.length===0){return 0;}var originalWidth=columnCells.first().parent().width();
var newWidth=getAdaptedColumnWidth(columnCells,maxColumnWidth)+1;return newWidth-originalWidth;};function TableInstance(id,layoutGeneration,tableType){var tableLayout=null;
var scrollContainer;var contentContainer;var canvas;var frozenRowsCanvas;var frozenColumnsCanvas;var topLeftCornerCanvas;
var pendingResizeToFit;var virtualScrollbar;var getLayout=null;var isMouseOver=null;var model;var latestHighlightGeneration=-1;
var tooltipDelay=350;if(Spotfire.Web!==undefined){tooltipDelay=Spotfire.Web.tooltipDelay;allowRelativeLinks=Spotfire.Web.allowRelativeLinks;
}var viewport=$("#"+id);viewport.css("width","100%");viewport.css("height","100%");var progressTimer=null;
var scrollbarWidth=getScrollbarWidth(viewport);function getViewportPos(e){var offset=viewport.offset();
return new Point(Math.round(e.pageX-offset.left),Math.round(e.pageY-offset.top));}function getValueCellTablePos(x,y){var offset=viewport.offset();
var documentPos=model.getScrollPosition();var viewPortPos=new Point(Math.round(x-offset.left),Math.round(y-offset.top));
var xPos=viewPortPos.x+documentPos.x;var yPos=viewPortPos.y+documentPos.y;return new Point(Math.round(xPos),Math.round(yPos));
}function getTablePos(x,y){var offset=viewport.offset();var documentPos=model.getScrollPosition();var viewPortPos=new Point(Math.round(x-offset.left),Math.round(y-offset.top));
var xPos=(viewPortPos.x<tableLayout.frozenColumnsWidth)?viewPortPos.x:viewPortPos.x+documentPos.x;var yPos=(viewPortPos.y<tableLayout.frozenRowsHeight)?viewPortPos.y:viewPortPos.y+documentPos.y;
return new Point(Math.round(xPos),Math.round(yPos));}function getTablePosFromEvent(e){return getTablePos(e.pageX,e.pageY);
}var handleProgress=function(){var showProgress=function(){if(!jQuery.contains(document,viewport[0])){return;
}Progress.showPlotOverlay(id);progressTimer=null;};if(progressTimer===null){progressTimer=window.setTimeout(showProgress,1000);
}};var clearProgress=function(){if(progressTimer!==null){window.clearTimeout(progressTimer);progressTimer=null;
}};var visibleValueCellRows=function(){var visibleRows=Math.floor((tableLayout.viewportSize.height-tableLayout.frozenRowsHeight-scrollbarWidth)/tableLayout.rowHeight);
return visibleRows<1?1:visibleRows;};var pageScrollSize=function(){var visibleRows=visibleValueCellRows();
var rowsToScroll=visibleRows===1?1:visibleRows-1;return{width:Math.abs(tableLayout.viewportSize.width-tableLayout.frozenColumnsWidth-scrollbarWidth),height:rowsToScroll*tableLayout.rowHeight};
};var handleKeyScroll=function(keyDownArgs){var keys={Up:38,Down:40,Left:37,Right:39,PageUp:33,PageDown:34,Home:36,End:35,Space:32};
var x=virtualScrollbar.scrollLeft();var y=virtualScrollbar.scrollTop();switch(keyDownArgs.keyCode){case keys.PageUp:y-=pageScrollSize().height;
break;case keys.PageDown:y+=pageScrollSize().height;break;case keys.Home:if(keyDownArgs.ctrlKey){y=0;
}else{x=0;}break;case keys.End:if(keyDownArgs.ctrlKey){y=Math.max(0,tableLayout.scrollBounds.height);
}else{x=Math.max(0,tableLayout.scrollBounds.width);}break;case keys.Left:x-=20;break;case keys.Right:x+=20;
break;case keys.Up:y-=20;break;case keys.Down:y+=20;break;default:return;}virtualScrollbar.scrollTop(y);
virtualScrollbar.scrollLeft(x);};var getPendingValueCallback=function(response){if(!response){return;
}var cell=$("#"+response.key,viewport);if(cell.length===1){if(response.text){$(".cell-text",cell).text(response.text);
}else{cell.text("");}if(response.color){cell.css("color",response.color);}else{cell.css("color","");}if(response.fontStyle){cell.css("font-style",response.fontStyle);
}else{cell.css("font-style","");}if(response.fontWeight){cell.css("font-weight",response.fontWeight);
}else{cell.css("font-weight","");}}model.getNextPendingValue(getPendingValueCallback);};var resizeToFit=function(){if(!tableLayout.allowColumnResize){return;
}var offset=viewport.offset();var viewportRect=new Rectangle(offset.left,offset.top,viewport.width()*2,viewport.height());
var $topLeftHeaders=topLeftCornerCanvas.find(".sf-element-table-cell");var $grandTotalHeaders=frozenRowsCanvas.find(".sf-element-table-cell.sfc-grand-total-column");
var $valueCellHeaders=frozenRowsCanvas.find(".sf-element-table-cell.sfpc-level-last");var columnWidths=[];
$topLeftHeaders.each(function(){var x=$(this).offset().left+10;var delta=computeColumnResize(x,viewport,viewportRect,tableLayout.maxColumnWidth,true);
if(delta!==0){columnWidths.push({x:getTablePos(x,0).x,deltaWidth:delta});}});$grandTotalHeaders.each(function(){var x=$(this).offset().left+10;
var delta=computeColumnResize(x,viewport,viewportRect,tableLayout.maxColumnWidth,false);if(delta!==0){columnWidths.push({x:getValueCellTablePos(x,0).x,deltaWidth:delta});
}});$valueCellHeaders.each(function(){var x=$(this).offset().left+10;var delta=computeColumnResize(x,viewport,viewportRect,tableLayout.maxColumnWidth,false);
if(delta!==0){columnWidths.push({x:getValueCellTablePos(x,0).x,deltaWidth:delta});}});var totalWidthChange=0;
$.each(columnWidths,function(index,item){totalWidthChange+=item.deltaWidth;});var needToGetMoreCells=!(totalWidthChange>=0||pendingResizeToFit||!hasHorizontalScrollbar(tableLayout));
if(needToGetMoreCells){var viewportFunc=function(){var valueCellViewport=model.getValueCellsViewport();
pendingResizeToFit=true;var valueCellViewportWide=new Rectangle(valueCellViewport.x,valueCellViewport.y,valueCellViewport.width*2,valueCellViewport.height);
if(valueCellViewportWide.right()>tableLayout.scrollBounds.width){valueCellViewportWide.x=Math.floor(valueCellViewport.x-(valueCellViewportWide.right()-tableLayout.scrollBounds.width));
}return valueCellViewportWide;};if(model.getCells(viewportFunc)){pendingResizeToFit=true;return;}}pendingResizeToFit=false;
if(columnWidths.length>0){model.modify("ResizeColumnWidths",{columns:columnWidths});}};var renderTablePart=function(cellType,partCells,partCanvas,offset,renderedHeaderBounds){if(partCells===undefined||partCells===null){return;
}if(partCells.renderAction==="replace"){partCanvas.empty();}var newKeys=null;if(cellType==="headers"){newKeys=renderCells(partCells.cells,partCanvas,offset,renderedHeaderBounds);
}else{if(cellType==="values"){newKeys=renderCellsInternetExplorer(partCells.cells,partCanvas,offset);
}}if(newKeys&&newKeys.length>0){model.addPendingValueKeys(newKeys);model.getNextPendingValue(getPendingValueCallback);
}};var setCanvasPos=function(pos){Spotfire.Visuals.Tooltip.hide();viewport.removeData("toolTipScrollPosition");
var offsets=model.getRenderOffsets();var canvasLeft=-(pos.x-offsets.valueCells.x);var canvasTop=-(pos.y-offsets.valueCells.y);
var frozenRowsLeft=-(pos.x-offsets.frozenRows.x);var frozenColumnsTop=-(pos.y-offsets.frozenColumns.y);
canvas.css("transform","translate("+canvasLeft+"px,"+canvasTop+"px)");frozenRowsCanvas.css("transform","translate("+frozenRowsLeft+"px,0px)");
frozenColumnsCanvas.css("transform","translate(0px,"+frozenColumnsTop+"px)");contentContainer.trigger("renderMarking");
contentContainer.trigger("renderMovingHeader");contentContainer.trigger("renderHighlight");};var setScrollbarVisible=function(visible){if(scrollContainer.parent().length===0){return;
}if(scrollbarWidth===0){return;}var scrollSize=computeScrollSize(tableLayout,scrollbarWidth);var barWidth=visible?scrollbarWidth:0;
if(scrollContainer.width()<scrollSize.width){contentContainer.css("height",(tableLayout.viewportSize.height-barWidth)+"px");
}if(scrollContainer.height()<scrollSize.height){contentContainer.css("width",(tableLayout.viewportSize.width-barWidth)+"px");
}var scrollBarElement=scrollContainer.parent();scrollBarElement.css("visibility",visible?"visible":"hidden");
};var onScroll=function(e,direction){if(direction==="horizontal"){updateGradients(tableLayout,scrollContainer,virtualScrollbar.scrollLeft(),virtualScrollbar.scrollSize(),tableLayout.viewportSize.width,canvas,frozenRowsCanvas);
}var pos=new Point(virtualScrollbar.scrollLeft(),virtualScrollbar.scrollTop());var snappedPos=model.onScroll(pos);
if(snappedPos!==null){setCanvasPos(snappedPos);}};var hideScrollbar=function(){if(scrollContainer.parent().length===0){return;
}var styledScroll=scrollContainer.StyledScrollbar();if(styledScroll&&styledScroll.isScrolling()){return;
}if(tableLayout.autoHideTableScrollbars){setScrollbarVisible(false);}};var showScrollbar=function(){if(tableLayout.autoHideTableScrollbars){setScrollbarVisible(true);
}};var clearRightClickIndication=function(rightClickPoint){if(contentContainer===undefined){return;}var rightClickData=contentContainer.data("rightClickData");
if(rightClickData!==undefined&&rightClickData!==null){var point=rightClickData.clickPoint;if(point!==undefined&&point!==null&&rightClickPoint!==undefined&&rightClickPoint!==null){if(point.x===rightClickPoint.x&&point.y===rightClickPoint.y){rightClickData.cell.css("background-color",rightClickData.backgroundColor);
}}else{rightClickData.cell.css("background-color",rightClickData.backgroundColor);}}};var eventHandlerScope=function(){var mouseButtons=Spotfire.Visuals.CanvasVisualization.MouseButtons;
var getCell=function(eventArgs){return $(eventArgs.target).closest(".sf-element-table-cell");};var viewportOffset=function(){return viewport.offset();
};var onMouseLeaveViewport=function(e){var offset=viewportOffset();var rect=new Rectangle(offset.left,offset.top,viewport.width(),viewport.height());
if(!rect.containsPoint(e.pageX,e.pageY)||(e.relatedTarget&&!$(e.relatedTarget).parent().hasClass("Tooltip"))){Spotfire.Visuals.Tooltip.hide();
viewport.data("tooltip",false);viewport.removeData("toolTipScrollPosition");}if(rect.containsPoint(e.pageX,e.pageY)){return;
}if(mouseButtons.which()===1){return;}Spotfire.Visuals.TableHighlight.internalClear(id,contentContainer);
hideScrollbar();};var handleKeyDown=function(e){var invoke=false;switch(e.keyCode){case Keys.UP:case Keys.DOWN:case Keys.LEFT:case Keys.RIGHT:case Keys.PAGEUP:case Keys.PAGEDOWN:case Keys.HOME:case Keys.END:case Keys.SPACE:case Keys.F1:invoke=true;
break;}if(invoke){var keyDownArgs={keyCode:e.keyCode,shiftKey:e.shiftKey,ctrlKey:e.ctrlKey};model.modify("KeyDown",keyDownArgs);
}};var getValueCell=function(eventArgs){return $(eventArgs.target).closest(".sfc-value-cell");};var getHeaderCell=function(eventArgs){var $cell=$(eventArgs.target).closest(".sf-element-table-cell");
if(!$cell.hasClass("sfc-value-cell")&&($cell.hasClass("sfc-column-header")||$cell.hasClass("sfc-row-header"))){return $cell;
}return $();};var isOnVerticalHeaderBorder=function(eventArgs){var headerCell=getHeaderCell(eventArgs);
if(headerCell.length===0){return false;}var x=eventArgs.pageX;var leftBorder=headerCell.offset().left;
var rightBorder=leftBorder+headerCell.outerWidth();return(x>(rightBorder-3)||x<(leftBorder+3));};var isOnHorizontalHeaderBorder=function(eventArgs){var headerCell=getHeaderCell(eventArgs);
if(headerCell.length===0){return false;}var y=eventArgs.pageY;var topBorder=headerCell.offset().top;var bottomBorder=topBorder+headerCell.outerHeight();
return(y>(bottomBorder-3)||y<(topBorder+3));};var isFarLeftBorder=function(x){return(x-viewportOffset().left)<7;
};var isTopBorder=function(y){return(y-viewportOffset().top)<7;};var isBottomBorder=function(y){return(y-viewportOffset().top)>tableLayout.frozenRowsHeight+7;
};var createRectangleFromPoints=function(startPoint,endPoint){var left=Math.min(startPoint.x,endPoint.x);
var top=Math.min(startPoint.y,endPoint.y);var right=Math.max(startPoint.x,endPoint.x);var bottom=Math.max(startPoint.y,endPoint.y);
return new Rectangle(left,top,right-left,bottom-top);};var calculateScrollDelta=function(delta){delta=Math.min(100,delta);
delta=(10+delta*(delta/10));return delta;};var createMarkingRectangle=function(){var markingRectangle=$("<div/>").addClass("sf-element-table-marking-rect");
if(tableLayout.selectionIndicationMode===SELECTION_INDICATION_MODE_CELL){markingRectangle.css({"border-left":"1px solid","border-right":"1px solid"});
}markingRectangle.hide();return markingRectangle;};var createResizeIndicator=function(pos,size,verticalBorder){var left=verticalBorder?pos:1;
var top=verticalBorder?1:pos;var width=verticalBorder?1:size.width;var height=verticalBorder?size.height:1;
var resizeIndicator=$("<div style='position:absolute; background: red;'></div>").css({top:top+"px",left:left+"px",width:width+"px",height:height+"px"});
left=verticalBorder?-10:0;top=verticalBorder?0:-10;width=verticalBorder?20:size.width;height=verticalBorder?size.height:20;
var cursor=verticalBorder?"e-resize":"n-resize";$("<div style='position:absolute;'></div>").css({top:top+"px",left:left+"px",width:width+"px",height:height+"px",cursor:cursor}).appendTo(resizeIndicator);
return resizeIndicator;};var createHeaderIndicator=function(clickedHeader){var headerIndicator=clickedHeader.clone();
headerIndicator.attr("id","HeaderIndicator");headerIndicator.css({border:"solid 1px #909090",visibility:"hidden"});
return headerIndicator;};var createPositionIndicator=function(x,y,height){var headerPositionIndicator=$("<div style='position:absolute; overflow: hidden; background: red;'></div>");
headerPositionIndicator.css({top:y+"px",left:x+"px",width:"1px",height:height+"px",visibility:"hidden"});
return headerPositionIndicator;};var isLeafHeader=function(e){var pageX=e.pageX-5;var $headers=frozenRowsCanvas.find(".sfc-column-header").filter(function(){var cell=$(this);
var cellOffset=cell.offset();return cellOffset.left<=pageX&&(cellOffset.left+cell.outerWidth())>pageX;
});if($headers.length>1){var $leafHeader=null;$headers.each(function(){if($leafHeader===null||$leafHeader.offset().top<$(this).offset().top){$leafHeader=$(this);
}});if(e.pageY>=$leafHeader.offset().top){return true;}return false;}return true;};var handleAdaptColumnWidth=function(e){if(!tableLayout.allowColumnResize||isFarLeftBorder(e.pageX)){return;
}if(!isLeafHeader(e)){return;}var pageX=e.pageX-5;var offset=viewport.offset();var viewportRect=new Rectangle(offset.left,offset.top,viewport.width(),viewport.height());
var tablePos=getTablePos(pageX,e.pageY);var isFrozenColumn=tablePos.x<=tableLayout.frozenColumnsWidth;
var delta=computeColumnResize(pageX,viewport,viewportRect,tableLayout.maxColumnWidth,isFrozenColumn);
if(delta!==0){model.modify("ResizeColumnWidth",{x:tablePos.x,y:tablePos.y,deltaWidth:Math.round(delta),allColumns:false});
}};var getVisiblePartOfCell=function($cell){var cellRectangle=new Rectangle($cell.offset().left,$cell.offset().top,$cell.outerWidth(),$cell.outerHeight());
var $clipElement;var $parents=$cell.parents();$parents.each(function(index,element){var $el=$(element);
if($el.css("overflow")==="hidden"){$clipElement=$el;return false;}return true;});var clipRectangle=new Rectangle($clipElement.offset().left,$clipElement.offset().top,$clipElement.outerWidth(),$clipElement.outerHeight());
cellRectangle.clip(clipRectangle);return cellRectangle;};var showContextMenu=function(e,visiblePartOfCell,args){args=_.extend(args,{x:visiblePartOfCell.right,y:visiblePartOfCell.top,rectangle:visiblePartOfCell,alignment:["Left","Right","Bottom","Top"]});
var modifyCallback=function(method,args){model.modify(method,args);};var resizeCallback=function(){handleAdaptColumnWidth(e);
};Spotfire.Visuals.TableContextualMenu.show(id,args,modifyCallback,resizeCallback);};var handleHeaderClicked=function(e){var point=getTablePosFromEvent(e);
var clickData={x:point.x,y:point.y,shiftKey:e.shiftKey,ctrlKey:e.ctrlKey,altKey:e.altKey};var $cell=getHeaderCell(e);
if($cell.length===0){return;}var visiblePartOfCell=getVisiblePartOfCell($cell);var onGetContextMenu=function(args){if(!args.hasOwnProperty("enabled")){model.modify("CellClicked",clickData);
return;}showContextMenu(e,visiblePartOfCell,args);};if(clickData.shiftKey||clickData.altKey||clickData.ctrlKey){model.modify("CellClicked",clickData);
}else{model.read("GetContextMenu",clickData,onGetContextMenu);}};var handleMarking=function(e){var abortMarking=false;
if(e.target&&e.target.nodeName==="A"){abortMarking=true;}var anchorPoint=getTablePosFromEvent(e);var currentLocalPoint=getViewportPos(e);
var bounds;var ctrlKey=e.ctrlKey||(e.metaKey===undefined?false:e.metaKey);var shiftKey=e.shiftKey;var altKey=e.altKey;
var markingRectangle=createMarkingRectangle();contentContainer.append(markingRectangle);var markableBounds=new Rectangle(tableLayout.markableArea);
var isOutsideBounds=false;var scrollWhileMarkingTimeout;function scrollWhileMarking(){var delta;var scrollTop=virtualScrollbar.scrollTop();
if(currentLocalPoint.y>bounds.bottom()){delta=calculateScrollDelta(currentLocalPoint.y-bounds.bottom());
virtualScrollbar.scrollTop(scrollTop+delta);}else{if(currentLocalPoint.y<bounds.top()){delta=calculateScrollDelta(bounds.top()-currentLocalPoint.y);
virtualScrollbar.scrollTop(scrollTop-delta);}}var scrollLeft=virtualScrollbar.scrollLeft();if(currentLocalPoint.x>bounds.right()){delta=calculateScrollDelta(currentLocalPoint.x-bounds.right());
virtualScrollbar.scrollLeft(scrollLeft+delta);}else{if(currentLocalPoint.x<bounds.left()){delta=calculateScrollDelta(bounds.left()-currentLocalPoint.x);
virtualScrollbar.scrollLeft(scrollLeft-delta);}}scrollWhileMarkingTimeout=setTimeout(scrollWhileMarking,20);
}var renderMarkingRectangle=function(){var documentOffset=model.getScrollPosition();var endPoint=new Point(currentLocalPoint.x+documentOffset.x,currentLocalPoint.y+documentOffset.y);
var currentRectangle=createRectangleFromPoints(anchorPoint,endPoint);currentRectangle.offset(-documentOffset.x,-documentOffset.y);
if(!currentRectangle.intersectsWith(markableBounds)||abortMarking){markingRectangle.hide();return;}markingRectangle.show();
currentRectangle.clip(markableBounds);var markingX=tableLayout.selectionIndicationMode===SELECTION_INDICATION_MODE_ROW?tableLayout.markableArea.x:currentRectangle.x;
var markingWidth=tableLayout.selectionIndicationMode===SELECTION_INDICATION_MODE_ROW?Math.min(tableLayout.markableArea.width,contentContainer.outerWidth()):currentRectangle.width;
markingRectangle.css({left:markingX+"px",top:currentRectangle.y+"px",width:markingWidth+"px",height:currentRectangle.height+"px"});
};var mouseMove=function(event){currentLocalPoint=getViewportPos(event);if(anchorPoint.equals(getTablePosFromEvent(event))){return;
}abortMarking=false;var documentOffset=model.getScrollPosition();var viewportBounds=new Rectangle(0,0,tableLayout.viewportSize.width,tableLayout.viewportSize.height);
bounds=viewportBounds.clone().intersect(markableBounds);if(bounds.containsPoint(currentLocalPoint.x,currentLocalPoint.y)||(documentOffset.x===0&&currentLocalPoint.x<bounds.left())||(documentOffset.y===0&&currentLocalPoint.y<bounds.top())){if(isOutsideBounds){isOutsideBounds=false;
clearTimeout(scrollWhileMarkingTimeout);}renderMarkingRectangle();}else{if(!isOutsideBounds){isOutsideBounds=true;
scrollWhileMarking();}}};var mouseUpMarking=function(event){clearTimeout(scrollWhileMarkingTimeout);contentContainer.unbind("renderMarking");
markingRectangle.sfRemoveAsync();var endPoint=getTablePosFromEvent(event);var rect=createRectangleFromPoints(anchorPoint,endPoint);
rect.clip(markableBounds);if(abortMarking){return;}if(anchorPoint.equals(getTablePosFromEvent(event))){return;
}var marking={shiftKey:shiftKey,ctrlKey:ctrlKey,altKey:altKey,left:Math.round(rect.left()),top:Math.round(rect.top()),right:Math.round(rect.right()),bottom:Math.round(rect.bottom())};
model.modify("Mark",marking);};contentContainer.bind("renderMarking",renderMarkingRectangle);Spotfire.Touch.legacyTouchMouseCapture(contentContainer,mouseMove,mouseUpMarking);
};var handleMoveColumn=function(e,clickedHeader){var offset=viewportOffset();if(e.pageY-offset.top>tableLayout.frozenRowsHeight){return;
}var initialScrollLeft=model.getScrollPosition().x;var scrollLeft=initialScrollLeft;var uninteractiveFrozenColumnsWidth=tableLayout.nonMovableColumnsWidth;
var interactiveFrozenColumnsWidth=tableLayout.allowFrozenColumnsInteraction?tableLayout.frozenColumnsWidth:0;
var clickLocalX=e.pageX-offset.left;var clickX=clickLocalX+scrollLeft;var mouseX=clickX;if(clickX<uninteractiveFrozenColumnsWidth){return;
}var currentLocalLeft=clickedHeader.offset().left-offset.left;var currentLocalRight=currentLocalLeft+clickedHeader.outerWidth();
var leftBorder=currentLocalLeft+scrollLeft;var rightBorder=leftBorder+clickedHeader.outerWidth();var headerIndicator=createHeaderIndicator(clickedHeader);
contentContainer.append(headerIndicator);var newPositionIndicator=createPositionIndicator(currentLocalLeft,0,clickedHeader.outerHeight());
viewport.append(newPositionIndicator);var isOutsideBounds=false;var scrollWhileMovingHeaderTimeout;var leftViewBound;
var rightViewBound;function scrollWhileMovingHeader(){var newScrollLeft;if(mouseX>rightViewBound){var scrollRightDelta=calculateScrollDelta(mouseX-rightViewBound);
newScrollLeft=virtualScrollbar.scrollLeft()+scrollRightDelta;virtualScrollbar.scrollLeft(newScrollLeft);
}else{if(mouseX<leftViewBound){var scrollLeftDelta=calculateScrollDelta(leftViewBound-mouseX);newScrollLeft=virtualScrollbar.scrollLeft()-scrollLeftDelta;
virtualScrollbar.scrollLeft(newScrollLeft);}}scrollWhileMovingHeaderTimeout=setTimeout(scrollWhileMovingHeader,20);
}var renderMovingHeader=function(){headerIndicator.css({left:(leftBorder-scrollLeft)+(mouseX-clickX)+"px",visibility:"visible"});
var initialClick=(mouseX-scrollLeft<interactiveFrozenColumnsWidth)||clickLocalX<interactiveFrozenColumnsWidth?clickLocalX:clickX-scrollLeft;
var indicatorLeft=(mouseX-scrollLeft)-initialClick<0?currentLocalLeft:currentLocalRight;newPositionIndicator.css("left",indicatorLeft+"px");
var isWithinCell=(mouseX<=rightBorder&&mouseX>=leftBorder);if(clickLocalX<interactiveFrozenColumnsWidth){isWithinCell=(mouseX-scrollLeft)<=(rightBorder-initialScrollLeft)&&(mouseX-scrollLeft)>=(leftBorder-initialScrollLeft);
}if(isWithinCell||(interactiveFrozenColumnsWidth>0&&currentLocalLeft<interactiveFrozenColumnsWidth&&(mouseX-scrollLeft)>=interactiveFrozenColumnsWidth)||(uninteractiveFrozenColumnsWidth>0&&currentLocalLeft<uninteractiveFrozenColumnsWidth)){headerIndicator.css({opacity:"0.2",filter:"alpha(opacity = 20)"});
newPositionIndicator.css("visibility","hidden");}else{headerIndicator.css({opacity:"1.0",filter:"alpha(opacity = 100)"});
newPositionIndicator.css("visibility","visible");}};var mouseMoveHeader=function(event){offset=viewportOffset();
var cell=getValueCell(event);if(cell.length===0){var localMouseX=mouseX-scrollLeft;var container=(interactiveFrozenColumnsWidth>0&&localMouseX<interactiveFrozenColumnsWidth)?frozenColumnsCanvas:contentContainer;
container.find(".sf-element-table-cell").each(function(){var left=$(this).offset().left-offset.left;if(left<localMouseX&&localMouseX<left+$(this).outerWidth()&&!($(this).hasClass("sfpc-section-header"))){if($(this).attr("id")!=="HeaderIndicator"){cell=$(this);
return false;}}return true;});}if(cell.length>0){currentLocalLeft=cell.offset().left-offset.left;currentLocalRight=currentLocalLeft+cell.outerWidth();
}scrollLeft=model.getScrollPosition().x;mouseX=event.pageX+scrollLeft-offset.left;leftViewBound=scrollLeft;
rightViewBound=leftViewBound+tableLayout.viewportSize.width;if(mouseX>leftViewBound&&mouseX<rightViewBound){if(isOutsideBounds){isOutsideBounds=false;
clearTimeout(scrollWhileMovingHeaderTimeout);}renderMovingHeader();}else{if(!isOutsideBounds){isOutsideBounds=true;
scrollWhileMovingHeader();}}};var mouseUpHeader=function(){clearTimeout(scrollWhileMovingHeaderTimeout);
contentContainer.unbind("renderMovingHeader");headerIndicator.sfRemoveAsync();newPositionIndicator.sfRemoveAsync();
if(mouseX-clickX!==0){if((interactiveFrozenColumnsWidth>0&&currentLocalLeft<interactiveFrozenColumnsWidth&&(mouseX-scrollLeft)>interactiveFrozenColumnsWidth)||(uninteractiveFrozenColumnsWidth>0&&currentLocalLeft<uninteractiveFrozenColumnsWidth)){return;
}if(clickLocalX<interactiveFrozenColumnsWidth){clickX=clickLocalX;}if(mouseX-scrollLeft<interactiveFrozenColumnsWidth){mouseX-=scrollLeft;
}var moveColumn={fromX:Math.round(clickX),toX:Math.round(mouseX)};model.modify("MoveColumn",moveColumn);
}};contentContainer.bind("renderMovingHeader",renderMovingHeader);Spotfire.Touch.legacyTouchMouseCapture(clickedHeader,mouseMoveHeader,mouseUpHeader);
};var handleResizeColumn=function(e,verticalBorder){var clickPos=getTablePosFromEvent(e);var headerCell=getHeaderCell(e);
var firstBorder=verticalBorder?headerCell.offset().left:headerCell.offset().top;var secondBorder=verticalBorder?firstBorder+headerCell.outerWidth():firstBorder+headerCell.outerHeight();
var initialBrowserMousePos=verticalBorder?e.pageX:e.pageY;var columnBorder;if(initialBrowserMousePos>(secondBorder-5)){columnBorder=secondBorder;
}else{columnBorder=firstBorder;}var viewportOffsetBorder=verticalBorder?viewportOffset().left:viewportOffset().top;
var initialLocalBorderPos=columnBorder-viewportOffsetBorder;var resizeIndicator=createResizeIndicator(initialLocalBorderPos,tableLayout.viewportSize,verticalBorder);
var resizeIndicatorTimeout=setTimeout(function delayCreateResizeIndicator(){viewport.append(resizeIndicator);
},200);var mouseMove=function(event){var currentBrowserMousePos=verticalBorder?event.pageX:event.pageY;
var pos=initialLocalBorderPos+(currentBrowserMousePos-initialBrowserMousePos);if(verticalBorder){resizeIndicator.css("left",pos+"px");
}else{resizeIndicator.css("top",pos+"px");}};var mouseUp=function(event){clearTimeout(resizeIndicatorTimeout);
resizeIndicator.remove();var delta=verticalBorder?(event.pageX-initialBrowserMousePos):(event.pageY-initialBrowserMousePos);
if(delta===0){return;}if(verticalBorder){var x=clickPos.x-5;var resizeColumnWidth={x:x,y:clickPos.y,deltaWidth:Math.round(delta),allColumns:event.ctrlKey};
model.modify("ResizeColumnWidth",resizeColumnWidth);}else{var offset=viewportOffset();var resizeRowHeight={y:Math.round(initialBrowserMousePos-offset.top),deltaHeight:Math.round(delta)};
model.modify("ResizeRowHeight",resizeRowHeight);}};Spotfire.Touch.legacyTouchMouseCapture(headerCell,mouseMove,mouseUp);
};var rightMouseButtonDown=function(e){if(Spotfire.isProfessional()){var $viewPort=$("#"+id);var offset=$viewPort.offset();
var point=new Point(Math.round(e.pageX-offset.left),Math.round(e.pageY-offset.top));if(tableLayout.allowRightClickIndication){var adjustCellColor=function(color){var safeColor=new Spotfire.Utilities.SafeColor(color);
safeColor.adjustBrightness(safeColor.luminance()>0.3?-30:30);return safeColor.toHexString();};var valueCell=getValueCell(e);
if(valueCell.length>0){clearRightClickIndication();var backgroundColor=valueCell.css("background-color");
valueCell.css("background-color",adjustCellColor(backgroundColor));var rightClickData={cell:valueCell,clickPoint:point,backgroundColor:backgroundColor};
contentContainer.data("rightClickData",rightClickData);}}model.modify("RightClick",point);}};var getResizeCursor=function(e){if(tableLayout.allowColumnResize&&isOnVerticalHeaderBorder(e)&&!isFarLeftBorder(e.pageX)){return"e-resize";
}if(tableLayout.allowFrozenRowResize&&isOnHorizontalHeaderBorder(e)&&!isTopBorder(e.pageY)&&!isBottomBorder(e.pageY)){return"n-resize";
}if(tableLayout.allowRowResize&&isOnHorizontalHeaderBorder(e)&&!isTopBorder(e.pageY)){return"n-resize";
}return"";};var isResize=function(e){return getResizeCursor(e).length!==0;};var leftMouseButtonDown=function(e){var headerCell=getHeaderCell(e);
if(headerCell.length===0){if(tableLayout.allowMarking){handleMarking(e);}}else{if(isResize(e)){var verticalBorderResize=isOnVerticalHeaderBorder(e)&&!isFarLeftBorder(e.pageX);
handleResizeColumn(e,verticalBorderResize);}else{if(tableLayout.allowMoveHeaders){handleMoveColumn(e,headerCell);
}}}};var handleMouseDown=function(e){if(e.which===1){leftMouseButtonDown(e);}};var throttledHighlight=_.throttle(function(point){model.modify("Highlight",point);
},100);var handleHighlight=function(currentTargetNode){if(!currentTargetNode){return;}var targetNodeOffset=currentTargetNode.offset();
var newTop=targetNodeOffset.top-viewportOffset().top;var newLeft=targetNodeOffset.left-viewportOffset().left;
if(Spotfire.isProfessional()){newTop+=1;var documentOffset=model.getScrollPosition();var x=newLeft+1+documentOffset.x;
var y=newTop+1+documentOffset.y;var highlightPoint=new Point(Math.round(x),Math.round(y));throttledHighlight(highlightPoint);
}else{if(Spotfire.isWebPlayer()){var width,height;if(tableLayout.selectionIndicationMode===SELECTION_INDICATION_MODE_ROW){width=tableLayout.markableArea.width;
height=tableLayout.rowHeight;}else{width=currentTargetNode.outerWidth();height=currentTargetNode.outerHeight();
}Spotfire.Visuals.TableHighlight.render(contentContainer,tableLayout,[{top:newTop,left:newLeft,width:width,height:height}]);
}}};var mouseOverPoint;var tooltipTimeout=null;var getTooltipCallback=function(tooltip){if(!tooltip){return;
}if(!viewport.data("tooltip")){return;}var savedScrollPosition=viewport.data("toolTipScrollPosition");
var currentScrollPosition=model.getScrollPosition();if(savedScrollPosition===undefined||savedScrollPosition===null||!savedScrollPosition.equals(currentScrollPosition)){return;
}var mouseOverCellPosition=contentContainer.data("mouseOverCellPosition");if(mouseOverCellPosition){Spotfire.Visuals.Tooltip.showHtml(tooltip);
contentContainer.data("toolTipCellPosition",mouseOverCellPosition);}else{contentContainer.removeData("toolTipCellPosition");
}};var handleTooltip=function(e){var getTooltip=function(){if(!viewport.data("tooltip")){return;}var offset=getTablePosFromEvent(e);
var args={x:offset.x,y:offset.y};viewport.data("toolTipScrollPosition",model.getScrollPosition());model.read("GetTooltip",args,getTooltipCallback);
};window.clearTimeout(tooltipTimeout);tooltipTimeout=setTimeout(getTooltip,tooltipDelay);};var handleMouseOver=function(e){if(!(mouseButtons.which()===3||mouseButtons.which()===1)){var point=new Point(e.pageX,e.pageY);
if(mouseOverPoint!==undefined&&point.equals(mouseOverPoint)){return false;}var isMarking=$(".sf-element-table-marking-rect").is(":visible");
if(tableLayout.allowHighlight&&!isMarking){var targetNode=getValueCell(e);if(targetNode.length>0){handleHighlight(targetNode,point);
}else{Spotfire.Visuals.TableHighlight.internalClear(id,contentContainer);}}var cell=getCell(e);if(cell.length>0){contentContainer.data("mouseOverCellPosition",cell.offset());
mouseOverPoint=point;handleTooltip(e);}else{contentContainer.removeData("mouseOverCellPosition");}}return true;
};var startedScrolling=false;var scrollDeltaY=0;var scrollDeltaX=0;var doMouseWheelScroll=function(){var scrollTop=virtualScrollbar.scrollTop();
virtualScrollbar.scrollTop(scrollTop+scrollDeltaY);var scrollLeft=virtualScrollbar.scrollLeft();virtualScrollbar.scrollLeft(scrollLeft+scrollDeltaX);
startedScrolling=false;scrollDeltaY=0;scrollDeltaX=0;};var handleScrollWheel=function(event){Spotfire.Visuals.TableHighlight.internalClear(id,contentContainer);
Spotfire.Visuals.Tooltip.hide();var verticalScroll;if(tableLayout.mouseWheelScrollLines<0){verticalScroll=pageScrollSize().height;
}else{verticalScroll=tableLayout.mouseWheelScrollLines*tableLayout.rowHeight;}var horizontalScroll;if(tableLayout.mouseWheelScrollLines<0){horizontalScroll=Math.abs(tableLayout.viewportSize.width-tableLayout.frozenColumnsWidth);
}else{horizontalScroll=tableLayout.mouseWheelScrollLines*tableLayout.rowHeight;}scrollDeltaY+=event.scrollWheelY*verticalScroll;
scrollDeltaX+=event.scrollWheelX*horizontalScroll;if(!startedScrolling){setTimeout(doMouseWheelScroll,10);
startedScrolling=true;}};var mouseMoveOnContentContainer=function(e){var cell=getCell(e);if(cell.length===0){Spotfire.Visuals.Tooltip.hide();
}else{var toolTipCellPosition=contentContainer.data("toolTipCellPosition");var pos=cell.offset();if(!toolTipCellPosition||pos.left!==toolTipCellPosition.left||pos.top!==toolTipCellPosition.top){Spotfire.Visuals.Tooltip.hide();
}}if(mouseButtons.which()===1){return;}var headerCell=getHeaderCell(e);headerCell.css("cursor",getResizeCursor(e));
};var attach=function(){viewport.unbind();viewport.hover(function(){isMouseOver=true;},function(){isMouseOver=false;
});viewport.mouseenter(showScrollbar);viewport.mouseenter(function(){viewport.data("tooltip",true);});
viewport.mouseleave(onMouseLeaveViewport);Spotfire.Focus.handleKeyDown(viewport,handleKeyDown);scrollContainer.mouseenter(function(){Spotfire.Visuals.TableHighlight.internalClear(id,contentContainer);
});contentContainer.on("sf-touchmousedown",function(event){Spotfire.Visuals.TableHighlight.internalClear(id,contentContainer);
if(event.target&&event.target.nodeName==="A"){return;}var pagePos={x:event.pageX,y:event.pageY};$(window).one("sf-touchmouseup",null,pagePos,function(e){if(e.which===3){rightMouseButtonDown(e);
}else{if(e.which===1){var mouseHasMoved=e.data.x!==e.pageX||e.data.y!==e.pageY;var headerClicked=getHeaderCell(event).length!==0;
if(headerClicked){if((!tableLayout.allowMoveHeaders||!mouseHasMoved)&&!isResize(e)){handleHeaderClicked(e);
}}else{if(!mouseHasMoved){var $clickedValueCell=getValueCell(e);if(tableLayout.allowMarking){var point=getTablePosFromEvent(e);
var marking={left:point.x,top:point.y,right:point.x,bottom:point.y,shiftKey:e.shiftKey,ctrlKey:e.ctrlKey,altKey:e.altKey};
model.modify("Mark",marking);}else{if($clickedValueCell.length>0){var pos=getTablePos($clickedValueCell.offset().left,$clickedValueCell.offset().top);
var cellClickItem={x:pos.x,y:pos.y,shiftKey:e.shiftKey,ctrlKey:e.ctrlKey,altKey:e.altKey};model.modify("CellClicked",cellClickItem);
}}}}}}});});if(!Spotfire.capabilities.supportsTouch()){contentContainer.mousedown(handleMouseDown);}else{contentContainer.on("sf-touchhold",function(eHold){handleMouseDown(eHold);
Touch.showTouchHoldImage(eHold.pageX,eHold.pageY);Touch.clickBlocker();Spotfire.Visuals.CanvasVisualization.Dragging.begin({mouseMove:function(eMove){eMove.stopPropagation();
Touch.moveTouchHoldImage(eMove.pageX,eMove.pageY);},mouseUp:function(){Touch.removeTouchHoldImage();}},contentContainer);
});}contentContainer.dblclick(function(e){if(isOnVerticalHeaderBorder(e)&&tableLayout.allowAdjustColumnWidth){handleAdaptColumnWidth(e);
}return true;});if(!Spotfire.capabilities.supportsTouch()){contentContainer.mouseover(handleMouseOver);
}contentContainer.mousemove(mouseMoveOnContentContainer);if(!Spotfire.capabilities.supportsTouch()){contentContainer.scrollwheel(handleScrollWheel);
}};return attach;};var attachEvents=eventHandlerScope();var renderCallback=function(response,renderedBounds){Spotfire.Visuals.TableTiming.begin("HtmlRender");
var scrollPos=model.getScrollPosition();var offsets=model.getRenderOffsets();renderTablePart("values",response.valueCells,canvas,offsets.valueCells);
var frozenRowsRenderedBounds=null;var frozenColumnsRenderedBounds=null;if(renderedBounds){frozenRowsRenderedBounds=new Rectangle(renderedBounds.x,0,renderedBounds.width,tableLayout.frozenRowsHeight);
frozenColumnsRenderedBounds=new Rectangle(0,renderedBounds.y,tableLayout.frozenColumnsWidth,renderedBounds.height);
}renderTablePart("headers",response.frozenRowsCells,frozenRowsCanvas,offsets.frozenRows,frozenRowsRenderedBounds);
renderTablePart("headers",response.frozenColumnsCells,frozenColumnsCanvas,offsets.frozenColumns,frozenColumnsRenderedBounds);
renderTablePart("headers",response.topLeftCornerCells,topLeftCornerCanvas,new Point(0,0),null);setCanvasPos(scrollPos);
if(scrollContainer.parent().length===0){var scrollSize=computeScrollSize(tableLayout,scrollbarWidth);
var isTouch=Spotfire.capabilities.supportsTouch();var viewportSize=new Size(tableLayout.viewportSize.width,tableLayout.viewportSize.height);
virtualScrollbar=isTouch?Spotfire.Table.VirtualScrollbar.create(viewportSize,scrollSize,scrollbarWidth,scrollContainer,contentContainer):Spotfire.Control.VirtualScroller.create();
if(!isTouch){virtualScrollbar.update(scrollSize,viewportSize);}viewport.empty();var $hightlightContainer=$("<div class='highlightContainer' style='position:absolute; overflow: visible'></div>");
contentContainer.append($hightlightContainer);viewport.append(scrollContainer);viewport.append(contentContainer);
if((getLayout.pendingCall===true||getLayout.pendingResponse===true)){Progress.showPlotOverlay(id);}else{clearProgress();
}var styledScrollbar=scrollContainer.StyledScrollbar({cssClass:"TablePlotScroll "+tableType,lineSize:function(){return tableLayout.rowHeight;
},pageSize:pageScrollSize(),virtualScroller:Spotfire.capabilities.supportsTouch()?undefined:virtualScrollbar});
styledScrollbar.scrollend(function(){if(isMouseOver!==null&&!isMouseOver){hideScrollbar();}});virtualScrollbar.scrollTop(scrollPos.y);
virtualScrollbar.scrollLeft(scrollPos.x);if(Spotfire.capabilities.supportsTouch()){scrollContainer.bind("virtualScroll",onScroll);
}else{virtualScrollbar.onScroll(onScroll);}setScrollbarVisible(tableLayout.autoHideTableScrollbars?(isMouseOver!==null&&isMouseOver):true);
updateGradients(tableLayout,scrollContainer,virtualScrollbar.scrollLeft(),virtualScrollbar.scrollSize(),tableLayout.viewportSize.width,canvas,frozenRowsCanvas);
}if(viewport[0]){Spotfire.Visuals.TablePlot.Text.rotate(viewport[0].querySelectorAll(".textOrientationDirection-vertical"));
Spotfire.Visuals.TablePlot.Text.applyWordWrap(viewport[0].querySelectorAll(".sfc-wrap:not(.sfc-value-cell) .cell-text:not(.sf-element-text-overflow-check)"),true);
Spotfire.Visuals.TablePlot.Text.applyWordWrap(viewport[0].querySelectorAll(".sfc-value-cell.sfc-wrap .cell-text:not(.sf-element-text-overflow-check)"));
}if(pendingResizeToFit){resizeToFit();}Spotfire.Visuals.TableTiming.end("HtmlRender");Spotfire.Visuals.TableTiming.end("Total");
Spotfire.Visuals.TableTiming.render(viewport);};var getLayoutCallback=function(layout){Spotfire.Visuals.TableTiming.end("getLayoutRequest");
if(tableLayout!==null&&tableLayout.generation>layout.generation){return;}viewport.width(layout.viewportSize.width);
viewport.height(layout.viewportSize.height);if(layout.isError){viewport.empty();setFont(viewport,layout.font);
displayErrors(viewport,layout.messages,layout.font);clearProgress();return;}tableLayout=layout;pendingResizeToFit=false;
var render=renderLayout(id,tableLayout);scrollContainer=render.scrollContainer;canvas=render.canvas;frozenRowsCanvas=render.frozenRowsCanvas;
frozenColumnsCanvas=render.frozenColumnsCanvas;topLeftCornerCanvas=render.topLeftCornerCanvas;contentContainer=render.contentContainer;
if(model){model.dispose();}var highLatency=Spotfire.capabilities.supportsTouch();model=Spotfire.Visuals.TablePlotModel.create(id,tableLayout,highLatency,renderCallback,scrollbarWidth,computeScrollSize(tableLayout,scrollbarWidth));
attachEvents();};getLayout=function(generation){if(Spotfire.isProfessional()){var handleRightClick=function(e){if(Spotfire.Touch.rightMouseButtonDown(e)){var $viewPort=$("#"+id);
var offset=$viewPort.offset();var objArgs=new Point(Math.round(e.pageX-offset.left),Math.round(e.pageY-offset.top));
objArgs.generation=generation;var args=JSON.stringify(objArgs);Spotfire.Dxp.Web.Forms.AjaxService.Modify(id,"RightClick",args);
return false;}return true;};viewport.unbind("mousedown.rightclickfallback").bind("mousedown.rightclickfallback",handleRightClick);
}Spotfire.Visuals.TableTiming.begin("getLayoutRequest");getLayout.generation=generation;var requestEnd=function(){getLayout.pendingResponse=false;
if(getLayout.pendingCall===true){getLayout.pendingCall=false;getLayout(getLayout.generation);}};var cb=function(value){requestEnd();
getLayoutCallback(value);};if(getLayout.pendingResponse===false){getLayout.pendingResponse=true;var clientData={scrollbarWidth:scrollbarWidth,generation:generation};
Spotfire.Dxp.Web.Forms.AjaxService.Read(id,"GetLayout",JSON.stringify(clientData),cb,requestEnd);}else{getLayout.pendingCall=true;
}};var update=function(layoutGen,viewportSize){Spotfire.Visuals.TableTiming.begin("Total");viewport.width(viewportSize.width);
viewport.height(viewportSize.height);handleProgress();getLayout(layoutGen);};var updateHighlight=function(ensureVisible,highlightGeneration){if(!tableLayout){return;
}latestHighlightGeneration=highlightGeneration;var documentOffset=model.getScrollPosition();var visibleBounds={x:documentOffset.x,y:documentOffset.y,width:tableLayout.viewportSize.width,height:tableLayout.viewportSize.height,highlightGeneration:highlightGeneration};
var getHighlightedCellBoundsCallback=function(args){var callbackGeneration=args.highlightGeneration;if(callbackGeneration!==latestHighlightGeneration){return;
}var highlightedCellBounds=args.highlightedCellBounds;var renderHighlight=function(){documentOffset=model.getScrollPosition();
var highlightRectangles=[];var i,cellBounds,left,top,width,height;for(i=0;i<highlightedCellBounds.length;
i++){cellBounds=highlightedCellBounds[i];left=cellBounds.x-documentOffset.x;top=cellBounds.y-documentOffset.y;
width=cellBounds.width;height=cellBounds.height;highlightRectangles.push({left:left,top:top,width:width,height:height});
}Spotfire.Visuals.TableHighlight.render(contentContainer,tableLayout,highlightRectangles);};if(highlightedCellBounds.length===0){Spotfire.Visuals.TableHighlight.clear(contentContainer);
contentContainer.unbind("renderHighlight");return;}var cellTop=highlightedCellBounds[0].y;var cellHeight=highlightedCellBounds[0].height;
if(ensureVisible&&(cellTop<visibleBounds.y||cellTop+cellHeight>visibleBounds.y+visibleBounds.height)){contentContainer.unbind("renderHighlight");
contentContainer.bind("renderHighlight",renderHighlight);if(cellTop<visibleBounds.y){virtualScrollbar.scrollTop(cellTop-tableLayout.frozenRowsHeight);
}else{var scrollTop=cellTop-(visibleBounds.height-cellHeight)-tableLayout.frozenRowsHeight+cellHeight;
virtualScrollbar.scrollTop(scrollTop);}}else{var callbackDocumentOffset=model.getScrollPosition();if(!callbackDocumentOffset.equals(documentOffset)){return;
}renderHighlight();}};if(visibleBounds.width>0&&visibleBounds.height>0){if(ensureVisible){var totalBounds={x:tableLayout.markableArea.x,y:tableLayout.markableArea.y,width:tableLayout.markableArea.width,height:tableLayout.markableArea.height,highlightGeneration:highlightGeneration};
model.read("GetHighlight",totalBounds,getHighlightedCellBoundsCallback);}else{model.read("GetHighlight",visibleBounds,getHighlightedCellBoundsCallback);
}}};this.clearRightClickIndication=clearRightClickIndication;this.handleKeyScroll=handleKeyScroll;this.update=update;
this.resizeToFit=resizeToFit;this.updateHighlight=updateHighlight;handleProgress();getLayout.pendingCall=false;
getLayout.pendingResponse=false;getLayout(layoutGeneration);}(function(){var getTable=function(id){var viewport=$("#"+id);
return viewport.data("TablePlot");};var update=function(id,layoutGeneration,viewportSize){var table=getTable(id);
if(table){table.update(layoutGeneration,viewportSize);}};var updateHighlight=function(id,ensureVisible,generation){if(Spotfire.isProfessional()){var table=getTable(id);
if(table){table.updateHighlight(ensureVisible,generation);}}};var handleKeyScroll=function(id,keyDownArgs){var table=getTable(id);
if(table){table.handleKeyScroll(keyDownArgs);}};var clearRightClickIndication=function(id,rightClickPoint){var table=getTable(id);
table.clearRightClickIndication(rightClickPoint);};var resizeToFit=function(id){var table=getTable(id);
table.resizeToFit();};var initialize=function(id,layoutGeneration,tableType){var table=new TableInstance(id,layoutGeneration,tableType);
$("#"+id).data("TablePlot",table);};var copyCellValue=function(cell){var container=$("<div></div>").css({overflow:"hidden",height:"100%"});
var $input=$("<textarea readonly/>");$input.val(cell.text);container.append($input);var buttons=[{text:Spotfire.Localization.resources.Close,isDefault:true}];
var options={title:Spotfire.Localization.resources.Table_CopyCellValue,modal:true,resizable:true,buttons:buttons,width:300,height:180,minWidth:300,minHeight:180};
Spotfire.Controls.ModalDialog.initialize(container,options);$input.css({width:"100%",height:"100%",resize:"none","box-sizing":"border-box"}).select();
};Spotfire.registerNameSpace("Visuals.TablePlot",{update:update,updateHighlight:updateHighlight,handleKeyScroll:handleKeyScroll,clearRightClickIndication:clearRightClickIndication,resizeToFit:resizeToFit,copyCellValue:copyCellValue,initialize:initialize});
}());});$(function(){var addRectangles=function(a,b){var c=new Rectangle(0,0,0,0);if(a.intersectsWith(b)){var intersection=new Rectangle(a).intersect(b);
if(a.x===b.x&&a.width===b.width){c.x=a.x;c.y=Math.min(a.y,b.y);c.width=a.width;c.height=a.height+b.height-intersection.height;
}else{if(a.y===b.y&&a.height===b.height){c.x=Math.min(a.x,b.x);c.y=a.y;c.width=a.width+b.width-intersection.width;
c.height=a.height;}}}return c;};var snapToRow=function(rowHeight,newPos){var row=Math.floor(newPos.y/rowHeight);
var remainder=newPos.y-row*rowHeight;row+=Math.round(remainder/rowHeight);var pos=new Point(newPos.x,row*rowHeight);
return pos;};var forceScrollBounds=function(tableLayout,scrollSize,scrollbarWidth){var scrollWidth=scrollSize.width;
var scrollHeight=scrollSize.height;var hasHorizontalScrollbar=scrollWidth>tableLayout.viewportSize.width;
var hasVerticalScrollbar=scrollHeight>tableLayout.viewportSize.height;scrollWidth=hasVerticalScrollbar?scrollWidth+scrollbarWidth:scrollWidth;
scrollHeight=hasHorizontalScrollbar?scrollHeight+scrollbarWidth:scrollHeight;var maxScrollX=Math.max(0,scrollWidth-tableLayout.viewportSize.width);
var maxScrollY=Math.max(0,scrollHeight-tableLayout.viewportSize.height);if(!hasVerticalScrollbar){maxScrollY=0;
}if(!hasHorizontalScrollbar){maxScrollX=0;}if(maxScrollY!==0){maxScrollY=snapToRow(tableLayout.rowHeight,new Point(0,maxScrollY)).y;
}var x=Math.min(maxScrollX,tableLayout.scrollPosition.x);var y=snapToRow(tableLayout.rowHeight,tableLayout.scrollPosition).y;
y=Math.min(maxScrollY,y);var point=new Point(x,y);return point;};function TableModel(id,tableLayout,highLatency,renderCallback,scrollbarWidth,scrollSize){var valueCellsViewportSize={width:Math.max(0,tableLayout.viewportSize.width-tableLayout.frozenColumnsWidth),height:Math.max(0,tableLayout.viewportSize.height-tableLayout.frozenRowsHeight)};
var isDisposed=false;var getCellsPending=false;var getCellsTimeout=null;var scrollPosition=forceScrollBounds(tableLayout,scrollSize,scrollbarWidth);
var requestedSnappedPos=scrollPosition.clone();var scrollbarPos=scrollPosition.clone();var scrollDirection="none";
var needToGetTopLeftCells=true;var valueCellsBounds=new Rectangle(0,0,0,0);var renderOffsets={};renderOffsets.valueCells=scrollPosition.clone();
renderOffsets.frozenRows=new Point(renderOffsets.valueCells.x,0);renderOffsets.frozenColumns=new Point(0,renderOffsets.valueCells.y);
var pendingValueKeys=[];var addPendingValueKeys=function(newKeys){pendingValueKeys=pendingValueKeys.concat(newKeys);
};var clearPendingValueKeys=function(){pendingValueKeys=[];};var dispose=function(){isDisposed=true;clearPendingValueKeys();
renderCallback=null;};var read=function(method,objArgs,callback){if(getCellsPending&&(method==="GetHighlight"||method==="GetTooltip")){return;
}if(!objArgs){objArgs={};}objArgs.generation=tableLayout.generation;Spotfire.Dxp.Web.Forms.AjaxService.Read(id,method,JSON.stringify(objArgs),callback);
};var getNextPendingValue=function(callback){if(pendingValueKeys.length>0){read("GetPendingValue",{key:pendingValueKeys.shift()},callback);
}};var getScrollPosition=function(){return scrollPosition.clone();};var modify=function(method,objArgs){if(!objArgs){objArgs={};
}objArgs.generation=tableLayout.generation;var scrollPos;if(getCellsPending){scrollPos=requestedSnappedPos.clone();
}else{scrollPos=getScrollPosition();}objArgs.scrollPosition=scrollPos;var args=JSON.stringify(objArgs);
Spotfire.Dxp.Web.Forms.AjaxService.Modify(id,method,args);};var getRenderOffsets=function(){return renderOffsets;
};var getInvalidRect=function(x,y){var invalidRect=new Rectangle(x,y,valueCellsViewportSize.width,valueCellsViewportSize.height);
invalidRect.intersect(new Rectangle(0,0,tableLayout.scrollBounds.width,tableLayout.scrollBounds.height));
return invalidRect;};var getValueCellsViewport=function(){var snappedPos=snapToRow(tableLayout.rowHeight,scrollbarPos);
return getInvalidRect(snappedPos.x,snappedPos.y);};var isCachedPosition=function(pos){var visibleBounds=getInvalidRect(pos.x,pos.y);
var intersection=new Rectangle(visibleBounds).intersect(valueCellsBounds);return visibleBounds.equals(intersection);
};var getCellsCallback=function(response){getCellsPending=false;if(isDisposed||!response||tableLayout.generation>response.generation){return;
}Spotfire.Visuals.TableTiming.end("GetCells");var renderAction="replace";var renderedBounds=null;if(response.valueCells!==null){var bounds=new Rectangle(response.valueCells.bounds);
var emptyCanvas=true;if(bounds.intersectsWith(valueCellsBounds)){var sumRect=addRectangles(bounds,valueCellsBounds);
if(sumRect.width>0&&sumRect.height>0){renderedBounds=valueCellsBounds;valueCellsBounds=sumRect;emptyCanvas=false;
}else{valueCellsBounds=new Rectangle(response.valueCells.bounds);}}else{valueCellsBounds=new Rectangle(response.valueCells.bounds);
}renderAction=emptyCanvas?"replace":"add";response.valueCells.renderAction=renderAction;if(renderAction==="replace"){clearPendingValueKeys();
renderOffsets.valueCells=requestedSnappedPos.clone();}}if(response.frozenRowsCells!==null){response.frozenRowsCells.renderAction=renderAction;
if(renderAction==="replace"){renderOffsets.frozenRows=new Point(requestedSnappedPos.x,0);}}if(response.frozenColumnsCells!==null){response.frozenColumnsCells.renderAction=renderAction;
if(renderAction==="replace"){renderOffsets.frozenColumns=new Point(0,requestedSnappedPos.y);}}if(response.topLeftCornerCells!==null){response.topLeftCornerCells.renderAction="replace";
}var snappedPos=snapToRow(tableLayout.rowHeight,scrollbarPos);if(isCachedPosition(snappedPos)){scrollPosition=snappedPos;
}else{scrollPosition=requestedSnappedPos.clone();}if(renderCallback!==null){renderCallback(response,renderedBounds);
}};var isBoundsValid=function(bounds){var valid=true;var direction="none";var snappedScrollPos=snapToRow(tableLayout.rowHeight,scrollbarPos);
if(snappedScrollPos.x!==requestedSnappedPos.x&&snappedScrollPos.y===requestedSnappedPos.y){direction="horizontal";
}else{if(snappedScrollPos.y!==requestedSnappedPos.y&&snappedScrollPos.x===requestedSnappedPos.x){direction="vertical";
}}if(direction==="none"||(scrollDirection!=="none"&&scrollDirection!==direction)){valid=false;}var maxHeight=valueCellsViewportSize.height*3;
if(valid&&bounds.height>maxHeight){valid=false;}scrollDirection=direction;return valid;};var getCells=function(viewportFunction,forceGetCells){if(getCellsPending){window.clearTimeout(getCellsTimeout);
getCellsTimeout=window.setTimeout(function(){getCells(viewportFunction);},20);}else{var valueCellsViewport=viewportFunction();
var invalidRect=valueCellsViewport.intersect(new Rectangle(0,0,tableLayout.scrollBounds.width,tableLayout.scrollBounds.height));
if(!isBoundsValid(valueCellsBounds)){valueCellsBounds=new Rectangle(0,0,0,0);}if(invalidRect.intersectsWith(valueCellsBounds)){invalidRect.subtract(valueCellsBounds);
}var frozenRowsWidth=invalidRect.width>0?invalidRect.width:tableLayout.viewportSize.height<=tableLayout.frozenRowsHeight?tableLayout.viewportSize.width:0;
var hasScrolledVertically=valueCellsBounds.y!==invalidRect.y;var hasScrolledHorizontally=valueCellsBounds.x!==invalidRect.x;
var frozenRowsRect=new Rectangle(0,0,0,0);if(forceGetCells||hasScrolledHorizontally){frozenRowsRect=new Rectangle(invalidRect.x,0,frozenRowsWidth,tableLayout.frozenRowsHeight);
}var frozenRowsHeight=invalidRect.height>0?invalidRect.height:tableLayout.viewportSize.width<=tableLayout.frozenColumnsWidth?tableLayout.viewportSize.height:0;
var frozenColumnsRect=new Rectangle(0,0,0,0);if(forceGetCells||hasScrolledVertically){frozenColumnsRect=new Rectangle(0,invalidRect.y,tableLayout.frozenColumnsWidth,frozenRowsHeight);
}var topLeftCornerRect=new Rectangle(0,0,0,0);if(needToGetTopLeftCells){needToGetTopLeftCells=false;topLeftCornerRect=new Rectangle(0,0,tableLayout.frozenColumnsWidth,tableLayout.frozenRowsHeight);
}if(forceGetCells||(invalidRect.width>0&&invalidRect.height>0)||(frozenRowsRect.width>0&&frozenRowsRect.height>0)||(frozenColumnsRect.width>0&&frozenColumnsRect.height>0)){var snappedScrollPos=snapToRow(tableLayout.rowHeight,scrollbarPos);
requestedSnappedPos=snappedScrollPos.clone();getCellsPending=true;var invalidRectangles={valueCells:invalidRect,frozenRows:frozenRowsRect,frozenColumns:frozenColumnsRect,topLeftCorner:topLeftCornerRect};
read("GetCells",invalidRectangles,getCellsCallback);Spotfire.Visuals.TableTiming.begin("GetCells");return true;
}}return false;};var scrollTimeout=null;var onScroll=function(pos){var snappedPos=snapToRow(tableLayout.rowHeight,pos);
if(!pos.equals(scrollbarPos)){scrollbarPos=pos.clone();window.clearTimeout(scrollTimeout);scrollTimeout=window.setTimeout(function(){if(highLatency){getCells(getValueCellsViewport);
}var serverPos=snappedPos.clone();modify("Scroll",serverPos);},500);if(!highLatency){getCells(getValueCellsViewport);
}}var newCanvasPos=null;if(highLatency||isCachedPosition(snappedPos)){newCanvasPos=snappedPos.clone();
scrollPosition=newCanvasPos.clone();}return newCanvasPos;};if(scrollPosition.x!==tableLayout.scrollPosition.x||scrollPosition.y!==tableLayout.scrollPosition.y){modify("Scroll",scrollPosition);
}this.onScroll=onScroll;this.addPendingValueKeys=addPendingValueKeys;this.clearPendingValueKeys=clearPendingValueKeys;
this.dispose=dispose;this.getNextPendingValue=getNextPendingValue;this.getScrollPosition=getScrollPosition;
this.getRenderOffsets=getRenderOffsets;this.read=read;this.getCells=getCells;this.getValueCellsViewport=getValueCellsViewport;
this.modify=modify;getCells(getValueCellsViewport,true);}Spotfire.registerNameSpace("Visuals.TablePlotModel");
Spotfire.Visuals.TablePlotModel.create=function(id,tableLayout,highLatency,renderCallback,scrollbarWidth,scrollSize){return new TableModel(id,tableLayout,highLatency,renderCallback,scrollbarWidth,scrollSize);
};});$(function(){function validBackground(elem){if(!elem.parentNode){return"rgb(255, 255, 255)";}var style=window.getComputedStyle(elem);
var background=style.getPropertyValue("background-color");if(background==="rgba(0, 0, 0, 0)"){return validBackground(elem.parentNode);
}return background;}function filter(arr,fn){var value,i,results=[];for(i=0;i<arr.length;i+=1){value=arr[i];
if(fn(value,i)){results.push(value);}}return results;}function loop(arr,fn){var value,i,results=[];for(i=0;
i<arr.length;i+=1){value=arr[i];results.push(fn(value,i));}return results;}var applyWordWrap=function(elems,transparentHover){var measuredElements=loop(Array.prototype.slice.call(elems,0),function(elem){var style=window.getComputedStyle(elem);
return{node:elem,height:elem.parentNode.clientHeight,background:validBackground(elem.parentNode),fontSize:parseInt(style.getPropertyValue("font-size"),10),lineHeight:parseInt(style.getPropertyValue("line-height"),10)};
});loop(measuredElements,function(elemData){var maxHeight=Math.floor(elemData.height/elemData.lineHeight)*elemData.lineHeight;
elemData.node.style.maxHeight=maxHeight+"px";elemData.node.classList.add("sf-element-text-overflow-check");
});var elementsWithOverFlow=filter(measuredElements,function(elemData){return elemData.node.clientHeight<elemData.node.scrollHeight-1;
});loop(elementsWithOverFlow,function(elem){var ellipsis=document.createElement("div");ellipsis.classList.add("sf-element-text-ellipsis");
if(transparentHover){ellipsis.classList.add("sf-element-text-ellipsis-hover");}ellipsis.innerHTML="&hellip;";
ellipsis.style.backgroundImage="linear-gradient(to right, rgba(255, 255, 255, 0), "+elem.background+", "+elem.background+")";
elem.node.classList.add("sf-element-text-overflow");elem.node.appendChild(ellipsis);});};function rotateCells(elements,angle){var descentFactor=(11/2.68+20/6.57)/2;
elements=Array.prototype.slice.call(elements,0);if(!elements.length){return;}angle=angle||90;elements.forEach(function(elem){elem.classList.remove("textOrientationDirection-vertical");
});elements.forEach(function(elem){var classes=elem.getAttribute("class")||"";var rotationCell=document.createElement("div");
rotationCell.setAttribute("class",classes.replace("sf-element-table-cell","")+" sf-element-rotated-cell");
var childCount=elem.childElementCount;rotationCell.appendChild(elem.firstChild);if(childCount>1){elem.insertBefore(rotationCell,elem.children[0]);
}else{elem.appendChild(rotationCell);}});var findClass=function(array,className){var i;for(i=0;i<array.length;
i++){if(array[i]===className){return i;}}return -1;};var rotateAlignment=function(classes){var sourceArray=classes.split(" ");
var targetArray=classes.split(" ");var index=findClass(sourceArray,"flex-justify-start");if(index!==-1){targetArray[index]="flex-align-start";
}index=findClass(sourceArray,"flex-justify-end");if(index!==-1){targetArray[index]="flex-align-end";}index=findClass(sourceArray,"flex-justify-center");
if(index!==-1){targetArray[index]="flex-align-center";}index=findClass(sourceArray,"flex-align-start");
if(index!==-1){targetArray[index]="flex-justify-end";}index=findClass(sourceArray,"flex-align-end");if(index!==-1){targetArray[index]="flex-justify-start";
}index=findClass(sourceArray,"flex-align-center");if(index!==-1){targetArray[index]="flex-justify-center";
}return targetArray.join(" ");};var getSortingArrowOffset=function(elem){var sorted=elem.childElementCount>1;
var sortingArrowOffset=0;if(sorted){var $sort=$(elem.children[1]);var sortOrder=$sort.attr("sort");if(sortOrder==="up"||sortOrder==="down"){sortingArrowOffset=6;
}}return sortingArrowOffset;};elements.forEach(function(elem){var style=window.getComputedStyle(elem);
var fontSize=style.getPropertyValue("font-size");var justifyContent=style.getPropertyValue("justify-content");
var alignItems=style.getPropertyValue("align-items");var paddingTop=parseInt(style.getPropertyValue("padding-top"),10);
var paddingBottom=parseInt(style.getPropertyValue("padding-bottom"),10);var paddingLeft=parseInt(style.getPropertyValue("padding-left"),10);
var paddingRight=parseInt(style.getPropertyValue("padding-right"),10);var sortingArrowOffset=getSortingArrowOffset(elem);
var classes=elem.firstChild.className;var descent=parseFloat(fontSize)/descentFactor-1;var width=elem.offsetWidth-paddingLeft-paddingRight+sortingArrowOffset;
var height=elem.offsetHeight-paddingTop-paddingBottom;var classesTarget=rotateAlignment(classes);var temp=alignItems;
alignItems=justifyContent;justifyContent=temp;if(justifyContent==="flex-start"){justifyContent="flex-end";
}else{if(justifyContent==="flex-end"){justifyContent="flex-start";}}elem.dimensions={paddingLeft:paddingLeft,paddingTop:paddingTop,width:width,height:height,descent:descent,className:classesTarget,justifyContent:justifyContent,alignItems:alignItems,sortingArrowOffset:sortingArrowOffset};
});elements.forEach(function(elem){var child=elem.firstChild;var dimensions=elem.dimensions;var value="rotate(-"+angle+"deg) translateX( "+(-(dimensions.height-dimensions.descent-dimensions.sortingArrowOffset))+"px)";
var textAlign="";if(dimensions.justifyContent==="flex-start"){textAlign="left";}else{if(dimensions.justifyContent==="center"){textAlign="center";
}else{if(dimensions.justifyContent==="flex-end"){textAlign="right";}}}child.style.top=dimensions.paddingTop+"px";
child.style.left=dimensions.paddingLeft+"px";child.style.webkitTransform=value;child.style.transform=value;
child.style.transformOrigin="top left";child.firstChild.style.textAlign=textAlign;child.style.height=dimensions.width+"px";
child.style.width=(dimensions.height-dimensions.descent)+"px";child.className=dimensions.className;});
}Spotfire.registerNameSpace("Visuals.TablePlot.Text",{applyWordWrap:applyWordWrap,rotate:rotateCells});
});$(function(){Spotfire.registerNameSpace("Visuals.TableTiming");function TableTiming(enabled){var startTimes={};
var log={};var begin=function(id){if(!enabled){return;}startTimes[id]=$.now();};var end=function(id){if(!enabled){return;
}if(startTimes[id]!==undefined){var time=$.now()-startTimes[id];console.log(id+" "+time);log[id]=time;
}};var render=function(parent){if(!enabled){return;}parent.children(".tableTiming").remove();var messageDiv=$("<div class='tableTiming' style='position: absolute; top: 0px; left: 0px; background-color: #E8E8E8; padding: 4px; border: 1px solid; border-color: #282828'></div>");
var table=$("<table></table>");$.each(log,function(id,value){var row=$("<tr></tr>");var idCell=$("<td></td>");
var valueCell=$("<td></td>");idCell.text(id);valueCell.text(value+" ms");row.append(idCell);row.append(valueCell);
table.prepend(row);});startTimes={};log={};messageDiv.append(table);parent.append(messageDiv);};this.begin=begin;
this.end=end;this.render=render;}Spotfire.Visuals.TableTiming=new TableTiming(false);});$(function(){var mouseX,mouseY;
var padding=10;var cursorOffset=5;var visible=false;var followCursor=true;var timer=null;var $body=$(document.body);
var $div=$("<div/>").addClass("sf-tooltip sf-tooltip-content").css({"background-color":"#000",color:"#fff","border-width":"0"});
var hide=null;var onMouseDown=function(){hide();};hide=function(){if(timer){window.clearTimeout(timer);
}if(visible){$body.unbind("mousedown",onMouseDown);$div.remove();visible=false;}};var getAdjustedYPosition=function(y){var documentHeight=$(window).height()-padding*2;
return Math.max(padding,Math.min(y,documentHeight-$div.height()));};var getAdjustedXPosition=function(x){var documentWidth=$(window).width()-padding*2;
return Math.max(padding,Math.min(x,documentWidth-$div.width()));};var onMouseMove=function(e){mouseX=e.pageX+cursorOffset;
mouseY=e.pageY;if(visible&&followCursor){$div.css("left",getAdjustedXPosition(mouseX)+"px");$div.css("top",getAdjustedYPosition(mouseY-cursorOffset-$div.outerHeight())+"px");
}};var showAt=function(contentIsHtml,content,x,y){if(Spotfire.capabilities.supportsTouch()){return;}followCursor=true;
if(!content){return;}if(!visible){$body.mousedown(onMouseDown);$body.append($div);visible=true;}$div.empty();
var maxWidth=$(window).width()-padding*2;var maxHeight=$(window).height()-padding*2;$div.css({left:"0",top:"0",width:maxWidth+"px",height:maxHeight+"px"});
var $content=$("<span/>");if(contentIsHtml){$content.html(content);}else{$content.text(content);}$content.css({"max-width":maxWidth+"px","max-height":maxHeight+"px","word-wrap":"break-word","white-space":"pre"});
var layoutTooltip=function(){$div.width($content.width()+1);$div.height($content.height());$div.css("left",getAdjustedXPosition(x)+"px");
$div.css("top",getAdjustedYPosition(y-cursorOffset-$div.outerHeight())+"px");};$("img",$content).on("load",layoutTooltip);
$div.append($content);var closeOnLeave=function(){$div.off("mouseout",closeOnLeave);hide();};$div.on("mouseout",closeOnLeave);
layoutTooltip();};var showAtFixed=function(contentIsHtml,content,x,y){showAt(contentIsHtml,content,x,y);
followCursor=false;};var show=function(contentIsHtml,content,pauseTime){if(pauseTime===undefined){pauseTime=0;
}if(timer){window.clearTimeout(timer);}var onTimeout=function(){showAt(contentIsHtml,content,mouseX,mouseY);
};timer=window.setTimeout(onTimeout,pauseTime,true);};var setAppearance=function(textColor,backgroundColor,borderColor,borderWidth){$div.css({"background-color":backgroundColor,color:textColor,"border-color":borderColor,"border-width":borderWidth+"px"});
};var getTooltipDelay=function(){if(Spotfire.Web===undefined||Spotfire.Web.tooltipDelay===undefined){return 500;
}return Spotfire.Web.tooltipDelay;};var addToolTip=function(ctrl,text){$(ctrl).mouseover(function(){show(false,text,getTooltipDelay());
});$(ctrl).mouseout(function(){hide();});};Spotfire.registerNameSpace("Visuals.Tooltip",{showHtml:_.partial(show,true),show:_.partial(show,false),hide:hide,showHtmlAt:_.partial(showAt,true),showHtmlAtFixed:_.partial(showAtFixed,true),showAt:_.partial(showAt,false),showAtFixed:_.partial(showAtFixed,false),setAppearance:setAppearance,addToolTip:addToolTip,defaultPauseTime:500});
$body.mousemove(onMouseMove);});$(function(){function VirtualScrollbar(viewportSize,scrollSize,argScrollbarWidth,argScrollContainer,contentContainer){var maxPixels=1000000;
var scrollFactor;var topPos=0;var leftPos=0;var updating=false;var scrollEvent=jQuery.Event("virtualScroll");
var container=argScrollContainer;var viewportHeight=viewportSize.height;var viewportWidth=viewportSize.width;
var forceTopBounds=function(top){var max=Math.max(0,scrollSize.height-viewportHeight);top=Math.max(0,top);
top=Math.min(top,max);return top;};var forceLeftBounds=function(left){var max=Math.max(0,scrollSize.width-viewportWidth);
left=Math.max(0,left);left=Math.min(left,max);return left;};var scrollTop=function(value){if(value===undefined){return topPos;
}value=forceTopBounds(value);value=Math.round(value);var triggerScrollEvent=topPos!==value;topPos=value;
var y=Math.round(value/scrollFactor.vertical);updating=true;if(y!==container.scrollTop()){container.scrollTop(y);
}updating=false;if(triggerScrollEvent){argScrollContainer.trigger(scrollEvent,"vertical");}return topPos;
};var scrollLeft=function(value){if(value===undefined){return leftPos;}value=forceLeftBounds(value);value=Math.round(value);
var triggerScrollEvent=leftPos!==value;leftPos=value;var x=Math.round(value/scrollFactor.horizontal);
updating=true;if(x!==container.scrollLeft()){container.scrollLeft(x);}updating=false;if(triggerScrollEvent){argScrollContainer.trigger(scrollEvent,"horizontal");
}return leftPos;};var onScrollBarScroll=function(){if(!updating){scrollTop(Math.round(container.scrollTop()*scrollFactor.vertical));
scrollLeft(Math.round(container.scrollLeft()*scrollFactor.horizontal));}};if(Spotfire.capabilities.supportsTouch()){container=new IScroll(argScrollContainer.children().get(0),contentContainer.get(0),{bounce:false,notifyOnPositionChanged:true});
container.onScroll=onScrollBarScroll;}else{container.bind("scroll",onScrollBarScroll);}var getScrollFactor=function(){var factor={vertical:1,horizontal:1};
if(scrollSize.height>maxPixels){factor.vertical=(scrollSize.height-viewportHeight)/(maxPixels-viewportHeight);
}if(scrollSize.width>maxPixels){factor.horizontal=(scrollSize.width-viewportWidth)/(maxPixels-viewportWidth);
}return factor;};var getScrollCanvasSize=function(){var size=new Size(scrollSize.width,scrollSize.height);
if(scrollSize.height>maxPixels){size.height=maxPixels;}if(scrollSize.width>maxPixels){size.width=maxPixels;
}return size;};scrollFactor=getScrollFactor();var scrollCanvasSize=getScrollCanvasSize();var scrolledElement=argScrollContainer.children();
scrolledElement.css("width",scrollCanvasSize.width+"px");scrolledElement.css("height",scrollCanvasSize.height+"px");
this.scrollSize=function(){return scrollSize;};this.scrollTop=scrollTop;this.scrollLeft=scrollLeft;}Spotfire.registerNameSpace("Table.VirtualScrollbar",{create:function(viewportSize,scrollSize,argScrollbarWidth,argScrollContainer,contentContainer){return new VirtualScrollbar(viewportSize,scrollSize,argScrollbarWidth,argScrollContainer,contentContainer);
}});});$(function(){var update=function(viewId){var $view=$("#"+viewId);var status=$view.data("status");
if(!status){status={pending:0};$view.data("status",status);}var callback=function(result){try{Spotfire.evaluate(result.code);
}catch(ignore){}$view.trigger("sf-refresh-scrollbar");status.pending--;if(status.pending>0){status.pending=1;
Spotfire.Dxp.Web.Forms.AjaxService.Read(viewId,"Update","",callback);}};status.pending++;if(status.pending===1){Spotfire.Dxp.Web.Forms.AjaxService.Read(viewId,"Update","",callback);
}};var initialize=function(viewId,backgroundCss){var $view=$("#"+viewId).addClass("HtmlTextArea");$view.css(backgroundCss);
$view.StyledScrollbar({allowResize:true});var $parent=$("[viewId="+viewId+"]");var resize=function(){$view.sfFitInside($parent);
$view.trigger("sf-refresh-scrollbar");};$parent.on("sf-resize",resize);resize();$view.on("contextmenu",function(e){e.preventDefault();
var point={x:e.pageX,y:e.pageY};var viewOffset=$view.sfBoxOffset();var offset=new Point(e.pageX-viewOffset.left,e.pageY-viewOffset.top);
var args={pointOnPage:point,offset:offset};Spotfire.PageBus.publish("spotfire.visuals.showcontextmenu",args,viewId);
});Spotfire.Focus.handleKeyDown($view,function(e){if(e.keyCode===Keys.F1){var keyArgs={keyCode:e.keyCode,shiftKey:e.shiftKey,ctrlKey:e.ctrlKey};
Spotfire.Dxp.Web.Forms.AjaxService.Modify(viewId,"KeyDown",JSON.stringify(keyArgs));}});};var initActionControlButton=function(id){var $element=$("#"+id);
$element.mousedown(function(){var $this=$(this);var mouseleave=function(){$this.removeClass("sfpc-active");
};var mouseenter=function(){$this.addClass("sfpc-active");};var handleMouseUp=function(){$this.removeClass("sfpc-active").off("mouseleave",mouseleave).off("mouseenter",mouseenter);
$(window).off("mouseup",handleMouseUp);};$this.addClass("sfpc-active").on("mouseleave",mouseleave).on("mouseenter",mouseenter);
$(window).on("mouseup",handleMouseUp);});};var getControlBounds=function(id){var getBounds=function(selector){var $elem=$(selector);
var elementOffset=$elem.offset();return{x:elementOffset.left,y:elementOffset.top,width:$elem.outerWidth(),height:$elem.outerHeight()};
};var parentBounds=getBounds("#"+id);var rectangles=[];$("#"+id).find(":visible").each(function(){rectangles.push(getBounds(this));
});var x=parentBounds.x;var y=parentBounds.y;var xx=parentBounds.x+parentBounds.width;var yy=parentBounds.y+parentBounds.height;
$.each(rectangles,function(){x=Math.min(x,this.x);y=Math.min(y,this.y);xx=Math.max(xx,this.x+this.width);
yy=Math.max(yy,this.y+this.height);});return{x:x,y:y,width:xx-x,height:yy-y};};var evalCustomScripts=function(scripts){$.each(scripts,function(i,script){try{var fn=new Function(script.paramNames,script.code);
fn.apply(window,script.paramValues);}catch(e){Spotfire.WebAnalysis.notifyError("Execution of Javascript failed","Exception details:\r\n"+Spotfire.unwrapException(e));
}});};Spotfire.registerNameSpace("HtmlTextArea",{update:update,initialize:initialize,initActionControlButton:initActionControlButton,getControlBounds:getControlBounds,evalCustomScripts:evalCustomScripts});
});Spotfire.registerNameSpace("PropertyControls.DropDown");Spotfire.PropertyControls.DropDown.initialize=function(id,controlSettings){var items=controlSettings.items;
var $container=$("#"+id);$container.empty();$container.css("display","inline-block");var $dropdown=$("<div/>").appendTo($container);
var settings={};settings.values=items;settings.useIndexAsValueId=true;settings.layoutForTextFlow=true;
settings.useContainerSize=controlSettings.hasSizeSet;settings.onSelected=function(selectedValue,selectedIndex){if(selectedIndex>=0){Spotfire.WebView.modifyControl(id,selectedIndex);
}};Spotfire.Controls.DropDown.initialize($dropdown,settings);};Spotfire.PropertyControls.DropDown.update=function(id,selectedIndex){var $container=$("#"+id);
var $dropDownDiv=$(".sf-element-dropdown",$container);var settings={};settings.selectedIndex=selectedIndex;
Spotfire.Controls.DropDown.update($dropDownDiv,settings);};$(function(){Spotfire.registerNameSpace("PropertyControls.ListBox");
Spotfire.PropertyControls.ListBox.initialize=function(id,settings){var $container=$("#"+id);if($container.length===0){return;
}$container.empty();$container.css({display:"inline-block"});var $listboxDiv=$("<div/>").appendTo($container);
$listboxDiv.css("position","relative");var $tmpListBox=$("<div/>").addClass("sf-element-list-box").appendTo($container);
var $tmpBoxItem=$("<div/>").addClass("sf-element-list-box-item").css({display:"inline-block",overflow:"hidden","white-space":"pre"}).text("A").appendTo($tmpListBox);
var itemHeight=$tmpBoxItem.sfBoxHeight();var itemWidth=0;if(!settings.HasSizeSet){var allItems=_.reduce(settings.Items,function(memo,item){return memo+"\n"+item;
},"");$tmpBoxItem.text(allItems);itemWidth=$tmpBoxItem.sfBoxWidth();}var nrOfRows=4;if(settings.HasSizeSet&&itemHeight!==0){nrOfRows=Math.floor(settings.Size.height/itemHeight);
}$tmpListBox.remove();var listBoxSettings={height:nrOfRows,itemHeight:itemHeight,showSearchField:false,showImageMask:false,multiSelect:settings.SupportsMultiSelect,onSelectionChanged:function(selection){if(settings.SupportsMultiSelect){var value={method:"Select",pendingSelects:selection};
Spotfire.WebView.modifyControl(id,JSON.stringify(value));}else{Spotfire.WebView.modifyControl(id,selection);
}},onGetValues:function(low,high,generation,callback){var requestedItems=[];for(var i=low;i<=high;++i){var item={Text:settings.Items[i],Selected:false};
requestedItems.push(item);}var result={Items:requestedItems,TopIndex:low};callback(result);},onScrollToSubString:function(currentIndex,substring,callback){var indexOfSubstring=function(currentIndex){var substringUpper=substring.toUpperCase();
var len=substring.length;var match=function(value){return value.substring(0,len).toUpperCase()===substringUpper;
};var itemCount=settings.Items.length;var i;for(i=currentIndex+1;i<itemCount;++i){if(match(settings.Items[i])){return i;
}}for(i=0;i<currentIndex;++i){if(match(settings.Items[i])){return i;}}return currentIndex;};callback(indexOfSubstring(currentIndex));
},isScrollWheelDisabled:false};if(!settings.HasSizeSet){listBoxSettings.updateContainerToFitLongestItem=true;
listBoxSettings.longestItemWidth=itemWidth;}var listbox=Spotfire.Controls.VirtualListBox.create($listboxDiv,listBoxSettings);
$container.data("listbox",listbox);$container.data("items",settings.Items);var updatedSettings={totalVisibleValues:settings.Items.length};
listbox.update(updatedSettings);};Spotfire.PropertyControls.ListBox.selectIndices=function(id,selectedIndices){var virtualListbox=$("#"+id).data("listbox");
var items=$("#"+id).data("items");if(virtualListbox&&items){var updatedListBoxSettings={onGetValues:function(low,high,generation,callback){var requestedItems=[];
for(var i=low;i<=high;++i){var item={Text:items[i],Selected:$.inArray(i,selectedIndices)>=0};requestedItems.push(item);
}var result={Items:requestedItems,TopIndex:low};callback(result);}};virtualListbox.update(updatedListBoxSettings);
var maxIndex=_.max(selectedIndices);virtualListbox.ensureVisible(maxIndex);}};});var TextBoxControl={};
TextBoxControl.initialize=function(id){var $input=$("#"+id);var $body=$(document.body);var multiLine=$input.get(0).tagName.toLowerCase()==="textarea";
$input.data("serverValue",$input.val());var hasCapture=false;var onBlur;var onChange=function(){if(hasCapture){$body.unbind("mousedown",onBlur);
$body.get(0).releaseCapture();hasCapture=false;}var value=$input.val();if(value===$input.data("serverValue")){return;
}Spotfire.WebView.modifyControl(id,value);$input.data("serverValue",value);};onBlur=function(){onChange();
};var onKeyDown=function(e){if(!hasCapture&&$body.get(0).setCapture){hasCapture=true;$body.mousedown(onBlur);
$body.get(0).setCapture();}if(multiLine){return true;}if(e.which===13){onChange();}return true;};$input.keydown(onKeyDown);
$input.blur(onBlur);};TextBoxControl.setErrorMessage=function(id,errorMessage,explicitColor){var $input=$("#"+id);
if(typeof errorMessage==="string"&&errorMessage.length>0){$input.addClass("sfpc-error");$input.attr("title",errorMessage);
$input.css("color","");}else{$input.removeClass("sfpc-error");$input.attr("title","");$input.css("color",explicitColor);
}};TextBoxControl.update=function(id,value){var $input=$("#"+id);if(value!==$input.val()){$input.val(value);
}$input.data("serverValue",value);};$(function(){var initializeSlider=function(id,showMinMaxLabels,values,selectedIndex,formattedValue){var $parent=$("#"+id);
$parent.addClass("TextAreaSlider");if(showMinMaxLabels){$parent.addClass("ShowLabels");}$parent.empty();
var ticks=values.length;var snapPositions=null;var thumbPos=0;var thumbMax=-1;var previousClientX=null;
var $outercontainer=$("<div />").addClass("ItemSlider sf-element sf-element-item-slider").appendTo($parent);
$outercontainer.css("font-size","12px");var $container=$("<div />").addClass("SliderContainer").css("top","14px").appendTo($outercontainer);
var $background=$("<div />").addClass("Background sf-element sf-element-range sfc-outer").appendTo($container);
$outercontainer.on("selectstart",function(){return false;});$outercontainer.on("mousedown",function(){return false;
});var $slider=$("<div/>").addClass("Line sf-element sf-element-range sfc-inner").appendTo($background);
var $leftButton=$("<div />").addClass("Button LeftEnabled sf-element sf-element-button").appendTo($container);
var $rightButton=$("<div />").addClass("Button RightEnabled sf-element sf-element-button").appendTo($container);
var buttonWidth=$leftButton.outerWidth();$slider.css("left",$leftButton.outerWidth(true)+"px");Spotfire.getSvg("Images/Filters/LeftArrow.svg",function(svg){$leftButton.append(svg);
});Spotfire.getSvg("Images/Filters/RightArrow.svg",function(svg){$rightButton.append(svg);});var $thumb=$("<div />").addClass("Thumb sf-element sf-element-thumb").appendTo($container);
var thumbWidth=$thumb.outerWidth();var valueLabel=$("<span />").addClass("ValueLabel").appendTo($outercontainer);
$("<span />").addClass("MinLabel").appendTo($outercontainer).text(values[0]);$("<span />").addClass("MaxLabel").appendTo($outercontainer).text(values[values.length-1]);
var drawTick=function(pos,width){var $tick=$("<span />").addClass("Tick sf-element sf-element-range sfc-inner-dimmed").html("&nbsp;");
$tick.css("left",(pos+thumbWidth/2)+"px");$tick.css("width",width+"px");$slider.append($tick);};var draw=function(){var width=Math.max($parent.outerWidth(),thumbWidth+buttonWidth*2);
var sliderWidth=width-buttonWidth*2;thumbMax=sliderWidth-thumbWidth;var tickSize=thumbMax/Math.max(1,(ticks-1));
$slider.empty();var drawTicks=width>ticks*2;snapPositions=[];var i;for(i=0;i<ticks;i++){snapPositions.push(tickSize*i);
if(drawTicks){drawTick(Math.round(snapPositions[i]),tickSize);}}$outercontainer.css("width",width+"px");
$container.css("width",width+"px");$slider.css("width",sliderWidth+"px");if(Spotfire.capabilities.supportsTouch()){$slider.parent().css("overflow","visible");
$slider.css("overflow","visible");Touch.addTouchTarget($leftButton,20,20,$leftButton.outerWidth()/6,20);
Touch.addTouchTarget($rightButton,$rightButton.outerWidth()/6,20,20,20);Touch.addTouchTarget($slider,$slider.outerWidth()/2+$rightButton.outerWidth()/3,12,$slider.outerWidth()/2+$rightButton.outerWidth()/3,8);
}};var updateValueLabel=function(){var text=formattedValue;if(selectedIndex>=0&&selectedIndex<values.length){text=values[selectedIndex];
}if(selectedIndex<=0){$leftButton.addClass("LeftDisabled");$leftButton.removeClass("LeftEnabled");}else{$leftButton.removeClass("LeftDisabled");
$leftButton.addClass("LeftEnabled");}if(selectedIndex>=values.length-1){$rightButton.addClass("RightDisabled");
$rightButton.removeClass("RightEnabled");}else{$rightButton.removeClass("RightDisabled");$rightButton.addClass("RightEnabled");
}valueLabel.text(text);};var updateThumbPosition=function(){updateValueLabel();$thumb.css("left",thumbPos+buttonWidth+"px");
};var snapThumb=function(){if(selectedIndex>=0&&selectedIndex<snapPositions.length){thumbPos=Math.round(snapPositions[selectedIndex]);
}updateThumbPosition();};var setSelectedIndex=function(index){selectedIndex=index;snapThumb();};var onValueChanged=function(){if(selectedIndex>=0){Spotfire.WebView.modifyControl(id,selectedIndex);
}};var getClosestSnapIndex=function(pos){var snapIndex=0;var i;for(i=0;i<snapPositions.length;i++){if(Math.abs(snapPositions[i]-pos)<Math.abs(snapPositions[snapIndex]-pos)){snapIndex=i;
}}return snapIndex;};var onMouseMove=function(e){var delta=e.clientX-previousClientX;previousClientX=e.clientX;
thumbPos=Math.max(0,Math.min(thumbMax,thumbPos+delta));selectedIndex=getClosestSnapIndex(thumbPos);updateThumbPosition();
};var onMouseUp=function(){snapThumb();onValueChanged();};var onMouseDown=function(e){$thumb.focus();
previousClientX=e.clientX;};var onLeftButtonClick=function(){var i=selectedIndex-1;setSelectedIndex(Math.max(0,Math.min(i,ticks-1)));
onValueChanged();};var onRightButtonClick=function(){var i=selectedIndex+1;setSelectedIndex(Math.max(0,Math.min(i,ticks-1)));
onValueChanged();};var onResize=function(){draw();snapThumb();};var onClick=function(e){var $target=$(e.target);
if($target===$thumb){return;}var x=e.pageX-$slider.offset().left-$thumb.outerWidth()/2;selectedIndex=getClosestSnapIndex(x);
snapThumb();onValueChanged();};$parent.bind("resize",onResize);draw();snapThumb();if(ticks>0){$slider.on("click",onClick);
$leftButton.on("click",onLeftButtonClick);$rightButton.on("click",onRightButtonClick);Spotfire.Touch.registerTouchEvents($thumb,onMouseDown,onMouseMove,onMouseUp);
}};Spotfire.registerNameSpace("HtmlTextArea",{initializeSlider:function(id,settings){initializeSlider(id,settings.showMinMaxLabels,settings.values,settings.selectedIndex,settings.formattedValue);
}});});Spotfire.registerNameSpace("Visuals.Miniatures.MiniatureVisualization");Spotfire.Visuals.Miniatures.MiniatureVisualization.create=function(id,settings){function miniatureVisualization(){var $root=$("#"+id).empty();
$root.addClass("EmbeddedMiniatureVisualization");var shallShowTooltip=false;var updateCell=function(index,$cell,attributes){$cell.unbind("click");
$cell.unbind("mouseenter mouseleave");shallShowTooltip=false;if(attributes.hasPendingValue){$cell.css("opacity","0.2");
return;}if(typeof attributes.text!=="undefined"){$cell.empty();$cell.text(attributes.text);}var updateCss=function(key,value){if(value){$cell.css(key,value);
}else{$cell.css(key,"");}};updateCss("color",attributes.color);updateCss("font-style",attributes.fontStyle);
updateCss("font-weight",attributes.fontWeight);updateCss("text-align",attributes.textAlign);if(attributes.imageUrl){var $img=$cell.children("img");
if(!$img.length){$cell.empty();$img=$("<img/>");$cell.append($img);}$img.attr("src",attributes.imageUrl);
}if(typeof attributes.actionEnabled!=="undefined"){if(attributes.actionEnabled){var onCellClick=function(){Spotfire.Dxp.Web.Forms.AjaxService.Modify(id,"PerformAction",JSON.stringify(index));
};$cell.click(onCellClick);$cell.addClass("actionCell");}else{$cell.removeClass("actionCell");}}var tooltipLines=null;
var timer=null;var fetchAndShowTooltip=function(){shallShowTooltip=true;var showTooltipDelayed=function(lines,delayMillis){var showTooltip=function(){if(shallShowTooltip){Spotfire.Visuals.Tooltip.show(lines.join("\n"));
}};timer=window.setTimeout(showTooltip,delayMillis);};var delay=350;var targetTime=delay+$.now();var getTooltipCallback=function(lines){tooltipLines=lines;
var remaningDelay=Math.max(0,targetTime-$.now());showTooltipDelayed(lines,remaningDelay);};if(tooltipLines===null){Spotfire.Dxp.Web.Forms.AjaxService.Read(id,"GetTooltip",JSON.stringify(index),getTooltipCallback);
}else{showTooltipDelayed(tooltipLines,delay);}};var hideTooltip=function(){shallShowTooltip=false;if(timer){window.clearTimeout(timer);
}Spotfire.Visuals.Tooltip.hide();};$cell.hover(fetchAndShowTooltip,hideTooltip);$cell.css("opacity","");
};var cells=[];var update=function(mvSettings){var $cell;var i;if(cells.length!==mvSettings.cells.length){cells=[];
$root.empty();for(i=0;i<mvSettings.cells.length;i++){$cell=$("<span></span>");cells.push($cell);$root.append($cell);
}}for(i=0;i<cells.length;i++){updateCell(i,cells[i],mvSettings.cells[i]);}};this.update=update;}var miniVis=new miniatureVisualization();
var $rootElement=$("#"+id);$rootElement.data("miniVis",miniVis);miniVis.update(settings);};Spotfire.Visuals.Miniatures.MiniatureVisualization.update=function(id,settings){var miniVis=$("#"+id).data("miniVis");
if(miniVis){miniVis.update(settings);}};$(function(){Spotfire.registerNameSpace("Visuals.MapChartVisualization");
Spotfire.Visuals.MapChartVisualization.MapChartTouchHandler=function(interactionLayer,widgets){var pixelsPerZoomStep=50;
var panEvent,panStoppedEvent,startMarkingEvent,quickZoomEvent,zoomStoppedEvent,clickMarkingEvent,clickZoomInEvent,clickZoomOutEvent;
var panIsDefaultMode;this.pan=function(func){panEvent=func;};this.panStopped=function(func){panStoppedEvent=func;
};this.startMarking=function(func){startMarkingEvent=func;};this.clickMarking=function(func){clickMarkingEvent=func;
};this.quickZoom=function(func){quickZoomEvent=func;};this.zoomStopped=function(func){zoomStoppedEvent=func;
};this.clickZoomIn=function(func){clickZoomInEvent=func;};this.clickZoomOut=function(func){clickZoomOutEvent=func;
};this.setPanAsDeafultMode=function(value){panIsDefaultMode=value;};var touchTimer;var hasPanned=false;
var longTouch=false;var touchEnded=false;var lastX,lastY;var pinchDistance;var lastDownEvent;var lastZoomStep=0;
var isMarking=false;var touchesDown=0;var isPinching=false;var timerEvent;var touchEnd;var touchMove;
var touchStart;var calculatePinchDistance;timerEvent=function(){if(touchEnded&&!pinchDistance&&!isPinching){clickMarkingEvent(new Point(lastDownEvent.originalEvent.touches[0].pageX-interactionLayer.offset().left,lastDownEvent.originalEvent.touches[0].pageY-interactionLayer.offset().top));
}else{if(!pinchDistance){isMarking=true;Touch.showTouchHoldImage(lastDownEvent.originalEvent.touches[0].pageX,lastDownEvent.originalEvent.touches[0].pageY);
startMarkingEvent(lastDownEvent.originalEvent);longTouch=true;}}clearTimeout(touchTimer);touchTimer=undefined;
};touchEnd=function(touch){touch.preventDefault();$(document.body).unbind("touchend",touchEnd);$(document.body).unbind("touchmove",touchMove);
if(touchesDown===2&&!isPinching&&panIsDefaultMode){clickZoomOutEvent(new Point(touch.originalEvent.touches[0].pageX-interactionLayer.offset().left,touch.originalEvent.touches[0].pageY-interactionLayer.offset().top));
}else{if(isMarking||!panIsDefaultMode){Touch.removeTouchHoldImage();}else{if(hasPanned){panStoppedEvent();
}else{if(isPinching){zoomStoppedEvent();lastZoomStep=0;}}}}touchEnded=true;pinchDistance=undefined;};
touchMove=function(touch){touch.preventDefault();clearTimeout(touchTimer);touchTimer=undefined;if(!longTouch&&pinchDistance&&touch.originalEvent.touches.length>=2&&panIsDefaultMode){var deltaDistance=pinchDistance-calculatePinchDistance(touch.originalEvent.touches);
var steps=Math.round(deltaDistance/pixelsPerZoomStep);if(steps-lastZoomStep!==0){isPinching=true;quickZoomEvent(steps-lastZoomStep);
lastZoomStep=steps;}}else{if(!longTouch&&panIsDefaultMode){var offSetX=(lastX-touch.originalEvent.changedTouches[0].pageX)*-1;
var offSetY=(lastY-touch.originalEvent.changedTouches[0].pageY)*-1;lastX=touch.originalEvent.changedTouches[0].pageX;
lastY=touch.originalEvent.changedTouches[0].pageY;if(Math.abs(offSetX)>0||Math.abs(offSetY)>0){panEvent(offSetX,offSetY);
hasPanned=true;}}else{if(!isMarking&&!panIsDefaultMode&&!longTouch){isMarking=true;Touch.showTouchHoldImage(lastDownEvent.originalEvent.touches[0].pageX,lastDownEvent.originalEvent.touches[0].pageY);
startMarkingEvent(touch.originalEvent.changedTouches[0]);}else{if(isMarking||!panIsDefaultMode){Touch.moveTouchHoldImage(touch.originalEvent.touches[0].pageX,touch.originalEvent.touches[0].pageY);
}}}}};touchStart=function(event){event.preventDefault();isMarking=false;longTouch=false;touchEnded=false;
isPinching=false;touchesDown=event.originalEvent.touches.length;if(event.originalEvent.touches.length>2||event.originalEvent.touches.length<1){return;
}if(event.originalEvent.touches.length===2){pinchDistance=calculatePinchDistance(event.originalEvent.touches);
}else{var index;for(index=0;index<widgets.length;index++){if($.contains(widgets[index].get(0),event.originalEvent.touches[0].target)){return;
}}if(touchTimer){clickZoomInEvent(new Point(event.originalEvent.touches[0].pageX-interactionLayer.offset().left,event.originalEvent.touches[0].pageY-interactionLayer.offset().top));
clearTimeout(touchTimer);touchTimer=undefined;}else{touchTimer=setTimeout(timerEvent,500);var touch=event.originalEvent.touches[0];
lastX=touch.pageX;lastY=touch.pageY;}}lastDownEvent=event;$(document.body).unbind("touchend",touchEnd);
$(document.body).bind("touchend",touchEnd);$(document.body).unbind("touchmove",touchMove);$(document.body).bind("touchmove",touchMove);
};interactionLayer.unbind("touchstart",touchStart);interactionLayer.bind("touchstart",touchStart);calculatePinchDistance=function(touches){var x0=touches[0].pageX;
var y0=touches[0].pageY;var x1=touches[1].pageX;var y1=touches[1].pageY;var distance=Math.sqrt(Math.pow(x0-x1,2)+Math.pow(y0-y1,2));
var absDistance=Math.abs(distance);return absDistance;};};Spotfire.Visuals.MapChartVisualization.MapChartMouseHandler=function(interactionLayer,widgets,editLabelsPositionMode){var panEvent,panStoppedEvent,startMarkingEvent,rightClickEvent,clickMarkingEvent,clickZoomInEvent;
var panIsDefaultMode;this.pan=function(func){panEvent=func;};this.panStopped=function(func){panStoppedEvent=func;
};this.startMarking=function(func){startMarkingEvent=func;};this.rightClick=function(func){rightClickEvent=func;
};this.clickMarking=function(func){clickMarkingEvent=func;};this.clickZoomIn=function(func){clickZoomInEvent=func;
};this.setPanAsDeafultMode=function(value){panIsDefaultMode=value;};var hasPanned=false,lastX,lastY;var doubleClickTimer;
var mouseUp;var mouseMove;var mouseDown;mouseUp=function(upEvent){$(document).unbind("mousemove",mouseMove);
$(document).unbind("mouseup",mouseUp);if(hasPanned){hasPanned=false;panStoppedEvent();}else{if(upEvent.which===3){if(rightClickEvent){rightClickEvent(upEvent);
}}else{if(upEvent.which===1){if(panIsDefaultMode){doubleClickTimer=setTimeout(function(){doubleClickTimer=undefined;
clickMarkingEvent(new Point(upEvent.pageX-interactionLayer.offset().left,upEvent.pageY-interactionLayer.offset().top),upEvent.ctrlKey||upEvent.metaKey);
},500);}else{clickMarkingEvent(new Point(upEvent.pageX-interactionLayer.offset().left,upEvent.pageY-interactionLayer.offset().top),upEvent.ctrlKey||upEvent.metaKey);
}}}}};mouseMove=function(moveEvent){moveEvent.preventDefault();if(moveEvent.ctrlKey||moveEvent.metaKey||panIsDefaultMode){var offSetX=(lastX-moveEvent.pageX)*-1;
var offSetY=(lastY-moveEvent.pageY)*-1;lastX=moveEvent.pageX;lastY=moveEvent.pageY;if(Math.abs(offSetX)>0||Math.abs(offSetY)>0){hasPanned=true;
panEvent(offSetX,offSetY);}}};mouseDown=function(eventDown){eventDown.preventDefault();if(eventDown.target===undefined){eventDown.target=eventDown.srcElement;
}var hitWidget=false;var index;for(index=0;index<widgets.length;index++){if($.contains(widgets[index].get(0),eventDown.target)){hitWidget=true;
}}if((eventDown.which===3||panIsDefaultMode)&&!hitWidget){lastX=eventDown.pageX;lastY=eventDown.pageY;
$(document).unbind("mousemove",mouseMove);$(document).bind("mousemove",mouseMove);$(document).unbind("mouseup",mouseUp);
$(document).bind("mouseup",mouseUp);}else{if(eventDown.which===1&&!hitWidget&&!editLabelsPositionMode){startMarkingEvent(eventDown);
}}return true;};interactionLayer.dblclick(function(e){if(panIsDefaultMode){if(e.target===undefined){e.target=e.srcElement;
}var index;for(index=0;index<widgets.length;index++){if($.contains(widgets[index].get(0),e.target)){return true;
}}clearTimeout(doubleClickTimer);if(clickZoomInEvent){clickZoomInEvent(new Point(e.pageX-interactionLayer.offset().left,e.pageY-interactionLayer.offset().top));
}}});interactionLayer.unbind("mousedown",mouseDown);interactionLayer.bind("mousedown",mouseDown);};});
$(function(){Spotfire.registerNameSpace("Visuals.MapChartPanelVisualization");var MapChartPanel;Spotfire.Visuals.MapChartPanelVisualization.initialize=function(id,panelIndex,generation){var panelViewport=$("#"+id+panelIndex);
var mapChartPanel=new MapChartPanel(id,panelIndex);panelViewport.data("MapChartPanel",mapChartPanel);
var args={panelIndex:panelIndex,generation:generation};Spotfire.Dxp.Web.Forms.AjaxService.Read(id,"MapChartPanelData",JSON.stringify(args),function(data){mapChartPanel.doUpdate(generation,data);
Spotfire.Dxp.Web.Forms.AjaxService.Modify(id,"HandleInteractiveLayer",{generation:generation});});};Spotfire.Visuals.MapChartPanelVisualization.updateHighlight=function(id,panelIndex,generation,data){var panelViewport=$("#"+id+panelIndex);
var mapChartPanel=panelViewport.data("MapChartPanel");if(mapChartPanel){mapChartPanel.performHighlight(data);
}};MapChartPanel=function(id,panelIndex){var viewport=$("#"+id+panelIndex);var mapChartViewport=$("#"+id);
var mapObj=mapChartViewport.data("MapChart");var bounds,boundsLatLng;var highlightLayer;var markerLayer;
var containsTileLayer;var htmlEncode;var addLabels;if(Spotfire.capabilities.supportsTouch()){viewport.css("overflow","auto");
}this.doUpdate=function(generation,data){if(!data){return;}mapObj.reportProgress(false,generation);viewport.empty();
var mapContainer=$("<div></div>");mapContainer.css("width",viewport.css("width"));mapContainer.css("height",viewport.css("height"));
viewport.append(mapContainer);var waitingImages=0;if(!data.noneCrs&&!data.center){return;}var scaleControl={fontSize:data.scaleFontSize,fontFamily:data.scaleFontName,fontStyle:data.scaleFontItalic?"italic":"normal",fontWeight:data.scaleFontBold?"bold":"normal",kmLabel:data.kmLabel,mLabel:data.mLabel,miLabel:data.miLabel,ftLabel:data.ftLabel,unitSystem:data.useMetricUnits?"metric":"imperial"};
var attributionControl={prefix:"",fontSize:7,fontFamily:"Arial"};if(!data.showScale){scaleControl.addToMap=false;
}if(data.showAttribution&&containsTileLayer(data.layers)){attributionControl.addToMap=true;}else{attributionControl.addToMap=false;
}var crs=new T.Crs({code:data.epsg,proj:data.proj4def,resolutions:data.scaleSteps});var map=new T.Map(mapContainer.get(0),{maxZoom:(data.maxLevel||data.maxLevel===0)?data.maxLevel:18,minZoom:data.minLevel||0,zoom:data.noneCrs?10:data.zoomLevel,center:data.noneCrs?new T.LatLng(0,0):new T.LatLng(data.center.Y,data.center.X),repeatX:true,repeatY:false,skipDefaultHandlers:true,controls:{scale:scaleControl,attribution:attributionControl}});
map.setCrs(crs);bounds=map.getProjectedBounds();boundsLatLng=map.getBounds();if(data.noneCrs){map.useNoneCrs=true;
map.startingBounds=boundsLatLng;}mapObj.addMap(map);var tileLayers=[];var hasImageLayer=false;var preventDefaultDragFunction=function(e){e.preventDefault();
};var imageLoadedEvent=function(){waitingImages--;if(!waitingImages){mapObj.reportProgress(true,generation);
$.each(tileLayers,function(tileLayerIndex,tileLayerObject){tileLayerObject.reloadTiles();tileLayerObject.options.autoLoadTiles=true;
});}};var errorTimer;var index,layer,copyrightTag,tileLayer,tiledRendered,wmsOptions,wmsLayer,imageLayer;
var layerId;var wmsErrorFunction=function(){if(tiledRendered){imageLoadedEvent();}Spotfire.Dxp.Web.Forms.AjaxService.Read(id,"ReportWmsError",JSON.stringify({generation:generation,layerId:layerId}));
if(errorTimer){clearTimeout(errorTimer);}};var tiledWmsErrorFunction=function(tile){if(!errorTimer){errorTimer=setTimeout(wmsErrorFunction,1000);
}};var tileLayerProperties;for(index=0;index<data.layers.length;index++){layer=data.layers[index];if(layer.type==="tile"&&layer.url){if(layer.copyrightLink&&layer.copyrightText){copyrightTag='<a target="_blank" href="'+htmlEncode(layer.copyrightLink)+'" class="mapChart attribution" title="'+htmlEncode(layer.copyrightLink)+'">'+htmlEncode(layer.copyrightText)+"</a>";
}else{if(layer.copyrightText){copyrightTag='<a href="#" onclick="return false;"" class="mapChart attribution" ">'+htmlEncode(layer.copyrightText)+"</a>";
}}tileLayerProperties={attribution:copyrightTag,tile404:"Images/Plots/WebMapChart/Error404.png",autoLoadTiles:false};
if(layer.hasOwnProperty("opacity")){tileLayerProperties.opacity=layer.opacity;}tileLayer=new T.TileLayer(layer.url,tileLayerProperties);
map.addLayer(tileLayer);tileLayers.push(tileLayer);}else{if(layer.type==="wms"){tiledRendered=layer.tiledRendered;
wmsOptions={version:layer.serverVersion,layers:layer.layers,styles:layer.styles,reversedAxisOrder:layer.reversedAxisOrder,tile404:"Images/Plots/WebMapChart/EmptyImage.gif",errorTileAttemptsThreshold:0};
wmsOptions.maxBounds=new T.Bounds(new T.Point(layer.maxBoundsWest,layer.maxBoundsSouth),new T.Point(layer.maxBoundsEast,layer.maxBoundsNorth));
wmsOptions.queryParams=layer.queryParams;if(!layer.useCache){wmsOptions.queryParams.gen=generation;}if(layer.hasOwnProperty("opacity")){wmsOptions.opacity=layer.opacity;
}wmsLayer=layer.tiledRendered?new T.WmsTileLayer(layer.serverUrl,wmsOptions):new T.WmsLayer(layer.serverUrl,wmsOptions);
layerId=layer.id;if(tiledRendered){wmsLayer.events.on("tile-error",tiledWmsErrorFunction);}else{wmsLayer.events.on("wms-error",wmsErrorFunction);
hasImageLayer=true;waitingImages++;wmsLayer.events.on("image-load",imageLoadedEvent);}$(wmsLayer.image).on("dragstart",preventDefaultDragFunction);
map.addLayer(wmsLayer);}else{if(layer.type==="image"){imageLayer=new T.ImageLayer(layer.url,bounds);$(imageLayer.image).on("dragstart",preventDefaultDragFunction);
map.addLayer(imageLayer);hasImageLayer=true;waitingImages++;imageLayer.events.on("image-load",imageLoadedEvent);
}}}}if(data.containsLabels&&data.editLabelMode){markerLayer=new T.LegacyMarkersLayer();map.addLayer(markerLayer);
var args={panelIndex:panelIndex,generation:generation};Spotfire.Dxp.Web.Forms.AjaxService.Read(id,"MapChartReadLabelsForEditMode",JSON.stringify(args),addLabels);
}if(!hasImageLayer){mapObj.reportProgress(true,generation);var i;for(i=0;i<tileLayers.length;i++){tileLayers[i].reloadTiles();
tileLayers[i].options.autoLoadTiles=true;}}if(!data.editLabelMode&&hasImageLayer){highlightLayer=new T.ImageLayer(data.highlightUrl,bounds);
$(highlightLayer.image).on("dragstart",function(e){e.preventDefault();return false;});map.addLayer(highlightLayer);
}};this.performHighlight=function(data){if(highlightLayer){highlightLayer.reload(data.url,bounds);if(Spotfire.isWebPlayer()){var moveEvent=function(){$(document.body).unbind("mousemove",moveEvent);
highlightLayer.reload("Images/EmptyImage.gif",bounds);Spotfire.Dxp.Web.Forms.AjaxService.Modify(id,"ClearHighlight","{}");
};$(document.body).bind("mousemove",moveEvent);}}};htmlEncode=function(html){return document.createElement("a").appendChild(document.createTextNode(html)).parentNode.innerHTML;
};containsTileLayer=function(layers){var index;for(index=0;index<layers.length;index++){if(layers[index].type==="tile"){return true;
}}return false;};function olderIe(){var v=3;var div=document.createElement("div");while(v<10){div.innerHTML="<!--[if gt IE "+(++v)+"]><i></i><![endif]-->";
if(div.getElementsByTagName("i").length===0){break;}}return v<=9&&v>4;}addLabels=function(data){if(!data){return;
}var useOldIeClass=olderIe();var layerIndex,layerData,layerId,labelIndex,label,labelDiv,divAsString,mapBounds,offsetX,offsetY,percentX,percentY,labelMarker;
for(layerIndex=0;layerIndex<data.layers.length;layerIndex++){layerData=data.layers[layerIndex];layerId=layerData.layerId;
for(labelIndex=0;labelIndex<layerData.Labels.length;labelIndex++){label=layerData.Labels[labelIndex];
labelDiv=$("<div></div>");labelDiv.css("font-family",layerData.FontName);if(layerData.FontBold){labelDiv.css("font-weight","bold");
}if(layerData.FontItalic){labelDiv.css("font-style","italic");}labelDiv.css("margin-top","-"+Math.ceil(layerData.FontSize/2)+"pt");
labelDiv.css("font-size",layerData.FontSize+"pt");if(useOldIeClass){labelDiv.addClass("mapChart labels ie");
}else{labelDiv.addClass("mapChart labels noneIe");}labelDiv.html(htmlEncode(label.Label));divAsString=$("<p>").append(labelDiv).html();
if(data.useNoneCrs){mapBounds=mapObj.getFirstMap().getBounds();offsetX=label.CenterPoint.X-data.boundsLow.X;
offsetY=label.CenterPoint.Y-data.boundsLow.Y;percentX=offsetX/(data.boundsHigh.X-data.boundsLow.X);percentY=offsetY/(data.boundsHigh.Y-data.boundsLow.Y);
label.CenterPoint.X=(percentX*(mapBounds.getEast()-mapBounds.getWest()))+mapBounds.getWest();label.CenterPoint.Y=(percentY*(mapBounds.getNorth()-mapBounds.getSouth()))+mapBounds.getSouth();
}labelMarker=new T.LegacyHtmlMarker(new T.LatLng(label.CenterPoint.Y,label.CenterPoint.X),divAsString,{draggable:layerData.editLabelPositionsMode});
labelMarker.geometryKey=label.key;labelMarker.layerId=layerId;markerLayer.addMarker(labelMarker);}}markerLayer.events.on("marker-drag-end",function(marker){var args={layerId:marker.layerId,key:marker.geometryKey,x:marker.latlng.lng.toString(),y:marker.latlng.lat.toString()};
if(data.useNoneCrs){var mapBounds_=mapObj.getFirstMap().getBounds();var offsetX_=marker.latlng.lng-mapBounds_.getWest();
var offsetY_=marker.latlng.lat-mapBounds_.getSouth();var percentX_=offsetX_/(mapBounds_.getEast()-mapBounds_.getWest());
var percentY_=offsetY_/(mapBounds_.getNorth()-mapBounds_.getSouth());args.x=(percentX_*(data.boundsHigh.X-data.boundsLow.X))+data.boundsLow.X;
args.x=args.x.toString();args.y=(percentY_*(data.boundsHigh.Y-data.boundsLow.Y))+data.boundsLow.Y;args.y=args.y.toString();
}Spotfire.Dxp.Web.Forms.AjaxService.Modify(id,"LabelPositionChanged",JSON.stringify(args));});};};});
$(function(){Spotfire.registerNameSpace("Visuals.MapChartVisualization");var MapChartObject;var MapCircleCalculations=(function(){var isIe=window.navigator.userAgent.indexOf("MSIE ")>0||window.navigator.userAgent.indexOf("Trident/")>0||window.navigator.userAgent.indexOf("Edge/")>0;
var CIRCLE_SIDES=isIe?500:5000;var EARTH_RADIUS=6371;function rotate(u,v,theta){var x=v.x*(Math.cos(theta)+u.x*u.x*(1-Math.cos(theta)))+v.y*(u.x*u.y*(1-Math.cos(theta))-u.z*Math.sin(theta))+v.z*(u.x*u.z*(1-Math.cos(theta))+u.y*Math.sin(theta));
var y=v.x*(u.y*u.x*(1-Math.cos(theta))+u.z*Math.sin(theta))+v.y*(Math.cos(theta)+u.y*u.y*(1-Math.cos(theta)))+v.z*(u.y*u.z*(1-Math.cos(theta))-u.x*Math.sin(theta));
var z=v.x*(u.z*u.x*(1-Math.cos(theta))-u.y*Math.sin(theta))+v.y*(u.z*u.y*(1-Math.cos(theta))+u.x*Math.sin(theta))+v.z*(Math.cos(theta)+u.z*u.z*(1-Math.cos(theta)));
return{x:x,y:y,z:z};}function normalize(vector){var module=Math.sqrt(Math.pow(vector.x,2)+Math.pow(vector.y,2)+Math.pow(vector.z,2));
var result={x:vector.x/module,y:vector.y/module,z:vector.z/module};return result;}function toCartesian(point){var x=EARTH_RADIUS*Math.sin(Math.PI/2-point.lat*Math.PI/180)*Math.cos(point.lng*Math.PI/180);
var y=EARTH_RADIUS*Math.sin(Math.PI/2-point.lat*Math.PI/180)*Math.sin(point.lng*Math.PI/180);var z=EARTH_RADIUS*Math.cos(Math.PI/2-point.lat*Math.PI/180);
return{x:x,y:y,z:z};}function fromCartesian(point){var module=Math.sqrt(Math.pow(point.x,2)+Math.pow(point.y,2)+Math.pow(point.z,2));
var lat=(Math.PI/2-Math.acos(point.z/module))*180/Math.PI;var lng=Math.atan2(point.y,point.x)*180/Math.PI;
return new T.LatLng(lat,lng);}var polygonSign=function(polygon,center){var closestOnX={distance:Math.abs(center.x-polygon[0].x),index:0};
var i,newClosestOnXDistance;for(i=0;i<polygon.length;i++){newClosestOnXDistance=Math.min(closestOnX.distance,Math.abs(center.x-polygon[i].x));
if(newClosestOnXDistance!==closestOnX.distance){closestOnX={distance:newClosestOnXDistance,index:i};}}return center.y-polygon[closestOnX.index].y>=0?1:-1;
};var isInside=function(pointX,pointY,minX,minY,maxX,maxY){return pointX>=minX&&pointX<=maxX&&pointY>=minY&&pointY<=maxY;
};var extendPolygonBounds=function(bounds,point){bounds.minX=bounds.minX===undefined?point.x:Math.min(bounds.minX,point.x);
bounds.maxX=bounds.maxX===undefined?point.x:Math.max(bounds.maxX,point.x);bounds.minY=bounds.minY===undefined?point.y:Math.min(bounds.minY,point.y);
bounds.maxY=bounds.maxY===undefined?point.y:Math.max(bounds.maxY,point.y);};var getRectPolygon=function(topLeft,bottomRight,viewportBottomRight){var polygon=[];
polygon.push({x:topLeft.x,y:0});polygon.push({x:topLeft.x,y:viewportBottomRight.y});polygon.push({x:bottomRight.x,y:viewportBottomRight.y});
polygon.push({x:bottomRight.x,y:0});return polygon;};var fixProjectionDrawingErrors=function(polygon,center,topLeft,bottomRight,viewportBottomRight,mapZoomLevel){var polygon1=[];
var polygon2=[];var polygonToggle=false;var polygonToggleCount=0;var minX=polygon[0].x;var maxX=polygon[0].x;
var minY=polygon[0].y;var maxY=polygon[0].y;var polygon1Bounds={};var polygon2Bounds={};var i;var margin1,margin2;
var xDiff;for(i=0;i<polygon.length;i++){if(i>0){minX=Math.min(minX,polygon[i].x);maxX=Math.max(maxX,polygon[i].x);
minY=Math.min(minY,polygon[i].y);maxY=Math.max(maxY,polygon[i].y);xDiff=Math.abs(polygon[i].x-polygon[i-1].x);
if(xDiff>200*Math.pow(2,mapZoomLevel)){polygonToggle=!polygonToggle;polygonToggleCount++;if(Math.abs(bottomRight.x-polygon[i-1].x)<50){margin1=[bottomRight.x,polygon[i-1].y];
margin2=[topLeft.x,polygon[i].y];maxX=bottomRight.x;minX=topLeft.x;}else{if(Math.abs(topLeft.x-polygon[i-1].x)<50){margin1=[topLeft.x,polygon[i-1].y];
margin2=[bottomRight.x,polygon[i].y];maxX=bottomRight.x;minX=topLeft.x;}}}if(polygonToggle){if(margin1){polygon1.push({x:margin1[0],y:margin1[1]});
polygon2.push({x:margin2[0],y:margin2[1]});margin1=null;}extendPolygonBounds(polygon2Bounds,polygon[i]);
polygon2.push({x:polygon[i].x,y:polygon[i].y});}else{if(margin1){polygon2.push({x:margin1[0],y:margin1[1]});
polygon1.push({x:margin2[0],y:margin2[1]});margin1=null;}extendPolygonBounds(polygon1Bounds,polygon[i]);
polygon1.push({x:polygon[i].x,y:polygon[i].y});}}else{extendPolygonBounds(polygon1Bounds,polygon[i]);
polygon1.push({x:polygon[i].x,y:polygon[i].y});}}if(polygonToggleCount===0&&!isInside(center.x,center.y,minX,minY,maxX,maxY)){return[getRectPolygon(topLeft,bottomRight,viewportBottomRight),polygon1];
}if(polygonToggleCount===2){if(!isInside(center.x,center.y,polygon1Bounds.minX,polygon1Bounds.minY,polygon1Bounds.maxX,polygon1Bounds.maxY)&&!isInside(center.x,center.y,polygon2Bounds.minX,polygon2Bounds.minY,polygon2Bounds.maxX,polygon2Bounds.maxY)){return[getRectPolygon(topLeft,bottomRight,viewportBottomRight),polygon1,polygon2];
}return[polygon1,polygon2];}if(polygonToggleCount===1||polygonToggleCount>=3){var sign=polygonSign(polygon,center);
if(sign===1){polygon1.push({x:minX,y:viewportBottomRight.y*sign});polygon1.push({x:maxX,y:viewportBottomRight.y*sign});
}else{polygon1.push({x:maxX,y:0});polygon1.push({x:minX,y:0});}for(i=0;i<polygon2.length;i++){polygon1.push({x:polygon2[i].x,y:polygon2[i].y});
}return[polygon1];}return[polygon];};var pointToLineDistance=function(point,point1,point2){if(point1.x===point2.x){return Math.abs(point.x-point1.x);
}var triangleArea=Math.abs((point2.y-point1.y)*point.x-(point2.x-point1.x)*point.y+point2.x*point1.y-point2.y*point1.x);
var pointsDistance=Math.sqrt(Math.pow(point2.y-point1.y,2)+Math.pow(point2.x-point1.x,2));var distance=triangleArea/pointsDistance;
return distance;};var simplifyPolygon=function(polygon,epsilon){if(polygon.length<=4){return polygon;
}var firstPoint=polygon[0];var lastPoint=polygon[polygon.length-1];var maxDistanceIndex=-1;var maxDistance=0;
var i,currentDistance,firstRecursiveResult,secondRecursiveResult,recursiveResult;for(i=1;i<polygon.length-1;
i++){currentDistance=pointToLineDistance(polygon[i],firstPoint,lastPoint);if(currentDistance>maxDistance){maxDistance=currentDistance;
maxDistanceIndex=i;}}if(maxDistance>epsilon){firstRecursiveResult=simplifyPolygon(polygon.slice(0,maxDistanceIndex+1),epsilon);
secondRecursiveResult=simplifyPolygon(polygon.slice(maxDistanceIndex),epsilon);recursiveResult=firstRecursiveResult.slice(0,firstRecursiveResult.length-1).concat(secondRecursiveResult);
return recursiveResult;}return[firstPoint,lastPoint];};var transformToPolygon=function(map,center,point,viewport){var centerLatLng=map.containerPointToLatLng(new T.Point(center.x,center.y));
var pointLatLng=map.containerPointToLatLng(new T.Point(point.x,point.y));var topLeft=map.latLngToContainerPoint(new T.LatLng(85,-180));
var bottomRight=map.latLngToContainerPoint(new T.LatLng(-85,180));var viewportBottomRight={x:viewport.width(),y:viewport.height()};
var c=toCartesian(centerLatLng);var p=toCartesian(pointLatLng);var nc=normalize(c);var projectedCircle=[];
var i,angle,result,pp,cp;for(i=0;i<CIRCLE_SIDES;i++){angle=i*(360/CIRCLE_SIDES)*(Math.PI/180);result=rotate(nc,p,angle);
pp=fromCartesian(result);cp=map.latLngToContainerPoint(pp);projectedCircle.push({x:cp.x,y:cp.y});}var wrappedLng=Math.abs(centerLatLng.lng/180)>1?centerLatLng.lng%180-(centerLatLng.lng/Math.abs(centerLatLng.lng))*180:centerLatLng.lng;
var polygons=fixProjectionDrawingErrors(projectedCircle,map.latLngToContainerPoint(new T.LatLng(centerLatLng.lat,wrappedLng)),topLeft,bottomRight,viewportBottomRight,map.getZoom());
var simplifiedPolygons=[];for(i=0;i<polygons.length;i++){simplifiedPolygons.push(simplifyPolygon(polygons[i],1));
}return simplifiedPolygons;};var computeDistance=function(map,point1,point2){var a=map.containerPointToLatLng(new T.Point(point1.x,point1.y));
var b=map.containerPointToLatLng(new T.Point(point2.x,point2.y));var dLat=(b.lat-a.lat).toRad();var dLon=(b.lng-a.lng).toRad();
var lat1=a.lat.toRad();var lat2=b.lat.toRad();var x=Math.sin(dLat/2)*Math.sin(dLat/2)+Math.sin(dLon/2)*Math.sin(dLon/2)*Math.cos(lat1)*Math.cos(lat2);
var y=2*Math.atan2(Math.sqrt(x),Math.sqrt(1-x));var d=EARTH_RADIUS*y;return d;};return{transformToPolygon:transformToPolygon,computeDistance:computeDistance};
}());Spotfire.Visuals.MapChartVisualization.initialize=function(id){var viewport=$("#"+id);var mapChart=new MapChartObject(id);
viewport.data("MapChart",mapChart);};Spotfire.Visuals.MapChartVisualization.update=function(id,generation){var viewport=$("#"+id);
var mapChart=viewport.data("MapChart");if(mapChart){var args={generation:generation};Spotfire.Dxp.Web.Forms.AjaxService.Read(id,"MapChartData",JSON.stringify(args),function(data){mapChart.doUpdate(generation,data);
});}};MapChartObject=function(id){var viewport=$("#"+id);var widgets=[];var navigationWidgetPlaceholder;
var layerHandlerWidgetPlaceholder;var interativLayer;var panelMaps=[];var lastUpdateGeneration;var trellis=viewport.data("TrellisPlot");
var initInteractivLayer;var initNavigationWidget;var initLayerHandlerWidget;var initScrollZoom;interativLayer=viewport;
var waitingPanels=0;viewport.parent().css("overflow","hidden");this.reportProgress=function(finished,generation){if(lastUpdateGeneration!==generation){return;
}if(!finished){waitingPanels++;}else{waitingPanels--;}if(waitingPanels===0){var args={generation:generation};
Spotfire.Dxp.Web.Forms.AjaxService.Read(id,"ReadyForPickAndMark",JSON.stringify(args));viewport.children("div").each(function(){if($(this).attr("remove")){$(this).find("img").attr("src","");
$(this).find("img").remove();$(this).get(0).innerHTML="";$(this).remove();}else{if(!$(this).attr("progress")){$(this).css("visibility","visible");
}}});if(trellis){trellis.hideProgressOverlay();}}};this.addMap=function(map){panelMaps.push(map);};this.getFirstMap=function(){return panelMaps[0];
};var quickZoom=function(steps,absoluteValue){if(panelMaps&&panelMaps.length>0){$.each(panelMaps,function(mapIndex,map){if(absoluteValue){map.zoomAround(map.calculateCenter(),steps,false);
}else{var oldZoomLevel=map.getZoom();map.zoomAround(map.calculateCenter(),oldZoomLevel-steps,true);}});
}};this.doUpdate=function(generation,data){lastUpdateGeneration=generation;if(!data){return;}waitingPanels=0;
var i;for(i=0;i<widgets.length;i++){widgets[i]=null;}widgets=[];viewport.unbind();panelMaps=[];Spotfire.Focus.handleKeyDown(viewport,function(e){var keyArgs={keyCode:e.keyCode,shiftKey:e.shiftKey,ctrlKey:e.ctrlKey};
Spotfire.Dxp.Web.Forms.AjaxService.Modify(id,"KeyDown",JSON.stringify(keyArgs));});viewport.children("div").each(function(){if($(this).attr("panel")===undefined&&$(this).attr("widget")!==undefined){$(this).get(0).innerHTML="";
$(this).remove();}});initInteractivLayer(generation,data);if(data.showNavigationControls||data.showNavigationMode){if(navigationWidgetPlaceholder){navigationWidgetPlaceholder.get(0).innerHTML="";
}navigationWidgetPlaceholder=$("<div></div>");navigationWidgetPlaceholder.attr("widget",true);navigationWidgetPlaceholder.attr("id",id+"_navWidget");
viewport.append(navigationWidgetPlaceholder);initNavigationWidget(data.NavigationWidgetData,generation);
widgets.push(navigationWidgetPlaceholder);}if(data.showLayerHandler){if(layerHandlerWidgetPlaceholder){layerHandlerWidgetPlaceholder.get(0).innerHTML="";
}layerHandlerWidgetPlaceholder=$("<div></div>");layerHandlerWidgetPlaceholder.attr("widget",true);viewport.append(layerHandlerWidgetPlaceholder);
initLayerHandlerWidget(data.LayerHandlerWidgetData);widgets.push(layerHandlerWidgetPlaceholder);}if(data.enableMarking){viewport.data("innerPlotBounds",new Rectangle(data.bounds.X,data.bounds.Y,data.bounds.Width,data.bounds.Height));
}if(data.postScript){eval(data.postScript);}};var mapChartEventHandler;initInteractivLayer=function(generation,data){var enableHighlight=true;
interativLayer.css("overflow","hidden");interativLayer.css("position","absolute");interativLayer.css("top",data.bounds.Y+"px");
interativLayer.css("left",data.bounds.X+"px");interativLayer.css("width",data.bounds.Width+"px");interativLayer.css("height",data.bounds.Height+"px");
interativLayer.css("cursor","default");interativLayer.addClass("mapChart noSelection");mapChartEventHandler=Spotfire.capabilities.supportsTouch()?new Spotfire.Visuals.MapChartVisualization.MapChartTouchHandler(interativLayer,widgets):new Spotfire.Visuals.MapChartVisualization.MapChartMouseHandler(interativLayer,widgets,data.editLabelPositionsMode);
mapChartEventHandler.setPanAsDeafultMode(data.panNavigationMode);if(mapChartEventHandler.rightClick){mapChartEventHandler.rightClick(function(e){var args={isMouseUp:true,x:e.clientX,y:e.clientY};
if(Spotfire.isProfessional()){PageBus.publish("spotfire.rightclick",JSON.stringify(args));}else{var pointArgs={x:e.clientX-interativLayer.offset().left,y:e.clientY-interativLayer.offset().top};
Spotfire.Dxp.Web.Forms.AjaxService.Modify(id,"ShowContextMenu",JSON.stringify(pointArgs));}});}mapChartEventHandler.pan(function(offsetX,offsetY){if(data.allowInteraction){enableHighlight=false;
viewport.css("cursor","move");var point=new T.Point(offsetX,offsetY);$.each(panelMaps,function(mapIndex,map){map.panBy(point,true);
});}});mapChartEventHandler.panStopped(function(){if(data.allowInteraction){enableHighlight=true;viewport.css("cursor","default");
var map=panelMaps[0];if(map){var newCenter=map.getCenter();if(panelMaps[0].useNoneCrs){var bounds=panelMaps[0].startingBounds;
var oldCenterX=(bounds.getEast()+bounds.getWest())/2;var oldCenterY=(bounds.getNorth()+bounds.getSouth())/2;
var offsetX=newCenter.lng-oldCenterX;var offsetY=newCenter.lat-oldCenterY;newCenter.lng=offsetX/(bounds.getEast()-bounds.getWest());
newCenter.lat=(offsetY/(bounds.getSouth()-bounds.getNorth()))*-1;}var args={x:newCenter.lng,y:newCenter.lat,generation:generation};
Spotfire.Dxp.Web.Forms.AjaxService.Modify(id,"SetCenter",JSON.stringify(args));}}});mapChartEventHandler.startMarking(function(event){if(data.enableMarking){var markCallback=function(method,args){args.generation=generation;
Spotfire.Dxp.Web.Forms.AjaxService.Modify(id,method,JSON.stringify(args));};var moveCallback=function(center,point,isCircle){var mapChart=$("#"+id).data("MapChart").getFirstMap();
if(!mapChart||mapChart.useNoneCrs||mapChart.options.crs.code!=="EPSG:3857"||data.isTrellis){return null;
}var distance=MapCircleCalculations.computeDistance(mapChart,center,point);var polygons=null;if(isCircle){polygons=MapCircleCalculations.transformToPolygon(mapChart,center,point,viewport);
}var label="km";var kmToMCuttoff=10;var milesToFtCuttoff=2;if(data.useMetricUnits){if(distance>=kmToMCuttoff){distance=Math.round(distance);
}else{distance=Math.round(distance*1000);label="m";}}else{var kmToMiles=0.621371;var kmToFeet=3280.84;
if(Math.round(distance*kmToMiles)>=milesToFtCuttoff){distance=Math.round(distance*kmToMiles);label="miles";
}else{distance=Math.round(distance*kmToFeet);label="ft";}}return{value:distance,label:label,polygons:polygons};
};Spotfire.Visuals.Marking.onMouseDown(event,viewport,true,markCallback,null,data.markingMode,moveCallback,data.markingStyle);
}});mapChartEventHandler.clickMarking(function(point,eCtrl){if(data.enableMarking){var marking={};marking.AltMode=false;
marking.AlongAxisMarking=false;marking.Points=[point];marking.IsRectangleMarking=false;marking.generation=generation;
Spotfire.Dxp.Web.Forms.AjaxService.Modify(id,eCtrl?"MarkAdd":"MarkReplace",JSON.stringify(marking));}});
mapChartEventHandler.clickZoomIn(function(point){if(data.allowInteraction){data.allowInteraction=false;
quickZoom(-1);}var args={generation:generation,x:point.x,y:point.y,zoom:1};Spotfire.Dxp.Web.Forms.AjaxService.Modify(id,"ScrollZoom",JSON.stringify(args));
});if(mapChartEventHandler.clickZoomOut){mapChartEventHandler.clickZoomOut(function(point){if(data.allowInteraction){data.allowInteraction=false;
quickZoom(1);}var args={generation:generation,x:point.x,y:point.y,zoom:-1};Spotfire.Dxp.Web.Forms.AjaxService.Modify(id,"ScrollZoom",JSON.stringify(args));
});}if(mapChartEventHandler.quickZoom){mapChartEventHandler.quickZoom(function(value){if(data.allowInteraction){data.allowInteraction=false;
quickZoom(value);}});}if(mapChartEventHandler.zoomStopped){mapChartEventHandler.zoomStopped(function(){if(panelMaps&&panelMaps.length>0){var args={generation:generation,zoom:panelMaps[0].getZoom()};
Spotfire.Dxp.Web.Forms.AjaxService.Modify(id,"ZoomTo",JSON.stringify(args));}});}if(!Spotfire.capabilities.supportsTouch()){initScrollZoom(generation,data);
}var highlightTimeout;var tooltipTimeout;var highlightDelay=250;if(Spotfire.isProfessional()){highlightDelay=20;
}var tooltipDelay=250;if(Spotfire.Web!==undefined){tooltipDelay=Spotfire.Web.tooltipDelay;}var mouseOverPoint;
var tooltipPoint;var isLeftMouseButtonDown=false;var handleHighlight=function(){clearTimeout(highlightTimeout);
var offset=viewport.offset();var x=mouseOverPoint.x-offset.left;var y=mouseOverPoint.y-offset.top;var highlightPoint=new Point(x,y);
var args={highlightPoint:highlightPoint,generation:generation};if(enableHighlight){Spotfire.Dxp.Web.Forms.AjaxService.Read(id,"Highlight",JSON.stringify(args));
}};var handleMouseDown=function(e){isLeftMouseButtonDown=Spotfire.Touch.leftMouseButtonDown(e);};var handleMouseUp=function(e){isLeftMouseButtonDown=false;
};var handleMouseLeave=function(e){viewport.data("tooltip",false);clearTimeout(highlightTimeout);clearTimeout(tooltipTimeout);
if(Spotfire.isProfessional()){Spotfire.Visuals.Tooltip.hide();}Spotfire.Dxp.Web.Forms.AjaxService.Modify(id,"ClearHighlight","{}");
};var handleMouseEnter=function(e){viewport.data("tooltip",true);};var handleMouseMove=function(e){clearTimeout(highlightTimeout);
if(isLeftMouseButtonDown){return true;}var point=new Point(e.clientX,e.clientY);if(mouseOverPoint!==undefined&&point.equals(mouseOverPoint)){return false;
}clearTimeout(tooltipTimeout);highlightTimeout=setTimeout(handleHighlight,highlightDelay);mouseOverPoint=point;
var getTooltip=function(){if(!viewport.data("tooltip")){return;}if(mouseOverPoint===undefined||!point.equals(mouseOverPoint)){return;
}var getTooltipCallback=function(tooltipText){if(!viewport.data("tooltip")){return;}Spotfire.Visuals.Tooltip.showHtml(tooltipText);
window.setTimeout(function(){var hideTooltip=function(evt){var currentPoint=new Point(evt.clientX,evt.clientY);
if(tooltipPoint!==undefined&&currentPoint.equals(tooltipPoint)){return false;}$(document.body).unbind("mousemove",hideTooltip);
Spotfire.Visuals.Tooltip.hide();return true;};$(document.body).bind("mousemove",hideTooltip);},100);};
var offset=viewport.offset();var x=e.clientX-offset.left;var y=e.clientY-offset.top;tooltipPoint=mouseOverPoint;
var args={generation:generation,x:x,y:y};Spotfire.Dxp.Web.Forms.AjaxService.Read(id,"GetTooltip",JSON.stringify(args),getTooltipCallback);
if(Spotfire.isWebPlayer()){handleHighlight();}};tooltipTimeout=setTimeout(getTooltip,tooltipDelay);return true;
};if(!Spotfire.capabilities.supportsTouch()){interativLayer.mousemove(handleMouseMove);interativLayer.mousedown(handleMouseDown);
interativLayer.mouseup(handleMouseUp);interativLayer.mouseleave(handleMouseLeave);interativLayer.mouseenter(handleMouseEnter);
}};initNavigationWidget=function(data,generation){var navDiv=navigationWidgetPlaceholder;var marginTop=data.reservedAreaAtTop||19;
if(marginTop<19){marginTop=19;}var marginLeft=19;var navigationSize=60;navDiv.css("position","absolute");
if(data.navigationControlToRight){navDiv.css("right",marginLeft+"px");}else{navDiv.css("left",marginLeft+"px");
}navDiv.css("top",marginTop+"px");navDiv.css("width",navigationSize+"px");var navControl=new Spotfire.Visuals.MapChartVisualization.NavigationWidget(id+"_navWidget",{width:navigationSize,maxHeight:data.maxHeight,top:marginTop,panNavigationMode:data.panNavigationMode,markingMode:data.markingMode,showNavigationControl:data.showNavigationControls,showNavigationMode:data.showNavigationMode,isMobile:Spotfire.capabilities.supportsTouch(),navigationHelpText:data.helpText,disabled:data.allowInteraction,backgroundColor:data.backgroundColor,borderColor:data.borderColor,borderAlpha:data.borderAlpha,defaultColor:data.defaultColor,selectedColor:data.selectedColor,hoverColor:data.hoverColor,hoverBackgroundColor:data.hoverBackgroundColor,disabledColor:data.disabledColor,iconBackgroundColor:data.iconBackgroundColor,iconBorderColor:data.iconBorderColor,markingRectangle:data.markingRectangle,markingLasso:data.markingLasso,markingCircle:data.markingCircle,menuColor:data.menuColor,menuBackgroundColor:data.menuBackgroundColor,menuBorderColor:data.menuBorderColor,menuHoverBackgroundColor:data.menuHoverBackgroundColor,enableZoomIn:data.enableZoomIn,enableZoomOut:data.enableZoomOut},data.minLevel,data.maxLevel,data.currentZoomLevel);
navDiv.css("height",navControl.getHeight()+"px");if(data.showNavigationMode){navControl.navigationModeChanged(function(panNavigationMode){mapChartEventHandler.setPanAsDeafultMode(panNavigationMode);
var args={panNavigationMode:panNavigationMode};Spotfire.Dxp.Web.Forms.AjaxService.Modify(id,"SetPanAsDefaultMode",JSON.stringify(args));
});navControl.markingModeChanged(function(mode){var args={markingMode:mode};Spotfire.Dxp.Web.Forms.AjaxService.Modify(id,"SetMarkingMode",JSON.stringify(args));
});Spotfire.Focus.handleKeyDown(viewport,function(e){if(e.shiftKey){navControl.changeMarkingIcon(Spotfire.Visuals.Marking.Types.CIRCLE);
}else{if(e.altKey){navControl.changeMarkingIcon(Spotfire.Visuals.Marking.Types.LASSO);}}});Spotfire.Focus.handleKeyUp(viewport,function(e){if(e.keyCode===16||e.keyCode===18){navControl.changeMarkingIcon(null);
}});}if(data.showNavigationControls){navControl.reset(function(){var args={generation:generation};Spotfire.Dxp.Web.Forms.AjaxService.Modify(id,"Reset",JSON.stringify(args));
});navControl.panLeft(function(){var args={generation:generation};Spotfire.Dxp.Web.Forms.AjaxService.Modify(id,"MoveLeft",JSON.stringify(args));
});navControl.panRight(function(){var args={generation:generation};Spotfire.Dxp.Web.Forms.AjaxService.Modify(id,"MoveRight",JSON.stringify(args));
});navControl.panDown(function(){var args={generation:generation};Spotfire.Dxp.Web.Forms.AjaxService.Modify(id,"MoveDown",JSON.stringify(args));
});navControl.panUp(function(){var args={generation:generation};Spotfire.Dxp.Web.Forms.AjaxService.Modify(id,"MoveUp",JSON.stringify(args));
});navControl.zoomIn(function(value){quickZoom(-1);var args={generation:generation};Spotfire.Dxp.Web.Forms.AjaxService.Modify(id,"ZoomIn",JSON.stringify(args));
});navControl.zoomOut(function(value){quickZoom(1);var args={generation:generation};Spotfire.Dxp.Web.Forms.AjaxService.Modify(id,"ZoomOut",JSON.stringify(args));
});navControl.zoomStopped(function(value){var args={generation:generation,zoom:value};Spotfire.Dxp.Web.Forms.AjaxService.Modify(id,"ZoomTo",JSON.stringify(args));
});navControl.zoomChange(function(value){quickZoom(Math.round(value),true);});navControl.setEnableReset(data.enableReset);
navControl.setEnableZoomIn(data.enableZoomIn);navControl.setEnableZoomOut(data.enableZoomOut);navControl.setEnableRight(data.enablePanRight);
navControl.setEnableLeft(data.enablePanLeft);navControl.setEnableUp(data.enablePanUp);navControl.setEnableDown(data.enablePanDown);
}};initLayerHandlerWidget=function(data){var layDiv=layerHandlerWidgetPlaceholder;var marginTop=data.reservedAreaAtTop||19;
if(marginTop<19){marginTop=19;}var marginLeft=19;var size=182;var maxHeight=data.maxHeight-marginTop*2;
layDiv.attr("id",id+"_layerWidget");layDiv.css("position","absolute");if(data.layerControlToRight){layDiv.css("right",marginLeft+"px");
}else{layDiv.css("left",marginLeft+"px");}layDiv.css("top",marginTop+"px");layDiv.css("width",size+"px");
var options={};options.title=data.title;options.nameTitle=data.nameTitle;options.width=size;options.maxHeight=maxHeight;
options.expanded=data.expandLayerHandler;options.isMobile=Spotfire.capabilities.supportsTouch();options.helpInteractive=data.helpInteractive;
options.helpVisibility=data.helpVisibility;options.headerBackgroundColor=data.headerBackgroundColor;options.headerColor=data.headerColor;
options.backgroundColor=data.backgroundColor;options.defaultColor=data.defaultColor;options.borderColor=data.borderColor;
options.hoverBackgroundColor=data.hoverBackgroundColor;options.checkboxColor=data.checkboxColor;options.checkboxBackgroundColor=data.checkboxBackgroundColor;
options.checkboxBorderColor=data.checkboxBorderColor;options.iconBackgroundColor=data.iconBackgroundColor;
options.iconBorderColor=data.iconBorderColor;var layerHandler=new Spotfire.Visuals.MapChartVisualization.LayerHandlerWidget(id+"_layerWidget",options,data.layers);
layerHandler.interactiveChanged(function(layerId){var args={layerId:layerId};Spotfire.Dxp.Web.Forms.AjaxService.Modify(id,"InteractiveChanged",JSON.stringify(args));
});layerHandler.visiblityChanged(function(layerId,isChecked){var args={layerId:layerId,isChecked:isChecked};
Spotfire.Dxp.Web.Forms.AjaxService.Modify(id,"VisibilityChanged",JSON.stringify(args));});layerHandler.expandChanged(function(isExpanded){var args={isExpanded:isExpanded};
Spotfire.Dxp.Web.Forms.AjaxService.Modify(id,"SetLayerHandlerShowHide",JSON.stringify(args));});if(layerHandler.rightClick){layerHandler.rightClick(function(layerId,x,y){var args={isMouseUp:true,viewId:id,layerId:layerId,x:x,y:y};
if(Spotfire.isProfessional()){PageBus.publish("spotfire.rightclick",JSON.stringify(args));}});}};initScrollZoom=function(generation,data){var scrollDeltaY=0;
var startedScrolling=false;var mouseX,mouseY;var scrollEvent;var args;var doMouseWheelScroll=function(){if(data.allowScrollPage&&!scrollEvent.shiftKey){args={pages:scrollDeltaY};
Spotfire.Dxp.Web.Forms.AjaxService.Modify(id,"ScrollPage",JSON.stringify(args));}else{if(scrollEvent.shiftKey){args={delta:(scrollDeltaY*-1)};
if(Spotfire.isProfessional()){Spotfire.Dxp.Web.Forms.AjaxService.Modify(id,"ScrollMarkerSize",JSON.stringify(args));
}}else{if(data.allowInteraction){args={generation:generation,x:mouseX,y:mouseY,zoom:(scrollDeltaY*-1)};
var enableZoom=args.zoom>0?data.enableZoomIn:data.enableZoomOut;if(enableZoom){var $target=$(scrollEvent.currentTarget);
var x=args.x;var y=args.y;$target.children().each(function(index,child){var $child=$(child);var panelIndex=0;
if($child.attr("panel")){if($child.position().left<x&&$child.position().top<y&&$child.width()>x-$child.position().left&&$child.height()>y-$child.position().top){var panelMap=panelMaps[panelIndex];
if(!panelMap){return;}var zoom=panelMap.getZoom()-scrollDeltaY;var mousePosition=new T.Point(x+2,y+2);
mousePosition.x=mousePosition.x-$child.position().left;mousePosition.y=mousePosition.y-$child.position().top;
var point=panelMap.unproject(mousePosition.add(panelMap.getTopLeftInPixels()));$.each(panelMaps,function(mapIndex,map){map.zoomAround(point,zoom,true);
});data.allowInteraction=false;}panelIndex++;}});Spotfire.Dxp.Web.Forms.AjaxService.Modify(id,"ScrollZoom",JSON.stringify(args));
}}}}startedScrolling=false;scrollDeltaY=0;};var handleScrollWheel=function(e){scrollEvent=e;mouseX=e.pageX-interativLayer.offset().left;
mouseY=e.pageY-interativLayer.offset().top;Spotfire.Dxp.Web.Forms.AjaxService.Modify(id,"ClearHighlight","");
Spotfire.Visuals.Tooltip.hide();scrollDeltaY+=e.scrollWheelY;if(!startedScrolling){setTimeout(doMouseWheelScroll,10);
startedScrolling=true;}};if(!Spotfire.capabilities.supportsTouch()){interativLayer.unscrollwheel(handleScrollWheel);
interativLayer.scrollwheel(handleScrollWheel);}};};});$(function(){Spotfire.registerNameSpace("Visuals.TrellisVisualization");
var TrellisObject;Spotfire.Visuals.TrellisVisualization.initialize=function(id){var viewport=$("#"+id);
var trellis=new TrellisObject(id);viewport.data("TrellisPlot",trellis);var args={isProfessional:Spotfire.isProfessional()};
Spotfire.Dxp.Web.Forms.AjaxService.Modify(id,"Update",JSON.stringify(args));};Spotfire.Visuals.TrellisVisualization.update=function(id,generation){var viewport=$("#"+id);
var trellis=viewport.data("TrellisPlot");if(trellis){trellis.showProgressOverlay();var args={generation:generation};
Spotfire.Dxp.Web.Forms.AjaxService.Read(id,"ReadTrellisData",JSON.stringify(args),function(data){trellis.doUpdate(data,generation);
});}};TrellisObject=function(id){var viewport=$("#"+id);viewport.css("width","100%");viewport.css("height","100%");
var $background;var createSubPanel;this.doUpdate=function(data,generation){if(!data){return;}viewport.children("div").each(function(){if($(this).attr("panel")!==undefined){if(data.clearView){$(this).get(0).innerHTML="";
$(this).remove();}else{$(this).attr("id","-1");$(this).attr("remove",true);}}});var $curtain=$("<div></div>");
$curtain.addClass("trellisVisualization curtain");$curtain.css("background-color",data.backgroundColor);
$curtain.attr("remove",true);$curtain.prependTo(viewport);if($background&&data.panels.length===0){$background.get(0).innerHTML="";
$background.remove();}else{if($background&&data.panels.length!==0){$background.attr("remove",true);}}$background=$("<div></div>");
$background.addClass("trellisVisualization trellisBackground");$background.css("background-image","url("+data.url+")");
$background.css("visibility","hidden");var panelIndex;for(panelIndex=0;panelIndex<data.panels.length;
panelIndex++){createSubPanel(viewport,data.panels[panelIndex]);}$background.prependTo(viewport);if(data.panels.length===0){$background.css("visibility","visible");
$curtain.remove();this.hideProgressOverlay();}if(data.postScript){eval(data.postScript);}if(data.updateLegend){Spotfire.Visuals.onUpdateLegend(viewport,{});
}};var $progressOverlay=null;var progressTimer=null;this.hideProgressOverlay=function(){if(progressTimer!==null){window.clearTimeout(progressTimer);
progressTimer=null;}$progressOverlay.css("visibility","hidden");$progressOverlay.detach();};this.showProgressOverlay=function(){if($progressOverlay!==null){$progressOverlay.remove();
}$progressOverlay=$(Spotfire.Progress.createProgressAnimation(viewport.innerWidth(),viewport.innerHeight()));
$progressOverlay.attr("progress",true);$progressOverlay.css("visibility","hidden");var isProgressAppended=function(){return viewport.children(".progressAnimation").length!==0;
};if(!isProgressAppended()){if(progressTimer!==null){window.clearTimeout(progressTimer);progressTimer=null;
}var showProgressInternal=function(){progressTimer=null;$progressOverlay.css("visibility","visible");
};progressTimer=window.setTimeout(showProgressInternal,1000);$progressOverlay.css("visibility","hidden");
viewport.append($progressOverlay);}};createSubPanel=function(parent,subPanel){var panel=$("<div></div>");
panel.attr("id",subPanel.parentId+subPanel.panelIndex);panel.css("overflow","hidden");panel.css("position","absolute");
panel.css("top",subPanel.bounds.Y+"px");panel.css("left",subPanel.bounds.X+"px");panel.css("width",subPanel.bounds.Width+"px");
panel.css("height",subPanel.bounds.Height+"px");panel.attr("panel",subPanel.panelIndex);panel.prependTo(parent);
panel.css("visibility","hidden");return panel;};};});$(function(){Spotfire.registerNameSpace("Visuals.MapChartVisualization");
Spotfire.Visuals.MapChartVisualization.LayerHandlerWidget=function(containerId,options,layers){var isExpanded=options.expanded===undefined?false:options.expanded;
var headerWidth=91;options.title=options.title===undefined?"":options.title;options.width=options.width===undefined?150:options.width;
options.maxHeight=options.maxHeight===undefined?500:options.maxHeight;options.isMobile=options.isMobile===undefined?false:options.isMobile;
options.colors={headerBackground:options.headerBackgroundColor,header:options.headerColor,background:options.backgroundColor,"default":options.defaultColor,border:options.borderColor,hoverBackground:options.hoverBackgroundColor,checkbox:options.checkboxColor,checkboxBackground:options.checkboxBackgroundColor,checkboxBorder:options.checkboxBorderColor,checkboxDisabledOpacity:"0.5",iconBackground:options.iconBackgroundColor,iconBorder:options.iconBorderColor};
var interactiveChangedInternal,visibilityChangedInternal,expandChangedInternal,rightClickInternal;this.interactiveChanged=function(func){interactiveChangedInternal=func;
};this.visiblityChanged=function(func){visibilityChangedInternal=func;};this.expandChanged=function(func){expandChangedInternal=func;
};this.rightClick=function(func){rightClickInternal=func;};var baseViewport=$("#"+containerId);if(!baseViewport){throw ("Container id did not match any node in DOM");
}var scrollFunc=function(e){e.stopPropagation();};baseViewport.bind("DOMMouseScroll",scrollFunc);baseViewport.bind("mousewheel",scrollFunc);
baseViewport.onmousewheel=scrollFunc;var viewport=$(document.createElement("div"));baseViewport.empty();
baseViewport.append(viewport);viewport.css("position","relative");viewport.css("width",options.width);
var titleDiv;var layerFrame;var headerDiv;var layerHolder;var layerHolderContainer;var headerImage;var initHeader;
var initLayers;var position;var rawPosition;var htmlEncode;var titleHeight=29;viewport.css("height",titleHeight+"px");
function handleInteractiveChange(){var radio=$(this);if(!radio.hasClass("radio")){radio=$(this).children(".radio").first();
}$("svg",layerFrame.find(".layerHandlerWidget.radio")).hide();$("svg",radio).show();var id=radio.data("id");
if(interactiveChangedInternal){interactiveChangedInternal(id);}return false;}function handleVisibilityChange(e){e.stopPropagation();
var checkbox=$(this);checkbox.css("opacity",options.colors.checkboxDisabledOpacity);var id=checkbox.data("id");
if(visibilityChangedInternal){var isVisible=!checkbox.data("checked");checkbox.data("checked",isVisible);
this.checked=isVisible;visibilityChangedInternal(id,isVisible);}return false;}function show(){var rowHeight=26;
var preferedHeight=(layers.length+1)*rowHeight+titleHeight;headerImage.addClass("expanded");viewport.css("height",preferedHeight+"px");
layerFrame=$("<div></div>");layerFrame.css("overflow","hidden");layerFrame.addClass("layerHandlerWidget layerBox noSelection");
layerFrame.css("position","absolute");layerFrame.css("left","0px");layerFrame.css("background-color",options.colors.background);
layerFrame.css("color",options.colors["default"]);layerFrame.css("border-color",options.colors.border);
var y=titleHeight+"px";var w=options.width-1+"px";layerFrame.css("top",y);var h=(layers.length+1)*rowHeight+1+"px";
layerFrame.css("height",h);layerFrame.css("width",w);viewport.append(layerFrame);headerDiv=$("<div></div>");
layerFrame.append(headerDiv);initHeader(rowHeight);initLayers(rowHeight);if(expandChangedInternal){expandChangedInternal(true);
}}function hide(){viewport.css("height",titleHeight+"pt");headerImage.removeClass("expanded");if(layerFrame){layerFrame.remove();
}if(expandChangedInternal){expandChangedInternal(false);}}function handleShowHideLayerHandler(){isExpanded=!isExpanded;
if(isExpanded){show();}else{hide();}return false;}function getSvg(url,element){Spotfire.getSvg(url,(function($el){return function($svg){$el.append($svg);
};}(element)));}initLayers=function(height){var marginTop=6;var eventName="click";if(options.isMobile){eventName="touchstart";
}layerHolder=$("<div></div>");layerHolderContainer=$("<div></div>");rawPosition(layerHolder,"0px",height+"px",options.width-1+"px",layers.length*height+1+"px");
layerHolderContainer.css("position","absolute");layerHolderContainer.css("cursor","default");layerHolder.append(layerHolderContainer);
layerFrame.append(layerHolder);var addScroll=height*(layers.length+1)+titleHeight>options.maxHeight;layerHolder.css("overflow",addScroll?"auto":"hidden");
var enterEvent=function(){$(this).css("background-color",options.colors.hoverBackground);};var leaveEvent=function(){$(this).css("background-color","inherit");
};var downEvent=function(e){if(Spotfire.Touch.rightMouseButtonDown(e)&&rightClickInternal){rightClickInternal($(this).data("id"),e.clientX,e.clientY);
}};var offsetY=1;var index,layer,rowDiv,column1,column2,column3,encodedName,noOfCharToRemove;for(index=0;
index<layers.length;index++){layer=layers[index];rowDiv=$("<div></div>");rawPosition(rowDiv,"0px",offsetY+"px",options.width-(addScroll?19:1)+"px",height+"px");
rowDiv.addClass("layerHandlerWidget row");layerHolderContainer.append(rowDiv);rowDiv.data("id",layer.id);
rowDiv.mouseenter(enterEvent);rowDiv.mouseleave(leaveEvent);rowDiv.mousedown(downEvent);if(layer.allowInteractive){column1=Spotfire.Filters.StyledFilters.createSvgRadio(13,13);
column1.css("color",options.colors.checkbox);column1.css("background-image",options.colors.checkboxBackground);
column1.css("border-color",options.colors.checkboxBorder);if(!layer.isInteractive){$("svg",column1).hide();
}column1.removeClass("sf-element");column1.addClass("layerHandlerWidget radio");column1.data("id",layer.id);
if(!layer.enable||!layer.visible){column1.css("opacity",options.colors.checkboxDisabledOpacity);}else{rowDiv.bind(eventName,handleInteractiveChange);
column1.bind(eventName,handleInteractiveChange);}rawPosition(column1,marginTop-1+"px",marginTop+"px","11px","11px");
rowDiv.append(column1);}column2=$("<div></div>");column2.addClass("layerHandlerWidget checkbox");column2.data("checked",layer.enable);
column2.css("color",options.colors.checkbox);column2.css("background-image",options.colors.checkboxBackground);
column2.css("border-color",options.colors.checkboxBorder);if(layer.enable){getSvg("Images/Filters/CheckMark.svg",column2);
}if(layer.visible){column2.bind(eventName,handleVisibilityChange);}else{column2.css("opacity",options.colors.checkboxDisabledOpacity);
}column2.data("id",layer.id);column2.attr("type","checkbox");rawPosition(column2,24+marginTop-1+"px",marginTop+"px","11px","11px");
rowDiv.append(column2);column3=$("<div></div>");column3.addClass("layerHandlerWidget displayName");if(!layer.visible){column3.addClass(" disabled");
}encodedName=htmlEncode(layer.name);column3.html(encodedName);column3.css("vertical-align","bottom");
rawPosition(column3,48+marginTop+"px",(marginTop+1)+"px",options.width-48-marginTop*2-(addScroll?18:0)+"px",height-marginTop+"px");
column3.css("width","auto");rowDiv.append(column3);noOfCharToRemove=1;while(column3[0].clientWidth>options.width-48-marginTop*2-(addScroll?20:0)){column3.attr("title",encodedName);
column3.html(encodedName.substring(0,(addScroll?16-noOfCharToRemove:20-noOfCharToRemove))+"...");noOfCharToRemove++;
}offsetY+=height;}if(addScroll){viewport.css("height",options.maxHeight+"px");layerFrame.css("height",options.maxHeight-titleDiv.outerHeight()+"px");
layerHolder.css("height",(options.maxHeight-titleDiv.outerHeight()-headerDiv.outerHeight())+"px");if(options.isMobile){layerHolder.css("overflow","scroll");
layerHolderContainer.css("height",layers.length*height+"px");var scroll=new IScroll(layerHolderContainer.get(0),layerHolder.get(0),{bounce:false,hScrollbarEnabled:false,vScrollbarEnabled:true});
scroll.refresh();}}};htmlEncode=function(html){return document.createElement("a").appendChild(document.createTextNode(html)).parentNode.innerHTML;
};initHeader=function(height){rawPosition(headerDiv,"0px","0px",options.width-1+"px",height+"px");headerDiv.addClass("layerHandlerWidget header noSelection");
headerDiv.css("border-color",options.colors.border);var headerColumn1=$("<div></div>");headerColumn1.on("dragstart",function(event){event.preventDefault();
});Spotfire.getSvg("Images/Plots/WebMapChart/LayerHandlerWidget/Pointer.svg",(function($cb){return function($svg){$svg.find("[class=background]").css("fill",options.colors.iconBackground);
$svg.find("[class=border]").css("fill",options.colors.iconBorder);$cb.append($svg);};}(headerColumn1)));
headerColumn1.attr("title",options.helpInteractive);rawPosition(headerColumn1,"8px",(height-14)/2+"px","8px","14px");
headerDiv.append(headerColumn1);var headerColumn2=$("<div></div>");headerColumn2.on("dragstart",function(event){event.preventDefault();
});Spotfire.getSvg("Images/Plots/WebMapChart/LayerHandlerWidget/Eye.svg",(function($cb){return function($svg){$svg.find("[class=background]").css("fill",options.colors.iconBorder);
$cb.append($svg);};}(headerColumn2)));headerColumn2.attr("title",options.helpVisibility);rawPosition(headerColumn2,24+5+"px",(height-8)/2+"px","14px","8px");
headerDiv.append(headerColumn2);var headerColumn3=$("<div></div>");headerColumn3.text(options.nameTitle);
rawPosition(headerColumn3,48+4+"px",(height-12)/2+"px",options.width-56+"px",12+"pt");headerDiv.append(headerColumn3);
};function initTextTitle(clickFunction,height){titleDiv=$("<div></div>");var mouseDownFunction=function(e){if(Spotfire.Touch.leftMouseButtonDown(e)){Spotfire.Touch.legacyTouchMouseCapture(titleDiv,function(){return;
},clickFunction);}};if(options.isMobile){titleDiv.bind("touchstart",mouseDownFunction);}else{titleDiv.mousedown(mouseDownFunction);
}titleDiv.text(options.title);titleDiv.addClass("layerHandlerWidget textHeader");titleDiv.css("background-color",options.colors.headerBackground);
titleDiv.css("color",options.colors.header);titleDiv.css("border-color",options.colors.border);position(titleDiv,0,0,headerWidth-14,0);
titleDiv.css("height",height-14+"px");viewport.append(titleDiv);headerImage=$("<div></div>");headerImage.addClass("layer-arrow");
if(options.expanded){headerImage.addClass("expanded");}else{headerImage.removeClass("expanded");}rawPosition(headerImage,"9px","7px","7px","7px",true);
titleDiv.append(headerImage);}position=function(element,x,y,width,height,useRightInsteadOfLeft){rawPosition(element,x+"px",y+"px",width+"px",height+"px",useRightInsteadOfLeft);
};rawPosition=function(element,x,y,width,height,useRightInsteadOfLeft){element.css("position","absolute");
element.css("top",y);if(useRightInsteadOfLeft){element.css("right",x);}else{element.css("left",x);}element.css("width",width);
element.css("height",height);};initTextTitle(handleShowHideLayerHandler,titleHeight);if(options.expanded){show();
}};});$(function(){Spotfire.registerNameSpace("Visuals.MapChartVisualization");Spotfire.Visuals.MapChartVisualization.NavigationWidget=function(containerId,options,minLevel,maxLevel,activeZoomLevel){var colors={"default":options.defaultColor,hover:options.hoverColor,hoverBackground:options.hoverBackgroundColor,selected:options.selectedColor,disabled:options.disabledColor,background:options.backgroundColor,border:options.borderColor,borderAlpha:options.borderAlpha.toString(),iconBackground:options.iconBackgroundColor,iconBorder:options.iconBorderColor,menu:options.menuColor,menuBackground:options.menuBackgroundColor,menuBorder:options.menuBorderColor,menuHoverBackground:options.menuHoverBackgroundColor};
var zoomLevels=maxLevel-minLevel+1;var navigationWidget=this;var isZooming=false;var marginBetweenNavZoomMode=5;
var navContainer=$("#"+containerId);navContainer.empty();var eventName=options.isMobile?"touchstart":"click";
var rootNavWid=$("<div></div>");rootNavWid.addClass("navigation-widget");var boxHeight=(1.5*options.width)+marginBetweenNavZoomMode+20+Math.floor(options.width/7)*zoomLevels+Math.floor(options.width/3)*2+(zoomLevels===0?3:0);
if(!options.showNavigationMode){boxHeight=options.width+marginBetweenNavZoomMode+20+Math.floor(options.width/7)*zoomLevels+Math.floor(options.width/3)*2;
}if(boxHeight+20>options.maxHeight){zoomLevels=0;boxHeight=(1.5*options.width)+marginBetweenNavZoomMode+20+Math.floor(options.width/3)*2+3;
}if(options.showNavigationMode&&!options.showNavigationControl){boxHeight=options.width/2;}this.getHeight=function(){return boxHeight;
};function position(jElement,x,y,width,height){jElement.css("position","absolute");jElement.css("top",y+"px");
jElement.css("left",x+"px");jElement.css("width",width+"px");jElement.css("height",height+"px");}position(rootNavWid,0,0,options.width,boxHeight);
var rootNav=$("<div></div>");var enableReset=true;var enableLeft=true;var enableRight=true;var enableUp=true;
var enableDown=true;var enableZoomIn=true;var enableZoomOut=true;var markingIcons=["Images/Plots/WebMapChart/NavigationWidget/MarkingRectangle.svg","Images/Plots/WebMapChart/NavigationWidget/MarkingLasso.svg","Images/Plots/WebMapChart/NavigationWidget/MarkingRadius.svg"];
var heightPerZoomLevel;var box;var zoomOutButton;var zoomInButton;var createNavigationControl;var createZoomBarControl;
var createPanNavigationModeControl;var openMarkingOptionsPopup;var measureText;var initBackgroundLayer;
var initIconLayer;var initZoomInButton;var removeHover;var addHover;var findElementAt;var updateSelectedMarkingIcon;
function ZoomLevelIndicator(size,heightPerZoomLevel,zoomLevels){var zoomStoppedFunction,zoomChangeFunction;
navigationWidget.zoomStopped=function(func){zoomStoppedFunction=func;};navigationWidget.zoomChange=function(func){zoomChangeFunction=func;
};var indicatorBox=$("<div></div>");var lastSetZoomLevel;if(zoomLevels>1){var centerLine=$("<div></div>");
centerLine.addClass("navigationWidgetNavRoot img");centerLine.css("left",size/2-3+"px");indicatorBox.append(centerLine);
Spotfire.getSvg("Images/Plots/WebMapChart/NavigationWidget/ZoomLine.svg",(function($cb){return function($svg){$("#background",$svg).css("fill",colors.background);
$("#border",$svg).css("fill",colors.border);$("#border",$svg).css("fill-opacity",Number(colors.borderAlpha)-0.2);
$svg.attr("height",Math.round(heightPerZoomLevel*zoomLevels)+2);$cb.append($svg);};}(centerLine)));box=$("<div></div>");
box.addClass("navigationWidgetNavRoot img");Spotfire.getSvg("Images/Plots/WebMapChart/NavigationWidget/ZoomThumb.svg",(function($cb){return function($svg){$cb.append($svg);
$("#background",box).css("fill",colors.background);$("#border",box).css("fill",colors.border);$("#border",box).css("fill-opacity",colors.borderAlpha);
$("#center",box).css("fill",colors["default"]);};}(box)));box.css("top","0");box.css("left","-1px");box.css("display","flex");
indicatorBox.append(box);box.hover(function(){if(enableZoomIn||enableZoomOut){$("#center",box).css("fill",colors.hover);
}},function(){if(enableZoomIn||enableZoomOut){$("#center",box).css("fill",colors["default"]);}});var downEventName=options.isMobile?"touchstart":"mousedown";
var moveEventName=options.isMobile?"touchmove":"mousemove";var upEventName=options.isMobile?"touchend":"mouseup";
var boxOffSet=0;var handleMove=function(eventMove){if(options.isMobile){eventMove.clientY=eventMove.originalEvent.touches[0].pageY;
}var mouseY=eventMove.clientY-indicatorBox.offset().top-boxOffSet;mouseY=Math.max(0,mouseY);mouseY=Math.min(mouseY,(zoomLevels-1)*heightPerZoomLevel);
box.css("top",mouseY+"px");var newZoomLevel=zoomLevels-1-mouseY/heightPerZoomLevel;if(zoomChangeFunction){zoomChangeFunction(newZoomLevel);
}};var handleMouseUp=function(eventUp){$(document).unbind(upEventName,handleMouseUp);$(document).unbind(moveEventName,handleMove);
isZooming=false;if(options.isMobile){eventUp.clientY=eventUp.originalEvent.changedTouches[0].pageY;}var mouseY=eventUp.clientY-indicatorBox.offset().top-boxOffSet;
mouseY=Math.max(0,mouseY);mouseY=Math.min(mouseY,(zoomLevels-1)*heightPerZoomLevel);var newZoomLevel=zoomLevels-1-Math.round(mouseY/heightPerZoomLevel);
var yPosition=(zoomLevels-newZoomLevel)*heightPerZoomLevel;box.css("top",yPosition+"px");lastSetZoomLevel=newZoomLevel;
if(zoomStoppedFunction){zoomStoppedFunction(newZoomLevel);}};var handleMouseDown=function(eventDown){if(enableZoomIn||enableZoomOut){if(options.isMobile){eventDown.clientY=eventDown.originalEvent.touches[0].pageY;
}isZooming=true;boxOffSet=eventDown.clientY-box.offset().top;$(document).bind(upEventName,handleMouseUp);
$(document).bind(moveEventName,handleMove);}return true;};box.bind(downEventName,handleMouseDown);}this.getIndicatorBox=function(){return indicatorBox;
};navigationWidget.setZoomLevel=function(zoomLevel){if(zoomLevel<minLevel||zoomLevel>maxLevel){return;
}lastSetZoomLevel=zoomLevel;if(zoomLevels>1){var yPosition=(maxLevel-zoomLevel)*heightPerZoomLevel;box.css("top",yPosition+"px");
}};navigationWidget.getZoomLevel=function(){return lastSetZoomLevel;};}createNavigationControl=function(jElement){var resetFunction,leftFunction,rightFunction,upFunction,downFunction;
navigationWidget.reset=function(func){resetFunction=func;};navigationWidget.panLeft=function(func){leftFunction=func;
};navigationWidget.panRight=function(func){rightFunction=func;};navigationWidget.panUp=function(func){upFunction=func;
};navigationWidget.panDown=function(func){downFunction=func;};navigationWidget.changeMarkingIcon=function(markingMode){updateSelectedMarkingIcon(markingMode,$(".markingModeIconContainer",jElement.parent()));
};var r=Math.floor(options.width/2);var backgroundLayer=initBackgroundLayer();backgroundLayer.appendTo(jElement);
var arrowObjects=initIconLayer(r);arrowObjects.iconLayer.appendTo(jElement);var lastElement=null;jElement.mouseout(function(){if(lastElement!==null){removeHover(lastElement,arrowObjects);
lastElement=null;}});var hoverFunction=function(e){var position_current={x:e.clientX-$(this).offset().left,y:e.clientY-$(this).offset().top};
var element=findElementAt(position_current,options.width);if(element!==lastElement){removeHover(lastElement,arrowObjects);
addHover(element,arrowObjects);lastElement=element;}};jElement.mousemove(hoverFunction);navigationWidget.reset();
var clickFunction=function(e){var position_current;if(options.isMobile){position_current={x:e.originalEvent.touches[0].pageX-$(this).offset().left,y:e.originalEvent.touches[0].pageY-$(this).offset().top};
}else{position_current={x:e.clientX-$(this).offset().left,y:e.clientY-$(this).offset().top};}var element=findElementAt(position_current,options.width);
if(element==="center"&&resetFunction&&enableReset){resetFunction();}if(element==="left"&&leftFunction&&enableLeft){leftFunction();
}if(element==="right"&&rightFunction&&enableRight){rightFunction();}if(element==="up"&&upFunction&&enableUp){upFunction();
}if(element==="down"&&downFunction&&enableDown){downFunction();}};jElement.bind(eventName,clickFunction);
var applyDisable=function(element,value){if(value){element.css("color",colors["default"]);}else{element.css("color",colors.disabled);
}};navigationWidget.setEnableReset=function(value){enableReset=value;applyDisable(arrowObjects.resetImg,value);
};navigationWidget.getEnableReset=function(){return enableReset;};navigationWidget.setEnableLeft=function(value){enableLeft=value;
applyDisable(arrowObjects.leftImg,value);};navigationWidget.getEnableLeft=function(){return enableLeft;
};navigationWidget.setEnableRight=function(value){enableRight=value;applyDisable(arrowObjects.rightImg,value);
};navigationWidget.getEnableRight=function(){return enableRight;};navigationWidget.setEnableUp=function(value){enableUp=value;
applyDisable(arrowObjects.upImg,value);};navigationWidget.getEnableUp=function(){return enableUp;};navigationWidget.setEnableDown=function(value){enableDown=value;
applyDisable(arrowObjects.downImg,value);};navigationWidget.getEnableDown=function(){return enableDown;
};};function initZoomOutButton(size){zoomOutButton=$("<div></div>");zoomOutButton.addClass("navigationWidgetNavRoot img zoomButton");
zoomOutButton.css("top",(marginBetweenNavZoomMode+size+(heightPerZoomLevel*zoomLevels))+(zoomLevels===0?5:2)+"px");
zoomOutButton.css("left","18px");Spotfire.getSvg("Images/Plots/WebMapChart/NavigationWidget/ZoomOut.svg",(function($cb){return function($svg){$cb.append($svg);
$("#background",zoomOutButton).css("fill",colors.background);$("#background",zoomOutButton).css("stroke",colors.border);
$("#background",zoomOutButton).css("stroke-opacity",colors.borderAlpha);$("#center",zoomOutButton).css("fill",options.enableZoomOut?colors["default"]:colors.disabled);
};}(zoomOutButton)));zoomOutButton.hover(function(){if(!isZooming&&enableZoomOut){$("#center",zoomOutButton).css("fill",colors.hover);
}},function(){if(enableZoomOut){$("#center",zoomOutButton).css("fill",colors["default"]);}});return zoomOutButton;
}initZoomInButton=function(size){zoomInButton=$("<div></div>");zoomInButton.addClass("navigationWidgetNavRoot img");
zoomInButton.css("top","3px");zoomInButton.css("left","18px");zoomInButton.css("display","flex");Spotfire.getSvg("Images/Plots/WebMapChart/NavigationWidget/ZoomIn.svg",(function($cb){return function($svg){$cb.append($svg);
$("#background",zoomInButton).css("fill",colors.background);$("#background",zoomInButton).css("stroke",colors.border);
$("#background",zoomInButton).css("stroke-opacity",colors.borderAlpha);$("#center",zoomInButton).css("fill",options.enableZoomIn?colors["default"]:colors.disabled);
};}(zoomInButton)));zoomInButton.hover(function(){if(!isZooming&&enableZoomIn){$("#center",zoomInButton).css("fill",colors.hover);
}},function(){if(enableZoomIn){$("#center",zoomInButton).css("fill",colors["default"]);}});return zoomInButton;
};removeHover=function(elementId,arrowItems){if(elementId==="center"&&enableReset){arrowItems.resetImg.css("color",colors["default"]);
}if(elementId==="right"&&enableRight){arrowItems.rightImg.css("color",colors["default"]);}if(elementId==="left"&&enableLeft){arrowItems.leftImg.css("color",colors["default"]);
}if(elementId==="up"&&enableUp){arrowItems.upImg.css("color",colors["default"]);}if(elementId==="down"&&enableDown){arrowItems.downImg.css("color",colors["default"]);
}};addHover=function(elementId,arrowItems){if(!isZooming){if(elementId==="center"&&enableReset){arrowItems.resetImg.css("color",colors.hover);
}if(elementId==="right"&&enableRight){arrowItems.rightImg.css("color",colors.hover);}if(elementId==="left"&&enableLeft){arrowItems.leftImg.css("color",colors.hover);
}if(elementId==="up"&&enableUp){arrowItems.upImg.css("color",colors.hover);}if(elementId==="down"&&enableDown){arrowItems.downImg.css("color",colors.hover);
}}};findElementAt=function(position,width){var height=width;var dy=position.y-width/2;var dx=position.x-width/2;
var r=Math.sqrt(Math.pow(dy,2)+Math.pow(dx,2));if(position.x>width/3&&position.x<(width/3)*2&&position.y>height/3&&position.y<(height/3)*2&&r<=width/6){return"center";
}if(position.x>position.y&&position.x>position.y*-1+width&&r<=width/2){return"right";}if(position.x>position.y&&position.x<=position.y*-1+width&&r<=width/2){return"up";
}if(position.x<=position.y&&position.y>position.x*-1+height&&r<=width/2){return"down";}if(position.x<=position.y&&position.y<=position.x*-1+height&&r<=width/2){return"left";
}return null;};initBackgroundLayer=function(){var backgroundLayer=$("<div></div>");backgroundLayer.css("fill",colors.background);
backgroundLayer.css("stroke",colors.border);backgroundLayer.css("stroke-opacity",colors.borderAlpha);
backgroundLayer.on("dragstart",function(event){event.preventDefault();});position(backgroundLayer,-10,-10,options.width,options.width);
Spotfire.getSvg("Images/Plots/WebMapChart/NavigationWidget/NavRoot.svg",(function(container){return function($svg){container.append($svg);
};}(backgroundLayer)));return backgroundLayer;};initIconLayer=function(){var result={};var iconLayer=$("<div></div>");
position(iconLayer,0,0,options.width,options.width);var margin=Math.floor(options.width*0.08);var upImg=$("<div></div>");
upImg.addClass("navigationWidgetNavRoot img");upImg.css("top",margin+1+"px");upImg.css("left",(options.width/2)-6+"px");
upImg.css("color",colors["default"]);upImg.appendTo(iconLayer);result.upImg=upImg;Spotfire.getSvg("Images/Plots/WebMapChart/NavigationWidget/Up.svg",(function(container){return function($svg){container.append($svg);
};}(upImg)));var leftImg=$("<div></div>");leftImg.addClass("navigationWidgetNavRoot img");leftImg.css("left",margin+3+"px");
leftImg.css("top",(options.width/2)-6+"px");leftImg.css("color",colors["default"]);leftImg.appendTo(iconLayer);
result.leftImg=leftImg;Spotfire.getSvg("Images/Plots/WebMapChart/NavigationWidget/Left.svg",(function(container){return function($svg){container.append($svg);
};}(leftImg)));var downImg=$("<div></div>");downImg.addClass("navigationWidgetNavRoot img");downImg.css("bottom",margin+1+"px");
downImg.css("left",(options.width/2)-6+"px");downImg.css("color",colors["default"]);downImg.appendTo(iconLayer);
result.downImg=downImg;Spotfire.getSvg("Images/Plots/WebMapChart/NavigationWidget/Down.svg",(function(container){return function($svg){container.append($svg);
};}(downImg)));var rightImg=$("<div></div>");rightImg.addClass("navigationWidgetNavRoot img");rightImg.css("right",margin+3+"px");
rightImg.css("top",(options.width/2)-6+"px");rightImg.css("color",colors["default"]);rightImg.appendTo(iconLayer);
result.rightImg=rightImg;Spotfire.getSvg("Images/Plots/WebMapChart/NavigationWidget/Right.svg",(function(container){return function($svg){container.append($svg);
};}(rightImg)));var resetImg=$("<div></div>");resetImg.addClass("navigationWidgetNavRoot img");resetImg.css("top",(options.width/2)-6+"px");
resetImg.css("left",(options.width/2)-4+"px");resetImg.css("color",colors["default"]);resetImg.appendTo(iconLayer);
result.resetImg=resetImg;Spotfire.getSvg("Images/Plots/WebMapChart/NavigationWidget/Reset.svg",(function(container){return function($svg){container.append($svg);
};}(resetImg)));result.iconLayer=iconLayer;return result;};updateSelectedMarkingIcon=function(markingMode,container){if($("svg",container).length>1){($("svg",container)[0]).remove();
}if(options.isMobile){Spotfire.getSvg(markingIcons[1],function($svg){container.prepend($svg);});}else{if(markingMode){Spotfire.getSvg(markingIcons[markingMode],function($svg){container.prepend($svg);
});}else{Spotfire.getSvg(markingIcons[options.markingMode],function($svg){container.prepend($svg);});
}}};measureText=function(element){var font=window.getComputedStyle(element,null).getPropertyValue("font");
var measureDiv=$("<div>"+element.innerHTML+"</div>");measureDiv.css({position:"absolute","float":"left","white-space":"nowrap",visibility:"hidden",font:font});
measureDiv.appendTo($("body"));var width=measureDiv.width();measureDiv.remove();return width;};openMarkingOptionsPopup=function(jElement,markingModeChangeEvent){if($(".markingOptionsPopup").length>0){return;
}var popup=$("<div></div>");popup.addClass("markingOptionsPopup");popup.css("background-color",colors.menuBackground);
popup.css("border-color",colors.menuBorder);var createOption=function(markingText,markingIconUrl,markingType){var $option=$("<div></div>");
var $optionIcon=$("<div></div>");var $optionLabel=$("<div></div>");$optionIcon.addClass("markingOptionIcon");
$optionLabel.addClass("markingOptionLabel");$option.addClass("markingOption");$option.css("color",colors.menu);
Spotfire.getSvg(markingIconUrl,function($svg){$optionIcon.append($svg);});$optionLabel.append(markingText);
$optionIcon.appendTo($option);$optionLabel.appendTo($option);$option.appendTo(popup);$option.hover(function(){$option.css("background-color",colors.menuHoverBackground);
},function(){$option.css("background-color",colors.menuBackground);});$option.click(function(){markingModeChangeEvent(markingType);
$(".markingOptionsPopup",jElement).remove();});};createOption(options.markingRectangle,markingIcons[0],Spotfire.Visuals.Marking.Types.RECTANGLE);
createOption(options.markingLasso,markingIcons[1],Spotfire.Visuals.Marking.Types.LASSO);createOption(options.markingCircle,markingIcons[2],Spotfire.Visuals.Marking.Types.CIRCLE);
popup.appendTo($(".frame",jElement));var onMouseUp=function(e){var container=$(".markingOptionsPopup",jElement);
if(!container.is(e.target)&&container.has(e.target).length===0){container.remove();$(document).off("mouseup",onMouseUp);
}};var popupOutOfBounds=popup.height()-(jElement.offset().top-options.top-popup.offset().top+options.maxHeight-10);
if(popupOutOfBounds>0){popup.css("top",parseInt(popup.css("top"),10)-popupOutOfBounds);popup.css("right","61px");
}var maxLabelWidth=0;$(".markingOptionLabel",jElement).each(function(i,el){maxLabelWidth=Math.max(maxLabelWidth,measureText(el));
});var iconSize=14;var safetyGap=5;var popupWidth=maxLabelWidth+iconSize+safetyGap+parseInt($(".markingOptionIcon").css("margin-right"),10)+parseInt($(".markingOption").css("padding-left"),10)*2;
$(".markingOptionsPopup",jElement).width(popupWidth);$(document).mouseup(onMouseUp);};createPanNavigationModeControl=function(jElement){var panModeChangeEvent,markModeChangeEvent;
navigationWidget.navigationModeChanged=function(func){panModeChangeEvent=func;};navigationWidget.markingModeChanged=function(func){markModeChangeEvent=func;
};var frame=$("<div></div>");frame.addClass("navigationWidget frame");Spotfire.getSvg("Images/Plots/WebMapChart/NavigationWidget/NavModeBg.svg",(function(container){return function($svg){$svg.find("[class=background-left]").css("fill",colors.selected);
$svg.find("[class=background-right]").css("fill",colors.background);$("#border",$svg).css("fill",colors.border);
$("#border",$svg).css("fill-opacity",colors.borderAlpha);$("#separator",$svg).css("fill",colors.border);
if(options.panNavigationMode){$svg.find("[class=background-left]").css("fill",colors.background);$svg.find("[class=background-right]").css("fill",colors.selected);
}container.append($svg);};}(frame)));jElement.append(frame);var pointerButton=$("<div></div>");pointerButton.addClass("navigationWidget pointerButton");
frame.append(pointerButton);var pointerImage=$("<div></div>");pointerImage.addClass("markingModeIconContainer");
pointerImage.css("color",colors.iconBorder);pointerImage.on("dragstart",function(event){event.preventDefault();
});updateSelectedMarkingIcon(options.markingMode,pointerImage);if(!options.isMobile){Spotfire.getSvg("Images/Plots/WebMapChart/NavigationWidget/SubmenuArrow.svg",function($svg){position($svg,15,15);
pointerImage.append($svg);});}position(pointerImage,7,6,19,18);pointerButton.append(pointerImage);var panButton=$("<div></div>");
panButton.addClass("navigationWidget panButton");frame.append(panButton);var panImage=$("<div></div>");
panImage.on("dragstart",function(event){event.preventDefault();});Spotfire.getSvg("Images/Plots/WebMapChart/NavigationWidget/Hand.svg",(function(container){return function($svg){$svg.find("[class=background]").css("fill",colors.iconBackground);
$svg.find("[class=border]").css("fill",colors.iconBorder);container.append($svg);};}(panImage)));if(options.disabled){panImage.css("fill-opacity","0.4");
}position(panImage,9,6,11,15);panButton.append(panImage);var pointClick=function(e){e.preventDefault();
if(options.panNavigationMode){options.panNavigationMode=false;if(panModeChangeEvent){panModeChangeEvent(false);
}panButton.removeClass("selected");pointerButton.addClass("selected");}else{if(!options.isMobile){openMarkingOptionsPopup(jElement,markModeChangeEvent);
}}};pointerButton.bind(eventName,pointClick);if(!options.disabled){var panClick=function(e){e.preventDefault();
if(!options.panNavigationMode){options.panNavigationMode=true;if(panModeChangeEvent){panModeChangeEvent(true);
}pointerButton.removeClass("selected");panButton.addClass("selected");}};panButton.bind(eventName,panClick);
}};createZoomBarControl=function(jElement){var zoomInFunction,zoomOutFunction;navigationWidget.zoomIn=function(func){zoomInFunction=func;
};navigationWidget.zoomOut=function(func){zoomOutFunction=func;};var zoomBarHolder=$("<div></div>");zoomBarHolder.bind("mousedown",function(){return true;
});position(zoomBarHolder,-1,options.width+marginBetweenNavZoomMode,options.width+2,options.width*3);
jElement.append(zoomBarHolder);var size=Math.floor(options.width/3);heightPerZoomLevel=Math.floor(options.width/7);
if(options.maxHeight<(heightPerZoomLevel*zoomLevels)+(options.width*2)+15){zoomLevels=0;}var zoomLevelIndicator=new ZoomLevelIndicator(size,heightPerZoomLevel,zoomLevels);
position(zoomLevelIndicator.getIndicatorBox(),size+1,marginBetweenNavZoomMode+size+2,size,heightPerZoomLevel*zoomLevels);
zoomBarHolder.append(zoomLevelIndicator.getIndicatorBox());var zoomInButton_=initZoomInButton(size);zoomBarHolder.append(zoomInButton_);
var zoomOutButton_=initZoomOutButton(size);zoomBarHolder.append(zoomOutButton_);zoomInButton_.bind(eventName,function(){if(enableZoomIn){var oldZoomLevel=navigationWidget.getZoomLevel();
if(oldZoomLevel+1>maxLevel){return;}navigationWidget.setZoomLevel(oldZoomLevel+1);zoomInFunction(navigationWidget.getZoomLevel());
}});zoomOutButton_.bind(eventName,function(){if(enableZoomOut){var oldZoomLevel=navigationWidget.getZoomLevel();
if(oldZoomLevel-1<minLevel){return;}navigationWidget.setZoomLevel(oldZoomLevel-1);zoomOutFunction(navigationWidget.getZoomLevel());
}});navigationWidget.setZoomLevel(activeZoomLevel);navigationWidget.setEnableZoomIn=function(value){enableZoomIn=value;
if(value){$("#center",zoomInButton).css("fill",colors["default"]);}else{$("#center",zoomInButton).css("fill",colors.disabled);
}if(zoomLevels>1){if(enableZoomIn||enableZoomOut){box.removeClass("disabled");}else{box.addClass("disabled");
}}};navigationWidget.getEnableZoomIn=function(){return enableZoomIn;};navigationWidget.setEnableZoomOut=function(value){enableZoomOut=value;
if(value){$("#center",zoomOutButton).css("fill",colors["default"]);}else{$("#center",zoomOutButton).css("fill",colors.disabled);
}if(zoomLevels>1){if(enableZoomIn||enableZoomOut){box.removeClass("disabled");}else{box.addClass("disabled");
}}};navigationWidget.getEnableZoomOut=function(){return enableZoomOut;};};if(options.showNavigationControl){createNavigationControl(rootNav);
rootNav.appendTo(rootNavWid);rootNav.attr("title",options.navigationHelpText);var zoomBar=$("<div></div>");
createZoomBarControl(zoomBar);zoomBar.appendTo(rootNavWid);zoomBar.attr("title",options.navigationHelpText);
}if(options.showNavigationMode){createPanNavigationModeControl(rootNavWid);}navContainer.append(rootNavWid);
};});String.prototype.endsWith=function(ending){return this.indexOf(ending,this.length-ending.length)!==-1;
};String.prototype.clip=function(index){if(this.length<=index){return this;}return this.substring(0,index);
};$(function(){function WelcomePage(id,settings){var read=function(method,args,callback){Spotfire.Dxp.Web.Forms.AjaxService.Read(id,method,args,callback);
};var modify=function(method,args){Spotfire.Dxp.Web.Forms.AjaxService.Modify(id,method,args);};var resources=settings.resources;
var licenses=settings.licenses;var $parent=$("#"+id).addClass("WelcomePage");var $body=$(document.body);
$body.css({border:"0",margin:"0",padding:"0",overflow:"hidden"});var $header=$("<div/>");$header.addClass("header");
var $logoImage=$("<img />");$logoImage.attr("src",settings.LogoUrl);$header.append($logoImage);var $search=$("<div/>").addClass("search");
var $searchProgress=$("<img/>").addClass("progress").attr("src","Images/WelcomePage/SearchProgress.gif").hide();
var $searchResult=$("<div/>").addClass("searchResult").hide();$parent.append($header);$parent.append($search);
$parent.append($searchResult);var createSearchInput=function(){var $input=$("<input type='text'/>");var resetSearch=function(){$searchProgress.hide();
$searchResult.empty();$searchResult.hide();};var closeSearchResults=function(e){var $target=$(e.target);
if($target.is($searchResult)){return;}if($target.parents(".searchResult").length===0){resetSearch();$body.unbind("mousedown",closeSearchResults);
}if($target.is($input)){$input.focus();}};var handleSearchResult=function(content){resetSearch();if(content.length===0){return;
}$searchResult.show();$body.bind("mousedown",closeSearchResults);var createResultItem=function(index,item){var $item=$("<div/>").addClass("result").attr("tabindex",index).attr("title",item.title);
var $title=$("<div/>").addClass("title").text(item.title);var $category=$("<div/>").addClass("category").text(item.category);
$item.append($title);$item.append($category);$item.click(function(){modify("ExecuteSearchSelection",item.value);
resetSearch();});$item.keydown(function(e){switch(e.which){case 13:$(this).click();break;case 27:resetSearch();
$input.focus();break;case 38:$(this).prev().focus();break;case 40:$(this).next().focus();break;}e.preventDefault();
});var onFocus=function(){$(this).addClass("hover");$(".title",this).addClass("blue");};var onBlur=function(){$(this).removeClass("hover");
$(".title",this).removeClass("blue");};$item.focus(onFocus);$item.blur(onBlur);$item.hover(onFocus,onBlur);
return $item;};var i;for(i=0;i<content.length;i++){$searchResult.append(createResultItem(i,content[i]));
}};var defaultText=resources.WelcomePageGhostText;$input.addClass("ghost");$input.val(defaultText);var searchTimer;
$input.focus(function(){if($input.val()===defaultText){$input.removeClass("ghost");$input.val("");}});
var checkDefault=function(){if($input.val()===""){resetSearch();$input.addClass("ghost");$input.val(defaultText);
}};$input.change(checkDefault);$input.blur(checkDefault);$input.keyup(function(e){if(searchTimer){window.clearTimeout(searchTimer);
}var text=$input.val();if(text===""){resetSearch();return;}var performSearch=function(){$searchProgress.show();
read("Search",text,handleSearchResult);};switch(e.which){case 13:performSearch();break;case 27:break;
case 40:$(".result",$searchResult).first().focus();break;default:searchTimer=window.setTimeout(performSearch,400);
break;}});return $input;};var $searchInput=createSearchInput();$search.append($searchInput);$search.append($searchProgress);
$body.bind("dragstart",function(e){e.preventDefault();});var $footer;if(settings.ButtonUrl){$footer=$("<div/>").addClass("footer");
$footer.click(function(){modify("OpenWebLink",settings.ButtonUrl);});$footer.text(settings.ButtonText);
$parent.append($footer);}var $tabControl=$("<div/>").addClass("tabControl");$parent.append($tabControl);
var $tabsList=$("<ul/>");$tabControl.append($tabsList);var showTab=function(i){var $tabs=$(".tab",$parent);
$tabs.hide();var $tab=$($tabs.get(i-1));$tab.show();$tab.trigger("shown");var $spans=$("span",$tabControl);
$spans.removeClass("active");$($spans.get(i-1)).addClass("active");};var createTab=function(title){var $tab=$("<div/>");
$tab.addClass("tab");$tab.hide();var $li=$("<li/>");$tabsList.append($li);var i=$tabsList.children().length;
var $span=$("<span/>");$span.text(title);$li.append($span);$span.click(function(){showTab(i);modify("SetActiveTab",i.toString());
});$parent.append($tab);return $tab;};var $tab1=createTab(resources.WelcomePageRecentFiles);var $tab2=createTab(resources.WelcomePageRecentData);
var $tab3=createTab(resources.WelcomePageAddData);var $tab4=createTab(resources.WelcomePageSamples);var createItem=function(func,isTopItem,enabled,method,args){var $div=$("<div/>").addClass("item");
var $delimiterTop=$("<div/>").addClass("delimiter delimiterTop");if(isTopItem){$delimiterTop.addClass("separatingLine");
}var $delimiterBottom=$("<div/>").addClass("delimiter delimiterBottom separatingLine");func($div);$div.append($delimiterTop);
$div.append($delimiterBottom);if(enabled){$div.click(function(){modify(method,args);});}else{var $blocker=$("<div/>").addClass("blocker");
$div.append($blocker);}return $div;};var loadRecentFiles=function(content){$tab1.empty();var $col1=$("<div/>").addClass("leftColumn");
var $col2=$("<div/>").addClass("rightColumn");$tab1.append($col1);$tab1.append($col2);$.each(content,function(i,item){var populate=function($div){var $thumbnail=$("<div/>").addClass("thumbnail");
var src=item.previewUrl||"Images/WelcomePage/DefaultFileIcon.png";var $img=$("<img/>").attr("src",src);
$thumbnail.append($img);var $title=$("<div/>").addClass("title").text(item.title);$div.attr("title",item.title);
var $desc=$("<div/>").addClass("desc");$desc.append($("<span/>").text(item.lastModified).css("color","#b8b8b8"));
$desc.append("<br/>");if(item.method==="OpenFromLibrary"){$desc.append($("<span/>").text(item.modifiedBy));
$desc.append("<br/>");}if(item.description){$desc.append($("<div/>").text(item.description));}else{$desc.append($("<div/>").text(item.path));
}$("span",$desc).each(function(){var $span=$(this);$span.attr("title",$span.text());});$title.width(240);
$desc.width(240);$desc.height(48);$div.append($thumbnail);$div.append($title);$div.append($desc);};var isTopItem=i===0||i===1;
var $item=createItem(populate,isTopItem,true,item.method,item.args);$item.css("padding","25px");$item.height(68);
if(i%2===0){$item.addClass("rightBorder");$col1.append($item);}else{$col2.append($item);}});$(".delimiterTop, .delimiterTop2",$col1).css("background-position","top left");
$(".delimiterTop, .delimiterTop2",$col2).css("background-position","top right");$(".delimiterBottom",$col1).css("background-position","bottom left");
$(".delimiterBottom",$col2).css("background-position","bottom right");$(".item",$col1).css("background-position","left");
$(".item",$col2).css("background-position","right");};var loadRecentData=function(content){$tab2.empty();
$.each(content,function(i,item){var populate=function($div){$div.attr("title",item.tooltip);var $title=$("<div/>").addClass("title").text(item.title);
var $desc=$("<div/>").addClass("desc").text(item.type);$title.css({"float":"left",width:"479px","margin-left":"32px"});
$desc.css({width:"170px","margin-left":"414px"});$div.append($title);$div.append($desc);};var $item=createItem(populate,i===0,true,item.method,item.args);
$item.height(16);$tab2.append($item);});};var loadAddData=function(content){$tab3.empty();var createListItem=function(text,desc,imageUrl,userAction,enabled){var populate=function($div){var $img=$("<img/>").attr("src",imageUrl).addClass("icon");
var $title=$("<div/>").addClass("title").text(text);var $desc=$("<div/>").addClass("desc").text(desc);
$div.attr("title",text);$div.append($img);$div.append($title);$div.append($desc);};$tab3.append(createItem(populate,$tab3.children().length===0,enabled,"InvokeUserAction",userAction));
};createListItem(resources.WelcomePageOpenFile,resources.WelcomePageOpenFileDescription,"Images/WelcomePage/OpenFile.png","fileOpenFile",licenses.OpenFile);
if(!settings.serverless){createListItem(resources.WelcomePageOpenFromLibrary,resources.WelcomePageOpenFromLibraryDescription,"Images/WelcomePage/OpenLibrary.png","fileOpenLibrary",licenses.OpenFromLibrary&&settings.isOnline);
}createListItem(resources.WelcomePageAddDataTables,resources.WelcomePageAddDataTablesDescription,"Images/WelcomePage/AddTable.png","fileAddDataTable",licenses.ManageDataTables);
var createAdapterItem=function($div){var createLink=function(title,method,args){var onClick=function(){modify(method,args);
return false;};var $link=$("<a href=#></a>");$link.text(title);$link.attr("title",title);$link.click(onClick);
return $link;};var $img=$("<img/>").attr("src","Images/WelcomePage/DbConnection.png").addClass("icon");
var $title=$("<div/>").addClass("title").text(resources.WelcomePageDbConnections);var $links=$("<div/>").addClass("linkList");
var i,item,$a;for(i=0;i<content.length;i++){item=content[i];$a=createLink(item.displayName,"DataAdapterFactory",item.typeId);
$links.append($a);$links.append(", ");}var text=resources.WelcomePageMoreDbConnections;$links.append(createLink(text,"InvokeUserAction","fileAddDataTable"));
$div.attr("title",text);$div.append($img);$div.append($title);$div.append($links);};var $adapters=createItem(createAdapterItem,false,licenses.ManageDataTables,"InvokeUserAction","fileAddDataTable");
$tab3.append($adapters);var onShown=function(){$(".item",$tab3).each(function(i,elem){var h=$(".desc, .linkList",elem).height();
$(elem).height(23+h);});};$tab3.bind("shown",onShown);onShown();};var loadSamples=function(content){$tab4.empty();
var $col1=$("<div/>").addClass("leftColumn");var $col2=$("<div/>").addClass("rightColumn");$tab4.append($col1);
$tab4.append($col2);$.each(content,function(i,item){var populate=function($div){var $thumbnail=$("<div/>").addClass("thumbnail");
var src=item.previewUrl||"Images/WelcomePage/DefaultFileIcon.png";var $img=$("<img/>").attr("src",src);
$thumbnail.append($img);var $title=$("<div/>").addClass("title").text(item.title);$div.attr("title",item.title);
var $desc=$("<div/>").addClass("sampleDesc");$desc.append($("<div/>").text(item.description));$("span",$desc).each(function(){var $span=$(this);
$span.attr("title",$span.text());});$title.width(240);$desc.width(240);$desc.height(48);$div.append($thumbnail);
$div.append($title);$div.append($desc);};var isTopItem=i===0||i===1;var $item=createItem(populate,isTopItem,true,item.method,item.args);
$item.css("padding","25px");$item.height(68);if(i%2===0){$item.addClass("rightBorder");$col1.append($item);
}else{$col2.append($item);}});$(".delimiterTop, .delimiterTop2",$col1).css("background-position","top left");
$(".delimiterTop, .delimiterTop2",$col2).css("background-position","top right");$(".delimiterBottom",$col1).css("background-position","bottom left");
$(".delimiterBottom",$col2).css("background-position","bottom right");$(".item",$col1).css("background-position","left");
$(".item",$col2).css("background-position","right");};showTab(settings.activeTab);var performLayout=function(){var w=$parent.width();
var center=function($elem){var left=Math.round((w-$elem.outerWidth())/2);if(left<0){left=0;}$elem.css("left",left+"px");
};center($header);center($tabControl);center($search);center($searchResult);center($tab1);center($tab2);
center($tab3);center($tab4);if($footer){if($parent.width()<826||$parent.height()<660){$footer.hide();
}else{$footer.show();}}};read("GetRecentAnalyses","",loadRecentFiles);read("GetRecentData","",loadRecentData);
read("GetDataAdapters","",loadAddData);read("GetSamples","",loadSamples);read("GetOnlineStatus","",function(status){$("<span/>").text(status.text).attr("title",status.tooltip).appendTo($body).css({position:"absolute","font-size":"1.2em",left:"5px",bottom:"5px",cursor:"pointer",color:"#c0c0c0"});
});$parent.on("sf-resize",performLayout);Spotfire.DragDrop.initializeWindowsIntegration(id);performLayout();
}var instance=null;Spotfire.registerNameSpace("WelcomePage",{initialize:function(id,settings){if(instance!==null){throw"Attempt to initialize twice.";
}instance=new WelcomePage(id,settings);}});});(function(Spotfire){Spotfire.svgCache={"images/axistraycontrol/downarrow.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' fill='currentColor' viewBox='0 0 7 4' enable-background='new 0 0 7 4' xml:space='preserve'><polygon points='3.5,4 7,0 0,0 '/></svg>"},"images/axistraycontrol/handle.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 9 12' enable-background='new 0 0 9 12' xml:space='preserve'><g><g class='sf-element sf-element-svg-element sfc-bin-thumb-outline' fill='currentColor'><path d='M7,0H2C0.895,0,0,0.923,0,2.062v4.156c0,0.709,0.228,1.037,0.876,1.705L4.5,12l3.624-4.078 C8.772,7.255,9,6.926,9,6.218V2.062C9,0.923,8.105,0,7,0z'/></g><g class='sf-element sf-element-svg-element' fill='currentColor'><path d='M7,1H2C1.449,1,1,1.477,1,2.062V6.22c0,0.313,0,0.397,0.594,1.009L4.5,10.5l2.877-3.239 C8,6.617,8,6.533,8,6.22V2.062C8,1.477,7.551,1,7,1z'/></g></g></svg>"},"images/axistraycontrol/plus.svg":{result:"<svg version='1.1' xmlns:x='&ns_extend;' xmlns:i='&ns_ai;' xmlns:graph='&ns_graphs;' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' width='7px' height='7px' viewBox='0 0 7 7' enable-background='new 0 0 7 7' xml:space='preserve'><metadata><sfw xmlns='&ns_sfw;'><slices></slices><sliceSourceBounds height='7' width='7' x='0' y='-7' bottomLeftOrigin='true'></sliceSourceBounds></sfw></metadata><g shape-rendering='crispEdges' fill='currentColor'><rect x='0' y='3' width='7' height='1'/><rect x='3' y='0' width='1' height='7'/></g></svg>"},"images/bookmarks/bookmarkadd.svg":{result:"<svg version='1.1' xmlns:x='&ns_extend;' xmlns:i='&ns_ai;' xmlns:graph='&ns_graphs;' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' width='7px' height='7px' viewBox='0 0 7 7' enable-background='new 0 0 7 7' xml:space='preserve'><metadata><sfw xmlns='&ns_sfw;'><slices></slices><sliceSourceBounds height='7' width='7' x='0' y='-7' bottomLeftOrigin='true'></sliceSourceBounds></sfw></metadata><polygon fill='currentColor' points='7,3 4,3 4,0 3,0 3,3 0,3 0,4 3,4 3,7 4,7 4,4 7,4 '/></svg>"},"images/bookmarks/bust_16x16.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 16 16' enable-background='new 0 0 16 16' xml:space='preserve'><path fill='currentColor' d='M12.045,10.923c-0.311-0.126-0.604-0.245-0.84-0.385c-0.167-0.099-0.323-0.179-0.467-0.253 c-0.725-0.374-1.175-0.52-1.2-1.644V8.474c0.404-0.34,0.681-0.765,0.885-1.359c0.052-0.069,0.905-1.217,0.355-1.476 C10.934,4.022,9.513,3,8.174,3H8.141C6.802,3,5.38,4.022,5.537,5.639C4.987,5.898,5.839,7.046,5.891,7.115 c0.204,0.594,0.481,1.019,0.885,1.359v0.077c-0.005,1.558-1.138,1.747-2.049,2.018l-0.122,0.036C3.705,10.87,3.186,11.575,3,13h10 C12.833,11.916,12.94,11.284,12.045,10.923z'/></svg>"},"images/bookmarks/downarrow.svg":{result:"<svg version='1.1' xmlns:x='&ns_extend;' xmlns:i='&ns_ai;' xmlns:graph='&ns_graphs;' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' width='7px' height='4px' viewBox='0 0 7 4' enable-background='new 0 0 7 4' xml:space='preserve'><metadata><sfw xmlns='&ns_sfw;'><slices></slices><sliceSourceBounds width='13' height='16383' x='0' y='-8194' bottomLeftOrigin='true'></sliceSourceBounds></sfw></metadata><polygon fill='currentColor' points='3.5,4 7,0 0,0 '/></svg>"},"images/bookmarks/triplebust_16x16.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 16 16' enable-background='new 0 0 16 16' xml:space='preserve'><g fill='currentColor'><path d='M11.623,13.139c-0.073-0.052-0.158-0.1-0.257-0.143c-0.137-0.061-0.27-0.12-0.395-0.18c0.125,0.061,0.258,0.12,0.395,0.18 C11.465,13.039,11.55,13.087,11.623,13.139z'/><path d='M7.955,5.35L7.955,5.35c0.147,0,0.296,0.015,0.443,0.045C8.251,5.366,8.102,5.35,7.955,5.35z'/><path d='M11.14,7.539c0.052,0.1,0.092,0.21,0.118,0.326c0.149,0.66-0.189,1.384-0.534,1.914c-0.17,0.495-0.389,0.902-0.673,1.248 c0.025,0.192,0.107,0.238,0.434,0.42l0.134,0.075c0.141,0.079,0.294,0.166,0.46,0.274c0.149,0.097,0.377,0.198,0.619,0.305 c0.315,0.139,0.544,0.317,0.722,0.516H16c-0.147-1.046-0.053-1.656-0.842-2.004c-0.274-0.121-0.533-0.236-0.74-0.371 c-0.147-0.095-0.285-0.173-0.411-0.244c-0.639-0.361-1.036-0.501-1.058-1.587v-0.16c0.356-0.328,0.6-0.738,0.78-1.312 c0.046-0.067,0.798-1.175,0.313-1.424c0.138-1.561-1.115-2.547-2.295-2.547h-0.029c-0.987,0-2.014,0.696-2.246,1.835 c0.347,0.193,0.668,0.437,0.926,0.748C10.856,6.104,11.113,6.798,11.14,7.539z'/><path d='M9.161,10.834C9.173,11.238,9.245,11.5,9.358,11.7C9.245,11.5,9.173,11.238,9.161,10.834z'/><path d='M4.623,7.865c0.026-0.117,0.066-0.226,0.118-0.326c0.026-0.741,0.283-1.434,0.742-1.989c0.34-0.41,0.781-0.714,1.262-0.913 c0.202-0.366,0.438-0.922,0.111-1.091C6.994,1.986,5.741,1,4.561,1H4.531c-1.18,0-2.434,0.986-2.295,2.547 c-0.485,0.25,0.266,1.358,0.312,1.424c0.18,0.573,0.424,0.984,0.78,1.312v0.075C3.324,7.86,2.326,8.043,1.523,8.305L1.415,8.34 C0.622,8.595,0.164,9.275,0,10.65h5.577c-0.162-0.26-0.308-0.54-0.421-0.871C4.812,9.249,4.474,8.523,4.623,7.865z'/><path d='M12.028,13.736c-0.07-0.245-0.185-0.441-0.405-0.597c-0.073-0.052-0.158-0.1-0.257-0.143 c-0.137-0.061-0.27-0.12-0.395-0.18c-0.125-0.061-0.241-0.123-0.345-0.191c-0.005-0.003-0.008-0.005-0.013-0.008 c-0.142-0.091-0.276-0.168-0.399-0.237c-0.08-0.045-0.156-0.087-0.228-0.127c-0.144-0.081-0.272-0.157-0.382-0.247 c-0.1-0.082-0.18-0.185-0.247-0.305c-0.113-0.2-0.185-0.462-0.197-0.866c0-0.015-0.003-0.025-0.003-0.041v0v-0.16 c0.089-0.082,0.171-0.169,0.247-0.263c0.114-0.141,0.211-0.304,0.299-0.478v0C9.791,9.719,9.87,9.535,9.937,9.321 c0.006-0.008,0.022-0.033,0.047-0.07c0.064-0.099,0.177-0.289,0.272-0.495c0.022-0.048,0.041-0.095,0.06-0.144 c0.053-0.137,0.094-0.276,0.096-0.396c0.001-0.034-0.011-0.061-0.017-0.092c-0.017-0.095-0.054-0.179-0.145-0.226 c0.052-0.585-0.092-1.09-0.354-1.492C9.729,6.15,9.513,5.94,9.27,5.773c-0.139-0.096-0.286-0.18-0.44-0.244 C8.69,5.47,8.545,5.425,8.398,5.396C8.251,5.366,8.102,5.35,7.955,5.35H7.925c-0.443,0-0.895,0.139-1.281,0.394 c-0.257,0.17-0.485,0.393-0.66,0.661c-0.078,0.12-0.141,0.252-0.197,0.389c-0.13,0.324-0.194,0.692-0.157,1.103 C5.448,7.99,5.44,8.205,5.504,8.439C5.546,8.596,5.62,8.762,5.696,8.907c0.113,0.218,0.23,0.389,0.247,0.414 c0.135,0.43,0.306,0.768,0.533,1.049c0.076,0.094,0.158,0.181,0.247,0.263v0.017v0.057c0,0.188-0.017,0.355-0.046,0.505 c-0.059,0.299-0.17,0.526-0.316,0.703c-0.364,0.444-0.942,0.576-1.444,0.74L4.809,12.69c-0.397,0.128-0.71,0.362-0.944,0.735 c-0.059,0.093-0.112,0.196-0.161,0.307c-0.098,0.223-0.176,0.483-0.235,0.784C3.44,14.667,3.414,14.828,3.394,15h8.815 C12.135,14.477,12.122,14.063,12.028,13.736z'/><path d='M9.161,10.834c0-0.015-0.003-0.025-0.003-0.041v0C9.158,10.809,9.16,10.819,9.161,10.834z'/><path d='M12.209,15c-0.074-0.523-0.087-0.937-0.18-1.264C12.122,14.063,12.135,14.477,12.209,15L12.209,15z'/><path d='M10.627,12.624c0.104,0.068,0.22,0.13,0.345,0.191C10.847,12.754,10.73,12.692,10.627,12.624 c-0.005-0.003-0.008-0.005-0.013-0.008h0C10.619,12.619,10.622,12.621,10.627,12.624z'/><path d='M6.361,11.915c-0.364,0.444-0.942,0.576-1.444,0.74L4.809,12.69l0.107-0.035C5.419,12.491,5.997,12.359,6.361,11.915z'/><path d='M6.644,5.744c-0.257,0.17-0.485,0.393-0.66,0.661C6.159,6.137,6.387,5.915,6.644,5.744z'/><path d='M4.809,12.69c-0.397,0.128-0.71,0.362-0.944,0.735C4.1,13.051,4.413,12.817,4.809,12.69z'/><path d='M9.987,12.252c0.072,0.041,0.148,0.082,0.228,0.127c0.123,0.069,0.257,0.145,0.399,0.237h0 c-0.142-0.091-0.276-0.168-0.399-0.237C10.136,12.335,10.059,12.293,9.987,12.252z'/></g></svg>"},"images/buttons/actions.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 14 14' enable-background='new 0 0 14 14' xml:space='preserve'><g shape-rendering='crispEdges' fill='currentColor'> /* Three lines in the middle */ <rect x='2' y='3' width='7' height='1'/><rect x='2' y='6' width='7' height='1'/><rect x='2' y='9' width='5' height='1'/> /* The frame */ <rect x='0' y='12' width='8' height='1'/><rect x='0' y='0' width='11' height='1'/><rect x='0' y='1' width='1' height='11'/><rect x='10' y='1' width='1' height='8'/> /* The triangle down to the right */ <polygon fill='currentColor' points='7.5,10.5 13.5,10.5 10.5,13.5'/></g></svg>"},"images/buttons/annotations.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 14 14' enable-background='new 0 0 14 14' xml:space='preserve'><polygon fill='currentColor' points='10.3,14 11.7,14 14,11.7 14,10.3 '/><polygon fill='currentColor' points='10,10 10,13 11,13 11,11 13,11 13,10 '/><polygon fill='currentColor' points='0,0 0,14 10.3,14 11.3,13 1,13 1,1 13,1 13,11.3 14,10.3 14,0 '/><path fill='currentColor' d='M9.6,8.684C9.475,8.565,9.315,8.277,9.12,7.821L7.083,3h-0.08l-2.02,4.691 C4.792,8.139,4.631,8.434,4.5,8.577C4.369,8.721,4.203,8.807,4,8.84V9h1.88V8.84C5.584,8.817,5.4,8.782,5.325,8.736 c-0.128-0.079-0.192-0.2-0.192-0.365c0-0.124,0.039-0.282,0.117-0.473l0.237-0.572h1.996l0.3,0.733 C7.861,8.25,7.903,8.358,7.908,8.384c0.017,0.055,0.025,0.108,0.025,0.16c0,0.087-0.031,0.153-0.092,0.199 C7.753,8.807,7.598,8.84,7.38,8.84H7.267V9H10V8.84C9.828,8.825,9.694,8.773,9.6,8.684z M5.633,7.006L6.5,4.981l0.842,2.025H5.633 z'/></svg>"},"images/buttons/calculator.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 14 14' enable-background='new 0 0 14 14' xml:space='preserve'><g shape-rendering='crispEdges' fill='currentColor'> /* The frame */ <rect x='2' y='1' width='10' height='1'/><rect x='2' y='12' width='10' height='1'/><rect x='2' y='2' width='1' height='10'/><rect x='11' y='2' width='1' height='10'/> /* The horizontal lines within the keyboard part */ <rect x='3' y='4' width='8' height='1'/><rect x='3' y='6' width='8' height='1'/><rect x='3' y='8' width='8' height='1'/><rect x='3' y='10' width='8' height='1'/> /* The vertical lines within the keyboard part */ <rect x='5' y='5' width='1' height='7'/><rect x='8' y='5' width='1' height='7'/></g></svg>"},"images/buttons/close.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 14 14' enable-background='new 0 0 14 14' xml:space='preserve'><g id='Lager_1'><g><g><rect x='6.118' y='-0.603' transform='matrix(0.7071 -0.7071 0.7071 0.7071 -2.8995 6.9998)' fill='currentColor' width='1.764' height='15.206'/></g></g><g><g><rect x='-0.603' y='6.118' transform='matrix(0.7071 -0.7071 0.7071 0.7071 -2.8995 7)' fill='currentColor' width='15.206' height='1.764'/></g></g></g></svg>"},"images/buttons/edithtml.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 14 14' enable-background='new 0 0 14 14' xml:space='preserve'><g><g><polygon fill='currentColor' points='5.933,2.202 4.704,1 0,6.926 0.005,6.931 0,6.936 4.704,13 5.933,11.798 2.168,6.945 '/></g></g><g><g><polygon fill='currentColor' points='14,6.926 9.295,1 8.067,2.202 11.832,6.945 8.067,11.798 9.295,13 14,6.936 13.995,6.931 '/></g></g></svg>"},"images/buttons/edittextarea.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 14 14' enable-background='new 0 0 14 14' xml:space='preserve'><g><g><path fill='currentColor' d='M0,14l4.666-1.255L1.25,9.317L0,14z M10.525,0L8.612,1.921l3.475,3.487L14,3.487L10.525,0z M1.933,8.634l3.475,3.487 l6.049-6.082L7.982,2.552L1.933,8.634z'/></g></g></svg>"},"images/buttons/error.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 14 14' enable-background='new 0 0 14 14' xml:space='preserve'><g><circle fill='currentColor' cx='7' cy='7' r='7' /><rect x='6' y='9' fill='#FEFEFE' width='2' height='2'/><rect x='6' y='3' fill='#FEFEFE' width='2' height='4'/></g></svg>"},"images/buttons/horizontalcollapse.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 20 20' enable-background='new 0 0 20 20' xml:space='preserve'><g id='Lager_3' fill='currentColor'><rect x='6' y='9' width='8' height='2' transform='rotate(45, 13, 10)'/><rect x='6' y='9' width='8' height='2' transform='rotate(-45, 13, 10)'/></g></svg>"},"images/buttons/horizontalexpand.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 20 20' enable-background='new 0 0 20 20' xml:space='preserve'><g id='Lager_3' fill='currentColor'><rect x='6' y='9' width='8' height='2' transform='rotate(45, 7, 10)'/><rect x='6' y='9' width='8' height='2' transform='rotate(-45, 7, 10)'/></g></svg>"},"images/buttons/info.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 14 14' enable-background='new 0 0 14 14' xml:space='preserve'><g><circle fill='currentColor' cx='7' cy='7' r='7' /><path fill='#FEFEFE' d='M6,3h2v2h-2V3z M9,11H5v-1h1V7H5v-1h1h0h2v4H9V11z'/></g></svg>"},"images/buttons/properties.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 14 14' enable-background='new 0 0 14 14' xml:space='preserve'><path fill='currentColor' d='M13.621,5.904l-1.036-0.259c-0.168-0.042-0.303-0.168-0.356-0.332c-0.091-0.284-0.205-0.559-0.339-0.82 c-0.079-0.154-0.072-0.337,0.017-0.486l0.55-0.915c0.118-0.197,0.087-0.449-0.075-0.611l-0.863-0.863 c-0.163-0.162-0.414-0.193-0.611-0.075L9.992,2.092C9.844,2.181,9.66,2.188,9.506,2.109C9.244,1.975,8.97,1.861,8.686,1.77 C8.521,1.717,8.395,1.583,8.353,1.415L8.094,0.379C8.039,0.156,7.839,0,7.609,0H6.39C6.161,0,5.961,0.156,5.905,0.379L5.647,1.415 C5.605,1.582,5.479,1.717,5.314,1.77C5.029,1.861,4.755,1.975,4.493,2.109C4.339,2.188,4.155,2.182,4.007,2.093L3.092,1.544 C2.895,1.426,2.644,1.457,2.481,1.619L1.619,2.481C1.457,2.644,1.426,2.895,1.544,3.092l0.549,0.915 c0.089,0.148,0.095,0.332,0.017,0.486C1.975,4.755,1.861,5.029,1.77,5.314c-0.053,0.165-0.188,0.29-0.355,0.332L0.379,5.905 C0.156,5.961,0.001,6.161,0.001,6.39L0,7.609c0,0.229,0.156,0.43,0.378,0.485l1.036,0.259C1.583,8.396,1.717,8.521,1.77,8.686 c0.091,0.285,0.205,0.559,0.339,0.821c0.079,0.154,0.073,0.337-0.016,0.486l-0.549,0.915c-0.118,0.196-0.087,0.448,0.075,0.61 l0.862,0.863c0.163,0.163,0.415,0.193,0.611,0.075l0.915-0.549c0.148-0.089,0.332-0.095,0.486-0.017 c0.262,0.134,0.537,0.248,0.821,0.339c0.165,0.053,0.291,0.187,0.333,0.355l0.259,1.036C5.961,13.844,6.16,14,6.39,14h1.22 c0.23,0,0.429-0.156,0.485-0.379l0.259-1.036c0.042-0.167,0.168-0.302,0.333-0.355c0.285-0.091,0.559-0.205,0.821-0.339 c0.154-0.079,0.338-0.072,0.486,0.017l0.915,0.549c0.197,0.118,0.448,0.088,0.611-0.075l0.863-0.863 c0.162-0.162,0.193-0.414,0.075-0.611l-0.549-0.915c-0.089-0.148-0.095-0.332-0.017-0.486c0.134-0.262,0.248-0.536,0.339-0.82 c0.053-0.165,0.188-0.291,0.356-0.333l1.036-0.259C13.844,8.039,14,7.839,14,7.609V6.39C14,6.16,13.844,5.96,13.621,5.904z M7,9.5 C5.619,9.5,4.5,8.381,4.5,7c0-1.381,1.119-2.5,2.5-2.5S9.5,5.619,9.5,7C9.5,8.381,8.381,9.5,7,9.5z'/></svg>"},"images/buttons/refresh.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 12 12' enable-background='new 0 0 12 12' xml:space='preserve'><g><g><path fill='currentColor' d='M2.262,2.999c1.778-1.775,4.656-1.81,6.436-0.089L6.756,5.033h5.22V0L9.697,1.912C7.369-0.347,3.599-0.303,1.27,2.021 C0.716,2.574,0.293,3.207,0,3.882l1.272,0.585C1.496,3.934,1.826,3.433,2.262,2.999z M10.728,7.533 c-0.224,0.533-0.554,1.033-0.99,1.468c-1.778,1.775-4.656,1.81-6.437,0.089l1.943-2.113H0V12l2.303-1.913 c2.327,2.259,6.098,2.216,8.427-0.109c0.554-0.553,0.977-1.186,1.27-1.86L10.728,7.533z'/></g></g></svg>"},"images/buttons/txt.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 14 14' enable-background='new 0 0 14 14' xml:space='preserve'><g shape-rendering='crispEdges' fill='currentColor'><rect x='4' y='10' width='10' height='2'/><rect y='10' width='2' height='2'/><rect x='4' y='6' width='10' height='2'/><rect y='6' width='2' height='2'/><rect x='4' y='2' width='10' height='2'/><rect y='2' width='2' height='2'/></g></svg>"},"images/buttons/verticalcollapse.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 20 20' enable-background='new 0 0 20 20' xml:space='preserve'><g id='arrow' fill='currentColor' transform='translate(10, 6) rotate(45)' ><rect x='0' y='0' width='8' height='2'/><rect x='0' y='0' width='2' height='8'/></g></svg>"},"images/buttons/verticalexpand.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 20 20' enable-background='new 0 0 20 20' xml:space='preserve'><g id='arrow' fill='currentColor' transform='translate(10, 14) rotate(-135)' ><rect x='0' y='0' width='8' height='2'/><rect x='0' y='0' width='2' height='8'/></g></svg>"},"images/buttons/warning.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 13 14' enable-background='new 0 0 13 14' xml:space='preserve'><g><path fill='currentColor' d='M12.261,10.187l-3.97-9.416C7.306-0.258,5.707-0.257,4.72,0.774l-3.979,9.425 C-0.246,11.23-0.247,12.97,0.738,14h11.521C13.246,12.969,13.247,11.217,12.261,10.187z M7.62,11.016h-2V9.016h2V11.016z M7.62,8.014h-2V3.016h2V8.014z'/><rect x='5.62' y='3.016' fill='#161616' width='2' height='4.999'/><rect x='5.62' y='9.016' fill='#161616' width='2' height='1.999'/></g></svg>"},"images/buttons/warning_small.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 10 10' enable-background='new 0 0 10 10' xml:space='preserve'><g id='Bg'><g id='XMLID_14_'><g id='XMLID_46_'><path id='XMLID_47_' fill-rule='evenodd' clip-rule='evenodd' fill='#fadb4a' d='M9.874,8.291L6.056,0.653 c-0.435-0.87-1.677-0.87-2.112,0L0.126,8.291C-0.266,9.076,0.305,10,1.182,10h7.635C9.695,10,10.266,9.076,9.874,8.291z'/></g></g></g><g id='_x21_'><g id='XMLID_2_'><g id='XMLID_22_'><rect id='XMLID_23_' x='4' y='3' fill='#75682d' width='2' height='3'/></g></g><g id='XMLID_7_'><g id='XMLID_29_'><rect id='XMLID_30_' x='4' y='7' fill='#75682d' width='2' height='1'/></g></g></g></svg>"},"images/comments/add_comment_34x34.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 34 34' enable-background='new 0 0 34 34' xml:space='preserve'><defs><linearGradient id='grad1' x1='0%' y1='0%' x2='0%' y2='100%'><stop class='sf-element-svg-element sfc-stop1' offset='0%' style='stop-color:currentColor;stop-opacity:1' /><stop class='sf-element-svg-element sfc-stop2' offset='100%' style='stop-color:currentColor;stop-opacity:1' /></linearGradient></defs><g id='add_bubble'><g><g fill='url(#grad1)'><path d='M17,3C7.611,3,0,8.214,0,14.646c0,6.432,7.611,11.646,17,11.646c0.591,0,1.175-0.021,1.751-0.062V32l8.181-7.916 C31.207,21.968,34,18.534,34,14.646C34,8.214,26.389,3,17,3z'/></g></g><g><g><polygon fill='#FFFFFF' points='18,14 18,10 16,10 16,14 12,14 12,16 16,16 16,20 18,20 18,16 22,16 22,14 '/></g></g></g></svg>"},"images/comments/anchorbubble.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 60 60' enable-background='new 0 0 60 60' xml:space='preserve'><g id='fill' class='sf-element sf-element-svg-element sfc-group-background'><g><path fill='currentColor' d='M30,3C15.112,3,3,15.112,3,30c0,14.888,12.112,27,27,27c14.888,0,27-12.112,27-27C57,15.112,44.888,3,30,3 z'/></g></g><g id='outer_line' class='sf-element sf-element-svg-element sfc-group-frame'><g><path fill='currentColor' d='M30,0C13.431,0,0,13.431,0,30s13.431,30,30,30s30-13.431,30-30S46.569,0,30,0z M30,57C15.112,57,3,44.888,3,30 C3,15.112,15.112,3,30,3c14.888,0,27,12.112,27,27C57,44.888,44.888,57,30,57z'/></g></g><g id='bubble_x5F_bottom' class='sf-element sf-element-svg-element sfc-group-right-bubble'><g><path fill='currentColor' d='M35.5,18C29.149,18,24,21.408,24,25.613s5.149,7.613,11.5,7.613c0.404,0,0.803-0.014,1.196-0.041 L36.685,37l5.616-5.258c2.845-1.386,4.7-3.611,4.7-6.129C47,21.408,41.851,18,35.5,18z'/></g></g><g id='bubble_x5F_top' class='sf-element sf-element-svg-element sfc-group-left-bubble'><g><path fill='currentColor' d='M24.5,22C18.149,22,13,25.408,13,29.613s5.149,7.613,11.5,7.613c0.404,0,0.803-0.014,1.196-0.041 L25.685,41l5.616-5.258c2.845-1.386,4.7-3.611,4.7-6.129C36,25.408,30.851,22,24.5,22z'/></g></g></svg>"},"images/comments/bubble.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill='currentColor' x='0px' y='0px' viewBox='0 0 16 16' enable-background='new 0 0 16 16' xml:space='preserve'><g><g><path fill-rule='evenodd' clip-rule='evenodd' d='M15.965,7.735C15.965,4.86,12.399,2.53,8,2.53c-4.399,0-7.965,2.331-7.965,5.205 c0,2.875,3.566,5.205,7.965,5.205c0.277,0,0.551-0.009,0.821-0.027L8.813,15.5l3.854-3.552 C14.662,11.002,15.965,9.47,15.965,7.735z'/></g></g></svg>"},"images/comments/closebtn_10x10.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 10 10' enable-background='new 0 0 10 10' fill='currentColor' xml:space='preserve'><g><g><rect x='4.228' y='-1.299' transform='matrix(0.7071 -0.7071 0.7071 0.7071 -2.0711 5)' width='1.544' height='12.598'/></g></g><g><g><rect x='-1.299' y='4.228' transform='matrix(0.7071 -0.7071 0.7071 0.7071 -2.0711 5)' width='12.598' height='1.544'/></g></g></svg>"},"images/comments/closebtn_16x16canvas.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' fill='currentColor' viewBox='0 0 16 16' enable-background='new 0 0 16 16' xml:space='preserve'><g id='Lager_1'><g><g><rect x='0.286' y='7.229' transform='matrix(0.7071 -0.7071 0.7071 0.7071 -3.3137 8)' width='15.428' height='1.543'/></g></g><g><g><rect x='7.229' y='0.286' transform='matrix(0.7071 -0.7071 0.7071 0.7071 -3.3137 8)' width='1.543' height='15.428'/></g></g></g></svg>"},"images/comments/closebtn_7x7.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' fill='currentColor' viewBox='0 0 7 7' style='enable-background:new 0 0 7 7;' xml:space='preserve'><g id='XMLID_12_'><g id='XMLID_48_'><rect id='XMLID_49_' x='-0.8' y='2.8' transform='matrix(-0.7071 0.7071 -0.7071 -0.7071 8.4504 3.5003)' width='8.5' height='1.4'/></g></g><g id='XMLID_2_'><g id='XMLID_46_'><rect id='XMLID_47_' x='2.8' y='-0.8' transform='matrix(-0.707 0.7072 -0.7072 -0.707 8.4491 3.4999)' width='1.4' height='8.5'/></g></g></svg>"},"images/comments/closepanel.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 14 14' enable-background='new 0 0 14 14' xml:space='preserve' fill='currentColor'><g id='Arrows'><g><g><polygon points='7,1.842 8.469,1 13,6.999 8.469,13 7,12.158 10.842,6.999 '/></g></g><g><g><polygon points='0,1.842 1.469,1 6,6.999 1.469,13 0,12.158 3.842,6.999 '/></g></g></g></svg>"},"images/comments/collapsereplies.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 16 16' enable-background='new 0 0 16 16' xml:space='preserve' fill='currentColor'><g id='Close_arrow'><g><g><polygon points='8.524,8.021 8.508,8 8.5,8.005 8.492,8 8.476,8.021 2,12.243 2.57,13 8.5,9.134 14.43,13 15,12.243 '/></g></g><g><g><polygon points='8.524,3.021 8.508,3 8.5,3.005 8.492,3 8.476,3.021 2,7.243 2.57,8 8.5,4.134 14.43,8 15,7.243 '/></g></g></g></svg>"},"images/comments/commentspanelempty.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' viewBox='0 0 80 80'><path class='sf-element-svg-element sfc-comments-panel-bg-bubble-back' fill='currentColor' d='M53,14c-14.912,0-27,7.718-27,17.238s12.088,17.238,27,17.238c0.936,0,1.861-0.031,2.773-0.09L55.746,57l13.094-11.807 C75.6,42.06,80,36.978,80,31.238C80,21.718,67.912,14,53,14z'/><path class='sf-element-svg-element sfc-comments-panel-bg-bubble-front' fill='currentColor' d='M27,22C12.088,22,0,29.718,0,39.238s12.088,17.238,27,17.238c0.936,0,1.861-0.031,2.773-0.09L29.746,65 l13.094-11.807C49.6,50.06,54,44.978,54,39.238C54,29.718,41.912,22,27,22z'/></svg>"},"images/comments/commentstitlepanelicon.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' fill='currentColor' viewBox='0 0 27 27' enable-background='new 0 0 27 27' xml:space='preserve'><g id='Bubble'><g><g><path d='M13.5,2C6.044,2,0,5.956,0,10.835c0,4.879,6.044,8.835,13.5,8.835c0.47,0,0.933-0.016,1.391-0.047V24l6.497-6.006 C24.782,16.39,27,13.785,27,10.835C27,5.956,20.956,2,13.5,2z'/></g></g></g></svg>"},"images/comments/expandreplies.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' stroke='currentColor' stroke-miterlimit='10' x='0px' y='0px' viewBox='0 0 16 16' enable-background='new 0 0 16 16' xml:space='preserve'><path fill-rule='evenodd' clip-rule='evenodd' d='M7.902,6.167V2.762c0-0.144-0.126-0.262-0.281-0.262 c-0.062,0-0.116,0.023-0.163,0.054L7.456,2.55L0.115,7.527L0.118,7.53C0.048,7.578,0,7.651,0,7.738c0,0.087,0.048,0.16,0.118,0.208 L0.115,7.95l7.341,4.976l0.003-0.004c0.046,0.032,0.101,0.054,0.163,0.054c0.155,0,0.281-0.117,0.281-0.262V9.31 c5.333,0,8.102,4.191,8.102,4.191C16.004,6.167,7.902,6.167,7.902,6.167z'/></svg>"},"images/comments/indication_reply_with_state.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 16 16' enable-background='new 0 0 16 16' xml:space='preserve'><polygon fill='currentColor' points='2.2,0.6 2.2,14.9 7.9,10.8 13.8,14.9 13.8,0.6 '/></svg>"},"images/comments/indication_reply_with_state_small.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' fill='currentColor' viewBox='0 0 8 9' enable-background='new 0 0 8 9' xml:space='preserve'><g id='XMLID_2_'><g id='XMLID_20_'><path id='XMLID_21_' d='M0,0v9c0,0,2.033-1.409,4.006-3C5.866,7.526,8,9,8,9V0H0z'/></g></g></svg>"},"images/comments/inplaceminimize.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill='currentColor' x='0px' y='0px' viewBox='0 0 10 10' enable-background='new 0 0 10 10' xml:space='preserve'><g id='Lager_2'><g><g><rect y='8' width='10' height='2'/></g></g></g></svg>"},"images/comments/more.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 16 16' enable-background='new 0 0 16 16' xml:space='preserve'><path fill-rule='evenodd' clip-rule='evenodd' stroke='currentColor' stroke-miterlimit='10' d='M8.042,0.528 c4.027,0,7.292,3.347,7.292,7.475s-3.265,7.475-7.292,7.475S0.75,12.131,0.75,8.003S4.015,0.528,8.042,0.528z'/><g fill='currentColor'><rect x='5.5' y='7' fill-rule='evenodd' clip-rule='evenodd' width='5' height='1'/><rect x='6.5' y='8' fill-rule='evenodd' clip-rule='evenodd' width='3' height='1'/><rect x='7.5' y='9' fill-rule='evenodd' clip-rule='evenodd' width='1' height='1'/></g></svg>"},"images/comments/open_all_comments_small_panel_24x24.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 24 24' enable-background='new 0 0 24 24' xml:space='preserve'><g id='Doubble_boubble'><g><g class='sf-element sf-element-svg-element sfc-new-comment' fill='currentColor'><path d='M15.5,4C10.806,4,7,6.513,7,9.614c0,3.101,3.806,5.614,8.5,5.614c0.293,0,0.575-0.01,0.86-0.029V18l4.113-3.84 C22.607,13.14,24,11.486,24,9.614C24,6.513,20.194,4,15.5,4z'/></g></g><g><g class='sf-element sf-element-svg-element' fill='currentColor'><path d='M8.5,6C3.806,6,0,8.513,0,11.614c0,3.101,3.806,5.614,8.5,5.614c0.293,0,0.575-0.01,0.86-0.029V20 l4.113-3.84C15.607,15.14,17,13.486,17,11.614C17,8.513,13.194,6,8.5,6z'/></g></g></g></svg>"},"images/comments/reloadpanel.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' fill='currentColor' viewBox='0 0 12 12' enable-background='new 0 0 12 12' xml:space='preserve'><g><g><path d='M9.716,1.9c-2.332-2.245-6.11-2.201-8.444,0.108C0.718,2.557,0.293,3.186,0,3.856l1.275,0.581 c0.225-0.53,0.555-1.027,0.992-1.459C4.049,1.216,6.932,1.18,8.716,2.89L6.769,5H12V0L9.716,1.9z'/></g></g><g><g><path d='M10.728,7.553c-0.224,0.531-0.554,1.029-0.99,1.462c-1.778,1.767-4.656,1.802-6.437,0.089L5.244,7H0v5 l2.303-1.904c2.327,2.249,6.098,2.206,8.427-0.108c0.554-0.55,0.977-1.181,1.27-1.852L10.728,7.553z'/></g></g></svg>"},"images/comments/replyincontext.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 16 16' enable-background='new 0 0 16 16' xml:space='preserve'><g id='Bg'><g id='XMLID_30_'><g id='XMLID_49_'><path id='XMLID_50_' class='sf-element sf-element-svg-element sfc-comment-inline-reply-arrow-outer' fill='currentColor' d='M0,0v16c0,0,4.334-3.595,5.981-4.923C7.933,12.633,12,16,12,16V0H0z'/></g></g></g><g id='Arrow'><g id='XMLID_34_'><g id='XMLID_56_'><path id='XMLID_58_' class='sf-element sf-element-svg-element sfc-comment-inline-reply-arrow-outer' stroke='currentColor' d='M9.013,4.333V1.238C9.013,1.107,8.911,1,8.785,1C8.734,1,8.69,1.021,8.653,1.049 L8.65,1.046L3.094,5.57l0.002,0.003C3.039,5.616,3,5.683,3,5.762c0,0.079,0.039,0.146,0.096,0.189L3.094,5.954l5.557,4.524 l0.002-0.004c0.038,0.029,0.082,0.049,0.132,0.049c0.126,0,0.228-0.107,0.228-0.238V7.19C13.345,7.19,16,11,16,11 C16,4.333,9.013,4.333,9.013,4.333z'/><path id='XMLID_57_' class='sf-element sf-element-svg-element sfc-comment-inline-reply-arrow-inner' fill='currentColor' d='M9.013,4.333V1.238C9.013,1.107,8.911,1,8.785,1C8.734,1,8.69,1.021,8.653,1.049 L8.65,1.046L3.094,5.57l0.002,0.003C3.039,5.616,3,5.683,3,5.762c0,0.079,0.039,0.146,0.096,0.189L3.094,5.954l5.557,4.524 l0.002-0.004c0.038,0.029,0.082,0.049,0.132,0.049c0.126,0,0.228-0.107,0.228-0.238V7.19C13.345,7.19,16,11,16,11 C16,4.333,9.013,4.333,9.013,4.333z'/></g></g></g></svg>"},"images/comments/resetfilter.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 13 13' enable-background='new 0 0 13 13' xml:space='preserve'><g id='Lager_2'><g><g><circle class='sf-element sf-element-svg-element sfc-reset-circle' fill='currentColor' cx='6.5' cy='6.5' r='6.5'/></g></g></g><g id='Lager_4'><g><g><polygon class='sf-element sf-element-svg-element sfc-reset-cross' fill='currentColor' points='7.713,6.503 10,4.214 8.787,3 6.5,5.289 4.213,3 3,4.214 5.287,6.503 3.006,8.786 4.219,10 6.5,7.717 8.781,10 9.994,8.786 7.713,6.503 '/></g></g></g></svg>"},"images/contextualpopout/crosstable/1.sortingarrowup16x16.svg":{result:"<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'><path d='M3.284,8H6v4.5a1.5,1.5,0,1,0,3,0V8h2.745a1.132,1.132,0,0,0,0-1.409L8.362,2.431a1.047,1.047,0,0,0-1.693,0L3.284,6.591A1.028,1.028,0,0,0,3.284,8Z'/></svg>"},"images/contextualpopout/crosstable/10.txtheightcentre16x16.svg":{result:"<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'><rect x='1' y='10' width='14' height='1'/><rect x='5' y='7' width='6' height='1'/><rect x='1' y='4' width='14' height='1'/></svg>"},"images/contextualpopout/crosstable/11.txtdown16x16.svg":{result:"<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'><polygon points='8.997 3 8.997 1 7.997 1 7.997 3 5.997 3 8.497 6 10.997 3 8.997 3'/><rect x='1' y='8' width='14' height='1'/><rect x='5' y='11' width='6' height='1'/><rect x='1' y='14' width='14' height='1'/></svg>"},"images/contextualpopout/crosstable/12.horizontal16x16.svg":{result:"<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'><path d='M5.922,3H6.8V5.471a2,2,0,0,1,.714-0.545,2.163,2.163,0,0,1,.9-0.188,2.209,2.209,0,0,1,1.643.637,2.565,2.565,0,0,1,.631,1.88,3.036,3.036,0,0,1-.622,1.956,2.09,2.09,0,0,1-1.727.779A1.893,1.893,0,0,1,7.3,9.718,2.425,2.425,0,0,1,6.759,9.2V9.833H5.922V3ZM9.393,8.717A2.471,2.471,0,0,0,9.76,7.3,2.177,2.177,0,0,0,9.393,6a1.241,1.241,0,0,0-1.08-.515,1.578,1.578,0,0,0-1.091.422A1.794,1.794,0,0,0,6.754,7.3a2.843,2.843,0,0,0,.192,1.136,1.334,1.334,0,0,0,1.341.821A1.249,1.249,0,0,0,9.393,8.717Z'/><path d='M15.312,5.133A1.9,1.9,0,0,1,16,6.537H15.117a1.442,1.442,0,0,0-.368-0.763,1.222,1.222,0,0,0-.923-0.3,1.279,1.279,0,0,0-1.241.778,2.868,2.868,0,0,0-.242,1.246,2.192,2.192,0,0,0,.343,1.255,1.207,1.207,0,0,0,1.079.509,1.241,1.241,0,0,0,.895-0.315,1.684,1.684,0,0,0,.457-0.866H16a2.119,2.119,0,0,1-.757,1.444,2.5,2.5,0,0,1-1.549.457,2.145,2.145,0,0,1-1.69-.712,2.582,2.582,0,0,1-.631-1.778,2.837,2.837,0,0,1,.691-2.035,2.321,2.321,0,0,1,1.76-.728A2.5,2.5,0,0,1,15.312,5.133Z'/><path d='M3.148,6.828a0.5,0.5,0,0,0,.419-0.241,0.685,0.685,0,0,0,.061-0.321A0.665,0.665,0,0,0,3.3,5.646a1.885,1.885,0,0,0-.944-0.193,1.251,1.251,0,0,0-1.007.354,1.115,1.115,0,0,0-.216.582H0.282A1.4,1.4,0,0,1,.93,5.108a2.831,2.831,0,0,1,1.444-.36,3.142,3.142,0,0,1,1.547.334,1.112,1.112,0,0,1,.59,1.038V8.98a0.345,0.345,0,0,0,.058.21,0.3,0.3,0,0,0,.245.078c0.04,0,.086,0,0.136-0.006s0.1-.012.161-0.021V9.857a2.668,2.668,0,0,1-.323.069,2.535,2.535,0,0,1-.3.015A0.769,0.769,0,0,1,3.8,9.635a1.116,1.116,0,0,1-.156-0.46,2.293,2.293,0,0,1-.8.58A2.653,2.653,0,0,1,1.7,10,1.789,1.789,0,0,1,.477,9.581,1.336,1.336,0,0,1,0,8.533a1.3,1.3,0,0,1,.469-1.07A2.341,2.341,0,0,1,1.7,7ZM1.236,9.083a1.134,1.134,0,0,0,.681.209,2.23,2.23,0,0,0,.928-0.2A1.143,1.143,0,0,0,3.6,7.981V7.31a1.638,1.638,0,0,1-.428.163,3.885,3.885,0,0,1-.513.093l-0.549.065a2.274,2.274,0,0,0-.742.19,0.728,0.728,0,0,0-.421.694A0.664,0.664,0,0,0,1.236,9.083Z'/></svg>"},"images/contextualpopout/crosstable/13.vertical16x16.svg":{result:"<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'><path d='M4,10.078V9.2H6.471a2,2,0,0,1-.545-0.714,2.163,2.163,0,0,1-.188-0.9,2.209,2.209,0,0,1,.637-1.643,2.565,2.565,0,0,1,1.88-.631,3.036,3.036,0,0,1,1.956.622,2.09,2.09,0,0,1,.779,1.727A1.893,1.893,0,0,1,10.718,8.7a2.425,2.425,0,0,1-.519.542h0.634v0.837H4ZM9.717,6.607A2.471,2.471,0,0,0,8.3,6.24,2.177,2.177,0,0,0,7,6.607a1.241,1.241,0,0,0-.515,1.08,1.578,1.578,0,0,0,.422,1.091A1.794,1.794,0,0,0,8.3,9.246a2.843,2.843,0,0,0,1.136-.192,1.334,1.334,0,0,0,.821-1.341A1.249,1.249,0,0,0,9.717,6.607Z'/><path d='M6.133,0.688A1.9,1.9,0,0,1,7.537,0V0.883a1.442,1.442,0,0,0-.763.368,1.222,1.222,0,0,0-.3.923,1.279,1.279,0,0,0,.778,1.241,2.868,2.868,0,0,0,1.246.242,2.192,2.192,0,0,0,1.255-.343,1.207,1.207,0,0,0,.509-1.079A1.241,1.241,0,0,0,9.943,1.34,1.684,1.684,0,0,0,9.076.883V0a2.119,2.119,0,0,1,1.444.757,2.5,2.5,0,0,1,.457,1.549,2.145,2.145,0,0,1-.712,1.69,2.582,2.582,0,0,1-1.778.631,2.837,2.837,0,0,1-2.035-.691,2.321,2.321,0,0,1-.728-1.76A2.5,2.5,0,0,1,6.133.688Z'/><path d='M7.828,12.852a0.5,0.5,0,0,0-.241-0.419,0.685,0.685,0,0,0-.321-0.061,0.665,0.665,0,0,0-.621.33,1.885,1.885,0,0,0-.193.944,1.251,1.251,0,0,0,.354,1.007,1.115,1.115,0,0,0,.582.216v0.847a1.4,1.4,0,0,1-1.281-.647,2.831,2.831,0,0,1-.36-1.444,3.142,3.142,0,0,1,.334-1.547,1.112,1.112,0,0,1,1.038-.59H9.98a0.345,0.345,0,0,0,.21-0.058,0.3,0.3,0,0,0,.078-0.245c0-.04,0-0.086-0.006-0.136s-0.012-.1-0.021-0.161h0.618a2.668,2.668,0,0,1,.069.323,2.535,2.535,0,0,1,.015.3,0.769,0.769,0,0,1-.306.681,1.116,1.116,0,0,1-.46.156,2.293,2.293,0,0,1,.58.8A2.653,2.653,0,0,1,11,14.3a1.789,1.789,0,0,1-.419,1.228A1.336,1.336,0,0,1,9.533,16a1.3,1.3,0,0,1-1.07-.469A2.341,2.341,0,0,1,8,14.3Zm2.255,1.912a1.134,1.134,0,0,0,.209-0.681,2.23,2.23,0,0,0-.2-0.928A1.143,1.143,0,0,0,8.981,12.4H8.31a1.638,1.638,0,0,1,.163.428,3.885,3.885,0,0,1,.093.513l0.065,0.549a2.274,2.274,0,0,0,.19.742,0.728,0.728,0,0,0,.694.421A0.664,0.664,0,0,0,10.083,14.764Z'/></svg>"},"images/contextualpopout/crosstable/14.hide16x16.svg":{result:"<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'><path class='cls-2' d='M5.081,10.343A3.468,3.468,0,0,0,8,11.968a3.557,3.557,0,0,0,3.5-3.612,3.665,3.665,0,0,0-.382-1.61'/><path d='M13.35,5.545L11.223,6.812A3.331,3.331,0,0,1,11.5,8.356,3.557,3.557,0,0,1,8,11.968a3.256,3.256,0,0,1-2.8-1.605L3.278,11.506A9.579,9.579,0,0,0,8,13c3.714,0,8-3.405,8-4.644C16,7.718,14.962,6.571,13.35,5.545Z'/><path d='M5.964,9.979a2.3,2.3,0,0,0,2.042.957A2.5,2.5,0,0,0,10.5,8.351,2.053,2.053,0,0,0,10.3,7.4Z'/><path d='M14.22,3L11.257,4.439A8.678,8.678,0,0,0,8,3.713a8.718,8.718,0,0,0-3.3.741l-0.075.03v0C2.1,5.566,0,7.49,0,8.356A3.577,3.577,0,0,0,1.454,10.28L0,11.207,0.5,12.1l14.483-8.36ZM8.02,5.777A2.5,2.5,0,0,0,5.549,7.84l-1.04.62c0-.035-0.009-0.068-0.009-0.1A3.557,3.557,0,0,1,8,4.745,3.352,3.352,0,0,1,9.818,5.3L8.79,5.909A2.421,2.421,0,0,0,8.02,5.777Z'/></svg>"},"images/contextualpopout/crosstable/15.markvaluesvertical16x16.svg":{result:"<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'><path d='M12,3H4A2,2,0,0,0,2,5v6a2,2,0,0,0,2,2h8a2,2,0,0,0,2-2V5A2,2,0,0,0,12,3Zm1,8a1,1,0,0,1-1,1H4a1,1,0,0,1-1-1V5A1,1,0,0,1,4,4h8a1,1,0,0,1,1,1v6Z'/><path style='fill:#f99b15' d='M9,1H7A2,2,0,0,0,5,3V13a2,2,0,0,0,2,2H9a2,2,0,0,0,2-2V3A2,2,0,0,0,9,1ZM9,14H7a1,1,0,0,1-1-1V3A1,1,0,0,1,7,2H9a1,1,0,0,1,1,1V13h0A1,1,0,0,1,9,14Z'/></svg>"},"images/contextualpopout/crosstable/16.markvalueshorizontal16x16.svg":{result:"<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'><path d='M12.167,3H3.833A1.922,1.922,0,0,0,2,5v6a1.922,1.922,0,0,0,1.833,2h8.333A1.922,1.922,0,0,0,14,11V5A1.922,1.922,0,0,0,12.167,3Zm0.917,8a0.961,0.961,0,0,1-.917,1H3.833a0.961,0.961,0,0,1-.917-1V5a0.961,0.961,0,0,1,.917-1h8.333a0.961,0.961,0,0,1,.917,1v6Z'/><path style='fill:#f99b15' d='M14,5H2A2,2,0,0,0,0,7V9a2,2,0,0,0,2,2H14a2,2,0,0,0,2-2V7A2,2,0,0,0,14,5Zm1,4a1,1,0,0,1-1,1H2A1,1,0,0,1,1,9V7A1,1,0,0,1,2,6H14a1,1,0,0,1,1,1V9Z'/></svg>"},"images/contextualpopout/crosstable/17.globalsortup.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 16 16' xml:space='preserve'><g><g><path d='M12.7,7.6L9.4,3.4C9,3,8.4,2.9,7.9,3.2C7.8,3.3,7.7,3.3,7.7,3.4L4.3,7.6C3.9,8,3.9,8.6,4.3,9H7v3.5 C7,13.3,7.7,14,8.5,14s1.5-0.7,1.5-1.5V9h2.7C13.1,8.6,13.1,8,12.7,7.6z'/></g></g><g><g><rect x='2.4' y='2' width='12.1' height='1.1'/></g></g></svg>"},"images/contextualpopout/crosstable/18.globalsortdown.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 16 16' xml:space='preserve'><g><g><path d='M11.7,7H9V3.5C9,2.7,8.3,2,7.5,2S6,2.7,6,3.5V7H3.3c-0.3,0.4-0.3,1,0,1.4l3.4,4.2c0.3,0.5,1,0.6,1.5,0.2 c0.1-0.1,0.2-0.1,0.2-0.2l3.4-4.2C12.1,8,12.1,7.4,11.7,7z'/></g></g><g><g><rect x='1.3' y='13' width='12.1' height='1.1'/></g></g></svg>"},"images/contextualpopout/crosstable/2.sortingarrowdown16x16.svg":{result:"<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'><path d='M11.718,8H9V3.5a1.5,1.5,0,0,0-3,0V8H3.256a1.132,1.132,0,0,0,0,1.409l3.385,4.161a1.047,1.047,0,0,0,1.693,0l3.385-4.161A1.028,1.028,0,0,0,11.718,8Z'/></svg>"},"images/contextualpopout/crosstable/3.sizewidthtofit16x16.svg":{result:"<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'><path d='M14.623,7.261L10.983,4.252a0.889,0.889,0,0,0-1.233,0V7H6.25V4.227a0.978,0.978,0,0,0-1.232,0L1.377,7.236a0.939,0.939,0,0,0,0,1.5l3.641,3.009a0.889,0.889,0,0,0,1.233,0V9h3.5v2.774a0.978,0.978,0,0,0,1.233,0l3.641-3.009A0.939,0.939,0,0,0,14.623,7.261Z'/><rect class='cls-2' x='15' y='2' width='1' height='12'/><rect y='2' width='1' height='12'/></svg>"},"images/contextualpopout/crosstable/4.columnwidth16x16.svg":{result:"<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'><path d='M15.713,7.445L12.939,5.189a0.685,0.685,0,0,0-.939,0V7H10V2H9V14h1V9h2v1.83a0.755,0.755,0,0,0,.939,0l2.774-2.257A0.7,0.7,0,0,0,15.713,7.445Z' transform='translate(0)'/><path d='M6,2V7H4V5.189a0.685,0.685,0,0,0-.939,0L0.287,7.445a0.7,0.7,0,0,0,0,1.128L3.061,10.83a0.755,0.755,0,0,0,.939,0V9H6v5H7V2H6Z' transform='translate(0)'/></svg>"},"images/contextualpopout/crosstable/5.adjustrowheighttocontent16x16.svg":{result:"<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'><rect x='2' width='1' height='1' transform='translate(2 3) rotate(-90)'/><rect x='4' width='1' height='1' transform='translate(4 5) rotate(-90)'/><rect x='6' width='1' height='1' transform='translate(6 7) rotate(-90)'/><rect x='8' width='1' height='1' transform='translate(8 9) rotate(-90)'/><rect x='10' width='1' height='1' transform='translate(10 11) rotate(-90)'/><rect x='12' width='1' height='1' transform='translate(12 13) rotate(-90)'/><rect x='14' width='1' height='1' transform='translate(14 15) rotate(-90)'/><rect x='2' y='15' width='1' height='1' transform='translate(-13 18) rotate(-90)'/><rect x='4' y='15' width='1' height='1' transform='translate(-11 20) rotate(-90)'/><rect x='6' y='15' width='1' height='1' transform='translate(-9 22) rotate(-90)'/><rect x='8' y='15' width='1' height='1' transform='translate(-7 24) rotate(-90)'/><rect x='10' y='15' width='1' height='1' transform='translate(-5 26) rotate(-90)'/><rect x='12' y='15' width='1' height='1' transform='translate(-3 28) rotate(-90)'/><rect x='14' y='15' width='1' height='1' transform='translate(-1 30) rotate(-90)'/><path d='M9,10V6h2.773a0.9,0.9,0,0,0,0-1.174L8.765,1.359a0.968,0.968,0,0,0-1.5,0L4.252,4.826A0.818,0.818,0,0,0,4.252,6H7v4H4.227a0.9,0.9,0,0,0,0,1.174l3.009,3.467a0.968,0.968,0,0,0,1.5,0l3.009-3.467a0.818,0.818,0,0,0,0-1.174H9Z' transform='translate(0 0)'/></svg>"},"images/contextualpopout/crosstable/6.txtleft16x16.svg":{result:"<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'><rect x='1' y='13' width='14' height='1'/><rect x='1' y='10' width='6' height='1'/><rect x='1' y='7' width='9' height='1'/><rect x='1' y='4.002' width='6' height='1'/><rect x='1' y='1' width='14' height='1'/></svg>"},"images/contextualpopout/crosstable/7.txtwidthcenter16x16.svg":{result:"<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'><rect x='1' y='13' width='14' height='1'/><rect x='6.004' y='10' width='4' height='1'/><rect x='2.999' y='7' width='10' height='1'/><rect x='5' y='4.003' width='6' height='1'/><rect x='1' y='1' width='14' height='1'/></svg>"},"images/contextualpopout/crosstable/8.txtright16x16.svg":{result:"<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'><rect x='1' y='13' width='14' height='1'/><rect x='9' y='10' width='6' height='1'/><rect x='6' y='7' width='9' height='1'/><rect x='9' y='4.002' width='6' height='1'/><rect x='1' y='1' width='14' height='1'/></svg>"},"images/contextualpopout/crosstable/9.txtup16x16.svg":{result:"<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'><polygon points='7.503 10 5.003 13 7.003 13 7.003 15 8.003 15 8.003 13 10.003 13 7.503 10'/><rect x='1' y='7' width='14' height='1'/><rect x='5' y='4' width='6' height='1'/><rect x='1' y='1' width='14' height='1'/></svg>"},"images/contextualpopout/plotinteraction/1.general_16x16.svg":{result:"<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'><path d='M13.9,3.98l-0.753-.862a0.325,0.325,0,0,0-.5,0L7.245,9.3l-2.887-3.3a0.325,0.325,0,0,0-.5,0L3.1,6.854a0.451,0.451,0,0,0,0,.575l3.891,4.453a0.325,0.325,0,0,0,.5,0l6.4-7.326A0.451,0.451,0,0,0,13.9,3.98Z'/></svg>"},"images/contextualpopout/plotinteraction/10.referencelinevertical_16x16.svg":{result:"<svg data-name='Layer 4' xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'><defs></defs><rect style='opacity:0.7;' width='1' height='16'/><rect style='opacity:0.7;' x='1' y='15' width='15' height='1'/><rect x='7' width='2' height='16'/></svg>'Mark values (Alt+click)'Sort header 'Select sorting mode (Shift+click)'ta bort shift+click p options'Adapt column width to content (double-click divider)''Specify column width''Specify alignment and orientation''Specify alignment'"},"images/contextualpopout/plotinteraction/11.stacked_16x16.svg":{result:"<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'><rect width='1' height='16'/><rect x='1' y='15' width='15' height='1'/><rect style='fill:#f99b15' x='11' y='9.004' width='2' height='6'/><rect style='fill:#f99b15' x='7' y='12.002' width='2' height='3'/><rect style='fill:#f99b15' x='3' y='11.005' width='2' height='4'/><rect x='11' y='1.001' width='2' height='7'/><rect x='7' y='4.003' width='2' height='7'/><rect x='3' y='6.001' width='2' height='4'/></svg>"},"images/contextualpopout/plotinteraction/12.sidebysidebars_16x16.svg":{result:"<svg data-name='Layer 4' xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'><rect x='3' y='5' width='2' height='10'/><rect x='9' y='8' width='2' height='7'/><rect width='1' height='16'/><rect x='1' y='15' width='15' height='1'/><rect style='fill:#f99b15' x='6' y='11' width='2' height='4'/><rect style='fill:#f99b15' x='12' y='5' width='2' height='10'/></svg>"},"images/contextualpopout/plotinteraction/13.label16x16.svg":{result:"<svg data-name='Layer 5' xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'><defs></defs><rect width='1' height='16'/><rect x='1' y='15' width='15' height='1'/><rect x='11' y='11' width='2' height='4'/><rect x='7' y='11' width='2' height='4'/><rect x='3' y='8' width='2' height='7'/><rect style='fill:#f99b15' x='11' width='2' height='10'/><rect style='fill:#f99b15' x='7' width='2' height='10'/><rect style='fill:#f99b15' x='3' width='2' height='7'/></svg>"},"images/contextualpopout/plotinteraction/14.100stacked16x16.svg":{result:"<svg data-name='Layer 5' xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'><rect x='11' y='3' width='2' height='12'/><rect x='3' y='4' width='2' height='11'/><rect width='1' height='16'/><rect x='1' y='15' width='15' height='1'/><rect style='fill:#f99b15;' x='7' y='8' width='2' height='7'/></svg>"},"images/contextualpopout/plotinteraction/15.horizontalbars_16x16.svg":{result:"<svg data-name='Layer 5' xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'><rect x='1' y='3' width='12' height='2'/><rect x='1' y='11' width='11' height='2'/><rect y='15' width='16' height='1'/><rect width='1' height='15'/><rect style='fill:#f99b15' x='1' y='7' width='7' height='2'/></svg>"},"images/contextualpopout/plotinteraction/16.onlytop_16x16.svg":{result:"<svg data-name='Layer 3' xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'><title>16.OnlyTop_16x16</title><rect x='11' y='12' width='2' height='3'/><rect x='3' y='4' width='2' height='11'/><rect width='1' height='16'/><rect x='1' y='15' width='15' height='1'/><rect x='7' y='8' width='2' height='7'/></svg>"},"images/contextualpopout/plotinteraction/17.label_16x16.svg":{result:"<svg data-name='Layer 4' xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'><rect x='3' y='3' width='2' height='12'/><g><rect style='fill:#fbb95c' x='12' y='11' width='2' height='4'/><rect style='opacity:0.7;' x='9' y='8' width='2' height='7'/></g><rect style='fill:#f99b15' x='6' y='6' width='2' height='9'/><rect width='1' height='16'/><rect x='1' y='15' width='15' height='1'/></svg>"},"images/contextualpopout/plotinteraction/18.markers_16x16.svg":{result:"<svg data-name='Layer 7' xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'><circle style='fill:#f99b15' cx='14' cy='10' r='1'/><circle style='fill:#f99b15' cx='9' cy='4' r='1'/><circle style='fill:#f99b15' cx='4' cy='10.999' r='1'/><rect y='15' width='16' height='1'/><rect width='1' height='15'/><rect x='10.97' y='5.909' width='1.061' height='3.182' transform='translate(-1.935 10.328) rotate(-45)'/><polygon points='7.829 6 5 9.2 5.707 10 8.536 6.8 7.829 6'/></svg>"},"images/contextualpopout/plotinteraction/19.reverse_16x16.svg":{result:"<svg data-name='Layer 3' xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'><rect x='3' y='12' width='2' height='3'/><rect style='fill:#f99b15' x='7' y='8' width='2' height='7'/><rect x='11' y='4' width='2' height='11'/><rect width='1' height='16'/><rect x='1' y='15' width='15' height='1'/></svg>"},"images/contextualpopout/plotinteraction/2.numbers_16x16.svg":{result:"<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'><defs></defs><path d='M5,10.043L7.143,8.022C8,7.224,8.308,6.78,8.308,6.159a0.983,0.983,0,0,0-1-1.075A1.8,1.8,0,0,0,5.862,6.12l-0.773-.67A2.516,2.516,0,0,1,7.383,4,1.954,1.954,0,0,1,9.437,6.061V6.08c0,1.085-.517,1.676-1.619,2.672L6.538,9.935H9.5V11H5V10.043Z'/><path d='M2.387,5.241l-1.149.348L1,4.6,2.715,4H3.5v7H2.387V5.241Z'/><path d='M10,9.791L10.838,9a2.219,2.219,0,0,0,1.793.9,1.072,1.072,0,0,0,1.18-1.042V8.847c0-.678-0.614-1.062-1.57-1.062H11.687l-0.2-.757,1.842-1.976H10.38V4h4.513V4.9l-1.9,1.966A1.974,1.974,0,0,1,15,8.807v0.02A2.191,2.191,0,0,1,12.612,11,3.224,3.224,0,0,1,10,9.791Z'/></svg>"},"images/contextualpopout/plotinteraction/20.date_16x16.svg":{result:"<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'><path d='M12,2H4A2,2,0,0,0,2,4v8a2,2,0,0,0,2,2h8a2,2,0,0,0,2-2V4A2,2,0,0,0,12,2ZM10,3h2V5H10V3ZM4,3H6V5H4V3Zm9,9a1,1,0,0,1-1,1H4a1,1,0,0,1-1-1V7A1,1,0,0,1,4,6h8a1,1,0,0,1,1,1v5Z'/><polygon points='10.373 7 9 7.425 9.19 8.135 10.109 7.887 10.109 12 11 12 11 7 10.373 7'/><path d='M6.594,9.051l1.331-1.4V7H4.766V7.751H6.833L5.544,9.163,5.68,9.7H6.069a0.9,0.9,0,0,1,1.1.758v0.015a0.756,0.756,0,0,1-.825.744,1.545,1.545,0,0,1-1.256-.646L4.5,11.136A2.24,2.24,0,0,0,6.328,12,1.547,1.547,0,0,0,8,10.448V10.434A1.4,1.4,0,0,0,6.594,9.051Z'/></svg>"},"images/contextualpopout/plotinteraction/21.011_16x16.svg":{result:"<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'><path d='M1,8.017V8C1,6.343,2,5,3.508,5S6,6.326,6,7.984V8c0,1.658-1,3-2.508,3S1,9.674,1,8.017Zm3.959,0V8c0-1.144-.582-2.08-1.468-2.08s-1.451.912-1.451,2.063V8c0,1.143.574,2.081,1.467,2.081S4.959,9.16,4.959,8.017Z'/><path d='M11,7h1V8H11V7Zm0,2h1v1H11V9Z'/><path d='M14.109,6.063l-0.919.3L13,5.51,14.372,5H15v6H14.109V6.063Z'/><rect x='7' y='7' width='1' height='1'/><path d='M7,9H8v1H7V9Z'/><path d='M9.11,6.063l-0.92.3L8,5.51,9.373,5H10v6H9.11V6.063Z'/></svg>"},"images/contextualpopout/plotinteraction/3.percentage_16x16.svg":{result:"<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'><defs></defs><path d='M3,5.528V5.5A2.319,2.319,0,0,1,5.2,3,2.29,2.29,0,0,1,7.383,5.472V5.5A2.319,2.319,0,0,1,5.178,8,2.29,2.29,0,0,1,3,5.528Zm7.742-2.417h1.315l-6.8,9.777H3.943ZM6.2,5.528V5.5A1.253,1.253,0,0,0,5.178,4.075a1.206,1.206,0,0,0-1,1.4V5.5A1.245,1.245,0,0,0,5.2,6.925,1.205,1.205,0,0,0,6.2,5.528Zm2.416,5V10.5A2.32,2.32,0,0,1,10.822,8,2.29,2.29,0,0,1,13,10.473V10.5A2.319,2.319,0,0,1,10.8,13,2.29,2.29,0,0,1,8.617,10.529Zm3.2,0V10.5A1.254,1.254,0,0,0,10.8,9.076a1.205,1.205,0,0,0-1,1.4V10.5a1.244,1.244,0,0,0,1.022,1.425A1.206,1.206,0,0,0,11.818,10.529Z'/></svg>"},"images/contextualpopout/plotinteraction/4.currency_16x16.svg":{result:"<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'><path d='M8.761,6.991V4.327a5.3,5.3,0,0,1,2.03.9l0.836-1.318A5.926,5.926,0,0,0,8.82,2.841V2h-1.3V2.813c-1.865.14-3.134,1.164-3.134,2.678V5.519c0,1.57,1.015,2.341,3.194,2.874V11.14A5.563,5.563,0,0,1,4.955,9.935L4,11.21A7.173,7.173,0,0,0,7.522,12.6V14h1.3V12.612c1.9-.154,3.18-1.177,3.18-2.705V9.879C12,8.379,11.03,7.523,8.761,6.991ZM7.582,6.7C6.432,6.374,6.149,6,6.149,5.42V5.393A1.288,1.288,0,0,1,7.582,4.229V6.7ZM10.239,10A1.317,1.317,0,0,1,8.761,11.2V8.659c1.164,0.323,1.478.7,1.478,1.318V10Z'/></svg>"},"images/contextualpopout/plotinteraction/5.scientific_16x16.svg":{result:"<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'><defs></defs><polygon points='4.059 5 2 5.596 2.285 6.589 3.664 6.241 3.664 12 5 12 5 5 4.059 5'/><path d='M9.01,5C7.2,5,6,6.566,6,8.5V8.519C6,10.453,7.18,12,8.99,12S12,10.433,12,8.5V8.481C12,6.547,10.81,5,9.01,5Zm1.741,3.519c0,1.334-.669,2.408-1.741,2.408S7.25,9.834,7.25,8.5V8.481c0-1.344.679-2.408,1.74-2.408S10.752,7.166,10.752,8.5V8.519Z'/><polygon points='15 3.812 14.188 3 13 4.188 11.812 3 11 3.812 12.188 5 11 6.188 11.812 7 13 5.812 14.188 7 15 6.188 13.812 5 15 3.812'/></svg>"},"images/contextualpopout/plotinteraction/6.ab12_16x16.svg":{result:"<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'><defs></defs><path d='M13.367,10.087l1.139-1.014c0.98-.854,1.438-1.361,1.438-2.291V6.766A1.706,1.706,0,0,0,14.118,5a2.245,2.245,0,0,0-2.04,1.242l0.687,0.575a1.6,1.6,0,0,1,1.281-.887,0.857,0.857,0,0,1,.894.921,2.194,2.194,0,0,1-1.036,1.6L12,10.18V11h4V10.087H13.367Z'/><polygon points='10.372 5 9 5.51 9.19 6.362 10.109 6.064 10.109 11 11 11 11 5 10.372 5'/><path d='M7.2,6.547a1.52,1.52,0,0,0-1.311.8V5H5v5.911H5.887V10.247A1.541,1.541,0,0,0,7.2,11,1.972,1.972,0,0,0,9,8.782V8.765A1.976,1.976,0,0,0,7.2,6.547ZM8.1,8.782A1.208,1.208,0,0,1,6.993,10.15,1.237,1.237,0,0,1,5.865,8.782V8.765A1.241,1.241,0,0,1,6.993,7.4,1.222,1.222,0,0,1,8.1,8.765V8.782Z'/><path d='M2.063,6a3.51,3.51,0,0,0-1.679.4L0.66,7.289a2.848,2.848,0,0,1,1.261-.3A0.955,0.955,0,0,1,3.006,8.02V8.111a3.426,3.426,0,0,0-1.219-.2A1.558,1.558,0,0,0,0,9.492V9.51A1.461,1.461,0,0,0,1.57,11,1.724,1.724,0,0,0,3,10.305V10.9H4V8.038A1.782,1.782,0,0,0,2.063,6Zm0.96,3.153a1.06,1.06,0,0,1-1.169,1.015A0.749,0.749,0,0,1,1,9.455V9.437a0.833,0.833,0,0,1,1.011-.749,2.664,2.664,0,0,1,1.01.192V9.153Z'/></svg>"},"images/contextualpopout/plotinteraction/7.gridlineshorizontal16x16.svg":{result:"<svg data-name='Layer 3' xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'><rect x='2' y='4' width='1' height='1'/><rect x='5' y='4' width='1' height='1'/><rect x='8' y='4' width='1' height='1'/><rect x='11' y='4' width='1' height='1'/><rect x='14' y='4' width='1' height='1'/><rect x='2' y='9' width='1' height='1'/><rect x='5' y='9' width='1' height='1'/><rect x='8' y='9' width='1' height='1'/><rect x='11' y='9' width='1' height='1'/><rect x='14' y='9' width='1' height='1'/><rect width='1' height='16'/><rect x='1' y='15' width='15' height='1'/></svg>"},"images/contextualpopout/plotinteraction/8.gridlinesvertical16x16.svg":{result:"<svg data-name='Layer 3' xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'><rect x='10' y='1' width='1' height='1'/><rect x='10' y='4' width='1' height='1'/><rect x='10' y='7' width='1' height='1'/><rect x='10' y='10' width='1' height='1'/><rect x='10' y='13' width='1' height='1'/><rect x='5' y='1' width='1' height='1'/><rect x='5' y='4' width='1' height='1'/><rect x='5' y='7' width='1' height='1'/><rect x='5' y='10' width='1' height='1'/><rect x='5' y='13' width='1' height='1'/><rect width='1' height='16'/><rect x='1' y='15' width='15' height='1'/></svg>"},"images/contextualpopout/plotinteraction/9.referencelinehorizontal_16x16.svg":{result:"<svg data-name='Layer 4' xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'><rect style='opacity:0.7;' width='1' height='16'/><rect style='opacity:0.7;' x='1' y='15' width='15' height='1'/><rect y='7' width='16' height='2'/></svg>"},"images/contextualpopout/tableplot/movecolumnfirst.svg":{result:"<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'><path d='M2,2A1,1,0,0,0,1,3V13a1,1,0,0,0,1,1H4.093V2H2Z' style='fill:#f99c1c'/><path d='M1,13a0.965,0.965,0,0,0,.925,1H2A1,1,0,0,1,1,13Z'/><path d='M2,2H1.925A0.965,0.965,0,0,0,1,3,1,1,0,0,1,2,2Z' transform='translate(0 0)'/><path d='M14,1H2A2,2,0,0,0,0,3V13a2,2,0,0,0,2,2H14a2,2,0,0,0,2-2V3A2,2,0,0,0,14,1ZM4.093,14H1.925A0.965,0.965,0,0,1,1,13V3a0.965,0.965,0,0,1,.925-1H4.093V14ZM15,13a1,1,0,0,1-1,1H5.07V2H14a1,1,0,0,1,1,1V13Z'/><path d='M12.394,6.041H10V4.3c-0.015-.013.015-0.026,0-0.037C9.555,3.912,9.38,3.9,8.853,4.3L6.358,7.254a0.972,0.972,0,0,0,0,1.492L8.853,11.7C9.4,12.1,9.555,12.088,10,11.734c0.015-.012-0.015-0.024,0-0.037V9.959h2.394C14,9.959,14,9.032,14,7.968S14.229,6.041,12.394,6.041Z'/></svg>"},"images/contextualpopout/tableplot/movecolumnlast.svg":{result:"<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'><path d='M14,2H11.907V14H14a1,1,0,0,0,1-1V3A1,1,0,0,0,14,2Z' style='fill:#f99c1c'/><path d='M15,3a0.965,0.965,0,0,0-.925-1H14A1,1,0,0,1,15,3Z'/><path d='M14,14h0.075A0.965,0.965,0,0,0,15,13,1,1,0,0,1,14,14Z'/><path d='M14,1H2A2,2,0,0,0,0,3V13a2,2,0,0,0,2,2H14a2,2,0,0,0,2-2V3A2,2,0,0,0,14,1ZM10.93,14H2a1,1,0,0,1-1-1V3A1,1,0,0,1,2,2h8.93V14ZM15,13a0.965,0.965,0,0,1-.925,1H11.907V2h2.168A0.965,0.965,0,0,1,15,3V13Z'/><path d='M9.642,7.254L7.147,4.3C6.6,3.9,6.445,3.912,6,4.266,5.985,4.278,6.015,4.291,6,4.3V6.041H3.606C2,6.041,2,6.968,2,8.032S1.771,9.959,3.606,9.959H6V11.7c0.015,0.013-.015.026,0,0.037,0.445,0.354.62,0.368,1.147-.037l2.495-2.95A0.972,0.972,0,0,0,9.642,7.254Z'/></svg>"},"images/controls/scrollbararrowdown.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' viewBox='0 0 12 12' fill='currentColor'><polygon points='3 4 6 8 9 4 3 4'/></svg>"},"images/controls/styleddropdownarrow.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 21 20' enable-background='new 0 0 21 20' xml:space='preserve'><path fill='currentColor' d='M7,8l3.5,4L14,8C11.614,8,7,8,7,8z'/></svg>"},"images/data/addcolumn.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 13 13' enable-background='new 0 0 13 13' xml:space='preserve'><g><g><path fill='currentColor' d='M6.5,0C2.91,0,0,2.91,0,6.5S2.91,13,6.5,13S13,10.09,13,6.5S10.09,0,6.5,0z M6.5,12C3.467,12,1,9.533,1,6.5S3.467,1,6.5,1 S12,3.467,12,6.5S9.533,12,6.5,12z'/></g></g><g><g><rect fill='currentColor' x='6' y='6' width='1' height='1'/></g></g><g><g><rect fill='currentColor' x='6' y='4' width='1' height='2'/></g></g><g><g><rect fill='currentColor' x='7' y='6' width='2' height='1'/></g></g><g><g><rect fill='currentColor' x='6' y='7' width='1' height='2'/></g></g><g><g><rect fill='currentColor' x='4' y='6' width='2' height='1'/></g></g></svg>"},"images/data/binary.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 9 9' enable-background='new 0 0 9 9' xml:space='preserve'><g><path fill='currentColor' d='M1.7,0H0.3C0.1,0,0,0.1,0,0.3v1.5C0,1.9,0.1,2,0.3,2h1.5C1.9,2,2,1.9,2,1.7V0.3C2,0.1,1.9,0,1.7,0z'/></g><g><path fill='currentColor' d='M1.7,3.5H0.3C0.1,3.5,0,3.6,0,3.8v1.5c0,0.1,0.1,0.3,0.3,0.3h1.5C1.9,5.5,2,5.4,2,5.2V3.8 C2,3.6,1.9,3.5,1.7,3.5z'/></g><g><path fill='currentColor' d='M1.7,7H0.3C0.1,7,0,7.1,0,7.3v1.5C0,8.9,0.1,9,0.3,9h1.5C1.9,9,2,8.9,2,8.7V7.3C2,7.1,1.9,7,1.7,7z'/></g><g><path fill='currentColor' d='M5.2,0H3.8C3.6,0,3.5,0.1,3.5,0.3v1.5C3.5,1.9,3.6,2,3.8,2h1.5c0.1,0,0.3-0.1,0.3-0.3V0.3 C5.5,0.1,5.4,0,5.2,0z'/></g><g><path fill='currentColor' d='M5.2,3.5H3.8c-0.1,0-0.3,0.1-0.3,0.3v1.5c0,0.1,0.1,0.3,0.3,0.3h1.5c0.1,0,0.3-0.1,0.3-0.3V3.8 C5.5,3.6,5.4,3.5,5.2,3.5z'/></g><g opacity='0.65'><path fill='currentColor' d='M5.2,7H3.8C3.6,7,3.5,7.1,3.5,7.3v1.5C3.5,8.9,3.6,9,3.8,9h1.5c0.1,0,0.3-0.1,0.3-0.3V7.3 C5.5,7.1,5.4,7,5.2,7z'/></g><g><path fill='currentColor' d='M8.7,0H7.3C7.1,0,7,0.1,7,0.3v1.5C7,1.9,7.1,2,7.3,2h1.5C8.9,2,9,1.9,9,1.7V0.3C9,0.1,8.9,0,8.7,0z'/></g><g opacity='0.65'><path fill='currentColor' d='M8.7,3.5H7.3C7.1,3.5,7,3.6,7,3.8v1.5c0,0.1,0.1,0.3,0.3,0.3h1.5C8.9,5.5,9,5.4,9,5.2V3.8 C9,3.6,8.9,3.5,8.7,3.5z'/></g><g><path fill='currentColor' d='M8.7,7H7.3C7.1,7,7,7.1,7,7.3v1.5C7,8.9,7.1,9,7.3,9h1.5C8.9,9,9,8.9,9,8.7V7.3C9,7.1,8.9,7,8.7,7z'/></g></svg>"},"images/data/categories.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 14 13' enable-background='new 0 0 14 13' xml:space='preserve'><path fill='currentColor' d='M7.248,7C7.182,7,7.116,6.986,7.054,6.958L0.557,3.96C0.402,3.888,0.3,3.736,0.294,3.567 C0.287,3.397,0.377,3.238,0.527,3.155l5.587-3.098C6.244-0.014,6.4-0.019,6.533,0.042l6.497,2.998 c0.155,0.072,0.257,0.223,0.264,0.393c0.007,0.169-0.084,0.328-0.233,0.411L7.473,6.942C7.403,6.981,7.326,7,7.248,7z M1.753,3.513 L7.229,6.04l4.604-2.553L6.358,0.96L1.753,3.513z'/><path fill='currentColor' d='M7.32,10.013c-0.069,0-0.138-0.014-0.202-0.042L0.266,6.968C0.033,6.866-0.066,6.61,0.046,6.397 C0.157,6.183,0.438,6.093,0.67,6.195l6.634,2.908l6.002-3.037c0.227-0.115,0.511-0.039,0.636,0.168 c0.125,0.207,0.043,0.467-0.183,0.582L7.546,9.959C7.476,9.995,7.398,10.013,7.32,10.013z'/><path fill='currentColor' d='M7.32,13c-0.069,0-0.138-0.014-0.202-0.042L0.266,9.956c-0.233-0.102-0.332-0.358-0.22-0.571 C0.157,9.17,0.438,9.081,0.67,9.183l6.635,2.908l6.001-3.037c0.228-0.115,0.51-0.039,0.636,0.168 c0.125,0.207,0.043,0.468-0.183,0.582l-6.212,3.143C7.476,12.982,7.398,13,7.32,13z'/></svg>"},"images/data/clearsearch.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 14 14' style='enable-background:new 0 0 14 14;' xml:space='preserve'><g><g><path d='M7,0C3.134,0,0,3.134,0,7c0,3.866,3.134,7,7,7s7-3.134,7-7C14,3.134,10.866,0,7,0z M9.468,8.44 c0.341,0.341,0.387,0.847,0.103,1.131S8.781,9.809,8.44,9.468L7,8.029L5.457,9.571c-0.284,0.284-0.745,0.284-1.029,0 c-0.284-0.284-0.284-0.745,0-1.029L5.971,7l-1.44-1.44C4.191,5.219,4.145,4.713,4.429,4.429S5.219,4.191,5.56,4.531L7,5.971 l1.543-1.543c0.284-0.284,0.745-0.284,1.029,0s0.284,0.744,0,1.029L8.029,7L9.468,8.44z'/></g></g></svg>"},"images/data/closedataoverview.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 22 12' enable-background='new 0 0 22 12' xml:space='preserve'><g id='Lager_2'><g><g><polygon fill='currentColor' points='16.776,2 18,2.701 15.799,5.999 18,9.299 16.776,10 14,5.999 '/></g></g><g><g><polygon fill='currentColor' points='20.776,2 22,2.701 19.799,5.999 22,9.299 20.776,10 18,5.999 '/></g></g></g><g id='Lager_3'><g><g><path fill='currentColor' d='M11.675,5.061l-0.888-0.222c-0.144-0.036-0.259-0.144-0.305-0.285c-0.078-0.244-0.176-0.479-0.291-0.703 c-0.067-0.132-0.062-0.289,0.014-0.417l0.471-0.785c0.101-0.169,0.075-0.385-0.065-0.524l-0.739-0.74 C9.734,1.248,9.518,1.221,9.349,1.323L8.564,1.793C8.438,1.87,8.28,1.875,8.148,1.808c-0.224-0.115-0.459-0.212-0.703-0.29 C7.304,1.472,7.196,1.357,7.16,1.213L6.938,0.325C6.89,0.134,6.719,0,6.522,0H5.477C5.281,0,5.109,0.134,5.062,0.325L4.84,1.213 C4.804,1.356,4.696,1.472,4.555,1.517C4.311,1.595,4.076,1.693,3.851,1.808C3.719,1.875,3.562,1.87,3.435,1.794L2.65,1.323 C2.481,1.223,2.266,1.249,2.126,1.388L1.388,2.127C1.249,2.266,1.222,2.482,1.323,2.651l0.47,0.784 C1.87,3.561,1.875,3.719,1.808,3.851c-0.115,0.225-0.213,0.46-0.291,0.704C1.472,4.696,1.356,4.804,1.213,4.84L0.325,5.062 C0.134,5.109,0,5.281,0,5.477l0,1.045c0,0.197,0.134,0.368,0.324,0.416l0.888,0.222c0.144,0.036,0.259,0.144,0.305,0.285 c0.078,0.244,0.175,0.479,0.29,0.704C1.875,8.281,1.87,8.438,1.794,8.565l-0.47,0.784C1.222,9.518,1.249,9.734,1.388,9.873 l0.739,0.74c0.139,0.139,0.355,0.166,0.524,0.064l0.784-0.47c0.127-0.076,0.285-0.082,0.416-0.014 c0.225,0.115,0.46,0.213,0.704,0.291c0.141,0.045,0.249,0.16,0.285,0.304l0.222,0.888C5.109,11.866,5.28,12,5.477,12h1.046 c0.197,0,0.368-0.134,0.416-0.325l0.222-0.888c0.036-0.143,0.144-0.259,0.285-0.304c0.244-0.078,0.479-0.176,0.703-0.291 c0.132-0.067,0.29-0.062,0.416,0.014l0.784,0.47c0.169,0.101,0.384,0.075,0.524-0.064l0.739-0.74 c0.139-0.139,0.166-0.355,0.065-0.524l-0.471-0.784c-0.076-0.127-0.082-0.285-0.014-0.416c0.115-0.225,0.212-0.46,0.29-0.703 c0.046-0.141,0.161-0.249,0.305-0.285l0.888-0.222C11.866,6.891,12,6.719,12,6.522V5.477C12,5.28,11.866,5.109,11.675,5.061z M6,8.143C4.816,8.143,3.857,7.184,3.857,6c0-1.184,0.959-2.143,2.143-2.143S8.143,4.816,8.143,6 C8.143,7.184,7.184,8.143,6,8.143z'/></g></g></g></svg>"},"images/data/collapsed.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 14 14' enable-background='new 0 0 14 14' xml:space='preserve' fill='currentColor'><g id='Lager_1'><g><g><polygon points='5.5,4 5.5,11 9.5,7.5 '/></g></g></g></svg>"},"images/data/cube.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 14 14' enable-background='new 0 0 14 14' xml:space='preserve'><path d='M12.817,3.351L7.183,0.035c-0.092-0.047-0.229-0.047-0.366,0L1.183,3.351C1.092,3.398,1,3.538,1,3.678v6.632 c0,0.14,0.092,0.234,0.183,0.327l5.634,3.316C6.863,14,6.954,14,7,14c0.046,0,0.137,0,0.183-0.047l5.634-3.316 C12.908,10.59,13,10.45,13,10.31V3.678C12.954,3.538,12.908,3.398,12.817,3.351z M7,0.782l4.901,2.896L8.237,5.827L7,6.527 L5.763,5.827L2.099,3.678L7,0.782z M1.733,4.285l3.664,2.148l1.237,0.701v5.791l-4.901-2.849V4.285z M12.267,10.077l-4.901,2.896 V7.181L8.603,6.48l3.664-2.148V10.077z' fill='currentColor'/></svg>"},"images/data/currency.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 14 14' enable-background='new 0 0 14 14' xml:space='preserve'><g><path fill='currentColor' d='M13.239,14c-0.149,0-0.296-0.072-0.386-0.204c-0.405-0.594-1.682-2.158-2.717-2.26c-0.802-0.078-1.577,0.161-2.487,0.547 c-1.366,0.577-2.077,0.679-3.067,0.679c-2.234,0-3.586-0.905-3.939-1.229l-0.16-0.118c-0.207-0.154-0.25-0.446-0.097-0.653 c0.154-0.207,0.445-0.25,0.653-0.097l0.271,0.225v0c0.011,0,1.129,0.94,3.272,0.94c0.792,0,1.368-0.041,2.703-0.605 c0.901-0.382,1.879-0.722,2.942-0.616c1.652,0.162,3.224,2.408,3.397,2.663c0.145,0.213,0.089,0.503-0.124,0.648 C13.421,13.973,13.329,14,13.239,14z'/><path fill='currentColor' d='M13.533,12.036c-0.118,0-0.235-0.045-0.323-0.13l-0.784-0.753c-1.31-1.565-3.174-1.654-5.323-0.659 c-1.016,0.47-2.013,0.708-2.963,0.708c-2.53,0-3.833-1.632-3.974-1.818L0.092,9.282C0.032,9.202,0,9.104,0,9.004V0.466 c0-0.201,0.129-0.38,0.32-0.443c0.191-0.062,0.401,0.003,0.521,0.164l0.798,1.071C1.672,1.302,2.493,2.356,4.14,2.356 c0.673,0,1.404-0.18,2.171-0.535C7.5,1.271,8.654,0.992,9.739,0.992c2.486,0,3.822,1.451,4.065,1.742l0.086,0.103 C13.961,2.92,14,3.027,14,3.137v8.432c0,0.187-0.112,0.356-0.284,0.429C13.657,12.024,13.595,12.036,13.533,12.036z M9.739,8.905 c1.294,0,2.474,0.555,3.327,1.564V3.307c-0.247-0.285-1.324-1.382-3.327-1.382c-0.949,0-1.971,0.25-3.037,0.743 C5.812,3.08,4.95,3.289,4.14,3.289c-1.916,0-2.985-1.152-3.207-1.419v6.979c0.156,0.194,1.22,1.42,3.207,1.42 c0.813,0,1.678-0.209,2.571-0.622C7.775,9.154,8.794,8.905,9.739,8.905z'/><g><path fill='currentColor' d='M7,4.058c-1.034,0-1.872,0.887-1.872,1.981c0,1.095,0.838,1.982,1.872,1.982c1.034,0,1.872-0.887,1.872-1.982 C8.872,4.945,8.034,4.058,7,4.058z M7.272,7.418c-0.571,0-0.959-0.342-1.105-0.851H5.825V6.192h0.28 C6.101,6.156,6.101,6.118,6.101,6.078c0-0.045,0-0.093,0.004-0.138h-0.28V5.565h0.35c0.153-0.49,0.534-0.836,1.086-0.836 c0.462,0,0.72,0.201,0.918,0.475L7.746,5.531c-0.142-0.19-0.28-0.294-0.497-0.294c-0.22,0-0.38,0.123-0.473,0.327h0.686V5.94 H6.686C6.682,5.981,6.682,6.025,6.682,6.07c0,0.041,0,0.086,0.004,0.122h0.777v0.375H6.768C6.866,6.787,7.037,6.91,7.272,6.91 c0.216,0,0.339-0.104,0.504-0.305l0.41,0.301C7.966,7.214,7.701,7.418,7.272,7.418z'/></g></g></svg>"},"images/data/dataaccesssettingscollapse.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 12 12' enable-background='new 0 0 12 12' xml:space='preserve'><g id='Lager_3' shape-rendering='crispEdges' fill='currentColor'><g><g><polygon points='6,3 4.8,4.167 10.8,10 12,8.833 '/></g></g><g><g><polygon points='6,3 0,8.833 1.2,10 7.2,4.167 '/></g></g></g></svg>"},"images/data/dataaccesssettingsexpand.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 12 12' enable-background='new 0 0 12 12' xml:space='preserve'><g id='Lager_3' shape-rendering='crispEdges' fill='currentColor'><g><g><polygon points='1.2,3 0,4.167 6,10 7.2,8.833 '/></g></g><g><g><polygon points='10.8,3 4.8,8.833 6,10 12,4.167 '/></g></g></g></svg>"},"images/data/dataaccesssettingstablecollapse.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 14 14' style='enable-background:new 0 0 14 14;' xml:space='preserve'><g><g><path d='M7,0C3.134,0,0,3.134,0,7c0,3.866,3.134,7,7,7s7-3.134,7-7C14,3.134,10.866,0,7,0z M10.5,8h-7V6h7V8z'/></g></g></svg>"},"images/data/dataaccesssettingstableexpand.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 14 14' style='enable-background:new 0 0 14 14;' xml:space='preserve'><style type='text/css'> .st0{fill:#FFFFFF;}</style><g id='Cirkle'><circle cx='7' cy='7' r='7'/></g><g id='Add'><rect x='6' y='3.5' class='st0' width='2' height='7'/><rect x='6' y='3.5' transform='matrix(3.910809e-11 1 -1 3.910809e-11 14 -2.742118e-10)' class='st0' width='2' height='7'/></g></svg>"},"images/data/dataoverviewdelete.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 12 12' enable-background='new 0 0 12 12' xml:space='preserve'><g id='Thrash'><g><g><path fill='currentColor' d='m1.632,4l0.796,6.955c0.001,0.577 0.427,1.045 0.953,1.045l5.238,0c0.526,0 0.952,-0.468 0.952,-1.045l0.796,-6.955l-8.735,0z'/></g></g><g><g><path fill='currentColor' d='m10.543,2l-2.4,0l0,-0.953c0,-0.578 -0.427,-1.047 -0.953,-1.047l-2.381,0c-0.525,0 -0.952,0.469 -0.952,1.047l0,0.953l-2.4,0c-0.253,0 -0.457,0.227 -0.457,0.508c0,0.253 0.169,0.453 0.386,0.492l9.229,0c0.216,-0.039 0.385,-0.239 0.385,-0.492c0,-0.281 -0.204,-0.508 -0.457,-0.508zm-2.876,0l-3.334,0l0,-0.953c0,-0.289 0.213,-0.523 0.476,-0.523l2.381,0c0.263,0 0.476,0.234 0.476,0.523l0,0.953l0.001,0z'/></g></g></g></svg>"},"images/data/dataoverviewedit.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 12 12' enable-background='new 0 0 12 12' xml:space='preserve'><g id='Edit'><g><g><path fill='currentColor' d='m8.418,1l-1.578,1.569l2.582,2.567l1.578,-1.569l-2.582,-2.567zm-6.363,6.516l2.582,2.567l4.199,-4.364l-2.583,-2.567l-4.198,4.364zm-2.055,4.484l3.867,-1.32l-2.538,-2.523l-1.329,3.843z'/></g></g></g></svg>"},"images/data/dataoverviewsortmode.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 26 14' enable-background='new 0 0 26 14' xml:space='preserve'><g id='Sort_mode_icon'><g><g><rect fill='currentColor' x='10' y='2' width='6' height='1'/></g></g><g><g><rect fill='currentColor' x='10' y='5' width='4' height='1'/></g></g><g><g><rect fill='currentColor' x='10' y='8' width='3' height='1'/></g></g><g><g><rect fill='currentColor' x='10' y='11' width='1' height='1'/></g></g><g><g><polygon fill='currentColor' points='5,9 5,2 3,2 3,9 0,9 4,13 8,9 '/></g></g><g><g><polygon fill='currentColor' points='19,5 22.5,9 26,5 '/></g></g></g></svg>"},"images/data/datatableview.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 150 150' style='enable-background:new 0 0 150 150;' xml:space='preserve'><g><g><path d='M92,50H58c-1.657,0-3,1.343-3,3v46c0,1.657,1.343,3,3,3h34c1.657,0,3-1.343,3-3V53C95,51.343,93.657,50,92,50z M92,97 c0,0.552-0.448,1-1,1H59c-0.552,0-1-0.448-1-1v-5c0-0.552,0.448-1,1-1h32c0.552,0,1,0.448,1,1V97z M92,87c0,0.552-0.448,1-1,1H59 c-0.552,0-1-0.448-1-1v-5c0-0.552,0.448-1,1-1h32c0.552,0,1,0.448,1,1V87z M92,77c0,0.552-0.448,1-1,1H59c-0.552,0-1-0.448-1-1v-5 c0-0.552,0.448-1,1-1h32c0.552,0,1,0.448,1,1V77z M92,67c0,0.552-0.448,1-1,1H59c-0.552,0-1-0.448-1-1v-5c0-0.552,0.448-1,1-1h32 c0.552,0,1,0.448,1,1V67z'/></g></g><g><g><path d='M75,0C33.579,0,0,33.579,0,75c0,41.421,33.579,75,75,75c41.421,0,75-33.579,75-75C150,33.579,116.421,0,75,0z M75,148 c-40.252,0-73-32.748-73-73S34.748,2,75,2s73,32.748,73,73S115.252,148,75,148z'/></g></g></svg>"},"images/data/detailview.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 130 130' style='enable-background:new 0 0 130 130;' xml:space='preserve'><g><g><path d='M82,41H48c-1.657,0-3,1.343-3,3v42c0,1.657,1.343,3,3,3h34c1.657,0,3-1.343,3-3V44C85,42.343,83.657,41,82,41z M55.317,80 L52,76.843l0.774-0.784l2.397,2.233L59.066,74L60,74.774L55.317,80z M55.317,69L52,65.843l0.774-0.784l2.397,2.233L59.066,63 L60,63.774L55.317,69z M55.317,58L52,54.843l0.774-0.784l2.397,2.233L59.066,52L60,52.774L55.317,58z M78,77H63v-1h15V77z M78,66 H63v-1h15V66z M78,55H63v-1h15V55z'/></g></g><g><g><path class='st0' d='M65,0C29.102,0,0,29.102,0,65s29.102,65,65,65s65-29.102,65-65S100.898,0,65,0z M65,128 C30.262,128,2,99.738,2,65C2,30.262,30.262,2,65,2c34.738,0,63,28.262,63,63C128,99.738,99.738,128,65,128z'/></g></g></svg>"},"images/data/dimension.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 14 14' enable-background='new 0 0 14 14' xml:space='preserve'><rect x='2.245' y='2.75' width='1' height='8' fill='currentColor'/><rect x='2.245' y='10.75' width='9.01' height='1' fill='currentColor'/><rect x='6.082' y='2.637' transform='matrix(0.7071 0.7071 -0.7071 0.7071 7.1457 -2.4927)' width='1' height='9.485' fill='currentColor'/><polygon points='0.743,2.75 2.745,0.748 4.747,2.75 ' fill='currentColor'/><polygon points='11.255,9.248 13.257,11.25 11.255,13.252 ' fill='currentColor'/><polygon points='8.496,2.625 11.327,2.617 11.335,5.448 ' fill='currentColor'/></svg>"},"images/data/errorexclamation14x14.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 14 14' style='enable-background:new 0 0 14 14;' xml:space='preserve'><g><g><g><circle class='svg-error-icon-background' cx='7' cy='7' r='7'/></g></g></g><g><g><g><rect x='6' y='9' style='fill:#FFFFFF;' width='2' height='2'/></g></g><g><g><rect x='6' y='3' style='fill:#FFFFFF;' width='2' height='5'/></g></g></g></svg>"},"images/data/expanded.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 14 14' enable-background='new 0 0 14 14' xml:space='preserve' fill='currentColor'><g id='Lager_1'><g><g><polygon points='4,5 7.5,9 11,5 '/></g></g></g></svg>"},"images/data/filter.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 12 11' enable-background='new 0 0 12 11' xml:space='preserve'><path fill='currentColor' d='M7.286,6.579v3.571C7.286,10.619,6.947,11,6,11c-0.947,0-1.286-0.381-1.286-0.85V6.579c0,0-4.714-3.178-4.714-4.879 C0,0.761,2.686,0,6,0c3.314,0,6,0.761,6,1.701C12,3.401,7.286,6.579,7.286,6.579z M6.092,1.021c-2.594,0-4.698,0.482-4.698,0.997 c0,0.515,2.103,1.066,4.698,1.066c2.594,0,4.698-0.551,4.698-1.066C10.789,1.503,8.686,1.021,6.092,1.021z'/></svg>"},"images/data/folder_closed.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 14 14' enable-background='new 0 0 14 14' xml:space='preserve'><path d='M13.481,1.8H5.892L4.494,0.2l0,0C4.394,0.1,4.194,0,4.094,0l0,0H0.499C0.2,0,0,0.2,0,0.5v12.9l0,0C0,13.7,0.2,14,0.499,14 h2.397h2.397h8.189c0.3,0,0.499-0.2,0.499-0.5l0,0V2.3C14.08,2,13.781,1.8,13.481,1.8z' fill='currentColor'/></svg>"},"images/data/folder_opened.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 14 14' enable-background='new 0 0 14 14' xml:space='preserve'><path d='M12.71,3.2V4H3.324C3.129,4,2.933,4.2,2.835,4.5L0,13.1c0-0.1,0-0.2,0-0.3V1.2C0,0.5,0.293,0,0.782,0h2.933 c0.196,0,0.391,0.1,0.489,0.3L5.182,2h6.844C12.416,2,12.71,2.5,12.71,3.2z' fill='currentColor'/><path d='M3.911,5.1h9.483c0.489,0,0.782,0.8,0.489,1.4l-2.249,7c-0.098,0.3-0.293,0.5-0.489,0.5H0.684l2.737-8.4 C3.52,5.3,3.715,5.1,3.911,5.1z' fill='currentColor'/></svg>"},"images/data/hamburger.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 12 12' enable-background='new 0 0 12 12' xml:space='preserve'><rect fill='currentColor' width='12' height='2'/><rect fill='currentColor' y='5' width='12' height='2'/><rect fill='currentColor' y='10' width='12' height='2'/></svg>"},"images/data/hierarchy.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 14 14' enable-background='new 0 0 14 14' xml:space='preserve'><path d='M9,1v2H5V1H9 M10,0H4v4h6V0L10,0z' fill='currentColor'/><path d='M3,11v2H1v-2H3 M4,10H0v4h4V10L4,10z' fill='currentColor'/><path d='M13,11v2h-2v-2H13 M14,10h-4v4h4V10L14,10z' fill='currentColor'/><path d='M8,11v2H6v-2H8 M9,10H5v4h4V10L9,10z' fill='currentColor'/><rect y='6' width='14' height='1' fill='currentColor'/><rect y='7' width='1' height='1' fill='currentColor'/><rect x='13' y='7' width='1' height='1' fill='currentColor'/><rect x='6.001' y='5' width='1.997' height='1' fill='currentColor'/></svg>"},"images/data/hierarchycollapsed.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 14 14' enable-background='new 0 0 14 14' xml:space='preserve' fill='currentColor'><g id='Lager_1'><g opacity='0.3'><g><rect x='11' y='2' width='1' height='9'/></g></g><g opacity='0.3'><g><rect x='3' y='2' width='1' height='9'/></g></g><g><g><rect x='7' y='4' width='1' height='5'/></g></g><g><g><rect x='5' y='6' width='5' height='1'/></g></g><g opacity='0.3'><g><rect x='4' y='2' width='7' height='1'/></g></g><g opacity='0.3'><g><rect x='4' y='10' width='7' height='1'/></g></g></g></svg>"},"images/data/hierarchyexpanded.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 14 14' enable-background='new 0 0 14 14' xml:space='preserve' fill='currentColor'><g id='Lager_1'><g opacity='0.3'><g><rect x='11' y='2' width='1' height='9'/></g></g><g opacity='0.3'><g><rect x='3' y='2' width='1' height='9'/></g></g><g><g><rect x='5' y='6' width='5' height='1'/></g></g><g opacity='0.3'><g><rect x='4' y='2' width='7' height='1'/></g></g><g opacity='0.3'><g><rect x='4' y='10' width='7' height='1'/></g></g></g></svg>"},"images/data/hierarchy_level_1.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 14 14' enable-background='new 0 0 14 14' xml:space='preserve'><circle fill='none' stroke='currentColor' stroke-miterlimit='10' cx='7' cy='7' r='1.622'/></svg>"},"images/data/hierarchy_level_2.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 14 14' enable-background='new 0 0 14 14' xml:space='preserve'><circle fill='none' stroke='currentColor' stroke-miterlimit='10' cx='9.439' cy='7' r='1.622'/><circle fill='none' stroke='currentColor' stroke-miterlimit='10' cx='4.561' cy='7' r='1.622'/></svg>"},"images/data/hierarchy_level_3.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 14 14' enable-background='new 0 0 14 14' xml:space='preserve'><circle fill='none' stroke='currentColor' stroke-miterlimit='10' cx='9.439' cy='9.385' r='1.622'/><circle fill='none' stroke='currentColor' stroke-miterlimit='10' cx='7' cy='4.615' r='1.622'/><circle fill='none' stroke='currentColor' stroke-miterlimit='10' cx='4.561' cy='9.385' r='1.622'/></svg>"},"images/data/hierarchy_level_4.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 14 14' enable-background='new 0 0 14 14' xml:space='preserve'><circle fill='none' stroke='currentColor' stroke-miterlimit='10' cx='4.561' cy='9.385' r='1.622'/><circle fill='none' stroke='currentColor' stroke-miterlimit='10' cx='4.561' cy='4.615' r='1.622'/><circle fill='none' stroke='currentColor' stroke-miterlimit='10' cx='9.439' cy='4.615' r='1.622'/><circle fill='none' stroke='currentColor' stroke-miterlimit='10' cx='9.439' cy='9.385' r='1.622'/></svg>"},"images/data/hierarchy_level_5.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 14 14' enable-background='new 0 0 14 14' xml:space='preserve'><circle fill='none' stroke='currentColor' stroke-miterlimit='10' cx='11.868' cy='9.379' r='1.622'/><circle fill='none' stroke='currentColor' stroke-miterlimit='10' cx='2.122' cy='9.379' r='1.622'/><circle fill='none' stroke='currentColor' stroke-miterlimit='10' cx='6.99' cy='9.379' r='1.622'/><circle fill='none' stroke='currentColor' stroke-miterlimit='10' cx='9.429' cy='4.61' r='1.622'/><circle fill='none' stroke='currentColor' stroke-miterlimit='10' cx='4.551' cy='4.61' r='1.622'/></svg>"},"images/data/hierarchy_level_6.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 14 14' enable-background='new 0 0 14 14' xml:space='preserve'><rect x='9.75' y='8.742' width='4.25' height='1.391' fill='currentColor'/><circle fill='none' stroke='currentColor' stroke-miterlimit='10' cx='2.122' cy='4.61' r='1.622'/><circle fill='none' stroke='currentColor' stroke-miterlimit='10' cx='11.868' cy='4.61' r='1.622'/><circle fill='none' stroke='currentColor' stroke-miterlimit='10' cx='7' cy='4.61' r='1.622'/><circle fill='none' stroke='currentColor' stroke-miterlimit='10' cx='2.122' cy='9.379' r='1.622'/><circle fill='none' stroke='currentColor' stroke-miterlimit='10' cx='7' cy='9.379' r='1.622'/><rect x='11.173' y='7.262' width='1.391' height='4.25' fill='currentColor'/></svg>"},"images/data/identifiers.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 14 14' enable-background='new 0 0 14 14' xml:space='preserve'><g id='Key'><path fill='currentColor' d='M13.841,3.769l-1.695-1.585l0.312-0.298c0.212-0.202,0.213-0.53,0.001-0.734c-0.212-0.203-0.555-0.204-0.766-0.001 L6.095,6.491C5.44,6.011,4.652,5.738,3.812,5.738c-0.004,0-0.008,0-0.012,0C2.787,5.741,1.834,6.121,1.117,6.809 c-1.483,1.42-1.489,3.724-0.014,5.136C1.837,12.648,2.803,13,3.772,13c0.974,0,1.951-0.357,2.696-1.069 c1.341-1.283,1.462-3.283,0.386-4.7l2.443-2.177l1.063,1.123c0.106,0.101,0.245,0.152,0.383,0.152c0.139,0,0.277-0.051,0.383-0.152 c0.212-0.203,0.212-0.531,0-0.734l-1.061-1.122l1.314-1.406l1.696,1.586c0.106,0.101,0.245,0.152,0.383,0.152 c0.139,0,0.277-0.051,0.383-0.152C14.053,4.3,14.053,3.971,13.841,3.769z M5.701,11.197c-1.061,1.015-2.78,1.021-3.833,0.014 c-1.053-1.008-1.046-2.653,0.014-3.669c0.514-0.493,1.196-0.764,1.92-0.767c0.003,0,0.006,0,0.009,0 c0.72,0,1.395,0.267,1.903,0.753C6.768,8.536,6.762,10.182,5.701,11.197z'/></g></svg>"},"images/data/images.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 14 11' enable-background='new 0 0 14 11' xml:space='preserve'><g><g><path fill='currentColor' d='M12.183,11H1.817C0.815,11,0,10.199,0,9.215V3.271c0-0.984,0.815-1.785,1.817-1.785h1.728 c0.02-0.03,0.23-0.271,0.355-0.414C4.272,0.644,4.833,0,5.704,0h2.592c0.871,0,1.432,0.644,1.803,1.07 c0.128,0.146,0.337,0.386,0.427,0.427l1.658-0.012C13.185,1.486,14,2.287,14,3.271v5.943C14,10.199,13.185,11,12.183,11z M1.817,2.403c-0.487,0-0.883,0.389-0.883,0.868v5.943c0,0.479,0.396,0.868,0.883,0.868h10.367c0.487,0,0.883-0.389,0.883-0.868 V3.271c0-0.479-0.396-0.868-0.883-0.868h-1.728c-0.422,0-0.733-0.356-1.062-0.732C9.084,1.315,8.737,0.917,8.296,0.917H5.704 c-0.441,0-0.773,0.381-1.094,0.75C4.278,2.046,3.967,2.403,3.544,2.403H1.817z'/></g><path fill='currentColor' d='M7,8.665c-1.476,0-2.676-1.116-2.676-2.488S5.524,3.69,7,3.69s2.676,1.116,2.676,2.487S8.476,8.665,7,8.665z M7,4.608 c-0.961,0-1.743,0.704-1.743,1.57S6.039,7.748,7,7.748s1.743-0.705,1.743-1.57S7.961,4.608,7,4.608z'/><path fill='currentColor' d='M11.132,5.023c-0.385,0-0.698-0.308-0.698-0.686c0-0.378,0.313-0.686,0.698-0.686s0.698,0.308,0.698,0.686 C11.83,4.715,11.517,5.023,11.132,5.023z'/></g></svg>"},"images/data/info28x28.svg":{result:"<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 28 28'><circle class='svg-info-icon-background' cx='14' cy='14' r='14'/><polygon points='16 20 16 12 12 12 10 12 10 14 12 14 12 20 10 20 10 22 18 22 18 20 16 20' style='fill:#ffffff'/><rect x='12' y='6' width='4' height='4' style='fill:#ffffff'/></svg>"},"images/data/location.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 12 14' enable-background='new 0 0 12 14' xml:space='preserve'><g><path fill='currentColor' d='M6.13,6.733c-0.82,0-1.487-0.657-1.487-1.464S5.31,3.804,6.13,3.804c0.82,0,1.487,0.657,1.487,1.464S6.95,6.733,6.13,6.733 z'/><g><path fill='currentColor' d='M6,14l-0.912-0.871C3.522,11.724,0,8.239,0,5.242C0,2.449,2.804,0,6,0s6,2.449,6,5.242c0,2.994-3.521,6.48-5.035,7.84 L6,14z M6,1.087c-2.275,0-4.819,1.777-4.819,4.155c0,2.656,3.582,6.078,4.681,7.064L6,12.434l0.14-0.13 c1.098-0.986,4.679-4.409,4.679-7.062C10.819,2.863,8.275,1.087,6,1.087z'/></g></g></svg>"},"images/data/measure.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 14 14' enable-background='new 0 0 14 14' xml:space='preserve'><polygon points='12,10.48 12,13 2,13 2,12.28 6.27,7 2,1.48 2,1 12,1 12,3.76 10.427,1.84 4.921,1.84 8.742,6.4 4.921,11.08 4.921,11.68 10.539,11.68 ' fill='currentColor'/></svg>"},"images/data/numbers.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 14 12' enable-background='new 0 0 14 12' xml:space='preserve'><g><g><path fill='currentColor' d='M1.383,7.106V2.088H0V1.144h0.128c0.922,0,1.49-0.361,1.627-1.144h1.04v7.106H1.383z'/></g><g><path fill='currentColor' d='M8.758,9.701H4.482c0-1.265,0.5-2.138,1.53-3.111l0.569-0.542c0.617-0.572,0.725-0.893,0.725-1.625 c0-0.592-0.245-0.883-0.687-0.883c-0.706,0-0.774,0.631-0.784,1.385H4.482V4.653c0-1.315,0.677-2.058,2.157-2.058 c1.392,0,2.079,0.713,2.079,1.937c0,0.923-0.285,1.526-1.079,2.259L6.855,7.533C6.443,7.914,6.208,8.306,6.14,8.576h2.618V9.701z' /></g><g><path fill='currentColor' d='M11.039,9.782c0.02,0.823,0.157,1.275,0.775,1.275c0.686,0,0.774-0.523,0.774-1.144 c0-0.633-0.137-1.215-0.912-1.215h-0.471V7.755h0.461c0.588,0,0.804-0.542,0.804-1.125c0-0.662-0.216-0.933-0.677-0.933 c-0.608,0-0.716,0.481-0.716,1.154H9.783c0-1.396,0.726-2.098,2.04-2.098c1.255,0,2,0.573,2,1.827 c0,0.854-0.402,1.415-1.059,1.565v0.02C13.657,8.307,14,8.95,14,9.842C14,10.796,13.618,12,11.696,12 c-1.343,0-2.01-0.833-2.01-2.188V9.782H11.039z'/></g></g></svg>"},"images/data/opendataoverview.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 22 12' enable-background='new 0 0 22 12' xml:space='preserve'><g id='Lager_2'><g><g><polygon fill='currentColor' points='19.224,2 18,2.701 20.201,5.999 18,9.299 19.224,10 22,5.999 '/></g></g><g><g><polygon fill='currentColor' points='15.224,2 14,2.701 16.201,5.999 14,9.299 15.224,10 18,5.999 '/></g></g></g><g id='Lager_3'><g><g><path fill='currentColor' d='M11.675,5.061l-0.888-0.222c-0.144-0.036-0.259-0.144-0.305-0.285c-0.078-0.244-0.176-0.479-0.291-0.703 c-0.067-0.132-0.062-0.289,0.014-0.417l0.471-0.785c0.101-0.169,0.075-0.385-0.065-0.524l-0.739-0.74 C9.734,1.248,9.518,1.221,9.349,1.323L8.564,1.793C8.438,1.87,8.28,1.875,8.148,1.808c-0.224-0.115-0.459-0.212-0.703-0.29 C7.304,1.472,7.196,1.357,7.16,1.213L6.938,0.325C6.89,0.134,6.719,0,6.522,0H5.477C5.281,0,5.109,0.134,5.062,0.325L4.84,1.213 C4.804,1.356,4.696,1.472,4.555,1.517C4.311,1.595,4.076,1.693,3.851,1.808C3.719,1.875,3.562,1.87,3.435,1.794L2.65,1.323 C2.481,1.223,2.266,1.249,2.126,1.388L1.388,2.127C1.249,2.266,1.222,2.482,1.323,2.651l0.47,0.784 C1.87,3.561,1.875,3.719,1.808,3.851c-0.115,0.225-0.213,0.46-0.291,0.704C1.472,4.696,1.356,4.804,1.213,4.84L0.325,5.062 C0.134,5.109,0,5.281,0,5.477l0,1.045c0,0.197,0.134,0.368,0.324,0.416l0.888,0.222c0.144,0.036,0.259,0.144,0.305,0.285 c0.078,0.244,0.175,0.479,0.29,0.704C1.875,8.281,1.87,8.438,1.794,8.565l-0.47,0.784C1.222,9.518,1.249,9.734,1.388,9.873 l0.739,0.74c0.139,0.139,0.355,0.166,0.524,0.064l0.784-0.47c0.127-0.076,0.285-0.082,0.416-0.014 c0.225,0.115,0.46,0.213,0.704,0.291c0.141,0.045,0.249,0.16,0.285,0.304l0.222,0.888C5.109,11.866,5.28,12,5.477,12h1.046 c0.197,0,0.368-0.134,0.416-0.325l0.222-0.888c0.036-0.143,0.144-0.259,0.285-0.304c0.244-0.078,0.479-0.176,0.703-0.291 c0.132-0.067,0.29-0.062,0.416,0.014l0.784,0.47c0.169,0.101,0.384,0.075,0.524-0.064l0.739-0.74 c0.139-0.139,0.166-0.355,0.065-0.524l-0.471-0.784c-0.076-0.127-0.082-0.285-0.014-0.416c0.115-0.225,0.212-0.46,0.29-0.703 c0.046-0.141,0.161-0.249,0.305-0.285l0.888-0.222C11.866,6.891,12,6.719,12,6.522V5.477C12,5.28,11.866,5.109,11.675,5.061z M6,8.143C4.816,8.143,3.857,7.184,3.857,6c0-1.184,0.959-2.143,2.143-2.143S8.143,4.816,8.143,6 C8.143,7.184,7.184,8.143,6,8.143z'/></g></g></g></svg>"},"images/data/plus.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 12 12' style='enable-background:new 0 0 12 12;' xml:space='preserve'><g><g><rect x='5' width='2' height='12'/></g></g><g><g><rect y='5' width='12' height='2'/></g></g></svg>"},"images/data/preview.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 14 14' style='enable-background:new 0 0 14 14;' xml:space='preserve'><g><circle style='fill:#309FE0;' cx='7' cy='7' r='7'/></g><g><g><g><path style='fill:#FFFFFF' d='M9.034,8.406C9.586,7.833,9.922,7.073,9.922,6.24C9.922,4.451,8.372,3,6.461,3C4.55,3,3,4.451,3,6.24 C3,8.03,4.55,9.48,6.461,9.48c0.609,0,1.181-0.147,1.678-0.406L10.195,11L11,10.247L9.034,8.406z M6.461,8.404 c-1.276,0-2.311-0.969-2.311-2.164c0-1.195,1.035-2.164,2.311-2.164c1.277,0,2.311,0.969,2.311,2.164 C8.772,7.435,7.737,8.404,6.461,8.404z'/></g></g></g></svg>"},"images/data/prompt.svg":{result:"<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16' class='sf-element-svg-element sf-element-icon sfc-selected'><path d='M7.965,9.557v0l0.019,0L8,9.56H8l0.011,0,0.019,0v0c3.67-.034,4.126-4.784,4.17-5.814,0-.1,0-0.213,0-0.219C12.086,1.358,9.928.021,8.035,0L8,0H8L7.965,0C6.072,0.021,3.914,1.358,3.8,3.523c0,0.008,0,.123,0,0.219C3.838,4.773,4.294,9.523,7.965,9.557ZM16,13.994a3.283,3.283,0,0,0-1.461-2.69,7.29,7.29,0,0,0-1.1-.571,8.61,8.61,0,0,1-1.13-.533c-0.224-.138-0.434-0.248-0.627-0.35-0.093-.05-0.168-0.1-0.253-0.147A3.684,3.684,0,0,1,8.04,12.122v0l-0.013,0H7.97l-0.013,0v0A3.685,3.685,0,0,1,4.568,9.7c-0.085.048-.16,0.1-0.253,0.146-0.19.1-.4,0.213-0.624,0.35a8.61,8.61,0,0,1-1.13.533,7.216,7.216,0,0,0-1.1.571A3.283,3.283,0,0,0,0,13.994l0.01,0.035,0.1,0L0,14.042V16H16V14.042H15.986A0.3,0.3,0,0,0,16,13.994Z'/></svg>"},"images/data/replacedatatable.svg":{result:"<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 13 12'><g fill='currentColor'><path d='M11,0H2A2,2,0,0,0,0,2v8a2,2,0,0,0,2,2h9a2,2,0,0,0,2-2V2A2,2,0,0,0,11,0Zm1,11H1V3H12v8Z'/><path d='M8.025,4s-0.011.937-.018,2H4.993C4.985,4.937,4.975,4,4.975,4L2,6.429,4.975,9C5,9,5,8.063,5,7H8c0,1.063,0,2,.024,2L11,6.429Z'/></g></svg>"},"images/data/resizehandle.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 3 23' enable-background='new 0 0 3 23' xml:space='preserve'><g><g><rect fill='currentColor' y='22' width='3' height='1'/></g></g><g><g><rect fill='currentColor' y='20' width='3' height='1'/></g></g><g><g><rect fill='currentColor' y='18' width='3' height='1'/></g></g><g><g><rect fill='currentColor' y='16' width='3' height='1'/></g></g><g><g><rect fill='currentColor' y='14' width='3' height='1'/></g></g><g><g><rect fill='currentColor' y='12' width='3' height='1'/></g></g><g><g><rect fill='currentColor' y='10' width='3' height='1'/></g></g><g><g><rect fill='currentColor' y='8' width='3' height='1'/></g></g><g><g><rect fill='currentColor' y='6' width='3' height='1'/></g></g><g><g><rect fill='currentColor' y='4' width='3' height='1'/></g></g><g><g><rect fill='currentColor' y='2' width='3' height='1'/></g></g><g><g><rect fill='currentColor' width='3' height='1'/></g></g></svg>"},"images/data/search.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 14 14' style='enable-background:new 0 0 14 14;' xml:space='preserve'><g><g><path d='M10.56,9.461c0.965-1.005,1.553-2.334,1.553-3.791C12.113,2.539,9.402,0,6.057,0C2.712,0,0,2.539,0,5.67 c0,3.132,2.712,5.67,6.057,5.67c1.066,0,2.067-0.258,2.937-0.71L12.592,14L14,12.682L10.56,9.461z M6.057,9.457 c-2.234,0-4.045-1.695-4.045-3.787c0-2.092,1.811-3.787,4.045-3.787c2.234,0,4.045,1.695,4.045,3.787 C10.101,7.762,8.291,9.457,6.057,9.457z'/></g></g></svg>"},"images/data/set.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 14 14' enable-background='new 0 0 14 14' xml:space='preserve'><path d='M2,6.491c1.273,0,1.4-0.636,1.4-1.273c0-0.509,0-1.018-0.127-1.4c0-0.509-0.127-1.018-0.127-1.527 C3.145,0.636,4.164,0,5.691,0h0.382v1.018H5.691c-1.018,0-1.4,0.509-1.4,1.527c0,0.382,0,0.764,0.127,1.273 C4.545,4.2,4.545,4.582,4.545,5.091c0,1.145-0.509,1.655-1.273,1.909l0,0c0.764,0.255,1.273,0.764,1.273,1.909 c0,0.509,0,0.891-0.127,1.273c0,0.509-0.127,0.891-0.127,1.273c0,1.018,0.382,1.527,1.4,1.527h0.255V14H5.691 c-1.4,0-2.545-0.636-2.545-2.418c0-0.509,0.127-0.891,0.127-1.4C3.4,9.673,3.4,9.291,3.4,8.782S3.273,7.509,2,7.509V6.491z' fill='currentColor'/><path d='M12,7.509c-1.273,0-1.4,0.636-1.4,1.273c0,0.509,0,1.018,0.127,1.4c0,0.509,0.127,1.018,0.127,1.527 c0,1.655-1.018,2.291-2.545,2.291H7.927v-1.018h0.382c1.018,0,1.4-0.509,1.4-1.527c0-0.382,0-0.764-0.127-1.273 C9.455,9.8,9.455,9.418,9.455,8.909c0-1.145,0.509-1.655,1.273-1.909l0,0C9.964,6.745,9.455,6.236,9.455,5.091 c0-0.509,0-0.891,0.127-1.273c0-0.509,0.127-0.891,0.127-1.273c0-1.018-0.382-1.527-1.4-1.527H8.055V0l0.255,0 c1.4,0,2.545,0.636,2.545,2.418c0,0.509-0.127,0.891-0.127,1.4C10.6,4.327,10.6,4.709,10.6,5.218s0.127,1.273,1.4,1.273V7.509z' fill='currentColor'/></svg>"},"images/data/smallarrowdown.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 7 5' enable-background='new 0 0 7 5' xml:space='preserve'><path fill='currentColor' d='M3.455,5L0,0.948l1.017-0.944l2.445,2.95L5.99,0L7,0.951L3.455,5z'/></svg>"},"images/data/smallarrowup.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 7 5' enable-background='new 0 0 7 5' xml:space='preserve'><path fill='currentColor' d='M3.545,0L7,4.052L5.983,4.996L3.538,2.047L1.01,5L0,4.049L3.545,0z'/></svg>"},"images/data/text.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 14 12' enable-background='new 0 0 14 12' xml:space='preserve'><path fill='currentcolor' d='M12.069,12C10.23,12,10,10.547,10,8.5C10,6.453,10.23,5,12.069,5c1.754,0,1.88,1.425,1.88,2.405h-1.226 c0-0.98-0.179-1.406-0.732-1.406c-0.621,0-0.766,0.689-0.766,2.595c0,2.037,0.256,2.406,0.784,2.406 c0.442,0,0.765-0.256,0.765-1.708H14C14,10.744,13.677,12,12.069,12'/><g><path fill='currentcolor' d='M5.35,2h2.068C8.431,2,9.16,2.432,9.16,3.775c0,0.755-0.317,1.333-0.926,1.53v0.019 C8.911,5.432,9.35,6.02,9.35,6.951C9.35,8.049,8.877,9,7.435,9H5.35V2z M6.586,4.873h0.352c0.678,0,0.987-0.265,0.987-0.921 c0-0.667-0.283-0.912-0.893-0.912H6.586V4.873z M6.586,7.961h0.481c0.592,0,0.995-0.244,0.995-1.059 c0-0.813-0.403-1.048-0.944-1.048H6.586V7.961z'/></g><g><path fill='currentcolor' d='M2.905,0H1.496L0,7h1.187l0.414-1.891h1.282L3.213,7H4.4L2.905,0z M2.766,4.016H1.656l0.312-2.359h0.469 L2.766,4.016z'/></g></svg>"},"images/data/time.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 14 14' enable-background='new 0 0 14 14' xml:space='preserve'><g><path fill='currentColor' d='M7,14c-3.86,0-7-3.14-7-7s3.14-7,7-7s7,3.14,7,7S10.86,14,7,14z M7,1.183C3.792,1.183,1.183,3.792,1.183,7 S3.792,12.817,7,12.817S12.817,10.208,12.817,7S10.208,1.183,7,1.183z'/><path fill='currentColor' d='M8.24,10.196c-0.161,0-0.323-0.066-0.44-0.195L5.77,7.749V3.751c0-0.327,0.265-0.592,0.592-0.592 c0.327,0,0.592,0.265,0.592,0.592v3.544L8.68,9.209c0.219,0.243,0.199,0.617-0.043,0.836C8.523,10.146,8.382,10.196,8.24,10.196z' /></g></svg>"},"images/data/viewsinconnectionremovetable.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 10 10' style='enable-background:new 0 0 10 10;' xml:space='preserve'><g><g><rect x='4.228' y='-1.299' transform='matrix(0.7071 -0.7071 0.7071 0.7071 -2.0711 5.0004)' width='1.544' height='12.598'/></g></g><g><g><rect x='-1.299' y='4.228' transform='matrix(0.7071 -0.7071 0.7071 0.7071 -2.0711 5)' width='12.598' height='1.544'/></g></g></svg>"},"images/data/viewsinconnectionreport.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 16 16' style='enable-background:new 0 0 16 16;' xml:space='preserve'><g id='Lager_1'><g><g><circle class='sf-element sf-element-svg-element sfc-icon-bg' cx='8' cy='8' r='8'/></g></g></g><g id='Lager_4'><g><g><rect x='7' y='8.997' class='sf-element sf-element-svg-element sfc-icon-fg' width='4' height='0.999'/></g></g><g><g><rect x='5' y='9' class='sf-element sf-element-svg-element sfc-icon-fg' width='1' height='1'/></g></g><g><g><rect x='7' y='6.999' class='sf-element sf-element-svg-element sfc-icon-fg' width='4' height='1'/></g></g><g><g><rect x='5' y='7' class='sf-element sf-element-svg-element sfc-icon-fg' width='1' height='1'/></g></g><g><g><rect x='7' y='5' class='sf-element sf-element-svg-element sfc-icon-fg' width='4' height='0.999'/></g></g><g><g><rect x='5' y='5' class='sf-element sf-element-svg-element sfc-icon-fg' width='1' height='0.999'/></g></g></g></svg>"},"images/data/viewsinconnectiontable.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 16 16' style='enable-background:new 0 0 16 16;' xml:space='preserve'><g id='Lager_1'><g><g><circle class='sf-element sf-element-svg-element sfc-icon-bg' cx='8' cy='8' r='8'/></g></g></g><g id='Lager_5'><g><g><path class='sf-element sf-element-svg-element sfc-icon-fg' d='M10,4H6H5v8h1h4h1V4H10z M10,11H6V9.999h4V11z M10,9H6V8h4V9z M10,7H6V6h4V7z'/></g></g></g></svg>"},"images/data/x.svg":{result:"<svg version='1.1' xmlns:x='&ns_extend;' xmlns:i='&ns_ai;' xmlns:graph='&ns_graphs;' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 12 12' enable-background='new 0 0 12 12' xml:space='preserve'><polygon fill='currentColor' points='12,1.092 10.91,0 6,4.908 1.092,0 0,1.092 4.91,6 0,10.909 1.092,12.001 6,7.093 10.91,12.001 12,10.909 7.092,6'/></svg>"},"images/data/connectors/generic.svg":{result:"<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 50 50'><path d='M20.972,36.952A31.792,31.792,0,0,0,29.194,35.9c-0.018-.025-0.039-0.051-0.056-0.076a12.153,12.153,0,0,1-.821-1.377A11.823,11.823,0,0,1,27,29c0-.313.022-0.627,0.047-0.942a36.457,36.457,0,0,1-6.075.5c-7.557,0-14.024-2.2-16.972-5.464v5.876C4,33.14,11.581,36.952,20.972,36.952Zm0-20.1C30.361,16.855,38,13.594,38,9.586S30.389,3,21,3,4,5.568,4,9.586,11.581,16.855,20.972,16.855Zm0,10.048a32.782,32.782,0,0,0,6.349-.611c0.012-.045.021-0.09,0.034-0.135l0.046-.169a11.942,11.942,0,0,1,.589-1.752c0.122-.281.265-0.573,0.436-0.892,0.116-.217.236-0.432,0.365-0.64A12.119,12.119,0,0,1,29.8,21.312q0.275-.329.573-0.638a12.132,12.132,0,0,1,1.273-1.146A11.849,11.849,0,0,1,38,17.041V13.048c-2.949,3.268-9.471,5.464-17.028,5.464S6.949,16.316,4,13.048v5.877C4,23.092,11.581,26.9,20.972,26.9Zm9.434,10.443a34.183,34.183,0,0,1-9.434,1.264c-7.557,0-14.024-2.2-16.972-5.464v5.876C4,43.189,11.581,47,20.972,47c7.939,0,14.668-2.76,16.555-6.1a11.971,11.971,0,0,1-6.619-3.059C30.741,37.684,30.574,37.52,30.406,37.346Zm16.1-16.366a11.062,11.062,0,0,0-2.926-1.966q-0.405-.186-0.828-0.341T41.9,18.4c-0.27-.074-0.552-0.117-0.829-0.172-0.336-.066-0.675-0.123-1.019-0.163A9,9,0,0,0,39,18c-0.337,0-.67.018-1,0.047a10.934,10.934,0,0,0-5.743,2.27,11.1,11.1,0,0,0-1.168,1.051q-0.273.283-.525,0.585a11.074,11.074,0,0,0-.922,1.277c-0.118.191-.228,0.388-0.335,0.587-0.143.267-.279,0.538-0.4,0.818a10.575,10.575,0,0,0-.482,1.412c-0.018.065-.04,0.129-0.057,0.194-0.052.2-.112,0.391-0.153,0.593q-0.1.511-.156,1.037a10.853,10.853,0,0,0,1.147,6.116,11.1,11.1,0,0,0,.753,1.264c0.084,0.121.182,0.231,0.273,0.348,0.129,0.167.253,0.338,0.391,0.5a11.729,11.729,0,0,0,.87.909c0.032,0.03.059,0.066,0.092,0.1a10.965,10.965,0,0,0,6.341,2.846C38.279,39.982,38.637,40,39,40c0.322,0,.638-0.019.953-0.047A11.007,11.007,0,0,0,50,29,10.946,10.946,0,0,0,46.509,20.98ZM45.52,26.351a0.692,0.692,0,0,1-.159.231l-2.633,2.532c0.455,0.438.811,0.779,1.044,1,0.164,0.156.275,0.262,0.278,0.262h0L41.426,32.9l-1.531,1.472a1.9,1.9,0,0,1-.972.5,1.979,1.979,0,0,1-.36.033h0A1.238,1.238,0,0,1,38,34.8a1.861,1.861,0,0,1-.771-0.428l-0.112-.107-0.152-.146-0.683-.657-0.594-.571-0.411-.4L32.871,30.18a1.767,1.767,0,0,1-.24-2.279,1.819,1.819,0,0,1,.24-0.284l2.549-2.451,0.661-.636,0.945-.909,0.22,0.212L37.4,23.986,38,24.561l0.34,0.328,2.63-2.53a0.725,0.725,0,0,1,.24-0.153,0.75,0.75,0,0,1,.214-0.04c0.02,0,.04-0.011.06-0.011a0.759,0.759,0,0,1,.274.051,0.725,0.725,0,0,1,.24.153l0.068,0.066a0.683,0.683,0,0,1,0,.99l-0.643.619-1.988,1.912,1.889,1.819,0.3,0.293,1.224-1.177,1.409-1.355a0.751,0.751,0,0,1,1.029,0l0.068,0.066a0.693,0.693,0,0,1,.159.231A0.682,0.682,0,0,1,45.52,26.351Z'/></svg>"},"images/data/connectors/library.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='-1 -3 50 50' style='enable-background:new 0 0 47 44;' xml:space='preserve'><g><path d='M24,6.198V42c0,0,4.138-8.522,23-1.283v-3.254V4.916C28.138-2.324,24,6.198,24,6.198z'/><path d='M0,4.916v32.548v3.254C18.98,33.478,23,42,23,42V6.198C23,6.198,18.98-2.324,0,4.916z'/></g></svg>"},"images/data/connectors/local-file.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='-6 -3 50 50' style='enable-background:new 0 0 37 44;' xml:space='preserve'><g><path d='M28.854,22.5c0-5.709-4.645-10.354-10.354-10.354c-5.709,0-10.354,4.645-10.354,10.354 c0,2.7,1.047,5.153,2.745,6.998c-0.005-0.017-0.009-0.031-0.009-0.034c0.055-1.212,0.634-2.106,1.383-2.59 c0.339-0.219,0.696-0.404,1.043-0.551c0.396-0.168,0.769-0.326,1.069-0.513c0.212-0.132,0.411-0.239,0.594-0.338 c0.087-0.047,0.159-0.094,0.24-0.141c0.556,1.226,1.522,2.312,3.208,2.328v0.003c0.004,0,0.008-0.001,0.012-0.001 c0.002,0,0.004,0,0.006,0c0.002,0,0.004,0,0.006,0c0.002,0,0.004,0,0.006,0c0.003,0,0.006,0,0.009,0.001 c0.003,0,0.006-0.001,0.009-0.001c0.002,0,0.004,0,0.006,0c0.002,0,0.004,0,0.006,0c0.002,0,0.004,0,0.006,0 c0.004,0,0.008,0.001,0.012,0.001V27.66c1.686-0.016,2.652-1.102,3.208-2.328c0.08,0.047,0.152,0.094,0.24,0.141 c0.183,0.098,0.382,0.206,0.594,0.338c0.3,0.187,0.673,0.345,1.069,0.513c0.347,0.147,0.704,0.331,1.043,0.551 c0.749,0.485,1.328,1.378,1.383,2.59c0,0.008-0.024,0.081-0.057,0.179C27.754,27.784,28.854,25.27,28.854,22.5z M22.439,19.592 c-0.04,0.992-0.473,5.566-3.948,5.599v0.003c-0.006,0-0.012-0.001-0.018-0.001c-0.004,0-0.008,0-0.011,0.001v0.001 c-0.001,0-0.002,0-0.003,0c-0.001,0-0.002,0-0.003,0v-0.001c-0.004,0-0.007-0.001-0.011-0.001c-0.006,0-0.012,0.001-0.018,0.001 v-0.003c-3.475-0.033-3.908-4.607-3.948-5.599c-0.004-0.092,0-0.204,0-0.211c0.111-2.084,2.155-3.372,3.948-3.391 c0,0,0.028-0.001,0.032-0.001h0.001h0.001c0.003,0,0.032,0.001,0.032,0.001c1.793,0.019,3.837,1.306,3.948,3.391 C22.439,19.388,22.442,19.5,22.439,19.592z'/><path d='M28,10V0H3C1.343,0,0,1.343,0,3v38c0,1.657,1.343,3,3,3h31c1.657,0,3-1.343,3-3V10H28z M18.5,34 C12.149,34,7,28.851,7,22.5S12.149,11,18.5,11S30,16.149,30,22.5S24.851,34,18.5,34z'/><path d='M29,1.001v8h7C36.052,9.001,29,1.001,29,1.001z'/></g></svg>"},"images/data/edittable/addcolumns.svg":{result:"<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 50 50'><path d='M47,2a1.013,1.013,0,0,1,1,1V47a1.013,1.013,0,0,1-1,1H3a1.013,1.013,0,0,1-1-1V3A1.013,1.013,0,0,1,3,2H47m0-2H3A3.009,3.009,0,0,0,0,3V47a3.009,3.009,0,0,0,3,3H47a3.009,3.009,0,0,0,3-3V3a3.009,3.009,0,0,0-3-3Z'/><g style='opacity:0.6000000000000001'><rect x='7' y='37' width='10' height='7'/></g><g style='opacity:0.6000000000000001'><rect x='20' y='37' width='10' height='7'/></g><g style='opacity:0.6000000000000001'><rect x='7' y='27' width='10' height='7'/></g><g style='opacity:0.6000000000000001'><rect x='20' y='27' width='10' height='7'/></g><g style='opacity:0.6000000000000001'><rect x='7' y='17' width='10' height='7'/></g><g style='opacity:0.6000000000000001'><rect x='20' y='17' width='10' height='7'/></g><rect x='33' y='17' width='11' height='27' style='fill:#68bef3'/><rect y='11' width='50' height='2'/><polygon points='39 30 39 28 38 28 38 30 36 30 36 31 38 31 38 33 39 33 39 31 41 31 41 30 39 30' style='fill:#fff'/></svg>"},"images/data/edittable/addcolumns32x32.svg":{result:"<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'><g style='opacity:0.6'><rect x='4' y='11' width='6' height='4'/></g><g style='opacity:0.6'><rect x='13' y='11' width='6' height='4'/></g><rect x='22' y='11' width='7' height='18' style='fill:#68bef3'/><g style='opacity:0.6'><rect x='4' y='18' width='6' height='4'/></g><g style='opacity:0.6'><rect x='13' y='18' width='6' height='4'/></g><g style='opacity:0.6'><rect x='4' y='25' width='6' height='4'/></g><g style='opacity:0.6'><rect x='13' y='25' width='6' height='4'/></g><polygon points='26 19 26 18 25 18 25 19 24 19 24 20 25 20 25 21 26 21 26 20 27 20 27 19 26 19' style='fill:#fff'/><path d='M30,0H2A2.006,2.006,0,0,0,0,2V30a2.006,2.006,0,0,0,2,2H30a2.006,2.006,0,0,0,2-2V2A2.006,2.006,0,0,0,30,0Zm1,30a.987.987,0,0,1-.9,1H2a.987.987,0,0,1-1-.9V2a.987.987,0,0,1,.9-1H30a.987.987,0,0,1,1,.9Z'/><rect y='8' width='32' height='1'/></svg>"},"images/data/edittable/addrows.svg":{result:"<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 50 50'><path d='M47,2a1.013,1.013,0,0,1,1,1V47a1.013,1.013,0,0,1-1,1H3a1.013,1.013,0,0,1-1-1V3A1.013,1.013,0,0,1,3,2H47m0-2H3A3.009,3.009,0,0,0,0,3V47a3.009,3.009,0,0,0,3,3H47a3.009,3.009,0,0,0,3-3V3a3.009,3.009,0,0,0-3-3Z'/><rect x='7' y='36' width='36' height='9' style='fill:#79d79d'/><g style='opacity:0.6000000000000001'><rect x='7' y='27' width='10' height='7'/></g><g style='opacity:0.6000000000000001'><rect x='20' y='27' width='10' height='7'/></g><g style='opacity:0.6000000000000001'><rect x='7' y='17' width='10' height='7'/></g><g style='opacity:0.6000000000000001'><rect x='20' y='17' width='10' height='7'/></g><g style='opacity:0.6000000000000001'><rect x='33' y='27' width='10' height='7'/></g><g style='opacity:0.6000000000000001'><rect x='33' y='17' width='10' height='7'/></g><rect y='11' width='50' height='2'/><polygon points='25 40 25 38 24 38 24 40 22 40 22 41 24 41 24 43 25 43 25 41 27 41 27 40 25 40' style='fill:#fff'/></svg>"},"images/data/edittable/addrows32x32.svg":{result:"<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'><g style='opacity:0.6'><rect x='4' y='11' width='6' height='4'/></g><g style='opacity:0.6'><rect x='13' y='11' width='6' height='4'/></g><g style='opacity:0.6'><rect x='22' y='11' width='6' height='4'/></g><g style='opacity:0.6'><rect x='4' y='18' width='6' height='4'/></g><g style='opacity:0.6'><rect x='13' y='18' width='6' height='4'/></g><g style='opacity:0.6'><rect x='22' y='18' width='6' height='4'/></g><rect x='4' y='24' width='24' height='5' style='fill:#79d79d'/><path d='M30,0H2A2.006,2.006,0,0,0,0,2V30a2.006,2.006,0,0,0,2,2H30a2.006,2.006,0,0,0,2-2V2A2.006,2.006,0,0,0,30,0Zm1,30a.987.987,0,0,1-.9,1H2a.987.987,0,0,1-1-.9V2a.987.987,0,0,1,.9-1H30a.987.987,0,0,1,1,.9Z'/><rect y='8' width='32' height='1'/><polygon points='17 26 17 25 16 25 16 26 15 26 15 27 16 27 16 28 17 28 17 27 18 27 18 26 17 26' style='fill:#fff'/></svg>"},"images/data/edittable/cachingcached.svg":{result:"<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'><path d='M3.675,7.069a0.509,0.509,0,0,0-.509-0.509H1.77a0.509,0.509,0,0,0,0,1.018h1.4A0.51,0.51,0,0,0,3.675,7.069Z' class='sf-element-svg-element sfc-accent3-color'/><path d='M3.991,4.638h0a0.527,0.527,0,0,0,.372.158,0.442,0.442,0,0,0,.448-0.447,0.532,0.532,0,0,0-.159-0.373L3.7,3.025a0.53,0.53,0,0,0-.371-0.158h0a0.444,0.444,0,0,0-.448.45,0.528,0.528,0,0,0,.158.37Z' class='sf-element-svg-element sfc-accent3-color'/><path d='M11.131,3.131A0.446,0.446,0,0,0,10.816,3h0a0.531,0.531,0,0,0-.371.158L9.5,4.1a0.49,0.49,0,0,0-.028.689,0.446,0.446,0,0,0,.318.128,0.527,0.527,0,0,0,.371-0.157L11.1,3.819a0.531,0.531,0,0,0,.157-0.373A0.445,0.445,0,0,0,11.131,3.131Z' class='sf-element-svg-element sfc-accent3-color'/><path d='M6.976,1.354a0.51,0.51,0,0,0-.509.51v1.4a0.509,0.509,0,1,0,1.018,0v-1.4A0.51,0.51,0,0,0,6.976,1.354Z' class='sf-element-svg-element sfc-accent3-color'/><path d='M4.007,9.6l-0.941.94a0.529,0.529,0,0,0-.158.371,0.442,0.442,0,0,0,.445.446h0A0.53,0.53,0,0,0,3.726,11.2l0.94-.94A0.468,0.468,0,1,0,4.007,9.6Z' class='sf-element-svg-element sfc-accent3-color'/><path d='M10.5,6C8.015,6,6,6.6,6,7.538,6,8.319,7.4,8.97,9.3,9.168l3.043-3.043A13.259,13.259,0,0,0,10.5,6Z' class='sf-element-svg-element sfc-accent3-color'/><path d='M6,9.382v1.372a1.3,1.3,0,0,0,.727.987L8.088,10.38A4.616,4.616,0,0,1,6,9.382Z' class='sf-element-svg-element sfc-accent3-color'/><path d='M10.493,16c2.348,0,4.3-.8,4.507-1.7V12.765a6.9,6.9,0,0,1-4.507,1.276,9.7,9.7,0,0,1-2.84-.4L6.413,14.884A6.58,6.58,0,0,0,10.493,16Z' class='sf-element-svg-element sfc-primary-gray-color'/><path d='M10.493,12.618c2.347,0,4.3-.8,4.507-1.7V9.382a6.783,6.783,0,0,1-4.357,1.271L8.822,12.474A9.756,9.756,0,0,0,10.493,12.618Z' class='sf-element-svg-element sfc-primary-gray-color'/><path d='M15,7.538A0.944,0.944,0,0,0,14.492,6.8l-2.3,2.3C13.834,8.856,15,8.248,15,7.538Z' class='sf-element-svg-element sfc-primary-gray-color'/></svg>"},"images/data/edittable/cachingembedded.svg":{result:"<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'><path d='M5.5,2.485V3.529c0,0.74,1.561,1.417,3.494,1.417,1.826,0,3.345-.612,3.506-1.3V2.485a5.453,5.453,0,0,1-3.506.971A5.416,5.416,0,0,1,5.5,2.485Zm3.494-.024c1.933,0,3.506-.58,3.506-1.292S10.933,0,9,0s-3.5.456-3.5,1.17S7.061,2.461,8.994,2.461ZM5.5,4.972V6.015c0,0.74,1.561,1.417,3.494,1.417,1.826,0,3.345-.612,3.506-1.3V4.972a5.453,5.453,0,0,1-3.506.971A5.416,5.416,0,0,1,5.5,4.972Z' class='sf-element-svg-element sfc-accent3-color'/><path d='M2,6.984H4.5v-6H4.287Zm11.76-6H13.5v6H16Z' class='sf-element-svg-element sfc-primary-gray-color'/><rect x='2.5' y='11.5' width='13' height='4' class='sf-element-svg-element sfc-secondary-gray-color'/><path d='M15,12v3H3V12H15m1-1H2v5H16V11h0Z' class='sf-element-svg-element sfc-primary-gray-color'/><rect x='7.085' y='13' width='4' height='1' class='sf-element-svg-element sfc-primary-gray-color'/><rect x='2.5' y='7.484' width='13' height='4' class='sf-element-svg-element sfc-secondary-gray-color'/><path d='M15,7.984v3H3v-3H15m1-1H2v5H16v-5h0Z' class='sf-element-svg-element sfc-primary-gray-color'/><rect x='7.085' y='8.984' width='4' height='1' class='sf-element-svg-element sfc-primary-gray-color'/></svg>"},"images/data/edittable/cachinglinked.svg":{result:"<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16' class='sf-element-svg-element sfc-accent3-color'><path d='M3.675,7.069a0.509,0.509,0,0,0-.509-0.509H1.77a0.509,0.509,0,0,0,0,1.018h1.4A0.51,0.51,0,0,0,3.675,7.069Z'/><path d='M3.991,4.638h0a0.527,0.527,0,0,0,.372.158,0.442,0.442,0,0,0,.448-0.447,0.532,0.532,0,0,0-.159-0.373L3.7,3.025a0.53,0.53,0,0,0-.371-0.158h0a0.444,0.444,0,0,0-.448.45,0.528,0.528,0,0,0,.158.37Z'/><path d='M11.131,3.131A0.446,0.446,0,0,0,10.816,3h0a0.531,0.531,0,0,0-.371.158L9.5,4.1a0.49,0.49,0,0,0-.028.689,0.446,0.446,0,0,0,.318.128,0.527,0.527,0,0,0,.371-0.157L11.1,3.819a0.531,0.531,0,0,0,.157-0.373A0.445,0.445,0,0,0,11.131,3.131Z'/><path d='M6.976,1.354a0.51,0.51,0,0,0-.509.51v1.4a0.509,0.509,0,1,0,1.018,0v-1.4A0.51,0.51,0,0,0,6.976,1.354Z'/><path d='M4.007,9.6l-0.941.94a0.529,0.529,0,0,0-.158.371,0.442,0.442,0,0,0,.445.446h0A0.53,0.53,0,0,0,3.726,11.2l0.94-.94A0.468,0.468,0,1,0,4.007,9.6Z'/><path d='M6,12.765v1.372C6,15.11,8.007,16,10.493,16c2.348,0,4.3-.8,4.507-1.7V12.765a6.9,6.9,0,0,1-4.507,1.276A6.857,6.857,0,0,1,6,12.765Zm4.493-3.529c2.485,0,4.507-.762,4.507-1.7S12.985,6,10.5,6,6,6.6,6,7.538,8.007,9.236,10.493,9.236ZM6,9.382v1.372c0,0.973,2.007,1.863,4.493,1.863,2.347,0,4.3-.8,4.507-1.7V9.382a6.9,6.9,0,0,1-4.507,1.276A6.857,6.857,0,0,1,6,9.382Z'/></svg>"},"images/data/edittable/calculation.svg":{result:"<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 50 50'><path d='M47.059,0H2.941A2.974,2.974,0,0,0,0,3V47a2.974,2.974,0,0,0,2.941,3H47.059A2.974,2.974,0,0,0,50,47V3A2.974,2.974,0,0,0,47.059,0ZM17,44H7V38H17v6Zm0-10H7V28H17v6Zm0-9H7V19H17v6ZM30,44H20V38H30v6Zm0-10H20V28H30v6Zm0-9H20V19H30v6ZM43,44H33V38H43v6Zm0-10H33V28H43v6Zm0-9H33V19H43v6Zm0-9H7V6H43V16Z' style='fill:#c9bdeb'/></svg>"},"images/data/edittable/clipboard.svg":{result:"<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 50 50'><path d='M31.25,3.124H28.125V6.25H25.086a6.284,6.284,0,0,0-12.569,0h-2.29V3.124H6.818A6.775,6.775,0,0,0,0,9.855V40.144a6.775,6.775,0,0,0,6.818,6.731H20.052V43.509H6.818a3.391,3.391,0,0,1-3.409-3.365V9.855A3.391,3.391,0,0,1,6.818,6.49H9.375V9.375h18.75V6.7H31.25a3.375,3.375,0,0,1,3.125,3.572v2.3H37.5v-2.3C37.5,6.322,34.7,3.124,31.25,3.124ZM15.663,6.25A3.137,3.137,0,0,1,18.79,3.128l0,0H18.81l-0.008,0A3.139,3.139,0,0,1,21.94,6.25H15.663Z'/><path d='M42.605,12.611v7.395H50C50.055,20.005,42.605,12.611,42.605,12.611ZM39.518,22.3V12.564H23.461c-1.676,0-3.41.768-3.41,2.178V47.073c0,1.41,1.733,2.927,3.41,2.927H47.339A2.793,2.793,0,0,0,50,47.073V22.3H39.518Zm0.749,18.718H25.293V38.769H40.267v2.246Zm4.492-5.241H25.293V33.528H44.759v2.246Zm0-5.241H25.293V28.287H44.759v2.246Z' style='fill:#218ecf'/></svg>"},"images/data/edittable/dataconnection.svg":{result:"<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 50 50'><path d='M18.448,39.038a34.442,34.442,0,0,0,8.937-1.15c-0.019-.027-0.042-0.056-0.061-0.083a13.271,13.271,0,0,1-.892-1.5A12.936,12.936,0,0,1,25,30.364c0-.341.024-0.684,0.051-1.027a39.489,39.489,0,0,1-6.6.548c-8.215,0-15.243-2.4-18.448-5.961v6.411C0,34.88,8.24,39.038,18.448,39.038ZM28.7,39.468a37.029,37.029,0,0,1-10.254,1.379c-8.215,0-15.243-2.4-18.448-5.961V41.3C0,45.842,8.24,50,18.448,50c8.629,0,15.944-3.011,17.995-6.657a12.991,12.991,0,0,1-7.194-3.337C29.066,39.837,28.885,39.658,28.7,39.468ZM43.231,31.58c0.178,0.171.3,0.285,0.3,0.285h0S43.41,31.752,43.231,31.58ZM18.479,2C8.271,2,0,4.8,0,9.185s8.24,7.929,18.448,7.929,18.509-3.558,18.509-7.929S28.684,2,18.479,2ZM18.448,18.923c-8.215,0-15.243-2.4-18.448-5.961v6.411c0,4.546,8.24,8.7,18.448,8.7a35.508,35.508,0,0,0,6.9-.666c0.013-.049.023-0.1,0.037-0.147l0.05-.185a13.062,13.062,0,0,1,.641-1.911c0.133-.307.288-0.625,0.474-0.973,0.126-.237.257-0.471,0.4-0.7a13.212,13.212,0,0,1,1.093-1.519q0.3-.359.622-0.7a13.206,13.206,0,0,1,1.384-1.25,12.853,12.853,0,0,1,6.91-2.714V12.962C33.752,16.527,26.663,18.923,18.448,18.923Z'/><path d='M46.205,21.614a12.023,12.023,0,0,0-3.181-2.145q-0.44-.2-0.9-0.371t-0.934-.3c-0.294-.081-0.6-0.128-0.9-0.188-0.365-.072-0.734-0.134-1.107-0.178a9.75,9.75,0,0,0-1.139-.07c-0.366,0-.728.019-1.086,0.052a11.86,11.86,0,0,0-6.242,2.476,12.08,12.08,0,0,0-1.27,1.147q-0.3.309-.571,0.638a12.083,12.083,0,0,0-1,1.393c-0.129.209-.248,0.423-0.364,0.64-0.156.291-.3,0.587-0.435,0.892a11.557,11.557,0,0,0-.524,1.541c-0.019.071-.043,0.14-0.062,0.212-0.056.215-.122,0.427-0.166,0.647q-0.111.557-.17,1.132A11.878,11.878,0,0,0,27.4,35.8a12.112,12.112,0,0,0,.818,1.379c0.091,0.132.2,0.252,0.3,0.379,0.141,0.182.276,0.368,0.424,0.543a12.772,12.772,0,0,0,.946.991c0.035,0.033.064,0.072,0.1,0.1a11.9,11.9,0,0,0,6.892,3.1c0.384,0.038.774,0.058,1.168,0.058,0.349,0,.694-0.021,1.035-0.051A11.993,11.993,0,0,0,46.205,21.614Zm-1.074,5.859a0.755,0.755,0,0,1-.173.252L42.1,30.488c0.495,0.477.882,0.85,1.135,1.092,0.179,0.172.3,0.287,0.3,0.285h0L40.68,34.619l-1.664,1.606a2.058,2.058,0,0,1-1.057.541,2.149,2.149,0,0,1-.392.036h0a1.341,1.341,0,0,1-.611-0.11,2.021,2.021,0,0,1-.838-0.467L36,36.108l-0.165-.159-0.742-.716-0.646-.623L34,34.177l-2.617-2.526a1.933,1.933,0,0,1-.261-2.487,1.982,1.982,0,0,1,.261-0.309l2.77-2.674,0.719-.694L35.9,24.5l0.239,0.231,0.172,0.166,0.649,0.628,0.37,0.358,2.859-2.76a0.788,0.788,0,0,1,.261-0.167,0.811,0.811,0,0,1,.233-0.043c0.022,0,.043-0.012.065-0.012a0.822,0.822,0,0,1,.3.056,0.788,0.788,0,0,1,.261.167l0.074,0.072a0.747,0.747,0,0,1,0,1.08l-0.7.675-2.161,2.086,2.053,1.984,0.331,0.32,1.331-1.284,1.531-1.478a0.814,0.814,0,0,1,1.119,0l0.074,0.072a0.755,0.755,0,0,1,.173.252A0.746,0.746,0,0,1,45.131,27.474Z' style='fill:#79d79d'/></svg>"},"images/data/edittable/datafunction.svg":{result:"<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 50 50'><path d='M30.151,16.971a1.211,1.211,0,0,0-.2-0.661H23.826q0.1-.354.588-1.98,1.029-3.506,1.888-5.742a20.167,20.167,0,0,1,2.132-4.116Q30.3,1.728,32.257,1.728a2.694,2.694,0,0,1,2.011.94,4.654,4.654,0,0,1,.98,3.023,1.366,1.366,0,0,0,.221.558,0.535,0.535,0,0,0,.467.254,1.95,1.95,0,0,0,1.373-1.016,3.591,3.591,0,0,0,.735-2.134A2.935,2.935,0,0,0,36.841.94,4.44,4.44,0,0,0,34.024,0,9.935,9.935,0,0,0,29.66,1.016a11.392,11.392,0,0,0-3.873,3.2,21.989,21.989,0,0,0-3.138,5.208,55.376,55.376,0,0,0-2.3,6.884H16.128a1.388,1.388,0,0,0-.636,1.17,0.885,0.885,0,0,0,.294.711h4.068Q18.777,21.9,16.863,30.131q-2.108,8.945-3.48,13.568a8.947,8.947,0,0,1-1.5,3.3,2.226,2.226,0,0,1-1.594.914A3.164,3.164,0,0,1,8.7,47.409a3.7,3.7,0,0,1-1.348-1.372,1.206,1.206,0,0,0-.834-0.762,0.972,0.972,0,0,0-.588.3,2.954,2.954,0,0,0-.662.711A2.006,2.006,0,0,0,5,47.409a2.528,2.528,0,0,0,.834,1.728A3.124,3.124,0,0,0,8.186,50a6.48,6.48,0,0,0,3.31-.838,9.544,9.544,0,0,0,2.279-1.753q1.913-1.781,3.873-8.333,0.882-3.1,2.746-9.91L22.256,22.2q0.2-.71.54-1.879,0.441-1.728.588-2.136h6.079A1.484,1.484,0,0,0,30.151,16.971Zm14.422,6.836a1.4,1.4,0,0,0-1.2-.593,3.147,3.147,0,0,0-1.974.868A21.607,21.607,0,0,0,38.773,26.9q-0.817.973-1.222,1.5t-1.018,1.333q-0.407.507-.529,0.634l-1.751-4.95a5.487,5.487,0,0,0-.833-1.693,1.239,1.239,0,0,0-.957-0.508,3.147,3.147,0,0,0-1.953,1.418,8.993,8.993,0,0,0-1.709,3.11q0,0.676.448,0.677a0.636,0.636,0,0,0,.283-0.084,4.69,4.69,0,0,0,.285-0.508,11.557,11.557,0,0,1,.835-1.227,0.95,0.95,0,0,1,.712-0.422c0.245,0,.6.579,1.059,1.734a1.261,1.261,0,0,1,.081.255l1.709,4.569c-0.055.084-.325,0.424-0.814,1.015q-1.75,2.159-2.688,3.216a3.546,3.546,0,0,1-1.628,1.313q-0.487,0-.733-1.186a0.942,0.942,0,0,0-.162-0.381,0.33,0.33,0,0,0-.244-0.169,1.373,1.373,0,0,0-.9.465,3.47,3.47,0,0,0-.856,1.184,3.323,3.323,0,0,0-.325,1.355,1.581,1.581,0,0,0,.387,1.08,1.35,1.35,0,0,0,1.078.444,3.4,3.4,0,0,0,1.749-.719,14.417,14.417,0,0,0,2.646-2.625q1.141-1.436,1.832-2.305T34.7,34.09l1.547,4.019a11.452,11.452,0,0,0,1.118,2.244,1.524,1.524,0,0,0,1.282.719,2.706,2.706,0,0,0,2.1-1.524,10.58,10.58,0,0,0,1.445-3.681,0.384,0.384,0,0,0-.448-0.422,0.536,0.536,0,0,0-.406.169,18.656,18.656,0,0,1-1.1,1.861,1.185,1.185,0,0,1-.814.634,0.889,0.889,0,0,1-.652-0.571,14.512,14.512,0,0,1-.814-1.84l-1.507-4.021q1.548-1.9,2.4-2.961c0.57-.7,1.051-1.27,1.445-1.692a5.819,5.819,0,0,1,.976-0.889,1.286,1.286,0,0,1,.672-0.253,1.106,1.106,0,0,1,.854,1.058,0.768,0.768,0,0,0,.57.719,1.47,1.47,0,0,0,1.078-.719A2.775,2.775,0,0,0,45,25.2,2.322,2.322,0,0,0,44.573,23.807Z' style='fill:#fbb95d'/></svg>"},"images/data/edittable/datasource.svg":{result:"<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 50 50'><path d='M5,34.615v6.525C5,45.768,13.919,50,24.967,50,35.4,50,44.083,46.177,45,41.9V34.615c-3.469,3.629-11.142,6.068-20.033,6.068S8.469,38.244,5,34.615ZM24.967,15.385C36.012,15.385,45,11.763,45,7.313S36.045,0,25,0,5,2.852,5,7.313,13.919,15.385,24.967,15.385ZM5,11.538v6.525c0,4.627,8.919,8.859,19.967,8.859C35.4,26.923,44.083,23.1,45,18.82V11.538c-3.469,3.629-11.142,6.068-20.033,6.068S8.469,15.167,5,11.538ZM5,23.077V29.6c0,4.627,8.919,8.859,19.967,8.859,10.434,0,19.116-3.823,20.033-8.1V23.077c-3.469,3.629-11.142,6.068-20.033,6.068S8.469,26.706,5,23.077Z'/></svg>"},"images/data/edittable/datatable.svg":{result:"<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 50 50'><path d='M47,2a1.013,1.013,0,0,1,1,1V47a1.013,1.013,0,0,1-1,1H3a1.013,1.013,0,0,1-1-1V3A1.013,1.013,0,0,1,3,2H47m0-2H3A3.009,3.009,0,0,0,0,3V47a3.009,3.009,0,0,0,3,3H47a3.009,3.009,0,0,0,3-3V3a3.009,3.009,0,0,0-3-3Z'/><g style='opacity:0.6000000000000001'><rect x='7' y='37' width='10' height='7'/></g><g style='opacity:0.6000000000000001'><rect x='20' y='37' width='10' height='7'/></g><g style='opacity:0.6000000000000001'><rect x='33' y='37' width='10' height='7'/></g><g style='opacity:0.6000000000000001'><rect x='7' y='27' width='10' height='7'/></g><g style='opacity:0.6000000000000001'><rect x='20' y='27' width='10' height='7'/></g><g style='opacity:0.6000000000000001'><rect x='33' y='27' width='10' height='7'/></g><g style='opacity:0.6000000000000001'><rect x='7' y='17' width='10' height='7'/></g><g style='opacity:0.6000000000000001'><rect x='20' y='17' width='10' height='7'/></g><g style='opacity:0.6000000000000001'><rect x='33' y='17' width='10' height='7'/></g><rect y='11' width='50' height='2'/></svg>"},"images/data/edittable/datatable32x32.svg":{result:"<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'><g style='opacity:0.6'><rect x='4' y='11' width='6' height='4'/></g><g style='opacity:0.6'><rect x='13' y='11' width='6' height='4'/></g><g style='opacity:0.6'><rect x='22' y='11' width='6' height='4'/></g><g style='opacity:0.6'><rect x='4' y='18' width='6' height='4'/></g><g style='opacity:0.6'><rect x='13' y='18' width='6' height='4'/></g><g style='opacity:0.6'><rect x='22' y='18' width='6' height='4'/></g><g style='opacity:0.6'><rect x='4' y='25' width='6' height='4'/></g><g style='opacity:0.6'><rect x='13' y='25' width='6' height='4'/></g><g style='opacity:0.6'><rect x='22' y='25' width='6' height='4'/></g><path d='M30,0H2A2.006,2.006,0,0,0,0,2V30a2.006,2.006,0,0,0,2,2H30a2.006,2.006,0,0,0,2-2V2A2.006,2.006,0,0,0,30,0Zm1,30a.987.987,0,0,1-.9,1H2a.987.987,0,0,1-1-.9V2a.987.987,0,0,1,.9-1H30a.987.987,0,0,1,1,.9Z'/><rect y='8' width='32' height='1'/></svg>"},"images/data/edittable/datatabledatasource.svg":{result:"<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 50 50'><path d='M18.448,39.038a34.442,34.442,0,0,0,8.937-1.15c-0.019-.027-0.042-0.056-0.061-0.083a13.271,13.271,0,0,1-.892-1.5A12.936,12.936,0,0,1,25,30.364c0-.341.024-0.684,0.051-1.027a39.489,39.489,0,0,1-6.6.548c-8.215,0-15.243-2.4-18.448-5.961v6.411C0,34.88,8.24,39.038,18.448,39.038Zm0-21.924c10.2,0,18.509-3.558,18.509-7.929S28.684,2,18.479,2,0,4.8,0,9.185,8.24,17.114,18.448,17.114ZM28.7,39.468a37.029,37.029,0,0,1-10.254,1.379c-8.215,0-15.243-2.4-18.448-5.961V41.3C0,45.842,8.24,50,18.448,50c8.629,0,15.944-3.011,17.995-6.657a12.991,12.991,0,0,1-7.194-3.337C29.066,39.837,28.885,39.658,28.7,39.468ZM18.448,18.923c-8.215,0-15.243-2.4-18.448-5.961v6.411c0,4.546,8.24,8.7,18.448,8.7a35.508,35.508,0,0,0,6.9-.666c0.013-.049.023-0.1,0.037-0.147l0.05-.185a13.062,13.062,0,0,1,.641-1.911c0.133-.307.288-0.625,0.474-0.973,0.126-.237.257-0.471,0.4-0.7a13.212,13.212,0,0,1,1.093-1.519q0.3-.359.622-0.7a13.206,13.206,0,0,1,1.384-1.25,12.853,12.853,0,0,1,6.91-2.714V12.962C33.752,16.527,26.663,18.923,18.448,18.923Z'/><path d='M39,35h4V33H39v2Zm-6-4h4V29H33v2Zm0,4h4V33H33v2ZM46.2,21.615A12.023,12.023,0,0,0,43.02,19.47q-0.44-.2-0.9-0.371t-0.934-.3c-0.294-.081-0.6-0.128-0.9-0.188-0.365-.072-0.734-0.134-1.107-0.178a9.75,9.75,0,0,0-1.139-.07c-0.366,0-.728.019-1.086,0.052a11.86,11.86,0,0,0-6.242,2.476,12.08,12.08,0,0,0-1.27,1.147q-0.3.309-.571,0.638a12.083,12.083,0,0,0-1,1.393c-0.129.209-.248,0.423-0.364,0.64C27.348,25,27.2,25.3,27.069,25.6a11.557,11.557,0,0,0-.524,1.541c-0.019.071-.043,0.14-0.062,0.212-0.056.215-.122,0.427-0.166,0.647q-0.111.557-.17,1.132A11.878,11.878,0,0,0,27.394,35.8a12.112,12.112,0,0,0,.818,1.379c0.091,0.132.2,0.252,0.3,0.379,0.141,0.182.276,0.368,0.424,0.543a12.772,12.772,0,0,0,.946.991c0.035,0.033.064,0.072,0.1,0.1a11.9,11.9,0,0,0,6.892,3.1c0.384,0.038.774,0.058,1.168,0.058,0.349,0,.694-0.021,1.035-0.051A11.993,11.993,0,0,0,46.2,21.615ZM45,36.524c0,0.463-.331.476-0.785,0.476H31.862C31.408,37,31,36.987,31,36.524V24.2a1.261,1.261,0,0,1,.862-1.2H44.215A1.2,1.2,0,0,1,45,24.2v12.32ZM39,31h4V29H39v2Zm-6-4H43V25H33v2Z' style='fill:#79d79d'/></svg>"},"images/data/edittable/error20x20.svg":{result:"<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20'><circle cx='10' cy='10' r='10' class='svg-error-icon-background'/><rect x='9' y='13' width='2' height='2' style='fill:#fff'/><rect x='9' y='5' width='2' height='6' style='fill:#fff'/></svg>"},"images/data/edittable/filedatasource.svg":{result:"<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 50 50'><path d='M35,0V10H45C45.074,10,35,0,35,0ZM30.135,13.636V0H9.054C6.815,0,5,1.526,5,3.409V46.591C5,48.474,6.815,50,9.054,50H40.946C43.185,50,45,48.474,45,46.591V13.636H30.135Z' style='fill:#69bff3'/></svg>"},"images/data/edittable/frozen.svg":{result:"<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 50 50'><path d='M25.014,2.185l3.085,1.7V7.118l-3.085,1.7-3.085-1.7V3.882l3.085-1.7m0-2.185-5,2.75v5.5l5,2.75,5-2.75V2.75l-5-2.75h0Z' style='fill:#218ecf'/><path d='M25.014,41.185l3.085,1.7v3.236l-3.085,1.7-3.085-1.7V42.882l3.085-1.7m0-2.185-5,2.75v5.5l5,2.75,5-2.75v-5.5l-5-2.75h0Z' style='fill:#218ecf'/><path d='M41.956,12.032L44.939,13.9l0.016,3.521L42.128,19l-2.982-1.872L39.129,13.6l2.828-1.573m0.059-2.224-4.807,2.673,0.027,5.706,4.833,3.033,4.807-2.673-0.027-5.706L42.015,9.808h0Z' style='fill:#218ecf'/><path d='M7.872,30.987l2.982,1.872,0.016,3.521L8.044,37.952,5.061,36.08,5.045,32.559l2.828-1.573m0.059-2.224L3.125,31.436l0.027,5.706,4.833,3.033L12.792,37.5,12.765,31.8,7.931,28.763h0Z' style='fill:#218ecf'/><path d='M41.819,31.789L44.568,33.5l-0.186,3.516-3.069,1.726-2.749-1.707,0.186-3.516,3.069-1.726m0.048-2.224-4.974,2.8-0.3,5.7,4.672,2.9,4.974-2.8,0.3-5.7-4.672-2.9h0Z' style='fill:#218ecf'/><path d='M8.688,11.214l2.749,1.707-0.186,3.516L8.182,18.163,5.433,16.456,5.619,12.94l3.069-1.726M8.737,8.99l-4.974,2.8-0.3,5.7,4.672,2.9,4.974-2.8,0.3-5.7L8.737,8.99h0Z' style='fill:#218ecf'/><rect x='24' y='8.976' width='2' height='32' transform='translate(-9.407 33.037) rotate(-58.159)' style='fill:#218ecf'/><rect x='24.013' y='9' width='2' height='32' style='fill:#218ecf'/><rect x='9' y='23.992' width='32' height='2' transform='translate(-8.999 15.313) rotate(-29.099)' style='fill:#218ecf'/><rect x='7.013' y='24' width='36' height='2' style='fill:#218ecf'/><rect x='2.013' y='24' width='46' height='2' transform='translate(-8.973 34.776) rotate(-61.032)' style='fill:#218ecf'/><rect x='24.014' y='2' width='2' height='45.999' transform='translate(-9.458 17.102) rotate(-32.079)' style='fill:#218ecf'/><polygon points='17.514 20.75 25.014 16.5 32.514 20.75 32.514 29.25 25.014 33.5 17.514 29.25 17.514 20.75' style='fill:#218ecf'/></svg>"},"images/data/edittable/info.svg":{result:"<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 28 28'><circle class='sf-element-svg-element sfc-accent3-color' cx='14' cy='14' r='14'/><polygon points='16 20 16 12 12 12 10 12 10 14 12 14 12 20 10 20 10 22 18 22 18 20 16 20' style='fill:#ffffff'/><rect x='12' y='6' width='4' height='4' style='fill:#ffffff'/></svg>"},"images/data/edittable/informationlink.svg":{result:"<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 50 50'><path d='M42.678,7.322A25.042,25.042,0,0,0,1.709,34.258,27.336,27.336,0,0,0,16.171,48.719c9.016,3.608,19.173,1.293,26.507-6.041A25.028,25.028,0,0,0,42.678,7.322ZM41.334,41.334c-6.778,6.778-16.141,8.928-24.438,5.61a25.48,25.48,0,0,1-13.41-13.41A23.11,23.11,0,1,1,41.334,41.334ZM35.8,13.526a5.03,5.03,0,0,0-7.1,0l-3.5,3.5a5.015,5.015,0,0,0-.418,6.593l-1.155,1.155a5.015,5.015,0,0,0-6.592.418l-3.5,3.5a5.03,5.03,0,0,0,0,7.105L14.2,36.474a5.03,5.03,0,0,0,7.105,0l3.5-3.5a5.015,5.015,0,0,0,.418-6.592l1.155-1.155a5.015,5.015,0,0,0,6.593-.418l3.5-3.5a5.03,5.03,0,0,0,0-7.1ZM23.392,31.557l-3.5,3.5a3.027,3.027,0,0,1-4.277,0l-0.673-.673a3.027,3.027,0,0,1,0-4.277l3.5-3.5A3.026,3.026,0,0,1,22.2,26.2l-2.254,2.254a1.134,1.134,0,0,0,1.6,1.6L23.8,27.8A3.026,3.026,0,0,1,23.392,31.557ZM35.06,19.89l-3.5,3.5A3.026,3.026,0,0,1,27.8,23.8l2.254-2.254a1.134,1.134,0,0,0-1.6-1.6L26.2,22.2a3.026,3.026,0,0,1,.411-3.757l3.5-3.5a3.027,3.027,0,0,1,4.276,0l0.673,0.673A3.027,3.027,0,0,1,35.06,19.89Z' style='fill:#68bef2'/></svg>"},"images/data/edittable/logfile.svg":{result:"<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 50 50'><path d='M30,0.062V10H40C40.073,10,30,.062,30,0.062ZM18.145,22H40V13H26V0H4.554C2.315,0,0,1.026,0,2.909V46.091C0,47.974,2.315,50,4.554,50H36.446A3.73,3.73,0,0,0,40,46.091V44H18.145C15.3,44,13,40.7,13,37.855V28.145C13,25.3,15.3,22,18.145,22Z'/><rect x='16' y='25.4' width='34' height='15' rx='4.108' ry='4.108' style='fill:#79d79d'/><path d='M23.3,29.38H21.854v7.1h5.039V35.273H23.3V29.38Zm15.732,3.262v1.206h1.655v0.908a3.113,3.113,0,0,1-.783.432,2.5,2.5,0,0,1-.911.178,1.893,1.893,0,0,1-1.484-.637,2.806,2.806,0,0,1-.566-1.912,2.529,2.529,0,0,1,.56-1.782,1.958,1.958,0,0,1,1.506-.6,1.719,1.719,0,0,1,1.043.305,1.514,1.514,0,0,1,.568.833l1.436-.269a2.523,2.523,0,0,0-.964-1.545,3.423,3.423,0,0,0-2.083-.559,3.7,3.7,0,0,0-1.714.356,3.159,3.159,0,0,0-1.372,1.333,4.12,4.12,0,0,0-.469,1.987,4.364,4.364,0,0,0,.42,1.907,3,3,0,0,0,1.255,1.348,3.921,3.921,0,0,0,1.958.471,4.789,4.789,0,0,0,1.746-.334,3.925,3.925,0,0,0,1.315-.774V32.641H39.031ZM31.092,29.2a3.93,3.93,0,0,0-1.543.283,2.79,2.79,0,0,0-.925.645,3.36,3.36,0,0,0-.667.981,4.558,4.558,0,0,0-.327,1.836,3.7,3.7,0,0,0,.942,2.683,3.37,3.37,0,0,0,2.539.974,3.333,3.333,0,0,0,2.52-.979,3.746,3.746,0,0,0,.942-2.712,3.762,3.762,0,0,0-.949-2.729A3.363,3.363,0,0,0,31.092,29.2Zm1.434,5.544a1.931,1.931,0,0,1-2.845,0,2.684,2.684,0,0,1-.562-1.843,2.706,2.706,0,0,1,.547-1.848,2,2,0,0,1,2.874-.007,2.694,2.694,0,0,1,.539,1.836A2.737,2.737,0,0,1,32.525,34.743Z' style='fill:#fff'/></svg>"},"images/data/edittable/nonodeselected.svg":{result:"<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 110 110'><path d='M55,2A53,53,0,1,1,2,55,53.06,53.06,0,0,1,55,2m0-2a55,55,0,1,0,55,55A55,55,0,0,0,55,0h0Z' style='fill:#dadada'/><rect x='46' y='29.542' width='18' height='23' rx='2.495' ry='2.495' style='fill:#949494'/><path d='M37.5,48.542a2.006,2.006,0,0,1-2,2h-10a2.006,2.006,0,0,1-2-2v-15a2.006,2.006,0,0,1,2-2h10a2.006,2.006,0,0,1,2,2v15Z' style='fill:none;stroke:#dadada;stroke-miterlimit:10'/><rect x='25.5' y='33.542' width='10' height='9' style='fill:silver'/><rect x='25.5' y='44.542' width='10' height='4' style='fill:silver'/><rect x='48' y='31.542' width='14' height='19' rx='2' ry='2' style='fill:none;stroke:#dadada;stroke-miterlimit:10'/><rect x='50' y='33.542' width='10' height='9' style='fill:silver'/><rect x='50' y='44.542' width='10' height='4' style='fill:silver'/><rect x='72.5' y='31.542' width='14' height='19' rx='2' ry='2' style='fill:none;stroke:#dadada;stroke-miterlimit:10'/><rect x='74.5' y='33.542' width='10' height='9' style='fill:silver'/><rect x='74.5' y='44.542' width='10' height='4' style='fill:silver'/><rect x='35' y='60.958' width='14' height='19' rx='2' ry='2' style='fill:none;stroke:#dadada;stroke-miterlimit:10'/><rect x='37' y='62.958' width='10' height='9' style='fill:silver'/><rect x='37' y='73.958' width='10' height='4' style='fill:silver'/><path d='M55,50.541V65.229s0.291,5.229-2.723,5.229H49' style='fill:none;stroke:#dadada;stroke-miterlimit:10'/><line x1='48' y1='41.042' x2='37.5' y2='41.042' style='fill:none;stroke:#dadada;stroke-miterlimit:10'/><line x1='72.5' y1='41.042' x2='62' y2='41.042' style='fill:none;stroke:#dadada;stroke-miterlimit:10'/></svg>"},"images/data/edittable/reload.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' class='sf-element-svg-element sfc-accent3-color' viewBox='-2 -2 16 16' enable-background='new 0 0 12 12' xml:space='preserve'><g><g><path d='M9.716,1.9c-2.332-2.245-6.11-2.201-8.444,0.108C0.718,2.557,0.293,3.186,0,3.856l1.275,0.581 c0.225-0.53,0.555-1.027,0.992-1.459C4.049,1.216,6.932,1.18,8.716,2.89L6.769,5H12V0L9.716,1.9z'/></g></g><g><g><path d='M10.728,7.553c-0.224,0.531-0.554,1.029-0.99,1.462c-1.778,1.767-4.656,1.802-6.437,0.089L5.244,7H0v5 l2.303-1.904c2.327,2.249,6.098,2.206,8.427-0.108c0.554-0.55,0.977-1.181,1.27-1.852L10.728,7.553z'/></g></g></svg>"},"images/data/edittable/sbdf.svg":{result:"<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 50 50'><path d='M25,0A25.052,25.052,0,0,0,1.984,15.259,25.55,25.55,0,0,0,1.984,35h0A25.04,25.04,0,1,0,25,0Zm0,48.136A22.76,22.76,0,0,1,4.133,35H36.3A7.737,7.737,0,0,0,44,27.08V22.92A7.737,7.737,0,0,0,36.3,15H4.133A22.756,22.756,0,0,1,25,1.867,23.134,23.134,0,1,1,25,48.136Z' style='fill:#79d79d'/><path d='M14.251,24.755a7.023,7.023,0,0,0-1.561-.515,3.806,3.806,0,0,1-1.328-.479,0.552,0.552,0,0,1-.215-0.435,0.523,0.523,0,0,1,.229-0.444,1.654,1.654,0,0,1,.986-0.259,1.459,1.459,0,0,1,.916.242,1.227,1.227,0,0,1,.4.793l1.445-.063a2.084,2.084,0,0,0-.715-1.577,3.022,3.022,0,0,0-2.029-.591,3.579,3.579,0,0,0-1.408.249,1.935,1.935,0,0,0-.894.725,1.838,1.838,0,0,0-.311,1.023,1.863,1.863,0,0,0,.659,1.44,3.928,3.928,0,0,0,1.631.708q0.9,0.225,1.157.313a1.192,1.192,0,0,1,.521.31,0.654,0.654,0,0,1,.148.432,0.88,0.88,0,0,1-.354.691,1.612,1.612,0,0,1-1.053.3,1.557,1.557,0,0,1-1.047-.332,1.717,1.717,0,0,1-.516-1.04l-1.406.137a2.734,2.734,0,0,0,.869,1.829,3.1,3.1,0,0,0,2.085.627,4.048,4.048,0,0,0,1.558-.261,2.047,2.047,0,0,0,.967-0.8,2.1,2.1,0,0,0,.342-1.152,2.127,2.127,0,0,0-.285-1.14A2.009,2.009,0,0,0,14.251,24.755Zm14.592-2.41a2.387,2.387,0,0,0-1.079-.659,5.151,5.151,0,0,0-1.362-.137H23.76v7.158h2.72a4.363,4.363,0,0,0,1.279-.151,2.534,2.534,0,0,0,1.016-.571,3.151,3.151,0,0,0,.767-1.265,4.7,4.7,0,0,0,.22-1.523,5.284,5.284,0,0,0-.234-1.692A3.123,3.123,0,0,0,28.843,22.345Zm-0.723,4.1a1.518,1.518,0,0,1-.378.691,1.338,1.338,0,0,1-.584.3,3.942,3.942,0,0,1-.874.068H25.205V22.76h0.649a6.559,6.559,0,0,1,1.187.068,1.374,1.374,0,0,1,.669.337,1.637,1.637,0,0,1,.41.693,4.278,4.278,0,0,1,.146,1.274A4.671,4.671,0,0,1,28.12,26.444ZM21.187,24.9a1.695,1.695,0,0,0,1.006-1.553,1.621,1.621,0,0,0-.22-0.837,1.838,1.838,0,0,0-.549-0.6,1.862,1.862,0,0,0-.747-0.3,8.252,8.252,0,0,0-1.268-.071H16.548v7.158h2.437q1.383-.01,1.743-0.049a2.05,2.05,0,0,0,.97-0.339,1.917,1.917,0,0,0,.62-0.737,2.126,2.126,0,0,0,.227-0.95,1.724,1.724,0,0,0-.352-1.079A1.882,1.882,0,0,0,21.187,24.9Zm-3.193-2.163h0.83q1.021,0,1.235.024a0.83,0.83,0,0,1,.545.251,0.785,0.785,0,0,1,.183.54,0.756,0.756,0,0,1-.212.559,0.955,0.955,0,0,1-.584.256q-0.205.024-1.05,0.024H17.993V22.741Zm2.854,4.431a0.9,0.9,0,0,1-.525.286,6.529,6.529,0,0,1-.991.044H17.993V25.587H19.16a4.913,4.913,0,0,1,1.282.1,0.881,0.881,0,0,1,.451.327,0.932,0.932,0,0,1,.156.547A0.881,0.881,0,0,1,20.848,27.172ZM35.9,22.76V21.549H31v7.158h1.445V25.666H35.43V24.455H32.441V22.76H35.9Z' style='fill:#fff'/></svg>"},"images/data/edittable/settings14x14.svg":{result:"<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 14 14'><path fill='currentColor' d='M13.743,9.1l-1.4-1.615a.569.569,0,0,0-.114-.047c.012-.146.022-.293.022-.442s-.01-.3-.022-.442a.565.565,0,0,0,.114-.047l1.4-1.615a.5.5,0,0,0,.182-.694l-1.185-1.77a.523.523,0,0,0-.721-.111l-1.8.542a5.24,5.24,0,0,0-1.169-.694L8.569.531A.512.512,0,0,0,8.079,0H5.921a.512.512,0,0,0-.491.531L4.946,2.168a5.242,5.242,0,0,0-1.169.694L1.98,2.32a.523.523,0,0,0-.721.111L.074,4.2A.5.5,0,0,0,.257,4.9l1.4,1.615a.567.567,0,0,0,.114.047C1.76,6.7,1.75,6.851,1.75,7s.01.3.022.442a.571.571,0,0,0-.114.047L.257,9.1A.5.5,0,0,0,.074,9.8l1.185,1.77a.523.523,0,0,0,.721.111l1.8-.542a5.239,5.239,0,0,0,1.169.694l.485,1.637A.512.512,0,0,0,5.921,14H8.079a.512.512,0,0,0,.491-.531l.485-1.637a5.237,5.237,0,0,0,1.169-.694l1.8.542a.523.523,0,0,0,.721-.111L13.926,9.8A.5.5,0,0,0,13.743,9.1ZM7,9.25A2.25,2.25,0,1,1,9.25,7,2.25,2.25,0,0,1,7,9.25Z' transform='translate(0)'/></svg>"},"images/data/edittable/stdf.svg":{result:"<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 50 50'><path d='M25,0A25.052,25.052,0,0,0,1.984,15.259,25.55,25.55,0,0,0,1.984,35h0A25.04,25.04,0,1,0,25,0Zm0,48.136A22.76,22.76,0,0,1,4.133,35H36.3A7.737,7.737,0,0,0,44,27.08V22.92A7.737,7.737,0,0,0,36.3,15H4.133A22.756,22.756,0,0,1,25,1.867,23.134,23.134,0,1,1,25,48.136Z' style='fill:#f58585'/><path d='M14.251,24.755a7.023,7.023,0,0,0-1.561-.515,3.806,3.806,0,0,1-1.328-.479,0.552,0.552,0,0,1-.215-0.435,0.523,0.523,0,0,1,.229-0.444,1.654,1.654,0,0,1,.986-0.259,1.459,1.459,0,0,1,.916.242,1.227,1.227,0,0,1,.4.793l1.445-.063a2.084,2.084,0,0,0-.715-1.577,3.022,3.022,0,0,0-2.029-.591,3.579,3.579,0,0,0-1.408.249,1.935,1.935,0,0,0-.894.725,1.838,1.838,0,0,0-.311,1.023,1.863,1.863,0,0,0,.659,1.44,3.928,3.928,0,0,0,1.631.708q0.9,0.225,1.157.313a1.192,1.192,0,0,1,.521.31,0.654,0.654,0,0,1,.148.432,0.88,0.88,0,0,1-.354.691,1.612,1.612,0,0,1-1.053.3,1.557,1.557,0,0,1-1.047-.332,1.717,1.717,0,0,1-.516-1.04l-1.406.137a2.734,2.734,0,0,0,.869,1.829,3.1,3.1,0,0,0,2.085.627,4.048,4.048,0,0,0,1.558-.261,2.047,2.047,0,0,0,.967-0.8,2.1,2.1,0,0,0,.342-1.152,2.127,2.127,0,0,0-.285-1.14A2.009,2.009,0,0,0,14.251,24.755ZM16.03,22.76h2.124v5.947H19.6V22.76h2.119V21.549H16.03V22.76Zm11.7-.415a2.387,2.387,0,0,0-1.079-.659,5.151,5.151,0,0,0-1.362-.137H22.646v7.158h2.72a4.363,4.363,0,0,0,1.279-.151,2.534,2.534,0,0,0,1.016-.571,3.151,3.151,0,0,0,.767-1.265,4.7,4.7,0,0,0,.22-1.523,5.284,5.284,0,0,0-.234-1.692A3.123,3.123,0,0,0,27.729,22.345Zm-0.723,4.1a1.518,1.518,0,0,1-.378.691,1.338,1.338,0,0,1-.584.3,3.942,3.942,0,0,1-.874.068H24.092V22.76h0.649a6.559,6.559,0,0,1,1.187.068,1.374,1.374,0,0,1,.669.337,1.637,1.637,0,0,1,.41.693,4.278,4.278,0,0,1,.146,1.274A4.671,4.671,0,0,1,27.007,26.444ZM34.79,22.76V21.549H29.883v7.158h1.445V25.666h2.988V24.455H31.328V22.76H34.79Z' style='fill:#fff'/></svg>"},"images/data/edittable/textfile.svg":{result:"<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 50 50'><path d='M35.123,0.062V9.938H45C45.073,9.938,35.123.062,35.123,0.062ZM31,13V0H9.554C7.315,0,5,1.026,5,2.909V46.091C5,47.974,7.315,50,9.554,50H41.446A3.73,3.73,0,0,0,45,46.091V13H31Zm1,25H12V35H32v3Zm6-7H12V28H38v3Zm0-7H12V21H38v3Z' style='fill:#69bff3'/></svg>"},"images/data/edittable/unknowndatasource.svg":{result:"<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 50 50'><path d='M18.451,39.038a34.442,34.442,0,0,0,8.937-1.15c-0.019-.027-0.042-0.056-0.061-0.083a13.271,13.271,0,0,1-.892-1.5A12.936,12.936,0,0,1,25,30.364c0-.341.024-0.684,0.051-1.027a39.489,39.489,0,0,1-6.6.548c-8.215,0-15.243-2.4-18.448-5.961v6.411C0,34.88,8.243,39.038,18.451,39.038Zm0-21.924c10.2,0,18.509-3.558,18.509-7.929S28.686,2,18.481,2,0,4.8,0,9.185,8.243,17.114,18.451,17.114ZM28.7,39.468a37.029,37.029,0,0,1-10.254,1.379c-8.215,0-15.243-2.4-18.448-5.961V41.3C0,45.842,8.243,50,18.451,50c8.629,0,15.944-3.011,17.995-6.657a12.991,12.991,0,0,1-7.194-3.337C29.068,39.837,28.887,39.658,28.7,39.468ZM18.451,18.923c-8.215,0-15.243-2.4-18.448-5.961v6.411c0,4.546,8.24,8.7,18.448,8.7a35.508,35.508,0,0,0,6.9-.666c0.013-.049.023-0.1,0.037-0.147l0.05-.185a13.062,13.062,0,0,1,.641-1.911c0.133-.307.288-0.625,0.474-0.973,0.126-.237.257-0.471,0.4-0.7a13.212,13.212,0,0,1,1.093-1.519q0.3-.359.622-0.7a13.206,13.206,0,0,1,1.384-1.25,12.853,12.853,0,0,1,6.91-2.714V12.962C33.754,16.527,26.665,18.923,18.451,18.923Z'/><path d='M46.2,21.615a12.023,12.023,0,0,0-3.181-2.145q-0.44-.2-0.9-0.371t-0.934-.3c-0.294-.081-0.6-0.128-0.9-0.188-0.365-.072-0.734-0.134-1.107-0.178a9.75,9.75,0,0,0-1.139-.07c-0.366,0-.728.019-1.086,0.052a11.86,11.86,0,0,0-6.242,2.476,12.08,12.08,0,0,0-1.27,1.147q-0.3.309-.571,0.638a12.083,12.083,0,0,0-1,1.393c-0.129.209-.248,0.423-0.364,0.64C27.351,25,27.2,25.3,27.071,25.6a11.557,11.557,0,0,0-.524,1.541c-0.019.071-.043,0.14-0.062,0.212-0.056.215-.122,0.427-0.166,0.647q-0.111.557-.17,1.132A11.878,11.878,0,0,0,27.4,35.8a12.112,12.112,0,0,0,.818,1.379c0.091,0.132.2,0.252,0.3,0.379,0.141,0.182.276,0.368,0.424,0.543a12.772,12.772,0,0,0,.946.991c0.035,0.033.064,0.072,0.1,0.1a11.9,11.9,0,0,0,6.892,3.1c0.384,0.038.774,0.058,1.168,0.058,0.349,0,.694-0.021,1.035-0.051A11.993,11.993,0,0,0,46.2,21.615ZM39.04,36.991a1.583,1.583,0,0,1-2.041,0,1.138,1.138,0,0,1,0-1.778,1.583,1.583,0,0,1,2.041,0A1.138,1.138,0,0,1,39.04,36.991Zm3.369-8.817a3.776,3.776,0,0,1-.681,1.023l-1.319,1.186-0.222.172c-0.234.191-.427,0.354-0.566,0.488a1.825,1.825,0,0,0-.341.421,1.539,1.539,0,0,0-.188.488,3.663,3.663,0,0,0-.091.669V33H37V32.3a3.576,3.576,0,0,1,.081-0.86,2.12,2.12,0,0,1,.257-0.622,2.483,2.483,0,0,1,.472-0.536q0.3-.258.735-0.622,0.351-.287.7-0.583a6.56,6.56,0,0,0,.637-0.612,3.284,3.284,0,0,0,.472-0.669A1.678,1.678,0,0,0,40.543,27a1.8,1.8,0,0,0-.187-0.813,2.073,2.073,0,0,0-.494-0.641,2.275,2.275,0,0,0-.735-0.421,2.692,2.692,0,0,0-.911-0.153,2.535,2.535,0,0,0-1.745.593,2.438,2.438,0,0,0-.8,1.549l-2.239-.191a3.907,3.907,0,0,1,1.592-2.611,5.369,5.369,0,0,1,3.238-.947,6,6,0,0,1,1.723.239,4.34,4.34,0,0,1,1.394.689A3.165,3.165,0,0,1,42.65,26.9,3.118,3.118,0,0,1,42.408,28.174Z' style='fill:#79d79d'/></svg>"},"images/dialog/close.svg":{result:"<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 12 12'><g fill='currentColor'><polygon points='12 1.092 10.908 0 6 4.908 1.092 0 0 1.092 4.908 6 0 10.908 1.092 12 6 7.092 10.908 12 12 10.908 7.092 6 12 1.092'/></g></svg>"},"images/dialog/help.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' fill='currentColor' viewBox='4 4 16 16' enable-background='new 4 4 16 16' xml:space='preserve'><g id='Lager_2'><path d='M12,4c-4.418,0-8,3.582-8,8c0,4.418,3.582,8,8,8s8-3.582,8-8C20,7.582,16.418,4,12,4z M12.712,15.766 c-0.2,0.155-0.44,0.234-0.715,0.234c-0.275,0-0.515-0.079-0.714-0.234c-0.205-0.159-0.309-0.354-0.309-0.578 c0-0.224,0.104-0.419,0.309-0.578c0.199-0.155,0.44-0.234,0.714-0.234c0.275,0,0.515,0.079,0.715,0.234 c0.205,0.16,0.309,0.354,0.309,0.578C13.021,15.412,12.917,15.606,12.712,15.766z M14.84,10.828 c-0.106,0.213-0.256,0.414-0.445,0.599l-0.008,0.007l-0.826,0.664l-0.137,0.096c-0.141,0.103-0.256,0.192-0.338,0.263 c-0.077,0.067-0.139,0.136-0.182,0.207c-0.043,0.07-0.073,0.149-0.088,0.235c-0.017,0.093-0.026,0.212-0.026,0.354v0.578h-1.555 v-0.759c0-0.2,0.02-0.37,0.058-0.506c0.04-0.139,0.1-0.266,0.179-0.378c0.079-0.112,0.186-0.22,0.317-0.322 c0.124-0.096,0.278-0.213,0.46-0.347c0.146-0.106,0.291-0.214,0.436-0.323c0.14-0.105,0.269-0.216,0.384-0.33 c0.111-0.11,0.204-0.228,0.276-0.349c0.067-0.114,0.102-0.245,0.102-0.389c0-0.144-0.035-0.28-0.103-0.402 c-0.07-0.124-0.163-0.233-0.277-0.322c-0.115-0.089-0.256-0.161-0.419-0.214c-0.164-0.052-0.341-0.079-0.526-0.079 c-0.413,0-0.751,0.102-1.005,0.302c-0.257,0.203-0.407,0.462-0.458,0.793l-0.016,0.104L9,10.187l0.023-0.119 c0.123-0.643,0.473-1.155,1.039-1.522C10.622,8.184,11.324,8,12.148,8c0.393,0,0.765,0.046,1.106,0.137 c0.344,0.092,0.649,0.226,0.906,0.4c0.259,0.176,0.466,0.396,0.615,0.654C14.924,9.45,15,9.748,15,10.076 C15,10.36,14.946,10.613,14.84,10.828z'/></g></svg>"},"images/dialog/lightbulb10x14.svg":{result:"<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 10 14' fill='currentColor'><rect x='4' y='13' width='2' height='1'/><rect x='3' y='11' width='4' height='1'/><path d='M5.09,0H4.91C3.466.034-.078.628,0,3.762A4.431,4.431,0,0,0,1.024,6.356C2.364,8.176,2.811,7.634,2.891,10H7.109c.081-2.366.527-1.824,1.867-3.644A4.431,4.431,0,0,0,10,3.762C10.078.628,6.534.034,5.09,0ZM8.234,5.685,8.2,5.723l-.03.04a9.183,9.183,0,0,1-.9,1.052A3.2,3.2,0,0,0,6.178,9H3.822A3.2,3.2,0,0,0,2.734,6.815a9.172,9.172,0,0,1-.9-1.052l-.03-.04-.034-.037A3.447,3.447,0,0,1,1,3.736a2.072,2.072,0,0,1,.558-1.561A5.155,5.155,0,0,1,4.91,1h.168A5.167,5.167,0,0,1,8.441,2.175,2.083,2.083,0,0,1,9,3.75,3.445,3.445,0,0,1,8.234,5.685Z' transform='translate(0)'/></svg>"},"images/dialog/resize.svg":{result:"<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 11.006 11'><g fill='currentColor'><rect y='10' width='1' height='1'/><rect x='1.001' y='8.999' width='1' height='1'/><rect x='4.003' y='10' width='1' height='1'/><rect x='2.001' y='7.999' width='1' height='1'/><rect x='5.003' y='8.999' width='1' height='1'/><rect x='3.002' y='6.998' width='1' height='1'/><rect x='6.004' y='7.999' width='1' height='1'/><rect x='4.003' y='5.997' width='1' height='1'/><rect x='7.004' y='6.998' width='1' height='1'/><rect x='5.003' y='4.997' width='1' height='1'/><rect x='8.005' y='5.997' width='1' height='1'/><rect x='6.004' y='3.996' width='1' height='1'/><rect x='9.006' y='4.997' width='1' height='1'/><rect x='7.004' y='2.996' width='1' height='1'/><rect x='10.006' y='3.996' width='1' height='1'/><rect x='8.005' y='1.995' width='1' height='1'/><rect x='8.005' y='10' width='1' height='1'/><rect x='9.006' y='8.999' width='1' height='1'/><rect x='10.006' y='7.999' width='1' height='1'/><rect x='9.999' width='1' height='1'/><rect x='8.999' y='1.001' width='1' height='1'/></g></svg>"},"images/filters/calendar.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 14 14' enable-background='new 0 0 14 14' xml:space='preserve'><g id='Lager_6' shape-rendering='crispEdges' fill='currentColor'><g><g><rect y='4' width='1' height='7'/></g></g><g><g><rect x='12' y='4' width='1' height='7'/></g></g><g><g><rect y='2' width='3' height='2'/></g></g><g><g><rect x='4' y='2' width='5' height='2'/></g></g><g><g><rect x='3' y='5' width='1' height='2'/></g></g><g><g><rect x='6' y='5' width='1' height='2'/></g></g><g><g><rect x='9' y='5' width='1' height='2'/></g></g><g><g><rect x='9' y='8' width='1' height='2'/></g></g><g><g><rect x='6' y='8' width='1' height='2'/></g></g><g><g><rect x='3' y='8' width='1' height='2'/></g></g><g><g><rect x='10' y='2' width='3' height='2'/></g></g><g><g><rect x='1' y='7' width='11' height='1'/></g></g><g><g><rect x='1' y='4' width='11' height='1'/></g></g><g><g><rect x='1' y='10' width='11' height='1'/></g></g></g><g id='Lager_5' shape-rendering='crispEdges'><g><g><rect x='7' y='8' fill='#3D9DD7' width='2' height='2'/></g></g></g></svg>"},"images/filters/checkmark.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 11 11' xml:space='preserve'><g fill='currentColor'><path d='M7.608,2l-2.522,4.835l-2.331,-1.835l-0.755,1.234l3.478,2.766l3.522,-6.124z'></path></g></svg>"},"images/filters/downarrow.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 12 12' xml:space='preserve'><g fill='currentColor'><path d='M3,5.5 l8,0 l-4,4 z'></path></g></svg>"},"images/filters/filtergroupcollapse.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 9 9' enable-background='new 0 0 9 9' xml:space='preserve'><g shape-rendering='crispEdges' fill='currentColor'><g><rect x='2' y='4' width='5' height='1'/></g></g><g opacity='0.3' shape-rendering='crispEdges' fill='currentColor'><g><rect x='8' width='1' height='9'/></g></g><g opacity='0.3' shape-rendering='crispEdges' fill='currentColor'><g><rect width='1' height='9'/></g></g><g opacity='0.3' shape-rendering='crispEdges' fill='currentColor'><g><rect x='1' y='0' width='7' height='1'/></g></g><g opacity='0.3' shape-rendering='crispEdges' fill='currentColor'><g><rect x='1' y='8' width='7' height='1'/></g></g></svg>"},"images/filters/filtergroupexpand.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 9 9' enable-background='new 0 0 9 9' xml:space='preserve'><g opacity='0.3' shape-rendering='crispEdges' fill='currentColor'><g><rect x='8' width='1' height='9'/></g></g><g opacity='0.3' shape-rendering='crispEdges' fill='currentColor'><g><rect width='1' height='9'/></g></g><g shape-rendering='crispEdges' fill='currentColor'><g><rect x='4' y='2' width='1' height='5'/></g></g><g shape-rendering='crispEdges' fill='currentColor'><g><rect x='2' y='4' width='5' height='1'/></g></g><g opacity='0.3' shape-rendering='crispEdges' fill='currentColor'><g><rect x='1' y='0' width='7' height='1'/></g></g><g opacity='0.3' shape-rendering='crispEdges' fill='currentColor'><g><rect x='1' y='8' width='7' height='1'/></g></g></svg>"},"images/filters/filtertablegroupcollapse.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 12 12' enable-background='new 0 0 12 12' xml:space='preserve'><g id='Lager_3' shape-rendering='crispEdges' fill='currentColor'><g><g><polygon points='6,3 4.8,4.167 10.8,10 12,8.833 '/></g></g><g><g><polygon points='6,3 0,8.833 1.2,10 7.2,4.167 '/></g></g></g></svg>"},"images/filters/filtertablegroupexpand.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 12 12' enable-background='new 0 0 12 12' xml:space='preserve'><g id='Lager_3' shape-rendering='crispEdges' fill='currentColor'><g><g><polygon points='1.2,3 0,4.167 6,10 7.2,8.833 '/></g></g><g><g><polygon points='10.8,3 4.8,8.833 6,10 12,4.167 '/></g></g></g></svg>"},"images/filters/hierarchyfiltersearchalllevels.svg":{result:"<svg xmlns='http://www.w3.org/2000/svg' x='0px' y='0px' width='23px' height='14px'><rect x='5' y='3' width='3' height='3'/><rect x='6' y='4' width='1' height='5'/><rect x='6' y='9' width='5' height='1'/><rect x='10' y='8' width='3' height='3'/><path d='M14.5,5 l6,0 l-3,3 z'/></svg>"},"images/filters/leftarrow.svg":{result:"<svg xmlns='http://www.w3.org/2000/svg' x='0px' y='0px' width='10px' height='10px'><path d='M 6,2 l0,6 l-3,-3 z' stroke-width='1' transform='scale(1,1)'/></svg>"},"images/filters/rightarrow.svg":{result:"<svg xmlns='http://www.w3.org/2000/svg' x='0px' y='0px' width='10px' height='10px'><path d='M 4,2 l0,6 l3,-3 z' stroke-width='1' transform='scale(1,1)'/></svg>"},"images/formatting/boolean.svg":{result:"<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'><path d='M3,4.9V4.881A2.614,2.614,0,0,1,5.449,2,2.592,2.592,0,0,1,7.883,4.865V4.881A2.613,2.613,0,0,1,5.433,7.762,2.587,2.587,0,0,1,3,4.9Zm3.866,0V4.881c0-1.1-.568-2-1.433-2s-1.417.875-1.417,1.982V4.881c0,1.1.56,2,1.433,2S6.866,6,6.866,4.9Z'/><path d='M10,9h1v5H10V9Z'/><path d='M12,5.646L5.813,11.284l-0.672-.6,6.187-5.638Z'/></svg>"},"images/formatting/currency.svg":{result:"<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'><path d='M8.761,6.991V4.327a5.3,5.3,0,0,1,2.03.9l0.836-1.318A5.926,5.926,0,0,0,8.82,2.841V2h-1.3V2.813c-1.865.14-3.134,1.164-3.134,2.678V5.519c0,1.57,1.015,2.341,3.194,2.874V11.14A5.563,5.563,0,0,1,4.955,9.935L4,11.21A7.173,7.173,0,0,0,7.522,12.6V14h1.3V12.612c1.9-.154,3.18-1.177,3.18-2.705V9.879C12,8.379,11.03,7.523,8.761,6.991ZM7.582,6.7C6.432,6.374,6.149,6,6.149,5.42V5.393A1.288,1.288,0,0,1,7.582,4.229V6.7ZM10.239,10A1.317,1.317,0,0,1,8.761,11.2V8.659c1.164,0.323,1.478.7,1.478,1.318V10Z'/></svg>"},"images/formatting/custom.svg":{result:"<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'><path d='M5.23,3.216l2.5,2.5a0.166,0.166,0,0,1,0,.234L5.95,7.73a0.166,0.166,0,0,1-.234,0l-2.5-2.5a3.131,3.131,0,0,0,.954,3.479,3.337,3.337,0,0,0,3.948.5l3.543,3.543A0.837,0.837,0,0,0,12.8,12.8h0a0.837,0.837,0,0,0-.048-1.138L9.209,8.119a3.336,3.336,0,0,0-.5-3.948A3.13,3.13,0,0,0,5.23,3.216Z'/></svg>"},"images/formatting/date.svg":{result:"<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'><path d='M12,2H4A2,2,0,0,0,2,4v8a2,2,0,0,0,2,2h8a2,2,0,0,0,2-2V4A2,2,0,0,0,12,2ZM10,3h2V5H10V3ZM4,3H6V5H4V3Zm9,9a1,1,0,0,1-1,1H4a1,1,0,0,1-1-1V7A1,1,0,0,1,4,6h8a1,1,0,0,1,1,1v5Z'/><polygon points='10.373 7 9 7.425 9.19 8.135 10.109 7.887 10.109 12 11 12 11 7 10.373 7'/><path d='M6.594,9.051l1.331-1.4V7H4.766V7.751H6.833L5.544,9.163,5.68,9.7H6.069a0.9,0.9,0,0,1,1.1.758v0.015a0.756,0.756,0,0,1-.825.744,1.545,1.545,0,0,1-1.256-.646L4.5,11.136A2.24,2.24,0,0,0,6.328,12,1.547,1.547,0,0,0,8,10.448V10.434A1.4,1.4,0,0,0,6.594,9.051Z'/></svg>"},"images/formatting/datepart.svg":{result:"<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'><path d='M12,2H4A2,2,0,0,0,2,4v8a2,2,0,0,0,2,2h8a2,2,0,0,0,2-2V4A2,2,0,0,0,12,2ZM10,3h2V5H10V3ZM4,3H6V5H4V3Zm9,9a1,1,0,0,1-1,1H4a1,1,0,0,1-1-1V7A1,1,0,0,1,4,6h8a1,1,0,0,1,1,1v5Z'/><polygon points='10.373 7 9 7.425 9.19 8.135 10.109 7.887 10.109 12 11 12 11 7 10.373 7'/><path d='M6.594,9.051l1.331-1.4V7H4.766V7.751H6.833L5.544,9.163,5.68,9.7H6.069a0.9,0.9,0,0,1,1.1.758v0.015a0.756,0.756,0,0,1-.825.744,1.545,1.545,0,0,1-1.256-.646L4.5,11.136A2.24,2.24,0,0,0,6.328,12,1.547,1.547,0,0,0,8,10.448V10.434A1.4,1.4,0,0,0,6.594,9.051Z'/></svg>"},"images/formatting/datetime.svg":{result:"<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'><rect x='4' y='3' width='2' height='2'/><polygon points='14 5.501 14 5.496 14 5.506 14 5.501'/><rect x='4' y='3' width='2' height='2'/><path d='M13,9.24V12a1,1,0,0,1-1,1H4a1,1,0,0,1-1-1V7A1,1,0,0,1,4,6H6.05A4.41,4.41,0,0,1,6,5.5,4.475,4.475,0,0,1,7.708,2H4A2,2,0,0,0,2,4v8a2,2,0,0,0,2,2h8a2,2,0,0,0,2-2V8.3A4.518,4.518,0,0,1,13,9.24ZM4,3H6V5H4V3Z'/><path d='M11,12V10c-0.185.018-.37,0.037-0.561,0.037-0.15,0-.292-0.025-0.439-0.036v2h1Z'/><path d='M4.766,7V7.751H6.647A4.439,4.439,0,0,1,6.3,7H4.766Z'/><path d='M5.543,9.163L5.68,9.7H6.069a0.9,0.9,0,0,1,1.1.758v0.015a0.756,0.756,0,0,1-.825.744,1.545,1.545,0,0,1-1.256-.646L4.5,11.136A2.24,2.24,0,0,0,6.328,12,1.547,1.547,0,0,0,8,10.448V10.434A1.4,1.4,0,0,0,6.594,9.051l0.563-.594a4.459,4.459,0,0,1-.436-0.583Z'/><path d='M12.972,3.025C12.962,3.015,12.951,3.009,12.941,3a3.523,3.523,0,0,0-.487-0.4c-0.039-.026-0.083-0.042-0.123-0.067a3.475,3.475,0,0,0-.471-0.256c-0.1-.044-0.216-0.067-0.325-0.1a3.389,3.389,0,0,0-.331-0.1A3.5,3.5,0,0,0,7,5.5a3.456,3.456,0,0,0,.05.5,3.485,3.485,0,0,0,.315,1h0c0,0.007.009,0.012,0.012,0.018A3.488,3.488,0,1,0,12.972,3.025ZM12,7H9V4h1V6h2V7Z'/></svg>"},"images/formatting/general.svg":{result:"<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'><path d='M13.9,3.98l-0.753-.862a0.325,0.325,0,0,0-.5,0L7.245,9.3l-2.887-3.3a0.325,0.325,0,0,0-.5,0L3.1,6.854a0.451,0.451,0,0,0,0,.575l3.891,4.453a0.325,0.325,0,0,0,.5,0l6.4-7.326A0.451,0.451,0,0,0,13.9,3.98Z'/></svg>"},"images/formatting/number.svg":{result:"<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'><path d='M5,10.043L7.143,8.022C8,7.224,8.308,6.78,8.308,6.159a0.983,0.983,0,0,0-1-1.075A1.8,1.8,0,0,0,5.862,6.12l-0.773-.67A2.516,2.516,0,0,1,7.383,4,1.954,1.954,0,0,1,9.437,6.061V6.08c0,1.085-.517,1.676-1.619,2.672L6.538,9.935H9.5V11H5V10.043Z'/><path d='M2.387,5.241l-1.149.348L1,4.6,2.715,4H3.5v7H2.387V5.241Z'/><path d='M10,9.791L10.838,9a2.219,2.219,0,0,0,1.793.9,1.072,1.072,0,0,0,1.18-1.042V8.847c0-.678-0.614-1.062-1.57-1.062H11.687l-0.2-.757,1.842-1.976H10.38V4h4.513V4.9l-1.9,1.966A1.974,1.974,0,0,1,15,8.807v0.02A2.191,2.191,0,0,1,12.612,11,3.224,3.224,0,0,1,10,9.791Z'/></svg>"},"images/formatting/percentage.svg":{result:"<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'><path d='M3,5.528V5.5A2.319,2.319,0,0,1,5.2,3,2.29,2.29,0,0,1,7.383,5.472V5.5A2.319,2.319,0,0,1,5.178,8,2.29,2.29,0,0,1,3,5.528Zm7.742-2.417h1.315l-6.8,9.777H3.943ZM6.2,5.528V5.5A1.253,1.253,0,0,0,5.178,4.075a1.206,1.206,0,0,0-1,1.4V5.5A1.245,1.245,0,0,0,5.2,6.925,1.205,1.205,0,0,0,6.2,5.528Zm2.416,5V10.5A2.32,2.32,0,0,1,10.822,8,2.29,2.29,0,0,1,13,10.473V10.5A2.319,2.319,0,0,1,10.8,13,2.29,2.29,0,0,1,8.617,10.529Zm3.2,0V10.5A1.254,1.254,0,0,0,10.8,9.076a1.205,1.205,0,0,0-1,1.4V10.5a1.244,1.244,0,0,0,1.022,1.425A1.206,1.206,0,0,0,11.818,10.529Z'/></svg>"},"images/formatting/scientific.svg":{result:"<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'><polygon points='4.059 5 2 5.596 2.285 6.589 3.664 6.241 3.664 12 5 12 5 5 4.059 5'/><path d='M9.01,5C7.2,5,6,6.566,6,8.5V8.519C6,10.453,7.18,12,8.99,12S12,10.433,12,8.5V8.481C12,6.547,10.81,5,9.01,5Zm1.741,3.519c0,1.334-.669,2.408-1.741,2.408S7.25,9.834,7.25,8.5V8.481c0-1.344.679-2.408,1.74-2.408S10.752,7.166,10.752,8.5V8.519Z'/><polygon points='15 3.812 14.188 3 13 4.188 11.812 3 11 3.812 12.188 5 11 6.188 11.812 7 13 5.812 14.188 7 15 6.188 13.812 5 15 3.812'/></svg>"},"images/formatting/time.svg":{result:"<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'><path d='M8,2a6,6,0,1,0,6,6A6,6,0,0,0,8,2Zm3,7H7V4H8V8h3V9Z'/></svg>"},"images/formatting/timespan.svg":{result:"<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'><path d='M1,8.017V8C1,6.343,2,5,3.508,5S6,6.326,6,7.984V8c0,1.658-1,3-2.508,3S1,9.674,1,8.017Zm3.959,0V8c0-1.144-.582-2.08-1.468-2.08s-1.451.912-1.451,2.063V8c0,1.143.574,2.081,1.467,2.081S4.959,9.16,4.959,8.017Z'/><path d='M11,7h1V8H11V7Zm0,2h1v1H11V9Z'/><path d='M14.109,6.063l-0.919.3L13,5.51,14.372,5H15v6H14.109V6.063Z'/><rect x='7' y='7' width='1' height='1'/><path d='M7,9H8v1H7V9Z'/><path d='M9.11,6.063l-0.92.3L8,5.51,9.373,5H10v6H9.11V6.063Z'/></svg>"},"images/legend/bar.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' viewBox='0 0 12 12' enable-background='new 0 0 12 12' xml:space='preserve'><g fill='currentColor'><rect x='1' y='8' width='3' height='4'/><rect x='5' y='5' width='3' height='7'/><rect x='9' y='1' width='3' height='11'/></g><g stroke='black' fill='none' stroke-width='1' stroke-opacity='0.25' ><rect x='1.5' y='8.5' width='2' height='3'/><rect x='5.5' y='5.5' width='2' height='6'/><rect x='9.5' y='1.5' width='2' height='10'/></g></svg>"},"images/legend/line.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 12 12' enable-background='new 0 0 12 12' xml:space='preserve'><g fill='currentColor'><polygon points='10.443,2 7.718,6.045 5.371,4.337 3.815,3.204 2.725,4.822 0,8.867 1.557,10 4.281,5.955 8.173,8.787 8.185,8.796 12,3.133'/></g><g fill='#000000' opacity='0.5'><path d='M10.443,2L7.718,6.045L5.371,4.337L3.815,3.204l-1.09,1.618L0,8.867L1.557,10l2.725-4.045l3.892,2.832l0.012,0.009 L12,3.133L10.443,2z M8.06,8.087L4.576,5.551L4.156,5.245l-0.29,0.43L1.432,9.291L0.684,8.746L3.14,5.101l0.8-1.188l1.137,0.828 l2.347,1.708l0.419,0.305l0.29-0.43l2.435-3.615l0.748,0.544L8.06,8.087z'/></g></svg>"},"images/legend/shapes/circle.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 12 12' enable-background='new 0 0 12 12' xml:space='preserve'><g fill='#ffffff' class='shape-fill'><circle cx='6' cy='6' r='5.5' /></g><g fill='currentColor' opacity='0.7' class='shape-fill'><circle cx='6' cy='6' r='5.5' /></g><g stroke='currentColor' fill='none' stroke-width='1'><circle cx='6' cy='6' r='5.5' /></g></svg>"},"images/legend/shapes/cross.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 12 12' enable-background='new 0 0 12 12' xml:space='preserve'><g fill='#ffffff' class='shape-fill'><polygon points='3.18,1.04 6,3.87 8.82,1.04 10.96,3.18 8.13,6 10.96,8.82 8.82,10.96 6,8.13 3.18,10.96 1.04,8.82 3.87,6 1.04,3.18' /></g><g fill='currentColor' opacity='0.7' class='shape-fill'><polygon points='3.18,1.04 6,3.87 8.82,1.04 10.96,3.18 8.13,6 10.96,8.82 8.82,10.96 6,8.13 3.18,10.96 1.04,8.82 3.87,6 1.04,3.18' /></g><g stroke='currentColor' fill='none' stroke-width='1'><polygon points='3.18,1.04 6,3.87 8.82,1.04 10.96,3.18 8.13,6 10.96,8.82 8.82,10.96 6,8.13 3.18,10.96 1.04,8.82 3.87,6 1.04,3.18' /></g></svg>"},"images/legend/shapes/crossline.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 12 12' enable-background='new 0 0 12 12' xml:space='preserve'><g stroke='currentColor' fill='none' stroke-width='1'><line x1='0.5' x2='10.5' y1='0.5' y2='10.5' /><line y1='10.5' y2='0.5' x1='0.5' x2='10.5' /></g></svg>"},"images/legend/shapes/diamond.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 12 12' enable-background='new 0 0 12 12' xml:space='preserve'><g fill='#ffffff' class='shape-fill'><polygon points='6,0.7071 11.2929,6 6,11.2929 0.7071,6' /></g><g fill='currentColor' opacity='0.7' class='shape-fill'><polygon points='6,0.7071 11.2929,6 6,11.2929 0.7071,6' /></g><g stroke='currentColor' fill='none' stroke-width='1'><polygon points='6,0.7071 11.2929,6 6,11.2929 0.7071,6' /></g></svg>"},"images/legend/shapes/downpointingarrow.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 12 12' enable-background='new 0 0 12 12' xml:space='preserve'><g transform='rotate(180 6 6)'><g fill='#ffffff' class='shape-fill'><polygon points='5.5,0.7 10.5,5.5 7.5,5.5 7.5,11.5 3.5,11.5 3.5,5.5 0.5,5.5' /></g><g fill='currentColor' opacity='0.7' class='shape-fill'><polygon points='5.5,0.7 10.5,5.5 7.5,5.5 7.5,11.5 3.5,11.5 3.5,5.5 0.5,5.5' /></g><g stroke='currentColor' fill='none' stroke-width='1'><polygon points='5.5,0.7 10.5,5.5 7.5,5.5 7.5,11.5 3.5,11.5 3.5,5.5 0.5,5.5' /></g></g></svg>"},"images/legend/shapes/downpointingarrowline.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 12 12' enable-background='new 0 0 12 12' xml:space='preserve'><g stroke='currentColor' fill='none' stroke-width='1' transform='rotate(180 6 6) translate(1 1)'><line x1='5.5' y1='0.7' x2='5.5' y2='11' /><path d='M0.5 5.5 l5 -4.8 l5 4.8' /></g></svg>"},"images/legend/shapes/horizontalline.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 12 12' enable-background='new 0 0 12 12' xml:space='preserve'><g stroke='currentColor' fill='none' stroke-width='1'><line x1='0' x2='12' y1='5.5' y2='5.5' /></g></svg>"},"images/legend/shapes/horizontalrectangle.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 12 12' enable-background='new 0 0 12 12' xml:space='preserve'><g fill='#ffffff' class='shape-fill'><polygon points='11.5,4.5 11.5,7.5 0.5,7.5 0.5,4.5' /></g><g fill='currentColor' opacity='0.7' class='shape-fill'><polygon points='11.5,4.5 11.5,7.5 0.5,7.5 0.5,4.5' /></g><g stroke='currentColor' fill='none' stroke-width='1'><polygon points='11.5,4.5 11.5,7.5 0.5,7.5 0.5,4.5' /></g></svg>"},"images/legend/shapes/leftpointingarrow.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 12 12' enable-background='new 0 0 12 12' xml:space='preserve'><g transform='rotate(270 6 6)'><g fill='#ffffff' class='shape-fill'><polygon points='5.5,0.7 10.5,5.5 7.5,5.5 7.5,11.5 3.5,11.5 3.5,5.5 0.5,5.5' /></g><g fill='currentColor' opacity='0.7' class='shape-fill'><polygon points='5.5,0.7 10.5,5.5 7.5,5.5 7.5,11.5 3.5,11.5 3.5,5.5 0.5,5.5' /></g><g stroke='currentColor' fill='none' stroke-width='1'><polygon points='5.5,0.7 10.5,5.5 7.5,5.5 7.5,11.5 3.5,11.5 3.5,5.5 0.5,5.5' /></g></g></svg>"},"images/legend/shapes/leftpointingarrowline.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 12 12' enable-background='new 0 0 12 12' xml:space='preserve'><g stroke='currentColor' fill='none' stroke-width='1' transform='rotate(270 6 6) translate(1 0)'><line x1='5.5' y1='0.7' x2='5.5' y2='11' /><path d='M0.5 5.5 l5 -4.8 l5 4.8' /></g></svg>"},"images/legend/shapes/pentagon.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 12 12' enable-background='new 0 0 12 12' xml:space='preserve'><g fill='#ffffff' class='shape-fill'><polygon points='5.5,1 0.27,4.80 2.27,10.95 8.73,10.94 10.73,4.90' /></g><g fill='currentColor' opacity='0.7' class='shape-fill'><polygon points='5.5,1 0.27,4.80 2.27,10.95 8.73,10.94 10.73,4.90' /></g><g stroke='currentColor' fill='none' stroke-width='0.8'><polygon points='5.5,1 0.27,4.80 2.27,10.95 8.73,10.94 10.73,4.90' /></g></svg>"},"images/legend/shapes/plus.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 12 12' enable-background='new 0 0 12 12' xml:space='preserve'><g fill='#ffffff' class='shape-fill'><polygon points='4.5,0.5 7.5,0.5 7.5,4.5 11.5,4.5 11.5,7.5 7.5,7.5 7.5,11.5 4.5,11.5 4.5,7.5 0.5,7.5 0.5,4.5 4.5,4.5' /></g><g fill='currentColor' opacity='0.7' class='shape-fill'><polygon points='4.5,0.5 7.5,0.5 7.5,4.5 11.5,4.5 11.5,7.5 7.5,7.5 7.5,11.5 4.5,11.5 4.5,7.5 0.5,7.5 0.5,4.5 4.5,4.5' /></g><g stroke='currentColor' fill='none' stroke-width='1'><polygon points='4.5,0.5 7.5,0.5 7.5,4.5 11.5,4.5 11.5,7.5 7.5,7.5 7.5,11.5 4.5,11.5 4.5,7.5 0.5,7.5 0.5,4.5 4.5,4.5' /></g></svg>"},"images/legend/shapes/plusline.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 12 12' enable-background='new 0 0 12 12' xml:space='preserve'><g stroke='currentColor' fill='none' stroke-width='1'><line x1='0' x2='11' y1='5.5' y2='5.5' /><line y1='0' y2='11' x1='5.5' x2='5.5' /></g></svg>"},"images/legend/shapes/rightpointingarrow.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 12 12' enable-background='new 0 0 12 12' xml:space='preserve'><g transform='rotate(90 6 6)'><g fill='#ffffff' class='shape-fill'><polygon points='5.5,0.7 10.5,5.5 7.5,5.5 7.5,11.5 3.5,11.5 3.5,5.5 0.5,5.5' /></g><g fill='currentColor' opacity='0.7' class='shape-fill'><polygon points='5.5,0.7 10.5,5.5 7.5,5.5 7.5,11.5 3.5,11.5 3.5,5.5 0.5,5.5' /></g><g stroke='currentColor' fill='none' stroke-width='1'><polygon points='5.5,0.7 10.5,5.5 7.5,5.5 7.5,11.5 3.5,11.5 3.5,5.5 0.5,5.5' /></g></g></svg>"},"images/legend/shapes/rightpointingarrowline.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 12 12' enable-background='new 0 0 12 12' xml:space='preserve'><g stroke='currentColor' fill='none' stroke-width='1' transform='rotate(90 6 6)'><line x1='5.5' y1='0.7' x2='5.5' y2='11' /><path d='M0.5 5.5 l5 -4.8 l5 4.8' /></g></svg>"},"images/legend/shapes/square.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 12 12' enable-background='new 0 0 12 12' xml:space='preserve'><g fill='#ffffff' class='shape-fill'><rect x='0.5' y='0.5' width='11' height='11'/></g><g fill='currentColor' opacity='0.7' class='shape-fill'><rect x='0.5' y='0.5' width='11' height='11'/></g><g stroke='currentColor' fill='none' stroke-width='1'><rect x='0.5' y='0.5' width='11' height='11'/></g></svg>"},"images/legend/shapes/starfive.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 12 12' enable-background='new 0 0 12 12' xml:space='preserve'><g fill='#ffffff' class='shape-fill'><polygon points='5.5,1 3.85,4.23 0.27,4.80 2.84,7.37 2.27,10.95 5.5,9.3 8.73,10.94 8.16,7.37 10.73,4.90 7.14,4.23' /></g><g fill='currentColor' opacity='0.7' class='shape-fill'><polygon points='5.5,1 3.85,4.23 0.27,4.80 2.84,7.37 2.27,10.95 5.5,9.3 8.73,10.94 8.16,7.37 10.73,4.90 7.14,4.23' /></g><g stroke='currentColor' fill='none' stroke-width='0.8'><polygon points='5.5,1 3.85,4.23 0.27,4.80 2.84,7.37 2.27,10.95 5.5,9.3 8.73,10.94 8.16,7.37 10.73,4.90 7.14,4.23' /></g></svg>"},"images/legend/shapes/starfour.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 12 12' enable-background='new 0 0 12 12' xml:space='preserve'><g fill='#ffffff' class='shape-fill'><polygon points='5.5,0.5 6.8,4.2 10.5,5.5 6.8,6.8 5.5,10.5,4.2,6.8 0.5,5.5 4.2,4.2 ' /></g><g fill='currentColor' opacity='0.7' class='shape-fill'><polygon points='5.5,0.5 6.8,4.2 10.5,5.5 6.8,6.8 5.5,10.5,4.2,6.8 0.5,5.5 4.2,4.2 ' /></g><g stroke='currentColor' fill='none' stroke-width='0.8'><polygon points='5.5,0.5 6.8,4.2 10.5,5.5 6.8,6.8 5.5,10.5,4.2,6.8 0.5,5.5 4.2,4.2 ' /></g></svg>"},"images/legend/shapes/starsixline.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 12 12' enable-background='new 0 0 12 12' xml:space='preserve'><g stroke='currentColor' fill='none' stroke-width='1' transform='translate(0.5)'><line x1='5.5' y1='0' x2='5.5' y2='11' /><line x1='0.74' y1='2.75' x2='10.26' y2='8.25' /><line x1='0.74' y1='8.25' x2='10.26' y2='2.75' /></g></svg>"},"images/legend/shapes/triangledown.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 12 12' enable-background='new 0 0 12 12' xml:space='preserve'><g fill='#ffffff' class='shape-fill'><polygon points='1,2.5 11,2.5 6,10' /></g><g fill='currentColor' opacity='0.7' class='shape-fill'><polygon points='1,2.5 11,2.5 6,10' /></g><g stroke='currentColor' fill='none' stroke-width='1'><polygon points='1,2.5 11,2.5 6,10' /></g></svg>"},"images/legend/shapes/triangleleft.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 12 12' enable-background='new 0 0 12 12' xml:space='preserve'><g fill='#ffffff' class='shape-fill'><polygon points='9.5,1 9.5,11 2,6' /></g><g fill='currentColor' opacity='0.7' class='shape-fill'><polygon points='9.5,1 9.5,11 2,6' /></g><g stroke='currentColor' fill='none' stroke-width='1'><polygon points='9.5,1 9.5,11 2,6' /></g></svg>"},"images/legend/shapes/triangleright.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 12 12' enable-background='new 0 0 12 12' xml:space='preserve'><g fill='#ffffff' class='shape-fill'><polygon points='2.5,1 10,6 2.5,11' /></g><g fill='currentColor' opacity='0.7' class='shape-fill'><polygon points='2.5,1 10,6 2.5,11' /></g><g stroke='currentColor' fill='none' stroke-width='1'><polygon points='2.5,1 10,6 2.5,11' /></g></svg>"},"images/legend/shapes/triangleup.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 12 12' enable-background='new 0 0 12 12' xml:space='preserve'><g fill='#ffffff' class='shape-fill'><polygon points='6,2 11,9.5 1,9.5' /></g><g fill='currentColor' opacity='0.7' class='shape-fill'><polygon points='6,2 11,9.5 1,9.5' /></g><g stroke='currentColor' fill='none' stroke-width='1'><polygon points='6,2 11,9.5 1,9.5' /></g></svg>"},"images/legend/shapes/uppointingarrow.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 12 12' enable-background='new 0 0 12 12' xml:space='preserve'><g fill='#ffffff' class='shape-fill'><polygon points='5.5,0.7 10.5,5.5 7.5,5.5 7.5,11.5 3.5,11.5 3.5,5.5 0.5,5.5' /></g><g fill='currentColor' opacity='0.7' class='shape-fill'><polygon points='5.5,0.7 10.5,5.5 7.5,5.5 7.5,11.5 3.5,11.5 3.5,5.5 0.5,5.5' /></g><g stroke='currentColor' fill='none' stroke-width='1'><polygon points='5.5,0.7 10.5,5.5 7.5,5.5 7.5,11.5 3.5,11.5 3.5,5.5 0.5,5.5' /></g></svg>"},"images/legend/shapes/uppointingarrowline.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 12 12' enable-background='new 0 0 12 12' xml:space='preserve'><g stroke='currentColor' fill='none' stroke-width='1'><line x1='5.5' y1='0.7' x2='5.5' y2='11' /><path d='M0.5 5.5 l5 -4.8 l5 4.8' /></g></svg>"},"images/legend/shapes/verticalline.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 12 12' enable-background='new 0 0 12 12' xml:space='preserve'><g stroke='currentColor' fill='none' stroke-width='1'><line y1='0' y2='12' x1='5.5' x2='5.5' /></g></svg>"},"images/legend/shapes/verticalrectangle.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 12 12' enable-background='new 0 0 12 12' xml:space='preserve'><g fill='#ffffff' class='shape-fill'><polygon points='4.5,0.5 7.5,0.5 7.5,11.5 4.5,11.5' /></g><g fill='currentColor' opacity='0.7' class='shape-fill'><polygon points='4.5,0.5 7.5,0.5 7.5,11.5 4.5,11.5' /></g><g stroke='currentColor' fill='none' stroke-width='1'><polygon points='4.5,0.5 7.5,0.5 7.5,11.5 4.5,11.5' /></g></svg>"},"images/navigationbar3d/reset.svg":{result:"<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 14 14'><path style='fill:currentColor' d='M10.965,4.373L13,6.425V1H7.622L9.643,3.039,7.7,5H6.283L4.359,3.048,6.425,1H1V6.378L3.025,4.37,5,6.375V7.658L3.038,9.63,1,7.574V13H6.378L4.361,10.964,6.316,9H7.674l1.958,1.959L7.574,13H13V7.622L10.967,9.636,9,7.667v-1.3ZM8,8H6V6H8V8Z' /></svg>"},"images/navigationbar3d/rotatedown.svg":{result:"<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 14 14'><g style='opacity:0.4'><rect style='fill:currentColor' y='6' width='14' height='1'/></g><path style='fill:currentColor' d='M10,6.3A7.6,7.6,0,0,0,6.336,0l-1.2,1.566A5.736,5.736,0,0,1,7.934,6.3a5.744,5.744,0,0,1-2.771,4.708L3,9v5H8.378L6.646,12.39A7.542,7.542,0,0,0,10,6.3Z'/></svg>"},"images/navigationbar3d/rotateleft.svg":{result:"<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 14 14'><g style='opacity:0.4'><rect style='fill:currentColor' x='7' width='1' height='14'/></g><path style='fill:currentColor' d='M12.434,5.139A5.736,5.736,0,0,1,7.7,7.933,5.744,5.744,0,0,1,2.989,5.162L5,3H0V8.378L1.61,6.646A7.542,7.542,0,0,0,7.7,10,7.6,7.6,0,0,0,14,6.335Z'/></svg>"},"images/navigationbar3d/rotateright.svg":{result:"<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 14 14'><g style='opacity:0.4'><rect style='fill:currentColor' x='6' width='1' height='14'/></g><path style='fill:currentColor' d='M9,3l2.011,2.162A5.744,5.744,0,0,1,6.3,7.934,5.736,5.736,0,0,1,1.566,5.14L0,6.336A7.6,7.6,0,0,0,6.3,10,7.542,7.542,0,0,0,12.39,6.647L14,8.379V3H9Z'/></svg>"},"images/navigationbar3d/rotateup.svg":{result:"<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 14 14'><g style='opacity:0.4'><rect style='fill:currentColor' y='7' width='14' height='1'/></g><path style='fill:currentColor' d='M7.838,2.989L10,5V0H4.622L6.354,1.61A7.542,7.542,0,0,0,3,7.7,7.6,7.6,0,0,0,6.665,14l1.2-1.566A5.736,5.736,0,0,1,5.067,7.7,5.744,5.744,0,0,1,7.838,2.989Z'/></svg>"},"images/navigationbar3d/zoomin.svg":{result:"<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 14 14'><path style='fill:currentColor' d='M7.965,0A6.031,6.031,0,0,0,3.02,9.49l-3.02,3L1.481,14l3.033-3.017A6.034,6.034,0,1,0,7.965,0Zm0,10.347a4.311,4.311,0,1,1,4.311-4.311A4.316,4.316,0,0,1,7.965,10.347Z'/><path style='fill:currentColor' d='M9,9H7V7H9V9Z' /><path style='fill:currentColor' d='M9,7H7V5H9V7Z' /><path style='fill:currentColor' d='M11,7H9V5h2V7Z' /><path style='fill:currentColor' d='M7,7H5V5H7V7Z' /><path style='fill:currentColor' d='M9,5H7V3H9V5Z' /></svg>"},"images/navigationbar3d/zoomout.svg":{result:"<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 14 14'><rect style='fill:currentColor' x='5' y='5' width='6' height='2'/><path style='fill:currentColor' d='M7.965,0A6.031,6.031,0,0,0,3.02,9.49l-3.02,3L1.481,14l3.033-3.017A6.034,6.034,0,1,0,7.965,0Zm0,10.346a4.311,4.311,0,1,1,4.311-4.311A4.316,4.316,0,0,1,7.965,10.346Z'/></svg>"},"images/panel/close.svg":{result:"<svg version='1.1' xmlns:x='&ns_extend;' xmlns:i='&ns_ai;' xmlns:graph='&ns_graphs;' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' width='12px' height='12px' viewBox='0 0 12 12' enable-background='new 0 0 12 12' xml:space='preserve'><polygon fill='currentColor' points='12,1.092 10.91,0 6,4.908 1.092,0 0,1.092 4.91,6 0,10.909 1.092,12.001 6,7.093 10.91,12.001 12,10.909 7.092,6'/></svg>"},"images/panel/pindocked.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 7 7' enable-background='new 0 0 7 7' xml:space='preserve'><g fill='currentColor'><path d='M4.962,3.838l-0.81-0.589L4.15,0.902h0.592c0.141,0,0.256-0.112,0.256-0.253V0.253C4.998,0.115,4.884,0,4.743,0H1.257 C1.115,0,1,0.113,1,0.253v0.396c0,0.139,0.115,0.253,0.257,0.253h0.611v2.346L1.039,3.836c-0.024,0.023-0.038,0.055-0.038,0.09 c0,0.07,0.057,0.142,0.128,0.142h1.641v2.237L2.992,7l0.243-0.698V4.068h1.636C4.943,4.068,5,3.997,5,3.927 C5,3.892,4.986,3.861,4.962,3.838z'/></g></svg>"},"images/panel/pinundocked.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 7 7' enable-background='new 0 0 7 7' xml:space='preserve'><g fill='currentColor'><path d='M6.942,2.997L4.395,0.095c-0.1-0.1-0.3-0.15-0.4,0l-0.35,0.3c-0.1,0.1-0.1,0.3,0,0.4l0.449,0.5L2.198,3.147l-1.049-0.25 c-0.05,0-0.05,0-0.1,0.05c-0.1,0.05-0.1,0.15-0.05,0.2l1.199,1.351L0.4,6.249L0,7l0.749-0.35l1.798-1.751L3.746,6.25 c0.05,0.05,0.15,0.05,0.2,0s0.05-0.05,0.05-0.1l-0.1-1.151l1.898-1.851l0.45,0.5c0.1,0.1,0.3,0.15,0.4,0l0.3-0.3 C6.992,3.297,7.042,3.147,6.942,2.997z'/></g></svg>"},"images/panel/resetfilters.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='3 -4 13 14' enable-background='new 3 -4 13 14' xml:space='preserve'><g fill='currentColor'><path d='M9.64-2.219C9.608-2.219,9.575-2.22,9.542-2.22V-4L5.205-1.483l4.338,2.515v-1.814c0.027,0,0.055,0.001,0.082,0.001 c2.68,0.065,4.841,2.132,4.841,4.67c0,2.576-2.23,4.674-4.97,4.674c-2.743,0-4.973-2.098-4.973-4.674H2.995 C2.995,7.258,5.912,10,9.496,10c3.581,0,6.498-2.742,6.498-6.111C15.994,0.566,13.155-2.146,9.64-2.219z'/></g></svg>"},"images/panel/filteroverview/arrowdown.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 13 8' enable-background='new 0 0 13 8' xml:space='preserve'><g id='Lager_1'><polygon fill='currentColor' points='6.455,8 0,0.948 1.017,0.004 6.462,5.953 11.99,0 13,0.951 '/></g><g id='Lager_2'></g></svg>"},"images/panel/filteroverview/arrowup.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 13 8' enable-background='new 0 0 13 8' xml:space='preserve'><g id='Lager_1'><polygon fill='currentColor' points='6.545,0 13,7.052 11.983,7.996 6.538,2.047 1.01,8 0,7.049 '/></g><g id='Lager_2'></g></svg>"},"images/panel/filteroverview/cirklearrow.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 10 12' enable-background='new 0 0 10 12' xml:space='preserve'><path fill='currentColor' d='M10,7.056c0-2.713-2.225-4.922-4.963-4.942V0L1.701,2.711l3.337,2.813V3.278 c2.091,0.02,3.787,1.706,3.787,3.779c0,2.084-1.715,3.781-3.823,3.781c-2.11,0-3.826-1.697-3.826-3.781H0C0,9.782,2.244,12,5.002,12 C7.756,12,10,9.782,10,7.056z'/></svg>"},"images/panel/filteroverview/resetfilter.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 13 13' enable-background='new 0 0 13 13' xml:space='preserve'><g id='Lager_2'><g><g><circle class='sf-element sf-element-svg-element sfc-reset-circle' fill='currentColor' cx='6.5' cy='6.5' r='6.5'/></g></g></g><g id='Lager_4'><g><g><polygon class='sf-element sf-element-svg-element sfc-reset-cross' fill='currentColor' points='7.713,6.503 10,4.214 8.787,3 6.5,5.289 4.213,3 3,4.214 5.287,6.503 3.006,8.786 4.219,10 6.5,7.717 8.781,10 9.994,8.786 7.713,6.503 '/></g></g></g></svg>"},"images/plots/webmapchart/eye.svg":{result:"<svg data-name='Layer 1' xmlns='http://www.w3.org/2000/svg' viewBox='0 0 15 14'><g transform='translate(0 3) scale(0.15)'><path d='M48.19,0C21.58,0,0,22.85,0,22.85S21.56,45.72,48.17,45.73,96.36,22.89,96.36,22.89,74.8,0,48.19,0Zm0,39.39A16.52,16.52,0,1,1,64.7,22.87,16.52,16.52,0,0,1,48.18,39.39Z'/><circle cx='48.18' cy='22.87' r='11.59'/></g></svg>"},"images/plots/webmapchart/eye_close.svg":{result:"<svg data-name='Layer 1' xmlns='http://www.w3.org/2000/svg' viewBox='0 0 15 14' ><g transform='translate(0 1.5) scale(0.15)'><rect x='4.76' y='29.56' width='86.31' height='6.5' transform='translate(-9.17 43.48) rotate(-44.99)'/><path d='M50.59,21.61A11.49,11.49,0,0,0,36.72,35.48Z'/><path d='M45.25,44A11.49,11.49,0,0,0,59.12,30.14Z'/><path d='M32.85,39.35A16.42,16.42,0,0,1,54.46,17.74l6-6a50.57,50.57,0,0,0-12.55-1.65C21.46,10.06,0,32.79,0,32.79A88,88,0,0,0,22.94,49.26Z'/><path d='M72.9,16.36,63,26.27A16.42,16.42,0,0,1,41.38,47.88l-6,6a50.52,50.52,0,0,0,12.55,1.65c26.46,0,47.93-22.72,47.93-22.72A88,88,0,0,0,72.9,16.36Z'/></g></svg>"},"images/plots/webmapchart/layerhandlerwidget/eye.svg":{result:"<svg version='1.1' width='16' height='10' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'><g transform='scale(1.1)'><g><path class='background' d='M7.2,8.4c-0.5,0-0.9,0-1.4-0.1C4.6,8,3.3,7.3,2,6.2c-0.6-0.5-1.1-1-1.5-1.4c-0.3-0.3-0.3-0.7,0-1 c0.1-0.2,0.3-0.3,0.5-0.5c0.9-0.9,1.9-1.6,2.9-2.2c0.8-0.4,1.5-0.7,2.2-0.8c0.4-0.1,0.8-0.1,1.2-0.1c0.5,0,0.9,0,1.4,0.1 c1.3,0.3,2.6,0.9,3.9,2c0.6,0.5,1.1,1,1.5,1.4c0.1,0.1,0.2,0.2,0.2,0.4l0,0.1l0,0.1c0,0.2-0.1,0.3-0.2,0.4 c-0.1,0.2-0.3,0.3-0.5,0.5c-0.9,0.9-1.9,1.6-2.9,2.2C9.9,7.9,9.1,8.1,8.4,8.3C8,8.3,7.6,8.4,7.2,8.4z M7.3,2C6,2,4.9,3,4.9,4.3 c0,1.3,1.1,2.3,2.3,2.3c1.3,0,2.3-1.1,2.3-2.3C9.6,3,8.5,2,7.3,2z' /></g><circle class='background' cx='7.3' cy='4.3' r='0.9' /></g></svg>"},"images/plots/webmapchart/layerhandlerwidget/pointer.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' width='10' height='16' xml:space='preserve'><g><path class='background' d='M6.1,15c-0.1,0-0.3,0-0.4-0.1c-0.2-0.1-0.4-0.3-0.5-0.5L4,11.1C3.9,11,3.9,11,3.8,11c0,0,0,0-0.1,0 c-0.1,0-0.1,0-0.2,0.1l-1.7,1.3c-0.2,0.2-0.4,0.2-0.6,0.2c-0.1,0-0.2,0-0.3-0.1c-0.3-0.1-0.5-0.5-0.5-0.9l0-10.2 c0-0.5,0.2-0.7,0.3-0.8C1,0.5,1.1,0.5,1.2,0.5c0.1,0,0.2,0,0.3,0.1c0.1,0.1,0.3,0.2,0.4,0.3l6.8,7.3C9,8.5,9.1,8.8,9,9.2 S8.6,9.7,8.2,9.7L6,10C6,10,5.9,10,5.9,10.1s0,0.1,0,0.2l1.3,3.3c0.1,0.2,0.1,0.5,0,0.8c-0.1,0.3-0.3,0.5-0.6,0.6 C6.4,15,6.3,15,6.1,15z' /><path class='border' d='M1.2,0.7c0.1,0,0.1,0,0.2,0c0.1,0,0.2,0.1,0.3,0.2l6.8,7.3c0.1,0.1,0.3,0.4,0.2,0.7C8.6,9.4,8.3,9.5,8.1,9.5 L6,9.7c-0.2,0-0.3,0.1-0.4,0.2c-0.1,0.1-0.1,0.3,0,0.4l1.3,3.3c0.1,0.2,0.1,0.4,0,0.6c-0.1,0.2-0.2,0.4-0.4,0.4 c-0.1,0-0.2,0.1-0.3,0.1c-0.1,0-0.2,0-0.3-0.1c-0.2-0.1-0.3-0.2-0.4-0.4L4.2,11c-0.1-0.1-0.2-0.3-0.3-0.3c0,0-0.1,0-0.1,0 c-0.1,0-0.2,0-0.3,0.1l-1.7,1.3c-0.2,0.1-0.3,0.2-0.5,0.2c-0.1,0-0.1,0-0.2,0c-0.2-0.1-0.3-0.4-0.3-0.7l0-10.2 C0.8,1,0.9,0.9,1,0.8C1.1,0.8,1.1,0.7,1.2,0.7 M1.2,0.2C1,0.2,0.9,0.3,0.7,0.4c-0.2,0.1-0.5,0.4-0.5,1l0,10.2c0,0.5,0.2,1,0.6,1.1 c0.1,0.1,0.3,0.1,0.4,0.1c0.3,0,0.5-0.1,0.8-0.3l1.7-1.3L5,14.5c0.1,0.3,0.3,0.5,0.6,0.7c0.2,0.1,0.3,0.1,0.5,0.1 c0.2,0,0.3,0,0.5-0.1c0.3-0.1,0.6-0.4,0.7-0.7c0.1-0.3,0.1-0.6,0-1l-1.3-3.3L8.2,10c0.5-0.1,0.9-0.3,1-0.7c0.1-0.4,0-0.9-0.3-1.2 L2.1,0.7C1.9,0.5,1.8,0.4,1.6,0.3C1.5,0.3,1.3,0.2,1.2,0.2L1.2,0.2z' /></g></svg>"},"images/plots/webmapchart/navigationwidget/cursor.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' width='10' height='16' xml:space='preserve'><filter id='f1' x='-1' y='-1' width='3' height='3'><feColorMatrix in='SourceGraphic' result='colorOut' values='0 0 0 0 0, 0 0 0 0 0, 0 0 0 0 0, 0 0 0 0.2 0'></feColorMatrix><feGaussianBlur in='colorOut' result='blurOut' stdDeviation='1'></feGaussianBlur><feBlend in='SourceGraphic' in2='blurOut'></feBlend></filter><g filter='url(#f1)'><path class='background' d='M6.1,15c-0.1,0-0.3,0-0.4-0.1c-0.2-0.1-0.4-0.3-0.5-0.5L4,11.1C3.9,11,3.9,11,3.8,11c0,0,0,0-0.1,0 c-0.1,0-0.1,0-0.2,0.1l-1.7,1.3c-0.2,0.2-0.4,0.2-0.6,0.2c-0.1,0-0.2,0-0.3-0.1c-0.3-0.1-0.5-0.5-0.5-0.9l0-10.2 c0-0.5,0.2-0.7,0.3-0.8C1,0.5,1.1,0.5,1.2,0.5c0.1,0,0.2,0,0.3,0.1c0.1,0.1,0.3,0.2,0.4,0.3l6.8,7.3C9,8.5,9.1,8.8,9,9.2 S8.6,9.7,8.2,9.7L6,10C6,10,5.9,10,5.9,10.1s0,0.1,0,0.2l1.3,3.3c0.1,0.2,0.1,0.5,0,0.8c-0.1,0.3-0.3,0.5-0.6,0.6 C6.4,15,6.3,15,6.1,15z'/><path class='border' d='M1.2,0.7c0.1,0,0.1,0,0.2,0c0.1,0,0.2,0.1,0.3,0.2l6.8,7.3c0.1,0.1,0.3,0.4,0.2,0.7C8.6,9.4,8.3,9.5,8.1,9.5 L6,9.7c-0.2,0-0.3,0.1-0.4,0.2c-0.1,0.1-0.1,0.3,0,0.4l1.3,3.3c0.1,0.2,0.1,0.4,0,0.6c-0.1,0.2-0.2,0.4-0.4,0.4 c-0.1,0-0.2,0.1-0.3,0.1c-0.1,0-0.2,0-0.3-0.1c-0.2-0.1-0.3-0.2-0.4-0.4L4.2,11c-0.1-0.1-0.2-0.3-0.3-0.3c0,0-0.1,0-0.1,0 c-0.1,0-0.2,0-0.3,0.1l-1.7,1.3c-0.2,0.1-0.3,0.2-0.5,0.2c-0.1,0-0.1,0-0.2,0c-0.2-0.1-0.3-0.4-0.3-0.7l0-10.2 C0.8,1,0.9,0.9,1,0.8C1.1,0.8,1.1,0.7,1.2,0.7 M1.2,0.2C1,0.2,0.9,0.3,0.7,0.4c-0.2,0.1-0.5,0.4-0.5,1l0,10.2c0,0.5,0.2,1,0.6,1.1 c0.1,0.1,0.3,0.1,0.4,0.1c0.3,0,0.5-0.1,0.8-0.3l1.7-1.3L5,14.5c0.1,0.3,0.3,0.5,0.6,0.7c0.2,0.1,0.3,0.1,0.5,0.1 c0.2,0,0.3,0,0.5-0.1c0.3-0.1,0.6-0.4,0.7-0.7c0.1-0.3,0.1-0.6,0-1l-1.3-3.3L8.2,10c0.5-0.1,0.9-0.3,1-0.7c0.1-0.4,0-0.9-0.3-1.2 L2.1,0.7C1.9,0.5,1.8,0.4,1.6,0.3C1.5,0.3,1.3,0.2,1.2,0.2L1.2,0.2z'/></g></svg>"},"images/plots/webmapchart/navigationwidget/down.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' width='12' height='8' xml:space='preserve'><path fill='currentColor' d='M5.6,7.8c0.2,0.3,0.6,0.3,0.9,0l5.4-6.4c0.3-0.3,0.3-0.8,0-1.1s-0.7-0.3-1,0L6.4,5.5c-0.2,0.3-0.6,0.3-0.9,0 L1.2,0.2c-0.3-0.3-0.7-0.3-1,0s-0.3,0.8,0,1.1L5.6,7.8z'/></svg>"},"images/plots/webmapchart/navigationwidget/hand.svg":{result:"<svg version='1.1' width='11' height='15' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' xml:space='preserve'><g><path class='background' d='M9.4,4.3V7c0,0.2-0.2,0.3-0.4,0.3C8.8,7.3,8.7,7.2,8.6,7v-3c0-0.5-0.5-0.9-1.1-0.9c-0.1,0-0.2,0-0.3,0 c0,0,0,0,0,0v3.5C7.3,6.9,7.2,7,6.9,7S6.5,6.9,6.5,6.8V4c0,0,0,0,0,0V2.7c0-0.5-0.5-0.9-1-0.9c-0.1,0-0.2,0-0.3,0c0,0,0,0,0,0v4.7 c0,0.2-0.2,0.3-0.4,0.3c-0.2,0-0.4-0.1-0.4-0.3V1.5C4.5,1,4,0.7,3.5,0.7C3,0.7,2.6,1,2.6,1.5v5.6v1.7c0,0.2-0.2,0.3-0.4,0.3 S1.8,9,1.8,8.8V4.8c-0.6,0-1,0.4-1,0.9c0,0,0,5.1,0,5.1c0,1,2.6,2.7,2.6,3.5c0.9,0,3.9,0,5.2,0c0-0.9,1.6-2.4,1.6-3.9 c0-1.4,0-5.5,0-5.5C10.2,4.6,9.9,4.3,9.4,4.3z'/><path class='border' fill-opacity='0.8' d='M9.4,3.6L9.4,3.6C9.1,3,8.4,2.5,7.6,2.5c-0.1,0-0.2,0-0.3,0C7.2,1.7,6.4,1.1,5.5,1.1c-0.1,0-0.2,0-0.3,0 C5,0.5,4.3,0,3.5,0C2.6,0,1.8,0.7,1.8,1.5v2.6h0C0.8,4.1,0,4.8,0,5.7l0,5.1c0,0.8,0.8,1.5,1.6,2.4c0.4,0.4,1,1,1,1.2V15h0.8h5.2h0.8 v-0.7c0-0.3,0.3-0.8,0.6-1.2c0.5-0.8,1-1.7,1-2.6C11,9,11,5,11,5C11,4.2,10.3,3.6,9.4,3.6z M8.6,14.3c-1.4,0-4.3,0-5.2,0 c0-0.9-2.6-2.5-2.6-3.5c0,0,0-5.1,0-5.1c0-0.5,0.5-0.9,1-0.9v4.1C1.8,9,2,9.1,2.2,9.1S2.6,9,2.6,8.8V7.1V1.5C2.6,1,3,0.7,3.5,0.7 C4,0.7,4.5,1,4.5,1.5v5.1c0,0.1,0.2,0.3,0.4,0.3c0.2,0,0.4-0.1,0.4-0.3V1.9c0,0,0,0,0,0c0.1,0,0.2,0,0.3,0c0.6,0,1,0.4,1,0.9v1.4 c0,0,0,0,0,0v2.7C6.5,6.9,6.7,7,6.9,7s0.4-0.1,0.4-0.3V3.2c0,0,0,0,0,0c0.1,0,0.2,0,0.3,0c0.6,0,1.1,0.4,1.1,0.9v3 c0,0.1,0.2,0.3,0.4,0.3c0.2,0,0.4-0.1,0.4-0.3V4.3c0.4,0,0.8,0.3,0.8,0.7c0,0,0,4,0,5.5C10.2,11.9,8.6,13.4,8.6,14.3z'/></g></svg>"},"images/plots/webmapchart/navigationwidget/left.svg":{result:"<svg version='1.1' width='8' height='12' xmlns='http://www.w3.org/2000/svg' xml:space='preserve'><path fill='currentColor' d='M6.6,11.8c0.3,0.3,0.8,0.3,1.1,0c0.3-0.3,0.3-0.7,0-1L2.5,6.4c-0.3-0.2-0.3-0.6,0-0.9l5.3-4.4 c0.3-0.3,0.3-0.7,0-1s-0.8-0.3-1.1,0L0.2,5.6c-0.3,0.2-0.3,0.6,0,0.9L6.6,11.8z'/></svg>"},"images/plots/webmapchart/navigationwidget/markinglasso.svg":{result:"<svg version='1.1' width='14' height='15' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='-255 334 14 14' style='enable-background:new -255 334 14 14;' xml:space='preserve'><path stroke='currentColor' stroke-width='0.1' fill='currentColor' d='M-241,338.4c0-2.4-3.1-4.4-7-4.4s-7,2-7,4.4c0,2.1,2.4,3.9,5.6,4.3c0.2,0.1,0.5,0.3,0.8,0.4c-0.2,0.2-0.5,0.5-0.7,0.8 c-1.2,1.9-0.5,3.7-0.5,3.8c0.1,0.2,0.3,0.3,0.6,0.2c0.2-0.1,0.3-0.3,0.3-0.5c0,0-0.6-1.5,0.4-3.1c0.3-0.4,0.6-0.7,0.9-0.9 c0.3,0.1,0.5,0.1,0.7,0.1c0.6,0,1.2-0.4,1.3-0.9C-242.9,342-241,340.4-241,338.4z M-248,342.6c-0.3-0.1-0.6-0.3-0.6-0.4 c0-0.3,1-0.5,1.3-0.5c0.2,0,0.5,0.1,0.5,0.3C-247,342.1-247.5,342.3-248,342.6z M-245.6,341.8c-0.2-0.5-0.7-0.9-1.4-0.9 c-0.4,0-1.2,0.1-1.9,0.3l0,0c0,0,0,0,0,0c-0.1,0-0.1,0-0.2,0.1c-0.2,0-0.6,0.1-1.2-0.1c0,0,0,0,0,0c0,0,0,0,0,0 c-0.2-0.1-0.5,0-0.5,0.3c0,0.1-0.1,0.2-0.1,0.3c-2-0.6-3.3-1.8-3.3-3.2c0-2,2.8-3.6,6.2-3.6s6.2,1.6,6.2,3.6 C-241.9,340-243.4,341.3-245.6,341.8z' /></svg>"},"images/plots/webmapchart/navigationwidget/markingradius.svg":{result:"<svg width='15' height='15' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' xml:space='preserve'><circle cx='7' cy='8' r='6' fill='none' stroke='currentColor' stroke-width='1.1' /></svg>"},"images/plots/webmapchart/navigationwidget/markingrectangle.svg":{result:"<svg width='14' height='15' version='1.1' shape-rendering='crispEdges' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' xml:space='preserve'><g transform='translate(0 0.5)'><rect stroke='none' fill='currentColor' width='13' height='1'></rect><rect stroke='none' fill='currentColor' x='13' width='1' height='14'></rect><rect stroke='none' fill='currentColor' y='13' width='13' height='1'></rect><rect stroke='none' fill='currentColor' width='1' height='14'></rect></g></svg>"},"images/plots/webmapchart/navigationwidget/navmodebg.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' width='63' height='31' xml:space='preserve'><filter id='f1' x='-1' y='-1' width='3' height='3'><feColorMatrix in='SourceGraphic' result='colorOut' values='0 0 0 0 0, 0 0 0 0 0, 0 0 0 0 0, 0 0 0 0.9 0'></feColorMatrix><feGaussianBlur in='colorOut' result='blurOut' stdDeviation='1'></feGaussianBlur><feBlend in='SourceGraphic' in2='blurOut'></feBlend></filter><g transform='translate(1 1)' filter='url(#f1)'><rect id='border' fill='blue' width='59' height='29' rx='4' ry='4' /><rect class='background-left' fill='green' x='1' y='1' width='30' height='27' rx='3' ry='3' /><rect class='background-right' fill='purple' x='28.5' y='1' width='30' height='27' rx='3' ry='3' /><rect id='separator' fill='yellow' x='29' y='1' width='1' height='27' rx='3' ry='3' shape-rendering='crispEdges' /></g></svg>"},"images/plots/webmapchart/navigationwidget/navroot.svg":{result:"<svg version='1.1' width='78' height='78' xmlns='http://www.w3.org/2000/svg' xml:space='preserve'><filter id='f1' x='-1' y='-1' width='3' height='3'><feColorMatrix in='SourceGraphic' result='colorOut' values='0 0 0 0 0, 0 0 0 0 0, 0 0 0 0 0, 0 0 0 0.9 0'></feColorMatrix><feGaussianBlur in='colorOut' result='blurOut' stdDeviation='1'></feGaussianBlur><feBlend in='SourceGraphic' in2='blurOut'></feBlend></filter><circle cx='40' cy='40' r='29' filter='url(#f1)'/></svg>"},"images/plots/webmapchart/navigationwidget/reset.svg":{result:"<svg version='1.1' width='8' height='8' xmlns='http://www.w3.org/2000/svg' xml:space='preserve'><circle fill='currentColor' cx='4' cy='4' r='4'/></svg>"},"images/plots/webmapchart/navigationwidget/right.svg":{result:"<svg version='1.1' width='8' height='12' xmlns='http://www.w3.org/2000/svg' xml:space='preserve'><path fill='currentColor' d='M7.8,6.4c0.3-0.2,0.3-0.6,0-0.9L1.4,0.2c-0.3-0.3-0.8-0.3-1.1,0s-0.3,0.7,0,1l5.3,4.4c0.3,0.2,0.3,0.6,0,0.9 l-5.3,4.4c-0.3,0.3-0.3,0.7,0,1c0.3,0.3,0.8,0.3,1.1,0L7.8,6.4z'/></svg>"},"images/plots/webmapchart/navigationwidget/submenuarrow.svg":{result:"<svg width='4' height='3' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' xml:space='preserve'><g><path d='M0 0 L4 0 L2 3 Z' fill='currentColor' /></g></svg>"},"images/plots/webmapchart/navigationwidget/up.svg":{result:"<svg width='12' height='8' xmlns='http://www.w3.org/2000/svg' xml:space='preserve'><path fill='currentColor' d='M6.4,0.2c-0.2-0.3-0.6-0.3-0.9,0L0.2,6.6c-0.3,0.3-0.3,0.8,0,1.1c0.3,0.3,0.7,0.3,1,0l4.4-5.3 c0.2-0.3,0.6-0.3,0.9,0l4.4,5.3c0.3,0.3,0.7,0.3,1,0c0.3-0.3,0.3-0.8,0-1.1L6.4,0.2z'/></svg>"},"images/plots/webmapchart/navigationwidget/zoomin.svg":{result:"<svg width='26' height='26' version='1.1' xmlns='http://www.w3.org/2000/svg' xml:space='preserve'><filter id='f1' x='-1' y='-1' width='3' height='3'><feColorMatrix in='SourceGraphic' result='colorOut' values='0 0 0 0 0, 0 0 0 0 0, 0 0 0 0 0, 0 0 0 0.9 0'></feColorMatrix><feGaussianBlur in='colorOut' result='blurOut' stdDeviation='1'></feGaussianBlur><feBlend in='SourceGraphic' in2='blurOut'></feBlend></filter><g filter='url(#f1)' transform='translate(2 2)'><g id='background'><circle cx='11' cy='11' r='11'/></g><g id='center' transform='translate(6 6)'><rect x='0' y='4' width='10' height='2'></rect><rect x='4' y='0' width='2' height='10'></rect></g></g></svg>"},"images/plots/webmapchart/navigationwidget/zoomline.svg":{result:"<svg width='6' height='100' version='1.1' xmlns='http://www.w3.org/2000/svg' xml:space='preserve'><filter id='f1' x='-1' y='-1' width='3' height='3'><feColorMatrix in='SourceGraphic' result='colorOut' values='0 0 0 0 0, 0 0 0 0 0, 0 0 0 0 0, 0 0 0 0.9 0'></feColorMatrix><feGaussianBlur in='colorOut' result='blurOut' stdDeviation='1'></feGaussianBlur><feBlend in='SourceGraphic' in2='blurOut'></feBlend></filter><g id='background' filter='url(#f1)' transform='translate(2 0)'><rect x='0' y='0' width='2' height='100%'></rect></g><g id='border'><rect x='1' y='0' width='1' height='100%'></rect><rect x='4' y='0' width='1' height='100%'></rect></g></svg>"},"images/plots/webmapchart/navigationwidget/zoomout.svg":{result:"<svg width='26' height='26' version='1.1' xmlns='http://www.w3.org/2000/svg' xml:space='preserve'><filter id='f1' x='-1' y='-1' width='3' height='3'><feColorMatrix in='SourceGraphic' result='colorOut' values='0 0 0 0 0, 0 0 0 0 0, 0 0 0 0 0, 0 0 0 0.9 0'></feColorMatrix><feGaussianBlur in='colorOut' result='blurOut' stdDeviation='1'></feGaussianBlur><feBlend in='SourceGraphic' in2='blurOut'></feBlend></filter><g filter='url(#f1)' transform='translate(2 2)'><g id='background'><circle cx='11' cy='11' r='11'/></g><g id='center' transform='translate(6 6)'><rect x='0' y='4' width='10' height='2'></rect></g></g></svg>"},"images/plots/webmapchart/navigationwidget/zoomthumb.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' width='23' height='12' xml:space='preserve'><filter id='f1' x='-1' y='-1' width='3' height='3'><feColorMatrix in='SourceGraphic' result='colorOut' values='0 0 0 0 0, 0 0 0 0 0, 0 0 0 0 0, 0 0 0 0.9 0'></feColorMatrix><feGaussianBlur in='colorOut' result='blurOut' stdDeviation='1'></feGaussianBlur><feBlend in='SourceGraphic' in2='blurOut'></feBlend></filter><g filter='url(#f1)'><g><path id='background' d='M1,9.5C0.7,9.5,0.5,9.3,0.5,9V1c0-0.3,0.2-0.5,0.5-0.5h20c0.3,0,0.5,0.2,0.5,0.5v8c0,0.3-0.2,0.5-0.5,0.5H1z' /><path id='border' d='M21,1L21,1v8L1,9l0-8H21 M21,0H1C0.4,0,0,0.4,0,1v8c0,0.6,0.4,1,1,1h20c0.6,0,1-0.4,1-1V1C22,0.4,21.6,0,21,0 L21,0z'/></g><rect id='center' x='6' y='4' width='10' height='2'/></g></svg>"},"images/progress/analysisready.svg":{result:"<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 12 12' enable-background='new 0 0 12 12'><circle fill='currentColor' cx='6' cy='6' r='5.5'/></svg>"},"images/progress/circularprogressanimation.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 70 70' enable-background='new 0 0 70 70' xml:space='preserve'><g fill='currentColor'><circle class='sf-svg-loader-anim' cx='34.5' cy='7.5' r='6.5'/><circle class='sf-svg-loader-anim' cx='55.5' cy='15.5' r='6.5'/><circle class='sf-svg-loader-anim' cx='62.5' cy='35.5' r='6.5'/><circle class='sf-svg-loader-anim' cx='55.5' cy='55.5' r='6.5'/><circle class='sf-svg-loader-anim' cx='34.5' cy='62.5' r='6.5'/><circle class='sf-svg-loader-anim' cx='14.5' cy='55.5' r='6.5'/><circle class='sf-svg-loader-anim' cx='7.5' cy='35.5' r='6.5'/><circle class='sf-svg-loader-anim' cx='14.5' cy='15.5' r='6.5'/></g></svg>"},"images/propertiespopout/cirklearrow.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 10 12' enable-background='new 0 0 10 12' xml:space='preserve'><path fill='currentColor' d='M10,7.056c0-2.713-2.225-4.922-4.963-4.942V0L1.701,2.711l3.337,2.813V3.278 c2.091,0.02,3.787,1.706,3.787,3.779c0,2.084-1.715,3.781-3.823,3.781c-2.11,0-3.826-1.697-3.826-3.781H0C0,9.782,2.244,12,5.002,12 C7.756,12,10,9.782,10,7.056z'/></svg>"},"images/propertiespopout/close_12x12.svg":{result:"<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 12 12'><rect fill='currentColor' x='5.228' y='-0.299' width='1.544' height='12.598' transform='translate(-2.486 6) rotate(-45)'/><rect fill='currentColor' x='-0.299' y='5.228' width='12.598' height='1.544' transform='translate(-2.485 6) rotate(-45)'/></svg>"},"images/propertiespopout/settings_12x12.svg":{result:"<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 12 12'><path fill='currentColor' d='M11.675,5.061l-.888-.222a.43.43,0,0,1-.3-.284,4.614,4.614,0,0,0-.291-.7.433.433,0,0,1,.014-.417l.471-.785a.428.428,0,0,0-.065-.524l-.74-.74a.426.426,0,0,0-.522-.063l-.785.47a.428.428,0,0,1-.416.015,4.616,4.616,0,0,0-.7-.29.431.431,0,0,1-.285-.3L6.938.325A.429.429,0,0,0,6.522,0H5.477a.428.428,0,0,0-.415.325l-.222.888a.43.43,0,0,1-.285.3,4.667,4.667,0,0,0-.7.291.432.432,0,0,1-.417-.014L2.65,1.323a.43.43,0,0,0-.523.065l-.739.739a.43.43,0,0,0-.065.524l.47.784a.428.428,0,0,1,.015.416,4.667,4.667,0,0,0-.291.7.432.432,0,0,1-.3.285l-.888.222A.428.428,0,0,0,0,5.477V6.522a.429.429,0,0,0,.324.416l.888.222a.431.431,0,0,1,.305.285,4.568,4.568,0,0,0,.291.7.43.43,0,0,1-.014.416l-.47.784a.428.428,0,0,0,.064.524l.739.74a.429.429,0,0,0,.524.065l.784-.47a.43.43,0,0,1,.417-.014,4.7,4.7,0,0,0,.7.291.428.428,0,0,1,.285.3l.222.888A.427.427,0,0,0,5.477,12H6.523a.429.429,0,0,0,.416-.325l.222-.888a.43.43,0,0,1,.285-.3,4.67,4.67,0,0,0,.7-.291.43.43,0,0,1,.416.014l.784.47a.428.428,0,0,0,.523-.064l.74-.74a.429.429,0,0,0,.065-.524l-.471-.784a.428.428,0,0,1-.014-.416,4.7,4.7,0,0,0,.29-.7.431.431,0,0,1,.305-.285l.888-.222A.428.428,0,0,0,12,6.522V5.477A.429.429,0,0,0,11.675,5.061ZM6,8.143A2.143,2.143,0,1,1,8.143,6,2.142,2.142,0,0,1,6,8.143Z'/></svg>"},"images/recommendations/back.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 10 10' enable-background='new 0 0 10 10' xml:space='preserve'><g fill='currentColor'><polygon points='6.789,0 2.031,5.002 3.242,6.249 8,1.247'/><polygon points='3.211,3.751 2,4.998 6.757,10 7.967,8.752'/></g></svg>"},"images/recommendations/barchart.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 110 110' enable-background='new 0 0 110 110' xml:space='preserve'><g><g><polygon fill='#E4E4E4' points='0.888,109.05 0.888,0 0,0 0,110 110,110 110,109.05 '/></g></g><g><g><rect x='11' y='42' fill='#DEF1FC' width='23' height='63'/></g></g><g><g><rect x='44' y='10' fill='#E2F6EA' width='23' height='95'/></g></g><g><g><rect x='77' y='53' fill='#FDF9E3' width='23' height='52'/></g></g></svg>"},"images/recommendations/color.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 11 11' enable-background='new 0 0 11 11' xml:space='preserve'><g><circle fill='#F08485' cx='2' cy='8' r='2'/><circle fill='#6CBCEA' cx='6' cy='3' r='2'/><circle fill='#84C598' cx='9' cy='8' r='2'/></g></svg>"},"images/recommendations/explanationarrow.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 32 32' enable-background='new 0 0 32 32' xml:space='preserve'><g fill='currentColor'><path d='M17.553,9.974c0.156,0,0.311,0.062,0.429,0.186v12.675c-0.121,0.127-0.303,0.191-0.483,0.191 c-0.178,0-0.355-0.062-0.473-0.186l-6.599-5.837c-0.238-0.25-0.235-0.659,0.005-0.911l6.684-5.927 C17.236,10.038,17.395,9.974,17.553,9.974 M17.553,9c-0.431,0-0.849,0.172-1.154,0.472l-6.66,5.905l-0.032,0.029l-0.432,0.456 c-0.367,0.386-0.366,0.992,0.001,1.378l0.428,0.449l0.032,0.028l6.575,5.816C16.614,23.831,17.044,24,17.498,24 c0.478,0,0.928-0.186,1.237-0.51L19,23.211v-0.377V10.16V9.783l-0.265-0.279C18.43,9.184,17.999,9,17.553,9L17.553,9z'/><path d='M16,32C7.178,32,0,24.822,0,16C0,7.178,7.178,0,16,0c8.822,0,16,7.178,16,16C32,24.822,24.822,32,16,32z M16,0.97C7.712,0.97,0.97,7.712,0.97,16S7.712,31.03,16,31.03S31.03,24.288,31.03,16S24.288,0.97,16,0.97z'/></g></svg>"},"images/recommendations/marker.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 11 11' enable-background='new 0 0 11 11' xml:space='preserve'><g fill='currentColor'><path d='M5.5,0C2.462,0,0,2.462,0,5.5S2.462,11,5.5,11S11,8.538,11,5.5S8.538,0,5.5,0z M5.5,10 c-1.063,0-2.028-0.386-2.798-1.004c-0.22-0.16-0.706-0.708-0.706-0.708C1.382,7.519,1,6.558,1,5.5C1,3.019,3.019,1,5.5,1 S10,3.019,10,5.5S7.981,10,5.5,10z'/><circle cx='7' cy='6' r='1'/><circle cx='4' cy='7' r='1'/><circle cx='5' cy='4' r='1'/></g></svg>"},"images/recommendations/norecommendations.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 80 80' enable-background='new 0 0 80 80' xml:space='preserve'><g><g><circle fill='#DADADA' cx='40' cy='40' r='40'/></g></g><g><g><path fill='#FFFFFF' d='M42.034,60h-4.068c-0.81,0-1.466,0.672-1.466,1.5s0.656,1.5,1.466,1.5h4.068 c0.809,0,1.466-0.672,1.466-1.5S42.843,60,42.034,60z'/></g></g><g><g><path fill='#FFFFFF' d='M43.651,55h-7.302C35.604,55,35,55.672,35,56.5c0,0.828,0.604,1.5,1.349,1.5h7.302 C44.396,58,45,57.328,45,56.5C45,55.672,44.396,55,43.651,55z'/></g></g><g><g><path fill='#FFFFFF' d='M54.996,29.071C55.238,17.292,44.418,15.127,40.01,15H39.99c-4.408,0.127-15.228,2.292-14.986,14.071 c0.02,2.114,0.857,6.663,3.123,9.752c3.88,6.49,5.306,5.407,5.653,12.883l-0.008-0.008c0,0.046,0.009,0.089,0.014,0.134 C33.856,52.487,34.423,53,35.121,53h9.757c0.698,0,1.266-0.513,1.336-1.168c0.005-0.045,0.014-0.088,0.014-0.134l-0.008,0.008 c0.347-7.476,1.773-6.393,5.653-12.883C54.139,35.735,54.976,31.185,54.996,29.071z'/></g></g><g><g><g><path fill='#C0C0C0' d='M41.164,38.813c-0.325-0.318-0.717-0.48-1.164-0.48c-0.448,0-0.839,0.162-1.163,0.48 c-0.334,0.327-0.503,0.727-0.503,1.187c0,0.46,0.169,0.859,0.503,1.186c0.325,0.319,0.716,0.481,1.164,0.481 c0.447,0,0.839-0.162,1.164-0.481c0.333-0.328,0.502-0.727,0.502-1.186C41.667,39.54,41.498,39.141,41.164,38.813z'/></g></g><g><g><path fill='#C0C0C0' d='M46.165,26.057c-0.331-0.59-0.791-1.093-1.367-1.495c-0.57-0.397-1.247-0.704-2.013-0.914 c-0.758-0.209-1.585-0.314-2.458-0.314c-1.83,0-3.389,0.42-4.634,1.25c-1.259,0.839-2.036,2.009-2.309,3.479l-0.051,0.272 l3.646,0.286l0.036-0.237c0.114-0.756,0.447-1.349,1.018-1.813c0.563-0.458,1.314-0.691,2.232-0.691 c0.41,0,0.804,0.061,1.168,0.18c0.362,0.12,0.675,0.284,0.931,0.488c0.255,0.204,0.462,0.452,0.617,0.736 c0.152,0.28,0.229,0.589,0.229,0.919c0,0.329-0.076,0.628-0.226,0.889c-0.159,0.278-0.365,0.547-0.612,0.798 c-0.257,0.26-0.544,0.514-0.854,0.754c-0.322,0.25-0.645,0.496-0.969,0.74c-0.403,0.306-0.746,0.573-1.022,0.793 c-0.292,0.233-0.529,0.481-0.704,0.736c-0.176,0.256-0.31,0.546-0.398,0.863c-0.086,0.31-0.13,0.699-0.13,1.157v1.735h3.456 v-1.322c0-0.324,0.019-0.596,0.058-0.809c0.035-0.197,0.101-0.378,0.196-0.538c0.097-0.162,0.234-0.322,0.405-0.474 c0.184-0.163,0.438-0.367,0.752-0.602l0.304-0.218l1.835-1.517l0.018-0.017c0.422-0.422,0.755-0.883,0.99-1.368 c0.237-0.493,0.357-1.072,0.357-1.72C46.667,27.329,46.498,26.648,46.165,26.057z'/></g></g></g></svg>"},"images/recommendations/piechart.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 104 105' enable-background='new 0 0 104 105' xml:space='preserve'><g><g><path fill='#DEF1FC' d='M51.903,1C24.055,1,1.326,23.16,0,51h49.343L86,13.917C76.873,5.879,64.955,1,51.903,1z'/></g></g><g><g><path fill='#FDF9E3' d='M49.386,55H0c1.38,27.293,24.103,49,51.932,49C64.968,104,76.874,99.226,86,91.356L49.386,55z'/></g></g><g><g><path fill='#E2F6EA' d='M89.808,16L54,52.022L89.763,88C98.583,78.596,104,65.926,104,51.976C104,38.05,98.602,25.399,89.808,16z M50.408,52.583l0.014-0.014l-0.014-0.014V52.583z'/></g></g></svg>"},"images/recommendations/shape.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 13 11' enable-background='new 0 0 13 11' xml:space='preserve'><g fill='currentColor'><path d='M9,3C8.335,3,7.717,3.178,7.166,3.465l0.529,0.847C8.091,4.118,8.53,4,9,4c1.654,0,3,1.346,3,3 c0,1.654-1.346,3-3,3c-1.302,0-2.401-0.839-2.816-2H5.141C5.588,9.722,7.138,11,9,11c2.209,0,4-1.791,4-4C13,4.791,11.209,3,9,3z' /><path d='M5,0L0,8h10L5,0z M5,1.887L8.196,7H1.804L5,1.887z'/></g></svg>"},"images/recommendations/size.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 11 11' enable-background='new 0 0 11 11' xml:space='preserve'><g fill='currentColor'><rect x='1.803' y='6.824' transform='matrix(0.7071 -0.7071 0.7071 0.7071 -4.1048 4.7379)' width='3.728' height='1'/><polygon points='2.985,4.005 6.985,8.005 6.985,4.005 '/><path d='M5.5,0C2.462,0,0,2.462,0,5.5S2.462,11,5.5,11S11,8.538,11,5.5S8.538,0,5.5,0z M5.5,10 c-1.063,0-2.028-0.386-2.798-1.004L1.995,8.288C1.382,7.519,1,6.558,1,5.5C1,3.019,3.019,1,5.5,1S10,3.019,10,5.5S7.981,10,5.5,10 z'/></g></svg>"},"images/recommendations/treemap.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 110 110' enable-background='new 0 0 110 110' xml:space='preserve'><g><g><rect fill='#DEF1FC' width='44' height='110'/></g></g><g><g><rect x='49' fill='#E2F6EA' width='61' height='76'/></g></g><g><g><rect x='49' y='81' fill='#FDF9E3' width='61' height='29'/></g></g></svg>"},"images/recommendations/trellis.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 11 11' enable-background='new 0 0 11 11' xml:space='preserve'><g fill='currentColor'><rect width='11' height='2'/><rect y='5' width='11' height='2'/><rect y='2' width='1' height='3'/><rect x='5' y='2' width='1' height='3'/><rect x='10' y='2' width='1' height='3'/><rect y='7' width='1' height='3'/><rect x='5' y='7' width='1' height='3'/><rect x='10' y='7' width='1' height='3'/><rect y='10' width='11' height='1'/></g></svg>"},"images/recommendations/trellisedplot.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 110 110' enable-background='new 0 0 110 110' xml:space='preserve'><g><g><path fill='#E4E4E4' d='M110,54.883v-0.82h-0.043V0.994h0.012V0H0.012v0.062H0V110h0.901v-0.062h108.11V110h0.946v-0.062h0.012 v-0.919h-0.012V54.883H110z M109.011,109.018H0.901V54.883h108.11V109.018z M109.011,54.063H0.901V0.994h108.11V54.063z'/></g></g><g><g><rect x='18' y='29' fill-rule='evenodd' clip-rule='evenodd' fill='#DEF1FC' width='16' height='24'/></g></g><g><g><rect x='76' y='72' fill-rule='evenodd' clip-rule='evenodd' fill='#DEF1FC' width='16' height='36'/></g></g><g><g><rect x='47' y='29' fill-rule='evenodd' clip-rule='evenodd' fill='#E2F6EA' width='16' height='24'/></g></g><g><g><rect x='47' y='92' fill-rule='evenodd' clip-rule='evenodd' fill='#E2F6EA' width='16' height='16'/></g></g><g><g><rect x='76' y='16' fill-rule='evenodd' clip-rule='evenodd' fill='#FDF9E3' width='16' height='37'/></g></g><g><g><rect x='18' y='76' fill-rule='evenodd' clip-rule='evenodd' fill='#FDF9E3' width='16' height='32'/></g></g></svg>"},"images/rulebuilderdialog/!14x14.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 14 14' xml:space='preserve'><circle cx='7' cy='7' r='7' fill='#E14F4E'/><rect x='6' y='9' width='2' height='2' fill='#FFFFFF'/><rect x='6' y='3' width='2' height='5' fill='#FFFFFF'/></svg>"},"images/rulebuilderdialog/edit_15x10.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='-5 0 15 10' xml:space='preserve' fill='currentColor'><path d='M0,10l3.413-1.383l-2.056-2.1L0,10z M1.907,5.956l2.104,2.149L7.95,4.241L5.846,2.092L1.907,5.956z M7.896,0L6.47,1.456 l2.104,2.149L10,2.149L7.896,0z'/></svg>"},"images/rulebuilderdialog/percentage_15x10.svg":{result:"<svg xmlns='http://www.w3.org/2000/svg' viewBox='-5 0 15 10' fill='currentColor'><polygon points='7.703 0 1 10 2.296 10 9 0 7.703 0'/><path d='M8.036,5C6.85,5,6,6.025,6,7.55,6,9.125,6.9,10,7.976,10S10,9.125,10,7.425C10,5.962,9.27,5,8.036,5ZM8.012,9.138c-0.587,0-.91-0.7-0.9-1.625s0.3-1.638.9-1.638c0.635,0,.874.713,0.874,1.625C8.886,8.487,8.611,9.138,8.012,9.138Z'/><path d='M2.036,0C0.85,0,0,1.025,0,2.55,0,4.125.9,5,1.976,5S4,4.125,4,2.425C4,0.962,3.27,0,2.036,0ZM2.012,4.138c-0.587,0-.91-0.7-0.9-1.625s0.3-1.638.9-1.638c0.635,0,.874.713,0.874,1.625C2.886,3.487,2.611,4.138,2.012,4.138Z'/></svg>"},"images/rulebuilderdialog/pn_15x10.svg":{result:"<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 1 15 10' fill='currentColor'><path d='M7.356,1.487A2.7,2.7,0,0,0,5.69,1H1.913l-.09.419a3.857,3.857,0,0,1,.4.051,2.074,2.074,0,0,1,.406.114A.326.326,0,0,1,2.8,1.75a.587.587,0,0,1,.048.241,1.04,1.04,0,0,1-.009.133.794.794,0,0,1-.017.128L1.393,8.806a1.056,1.056,0,0,1-.153.39.692.692,0,0,1-.326.257,1.664,1.664,0,0,1-.4.082q-.275.032-.424.044L0,10H3.644l.09-.419a4.487,4.487,0,0,1-.487-.044,1.4,1.4,0,0,1-.362-.082.35.35,0,0,1-.191-.171.6.6,0,0,1-.048-.247q0-.044.006-.108A1.16,1.16,0,0,1,2.67,8.8L3.275,6.03H4.311a4.385,4.385,0,0,0,1.366-.213,3.739,3.739,0,0,0,1.179-.631,3.149,3.149,0,0,0,.824-1A2.869,2.869,0,0,0,8,2.816,1.572,1.572,0,0,0,7.356,1.487ZM6.433,3.735a2.525,2.525,0,0,1-.347.8,2.018,2.018,0,0,1-.82.734,2.708,2.708,0,0,1-1.2.245H3.4L4.26,1.484h.778a1.846,1.846,0,0,1,.707.118,1.184,1.184,0,0,1,.716.79,1.99,1.99,0,0,1,.075.552A3.389,3.389,0,0,1,6.433,3.735Z'/><path d='M14.694,9.183a1.533,1.533,0,0,1-.306.044.636.636,0,0,1-.461-.14.751.751,0,0,1-.14-.529,2.829,2.829,0,0,1,.048-.44c.032-.189.065-.356.1-.5l.472-2.189a5.346,5.346,0,0,0,.1-.621q.031-.314.031-.437a1.544,1.544,0,0,0-.3-.992A1.011,1.011,0,0,0,13.394,3a1.822,1.822,0,0,0-1.016.29,7.237,7.237,0,0,0-1.062.89h-.033a1.542,1.542,0,0,0-.2-.812.7.7,0,0,0-.637-.294,1.838,1.838,0,0,0-.58.116,5.165,5.165,0,0,0-.778.354L9,3.983q.107-.034.3-.085a1.272,1.272,0,0,1,.316-.051.545.545,0,0,1,.428.13.86.86,0,0,1,.106.512,3.087,3.087,0,0,1-.053.5l-.081.474-.842,4.42h1.048l.958-5.005a3.038,3.038,0,0,1,.8-.792,1.444,1.444,0,0,1,.763-.273.594.594,0,0,1,.528.266,1.283,1.283,0,0,1,.179.723,2.678,2.678,0,0,1-.036.382c-.024.159-.057.337-.1.532l-.559,2.545c-.035.163-.059.307-.074.427a2.667,2.667,0,0,0-.023.331,1.092,1.092,0,0,0,.225.7A.811.811,0,0,0,13.56,10a1.524,1.524,0,0,0,.568-.112q.28-.112.788-.358L15,9.092A1.666,1.666,0,0,1,14.694,9.183Z'/></svg>"},"images/styleeditor/closebtn_16x16canvas.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 16 16' enable-background='new 0 0 16 16' xml:space='preserve'><g id='Lager_1'><g><g><rect x='0.286' y='7.229' transform='matrix(0.7071 -0.7071 0.7071 0.7071 -3.3137 8)' fill='#ffffff' width='15.428' height='1.543'/></g></g><g><g><rect x='7.229' y='0.286' transform='matrix(0.7071 -0.7071 0.7071 0.7071 -3.3137 8)' fill='#ffffff' width='1.543' height='15.428'/></g></g></g></svg>"},"images/styleeditor/textaligncenter.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' fill='currentColor' viewBox='0 0 10 10' enable-background='new 0 0 10 10' xml:space='preserve'><g id='Lager_1'><g><g><rect x='0' y='0' width='10' height='1'/></g></g><g><g><rect x='2' y='3' width='6' height='1'/></g></g><g><g><rect x='3' y='6' width='4' height='1'/></g></g><g><g><rect x='0' y='9' width='10' height='1'/></g></g></g></svg>"},"images/styleeditor/textalignleft.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' fill='currentColor' viewBox='0 0 10 10' enable-background='new 0 0 10 10' xml:space='preserve'><g id='Lager_1'><g><g><rect x='0' y='0' width='10' height='1'/></g></g><g><g><rect x='0' y='3' width='6' height='1'/></g></g><g><g><rect x='0' y='6' width='4' height='1'/></g></g><g><g><rect x='0' y='9' width='10' height='1'/></g></g></g></svg>"},"images/styleeditor/textalignright.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' fill='currentColor' viewBox='0 0 10 10' enable-background='new 0 0 10 10' xml:space='preserve'><g id='Lager_1'><g><g><rect x='0' y='0' width='10' height='1'/></g></g><g><g><rect x='4' y='3' width='6' height='1'/></g></g><g><g><rect x='6' y='6' width='4' height='1'/></g></g><g><g><rect x='0' y='9' width='10' height='1'/></g></g></g></svg>"},"images/tabcontrol/addpage.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' fill='currentColor' viewBox='0 0 14 14' enable-background='new 0 0 14 14' xml:space='preserve'><g id='Lager_1'><g><g><rect x='6' y='2' width='2' height='10'/></g></g><g><g><rect x='2' y='6' width='10' height='2'/></g></g></g></svg>"},"images/tabcontrol/downarrow.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' fill='currentColor' viewBox='0 0 14 14' enable-background='new 0 0 14 14' xml:space='preserve'><g id='Lager_1'><g><g><polygon points='3,5 7.388,10 12,5 '/></g></g></g></svg>"},"images/tabcontrol/leftarrow.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' fill='currentColor' viewBox='0 0 14 14' enable-background='new 0 0 14 14' xml:space='preserve'><g id='Lager_1'><g><g><polygon points='8.833,1 3,7 4.167,8.2 10,2.2 '/></g></g><g><g><polygon points='4.167,5.8 3,7 8.833,13 10,11.8 '/></g></g></g></svg>"},"images/tabcontrol/removetab.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' fill='currentColor' viewBox='0 0 14 14' enable-background='new 0 0 14 14' xml:space='preserve'><g id='Lager_1'><g><g><rect x='6.247' y='2.096' transform='matrix(0.7071 -0.7071 0.7071 0.7071 -2.8995 7.0005)' width='1.506' height='9.808'/></g></g><g><g><rect x='2.096' y='6.247' transform='matrix(0.7071 -0.7071 0.7071 0.7071 -2.8995 7)' width='9.808' height='1.506'/></g></g></g></svg>"},"images/tabcontrol/rightarrow.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' fill='currentColor' viewBox='0 0 14 14' enable-background='new 0 0 14 14' xml:space='preserve'><g id='Lager_1'><g><g><polygon points='8.833,5.8 3,11.8 4.167,13 10,7 '/></g></g><g><g><polygon points='4.167,1 3,2.2 8.833,8.2 10,7 '/></g></g></g></svg>"},"images/toolbar/analysiscontentexpired.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' fill='currentColor' viewBox='0 0 24 24' enable-background='new 0 0 24 24' xml:space='preserve'><g id='Lager_3'><g><g><g><path d='M16.792,7.558L12.064,4v2.754c-3.8-0.037-6.934,2.394-7.06,5.442c-0.03,0.725,0.116,1.42,0.406,2.061l1.556-0.417 c-0.236-0.502-0.355-1.048-0.331-1.619c0.096-2.327,2.527-4.184,5.428-4.16v2.839L16.792,7.558z'/></g></g><g><g><path d='M18.59,9.744l-1.556,0.417c0.236,0.502,0.355,1.048,0.331,1.619c-0.096,2.327-2.527,4.184-5.428,4.161v-2.839 l-4.729,3.341L11.936,20v-2.754c3.8,0.037,6.934-2.394,7.06-5.442C19.026,11.079,18.88,10.384,18.59,9.744z'/></g></g></g></g></svg>"},"images/toolbar/bookmarks.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' fill='currentColor' viewBox='0 0 24 24' enable-background='new 0 0 24 24' xml:space='preserve'><g id='Lager_1'><g><g><path d='M17.977,19.593V4.407C17.977,4.182,18,4.313,18,4H5.008C5.008,4.188,5,4.182,5,4.407v15.187 C5,19.818,5.008,19.469,5.008,20l6.521-3.3L18,20C18,19.406,17.977,19.818,17.977,19.593z M14.249,15.042l-2.72-2.104v0 l-2.72,2.104l0.974-3.454L7.054,9.403h3.396l1.079-3.373l1.079,3.373h3.396l-2.729,2.185L14.249,15.042z'/></g></g></g></svg>"},"images/toolbar/close.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' fill='currentColor' viewBox='0 0 24 24' enable-background='new 0 0 24 24' xml:space='preserve'><g id='Lager_1'><g><g><rect x='11.092' y='3.008' transform='matrix(0.706 -0.7082 0.7082 0.706 -4.9706 12.0258)' width='1.815' height='17.984'/></g></g><g><g><rect x='3.008' y='11.092' transform='matrix(0.7072 -0.707 0.707 0.7072 -4.9706 11.9974)' width='17.984' height='1.815'/></g></g></g></svg>"},"images/toolbar/collaboration.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' fill='currentColor' viewBox='0 0 24 24' enable-background='new 0 0 24 24' xml:space='preserve'><g id='Http'><g><g><path d='M4,4v16h17V4H4z M5,5h12v2H5V5z M8,16H7v-2H6v2H5v-5h1v2h1v-2h1V16z M12,12h-1v4h-1v-4H9v-1h3V12z M16,12 h-1v4h-1v-4h-1v-1h3V12z M20,14h-2v2h-1v-5h3V14z M20,7h-2V5h2V7z M19,12h-1v1h1V12z'/></g></g></g></svg>"},"images/toolbar/commentstoolbaricon.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' fill='currentColor' viewBox='0 0 24 24' enable-background='new 0 0 24 24' xml:space='preserve'><g id='right_bubble'><g opacity='0.65'><g><path d='M16,4c-2.127,0-4.055,0.544-5.488,1.426c4.044,0.261,7.202,2.482,7.202,5.185 c0,1.33-0.774,2.536-2.034,3.455c-0.12,0.118-0.271,0.221-0.405,0.332c0.239,0.014,0.48,0.024,0.724,0.024 c0.278,0,0.553-0.009,0.824-0.028L16.816,17l3.896-3.584C22.702,12.468,24,10.94,24,9.211C24,6.333,20.418,4,16,4z'/></g></g></g><g id='left_bubble'><g><g><path d='M9,6C6.645,6,4.534,6.667,3.07,7.722C1.788,8.646,1,9.867,1,11.211c0,2.878,3.582,5.211,8,5.211 c0.278,0,0.553-0.009,0.824-0.028L9.816,19l3.896-3.584c0.774-0.369,1.439-0.827,1.968-1.349c0.831-0.82,1.32-1.799,1.32-2.855 C17,8.333,13.418,6,9,6z'/></g></g></g></svg>"},"images/toolbar/dod.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' fill='currentColor' viewBox='0 0 24 24' enable-background='new 0 0 24 24' xml:space='preserve'><g id='Lager_2'><g><g><rect x='3' y='4' width='3' height='1'/></g></g><g><g><rect x='16' y='4' width='3' height='1'/></g></g><g><g><rect x='3' y='19' width='3' height='1'/></g></g><g><g><rect x='16' y='19' width='3' height='1'/></g></g><g><g><rect x='9' y='4' width='4' height='1'/></g></g><g><g><rect x='3' y='10' width='1' height='4'/></g></g><g><g><rect x='3' y='5' width='1' height='2'/></g></g><g><g><rect x='18' y='5' width='1' height='2'/></g></g><g><g><rect x='3' y='17' width='1' height='2'/></g></g><g><g><rect x='18' y='17' width='1' height='2'/></g></g><g><g><rect x='18' y='10' width='1' height='4'/></g></g><g><g><rect x='9' y='19' width='4' height='1'/></g></g><g opacity='0.6'><g><rect x='12' y='11' width='2' height='2'/></g></g><g><g><rect x='15' y='14' width='2' height='2'/></g></g><g opacity='0.6'><g><rect x='20' y='14' width='2' height='2'/></g></g></g></svg>"},"images/toolbar/filter.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' fill='currentColor' viewBox='0 0 24 24' enable-background='new 0 0 24 24' xml:space='preserve'><g id='Lager_1'><g><g><path d='M12,4C7.582,4,4,5.023,4,6.286c0,2.286,6.286,7.772,6.286,7.772v4.799C10.286,19.488,10.738,20,12,20 c1.262,0,1.714-0.512,1.714-1.143v-4.799c0,0,6.286-5.486,6.286-7.772C20,5.023,16.418,4,12,4z M12.122,8.145 c-3.459,0-6.263-0.741-6.263-1.433c0-0.692,2.804-1.34,6.263-1.34c3.459,0,6.263,0.648,6.263,1.34 C18.385,7.404,15.581,8.145,12.122,8.145z'/></g></g></g></svg>"},"images/toolbar/help.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' fill='currentColor' viewBox='0 0 24 24' enable-background='new 0 0 24 24' xml:space='preserve'><g id='Lager_2'><g><g><path d='M12,4c-4.418,0-8,3.582-8,8c0,4.418,3.582,8,8,8s8-3.582,8-8C20,7.582,16.418,4,12,4z M12.712,15.766 c-0.2,0.155-0.44,0.234-0.715,0.234c-0.275,0-0.515-0.079-0.714-0.234c-0.205-0.159-0.309-0.354-0.309-0.578 c0-0.224,0.104-0.419,0.309-0.578c0.199-0.155,0.44-0.234,0.714-0.234c0.275,0,0.515,0.079,0.715,0.234 c0.205,0.16,0.309,0.354,0.309,0.578C13.021,15.412,12.917,15.606,12.712,15.766z M14.84,10.828 c-0.106,0.213-0.256,0.414-0.445,0.599l-0.008,0.007l-0.826,0.664l-0.137,0.096c-0.141,0.103-0.256,0.192-0.338,0.263 c-0.077,0.067-0.139,0.136-0.182,0.207c-0.043,0.07-0.073,0.149-0.088,0.235c-0.017,0.093-0.026,0.212-0.026,0.354v0.578h-1.555 v-0.759c0-0.2,0.02-0.37,0.058-0.506c0.04-0.139,0.1-0.266,0.179-0.378c0.079-0.112,0.186-0.22,0.317-0.322 c0.124-0.096,0.278-0.213,0.46-0.347c0.146-0.106,0.291-0.214,0.436-0.323c0.14-0.105,0.269-0.216,0.384-0.33 c0.111-0.11,0.204-0.228,0.276-0.349c0.067-0.114,0.102-0.245,0.102-0.389c0-0.144-0.035-0.28-0.103-0.402 c-0.07-0.124-0.163-0.233-0.277-0.322c-0.115-0.089-0.256-0.161-0.419-0.214c-0.164-0.052-0.341-0.079-0.526-0.079 c-0.413,0-0.751,0.102-1.005,0.302c-0.257,0.203-0.407,0.462-0.458,0.793l-0.016,0.104L9,10.187l0.023-0.119 c0.123-0.643,0.473-1.155,1.039-1.522C10.622,8.184,11.324,8,12.148,8c0.393,0,0.765,0.046,1.106,0.137 c0.344,0.092,0.649,0.226,0.906,0.4c0.259,0.176,0.466,0.396,0.615,0.654C14.924,9.45,15,9.748,15,10.076 C15,10.36,14.946,10.613,14.84,10.828z'/></g></g></g></svg>"},"images/toolbar/menu.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' fill='currentColor' viewBox='0 0 24 24' enable-background='new 0 0 24 24' xml:space='preserve'><g id='Lager_1'><g><g><rect x='4' y='5' width='16' height='2'/></g></g><g><g><rect x='4' y='11' width='16' height='2'/></g></g><g><g><rect x='4' y='17' width='16' height='2'/></g></g></g></svg>"},"images/toolbar/more.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' fill='currentColor' viewBox='0 0 24 24' enable-background='new 0 0 24 24' xml:space='preserve'><g id='More'><g><g><path d='M12,4c-4.418,0-8,3.582-8,8s3.582,8,8,8s8-3.582,8-8S16.418,4,12,4z M8,13c-0.552,0-1-0.448-1-1c0-0.552,0.448-1,1-1 s1,0.448,1,1C9,12.552,8.552,13,8,13z M12,13c-0.552,0-1-0.448-1-1c0-0.552,0.448-1,1-1s1,0.448,1,1C13,12.552,12.552,13,12,13z M16,13c-0.552,0-1-0.448-1-1c0-0.552,0.448-1,1-1s1,0.448,1,1C17,12.552,16.552,13,16,13z'/></g></g></g></svg>"},"images/toolbar/twitter.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' fill='currentColor' viewBox='0 0 24 24' enable-background='new 0 0 24 24' xml:space='preserve'><g id='Lager_1'><g><g><path d='M21,5.776c-0.662,0.301-1.374,0.505-2.121,0.596c0.763-0.469,1.348-1.211,1.624-2.095 c-0.714,0.434-1.504,0.749-2.345,0.919C17.484,4.46,16.524,4,15.462,4c-2.04,0-3.693,1.695-3.693,3.787 c0,0.297,0.033,0.586,0.096,0.863c-3.069-0.158-5.79-1.666-7.612-3.957c-0.318,0.559-0.5,1.21-0.5,1.904 c0,1.314,0.652,2.473,1.643,3.152c-0.605-0.02-1.175-0.19-1.673-0.474c0,0.016,0,0.032,0,0.048c0,1.835,1.273,3.365,2.962,3.713 c-0.31,0.087-0.636,0.133-0.973,0.133c-0.238,0-0.469-0.024-0.695-0.068c0.47,1.505,1.834,2.599,3.45,2.63 c-1.264,1.016-2.856,1.621-4.586,1.621c-0.298,0-0.592-0.018-0.881-0.053C4.634,18.373,6.575,19,8.661,19 c6.793,0,10.507-5.77,10.507-10.774c0-0.164-0.004-0.328-0.011-0.49C19.879,7.202,20.505,6.535,21,5.776z'/></g></g></g></svg>"},"images/webplayertoolbar/analysiscontentexpiredw14h16.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' fill='currentColor' viewBox='0 0 14 16' enable-background='new 0 0 14 16' xml:space='preserve'><g><g><path d='M13.59,5.744L12.034,6.16c0.236,0.502,0.355,1.048,0.331,1.619c-0.096,2.327-2.527,4.184-5.428,4.161V9.101l-4.729,3.341 L6.936,16v-2.754c3.8,0.037,6.934-2.394,7.06-5.442C14.026,7.079,13.88,6.384,13.59,5.744z M7.064,4.06v2.839l4.729-3.341L7.064,0 v2.754c-3.8-0.037-6.934,2.394-7.06,5.442c-0.03,0.725,0.116,1.42,0.406,2.061L1.966,9.84C1.731,9.338,1.611,8.792,1.635,8.221 C1.732,5.894,4.162,4.037,7.064,4.06z'/></g></g></svg>"},"images/webplayertoolbar/bookmarksw13h16.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' fill='currentColor' viewBox='0 0 13 16' enable-background='new 0 0 13 16' xml:space='preserve'><g><g><path d='M12.977,15.593V0.407C12.977,0.182,13,0.313,13,0H0.008C0.008,0.188,0,0.182,0,0.407v15.187 C0,15.818,0.008,15.469,0.008,16l6.521-3.3L13,16C13,15.406,12.977,15.818,12.977,15.593z M9.249,11.042l-2.72-2.104v0 l-2.72,2.104l0.974-3.454L2.054,5.403H5.45L6.529,2.03l1.079,3.373h3.396L8.275,7.588L9.249,11.042z'/></g></g></svg>"},"images/webplayertoolbar/closew14h16.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' fill='currentColor' viewBox='0 0 14 16' enable-background='new 0 0 14 16' xml:space='preserve'><g id='Lager_1'><polygon points='14,2.286 12.718,1 7,6.717 1.282,1 0,2.286 5.716,8 0,13.714 1.282,15 7,9.283 12.718,15 14,13.714 8.284,8 '/></g></svg>"},"images/webplayertoolbar/collaborationw23h16.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' fill='currentColor' viewBox='0 0 23 16' enable-background='new 0 0 23 16' xml:space='preserve'><g id='bubbles'><g opacity='0.65'><g><path d='M15,0c-2.127,0-4.055,0.544-5.488,1.426c4.044,0.261,7.202,2.482,7.202,5.185 c0,1.33-0.774,2.536-2.034,3.455c-0.12,0.118-0.271,0.221-0.405,0.332c0.239,0.014,0.48,0.024,0.724,0.024 c0.278,0,0.553-0.009,0.824-0.028L15.816,13l3.896-3.584C21.702,8.468,23,6.94,23,5.211C23,2.333,19.418,0,15,0z'/></g></g><g><g><path d='M8,2C5.645,2,3.534,2.667,2.07,3.722C0.788,4.646,0,5.867,0,7.211c0,2.878,3.582,5.211,8,5.211 c0.278,0,0.553-0.009,0.824-0.028L8.816,15l3.896-3.584c0.774-0.369,1.439-0.827,1.968-1.349C15.511,9.247,16,8.268,16,7.211 C16,4.333,12.418,2,8,2z'/></g></g></g></svg>"},"images/webplayertoolbar/detailsondemandw19h16.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' fill='currentColor' viewBox='0 0 19 16' enable-background='new 0 0 19 16' xml:space='preserve'><g><g><rect width='3' height='1'/></g></g><g><g><rect x='13' width='3' height='1'/></g></g><g><g><rect y='15' width='3' height='1'/></g></g><g><g><rect x='13' y='15' width='3' height='1'/></g></g><g><g><rect x='6' width='4' height='1'/></g></g><g><g><rect y='6' width='1' height='4'/></g></g><g><g><rect y='1' width='1' height='2'/></g></g><g><g><rect x='15' y='1' width='1' height='2'/></g></g><g><g><rect y='13' width='1' height='2'/></g></g><g><g><rect x='15' y='13' width='1' height='2'/></g></g><g><g><rect x='15' y='6' width='1' height='4'/></g></g><g><g><rect x='6' y='15' width='4' height='1'/></g></g><g opacity='0.6'><g><rect x='9' y='7' width='2' height='2'/></g></g><g><g><rect x='12' y='10' width='2' height='2'/></g></g><g opacity='0.6'><g><rect x='17' y='10' width='2' height='2'/></g></g></svg>"},"images/webplayertoolbar/filterw16h16.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' fill='currentColor' viewBox='0 0 16 16' enable-background='new 0 0 16 16' xml:space='preserve'><g><g><path d='M8,0C3.582,0,0,1.023,0,2.286c0,2.286,6.286,7.772,6.286,7.772v4.799C6.286,15.488,6.738,16,8,16 c1.262,0,1.714-0.512,1.714-1.143v-4.799c0,0,6.286-5.486,6.286-7.772C16,1.023,12.418,0,8,0z M8.122,4.145 c-3.459,0-6.263-0.741-6.263-1.433c0-0.692,2.804-1.34,6.263-1.34c3.459,0,6.263,0.648,6.263,1.34 C14.385,3.404,11.581,4.145,8.122,4.145z'/></g></g></svg>"},"images/webplayertoolbar/hamburgerw16h16.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' fill='currentColor' viewBox='0 0 16 16' enable-background='new 0 0 16 16' xml:space='preserve'><g id='Lager_1'><g><g><rect y='1' width='16' height='2'/></g></g><g><g><rect y='7' width='16' height='2'/></g></g><g><g><rect y='13' width='16' height='2'/></g></g></g></svg>"},"images/webplayertoolbar/helpw16h16.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' fill='currentColor' viewBox='0 0 16 16' enable-background='new 0 0 16 16' xml:space='preserve'><g><g><path d='M8,0C3.582,0,0,3.582,0,8c0,4.418,3.582,8,8,8s8-3.582,8-8C16,3.582,12.418,0,8,0z M8.712,11.766 C8.512,11.921,8.272,12,7.997,12c-0.275,0-0.515-0.079-0.714-0.234c-0.205-0.159-0.309-0.354-0.309-0.578 c0-0.224,0.104-0.419,0.309-0.578c0.199-0.155,0.44-0.234,0.714-0.234c0.275,0,0.515,0.079,0.715,0.234 c0.205,0.16,0.309,0.354,0.309,0.578C9.021,11.412,8.917,11.606,8.712,11.766z M10.84,6.828c-0.106,0.213-0.256,0.414-0.445,0.599 l-0.008,0.007L9.56,8.098L9.424,8.194C9.282,8.297,9.168,8.386,9.085,8.457C9.008,8.524,8.946,8.594,8.903,8.665 C8.86,8.734,8.83,8.814,8.815,8.9C8.797,8.993,8.789,9.112,8.789,9.254v0.578H7.233V9.073c0-0.2,0.02-0.37,0.058-0.506 c0.04-0.139,0.1-0.266,0.179-0.378C7.55,8.078,7.656,7.97,7.788,7.868c0.124-0.096,0.278-0.213,0.46-0.347 c0.146-0.106,0.291-0.214,0.436-0.323c0.14-0.105,0.269-0.216,0.384-0.33c0.111-0.11,0.204-0.228,0.276-0.349 C9.411,6.404,9.445,6.273,9.445,6.13c0-0.144-0.035-0.28-0.103-0.402c-0.07-0.124-0.163-0.233-0.277-0.322 C8.949,5.316,8.809,5.245,8.646,5.192C8.482,5.14,8.305,5.114,8.12,5.114c-0.413,0-0.751,0.102-1.005,0.302 C6.858,5.619,6.709,5.878,6.657,6.209L6.641,6.312L5,6.187l0.023-0.119c0.123-0.643,0.473-1.155,1.039-1.522 C6.622,4.184,7.324,4,8.148,4C8.54,4,8.913,4.046,9.254,4.137c0.344,0.092,0.649,0.226,0.906,0.4 c0.259,0.176,0.466,0.396,0.615,0.654C10.924,5.45,11,5.748,11,6.076C11,6.36,10.946,6.613,10.84,6.828z'/></g></g></svg>"},"images/webplayertoolbar/morew16h16.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' fill='currentColor' viewBox='0 0 16 16' enable-background='new 0 0 16 16' xml:space='preserve'><g><circle fill='none' cx='12' cy='8' r='1'/><circle fill='none' cx='4' cy='8' r='1'/><circle fill='none' cx='8' cy='8' r='1'/><path d='M8,0C3.582,0,0,3.582,0,8s3.582,8,8,8s8-3.582,8-8S12.418,0,8,0z M4,9C3.448,9,3,8.552,3,8c0-0.552,0.448-1,1-1 s1,0.448,1,1C5,8.552,4.552,9,4,9z M8,9C7.448,9,7,8.552,7,8c0-0.552,0.448-1,1-1s1,0.448,1,1C9,8.552,8.552,9,8,9z M12,9 c-0.552,0-1-0.448-1-1c0-0.552,0.448-1,1-1s1,0.448,1,1C13,8.552,12.552,9,12,9z'/></g></svg>"},"images/webplayertoolbar/webpagepanelw17h16.svg":{result:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' fill='currentColor' viewBox='0 0 17 16' enable-background='new 0 0 17 16' xml:space='preserve'><g><g><path d='M0,0v16h17V0H0z M1,1h12v2H1V1z M4,12H3v-2H2v2H1V7h1v2h1V7h1V12z M8,8H7v4H6V8H5V7h3V8z M12,8h-1v4h-1V8 H9V7h3V8z M16,10h-2v2h-1V7h3V10z M16,3h-2V1h2V3z M15,8h-1v1h1V8z'/></g></g></svg>"},};
}(Spotfire||{}));